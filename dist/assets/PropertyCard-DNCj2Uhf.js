import{j as e}from"./ui-s1SEoZIF.js";import{r as s,d as a}from"./router-D8v2YSKU.js";import{G as t,aj as r,q as i,r as l,s as n,v as o,w as d,f as c,a3 as m,u as p,aO as x,a as h,bD as u,B as g,a1 as j,e as f,k as y,aM as v,aN as b,bH as N,an as w,y as _}from"./index-xsqbJ4m0.js";import{a as C}from"./propertyUtils-41DuwCMc.js";import{P,a as T}from"./PropertyContactDialog-96kFqmMe.js";import{E as S}from"./EnterprisePropertyContactDialog-CD-G_eus.js";import{vendorService as F}from"./vendorService-CCtR_x3v.js";import{f as V}from"./favoriteService-DWV4vgoN.js";import{S as L}from"./square-B7ZPeKKE.js";const $=({onFilterChange:a,initialFilters:p})=>{const[x,h]=s.useState({propertyType:void 0,bedrooms:void 0,minPrice:void 0,maxPrice:void 0,listingType:void 0}),[u,g]=s.useState([]),[j,f]=s.useState([]),[y,v]=s.useState([]),[b,N]=s.useState([]),[w,_]=s.useState(!0);s.useEffect(()=>{(async()=>{try{_(!0);const[e,s,a,t]=await Promise.all([m.getAllPropertyTypes(!1),m.getFilterConfigurationsByType("listing_type",!1),m.getFilterConfigurationsByType("bedrooms",!1),m.getFilterConfigurationsByType("budget",!1)]);g(e),f(s),v(a),N(t)}catch(e){}finally{_(!1)}})()},[]),s.useEffect(()=>{p&&h(p)},[p]);const C=(e,s)=>{const t={...x,[e]:"all"===s||"any"===s||"any-budget"===s?void 0:s};h(t),a(t)};return w?e.jsx("div",{className:"bg-card border border-border rounded-xl p-4 shadow-[var(--shadow-soft)]",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 py-2",children:[e.jsx(t,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{className:"text-muted-foreground",children:"Loading filters..."})]})}):e.jsx("div",{className:"bg-card border border-border rounded-xl p-4 shadow-[var(--shadow-soft)]",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(r,{className:"h-5 w-5"}),e.jsx("span",{children:"Filters:"})]}),e.jsxs(i,{value:x.listingType||"all",onValueChange:e=>C("listingType",e),disabled:w,children:[e.jsx(l,{className:"w-[150px]",children:e.jsx(n,{placeholder:w?"Loading...":"Listing Type"})}),e.jsxs(o,{children:[e.jsx(d,{value:"all",children:"All Types"}),j.map(s=>e.jsx(d,{value:s.value,children:s.displayLabel||s.name},s.id||s._id))]})]}),e.jsxs(i,{value:x.propertyType&&(u.find(e=>e.value.toLowerCase()===x.propertyType?.toLowerCase())?.id||u.find(e=>e.value.toLowerCase()===x.propertyType?.toLowerCase())?._id)||"all",onValueChange:e=>{if("all"===e)C("propertyType","all");else{const s=u.find(s=>(s.id||s._id)===e);s&&C("propertyType",s.value)}},children:[e.jsx(l,{className:"w-[180px]",children:e.jsx(n,{placeholder:"Property Type"})}),e.jsxs(o,{children:[e.jsx(d,{value:"all",children:"All Properties"}),u.map(s=>e.jsx(d,{value:s.id||s._id,children:s.name},s.id||s._id))]})]}),e.jsxs(i,{value:x.bedrooms?.toString()||"any",onValueChange:e=>{const s="any"===e?void 0:parseInt(e);C("bedrooms",s&&!isNaN(s)?s:void 0)},children:[e.jsx(l,{className:"w-[150px]",children:e.jsx(n,{placeholder:"BHK"})}),e.jsxs(o,{children:[e.jsx(d,{value:"any",children:"Any BHK"}),y.map(s=>e.jsx(d,{value:s.value,children:s.displayLabel||s.name},s.id||s._id))]})]}),e.jsxs(i,{value:b.find(e=>e.minValue===x.minPrice&&e.maxValue===x.maxPrice)?.id||b.find(e=>e.minValue===x.minPrice&&e.maxValue===x.maxPrice)?._id||"any-budget",onValueChange:e=>{if("any-budget"===e){const e={...x,minPrice:void 0,maxPrice:void 0};return h(e),void a(e)}const s=b.find(s=>(s.id||s._id)===e);if(s){const e={...x,minPrice:s.minValue,maxPrice:s.maxValue};h(e),a(e)}},children:[e.jsx(l,{className:"w-[180px]",children:e.jsx(n,{placeholder:"Budget"})}),e.jsxs(o,{children:[e.jsx(d,{value:"any-budget",children:"Any Budget"}),b.map(s=>e.jsx(d,{value:s.id||s._id,children:s.displayLabel||s.name},s.id||s._id))]})]}),e.jsx(c,{variant:"secondary",className:"ml-auto",onClick:()=>{const e={propertyType:void 0,bedrooms:void 0,minPrice:void 0,maxPrice:void 0,listingType:void 0};h(e),a(e)},children:"Reset Filters"})]})})},k=({property:t})=>{const r=a(),{isAuthenticated:i,user:l,isVendor:n,isCustomer:o}=p(),[d,m]=s.useState(!1),[$,k]=s.useState(!1),[B,A]=s.useState(!1),[E,O]=s.useState(!1),[D,H]=s.useState(null),[M,K]=s.useState(!0),[q,z]=s.useState(!1),[I,R]=s.useState(!1),U=x.getPrimaryImage(t),G=x.formatPrice(t.price,t.listingType),W=x.formatArea(t.area),J=t.address.district?`${t.address.city}, ${t.address.district}, ${t.address.state}`:`${t.address.city}, ${t.address.state}`;s.useEffect(()=>{(async()=>{if(t.vendor?._id||t.owner?._id)try{K(!0);const e=t.vendor?._id||t.owner?._id,s=await F.isVendorEnterpriseProperty(e);O(s.isEnterprise),H(s.whatsappNumber)}catch(e){O(!1),H(null)}finally{K(!1)}else K(!1)})()},[t.vendor?._id,t.owner?._id]),s.useEffect(()=>{(async()=>{if(i&&o)try{const e=await V.isFavorite(t._id);z(e)}catch(e){}})()},[i,o,t._id]);return e.jsxs(h,{className:"group overflow-hidden hover:shadow-[var(--shadow-large)] transition-all duration-300 flex flex-col h-full",children:[e.jsxs("div",{className:"relative h-44 md:h-48 overflow-hidden",children:[e.jsx("img",{src:U,alt:t.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",onError:e=>{e.target.src=u}}),t.featured&&e.jsx(g,{className:"absolute top-3 left-3 bg-accent text-accent-foreground text-xs py-1 px-2",children:"Featured"}),t.verified&&e.jsx(g,{className:"absolute top-12 left-3 bg-green-500 text-white text-xs py-1 px-2",children:"Verified"}),e.jsx(g,{className:`absolute top-3 ${i&&o?"right-12":"right-3"} text-xs py-1 px-2 ${"available"===t.status?"bg-green-500":"sold"===t.status?"bg-red-500":"rented"===t.status?"bg-blue-500":"bg-yellow-500"} text-white`,children:t.status.charAt(0).toUpperCase()+t.status.slice(1)}),i&&o&&e.jsx(c,{size:"icon",variant:"ghost",className:"absolute top-3 right-3 bg-background/80 backdrop-blur hover:bg-background "+(q?"text-red-500":""),onClick:async e=>{if(e.stopPropagation(),i){if(!I)try{R(!0),q?(await V.removeFromFavorites(t._id),z(!1)):(await V.addToFavorites(t._id),z(!0))}catch(s){}finally{R(!1)}}else r("/login",{state:{from:`/property/${t._id}`,action:"favorite"}})},disabled:I,children:e.jsx(j,{className:"h-5 w-5 "+(q?"fill-current":"")})})]}),e.jsxs(f,{className:"p-3 flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-base md:text-lg line-clamp-2",children:t.title}),e.jsx(g,{variant:"secondary",className:"text-sm",children:"sale"===t.listingType?"For Sale":"rent"===t.listingType?"For Rent":"For Lease"})]}),e.jsxs("div",{className:"flex items-center text-muted-foreground mb-2",children:[e.jsx(y,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-sm line-clamp-1",children:J})]}),e.jsx("div",{className:"text-sm text-muted-foreground mb-2 capitalize",children:t.type?t.type.replace("_"," "):"property"}),e.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:C(t)}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[t.bedrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(v,{className:"h-4 w-4"}),e.jsxs("span",{children:[t.bedrooms," BHK"]})]}),t.bathrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsxs("span",{children:[t.bathrooms," Bath"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{children:W})]})]}),e.jsx("div",{className:"text-xl md:text-2xl font-bold text-primary",children:G}),t.amenities.length>0&&e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[t.amenities.slice(0,3).map((s,a)=>e.jsx(g,{variant:"outline",className:"text-xs",children:s},a)),t.amenities.length>3&&e.jsxs(g,{variant:"outline",className:"text-xs",children:["+",t.amenities.length-3," more"]})]})]}),e.jsxs(N,{className:"p-3 pt-0 flex gap-2 text-sm",children:[!M&&!E&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{variant:"outline",className:"flex-1 py-2",onClick:()=>{i?E?A(!0):m(!0):r("/login",{state:{from:`/property/${t._id}`,action:"message"}})},children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Message"]}),e.jsxs(c,{variant:"outline",className:"flex-1 py-2",onClick:()=>{i?E?A(!0):k(!0):r("/login",{state:{from:`/property/${t._id}`,action:"contact"}})},children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Contact"]})]}),!M&&E&&e.jsxs(c,{variant:"outline",className:"flex-1 bg-green-50 hover:bg-green-100 text-green-700 border-green-200 py-2",onClick:()=>A(!0),children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"WhatsApp Contact"]}),e.jsx(c,{className:"flex-1 py-2",onClick:()=>{i&&n&&(t.owner?._id===l?.id||t.vendor?._id===l?.id)?r(`/vendor/properties/details/${t._id}`):r(`/property/${t._id}`)},children:"View Details"})]}),e.jsx(P,{open:d,onOpenChange:m,property:t,onMessageSent:()=>{}}),e.jsx(T,{open:$,onOpenChange:k,property:t}),e.jsx(S,{open:B,onOpenChange:A,property:t,whatsappNumber:D})]})};export{$ as P,k as a};

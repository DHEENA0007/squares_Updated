import{j as e}from"./ui-BHyUY8Z8.js";import{d as je,r as d}from"./router-2SVJvIbS.js";import{G as pe,D as H,t as h,J as U,K as z,O as J,Q as G,R as K,h as ge,B as m,aw as fe,ax as ve,ay as be,W as Ne,H as ye,f as D,V as Pe,a as f,b as v,c as b,e as N,d as we,L as Se,q as Ce,ap as De,az as q,a5 as Fe,a6 as Ae,a7 as Re,aq as ke,ar as F,a8 as j,E as V,at as Te}from"./index-Bd1eLXM_.js";import{u as Ee}from"./usePagination-DI7D6ysW.js";import{P as Oe,a as $e,b as O,c as Le,d as Me,e as _e}from"./pagination-Rt-SIkt9.js";import{D as qe}from"./DataTable-CTGqJfvj.js";import{S as I}from"./SearchFilter-CUuDsF9n.js";import{A as Ve,b as Ie,c as Be,d as He,e as Ue,f as ze,g as Je,h as Ge}from"./alert-dialog-MvJryQ6D.js";import{S as y}from"./separator-Cj430jYO.js";import{g as Ke}from"./propertyUtils-DZZpAHgC.js";import{I as Qe}from"./indian-rupee-CHSaMQzz.js";import{E as We}from"./ellipsis-CXpaKV_5.js";import{S as Xe}from"./square-pen-B2xeg6m_.js";import{T as B}from"./trash-2-DTVLnEp9.js";import"./vendor-Dazix4UH.js";import"./table-DaOINtos.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=pe("StarOff",[["path",{d:"M8.34 8.34 2 9.27l5 4.87L5.82 21 12 17.77 18.18 21l-.59-3.43",key:"16m0ql"}],["path",{d:"M18.42 12.76 22 9.27l-6.91-1L12 2l-1.44 2.91",key:"1vt8nq"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);class Ze{async makeRequest(r,a={}){const l=H.getToken(),o={headers:{"Content-Type":"application/json",...l&&{Authorization:`Bearer ${l}`},...a.headers},...a},i=await fetch(`https://api.akodefy.com/api/admin${r}`,o);if(!i.ok){const c=await i.json().catch(()=>({}));throw new Error(c.message||`HTTP error! status: ${i.status}`)}return i.json()}async getProperties(r={}){try{const a=new URLSearchParams;Object.entries(r).forEach(([i,c])=>{c!=null&&c!==""&&a.append(i,String(c))});const l=`/properties${a.toString()?`?${a.toString()}`:""}`;return await this.makeRequest(l)}catch(a){const l=a instanceof Error?a.message:"Failed to fetch properties";throw h({title:"Error",description:l,variant:"destructive"}),a}}async approveProperty(r){try{await this.makeRequest(`/properties/${r}/approve`,{method:"POST"}),h({title:"Success",description:"Property approved successfully!"})}catch(a){const l=a instanceof Error?a.message:"Failed to approve property";throw h({title:"Error",description:l,variant:"destructive"}),a}}async rejectProperty(r,a){try{await this.makeRequest(`/properties/${r}/reject`,{method:"POST",body:JSON.stringify({reason:a})}),h({title:"Success",description:"Property rejected successfully!"})}catch(l){const o=l instanceof Error?l.message:"Failed to reject property";throw h({title:"Error",description:o,variant:"destructive"}),l}}async deleteProperty(r){try{await this.makeRequest(`/properties/${r}`,{method:"DELETE"}),h({title:"Success",description:"Property deleted successfully!"})}catch(a){const l=a instanceof Error?a.message:"Failed to delete property";throw h({title:"Error",description:l,variant:"destructive"}),a}}async togglePropertyFeatured(r,a){try{await this.makeRequest(`/properties/${r}/featured`,{method:"PATCH",body:JSON.stringify({featured:a})}),h({title:"Success",description:`Property ${a?"marked as featured":"removed from featured"}!`})}catch(l){const o=l.response?.data||l,i=o.message||l.message||"Failed to update property";throw o.upgradeRequired||o.limitReached?h({title:o.limitReached?"Featured Limit Reached":"Upgrade Required",description:`${i} Visit the Subscription Plans page to upgrade.`,variant:"destructive"}):h({title:"Error",description:i,variant:"destructive"}),l}}getStatusOptions(){return[{label:"Active",value:"active"},{label:"Available",value:"available"},{label:"Pending",value:"pending"},{label:"Sold",value:"sold"},{label:"Rented",value:"rented"},{label:"Rejected",value:"rejected"}]}getStatusColor(r){switch(r.toLowerCase()){case"active":case"available":return"bg-green-500";case"pending":return"bg-yellow-500";case"sold":return"bg-blue-500";case"rented":return"bg-purple-500";case"rejected":return"bg-red-500";default:return"bg-gray-500"}}getStatusText(r){return{active:"Active",available:"Available",pending:"Pending Review",sold:"Sold",rented:"Rented",rejected:"Rejected"}[r.toLowerCase()]||r.charAt(0).toUpperCase()+r.slice(1)}getPropertyTypeOptions(){return[{label:"Apartment",value:"apartment"},{label:"House",value:"house"},{label:"Villa",value:"villa"},{label:"Plot",value:"plot"},{label:"Commercial",value:"commercial"},{label:"Office",value:"office"}]}}const P=new Ze,es=({property:t,open:r,onOpenChange:a})=>{if(!t)return null;const l=(i,c)=>{const w=new Intl.NumberFormat("en-IN",{maximumFractionDigits:0}).format(i);return c==="rent"?`₹${w}/month`:`₹${w}`},o=i=>i?.builtUp?`${i.builtUp} ${i.unit||"sqft"}`:i?.carpet?`${i.carpet} ${i.unit||"sqft"}`:i?.plot?`${i.plot} ${i.unit||"sqft"}`:"N/A";return e.jsx(U,{open:r,onOpenChange:a,children:e.jsxs(z,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(J,{children:[e.jsx(G,{className:"text-2xl",children:t.title}),e.jsx(K,{children:e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(ge,{className:"w-4 h-4"}),t.address.street,", ",t.address.city,", ",t.address.state," - ",t.address.pincode]})})]}),e.jsxs("div",{className:"space-y-6 mt-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(m,{variant:t.status==="active"?"default":t.status==="pending"?"outline":"destructive",children:["Status: ",t.status]}),e.jsx(m,{variant:"secondary",className:"capitalize",children:t.type?t.type.replace("_"," "):"property"}),e.jsxs(m,{variant:t.listingType==="sale"?"default":"outline",children:["For ",t.listingType==="sale"?"Sale":"Rent"]}),t.featured&&e.jsx(m,{variant:"default",children:"Featured"}),t.verified&&e.jsx(m,{variant:"default",children:"Verified"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Price"}),e.jsx("p",{className:"font-semibold",children:l(t.price,t.listingType)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Area"}),e.jsx("p",{className:"font-semibold",children:o(t.area)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bedrooms"}),e.jsx("p",{className:"font-semibold",children:t.bedrooms||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bathrooms"}),e.jsx("p",{className:"font-semibold",children:t.bathrooms||"N/A"})]})]})]}),e.jsx(y,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description})]}),t.amenities&&t.amenities.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(y,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Amenities"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.amenities.map((i,c)=>e.jsx(m,{variant:"outline",className:"capitalize",children:i.replace("_"," ")},c))})]})]}),e.jsx(y,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Owner Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Name"}),e.jsx("p",{className:"font-medium",children:Ke(t.owner)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Email"}),e.jsx("p",{className:"font-medium",children:t.owner?.email})]}),t.owner?.profile?.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"font-medium",children:t.owner.profile.phone})]})]})]}),t.images&&t.images.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(y,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Images"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:t.images.map((i,c)=>e.jsxs("div",{className:"relative aspect-video rounded-lg overflow-hidden border",children:[e.jsx("img",{src:i.url,alt:i.caption||`Property ${c+1}`,className:"w-full h-full object-cover"}),i.isPrimary&&e.jsx(m,{className:"absolute top-2 left-2",variant:"default",children:"Primary"})]},c))})]})]}),t.status==="rejected"&&t.rejectionReason&&e.jsxs(e.Fragment,{children:[e.jsx(y,{}),e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-red-700 mb-2",children:"Rejection Reason"}),e.jsx("p",{className:"text-sm text-red-600",children:t.rejectionReason})]})]})]})]})})},gs=()=>{const t=je(),{toast:r}=Ne(),[a,l]=d.useState(""),[o,i]=d.useState("all"),[c,w]=d.useState("all"),[u,p]=d.useState([]),[Q,$]=d.useState(!0),[W,A]=d.useState(!1),[X,S]=d.useState(!1),[Y,L]=d.useState(!1),[x,g]=d.useState(null),[C,M]=d.useState(""),[_,Z]=d.useState(null);d.useEffect(()=>{const s=H.getCurrentUser();Z(s),ee()},[]);const ee=async()=>{try{$(!0);const s=await P.getProperties({limit:1e3});s.success&&p(s.data.properties)}catch(s){console.error("Failed to fetch properties:",s),r({title:"Error",description:"Failed to load properties",variant:"destructive"})}finally{$(!1)}},R=d.useMemo(()=>u.filter(s=>{const n=s.title.toLowerCase().includes(a.toLowerCase())||s.address.city.toLowerCase().includes(a.toLowerCase())||s.address.state.toLowerCase().includes(a.toLowerCase()),E=o==="all"||s.type===o,xe=c==="all"||s.status===c;return n&&E&&xe}),[u,a,o,c]),{paginatedItems:se,currentPage:k,totalPages:T,goToPage:te,nextPage:ae,previousPage:re}=Ee(R,10),ie=async()=>{if(x)try{await P.deleteProperty(x._id),p(u.filter(s=>s._id!==x._id)),A(!1),g(null),r({title:"Success",description:"Property deleted successfully"})}catch(s){console.error("Failed to delete property:",s),r({title:"Error",description:"Failed to delete property",variant:"destructive"})}},le=async s=>{try{await P.togglePropertyFeatured(s._id,!s.featured),p(u.map(n=>n._id===s._id?{...n,featured:!n.featured}:n)),r({title:"Success",description:`Property ${s.featured?"removed from":"marked as"} featured`})}catch(n){console.error("Failed to toggle featured status:",n),r({title:"Error",description:"Failed to update featured status",variant:"destructive"})}},ne=async s=>{try{await P.approveProperty(s._id),p(u.map(n=>n._id===s._id?{...n,status:"available",verified:!0}:n)),r({title:"Success",description:"Property approved and listed successfully!"})}catch(n){console.error("Failed to approve property:",n),r({title:"Error",description:"Failed to approve property",variant:"destructive"})}},ce=async()=>{if(!(!x||!C.trim()))try{await P.rejectProperty(x._id,C),p(u.map(s=>s._id===x._id?{...s,status:"rejected"}:s)),S(!1),g(null),M(""),r({title:"Property Rejected",description:"Property has been rejected and vendor has been notified."})}catch(s){console.error("Failed to reject property:",s),r({title:"Error",description:"Failed to reject property",variant:"destructive"})}},oe=s=>{g(s),A(!0)},de=s=>{g(s),S(!0)},me=s=>{g(s),L(!0)},ue=s=>s.owner?_&&s.owner._id===_.id?!0:!s.vendor&&(s.status==="active"||s.status==="available"):!1,he=[{key:"title",label:"Property Title",render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.address.city,", ",s.address.state]})]})},{key:"type",label:"Type",render:s=>e.jsx(m,{variant:"secondary",className:"capitalize",children:s.type?s.type.replace("_"," "):"property"})},{key:"listingType",label:"Listing",render:s=>e.jsx(m,{variant:s.listingType==="sale"?"default":"outline",children:s.listingType==="sale"?"For Sale":"For Rent"})},{key:"price",label:"Price",render:s=>e.jsx("span",{className:"font-semibold",children:q.formatPrice(s.price,s.listingType)})},{key:"area",label:"Area",render:s=>e.jsx("span",{children:q.formatArea(s.area)})},{key:"status",label:"Status",render:s=>{const n={active:"default",available:"default",pending:"outline",rejected:"destructive",sold:"secondary",rented:"secondary"};return e.jsx(m,{variant:n[s.status]||"secondary",children:s.status})}},{key:"featured",label:"Featured",render:s=>e.jsx(m,{variant:s.featured?"default":"secondary",children:s.featured?"Featured":"Regular"})},{key:"actions",label:"Actions",render:s=>{const n=ue(s),E=s.status==="pending";return e.jsxs(Fe,{children:[e.jsx(Ae,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"sm",children:e.jsx(We,{className:"w-4 h-4"})})}),e.jsxs(Re,{align:"end",children:[e.jsx(ke,{children:"Actions"}),e.jsx(F,{}),n&&e.jsxs(j,{onClick:()=>t(`/admin/properties/edit/${s._id}`),children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"Edit Property"]}),!n&&e.jsxs(j,{onClick:()=>me(s),children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"View Details"]}),!n&&E&&e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsxs(j,{onClick:()=>ne(s),className:"text-green-600",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Approve & Publish"]}),e.jsxs(j,{onClick:()=>de(s),className:"text-red-600",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Reject"]})]}),s.status==="active"&&e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsx(j,{onClick:()=>le(s),children:s.featured?e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),"Remove Featured"]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Mark Featured"]})})]}),e.jsx(F,{}),e.jsxs(j,{onClick:()=>oe(s),className:"text-red-600",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})}}];return Q?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(ye,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading properties..."})]}):e.jsxs("div",{className:"space-y-6 relative top-[60px]",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Property Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage property listings and details"})]}),e.jsxs(D,{onClick:()=>t("/admin/properties/add"),children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Add Property"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(f,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(b,{className:"text-sm font-medium text-muted-foreground",children:"Total Properties"})}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold",children:u.length})})]}),e.jsxs(f,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(b,{className:"text-sm font-medium text-muted-foreground",children:"Pending Approval"})}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:u.filter(s=>s.status==="pending").length})})]}),e.jsxs(f,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(b,{className:"text-sm font-medium text-muted-foreground",children:"Active Properties"})}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:u.filter(s=>s.status==="active").length})})]}),e.jsxs(f,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(b,{className:"text-sm font-medium text-muted-foreground",children:"Featured"})}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:u.filter(s=>s.featured).length})})]})]}),e.jsxs(f,{children:[e.jsxs(v,{children:[e.jsx(b,{children:"All Properties"}),e.jsxs(we,{children:[R.length," propert",R.length!==1?"ies":"y"," found"]})]}),e.jsxs(N,{children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(I,{searchTerm:a,onSearchChange:l,filterValue:o,onFilterChange:i,filterOptions:[{label:"Apartment",value:"apartment"},{label:"House",value:"house"},{label:"Villa",value:"villa"},{label:"Plot",value:"plot"},{label:"Commercial",value:"commercial"},{label:"Office",value:"office"}],filterPlaceholder:"Filter by type"})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsx(I,{searchTerm:"",onSearchChange:()=>{},filterValue:c,onFilterChange:w,filterOptions:[{label:"Pending",value:"pending"},{label:"Active",value:"active"},{label:"Rejected",value:"rejected"},{label:"Sold",value:"sold"},{label:"Rented",value:"rented"}],filterPlaceholder:"Filter by status",hideSearch:!0})})]})}),e.jsx(qe,{columns:he,data:se.map(s=>({...s,id:s._id})),hideDefaultActions:!0}),T>1&&e.jsx("div",{className:"mt-6",children:e.jsx(Oe,{children:e.jsxs($e,{children:[e.jsx(O,{children:e.jsx(Le,{onClick:re,className:k===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:T},(s,n)=>n+1).map(s=>e.jsx(O,{children:e.jsx(Me,{onClick:()=>te(s),isActive:k===s,className:"cursor-pointer",children:s})},s)),e.jsx(O,{children:e.jsx(_e,{onClick:ae,className:k===T?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]}),e.jsx(Ve,{open:W,onOpenChange:A,children:e.jsxs(Ie,{children:[e.jsxs(Be,{children:[e.jsx(He,{children:"Delete Property"}),e.jsxs(Ue,{children:['Are you sure you want to delete "',x?.title,'"? This action cannot be undone.']})]}),e.jsxs(ze,{children:[e.jsx(Je,{children:"Cancel"}),e.jsx(Ge,{onClick:ie,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})}),e.jsx(U,{open:X,onOpenChange:S,children:e.jsxs(z,{children:[e.jsxs(J,{children:[e.jsx(G,{children:"Reject Property"}),e.jsxs(K,{children:['Please provide a reason for rejecting "',x?.title,'". The vendor will be notified.']})]}),e.jsxs("div",{className:"py-4",children:[e.jsx(Se,{htmlFor:"rejection-reason",children:"Rejection Reason"}),e.jsx(Ce,{id:"rejection-reason",placeholder:"Enter the reason for rejection...",value:C,onChange:s=>M(s.target.value),className:"mt-2",rows:4})]}),e.jsxs(De,{children:[e.jsx(D,{variant:"outline",onClick:()=>S(!1),children:"Cancel"}),e.jsx(D,{variant:"destructive",onClick:ce,disabled:!C.trim(),children:"Reject Property"})]})]})}),e.jsx(es,{property:x,open:Y,onOpenChange:L})]})};export{gs as default};

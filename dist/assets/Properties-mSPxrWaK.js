import{j as e}from"./ui-DYmpZ3pJ.js";import{d as ve,r as d}from"./router-2SVJvIbS.js";import{x as be,y as z,t as j,h as Ne,B as u,ac as ye,ad as Pe,ae as we,D as Se,f as k,A as Ce,a as N,b as y,c as P,e as w,d as De,af as I,Q as Fe,R as Ae,V as ke,a5 as Te,a6 as S,W as p,E as L,a9 as Re}from"./index-BbgqWuYN.js";import{u as Ee}from"./usePagination-DI7D6ysW.js";import{P as Oe,a as Le,b as $,c as $e,d as Me,e as _e}from"./pagination-B81IIWK4.js";import{D as qe}from"./DataTable-Cs-k6Jh3.js";import{S as B}from"./SearchFilter-BrvzFCXm.js";import{A as Ue,b as Ve,c as Ie,d as Be,e as He,f as ze,g as Je,h as Qe}from"./alert-dialog-DfW1Vj1j.js";import{D as J,a as Q,b as W,c as G,d as K,e as We}from"./dialog-DsX3mE8Q.js";import{L as Ge}from"./label-DRahLfWI.js";import{T as Ke}from"./textarea-Cl1lQCIh.js";import{S as C}from"./separator-CbwKV3QQ.js";import{g as Xe}from"./propertyUtils-B_5yebUt.js";import{I as Ye}from"./indian-rupee-CE-_2HBQ.js";import{P as Ze}from"./PropertyStatusDialog-BIpTZT64.js";import{L as es}from"./loader-circle-DtIJ61xE.js";import{E as ss}from"./ellipsis-hsdzzVqq.js";import{S as ts}from"./square-pen-uFfo4AcD.js";import{T as H}from"./trash-2-PyAegrM1.js";import"./vendor-Dazix4UH.js";import"./table-Cruer2y3.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=be("StarOff",[["path",{d:"M8.34 8.34 2 9.27l5 4.87L5.82 21 12 17.77 18.18 21l-.59-3.43",key:"16m0ql"}],["path",{d:"M18.42 12.76 22 9.27l-6.91-1L12 2l-1.44 2.91",key:"1vt8nq"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);class rs{async makeRequest(a,r={}){const n=z.getToken(),c={headers:{"Content-Type":"application/json",...n&&{Authorization:`Bearer ${n}`},...r.headers},...r},i=await fetch(`https://squares-v2.onrender.com/api/admin${a}`,c);if(!i.ok){const o=await i.json().catch(()=>({}));throw new Error(o.message||`HTTP error! status: ${i.status}`)}return i.json()}async getProperties(a={}){try{const r=new URLSearchParams;Object.entries(a).forEach(([i,o])=>{o!=null&&o!==""&&r.append(i,String(o))});const n=`/properties${r.toString()?`?${r.toString()}`:""}`;return await this.makeRequest(n)}catch(r){const n=r instanceof Error?r.message:"Failed to fetch properties";throw j({title:"Error",description:n,variant:"destructive"}),r}}async updatePropertyStatus(a,r,n){try{await this.makeRequest(`/properties/${a}/status`,{method:"PATCH",body:JSON.stringify({status:r,reason:n})}),j({title:"Success",description:"Property status updated successfully!"})}catch(c){const i=c instanceof Error?c.message:"Failed to update property status";throw j({title:"Error",description:i,variant:"destructive"}),c}}async deleteProperty(a){try{await this.makeRequest(`/properties/${a}`,{method:"DELETE"}),j({title:"Success",description:"Property deleted successfully!"})}catch(r){const n=r instanceof Error?r.message:"Failed to delete property";throw j({title:"Error",description:n,variant:"destructive"}),r}}async togglePropertyFeatured(a,r){try{await this.makeRequest(`/properties/${a}/featured`,{method:"PATCH",body:JSON.stringify({featured:r})}),j({title:"Success",description:`Property ${r?"marked as featured":"removed from featured"}!`})}catch(n){const c=n instanceof Error?n.message:"Failed to update property";throw j({title:"Error",description:c,variant:"destructive"}),n}}getStatusOptions(){return[{label:"Active",value:"active"},{label:"Available",value:"available"},{label:"Pending",value:"pending"},{label:"Sold",value:"sold"},{label:"Rented",value:"rented"},{label:"Rejected",value:"rejected"}]}getStatusColor(a){switch(a.toLowerCase()){case"active":case"available":return"bg-green-500";case"pending":return"bg-yellow-500";case"sold":return"bg-blue-500";case"rented":return"bg-purple-500";case"rejected":return"bg-red-500";default:return"bg-gray-500"}}getStatusText(a){return{active:"Active",available:"Available",pending:"Pending Review",sold:"Sold",rented:"Rented",rejected:"Rejected"}[a.toLowerCase()]||a.charAt(0).toUpperCase()+a.slice(1)}getPropertyTypeOptions(){return[{label:"Apartment",value:"apartment"},{label:"House",value:"house"},{label:"Villa",value:"villa"},{label:"Plot",value:"plot"},{label:"Commercial",value:"commercial"},{label:"Office",value:"office"}]}}const v=new rs,is=({property:t,open:a,onOpenChange:r})=>{if(!t)return null;const n=(i,o)=>{const D=new Intl.NumberFormat("en-IN",{maximumFractionDigits:0}).format(i);return o==="rent"?`₹${D}/month`:`₹${D}`},c=i=>i?.builtUp?`${i.builtUp} ${i.unit||"sqft"}`:i?.carpet?`${i.carpet} ${i.unit||"sqft"}`:i?.plot?`${i.plot} ${i.unit||"sqft"}`:"N/A";return e.jsx(J,{open:a,onOpenChange:r,children:e.jsxs(Q,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(W,{children:[e.jsx(G,{className:"text-2xl",children:t.title}),e.jsx(K,{children:e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),t.address.street,", ",t.address.city,", ",t.address.state," - ",t.address.pincode]})})]}),e.jsxs("div",{className:"space-y-6 mt-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(u,{variant:t.status==="active"?"default":t.status==="pending"?"outline":"destructive",children:["Status: ",t.status]}),e.jsx(u,{variant:"secondary",className:"capitalize",children:t.type?t.type.replace("_"," "):"property"}),e.jsxs(u,{variant:t.listingType==="sale"?"default":"outline",children:["For ",t.listingType==="sale"?"Sale":"Rent"]}),t.featured&&e.jsx(u,{variant:"default",children:"Featured"}),t.verified&&e.jsx(u,{variant:"default",children:"Verified"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Price"}),e.jsx("p",{className:"font-semibold",children:n(t.price,t.listingType)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Area"}),e.jsx("p",{className:"font-semibold",children:c(t.area)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bedrooms"}),e.jsx("p",{className:"font-semibold",children:t.bedrooms||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bathrooms"}),e.jsx("p",{className:"font-semibold",children:t.bathrooms||"N/A"})]})]})]}),e.jsx(C,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description})]}),t.amenities&&t.amenities.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(C,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Amenities"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.amenities.map((i,o)=>e.jsx(u,{variant:"outline",className:"capitalize",children:i.replace("_"," ")},o))})]})]}),e.jsx(C,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Owner Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Name"}),e.jsx("p",{className:"font-medium",children:Xe(t.owner)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Email"}),e.jsx("p",{className:"font-medium",children:t.owner?.email})]}),t.owner?.profile?.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"font-medium",children:t.owner.profile.phone})]})]})]}),t.images&&t.images.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(C,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Images"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:t.images.map((i,o)=>e.jsxs("div",{className:"relative aspect-video rounded-lg overflow-hidden border",children:[e.jsx("img",{src:i.url,alt:i.caption||`Property ${o+1}`,className:"w-full h-full object-cover"}),i.isPrimary&&e.jsx(u,{className:"absolute top-2 left-2",variant:"default",children:"Primary"})]},o))})]})]}),t.status==="rejected"&&t.rejectionReason&&e.jsxs(e.Fragment,{children:[e.jsx(C,{}),e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-red-700 mb-2",children:"Rejection Reason"}),e.jsx("p",{className:"text-sm text-red-600",children:t.rejectionReason})]})]})]})]})})},Ds=()=>{const t=ve(),{toast:a}=Se(),[r,n]=d.useState(""),[c,i]=d.useState("all"),[o,D]=d.useState("all"),[m,g]=d.useState([]),[X,M]=d.useState(!0),[Y,T]=d.useState(!1),[Z,F]=d.useState(!1),[ee,_]=d.useState(!1),[se,q]=d.useState(!1),[h,f]=d.useState(null),[A,U]=d.useState(""),[V,te]=d.useState(null);d.useEffect(()=>{const s=z.getCurrentUser();te(s),ae()},[]);const ae=async()=>{try{M(!0);const s=await v.getProperties({limit:1e3});s.success&&g(s.data.properties)}catch(s){console.error("Failed to fetch properties:",s),a({title:"Error",description:"Failed to load properties",variant:"destructive"})}finally{M(!1)}},R=d.useMemo(()=>m.filter(s=>{const l=s.title.toLowerCase().includes(r.toLowerCase())||s.address.city.toLowerCase().includes(r.toLowerCase())||s.address.state.toLowerCase().includes(r.toLowerCase()),b=c==="all"||s.type===c,x=o==="all"||s.status===o;return l&&b&&x}),[m,r,c,o]),{paginatedItems:re,currentPage:E,totalPages:O,goToPage:ie,nextPage:le,previousPage:ne}=Ee(R,10),oe=async()=>{if(h)try{await v.deleteProperty(h._id),g(m.filter(s=>s._id!==h._id)),T(!1),f(null),a({title:"Success",description:"Property deleted successfully"})}catch(s){console.error("Failed to delete property:",s),a({title:"Error",description:"Failed to delete property",variant:"destructive"})}},ce=async s=>{try{await v.togglePropertyFeatured(s._id,!s.featured),g(m.map(l=>l._id===s._id?{...l,featured:!l.featured}:l)),a({title:"Success",description:`Property ${s.featured?"removed from":"marked as"} featured`})}catch(l){console.error("Failed to toggle featured status:",l),a({title:"Error",description:"Failed to update featured status",variant:"destructive"})}},de=async s=>{try{await v.updatePropertyStatus(s._id,"active"),g(m.map(l=>l._id===s._id?{...l,status:"active",verified:!0}:l)),a({title:"Success",description:"Property approved and listed successfully!"})}catch(l){console.error("Failed to approve property:",l),a({title:"Error",description:"Failed to approve property",variant:"destructive"})}},me=async(s,l,b)=>{try{await v.updatePropertyStatus(s,l,b),g(m.map(x=>x._id===s?{...x,status:l}:x)),a({title:"Success",description:`Property status updated to ${l}!`})}catch(x){console.error("Failed to update property status:",x),a({title:"Error",description:"Failed to update property status",variant:"destructive"})}},ue=async()=>{if(!(!h||!A.trim()))try{await v.updatePropertyStatus(h._id,"rejected",A),g(m.map(s=>s._id===h._id?{...s,status:"rejected"}:s)),F(!1),f(null),U(""),a({title:"Property Rejected",description:"Property has been rejected and vendor has been notified."})}catch(s){console.error("Failed to reject property:",s),a({title:"Error",description:"Failed to reject property",variant:"destructive"})}},he=s=>{f(s),T(!0)},xe=s=>{f(s),F(!0)},je=s=>{f(s),_(!0)},pe=s=>{f(s),q(!0)},ge=s=>s.owner?V&&s.owner._id===V.id?!0:!s.vendor&&(s.status==="active"||s.status==="available"):!1,fe=[{key:"title",label:"Property Title",render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.address.city,", ",s.address.state]})]})},{key:"type",label:"Type",render:s=>e.jsx(u,{variant:"secondary",className:"capitalize",children:s.type?s.type.replace("_"," "):"property"})},{key:"listingType",label:"Listing",render:s=>e.jsx(u,{variant:s.listingType==="sale"?"default":"outline",children:s.listingType==="sale"?"For Sale":"For Rent"})},{key:"price",label:"Price",render:s=>e.jsx("span",{className:"font-semibold",children:I.formatPrice(s.price,s.listingType)})},{key:"area",label:"Area",render:s=>e.jsx("span",{children:I.formatArea(s.area)})},{key:"status",label:"Status",render:s=>{const l={active:"default",available:"default",pending:"outline",rejected:"destructive",sold:"secondary",rented:"secondary"};return e.jsx(u,{variant:l[s.status]||"secondary",children:s.status})}},{key:"featured",label:"Featured",render:s=>e.jsx(u,{variant:s.featured?"default":"secondary",children:s.featured?"Featured":"Regular"})},{key:"actions",label:"Actions",render:s=>{const l=ge(s),b=s.status==="pending";return e.jsxs(Fe,{children:[e.jsx(Ae,{asChild:!0,children:e.jsx(k,{variant:"ghost",size:"sm",children:e.jsx(ss,{className:"w-4 h-4"})})}),e.jsxs(ke,{align:"end",children:[e.jsx(Te,{children:"Actions"}),e.jsx(S,{}),l&&e.jsxs(p,{onClick:()=>t(`/admin/properties/edit/${s._id}`),children:[e.jsx(ts,{className:"w-4 h-4 mr-2"}),"Edit Property"]}),!l&&e.jsxs(p,{onClick:()=>je(s),children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"View Details"]}),!l&&b&&e.jsxs(e.Fragment,{children:[e.jsx(S,{}),e.jsxs(p,{onClick:()=>de(s),className:"text-green-600",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Approve & Publish"]}),e.jsxs(p,{onClick:()=>xe(s),className:"text-red-600",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Reject"]})]}),e.jsx(S,{}),e.jsxs(p,{onClick:()=>pe(s),children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Update Status"]}),s.status==="active"&&e.jsxs(e.Fragment,{children:[e.jsx(S,{}),e.jsx(p,{onClick:()=>ce(s),children:s.featured?e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"w-4 h-4 mr-2"}),"Remove Featured"]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Mark Featured"]})})]}),e.jsx(S,{}),e.jsxs(p,{onClick:()=>he(s),className:"text-red-600",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})}}];return X?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(es,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading properties..."})]}):e.jsxs("div",{className:"space-y-6 relative top-[60px]",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Property Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage property listings and details"})]}),e.jsxs(k,{onClick:()=>t("/admin/properties/add"),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Add Property"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(N,{children:[e.jsx(y,{className:"pb-2",children:e.jsx(P,{className:"text-sm font-medium text-muted-foreground",children:"Total Properties"})}),e.jsx(w,{children:e.jsx("div",{className:"text-2xl font-bold",children:m.length})})]}),e.jsxs(N,{children:[e.jsx(y,{className:"pb-2",children:e.jsx(P,{className:"text-sm font-medium text-muted-foreground",children:"Pending Approval"})}),e.jsx(w,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:m.filter(s=>s.status==="pending").length})})]}),e.jsxs(N,{children:[e.jsx(y,{className:"pb-2",children:e.jsx(P,{className:"text-sm font-medium text-muted-foreground",children:"Active Properties"})}),e.jsx(w,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:m.filter(s=>s.status==="active").length})})]}),e.jsxs(N,{children:[e.jsx(y,{className:"pb-2",children:e.jsx(P,{className:"text-sm font-medium text-muted-foreground",children:"Featured"})}),e.jsx(w,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:m.filter(s=>s.featured).length})})]})]}),e.jsxs(N,{children:[e.jsxs(y,{children:[e.jsx(P,{children:"All Properties"}),e.jsxs(De,{children:[R.length," propert",R.length!==1?"ies":"y"," found"]})]}),e.jsxs(w,{children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(B,{searchTerm:r,onSearchChange:n,filterValue:c,onFilterChange:i,filterOptions:[{label:"Apartment",value:"apartment"},{label:"House",value:"house"},{label:"Villa",value:"villa"},{label:"Plot",value:"plot"},{label:"Commercial",value:"commercial"},{label:"Office",value:"office"}],filterPlaceholder:"Filter by type"})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsx(B,{searchTerm:"",onSearchChange:()=>{},filterValue:o,onFilterChange:D,filterOptions:[{label:"Pending",value:"pending"},{label:"Active",value:"active"},{label:"Rejected",value:"rejected"},{label:"Sold",value:"sold"},{label:"Rented",value:"rented"}],filterPlaceholder:"Filter by status",hideSearch:!0})})]})}),e.jsx(qe,{columns:fe,data:re.map(s=>({...s,id:s._id})),hideDefaultActions:!0}),O>1&&e.jsx("div",{className:"mt-6",children:e.jsx(Oe,{children:e.jsxs(Le,{children:[e.jsx($,{children:e.jsx($e,{onClick:ne,className:E===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:O},(s,l)=>l+1).map(s=>e.jsx($,{children:e.jsx(Me,{onClick:()=>ie(s),isActive:E===s,className:"cursor-pointer",children:s})},s)),e.jsx($,{children:e.jsx(_e,{onClick:le,className:E===O?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]}),e.jsx(Ue,{open:Y,onOpenChange:T,children:e.jsxs(Ve,{children:[e.jsxs(Ie,{children:[e.jsx(Be,{children:"Delete Property"}),e.jsxs(He,{children:['Are you sure you want to delete "',h?.title,'"? This action cannot be undone.']})]}),e.jsxs(ze,{children:[e.jsx(Je,{children:"Cancel"}),e.jsx(Qe,{onClick:oe,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})}),e.jsx(J,{open:Z,onOpenChange:F,children:e.jsxs(Q,{children:[e.jsxs(W,{children:[e.jsx(G,{children:"Reject Property"}),e.jsxs(K,{children:['Please provide a reason for rejecting "',h?.title,'". The vendor will be notified.']})]}),e.jsxs("div",{className:"py-4",children:[e.jsx(Ge,{htmlFor:"rejection-reason",children:"Rejection Reason"}),e.jsx(Ke,{id:"rejection-reason",placeholder:"Enter the reason for rejection...",value:A,onChange:s=>U(s.target.value),className:"mt-2",rows:4})]}),e.jsxs(We,{children:[e.jsx(k,{variant:"outline",onClick:()=>F(!1),children:"Cancel"}),e.jsx(k,{variant:"destructive",onClick:ue,disabled:!A.trim(),children:"Reject Property"})]})]})}),e.jsx(is,{property:h,open:ee,onOpenChange:_}),e.jsx(Ze,{property:h,open:se,onOpenChange:q,onUpdateStatus:me})]})};export{Ds as default};

import{t as a}from"./index-CiYV0Sy0.js";import"./ui-CEt46o3G.js";import"./router-2SVJvIbS.js";import"./vendor-Dazix4UH.js";const n="https://squares-9d84.onrender.com/api";class u{async makeRequest(e,t={}){const r=`${n}${e}`,s={headers:{"Content-Type":"application/json",...t.headers},...t},i=localStorage.getItem("token");i&&(s.headers={...s.headers,Authorization:`Bearer ${i}`});try{const o=await fetch(r,s);if(!o.ok){const c=await o.json().catch(()=>({success:!1,message:`HTTP ${o.status}: ${o.statusText}`}));throw new Error(c.message||"An error occurred")}return await o.json()}catch(o){throw console.error("Vendor API request failed:",o),o}}async getVendorProfile(){try{const e=await this.makeRequest("/users/profile");if(e.success&&e.data)return e.data.user;throw new Error("Failed to fetch vendor profile")}catch(e){const t=e instanceof Error?e.message:"Failed to fetch vendor profile";throw a({title:"Error",description:t,variant:"destructive"}),e}}async updateVendorProfile(e){try{const t=localStorage.getItem("token"),r=JSON.parse(localStorage.getItem("user")||"{}");if(!r.id)throw new Error("User ID not found");const s=await this.makeRequest(`/users/${r.id}`,{method:"PUT",body:JSON.stringify(e)});if(s.success&&s.data)return localStorage.setItem("user",JSON.stringify(s.data.user)),a({title:"Success",description:"Profile updated successfully!"}),s.data.user;throw new Error("Failed to update vendor profile")}catch(t){const r=t instanceof Error?t.message:"Failed to update vendor profile";throw a({title:"Error",description:r,variant:"destructive"}),t}}async getVendorStatistics(){try{const e=await this.makeRequest("/vendors/statistics");return e.success&&e.data?e.data:{totalProperties:0,totalSales:0,totalValue:"₹0",totalLeads:0,avgResponseTime:"Not calculated"}}catch(e){return console.error("Failed to fetch vendor statistics:",e),{totalProperties:0,totalSales:0,totalValue:"₹0",totalLeads:0,avgResponseTime:"Not calculated"}}}async checkSubscription(e){try{const t=await this.makeRequest(`/vendors/subscription/check/${e}`);return t.success&&t.data?t.data.hasSubscription:!1}catch(t){return console.error("Failed to check subscription:",t),!1}}async activateSubscription(e,t){try{return await this.makeRequest("/vendors/subscription/activate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({planId:e,paymentId:t})})}catch(r){return console.error("Failed to activate subscription:",r),{success:!1,message:"Failed to activate subscription. Please try again."}}}async getVendorSubscriptions(){try{const e=await this.makeRequest("/vendors/subscriptions");return e.success&&e.data?e.data.subscriptions:[]}catch(e){return console.error("Failed to fetch vendor subscriptions:",e),[]}}async getSubscriptionLimits(){try{const e=await this.makeRequest("/vendors/subscription-limits");return e.success&&e.data?e.data:{maxProperties:5,currentProperties:0,canAddMore:!0,planName:"Free",features:["5 Property Listings"]}}catch(e){return console.error("Failed to fetch subscription limits:",e),{maxProperties:5,currentProperties:0,canAddMore:!0,planName:"Free",features:["5 Property Listings"]}}}async cleanupSubscriptions(){try{const e=await this.makeRequest("/vendors/subscription/cleanup",{method:"POST"});return e.success?(a({title:"Subscriptions Cleaned Up",description:`Deactivated ${e.deactivatedCount} old subscriptions. Using latest subscription now.`}),await this.refreshSubscriptionData(),{success:!0,activeSubscription:e.activeSubscription,deactivatedCount:e.deactivatedCount}):{success:!1,activeSubscription:null,deactivatedCount:0}}catch(e){return console.error("Failed to cleanup subscriptions:",e),a({title:"Error",description:"Failed to cleanup subscriptions",variant:"destructive"}),{success:!1,activeSubscription:null,deactivatedCount:0}}}async refreshSubscriptionData(){try{const e=await this.makeRequest("/vendors/subscription/refresh",{method:"POST"});if(e.success&&e.data){const t=[];for(let r=0;r<localStorage.length;r++){const s=localStorage.key(r);s&&(s.includes("subscription")||s.includes("limits")||s.includes("plan"))&&t.push(s)}return t.forEach(r=>localStorage.removeItem(r)),a({title:"Success",description:e.message||"Subscription data refreshed successfully!"}),e.data}throw new Error("Failed to refresh subscription data")}catch(e){const t=e instanceof Error?e.message:"Failed to refresh subscription data";throw a({title:"Error",description:t,variant:"destructive"}),e}}}const m=new u;export{m as default,m as vendorService};

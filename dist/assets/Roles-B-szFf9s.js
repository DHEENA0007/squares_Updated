import{j as e}from"./ui-s1SEoZIF.js";import{d as s,r as a}from"./router-D8v2YSKU.js";import{D as t,u as l,G as i,f as r,al as n,Z as c,a9 as d,a as m,b as o,c as x,e as u,S as h,d as p,a4 as j,a5 as g,a6 as f,a7 as N,a8 as v,ae as b,t as y,U as w,B as S,ar as C,as as R,at as A,au as E,av as k,aw as T,ad as L}from"./index-CJkfZmVJ.js";import{P as D,a as P,b as _,c as O,d as I,e as U}from"./pagination-BnFw6TCs.js";import{D as F}from"./DataTable-BcTBbf73.js";import{u as z,S as M}from"./usePermissions-BuzsPbWB.js";import{r as Y}from"./roleService-CJ8_4ix2.js";import{E as G}from"./ellipsis-DCXRa9jK.js";import{S as H}from"./square-pen-PwGlc3xO.js";import"./vendor-BxThA0WO.js";import"./table-CzkDMlQH.js";const W=t("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]),Z=t("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),$=()=>{const t=s(),{isSuperAdmin:$,refreshUser:q}=l(),{hasPermission:B}=z(),[K,V]=a.useState(""),[J,Q]=a.useState("all"),[X,ee]=a.useState([]),[se,ae]=a.useState(!0),[te,le]=a.useState(!1),[ie,re]=a.useState(1),[ne,ce]=a.useState(1),[de,me]=a.useState(0),[oe,xe]=a.useState(null),[ue,he]=a.useState(null),[pe,je]=a.useState(!1),[ge,fe]=a.useState(null),[Ne,ve]=a.useState(!1),be=a.useRef(),ye=a.useCallback(async()=>{try{ae(!0);const e={page:ie,limit:10,search:K||void 0,isActive:"all"===J?void 0:"active"===J},s=await Y.getRoles(e),a=s.data.roles.map(e=>({...e,pages:e.pages||[]})),t=["superadmin","subadmin","agent","vendor","customer"],l=a.sort((e,s)=>{const a=e.name.toLowerCase(),l=s.name.toLowerCase(),i=t.indexOf(a),r=t.indexOf(l);return-1!==i&&-1!==r?i-r:-1!==i?-1:-1!==r?1:a.localeCompare(l)});ee(l),ce(s.data.pagination.totalPages),me(s.data.pagination.totalRoles);const i=a.find(e=>"superadmin"===e.name.toLowerCase()),r=a.find(e=>"subadmin"===e.name.toLowerCase());xe(i||null),he(r||null)}catch(e){}finally{ae(!1)}},[ie,K,J]);a.useEffect(()=>{ye()},[ye]),a.useEffect(()=>()=>{be.current&&clearTimeout(be.current)},[]);const we=a.useCallback(e=>{be.current&&clearTimeout(be.current),be.current=setTimeout(()=>{V(e),re(1)},300)},[]),Se=a.useCallback(e=>{Q(e),re(1)},[]),Ce=s=>{const a=s.name.toLowerCase();return"superadmin"===a?e.jsxs(S,{variant:"destructive",className:"text-xs",children:[e.jsx(h,{className:"w-3 h-3 mr-1"}),"Super Admin"]}):"subadmin"===a?e.jsxs(S,{variant:"default",className:"text-xs bg-orange-500 hover:bg-orange-500/80",children:[e.jsx(h,{className:"w-3 h-3 mr-1"}),"Sub Admin"]}):s.isSystemRole?e.jsxs(S,{variant:"outline",className:"text-xs",children:[e.jsx(h,{className:"w-3 h-3 mr-1"}),"System"]}):null},Re=[{key:"name",label:"Role Name",render:s=>e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[s.name.charAt(0).toUpperCase()+s.name.slice(1),Ce(s)]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description})]})},{key:"userCount",label:"Users",render:s=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:s.userCount||0})]})},{key:"isActive",label:"Status",render:s=>e.jsx(S,{variant:s.isActive?"default":"secondary",children:s.isActive?"Active":"Inactive"})},{key:"actions",label:"Actions",render:s=>{const a=s.name.toLowerCase(),l="superadmin"===a||"customer"===a||"subadmin"===a||"agent"===a;return e.jsxs(C,{children:[e.jsx(R,{asChild:!0,children:e.jsxs(r,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",disabled:l,children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(G,{className:"w-4 h-4"})]})}),e.jsxs(A,{align:"end",className:"w-48",children:[e.jsx(E,{children:"Actions"}),e.jsx(k,{}),B(c.ROLES_EDIT)&&!l&&e.jsxs(T,{onClick:e=>{e.stopPropagation(),t(`/admin/roles/edit/${s._id}`)},className:"cursor-pointer",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Edit Role"]}),B(c.ROLES_EDIT)&&!l&&e.jsxs(T,{onClick:e=>{e.stopPropagation(),(async e=>{try{const s=await Y.toggleRoleStatus(e._id);ee(e=>e.map(e=>e._id===s.data.role._id?s.data.role:e)),y({title:"Success",description:`Role ${s.data.role.isActive?"activated":"deactivated"} successfully!`})}catch(s){}})(s)},className:"cursor-pointer",children:[s.isActive?e.jsx(W,{className:"w-4 h-4 mr-2"}):e.jsx(Z,{className:"w-4 h-4 mr-2"}),s.isActive?"Deactivate":"Activate"]}),e.jsx(k,{}),B(c.ROLES_DELETE)&&!l&&e.jsxs(T,{onClick:e=>{e.stopPropagation(),(e=>{fe(e),je(!0)})(s)},className:"text-destructive focus:text-destructive cursor-pointer",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Delete Role"]}),l&&e.jsx("div",{className:"px-2 py-1.5 text-xs text-muted-foreground",children:"Protected system role"})]})]})}}];return se?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(i,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading roles..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:justify-between md:items-center md:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Role Management"}),e.jsx("p",{className:"text-sm md:text-base text-muted-foreground mt-1 md:mt-2",children:"Manage user roles and permissions"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{onClick:async()=>{try{le(!0),await q(),y({title:"Permissions Refreshed",description:"Your permissions have been updated successfully."})}catch(e){y({title:"Refresh Failed",description:"Could not refresh permissions. Please try logging in again.",variant:"destructive"})}finally{le(!1)}},variant:"outline",size:"sm",disabled:te,className:"flex items-center gap-2",children:[e.jsx(n,{className:"h-4 w-4 "+(te?"animate-spin":"")}),te?"Refreshing...":"Refresh Permissions"]}),B(c.ROLES_CREATE)&&e.jsxs(r,{onClick:()=>t("/admin/roles/add"),className:"flex items-center gap-2 w-full md:w-auto",size:"sm",children:[e.jsx(d,{className:"h-4 w-4"}),"Add New Role"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2 md:gap-3",children:[e.jsxs(m,{children:[e.jsx(o,{className:"pb-1 px-2 md:px-6",children:e.jsx(x,{className:"text-xs font-medium text-muted-foreground",children:"Total Roles"})}),e.jsx(u,{className:"pt-1 px-2 md:px-6",children:e.jsx("div",{className:"text-base md:text-lg lg:text-xl font-bold",children:de})})]}),e.jsxs(m,{children:[e.jsx(o,{className:"pb-1 px-2 md:px-6",children:e.jsx(x,{className:"text-xs font-medium text-muted-foreground",children:"Active Roles"})}),e.jsx(u,{className:"pt-1 px-2 md:px-6",children:e.jsx("div",{className:"text-base md:text-lg lg:text-xl font-bold text-green-500",children:X.filter(e=>e.isActive).length})})]}),e.jsxs(m,{children:[e.jsx(o,{className:"pb-1 px-2 md:px-6",children:e.jsx(x,{className:"text-xs font-medium text-muted-foreground",children:"System Roles"})}),e.jsx(u,{className:"pt-1 px-2 md:px-6",children:e.jsx("div",{className:"text-base md:text-lg lg:text-xl font-bold text-blue-500",children:X.filter(e=>e.isSystemRole).length})})]}),e.jsxs(m,{className:"border-destructive/20 bg-destructive/10",children:[e.jsx(o,{className:"pb-1 px-2 md:px-6",children:e.jsxs(x,{className:"text-xs font-medium text-destructive flex items-center gap-1",children:[e.jsx(h,{className:"w-3 h-3"}),"Super Admin"]})}),e.jsx(u,{className:"pt-1 px-2 md:px-6",children:e.jsx("div",{className:"text-base md:text-lg lg:text-xl font-bold text-destructive",children:oe?.userCount||0})})]}),e.jsxs(m,{className:"border-orange-500/20 bg-orange-500/10",children:[e.jsx(o,{className:"pb-1 px-2 md:px-6",children:e.jsxs(x,{className:"text-xs font-medium text-orange-600 flex items-center gap-1",children:[e.jsx(h,{className:"w-3 h-3"}),"Sub Admin"]})}),e.jsx(u,{className:"pt-1 px-2 md:px-6",children:e.jsx("div",{className:"text-base md:text-lg lg:text-xl font-bold text-orange-500",children:ue?.userCount||0})})]})]}),e.jsxs(m,{children:[e.jsxs(o,{className:"pb-4",children:[e.jsx(x,{className:"text-lg md:text-xl",children:"All Roles"}),e.jsxs(p,{className:"text-sm md:text-base",children:[de," role",1!==de?"s":""," found"]})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsx(M,{searchTerm:K,onSearchChange:we,filterValue:J,onFilterChange:Se,filterOptions:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}],filterPlaceholder:"Filter by status"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(F,{columns:Re,data:X.map(e=>({...e,id:e._id})),hideDefaultActions:!0})}),ne>1&&e.jsx("div",{className:"mt-4 md:mt-6",children:e.jsx(D,{children:e.jsxs(P,{className:"flex-wrap gap-1",children:[e.jsx(_,{children:e.jsx(O,{onClick:()=>{ie>1&&re(ie-1)},className:"text-xs md:text-sm "+(1===ie?"pointer-events-none opacity-50":"cursor-pointer")})}),Array.from({length:ne},(e,s)=>s+1).map(s=>e.jsx(_,{children:e.jsx(I,{onClick:()=>(e=>{re(e)})(s),isActive:ie===s,className:"cursor-pointer text-xs md:text-sm",children:s})},s)),e.jsx(_,{children:e.jsx(U,{onClick:()=>{ie<ne&&re(ie+1)},className:"text-xs md:text-sm "+(ie===ne?"pointer-events-none opacity-50":"cursor-pointer")})})]})})})]})]}),e.jsx(j,{open:pe,onOpenChange:je,children:e.jsxs(g,{className:"sm:max-w-[425px] mx-4",children:[e.jsxs(f,{children:[e.jsx(N,{className:"text-base md:text-lg",children:"Delete Role"}),e.jsxs(v,{className:"text-sm md:text-base",children:['Are you sure you want to delete the role "',ge?.name,'"? This action cannot be undone.',ge?.userCount&&ge.userCount>0?e.jsxs("div",{className:"mt-4 p-3 bg-destructive/10 border border-destructive/20 rounded-md",children:[e.jsxs("p",{className:"text-destructive font-semibold text-sm flex items-center gap-2",children:[e.jsx(h,{className:"h-4 w-4"}),"CRITICAL WARNING"]}),e.jsxs("p",{className:"text-destructive text-sm mt-1",children:["This role is currently assigned to ",e.jsxs("span",{className:"font-bold",children:[ge.userCount," user(s)"]}),". Deleting this role will ",e.jsx("span",{className:"font-bold underline",children:"PERMANENTLY DELETE ALL THESE USERS"}),"."]})]}):e.jsx("p",{className:"text-muted-foreground mt-2 text-sm",children:"There are currently no users assigned to this role."})]})]}),e.jsxs(b,{className:"flex flex-col-reverse sm:flex-row gap-2 sm:gap-0",children:[e.jsx(r,{variant:"outline",onClick:()=>{je(!1),fe(null)},disabled:Ne,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(r,{variant:"destructive",onClick:async()=>{if(ge)try{ve(!0),await Y.deleteRole(ge._id),je(!1);const e=ge._id;fe(null),ee(s=>s.filter(s=>s._id!==e)),me(e=>e-1),y({title:"Success",description:"Role deleted successfully!"})}catch(e){}finally{ve(!1)}},disabled:Ne,className:"w-full sm:w-auto",children:Ne?e.jsxs(e.Fragment,{children:[e.jsx(i,{className:"w-4 h-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete Role"})]})]})})]})};export{$ as default};

import{j as e}from"./ui-BNZSgpjP.js";import{d as s,r as a,L as r,R as t}from"./router-D8v2YSKU.js";import{D as l,bY as i,t as d,a3 as o,aO as c,f as n,bX as m,ad as x,a as u,e as h,a1 as p,aj as g,$ as b,I as v,q as f,r as j,s as N,v as y,w,k,B as C,o as S,a9 as F}from"./index-Bb9pk9gg.js";import{f as A}from"./favoriteService-D9HxhIfr.js";import{u as L}from"./use-mobile-C5fBmhy-.js";import"./vendor-BxThA0WO.js";const P=l("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]]),$=()=>{const{isConnected:l}=i(),$=s();L();const[_,T]=a.useState([]),[D,z]=a.useState(null),[B,R]=a.useState(!0),[E,M]=a.useState(""),[q,O]=a.useState("all"),[U,V]=a.useState([]),[W,I]=a.useState([]),X=a.useCallback(async()=>{try{const e=await A.getFavorites();T(e.data.favorites)}catch(e){d({title:"Error",description:"Failed to load favorites",variant:"destructive"})}finally{R(!1)}},[]),Y=a.useCallback(async()=>{try{const e=await A.getFavoriteStats();z(e.data)}catch(e){}},[]),G=a.useCallback(async()=>{try{const e=await o.getAllFilterConfigurations();I(e)}catch(e){}},[]);c("favorite_added",a.useCallback(e=>{X(),Y()},[X,Y])),c("favorite_removed",a.useCallback(e=>{X(),Y()},[X,Y])),a.useEffect(()=>{X(),Y(),G()},[]);const H=e=>{const s=W.find(s=>s.value===e);return s?s.displayLabel||s.name:e.charAt(0).toUpperCase()+e.slice(1)},J=W.filter(e=>"listing_type"===e.filterType||"listingType"===e.filterType).sort((e,s)=>e.displayOrder-s.displayOrder),K=_.filter(e=>{const s=e.property;if(!s)return!1;const a="string"==typeof s.address?s.address:s.address.district?`${s.address.street||""} ${s.address.city||""} ${s.address.district||""} ${s.address.state||""}`.trim():`${s.address.street||""} ${s.address.city||""} ${s.address.state||""}`.trim(),r="string"==typeof s.city?s.city:s.address?.city||"",t=!E||s.title.toLowerCase().includes(E.toLowerCase())||a.toLowerCase().includes(E.toLowerCase())||r.toLowerCase().includes(E.toLowerCase()),l=!q||"all"===q||"available"===q&&"available"===s.status||"sold"===q&&"sold"===s.status||"rented"===q&&"rented"===s.status||"recent"===q&&new Date(e.createdAt)>new Date(Date.now()-6048e5)||s.listingType===q;return t&&l});return B?e.jsx("div",{className:"min-h-screen bg-background p-6 pt-24",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-lg",children:"Loading favorites..."})})})}):e.jsx("div",{className:"min-h-screen bg-background pb-12 pt-20",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Saved Properties"}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:[K.length," properties saved"]})]}),U.length>0&&e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[e.jsxs(n,{variant:"outline",onClick:()=>{U.length<1?d({title:"Select Properties",description:"Please select at least 1 property to compare",variant:"destructive"}):$(`/customer/compare?properties=${U.join(",")}`)},className:"flex-1 md:flex-none",children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"Compare (",U.length,")"]}),e.jsxs(n,{variant:"destructive",onClick:async()=>{try{await Promise.all(U.map(e=>A.removeFromFavorites(e))),V([]),await X(),await Y(),d({title:"Success",description:`${U.length} properties removed from favorites`})}catch(e){d({title:"Error",description:"Failed to remove selected favorites",variant:"destructive"})}},className:"flex-1 md:flex-none",children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"Remove (",U.length,")"]})]})]}),D&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(u,{className:"border-none shadow-sm bg-card",children:e.jsxs(h,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 rounded-full",children:e.jsx(p,{className:"w-6 h-6 text-red-500 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:"Total Saved"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:D.totalFavorites})]})]})}),e.jsx(u,{className:"border-none shadow-sm bg-card",children:e.jsxs(h,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-full",children:e.jsx(P,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:"Average Price"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:D?.avgPrice?A.formatPrice(D.avgPrice):"â‚¹0"})]})]})}),e.jsx(u,{className:"border-none shadow-sm bg-card",children:e.jsxs(h,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-full",children:e.jsx(g,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:"Available Now"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:D?.availableProperties||0})]})]})})]}),e.jsxs("div",{className:"bg-card p-4 rounded-xl shadow-sm border border-border flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(b,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(v,{placeholder:"Search by location, title...",value:E,onChange:e=>M(e.target.value),className:"pl-9 border-input bg-background"})]}),e.jsxs("div",{className:"flex gap-2",children:[K.length>0&&e.jsx(n,{variant:"outline",onClick:()=>{U.length===K.length?V([]):V(K.map(e=>e.property._id))},className:"whitespace-nowrap",children:U.length===K.length?"Deselect All":"Select All"}),e.jsxs(f,{value:q,onValueChange:O,children:[e.jsx(j,{className:"w-[180px]",children:e.jsx(N,{placeholder:"Filter by status"})}),e.jsxs(y,{children:[e.jsx(w,{value:"all",children:"All Properties"}),e.jsx(w,{value:"available",children:"Available"}),e.jsx(w,{value:"sold",children:"Sold"}),e.jsx(w,{value:"rented",children:"Rented"}),e.jsx(w,{value:"recent",children:"Recently Added"}),J.map(s=>e.jsx(w,{value:s.value,children:s.displayLabel||s.name},s.value))]})]})]})]}),K.length>0&&0===U.length&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-900/50 rounded-lg p-3 flex items-center gap-2 text-sm text-blue-700 dark:text-blue-400",children:[e.jsx(m,{className:"w-4 h-4"}),e.jsx("span",{children:"Select multiple properties to compare them side-by-side."})]}),0===K.length?e.jsxs("div",{className:"text-center py-20 bg-card rounded-xl border border-dashed border-border",children:[e.jsx(p,{className:"w-12 h-12 text-muted-foreground/30 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-1",children:"No saved properties"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:E||"all"!==q?"No properties match your filters.":"Start exploring and save properties you like!"}),e.jsx(r,{to:"/customer/search",children:e.jsxs(n,{children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Browse Properties"]})})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:K.map(s=>{const a=s.property;if(!a)return null;const r=A.getPropertyStatusBadge(a),l=a.images&&a.images.length>0?"string"==typeof a.images[0]?a.images[0]:a.images[0].url:null;return e.jsxs(u,{className:"group overflow-hidden border-none shadow-sm hover:shadow-md transition-all duration-300 "+(U.includes(a._id)?"ring-2 ring-primary":""),children:[e.jsxs("div",{className:"relative aspect-[4/3] bg-muted overflow-hidden",children:[l?e.jsx("img",{src:l,alt:a.title,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:e.jsx(k,{className:"w-8 h-8 opacity-20"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-60"}),e.jsxs("div",{className:"absolute bottom-3 left-3 text-white",children:[e.jsx("p",{className:"text-xl font-bold",children:A.formatPrice(a.price)}),e.jsx("p",{className:"text-xs text-white/80",children:"rent"===a.listingType?"/ month":"onwards"})]})]}),e.jsxs(h,{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx(C,{className:("default"===r.variant?"bg-green-500":"bg-gray-500")+" border-0",children:r.label}),e.jsx(C,{className:"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-400 border-blue-100 dark:border-blue-900/50 capitalize",children:H(a.listingType).toLowerCase().startsWith("for ")?H(a.listingType):`For ${H(a.listingType)}`}),e.jsx(C,{variant:"outline",className:"border-border text-muted-foreground capitalize",children:a.type})]}),e.jsx("h3",{className:"font-semibold text-lg text-foreground line-clamp-1 mb-1",children:a.title}),e.jsxs("div",{className:"flex items-center text-muted-foreground text-sm",children:[e.jsx(k,{className:"w-3.5 h-3.5 mr-1 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:"string"==typeof a.address?a.address:a.address?.city||"Location N/A"})]})]}),(()=>{const s=a.area&&"object"==typeof a.area?a.area.builtUp||a.area.plot||a.area.carpet:null,r=a.area&&"object"==typeof a.area&&a.area.unit||"sq ft",l=[];return void 0!==a.bedrooms&&null!==a.bedrooms&&a.bedrooms>0&&l.push({label:"Bed",value:a.bedrooms}),void 0!==a.bathrooms&&null!==a.bathrooms&&a.bathrooms>0&&l.push({label:"Bath",value:a.bathrooms}),s&&l.push({label:"Area",value:`${s} ${r}`}),0===l.length?null:e.jsx("div",{className:"flex items-center justify-between py-3 border-t border-b border-border",children:l.map((s,a)=>e.jsxs(t.Fragment,{children:[e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:s.label}),e.jsx("p",{className:"font-semibold text-foreground",children:s.value})]}),a<l.length-1&&e.jsx("div",{className:"w-px h-8 bg-border"})]},s.label))})})(),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(n,{size:"sm",className:"w-full",onClick:()=>$(`/customer/property/${a._id}`),children:"View Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(n,{variant:U.includes(a._id)?"secondary":"outline",size:"sm",className:"w-full "+(U.includes(a._id)?"bg-primary/10 text-primary hover:bg-primary/20 border-primary/20":""),onClick:()=>{return e=a._id,void V(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]);var e},children:U.includes(a._id)?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Selected"]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Compare"]})}),e.jsxs(n,{variant:"outline",size:"sm",className:"w-full text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20 border-red-100 dark:border-red-900/50",onClick:()=>(async e=>{try{await A.removeFromFavorites(e),await X(),await Y(),d({title:"Success",description:"Property removed from favorites"})}catch(s){d({title:"Error",description:"Failed to remove from favorites",variant:"destructive"})}})(a._id),children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"Remove"]})]})]}),(()=>{const s=a,r=s.approvedAt||s.createdAt;return!r||isNaN(new Date(r).getTime())?null:e.jsxs("div",{className:"text-xs text-center text-muted-foreground pt-1",children:["Listed ",new Date(r).toLocaleDateString()]})})()]})]},s._id)})})]})})};export{$ as default};

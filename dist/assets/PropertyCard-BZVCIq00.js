import{j as e}from"./ui-BNZSgpjP.js";import{r as t,d as s}from"./router-D8v2YSKU.js";import{G as r,aj as a,q as i,r as n,s as l,v as o,w as c,f as d,a3 as p,l as m,$ as u,I as x,u as h,aL as g,a as y,bN as f,a1 as j,e as v,B as b,k as N,bP as w,bQ as T,bT as _,am as C,y as S}from"./index-CM8T-gRV.js";import{a as F}from"./propertyUtils-41DuwCMc.js";import{P as L,a as $}from"./PropertyContactDialog-CXo5f0st.js";import{E as P}from"./EnterprisePropertyContactDialog-CvASOWLo.js";import{vendorService as k}from"./vendorService-577ZLDKP.js";import{f as E}from"./favoriteService-BJOMEB2d.js";import{S as V}from"./square-Yal29bIt.js";import{T as A}from"./thumbs-up-T66Abj6s.js";const O=({value:s,onChange:a})=>{const[i,n]=t.useState(s||""),[l,o]=t.useState([]),[c,d]=t.useState(!1),[p,h]=t.useState(!1),[g,y]=t.useState(m.isReady()),f=t.useRef(null);t.useEffect(()=>{m.initialize().then(()=>y(!0))},[]),t.useEffect(()=>{void 0!==s&&n(s)},[s]),t.useEffect(()=>{const e=e=>{f.current&&!f.current.contains(e.target)&&d(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);return e.jsxs("div",{ref:f,className:"relative w-[200px]",children:[e.jsxs("div",{className:"relative",children:[e.jsx(u,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(x,{placeholder:g?"Search Location...":"Loading...",value:i,onChange:e=>{const t=e.target.value;if(n(t),t.length<2)return o([]),void d(!1);h(!0),setTimeout(()=>{const e=m.searchLocations(t);o(e),h(!1),d(!0)},100)},className:"pl-8 bg-background",disabled:!g,onFocus:()=>{i.length>=2&&d(!0)},onKeyDown:e=>{"Enter"===e.key&&(a(i),d(!1))}}),p&&e.jsx("div",{className:"absolute right-2 top-2.5",children:e.jsx(r,{className:"h-4 w-4 animate-spin text-muted-foreground"})})]}),c&&e.jsx("div",{className:"absolute z-[100] w-full mt-1 bg-popover border rounded-md shadow-md max-h-[200px] overflow-y-auto",children:l.length>0?l.map((t,s)=>e.jsxs("div",{className:"px-3 py-2 text-sm cursor-pointer hover:bg-accent hover:text-accent-foreground border-b last:border-0",onClick:()=>(e=>{const t=`${e.city}, ${e.district}, ${e.state}`;n(t),a(t),d(!1)})(t),children:[e.jsx("div",{className:"font-medium",children:t.city}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.district,", ",t.state]})]},`${t.pincode}-${s}`)):e.jsx("div",{className:"px-3 py-2 text-sm text-muted-foreground text-center",children:"No locations found"})})]})},z=({onFilterChange:s,initialFilters:m})=>{const[u,x]=t.useState({}),[h,g]=t.useState([]),[y,f]=t.useState([]),[j,v]=t.useState([]),[b,N]=t.useState(!0);t.useEffect(()=>{(async()=>{try{N(!0);const[e,t,s]=await Promise.all([p.getAllFilterConfigurations(!1).catch(e=>[]),p.getFilterDependencies().catch(e=>[]),p.getFilterOptionVisibility().catch(e=>[])]);g(e),f(t),v(s)}catch(e){}finally{N(!1)}})()},[]),t.useEffect(()=>{m&&x(m)},[m]);const w=(e,t)=>{let r={...u,[e]:"all"===t||"any"===t||"any-budget"===t?void 0:t};if("budget"===e){if("any-budget"===t)r.minPrice=void 0,r.maxPrice=void 0;else{const e=h.find(e=>(e.id||e._id)===t);e&&(r.minPrice=e.minValue,r.maxPrice=e.maxValue)}delete r.budget}const a=(e,t)=>{const s=y.find(t=>t.targetFilterType===e);if(!s)return!0;let r;return r="property_type"===s.sourceFilterType?t.propertyType:"listing_type"===s.sourceFilterType?t.listingType:t[s.sourceFilterType],!(!r||"all"===r||"any"===r||"any-budget"===r)&&s.sourceFilterValues.some(e=>String(e).toLowerCase()===String(r).toLowerCase())},i=(e,t,s)=>{const r=j.filter(s=>s.filterType===e&&s.optionValue===t);return 0===r.length||r.some(e=>{let t;return t="property_type"===e.sourceFilterType?s.propertyType:"listing_type"===e.sourceFilterType?s.listingType:s[e.sourceFilterType],!t||"all"===t||"any"===t||"any-budget"===t||e.sourceFilterValues.some(e=>String(e).toLowerCase()===String(t).toLowerCase())})},n=T();for(const s of n){if(s===e||"property_type"===s&&"propertyType"===e)continue;const t=r[s];if(void 0!==t){const e=a(s,r),n=i(s,t,r);e&&n||(r[s]=void 0,"budget"===s&&(r.minPrice=void 0,r.maxPrice=void 0))}}x(r),s(r)},T=()=>{const e=Array.from(new Set(h.map(e=>e.filterType))),t=["location","listing_type","property_type"];return e.sort((e,s)=>{const r=t.includes(e),a=t.includes(s);return r&&!a?-1:!r&&a?1:r&&a?t.indexOf(e)-t.indexOf(s):e.localeCompare(s)})};if(b)return e.jsx("div",{className:"bg-card border border-border rounded-xl p-4 shadow-[var(--shadow-soft)]",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 py-2",children:[e.jsx(r,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{className:"text-muted-foreground",children:"Loading filters..."})]})});const _=T();return e.jsx("div",{className:"bg-card border border-border rounded-xl p-4 shadow-[var(--shadow-soft)]",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(a,{className:"h-5 w-5"}),e.jsx("span",{children:"Filters:"})]}),e.jsx(O,{value:u.location,onChange:e=>w("location",e)}),_.filter(e=>(e=>{const t=y.find(t=>t.targetFilterType===e);if(!t)return!0;let s;return s="property_type"===t.sourceFilterType?u.propertyType:"listing_type"===t.sourceFilterType?u.listingType:u[t.sourceFilterType],!(!s||"all"===s||"any"===s||"any-budget"===s)&&t.sourceFilterValues.some(e=>String(e).toLowerCase()===String(s).toLowerCase())})(e)&&"location"!==e).map(t=>{const s=(r=t,h.filter(e=>e.filterType===r).sort((e,t)=>e.displayOrder-t.displayOrder));var r;if(0===s.length)return null;const a=t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),d=u["listing_type"===t?"listingType":"property_type"===t?"propertyType":t]||("budget"===t?"any-budget":"any");return e.jsxs(i,{value:d,onValueChange:e=>{w("listing_type"===t?"listingType":"property_type"===t?"propertyType":t,e)},children:[e.jsx(n,{className:"w-[150px]",children:e.jsx(l,{placeholder:a})}),e.jsxs(o,{children:[e.jsxs(c,{value:"budget"===t?"any-budget":"any",children:["Any ",a]}),s.filter(e=>((e,t)=>{const s=j.filter(s=>s.filterType===e&&s.optionValue===t);return 0===s.length||s.some(e=>{let t;return t="property_type"===e.sourceFilterType?u.propertyType:"listing_type"===e.sourceFilterType?u.listingType:u[e.sourceFilterType],!t||"all"===t||"any"===t||"any-budget"===t||e.sourceFilterValues.some(e=>String(e).toLowerCase()===String(t).toLowerCase())})})(t,e.value)).map(s=>e.jsx(c,{value:"budget"===t?s.id||s._id:s.value,children:e.jsx("span",{children:s.displayLabel||s.name})},s.id||s._id))]})]},t)}),e.jsx(d,{variant:"secondary",className:"ml-auto",onClick:()=>{x({}),s({})},children:"Reset Filters"})]})})},D=({property:r})=>{const a=s(),{isAuthenticated:i,user:n,isVendor:l,isCustomer:o}=h(),[c,m]=t.useState(!1),[u,x]=t.useState(!1),[O,z]=t.useState(!1),[D,I]=t.useState(!1),[R,U]=t.useState(null),[B,M]=t.useState(!0),[W,q]=t.useState(!1),[K,Q]=t.useState(!1),[G,H]=t.useState([]),J=g.getPrimaryImage(r),X=g.formatPrice(r.price,r.listingType),Y=g.formatArea(r.area),Z=r.address.district?`${r.address.city}, ${r.address.district}, ${r.address.state}`:`${r.address.city}, ${r.address.state}`;t.useEffect(()=>{(async()=>{try{const e=await p.getAllFilterConfigurations();H(e)}catch(e){}})()},[]),t.useEffect(()=>{(async()=>{if(r.vendor?._id||r.owner?._id)try{M(!0);const e=r.vendor?._id||r.owner?._id,t=await k.checkVendorWhatsAppSupport(e);I(t.whatsappEnabled),U(t.whatsappNumber)}catch(e){I(!1),U(null)}finally{M(!1)}else M(!1)})()},[r.vendor?._id,r.owner?._id]),t.useEffect(()=>{(async()=>{if(i&&o)try{const e=await E.isFavorite(r._id);q(e)}catch(e){}})()},[i,o,r._id]);const ee=e=>{const t=G.find(t=>t.value===e&&("listing_type"===t.filterType||"listingType"===t.filterType));return t?t.displayLabel||t.name:e.charAt(0).toUpperCase()+e.slice(1)};return e.jsxs(y,{className:"group overflow-hidden hover:shadow-[var(--shadow-large)] transition-all duration-300 flex flex-col h-full",children:[e.jsxs("div",{className:"relative h-44 md:h-48 overflow-hidden",children:[e.jsx("img",{src:J,alt:r.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",onError:e=>{e.target.src=f}}),i&&o&&e.jsx(d,{size:"icon",variant:"ghost",className:"absolute top-3 right-3 bg-background/80 backdrop-blur hover:bg-background "+(W?"text-red-500":""),onClick:async e=>{if(e.stopPropagation(),i){if(!K)try{Q(!0),W?(await E.removeFromFavorites(r._id),q(!1)):(await E.addToFavorites(r._id),q(!0))}catch(t){}finally{Q(!1)}}else a("/login",{state:{from:`/property/${r._id}`,action:"favorite"}})},disabled:K,children:e.jsx(j,{className:"h-5 w-5 "+(W?"fill-current":"")})})]}),e.jsxs(v,{className:"p-3 flex-1",children:[e.jsxs("div",{className:"flex flex-col gap-2 mb-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(b,{className:("available"===r.status?"bg-green-500":"sold"===r.status?"bg-red-500":"rented"===r.status?"bg-blue-500":"bg-yellow-500")+" text-white border-0",children:r.status.charAt(0).toUpperCase()+r.status.slice(1)}),e.jsx(b,{className:"bg-blue-50 text-blue-700 border-blue-100 capitalize",children:ee(r.listingType).toLowerCase().startsWith("for ")?ee(r.listingType):`For ${ee(r.listingType)}`}),r.featured&&e.jsx(b,{className:"bg-accent text-accent-foreground border-0",children:"Featured"}),r.verified&&e.jsx(b,{className:"bg-green-600 text-white border-0",children:"Verified"})]}),e.jsx("h3",{className:"font-semibold text-base md:text-lg line-clamp-2",children:r.title})]}),e.jsxs("div",{className:"flex items-center text-muted-foreground mb-2",children:[e.jsx(N,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-sm line-clamp-1",children:Z})]}),e.jsx("div",{className:"text-sm text-muted-foreground mb-2 capitalize",children:r.type?r.type.replace("_"," "):"property"}),e.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:F(r)}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[r.bedrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsxs("span",{children:[r.bedrooms," BHK"]})]}),r.bathrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsxs("span",{children:[r.bathrooms," Bath"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{children:Y})]})]}),e.jsx("div",{className:"text-xl md:text-2xl font-bold text-primary",children:X}),r.amenities.length>0&&e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[r.amenities.slice(0,3).map((t,s)=>e.jsx(b,{variant:"outline",className:"text-xs",children:t},s)),r.amenities.length>3&&e.jsxs(b,{variant:"outline",className:"text-xs",children:["+",r.amenities.length-3," more"]})]})]}),e.jsxs(_,{className:"p-2 pt-0 flex gap-1 text-xs",children:[!B&&!D&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{variant:"outline",className:"flex-1 h-8 px-1",onClick:()=>{i?D?z(!0):m(!0):a("/login",{state:{from:`/property/${r._id}`,action:"message"}})},title:"Message",children:[e.jsx(C,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"truncate",children:"Message"})]}),e.jsxs(d,{variant:"outline",className:"flex-1 h-8 px-1",onClick:()=>{i?D?z(!0):x(!0):a("/login",{state:{from:`/property/${r._id}`,action:"contact"}})},title:"Contact",children:[e.jsx(S,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"truncate",children:"Contact"})]}),i&&o&&e.jsxs(d,{variant:"outline",className:"flex-1 h-8 px-1",onClick:async e=>{if(e.stopPropagation(),i)try{await g.registerInterest(r._id)}catch(t){}else a("/login",{state:{from:`/property/${r._id}`,action:"interest"}})},title:"Interest",children:[e.jsx(A,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"truncate",children:"Interest"})]})]}),!B&&D&&e.jsxs(d,{variant:"outline",className:"flex-1 bg-green-50 hover:bg-green-100 text-green-700 border-green-200 py-2",onClick:()=>z(!0),children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"WhatsApp Contact"]}),e.jsx(d,{className:"flex-1 py-2",onClick:()=>{i&&l&&(r.owner?._id===n?.id||r.vendor?._id===n?.id)?a(`/vendor/properties/details/${r._id}`):a(`/property/${r._id}`)},children:"View Details"})]}),e.jsx(L,{open:c,onOpenChange:m,property:r,onMessageSent:()=>{}}),e.jsx($,{open:u,onOpenChange:x,property:r}),e.jsx(P,{open:O,onOpenChange:z,property:r,whatsappNumber:R})]})};export{z as P,D as a};

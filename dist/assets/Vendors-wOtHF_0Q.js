import{j as e}from"./ui-BNZSgpjP.js";import{u as s,a2 as a,aC as t,z as l,G as n,a as r,b as i,c as d,O as c,e as o,h as x,U as m,C as p,_ as j,d as h,$ as u,I as v,q as f,r as N,s as w,v as g,w as b,f as y,E as A,B as R,Z as S}from"./index-R8qjqeWQ.js";import{d as V,r as E}from"./router-D8v2YSKU.js";import{T as C,a as P,b as _,c as D,d as $,e as I}from"./table-Q97hrLvE.js";import"./vendor-BxThA0WO.js";const O="https://app.buildhomemartsquares.com/api",T=()=>{const{user:T}=s(),U=V(),{toast:B}=a(),k=T?.rolePermissions||[],[z,L]=E.useState(!0),[q,F]=E.useState({total:0,pending:0,approved:0,rejected:0,underReview:0}),[M,W]=E.useState([]),[G,Y]=E.useState(""),[Z,H]=E.useState("all"),J=t(G,500),K=e=>k.includes(e);E.useEffect(()=>{K(S.VENDORS_VIEW)?Q():U("/rolebased")},[k,J,Z]);const Q=async()=>{try{L(!0);await l.getCurrentUser();const e=localStorage.getItem("token"),s=await fetch(`${O}/admin/vendor-approval-stats`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(s.ok){const e=(await s.json()).data.overview;F({total:e.totalApplications||0,pending:e.pendingApplications||0,approved:e.approvedApplications||0,rejected:e.rejectedApplications||0,underReview:e.underReviewApplications||0})}const a=new URLSearchParams({limit:"50",status:Z,search:J}),t=await fetch(`${O}/admin/vendor-approvals?${a}`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(t.ok){const e=await t.json();W(e.data.vendors||[])}}catch(e){B({title:"Error",description:"Failed to load vendor data",variant:"destructive"})}finally{L(!1)}},X=s=>{const a={pending:{variant:"outline",label:"Pending"},under_review:{variant:"secondary",label:"Under Review"},approved:{variant:"default",label:"Approved"},rejected:{variant:"destructive",label:"Rejected"}},t=a[s]||a.pending;return e.jsx(R,{variant:t.variant,children:t.label})};return K(S.VENDORS_VIEW)?z?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(n,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading vendor data..."})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Vendor Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage vendor applications and approvals"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs(r,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Total Applications"}),e.jsx(c,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:q.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total vendor applications"})]})]}),e.jsxs(r,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Pending Approvals"}),e.jsx(x,{className:"h-4 w-4 text-yellow-600"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:q.pending}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Awaiting review"})]})]}),e.jsxs(r,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Under Review"}),e.jsx(m,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:q.underReview}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Being reviewed"})]})]}),e.jsxs(r,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Approved Vendors"}),e.jsx(p,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:q.approved}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active vendors"})]})]}),e.jsxs(r,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Rejected"}),e.jsx(j,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:q.rejected}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Declined applications"})]})]})]}),e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsx(d,{children:"Vendor Applications"}),e.jsx(h,{children:"View and manage vendor applications"})]}),e.jsxs(o,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(u,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(v,{placeholder:"Search vendors...",value:G,onChange:e=>Y(e.target.value),className:"pl-8"})]}),e.jsxs(f,{value:Z,onValueChange:H,children:[e.jsx(N,{className:"w-[180px]",children:e.jsx(w,{placeholder:"Filter by status"})}),e.jsxs(g,{children:[e.jsx(b,{value:"all",children:"All Status"}),e.jsx(b,{value:"pending",children:"Pending"}),e.jsx(b,{value:"approved",children:"Approved"}),e.jsx(b,{value:"rejected",children:"Rejected"}),e.jsx(b,{value:"under_review",children:"Under Review"})]})]})]}),0===M.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(c,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"No Vendor Applications"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"There are no vendor applications at the moment"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-4",children:["Your permissions: ",K(S.VENDORS_APPROVE)?"View & Approve":"View Only"]})]}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(C,{children:[e.jsx(P,{children:e.jsxs(_,{children:[e.jsx(D,{children:"S.no"}),e.jsx(D,{children:"Business Name"}),e.jsx(D,{children:"Contact Person"}),e.jsx(D,{children:"Email"}),e.jsx(D,{children:"Phone"}),e.jsx(D,{children:"Status"}),e.jsx(D,{children:"Submitted"}),e.jsx(D,{children:"Action"})]})}),e.jsx($,{children:M.map((s,a)=>e.jsxs(_,{children:[e.jsx(I,{children:a+1}),e.jsx(I,{className:"font-medium",children:s.businessInfo?.companyName||"N/A"}),e.jsxs(I,{children:[s.user?.profile?.firstName," ",s.user?.profile?.lastName]}),e.jsx(I,{children:s.user?.email}),e.jsx(I,{children:s.user?.profile?.phone||"N/A"}),e.jsx(I,{children:X(s.approval?.status)}),e.jsx(I,{children:new Date(s.approval?.submittedAt).toLocaleDateString()}),e.jsx(I,{children:e.jsxs(y,{variant:"ghost",size:"sm",onClick:()=>U(`/rolebased/vendor-details?vendorId=${s._id}`),children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"View Details"]})})]},s._id))})]})})]})]})]}):null};export{T as default};

import{j as e}from"./ui-BNZSgpjP.js";import{d as s,r as a}from"./router-D8v2YSKU.js";import{D as t,u as l,aC as i,G as r,f as n,al as c,Z as d,a9 as m,a as o,b as x,c as u,e as h,S as p,d as j,a4 as g,a5 as N,a6 as f,a7 as v,a8 as b,ae as y,t as w,U as S,B as C,aD as R,aE as A,aF as E,aG as k,aH as L,aI as T,ad as D}from"./index-R8qjqeWQ.js";import{P,a as _,b as O,c as I,d as F,e as U}from"./pagination-CDmDFSy4.js";import{D as z}from"./DataTable-D-c-Y6Rr.js";import{u as G,S as M}from"./usePermissions-OcAyMMGf.js";import{r as H}from"./roleService-BZ8bOqdJ.js";import{E as Y}from"./ellipsis-7IUryYA9.js";import{S as $}from"./square-pen-DcWautNu.js";import"./vendor-BxThA0WO.js";import"./table-Q97hrLvE.js";const q=t("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]),B=t("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),V=()=>{const t=s(),{isSuperAdmin:V,refreshUser:W}=l(),{hasPermission:Z}=G(),[J,K]=a.useState(""),[Q,X]=a.useState("all"),[ee,se]=a.useState([]),[ae,te]=a.useState(!0),[le,ie]=a.useState(!1),[re,ne]=a.useState(!1),[ce,de]=a.useState(1),[me,oe]=a.useState(1),[xe,ue]=a.useState(0),[he,pe]=a.useState(null),[je,ge]=a.useState(null),[Ne,fe]=a.useState(!1),[ve,be]=a.useState(null),[ye,we]=a.useState(!1),Se=i(J,500),Ce=a.useCallback(async()=>{try{ae||ie(!0);const e={page:ce,limit:10,search:Se||void 0,isActive:"all"===Q?void 0:"active"===Q},s=await H.getRoles(e),a=s.data.roles.map(e=>({...e,pages:e.pages||[]})),t=["superadmin","subadmin","agent","vendor","customer"],l=a.sort((e,s)=>{const a=e.name.toLowerCase(),l=s.name.toLowerCase(),i=t.indexOf(a),r=t.indexOf(l);return-1!==i&&-1!==r?i-r:-1!==i?-1:-1!==r?1:a.localeCompare(l)}).filter(e=>"superadmin"!==e.name.toLowerCase());se(l),oe(s.data.pagination.totalPages),ue(s.data.pagination.totalRoles);const i=a.find(e=>"superadmin"===e.name.toLowerCase()),r=a.find(e=>"subadmin"===e.name.toLowerCase());pe(i||null),ge(r||null)}catch(e){}finally{te(!1),ie(!1)}},[ce,Se,Q]);a.useEffect(()=>{Ce()},[Ce]);const Re=a.useCallback(e=>{X(e),de(1)},[]),Ae=s=>{const a=s.name.toLowerCase();return"superadmin"===a?e.jsxs(C,{variant:"destructive",className:"text-xs",children:[e.jsx(p,{className:"w-3 h-3 mr-1"}),"Super Admin"]}):"subadmin"===a?e.jsxs(C,{variant:"default",className:"text-xs bg-orange-500 hover:bg-orange-500/80",children:[e.jsx(p,{className:"w-3 h-3 mr-1"}),"Sub Admin"]}):s.isSystemRole?e.jsxs(C,{variant:"outline",className:"text-xs",children:[e.jsx(p,{className:"w-3 h-3 mr-1"}),"System"]}):null},Ee=[{key:"sNo",label:"S.no",render:s=>e.jsx("span",{className:"font-medium",children:s.sNo})},{key:"name",label:"Role Name",render:s=>e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[s.name.charAt(0).toUpperCase()+s.name.slice(1),Ae(s)]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description})]})},{key:"userCount",label:"Users",render:s=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:s.userCount||0})]})},{key:"isActive",label:"Status",render:s=>e.jsx(C,{variant:s.isActive?"default":"secondary",children:s.isActive?"Active":"Inactive"})},{key:"actions",label:"Actions",render:s=>{const a=s.name.toLowerCase(),l="superadmin"===a||"customer"===a||"subadmin"===a||"agent"===a;return e.jsxs(R,{children:[e.jsx(A,{asChild:!0,children:e.jsxs(n,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",disabled:l,children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Y,{className:"w-4 h-4"})]})}),e.jsxs(E,{align:"end",className:"w-48",children:[e.jsx(k,{children:"Actions"}),e.jsx(L,{}),Z(d.ROLES_EDIT)&&!l&&e.jsxs(T,{onClick:e=>{e.stopPropagation(),t(`/admin/roles/edit/${s._id}`)},className:"cursor-pointer",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Edit Role"]}),Z(d.ROLES_EDIT)&&!l&&e.jsxs(T,{onClick:e=>{e.stopPropagation(),(async e=>{try{const s=await H.toggleRoleStatus(e._id);se(e=>e.map(e=>e._id===s.data.role._id?s.data.role:e)),w({title:"Success",description:`Role ${s.data.role.isActive?"activated":"deactivated"} successfully!`})}catch(s){}})(s)},className:"cursor-pointer",children:[s.isActive?e.jsx(q,{className:"w-4 h-4 mr-2"}):e.jsx(B,{className:"w-4 h-4 mr-2"}),s.isActive?"Deactivate":"Activate"]}),e.jsx(L,{}),Z(d.ROLES_DELETE)&&!l&&e.jsxs(T,{onClick:e=>{e.stopPropagation(),(e=>{be(e),fe(!0)})(s)},className:"text-destructive focus:text-destructive cursor-pointer",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Delete Role"]}),l&&e.jsx("div",{className:"px-2 py-1.5 text-xs text-muted-foreground",children:"Protected system role"})]})]})}}];return ae?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(r,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading roles..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:justify-between md:items-center md:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Role Management"}),e.jsx("p",{className:"text-sm md:text-base text-muted-foreground mt-1 md:mt-2",children:"Manage user roles and permissions"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{onClick:async()=>{try{ne(!0),await W(),w({title:"Permissions Refreshed",description:"Your permissions have been updated successfully."})}catch(e){w({title:"Refresh Failed",description:"Could not refresh permissions. Please try logging in again.",variant:"destructive"})}finally{ne(!1)}},variant:"outline",size:"sm",disabled:re,className:"flex items-center gap-2",children:[e.jsx(c,{className:"h-4 w-4 "+(re?"animate-spin":"")}),re?"Refreshing...":"Refresh Permissions"]}),Z(d.ROLES_CREATE)&&e.jsxs(n,{onClick:()=>t("/admin/roles/add"),className:"flex items-center gap-2 w-full md:w-auto",size:"sm",children:[e.jsx(m,{className:"h-4 w-4"}),"Add New Role"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2 md:gap-3",children:[e.jsxs(o,{children:[e.jsx(x,{className:"pb-1 px-2 md:px-6",children:e.jsx(u,{className:"text-xs font-medium text-muted-foreground",children:"Total Roles"})}),e.jsx(h,{className:"pt-1 px-2 md:px-6",children:e.jsx("div",{className:"text-base md:text-lg lg:text-xl font-bold",children:xe})})]}),e.jsxs(o,{children:[e.jsx(x,{className:"pb-1 px-2 md:px-6",children:e.jsx(u,{className:"text-xs font-medium text-muted-foreground",children:"Active Roles"})}),e.jsx(h,{className:"pt-1 px-2 md:px-6",children:e.jsx("div",{className:"text-base md:text-lg lg:text-xl font-bold text-green-500",children:ee.filter(e=>e.isActive).length})})]}),e.jsxs(o,{children:[e.jsx(x,{className:"pb-1 px-2 md:px-6",children:e.jsx(u,{className:"text-xs font-medium text-muted-foreground",children:"System Roles"})}),e.jsx(h,{className:"pt-1 px-2 md:px-6",children:e.jsx("div",{className:"text-base md:text-lg lg:text-xl font-bold text-blue-500",children:ee.filter(e=>e.isSystemRole).length})})]}),e.jsxs(o,{className:"border-destructive/20 bg-destructive/10",children:[e.jsx(x,{className:"pb-1 px-2 md:px-6",children:e.jsxs(u,{className:"text-xs font-medium text-destructive flex items-center gap-1",children:[e.jsx(p,{className:"w-3 h-3"}),"Super Admin"]})}),e.jsx(h,{className:"pt-1 px-2 md:px-6",children:e.jsx("div",{className:"text-base md:text-lg lg:text-xl font-bold text-destructive",children:he?.userCount||0})})]}),e.jsxs(o,{className:"border-orange-500/20 bg-orange-500/10",children:[e.jsx(x,{className:"pb-1 px-2 md:px-6",children:e.jsxs(u,{className:"text-xs font-medium text-orange-600 flex items-center gap-1",children:[e.jsx(p,{className:"w-3 h-3"}),"Sub Admin"]})}),e.jsx(h,{className:"pt-1 px-2 md:px-6",children:e.jsx("div",{className:"text-base md:text-lg lg:text-xl font-bold text-orange-500",children:je?.userCount||0})})]})]}),e.jsxs(o,{children:[e.jsxs(x,{className:"pb-4",children:[e.jsx(u,{className:"text-lg md:text-xl",children:"All Roles"}),e.jsxs(j,{className:"text-sm md:text-base",children:[xe," role",1!==xe?"s":""," found"]})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsx(M,{searchTerm:J,onSearchChange:e=>{K(e),de(1)},filterValue:Q,onFilterChange:Re,filterOptions:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}],filterPlaceholder:"Filter by status"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(z,{columns:Ee,data:ee.map((e,s)=>({...e,id:e._id,sNo:10*(ce-1)+s+1})),hideDefaultActions:!0})}),me>1&&e.jsx("div",{className:"mt-4 md:mt-6",children:e.jsx(P,{children:e.jsxs(_,{className:"flex-wrap gap-1",children:[e.jsx(O,{children:e.jsx(I,{onClick:()=>{ce>1&&de(ce-1)},className:"text-xs md:text-sm "+(1===ce?"pointer-events-none opacity-50":"cursor-pointer")})}),Array.from({length:me},(e,s)=>s+1).map(s=>e.jsx(O,{children:e.jsx(F,{onClick:()=>(e=>{de(e)})(s),isActive:ce===s,className:"cursor-pointer text-xs md:text-sm",children:s})},s)),e.jsx(O,{children:e.jsx(U,{onClick:()=>{ce<me&&de(ce+1)},className:"text-xs md:text-sm "+(ce===me?"pointer-events-none opacity-50":"cursor-pointer")})})]})})})]})]}),e.jsx(g,{open:Ne,onOpenChange:fe,children:e.jsxs(N,{className:"sm:max-w-[425px] mx-4",children:[e.jsxs(f,{children:[e.jsx(v,{className:"text-base md:text-lg",children:"Delete Role"}),e.jsxs(b,{className:"text-sm md:text-base",children:['Are you sure you want to delete the role "',ve?.name,'"? This action cannot be undone.',ve?.userCount&&ve.userCount>0?e.jsxs("div",{className:"mt-4 p-3 bg-destructive/10 border border-destructive/20 rounded-md",children:[e.jsxs("p",{className:"text-destructive font-semibold text-sm flex items-center gap-2",children:[e.jsx(p,{className:"h-4 w-4"}),"CRITICAL WARNING"]}),e.jsxs("p",{className:"text-destructive text-sm mt-1",children:["This role is currently assigned to ",e.jsxs("span",{className:"font-bold",children:[ve.userCount," user(s)"]}),". Deleting this role will ",e.jsx("span",{className:"font-bold underline",children:"PERMANENTLY DELETE ALL THESE USERS"}),"."]})]}):e.jsx("p",{className:"text-muted-foreground mt-2 text-sm",children:"There are currently no users assigned to this role."})]})]}),e.jsxs(y,{className:"flex flex-col-reverse sm:flex-row gap-2 sm:gap-0",children:[e.jsx(n,{variant:"outline",onClick:()=>{fe(!1),be(null)},disabled:ye,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(n,{variant:"destructive",onClick:async()=>{if(ve)try{we(!0),await H.deleteRole(ve._id),fe(!1);const e=ve._id;be(null),se(s=>s.filter(s=>s._id!==e)),ue(e=>e-1),w({title:"Success",description:"Role deleted successfully!"})}catch(e){}finally{we(!1)}},disabled:ye,className:"w-full sm:w-auto",children:ye?e.jsxs(e.Fragment,{children:[e.jsx(r,{className:"w-4 h-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete Role"})]})]})})]})};export{V as default};

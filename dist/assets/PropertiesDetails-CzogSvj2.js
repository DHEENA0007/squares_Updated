import{j as e}from"./ui-BNZSgpjP.js";import{d as t,r as a}from"./router-D8v2YSKU.js";import{z as s,t as r,f as i,A as l,a as n,b as c,c as o,e as d,$ as h,I as p,_ as u,C as m,h as x}from"./index-FHRTVVMJ.js";import{E as w}from"./exportUtils-tXm36D7m.js";import{D as g}from"./download-DxaTuK19.js";import"./vendor-BxThA0WO.js";import"./xlsx-BjkOj9O8.js";const y=()=>{const y=t(),[f,v]=a.useState([]),[N,j]=a.useState([]),[A,P]=a.useState(!0),[b,T]=a.useState(""),[D,L]=a.useState({totalProperties:0,thisMonthProperties:0,activeProperties:0,pendingProperties:0,rejectedProperties:0,soldProperties:0});a.useEffect(()=>{M()},[]),a.useEffect(()=>{if(b){const e=f.filter(e=>(e.title?.toLowerCase()||"").includes(b.toLowerCase())||(e.propertyType?.toLowerCase()||"").includes(b.toLowerCase())||(e.address?.city?.toLowerCase()||"").includes(b.toLowerCase())||(e.status?.toLowerCase()||"").includes(b.toLowerCase()));j(e)}else j(f)},[b,f]);const M=async()=>{try{const e=s.getToken(),t=await fetch("https://app.buildhomemartsquares.com/api/properties?limit=1000",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch properties data");const a=await t.json();if(a.success){const e=a.data.properties;v(e),j(e);const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),1),r=e.filter(e=>new Date(e.createdAt)>=s).length;L({totalProperties:e.length,thisMonthProperties:r,activeProperties:e.filter(e=>"available"===e.status).length,pendingProperties:e.filter(e=>"pending"===e.status).length,rejectedProperties:e.filter(e=>"rejected"===e.status).length,soldProperties:e.filter(e=>["sold","rented","leased"].includes(e.status)).length})}}catch(e){r({title:"Error",description:"Failed to load properties data",variant:"destructive"})}finally{P(!1)}},S=t=>{switch(t){case"available":case"active":return e.jsx(m,{className:"w-4 h-4 text-green-600"});case"pending":return e.jsx(x,{className:"w-4 h-4 text-yellow-600"});case"sold":case"rented":case"leased":return e.jsx(m,{className:"w-4 h-4 text-blue-600"});default:return e.jsx(u,{className:"w-4 h-4 text-red-600"})}};return A?e.jsx("div",{className:"flex justify-center items-center py-12",children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(i,{variant:"ghost",onClick:()=>y("/admin/dashboard"),children:[e.jsx(l,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Properties Details"}),e.jsx("p",{className:"text-muted-foreground",children:"Complete property listings and statistics"})]}),e.jsxs(i,{variant:"outline",onClick:()=>{try{if(0===f.length)return void r({title:"No Data",description:"No property data available to export",variant:"destructive"});const e=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),t=e=>`₹${e.toLocaleString("en-IN")}`,a=e=>e?new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}):"N/A",s=e=>e?new Date(e).toLocaleString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",i=f.reduce((e,t)=>e+(t.price||0),0),l=f.length>0?i/f.length:0,n=Math.max(...f.map(e=>e.price||0)),c=Math.min(...f.filter(e=>e.price>0).map(e=>e.price)),o=f.filter(e=>"available"===e.status).length,d=(f.filter(e=>"pending"===e.status).length,f.filter(e=>"sold"===e.status).length),h=f.filter(e=>"rented"===e.status).length,p=f.filter(e=>"leased"===e.status).length,u=(f.filter(e=>"rejected"===e.status).length,f.filter(e=>"sale"===e.listingType).length),m=f.filter(e=>"rent"===e.listingType).length,x=f.filter(e=>"lease"===e.listingType).length,g=new Date;g.setDate(g.getDate()-7);const y=new Date;y.setDate(1);const v=f.filter(e=>new Date(e.createdAt)>g),N=(f.filter(e=>new Date(e.createdAt)>y),[{Metric:"Total Properties",Value:D.totalProperties,Details:"All properties in the system"},{Metric:"New Properties This Month",Value:D.thisMonthProperties,Details:"Listed in current month"},{Metric:"New Properties This Week",Value:v.length,Details:"Listed in last 7 days"},{Metric:"Available Properties",Value:D.activeProperties,Details:"Currently available for sale/rent"},{Metric:"Pending Approval",Value:D.pendingProperties,Details:"Awaiting admin approval"},{Metric:"Rejected Properties",Value:D.rejectedProperties,Details:"Rejected by admin"},{Metric:"Sold Properties",Value:d,Details:"Successfully sold"},{Metric:"Rented Properties",Value:h,Details:"Currently rented out"},{Metric:"Leased Properties",Value:p,Details:"On lease"},{Metric:"For Sale",Value:u,Details:"Listing type: Sale"},{Metric:"For Rent",Value:m,Details:"Listing type: Rent"},{Metric:"For Lease",Value:x,Details:"Listing type: Lease"},{Metric:"Total Portfolio Value",Value:t(i),Details:"Sum of all property prices"},{Metric:"Average Property Value",Value:t(Math.round(l)),Details:"Mean price across all"},{Metric:"Highest Priced",Value:t(n),Details:"Maximum price"},{Metric:"Lowest Priced",Value:t(c||0),Details:"Minimum price (non-zero)"},{Metric:"Approval Rate",Value:`${f.length>0?(o/f.length*100).toFixed(1):0}%`,Details:"Available / Total"},{Metric:"Success Rate",Value:`${f.length>0?((d+h+p)/f.length*100).toFixed(1):0}%`,Details:"Sold+Rented+Leased / Total"}]),j={};f.forEach(e=>{const t=e.status||"unknown";j[t]||(j[t]={count:0,value:0,avgValue:0}),j[t].count+=1,j[t].value+=e.price||0});const A=Object.entries(j).sort((e,t)=>t[1].count-e[1].count).map(([e,a])=>({Status:e.charAt(0).toUpperCase()+e.slice(1),Count:a.count,"Total Value":t(a.value),"Avg. Value":t(a.count>0?Math.round(a.value/a.count):0),Percentage:`${f.length>0?(a.count/f.length*100).toFixed(1):0}%`,"Value Share":`${i>0?(a.value/i*100).toFixed(1):0}%`})),P={};f.forEach(e=>{const t=e.propertyType||"Unknown";P[t]||(P[t]={count:0,value:0,available:0,sold:0}),P[t].count+=1,P[t].value+=e.price||0,"available"===e.status&&(P[t].available+=1),["sold","rented","leased"].includes(e.status)&&(P[t].sold+=1)});const b=Object.entries(P).sort((e,t)=>t[1].count-e[1].count).map(([e,a])=>({"Property Type":e,"Total Count":a.count,Available:a.available,"Sold/Rented":a.sold,"Total Value":t(a.value),"Avg. Value":t(a.count>0?Math.round(a.value/a.count):0),"Market Share":`${f.length>0?(a.count/f.length*100).toFixed(1):0}%`,"Success Rate":`${a.count>0?(a.sold/a.count*100).toFixed(1):0}%`})),T={};f.forEach(e=>{const t=e.listingType||"Unknown";T[t]||(T[t]={count:0,value:0}),T[t].count+=1,T[t].value+=e.price||0});const L=Object.entries(T).map(([e,a])=>({"Listing Type":e.charAt(0).toUpperCase()+e.slice(1),Count:a.count,"Total Value":t(a.value),"Avg. Value":t(a.count>0?Math.round(a.value/a.count):0),Percentage:`${f.length>0?(a.count/f.length*100).toFixed(1):0}%`})),M={};f.forEach(e=>{const t=e.address?.city||"Unknown";M[t]||(M[t]={count:0,value:0,available:0}),M[t].count+=1,M[t].value+=e.price||0,"available"===e.status&&(M[t].available+=1)});const S=Object.entries(M).sort((e,t)=>t[1].count-e[1].count).slice(0,30).map(([e,a])=>({City:e,"Total Properties":a.count,Available:a.available,"Total Value":t(a.value),"Avg. Value":t(a.count>0?Math.round(a.value/a.count):0),"Market Share":`${f.length>0?(a.count/f.length*100).toFixed(1):0}%`})),C=[{min:0,max:5e5,label:"Under ₹5 Lakh"},{min:5e5,max:1e6,label:"₹5-10 Lakh"},{min:1e6,max:25e5,label:"₹10-25 Lakh"},{min:25e5,max:5e6,label:"₹25-50 Lakh"},{min:5e6,max:1e7,label:"₹50 Lakh - 1 Cr"},{min:1e7,max:5e7,label:"₹1-5 Cr"},{min:5e7,max:1/0,label:"Above ₹5 Cr"}].map(e=>{const a=f.filter(t=>t.price>=e.min&&t.price<e.max);return{"Price Range":e.label,Count:a.length,Available:a.filter(e=>"available"===e.status).length,"Sold/Rented":a.filter(e=>["sold","rented","leased"].includes(e.status)).length,"Total Value":t(a.reduce((e,t)=>e+t.price,0)),Percentage:`${f.length>0?(a.length/f.length*100).toFixed(1):0}%`}}),V={};f.forEach(e=>{if(e.createdAt){const t=new Date(e.createdAt),a=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`;V[a]||(V[a]={listed:0,sold:0,value:0}),V[a].listed+=1,["sold","rented","leased"].includes(e.status)&&(V[a].sold+=1),V[a].value+=e.price||0}});const F=Object.entries(V).sort((e,t)=>t[0].localeCompare(e[0])).slice(0,24).map(([e,a])=>({Month:e,"New Listings":a.listed,"Sold/Rented":a.sold,"Total Value Listed":t(a.value),"Avg. Listing Value":t(a.listed>0?Math.round(a.value/a.listed):0)})),$=f.filter(e=>"available"===e.status).sort((e,t)=>t.price-e.price).map((e,s)=>({"#":s+1,"Property ID":e._id,Title:e.title||"N/A",Type:e.propertyType||"N/A",Listing:e.listingType||"N/A",Price:t(e.price||0),City:e.address?.city||"N/A",Locality:e.address?.locality||"N/A",Owner:`${e.owner?.profile?.firstName||""} ${e.owner?.profile?.lastName||""}`.trim()||"N/A","Listed On":a(e.createdAt),"Days Listed":Math.ceil((Date.now()-new Date(e.createdAt).getTime())/864e5)})),R=f.filter(e=>"pending"===e.status).sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()).map((e,a)=>({"#":a+1,"Property ID":e._id,Title:e.title||"N/A",Type:e.propertyType||"N/A",Listing:e.listingType||"N/A",Price:t(e.price||0),City:e.address?.city||"N/A",Owner:`${e.owner?.profile?.firstName||""} ${e.owner?.profile?.lastName||""}`.trim()||"N/A","Submitted On":s(e.createdAt),"Days Pending":Math.ceil((Date.now()-new Date(e.createdAt).getTime())/864e5),Priority:Math.ceil((Date.now()-new Date(e.createdAt).getTime())/864e5)>7?"High":"Normal"})),k=f.filter(e=>["sold","rented","leased"].includes(e.status)).sort((e,t)=>t.price-e.price).map((e,s)=>({"#":s+1,"Property ID":e._id,Title:e.title||"N/A",Type:e.propertyType||"N/A","Final Status":(e.status||"").charAt(0).toUpperCase()+(e.status||"").slice(1),Price:t(e.price||0),City:e.address?.city||"N/A",Owner:`${e.owner?.profile?.firstName||""} ${e.owner?.profile?.lastName||""}`.trim()||"N/A","Listed On":a(e.createdAt)})),O=f.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()).map((e,a)=>{const r=Math.ceil((Date.now()-new Date(e.createdAt).getTime())/864e5);return{"#":a+1,"Property ID":e._id,Title:e.title||"N/A","Property Type":e.propertyType||"N/A","Listing Type":(e.listingType||"N/A").charAt(0).toUpperCase()+(e.listingType||"").slice(1),Status:(e.status||"unknown").charAt(0).toUpperCase()+(e.status||"unknown").slice(1),Price:t(e.price||0),Currency:e.currency||"INR",Street:e.address?.street||"N/A",Locality:e.address?.locality||"N/A",City:e.address?.city||"N/A","Owner First Name":e.owner?.profile?.firstName||"N/A","Owner Last Name":e.owner?.profile?.lastName||"N/A","Listed On":s(e.createdAt),"Days Listed":r,"Listing Age":r>90?"Old":r>30?"Moderate":"Fresh"}}),E={filename:"properties_comprehensive_report",title:"Comprehensive Properties Analysis Report",metadata:{"Generated on":e,"Report Type":"Full Property Analytics","Total Properties":D.totalProperties.toString(),"Available Properties":D.activeProperties.toString(),"Total Portfolio Value":t(i),"Report Generated By":"Admin Dashboard"}},I=[{name:"Executive Summary",data:N,columns:[{wch:30},{wch:25},{wch:40}]},{name:"Status Analysis",data:A,columns:[{wch:15},{wch:10},{wch:20},{wch:18},{wch:12},{wch:12}]},{name:"Property Types",data:b,columns:[{wch:20},{wch:12},{wch:10},{wch:12},{wch:20},{wch:18},{wch:12},{wch:12}]},{name:"Listing Types",data:L,columns:[{wch:15},{wch:10},{wch:20},{wch:18},{wch:12}]},{name:"Price Ranges",data:C,columns:[{wch:20},{wch:10},{wch:10},{wch:12},{wch:20},{wch:12}]},{name:"City Analysis",data:S,columns:[{wch:25},{wch:15},{wch:10},{wch:20},{wch:18},{wch:12}]},{name:"Monthly Trends",data:F,columns:[{wch:12},{wch:12},{wch:12},{wch:20},{wch:18}]},{name:"Available Properties",data:$,columns:[{wch:5},{wch:25},{wch:35},{wch:15},{wch:10},{wch:18},{wch:20},{wch:25},{wch:25},{wch:15},{wch:12}]},{name:"Pending Approvals",data:R,columns:[{wch:5},{wch:25},{wch:35},{wch:15},{wch:10},{wch:18},{wch:20},{wch:25},{wch:20},{wch:12},{wch:10}]},{name:"Completed Transactions",data:k,columns:[{wch:5},{wch:25},{wch:35},{wch:15},{wch:12},{wch:18},{wch:20},{wch:25},{wch:15}]},{name:"All Properties",data:O,columns:[{wch:5},{wch:25},{wch:35},{wch:15},{wch:12},{wch:12},{wch:18},{wch:8},{wch:30},{wch:25},{wch:20},{wch:15},{wch:15},{wch:20},{wch:12},{wch:10}]}];w.generateExcelReport(E,I),r({title:"Export Successful",description:`Comprehensive properties report with ${I.length} sheets has been downloaded`})}catch(e){r({title:"Export Failed",description:"Failed to export properties report. Please try again.",variant:"destructive"})}},children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),"Export Properties"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3 lg:grid-cols-6",children:[e.jsxs(n,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Total Properties"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:D.totalProperties})})]}),e.jsxs(n,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"This Month"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:D.thisMonthProperties})})]}),e.jsxs(n,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Available"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:D.activeProperties})})]}),e.jsxs(n,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Pending"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:D.pendingProperties})})]}),e.jsxs(n,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Rejected"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:D.rejectedProperties})})]}),e.jsxs(n,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Sold/Rented"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:D.soldProperties})})]})]}),e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(h,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(p,{placeholder:"Search properties by title, type, city, or status...",value:b,onChange:e=>T(e.target.value),className:"pl-10"})]})}),e.jsxs(n,{children:[e.jsx(c,{children:e.jsxs(o,{children:["All Properties (",N.length,")"]})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-3",children:0===N.length?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No properties found"}):N.map(t=>{return e.jsx("div",{className:"border rounded-lg p-4 hover:bg-accent/50 transition",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 items-center",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"font-medium",children:t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.address.locality,", ",t.address.city]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Type"}),e.jsx("p",{className:"text-sm font-medium",children:t.propertyType}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.listingType})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Price"}),e.jsx("p",{className:"font-bold text-emerald-600",children:(s=t.price,t.currency,`₹${s.toLocaleString("en-IN")}`)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Listed"}),e.jsx("p",{className:"text-sm",children:(a=t.createdAt,new Date(a).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[S(t.status),e.jsx("span",{className:"text-sm capitalize",children:t.status})]})]})},t._id);var a,s})})})]})]})};export{y as default};

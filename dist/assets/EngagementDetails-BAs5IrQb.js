import{j as e}from"./ui-BNZSgpjP.js";import{d as t,r as a}from"./router-D8v2YSKU.js";import{z as s,t as r,f as o,A as i,a as n,b as c,c as l,e as d,a1 as p}from"./index-AgUnwITA.js";import{E as m}from"./exportUtils-BVtTTkrA.js";import{D as h}from"./download-CXE3n3CE.js";import"./vendor-BxThA0WO.js";import"./xlsx-BjkOj9O8.js";const u=()=>{const u=t(),[g,v]=a.useState([]),[x,f]=a.useState(!0),[y,w]=a.useState({totalFavorites:0,totalProperties:0,engagementRate:0,avgFavoritesPerProperty:0});a.useEffect(()=>{j()},[]);const j=async()=>{try{const e=s.getToken(),t=await fetch("https://app.buildhomemartsquares.com/api/favorites/all",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch favorites data");const a=await t.json();if(a.success&&a.data){const{properties:e,totalFavorites:t,totalProperties:s}=a.data;v(e);const r=e.length,o=r>0?t/r*100:0;w({totalFavorites:t,totalProperties:r,engagementRate:Math.round(10*o)/10,avgFavoritesPerProperty:r>0?Math.round(t/r*10)/10:0})}}catch(e){r({title:"Error",description:"Failed to load engagement data",variant:"destructive"})}finally{f(!1)}};return x?e.jsx("div",{className:"flex justify-center items-center py-12",children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(o,{variant:"ghost",onClick:()=>u("/admin/dashboard"),children:[e.jsx(i,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Engagement Details"}),e.jsx("p",{className:"text-muted-foreground",children:"Property engagement metrics and favorite statistics"})]}),e.jsxs(o,{variant:"outline",onClick:()=>{try{if(0===g.length)return void r({title:"No Data",description:"No engagement data available to export",variant:"destructive"});const e=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),t=g.filter(e=>e.favoriteCount>0),a=g.filter(e=>0===e.favoriteCount),s=Math.max(...g.map(e=>e.favoriteCount)),o=Math.min(...t.map(e=>e.favoriteCount)),i=[{Metric:"Total Properties Analyzed",Value:y.totalProperties,Details:"All properties in the system"},{Metric:"Total Favorites (All Time)",Value:y.totalFavorites,Details:"Sum of all favorites across properties"},{Metric:"Engagement Rate",Value:`${y.engagementRate}%`,Details:"Favorites per property ratio"},{Metric:"Avg. Favorites per Property",Value:y.avgFavoritesPerProperty,Details:"Average across all properties"},{Metric:"Properties with Favorites",Value:t.length,Details:"Properties with at least 1 favorite"},{Metric:"Properties without Favorites",Value:a.length,Details:"No user engagement yet"},{Metric:"Maximum Favorites (Single Property)",Value:s,Details:"Highest engagement"},{Metric:"Minimum Favorites (Engaged)",Value:o||0,Details:"Lowest among engaged properties"},{Metric:"Engagement Penetration",Value:`${y.totalProperties>0?(t.length/y.totalProperties*100).toFixed(1):0}%`,Details:"Percentage of properties with engagement"}],n={};g.forEach(e=>{const t=e.propertyType||"Unknown";n[t]||(n[t]={count:0,favorites:0,uniqueUsers:0}),n[t].count+=1,n[t].favorites+=e.favoriteCount,n[t].uniqueUsers+=e.uniqueUsers||0});const c=Object.entries(n).sort((e,t)=>t[1].favorites-e[1].favorites).map(([e,t])=>({"Property Type":e,"Total Properties":t.count,"Total Favorites":t.favorites,"Unique Users Engaged":t.uniqueUsers,"Avg. Favorites/Property":t.count>0?(t.favorites/t.count).toFixed(2):"0","Engagement %":`${y.totalFavorites>0?(t.favorites/y.totalFavorites*100).toFixed(1):0}%`})),l={};g.forEach(e=>{const t=e.listingType||"Unknown";l[t]||(l[t]={count:0,favorites:0}),l[t].count+=1,l[t].favorites+=e.favoriteCount});const d=Object.entries(l).sort((e,t)=>t[1].favorites-e[1].favorites).map(([e,t])=>({"Listing Type":e,Properties:t.count,"Total Favorites":t.favorites,"Avg. Favorites":t.count>0?(t.favorites/t.count).toFixed(2):"0"})),p={};g.forEach(e=>{const t=e.status||"Unknown";p[t]||(p[t]={count:0,favorites:0}),p[t].count+=1,p[t].favorites+=e.favoriteCount});const h=Object.entries(p).map(([e,t])=>({Status:e.charAt(0).toUpperCase()+e.slice(1),Properties:t.count,"Total Favorites":t.favorites,"Avg. Favorites":t.count>0?(t.favorites/t.count).toFixed(2):"0"})),u={};g.forEach(e=>{const t=e.address?.city||"Unknown";u[t]||(u[t]={count:0,favorites:0}),u[t].count+=1,u[t].favorites+=e.favoriteCount});const v=Object.entries(u).sort((e,t)=>t[1].favorites-e[1].favorites).slice(0,25).map(([e,t])=>({City:e,Properties:t.count,"Total Favorites":t.favorites,"Avg. Favorites":t.count>0?(t.favorites/t.count).toFixed(2):"0","Popularity %":`${y.totalFavorites>0?(t.favorites/y.totalFavorites*100).toFixed(1):0}%`})),x=[...g].sort((e,t)=>t.favoriteCount-e.favoriteCount).slice(0,50).map((e,t)=>({Rank:t+1,"Property ID":e._id,Title:e.title||"N/A","Property Type":e.propertyType||"N/A","Listing Type":e.listingType||"N/A",Status:e.status||"N/A",City:e.address?.city||"N/A",Locality:e.address?.locality||"N/A",State:e.address?.state||"N/A",Pincode:e.address?.pincode||"N/A","Total Favorites":e.favoriteCount,"Unique Users":e.uniqueUsers||"N/A","Engagement Score":e.favoriteCount>10?"High":e.favoriteCount>5?"Medium":"Low"})),f=g.sort((e,t)=>t.favoriteCount-e.favoriteCount).map((e,t)=>({"#":t+1,"Property ID":e._id,Title:e.title||"N/A","Property Type":e.propertyType||"N/A","Listing Type":e.listingType||"N/A",Status:(e.status||"N/A").charAt(0).toUpperCase()+(e.status||"").slice(1),Street:e.address?.street||"N/A",Locality:e.address?.locality||"N/A",City:e.address?.city||"N/A",State:e.address?.state||"N/A",Pincode:e.address?.pincode||"N/A","Total Favorites":e.favoriteCount,"Unique Users Interested":e.uniqueUsers||"N/A","Has Engagement":e.favoriteCount>0?"Yes":"No"})),w=g.filter(e=>0===e.favoriteCount).map((e,t)=>({"#":t+1,"Property ID":e._id,Title:e.title||"N/A","Property Type":e.propertyType||"N/A","Listing Type":e.listingType||"N/A",Status:e.status||"N/A",City:e.address?.city||"N/A",Locality:e.address?.locality||"N/A","Needs Marketing":"Yes"})),j={filename:"engagement_detailed_report",title:"Property Engagement Analysis Report",metadata:{"Generated on":e,"Report Type":"Comprehensive Engagement Analysis","Total Properties Analyzed":y.totalProperties.toString(),"Total Favorites Recorded":y.totalFavorites.toString(),"Overall Engagement Rate":`${y.engagementRate}%`,"Report Generated By":"Admin Dashboard"}},N=[{name:"Executive Summary",data:i,columns:[{wch:35},{wch:20},{wch:40}]},{name:"By Property Type",data:c,columns:[{wch:20},{wch:15},{wch:15},{wch:20},{wch:20},{wch:15}]},{name:"By Listing Type",data:d,columns:[{wch:20},{wch:12},{wch:15},{wch:15}]},{name:"By Status",data:h,columns:[{wch:15},{wch:12},{wch:15},{wch:15}]},{name:"By City",data:v,columns:[{wch:25},{wch:12},{wch:15},{wch:15},{wch:15}]},{name:"Top 50 Engaged",data:x,columns:[{wch:6},{wch:25},{wch:35},{wch:15},{wch:12},{wch:12},{wch:20},{wch:25},{wch:15},{wch:10},{wch:12},{wch:12},{wch:15}]},{name:"All Properties",data:f,columns:[{wch:5},{wch:25},{wch:35},{wch:15},{wch:12},{wch:12},{wch:30},{wch:25},{wch:20},{wch:15},{wch:10},{wch:12},{wch:18},{wch:15}]},{name:"Zero Engagement",data:w,columns:[{wch:5},{wch:25},{wch:35},{wch:15},{wch:12},{wch:12},{wch:20},{wch:25},{wch:15}]}];m.generateExcelReport(j,N),r({title:"Export Successful",description:`Comprehensive engagement report with ${N.length} sheets has been downloaded`})}catch(e){r({title:"Export Failed",description:"Failed to export engagement report. Please try again.",variant:"destructive"})}},children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"Export Report"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(n,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(l,{className:"text-sm font-medium text-muted-foreground",children:"Total Properties"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:y.totalProperties})})]}),e.jsxs(n,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(l,{className:"text-sm font-medium text-muted-foreground",children:"Total Favorites"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-pink-600",children:y.totalFavorites})})]}),e.jsxs(n,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(l,{className:"text-sm font-medium text-muted-foreground",children:"Engagement Rate"})}),e.jsx(d,{children:e.jsxs("div",{className:"text-2xl font-bold text-emerald-600",children:[y.engagementRate,"%"]})})]}),e.jsxs(n,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(l,{className:"text-sm font-medium text-muted-foreground",children:"Avg. Favorites/Property"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:y.avgFavoritesPerProperty})})]})]}),e.jsxs(n,{children:[e.jsx(c,{children:e.jsx(l,{children:"Properties by Engagement"})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-3",children:0===g.length?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No properties found"}):g.slice(0,50).map((t,a)=>e.jsx("div",{className:"border rounded-lg p-4 hover:bg-accent/50 transition",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 items-center",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center font-bold "+(0===a?"bg-yellow-100 text-yellow-700":1===a?"bg-gray-100 text-gray-700":2===a?"bg-orange-100 text-orange-700":"bg-blue-100 text-blue-700"),children:a+1})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"font-medium",children:t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.address.locality,", ",t.address.city]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Type"}),e.jsx("p",{className:"text-sm font-medium",children:t.propertyType}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.listingType})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-5 h-5 text-pink-600 fill-pink-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-pink-600",children:t.favoriteCount}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"favorites"})]})]})]})},t._id))})})]})]})};export{u as default};

import{j as e}from"./ui-BNZSgpjP.js";import{d as s,r as a}from"./router-D8v2YSKU.js";import{u as t,a2 as l,G as n,f as i,al as r,a as c,b as d,c as o,e as m,aj as x,aM as h,I as u,q as j,r as p,s as N,v as f,w as v,d as g,U as b,x as S,aN as y,B as C,E as w,_ as D,a4 as A,a5 as E,a6 as I,a7 as L,a8 as T,X as _,T as k,ae as R,Z as P,W as B}from"./index-CWpkTP43.js";import{P as M,a as U,b as z,c as F,d as H,e as O}from"./pagination-DFMQvqqK.js";import{s as V}from"./subscriptionService-TjhNFo8p.js";import{T as W,a as Y,b as X,c as q,d as G,e as Z}from"./table-myWg3CMl.js";import{C as $}from"./calendar-BZCh6MUV.js";import{L as J,M as K}from"./megaphone-BcOpu8nV.js";import{C as Q}from"./camera-BN8raphn.js";import"./vendor-BxThA0WO.js";import"./ellipsis-BadItLm2.js";const ee=e=>`â‚¹${(e||0).toLocaleString("en-IN")}`,se=()=>{const{user:se}=t(),ae=s(),te=se?.rolePermissions||[],le="admin"===se?.role||"superadmin"===se?.role,ne=e=>"superadmin"===se?.role||te.includes(e),ie=le||ne(P.SUBSCRIBED_CLIENTS_VIEW)||ne(P.CLIENTS_READ),re=le||ne(P.SUBSCRIBED_CLIENTS_DETAILS)||ne(P.CLIENTS_ACCESS_ACTIONS),ce=le||ne(P.SUBSCRIBED_CLIENTS_DETAILS)||ne(P.CLIENTS_ACCESS_DETAILS),de=le||ne(P.SUBSCRIBED_CLIENTS_CANCEL)||ne(P.CLIENTS_DETAILS_EDIT);le||ne(P.SUBSCRIBED_CLIENTS_EXPORT);const[oe,me]=a.useState(""),[xe,he]=a.useState(""),[ue,je]=a.useState("all"),[pe,Ne]=a.useState("all"),[fe,ve]=a.useState(""),[ge,be]=a.useState([]),[Se,ye]=a.useState(!0),[Ce,we]=a.useState(!1),[De,Ae]=a.useState(1),[Ee,Ie]=a.useState(1),[Le,Te]=a.useState(null),[_e,ke]=a.useState(!1),[Re,Pe]=a.useState(!1),[Be,Me]=a.useState(""),[Ue,ze]=a.useState(null),{toast:Fe}=l();a.useEffect(()=>{ie||(Fe({title:"Access Denied",description:"You don't have permission to view subscribed clients.",variant:"destructive"}),ae("/rolebased"))},[ie,ae,Fe]),a.useEffect(()=>{const e=setTimeout(()=>{he(oe),oe!==xe&&Ae(1)},500);return()=>clearTimeout(e)},[oe]);const He=a.useMemo(()=>{const e=new Set;return ge.forEach(s=>{s.plan?.name&&e.add(s.plan.name)}),Array.from(e).sort()},[ge]),[Oe,Ve]=a.useState(""),[We,Ye]=a.useState(""),Xe=a.useMemo(()=>ge.filter(e=>("all"===ue||e.status===ue)&&(("all"===pe||e.plan?.name===pe)&&(!(Oe&&e.startDate&&new Date(e.startDate)<new Date(Oe))&&!(We&&e.startDate&&new Date(e.startDate)>new Date(We))))),[ge,ue,pe,Oe,We]),qe="all"!==ue||"all"!==pe||""!==fe||""!==oe||""!==Oe||""!==We,Ge=s=>{const a={className:"w-4 h-4"};switch(s?.toLowerCase()){case"photography":return e.jsx(Q,{...a});case"marketing":return e.jsx(K,{...a});case"technology":return e.jsx(J,{...a});case"support":return e.jsx(B,{...a});case"crm":return e.jsx(b,{...a});default:return e.jsx(_,{...a})}},Ze=a.useCallback(async()=>{try{Se||we(!0);const e={page:De,limit:10,search:xe||void 0,status:"all"===ue?void 0:ue},s=await V.getSubscriptions(e),a=s.data.subscriptions.filter(e=>e&&e.user&&(e.user.name||e.user.email));be(a),Ie(s.data.pagination.totalPages)}catch(e){Fe({title:"Error",description:"Failed to load subscriptions. Please try again.",variant:"destructive"})}finally{ye(!1),we(!1)}},[De,xe,ue]);a.useEffect(()=>{Ze()},[Ze]);const $e=e=>{switch(e){case"active":return"default";case"expired":default:return"secondary";case"cancelled":return"destructive";case"pending":return"outline"}},Je=a.useMemo(()=>({active:Xe.filter(e=>"active"===e.status).length,expired:Xe.filter(e=>"expired"===e.status).length,cancelled:Xe.filter(e=>"cancelled"===e.status).length,totalRevenue:Xe.filter(e=>"active"===e.status).reduce((e,s)=>e+(s.amount||0),0),total:Xe.length}),[Xe]);return ie?Se?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center min-h-[400px]",children:[e.jsx(n,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-2",children:"Loading subscribed clients..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Subscribed Clients"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage and monitor all client subscriptions"})]}),e.jsxs(i,{onClick:Ze,variant:"outline",disabled:Ce,children:[e.jsx(r,{className:"h-4 w-4 mr-2 "+(Ce?"animate-spin":"")}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs(c,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Total Subscriptions"})}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:Je.total})})]}),e.jsxs(c,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Active"})}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:Je.active})})]}),e.jsxs(c,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Expired"})}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:Je.expired})})]}),e.jsxs(c,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Cancelled"})}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:Je.cancelled})})]}),e.jsxs(c,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Active Revenue"})}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:ee(Je.totalRevenue)})})]})]}),e.jsxs(c,{children:[e.jsx(d,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(o,{className:"text-lg flex items-center gap-2",children:[e.jsx(x,{className:"h-5 w-5"}),"Filters"]}),qe&&e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>{je("all"),Ne("all"),ve(""),Ve(""),Ye(""),me("")},children:[e.jsx(h,{className:"h-4 w-4 mr-1"}),"Clear All"]})]})}),e.jsx(m,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Search"}),e.jsx(u,{placeholder:"Search by name or email...",value:oe,onChange:e=>me(e.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Status"}),e.jsxs(j,{value:ue,onValueChange:je,children:[e.jsx(p,{children:e.jsx(N,{placeholder:"All statuses"})}),e.jsxs(f,{children:[e.jsx(v,{value:"all",children:"All Statuses"}),e.jsx(v,{value:"active",children:"Active"}),e.jsx(v,{value:"expired",children:"Expired"}),e.jsx(v,{value:"cancelled",children:"Cancelled"}),e.jsx(v,{value:"pending",children:"Pending"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Plan"}),e.jsxs(j,{value:pe,onValueChange:Ne,children:[e.jsx(p,{children:e.jsx(N,{placeholder:"All plans"})}),e.jsxs(f,{children:[e.jsx(v,{value:"all",children:"All Plans"}),He.map(s=>e.jsx(v,{value:s,children:s},s))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"From"}),e.jsx(u,{type:"date",value:Oe,onChange:e=>Ve(e.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"To"}),e.jsx(u,{type:"date",value:We,onChange:e=>Ye(e.target.value)})]})]})})]}),e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsxs(o,{children:["Subscriptions (",Xe.length,")"]}),e.jsx(g,{children:"List of all client subscriptions"})]}),e.jsxs(m,{children:[Ce?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(n,{className:"h-6 w-6 animate-spin text-primary"})}):0===Xe.length?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(b,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No subscriptions found"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(W,{children:[e.jsx(Y,{children:e.jsxs(X,{children:[e.jsx(q,{children:"Client"}),e.jsx(q,{children:"Phone"}),e.jsx(q,{children:"Plan"}),e.jsx(q,{children:"Amount"}),e.jsx(q,{children:"Status"}),e.jsx(q,{children:"Start Date"}),e.jsx(q,{children:"End Date"}),e.jsx(q,{children:"Add-ons"}),re&&e.jsx(q,{className:"text-right",children:"Actions"})]})}),e.jsx(G,{children:Xe.map(s=>e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(S,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.user?.name||"Unknown"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.user?.email})]})]})}),e.jsx(Z,{children:e.jsx("span",{children:s.user?.phone||"N/A"})}),e.jsx(Z,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.plan?.name||"N/A"})]})}),e.jsx(Z,{children:e.jsx("span",{className:"font-medium",children:ee(s.amount)})}),e.jsx(Z,{children:e.jsx(C,{variant:$e(s.status),children:s.status})}),e.jsx(Z,{children:s.startDate?new Date(s.startDate).toLocaleDateString():"N/A"}),e.jsx(Z,{children:s.endDate?new Date(s.endDate).toLocaleDateString():"N/A"}),e.jsx(Z,{children:s.addons&&s.addons.length>0?e.jsxs(C,{variant:"outline",children:[s.addons.length," add-ons"]}):e.jsx("span",{className:"text-muted-foreground",children:"None"})}),re&&e.jsx(Z,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>(e=>{ce?(Te(e),ke(!0)):Fe({title:"Access Denied",description:"You don't have permission to view client details.",variant:"destructive"})})(s),children:e.jsx(w,{className:"h-4 w-4"})}),de&&"active"===s.status&&e.jsx(i,{variant:"ghost",size:"sm",className:"text-destructive hover:text-destructive",onClick:()=>{ze(s),Pe(!0)},children:e.jsx(D,{className:"h-4 w-4"})})]})})]},s._id))})]})}),Ee>1&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(M,{children:e.jsxs(U,{children:[e.jsx(z,{children:e.jsx(F,{onClick:()=>{De>1&&Ae(De-1)},className:1===De?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:Math.min(5,Ee)},(s,a)=>{let t;return t=Ee<=5||De<=3?a+1:De>=Ee-2?Ee-4+a:De-2+a,e.jsx(z,{children:e.jsx(H,{onClick:()=>{Ae(t)},isActive:De===t,className:"cursor-pointer",children:t})},t)}),e.jsx(z,{children:e.jsx(O,{onClick:()=>{De<Ee&&Ae(De+1)},className:De===Ee?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]}),e.jsx(A,{open:_e,onOpenChange:ke,children:e.jsxs(E,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(I,{children:[e.jsx(L,{children:"Subscription Details"}),e.jsx(T,{children:"View detailed subscription information"})]}),Le&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4"}),"Client Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Name:"}),e.jsx("p",{className:"font-medium",children:Le.user?.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Email:"}),e.jsx("p",{className:"font-medium",children:Le.user?.email||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Phone:"}),e.jsx("p",{className:"font-medium",children:Le.user?.phone||"N/A"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),"Subscription Details"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Plan:"}),e.jsx("p",{className:"font-medium",children:Le.plan?.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount:"}),e.jsx("p",{className:"font-medium",children:ee(Le.amount)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Status:"}),e.jsx(C,{variant:$e(Le.status),className:"mt-1",children:Le.status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Auto Renew:"}),e.jsx("p",{className:"font-medium",children:Le.autoRenew?"Yes":"No"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Start Date:"}),e.jsx("p",{className:"font-medium",children:Le.startDate?new Date(Le.startDate).toLocaleDateString():"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"End Date:"}),e.jsx("p",{className:"font-medium",children:Le.endDate?new Date(Le.endDate).toLocaleDateString():"N/A"})]})]})]}),Le.addons&&Le.addons.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),"Add-ons (",Le.addons.length,")"]}),e.jsx("div",{className:"space-y-2",children:Le.addons.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[Ge(s.category),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.category})]})]}),e.jsx("span",{className:"font-medium",children:ee(s.price)})]},s._id))})]}),Le.paymentHistory&&Le.paymentHistory.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"Payment History"]}),e.jsx("div",{className:"space-y-2",children:Le.paymentHistory.slice(0,5).map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium capitalize",children:s.type?.replace("_"," ")}),e.jsx("p",{className:"text-muted-foreground",children:s.date?new Date(s.date).toLocaleDateString():"N/A"})]}),e.jsx("span",{className:"font-medium",children:ee(s.amount)})]},a))})]})]})]})}),e.jsx(A,{open:Re,onOpenChange:Pe,children:e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(L,{children:"Cancel Subscription"}),e.jsx(T,{children:"Are you sure you want to cancel this subscription? This action cannot be undone."})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Reason for cancellation ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(k,{placeholder:"Enter the reason for cancellation...",value:Be,onChange:e=>Me(e.target.value),rows:4})]})}),e.jsxs(R,{children:[e.jsx(i,{variant:"outline",onClick:()=>Pe(!1),children:"Cancel"}),e.jsx(i,{variant:"destructive",onClick:async()=>{if(Ue&&Be.trim())try{await V.cancelSubscription(Ue._id,Be),Fe({title:"Success",description:"Subscription cancelled successfully."}),Pe(!1),ze(null),Me(""),Ze()}catch(e){Fe({title:"Error",description:"Failed to cancel subscription.",variant:"destructive"})}else Fe({title:"Error",description:"Please provide a reason for cancellation.",variant:"destructive"})},disabled:!Be.trim(),children:"Confirm Cancellation"})]})]})})]}):null};export{se as default};

import{j as e}from"./ui-DOY6021Z.js";import{r,R as ie,L as w}from"./router-2SVJvIbS.js";import{G as ne,B as v,C as ce,f as o,H as te,I as ae,q as G,r as H,s as O,v as q,w as i,ao as c,D as W,a as f,e as p,av as Z,E as $,U as I,ai as J,h as oe,V as de,W as me,Y as ue,Z as D,t as Y}from"./index-DJqidggL.js";import{D as xe,a as he,b as je,c as ge,d as fe,e as pe}from"./dialog-DsaUnv7s.js";import{L as b}from"./label-B9O-vWmY.js";import{T as ve}from"./textarea-DO9hd5Hf.js";import{A as K,a as X}from"./alert-diF-BNS3.js";import{u as Ne}from"./userService-uIioZVG9.js";import{C as we}from"./circle-alert-BOzTmcnj.js";import{C as be}from"./camera-B6KGjwpp.js";import{E as Se}from"./ellipsis-vertical-BFXsvqj0.js";import{P as ee}from"./pen-line-MVIgrvu7.js";import{T as se}from"./trending-up-BhzOTv6v.js";import{T as ye}from"./trash-2-BwLQT3fy.js";import{C as Ce}from"./calendar-B7ilpZNA.js";import"./vendor-Dazix4UH.js";const Pe=({property:a,open:j,onOpenChange:d,onUpdateStatus:M})=>{const{toast:m}=ne(),[u,S]=r.useState(""),[y,C]=r.useState(""),[F,k]=r.useState(!1),[g,A]=r.useState(""),[V,N]=r.useState([]),[E,R]=r.useState(!1),[P,x]=r.useState(""),h=a?.status==="active",n=(()=>{if(!a)return null;const t=a.listingType||"sale";return t==="sale"?{value:"sold",label:"Mark as Sold",color:"bg-blue-500"}:t==="rent"?{value:"rented",label:"Mark as Rented",color:"bg-purple-500"}:t==="lease"?{value:"leased",label:"Mark as Leased",color:"bg-indigo-500"}:null})();r.useEffect(()=>{j&&h&&n&&U()},[j]);const U=async()=>{try{R(!0),console.log("[PropertyStatusDialog] Loading customers with role: customer");const t=await Ne.getUsers({role:"customer",limit:100,status:"active"});console.log("[PropertyStatusDialog] Customer response:",t),t.success&&t.data?.users?(console.log(`[PropertyStatusDialog] Loaded ${t.data.users.length} customers`),N(t.data.users)):(console.error("[PropertyStatusDialog] Invalid response structure:",t),m({title:"Warning",description:"Failed to load customers properly.",variant:"default"}))}catch(t){console.error("[PropertyStatusDialog] Failed to load customers:",t),m({title:"Error",description:"Failed to load customers.",variant:"destructive"})}finally{R(!1)}},T=V.filter(t=>{const L=P.toLowerCase(),z=`${t.profile?.firstName||""} ${t.profile?.lastName||""}`.toLowerCase(),le=t.email?.toLowerCase()||"",re=t.profile?.phone||"";return z.includes(L)||le.includes(L)||re.includes(L)});ie.useEffect(()=>{a&&j&&(S(""),C(""),A(""),x(""))},[a,j]);const _=()=>{n&&S(n.value)},B=async()=>{if(!(!a||!u)){if(!g){m({title:"Customer Required",description:`Please select a customer to assign this ${u} property to.`,variant:"destructive"});return}k(!0);try{await M(a._id,u,g,y.trim()||void 0),d(!1)}catch(t){console.error("Failed to update status:",t)}finally{k(!1)}}},s=t=>{switch(t){case"active":return"bg-green-500";case"pending":return"bg-yellow-500";case"sold":return"bg-blue-500";case"rented":return"bg-purple-500";case"leased":return"bg-indigo-500";case"rejected":return"bg-red-500";default:return"bg-gray-500"}},l=t=>{switch(t){case"active":return"Active";case"pending":return"Pending Approval";case"sold":return"Sold";case"rented":return"Rented";case"leased":return"Leased";case"rejected":return"Rejected";default:return t.charAt(0).toUpperCase()+t.slice(1)}};return e.jsx(xe,{open:j,onOpenChange:d,children:e.jsxs(he,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(je,{children:[e.jsx(ge,{children:"Update Property Status"}),e.jsx(fe,{children:a?.title}),a?.listingType&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Listing Type: ",e.jsx(v,{variant:"outline",className:"ml-1",children:a.listingType})]})]}),"        ",e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Current Status"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(v,{className:`${s(a?.status||"")} text-white`,children:l(a?.status||"")})})]}),!h&&e.jsxs(K,{children:[e.jsx(we,{className:"h-4 w-4"}),e.jsxs(X,{children:["This property is not yet approved by admin. You can only update the status to ",n?.label.toLowerCase()," after admin approval."]})]}),a?.status==="sold"||a?.status==="rented"||a?.status==="leased"?e.jsxs(K,{children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsxs(X,{children:["This property has already been marked as ",l(a.status).toLowerCase(),"."]})]}):u===""?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Action"}),e.jsx(o,{onClick:_,disabled:!h||!n,className:`w-full ${n?.color||"bg-primary"} hover:opacity-90 text-white`,size:"lg",children:n?.label||"Update Status"}),!h&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Button will be enabled once admin approves your property"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"customer-search",children:"Search Customer"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(ae,{id:"customer-search",placeholder:"Search by name, email, or phone...",value:P,onChange:t=>x(t.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"customer-select",children:"Assign To Customer *"}),E?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading customers..."}):e.jsxs(G,{value:g,onValueChange:A,children:[e.jsx(H,{children:e.jsx(O,{placeholder:"Select customer who bought/rented this property"})}),e.jsx(q,{children:T.length===0?e.jsx("div",{className:"p-2 text-sm text-muted-foreground text-center",children:P?"No customers found":"No customers available"}):T.map(t=>e.jsx(i,{value:t._id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-medium",children:[t.profile?.firstName," ",t.profile?.lastName]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.email," ",t.profile?.phone&&`• ${t.profile.phone}`]})]})},t._id))})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This property will be added to the selected customer's portfolio"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"reason",children:"Additional Notes (Optional)"}),e.jsx(ve,{id:"reason",placeholder:"Add any notes about this transaction...",value:y,onChange:t=>C(t.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Status Change Preview"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:`${s(a?.status||"")} text-white`,children:l(a?.status||"")}),e.jsx("span",{className:"text-muted-foreground",children:"→"}),e.jsx(v,{className:`${n?.color||"bg-gray-500"} text-white`,children:l(u)})]})]})]})]}),e.jsxs(pe,{children:[e.jsx(o,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),u&&e.jsx(o,{onClick:B,disabled:F||!g,className:`${n?.color||"bg-primary"} hover:opacity-90 text-white`,children:F?"Updating...":`Confirm ${n?.label}`})]})]})})},Ye=()=>{const[a,j]=r.useState(""),[d,M]=r.useState("all"),[m,u]=r.useState("all"),[S,y]=r.useState(!0),[C,F]=r.useState([]),[k,g]=r.useState(!1),[A,V]=r.useState(null),[N,E]=r.useState({totalProperties:0,totalViews:0,totalLeads:0,averageRating:0}),[R,P]=r.useState({currentPage:1,totalPages:1,totalProperties:0,hasNextPage:!1,hasPrevPage:!1});r.useEffect(()=>{x(),h()},[]),r.useEffect(()=>{x()},[a,d,m]);const x=async()=>{try{y(!0);const s={page:1,limit:10,...a&&{search:a},...d!=="all"&&{status:d},...m!=="all"&&{propertyType:m}},l=await c.getVendorProperties(s);F(l.data.properties),P(l.data.pagination)}catch(s){console.error("Failed to load properties:",s)}finally{y(!1)}},h=async()=>{try{const s=await c.getVendorPropertyStats();E(s)}catch(s){console.error("Failed to load stats:",s)}},Q=async s=>{if(window.confirm("Are you sure you want to delete this property?"))try{await c.deleteProperty(s),x(),h()}catch(l){console.error("Failed to delete property:",l)}},n=async(s,l)=>{try{await c.togglePropertyFeatured(s,!l),x()}catch(t){console.error("Failed to toggle featured status:",t)}},U=async(s,l,t,L)=>{try{t&&(l==="sold"||l==="rented"||l==="leased")?(await c.assignPropertyToCustomer(s,t,l,L),Y({title:"Success",description:`Property ${l} and assigned to customer successfully!`})):(await c.togglePropertyStatus(s,l),Y({title:"Success",description:`Property status updated to ${l}!`})),x(),h()}catch(z){console.error("Failed to update property status:",z),Y({title:"Error",description:"Failed to update property status",variant:"destructive"})}},T=s=>{V(s),g(!0)},_=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),B=s=>{const l=[];return s.address.locationName&&l.push(s.address.locationName),s.address.city&&l.push(s.address.city),s.address.state&&l.push(s.address.state),l.join(", ")||"Location not specified"};return S?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading properties..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"My Properties"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage and track your property listings"})]}),e.jsx(w,{to:"/vendor/properties/add",children:e.jsxs(o,{children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Add Property"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(f,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Properties"}),e.jsx("p",{className:"text-2xl font-bold",children:N.totalProperties})]}),e.jsx(Z,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(f,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Views"}),e.jsx("p",{className:"text-2xl font-bold",children:N.totalViews.toLocaleString()})]}),e.jsx($,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(f,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Leads"}),e.jsx("p",{className:"text-2xl font-bold",children:N.totalLeads})]}),e.jsx(I,{className:"h-8 w-8 text-purple-600"})]})})}),e.jsx(f,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Avg. Rating"}),e.jsx("p",{className:"text-2xl font-bold",children:N.averageRating.toFixed(1)})]}),e.jsx(J,{className:"h-8 w-8 text-orange-600"})]})})})]}),e.jsx(f,{children:e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(ae,{placeholder:"Search properties...",value:a,onChange:s=>j(s.target.value),className:"pl-10"})]}),e.jsxs(G,{value:d,onValueChange:M,children:[e.jsx(H,{className:"w-full sm:w-40",children:e.jsx(O,{placeholder:"Status"})}),e.jsxs(q,{children:[e.jsx(i,{value:"all",children:"All Status"}),e.jsx(i,{value:"available",children:"Available"}),e.jsx(i,{value:"pending",children:"Pending"}),e.jsx(i,{value:"sold",children:"Sold"}),e.jsx(i,{value:"rented",children:"Rented"})]})]}),e.jsxs(G,{value:m,onValueChange:u,children:[e.jsx(H,{className:"w-full sm:w-40",children:e.jsx(O,{placeholder:"Type"})}),e.jsxs(q,{children:[e.jsx(i,{value:"all",children:"All Types"}),e.jsx(i,{value:"apartment",children:"Apartment"}),e.jsx(i,{value:"house",children:"House"}),e.jsx(i,{value:"villa",children:"Villa"}),e.jsx(i,{value:"plot",children:"Plot"}),e.jsx(i,{value:"land",children:"Land"}),e.jsx(i,{value:"commercial",children:"Commercial"}),e.jsx(i,{value:"office",children:"Office"}),e.jsx(i,{value:"pg",children:"PG (Paying Guest)"})]})]})]})})}),e.jsx("div",{className:"space-y-4",children:C.map(s=>e.jsx(f,{className:"overflow-hidden",children:e.jsx(p,{className:"p-0",children:e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[e.jsxs("div",{className:"lg:w-64 h-48 lg:h-auto bg-muted relative",children:[s.images&&s.images.length>0?e.jsx("img",{src:c.getPrimaryImage(s),alt:s.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/20 to-transparent flex items-center justify-center",children:e.jsx(be,{className:"w-12 h-12 text-muted-foreground"})}),e.jsxs("div",{className:"absolute top-3 left-3 flex gap-2",children:[e.jsx(v,{className:`${c.getStatusColor(s.status)} text-white`,children:c.getStatusText(s.status)}),s.featured&&e.jsx(v,{variant:"secondary",children:"Featured"}),s.verified&&e.jsx(v,{className:"bg-green-600 text-white",children:"Verified"})]}),s.images&&s.images.length>0&&e.jsxs("div",{className:"absolute bottom-3 left-3 bg-black/70 text-white px-2 py-1 rounded text-sm",children:[s.images.length," ",s.images.length===1?"photo":"photos"]})]}),e.jsxs("div",{className:"flex-1 p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-1",children:s.title}),e.jsxs("p",{className:"text-muted-foreground flex items-center mb-2",children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),B(s)]}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:c.formatPrice(s.price,s.listingType)})]}),e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx(o,{variant:"ghost",size:"icon",children:e.jsx(Se,{className:"w-4 h-4"})})}),e.jsxs(ue,{align:"end",children:[e.jsx(D,{asChild:!0,children:e.jsxs(w,{to:`/vendor/properties/details/${s._id}`,children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"View Details"]})}),e.jsx(D,{asChild:!0,children:e.jsxs(w,{to:`/vendor/properties/edit/${s._id}`,children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Edit Property"]})}),e.jsxs(D,{onClick:()=>n(s._id,s.featured),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),s.featured?"Unfeature":"Promote"]}),s.status==="active"&&e.jsxs(D,{onClick:()=>T(s),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),s.listingType==="sale"?"Mark as Sold":s.listingType==="rent"?"Mark as Rented":"Mark as Leased"]}),e.jsxs(D,{className:"text-red-600",onClick:()=>Q(s._id),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[s.bedrooms>0&&e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Bedrooms"}),e.jsx("p",{className:"font-semibold",children:s.bedrooms})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Bathrooms"}),e.jsx("p",{className:"font-semibold",children:s.bathrooms})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Area"}),e.jsx("p",{className:"font-semibold",children:c.formatArea(s.area)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Type"}),e.jsx("p",{className:"font-semibold capitalize",children:s.type})]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground mb-4",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx($,{className:"w-4 h-4 mr-1"}),s.views," views"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),"0 leads"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),"0 favorites"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(Ce,{className:"w-4 h-4 mr-1"}),"Listed ",_(s.createdAt)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{to:`/vendor/properties/details/${s._id}`,children:e.jsxs(o,{size:"sm",variant:"outline",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"View Details"]})}),e.jsx(w,{to:`/vendor/properties/edit/${s._id}`,children:e.jsxs(o,{size:"sm",variant:"outline",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Edit"]})}),e.jsxs(o,{size:"sm",onClick:()=>n(s._id,s.featured),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),s.featured?"Unfeature":"Promote"]}),s.status==="active"&&e.jsx(o,{size:"sm",variant:"outline",onClick:()=>T(s),children:s.listingType==="sale"?"Mark as Sold":s.listingType==="rent"?"Mark as Rented":"Mark as Leased"})]})]})]})})},s._id))}),C.length===0&&!S&&e.jsx(f,{children:e.jsxs(p,{className:"p-12 text-center",children:[e.jsx(Z,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No properties found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:a||d!=="all"||m!=="all"?"No properties match your search criteria":"You haven't added any properties yet"}),e.jsx(w,{to:"/vendor/properties/add",children:e.jsxs(o,{children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Add Your First Property"]})})]})}),e.jsx(Pe,{property:A,open:k,onOpenChange:g,onUpdateStatus:U})]})};export{Ye as default};

const d="https://squares-v2.onrender.com/api";class m{getAuthHeaders(){const e=localStorage.getItem("token");return e?{Authorization:`Bearer ${e}`}:{}}async uploadSingle(e,a="avatars"){const t=new FormData;t.append("file",e),t.append("folder",a);const o=await fetch(`${d}/upload/single`,{method:"POST",headers:this.getAuthHeaders(),body:t});if(!o.ok){const r=await o.json().catch(()=>({message:"Upload failed"}));throw new Error(r.message||"Failed to upload file")}return await o.json()}async uploadMultiple(e,a="general"){const t=new FormData;e.forEach(r=>t.append("files",r)),t.append("folder",a);const o=await fetch(`${d}/upload/multiple`,{method:"POST",headers:this.getAuthHeaders(),body:t});if(!o.ok){const r=await o.json().catch(()=>({message:"Upload failed"}));throw new Error(r.message||"Failed to upload files")}return await o.json()}async deleteFile(e){const a=await fetch(`${d}/upload/${encodeURIComponent(e)}`,{method:"DELETE",headers:{"Content-Type":"application/json",...this.getAuthHeaders()}});if(!a.ok){const t=await a.json().catch(()=>({message:"Delete failed"}));throw new Error(t.message||"Failed to delete file")}return await a.json()}async uploadAvatar(e){return(await this.uploadSingle(e,"avatars")).data.url}validateImageFile(e){return["image/jpeg","image/jpg","image/png","image/webp"].includes(e.type)?e.size>5242880?{valid:!1,error:"Image size must be less than 5MB"}:{valid:!0}:{valid:!1,error:"Please upload a valid image file (JPEG, PNG, or WebP)"}}async compressImage(e,a=800){return new Promise((t,o)=>{const r=new FileReader;r.readAsDataURL(e),r.onload=p=>{const s=new Image;s.src=p.target?.result,s.onload=()=>{const i=document.createElement("canvas");let n=s.width,l=s.height;n>a&&(l=l*a/n,n=a),i.width=n,i.height=l,i.getContext("2d")?.drawImage(s,0,0,n,l),i.toBlob(c=>{if(c){const g=new File([c],e.name,{type:"image/jpeg",lastModified:Date.now()});t(g)}else o(new Error("Canvas to Blob conversion failed"))},"image/jpeg",.8)},s.onerror=()=>o(new Error("Image loading failed"))},r.onerror=()=>o(new Error("File reading failed"))})}}const w=new m;export{w as u};

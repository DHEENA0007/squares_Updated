const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendorService-BBU9_Mqe.js","assets/index-CV77Hym3.js","assets/ui-DHQhougw.js","assets/router-Bi51YGN-.js","assets/vendor-eVk5PToZ.js","assets/reviewsService-BQH4s__s.js"])))=>i.map(i=>d[i]);
import{$ as e,f as s,Z as a,a as t,b as i,c as r,B as l,e as n,ar as c,C as d,bd as o,a9 as m,aq as x,_ as h}from"./index-CV77Hym3.js";import{j as p}from"./ui-DHQhougw.js";import{r as u,d as j}from"./router-Bi51YGN-.js";import{a as g}from"./addonService-C5oBZK4p.js";import{paymentService as v}from"./paymentService-BjbjsdCg.js";import{C as y}from"./calendar-BwxHbBld.js";import{S as b}from"./shield-DhOisX9k.js";import"./vendor-eVk5PToZ.js";const N=()=>{const[N,f]=u.useState(null),[w,S]=u.useState([]),[_,A]=u.useState([]),[k,P]=u.useState(!0),[C,D]=u.useState(!1),{toast:T}=e(),L=j();u.useEffect(()=>{E(),M()},[]);const E=async()=>{try{const e=await fetch("https://api.buildhomemartsquares.com/api/vendors/subscription-status",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok){const s=await e.json();s.success&&s.data.hasActiveSubscription&&f(s.data.subscription)}}catch(e){}finally{P(!1)}},M=async()=>{try{const e=await g.getAddons();S(e.filter(e=>e.isActive))}catch(e){S([{_id:"1",name:"Professional Photography",description:"High-quality property photography service",price:2999,category:"photography",billingType:"per_property",isActive:!0},{_id:"2",name:"Virtual Tours",description:"360° virtual property tours",price:4999,category:"technology",billingType:"per_property",isActive:!0},{_id:"3",name:"Social Media Marketing",description:"Promote your listings on social platforms",price:1999,category:"marketing",billingType:"monthly",isActive:!0}])}},$=e=>new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"}),z=e=>{var s;(s=e._id,N?.addons?.some(e=>e._id===s))?T({title:"Addon Already Active",description:`${e.name} is already included in your subscription`,variant:"default"}):A(s=>s.find(s=>s._id===e._id)?s.filter(s=>s._id!==e._id):[...s,e])},B=()=>_.reduce((e,s)=>e+s.price,0);return k?p.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:p.jsxs("div",{className:"text-center",children:[p.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),p.jsx("p",{className:"text-gray-600",children:"Loading subscription details..."})]})}):p.jsxs("div",{className:"space-y-6",children:[p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("div",{className:"sm:flex sm:items-center",children:p.jsxs("div",{className:"sm:flex-auto",children:[p.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Subscription Management"}),p.jsx("p",{className:"mt-2 text-sm text-gray-700 dark:text-gray-300",children:"Manage your subscription and addon services"})]})}),!N&&p.jsxs(s,{onClick:()=>L("/vendor/subscription-plans"),children:[p.jsx(a,{className:"w-4 h-4 mr-2"}),"Get Started"]})]}),N?p.jsxs(t,{children:[p.jsx(i,{children:p.jsxs(r,{className:"flex items-center space-x-3",children:[(e=>{switch(e?.toLowerCase()){case"basic":return p.jsx(m,{className:"w-8 h-8 text-blue-500"});case"premium":return p.jsx(x,{className:"w-8 h-8 text-yellow-500"});case"enterprise":return p.jsx(b,{className:"w-8 h-8 text-purple-500"});default:return p.jsx(o,{className:"w-8 h-8 text-green-500"})}})(N.planName),p.jsxs("div",{children:[p.jsxs("h2",{className:"text-2xl font-bold",children:[N.planName," Plan"]}),p.jsx(l,{variant:"active"===N.status?"default":"secondary",children:N.status.toUpperCase()})]})]})}),p.jsxs(n,{className:"space-y-6",children:[p.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[p.jsxs("div",{className:"flex items-center space-x-3",children:[p.jsx(y,{className:"w-5 h-5 text-blue-600"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-gray-600",children:"Start Date"}),p.jsx("p",{className:"font-medium",children:$(N.startDate)})]})]}),p.jsxs("div",{className:"flex items-center space-x-3",children:[p.jsx(y,{className:"w-5 h-5 text-red-600"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-gray-600",children:"End Date"}),p.jsx("p",{className:"font-medium",children:$(N.endDate)})]})]}),p.jsxs("div",{className:"flex items-center space-x-3",children:[p.jsx(c,{className:"w-5 h-5 text-green-600"}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-gray-600",children:"Days Remaining"}),p.jsxs("p",{className:"font-medium text-green-600",children:[(e=>{const s=new Date(e),a=new Date,t=s.getTime()-a.getTime(),i=Math.ceil(t/864e5);return Math.max(0,i)})(N.endDate)," days"]})]})]})]}),p.jsxs("div",{children:[p.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Plan Features"}),p.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:N.features.map((e,s)=>{const a="string"==typeof e?e:"object"==typeof e&&null!==e&&"name"in e?e.name:String(e);return p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsx(d,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),p.jsx("span",{className:"text-sm",children:String(a)})]},s)})})]}),N.addons&&N.addons.length>0&&p.jsxs("div",{children:[p.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Purchased Add-ons"}),p.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:N.addons.map((e,s)=>p.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200",children:[p.jsxs("div",{className:"flex items-center space-x-3",children:[p.jsx("div",{className:"p-1.5 rounded bg-blue-100",children:p.jsx(d,{className:"w-4 h-4 text-blue-600"})}),p.jsxs("div",{children:[p.jsx("p",{className:"font-medium text-sm",children:e.name}),p.jsx("p",{className:"text-xs text-gray-600 capitalize",children:e.category})]})]}),p.jsxs("div",{className:"text-right",children:[p.jsxs("p",{className:"font-semibold text-blue-600",children:["₹",e.price.toLocaleString()]}),p.jsx("p",{className:"text-xs text-gray-500",children:e.billingType.replace("_"," ").replace("per property","per listing")})]})]},s))})]}),N.amount&&p.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-gray-600 dark:text-black",children:"Total Amount"}),p.jsxs("p",{className:"font-semibold text-lg dark:text-black",children:["₹",N.amount.toLocaleString()]})]}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-gray-600 dark:text-black",children:"Billing"}),p.jsx("p",{className:"font-medium dark:text-black",children:N.billingCycle})]})]})}),p.jsxs("div",{className:"flex space-x-4",children:[p.jsx(s,{variant:"outline",onClick:()=>L("/vendor/subscription-plans"),children:"Upgrade Plan"}),p.jsx(s,{variant:"outline",onClick:()=>L("/vendor/billing"),children:"View Billing"})]})]})]}):p.jsx(t,{children:p.jsxs(n,{className:"text-center py-12",children:[p.jsx(o,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),p.jsx("h2",{className:"text-2xl font-bold mb-2",children:"No Active Subscription"}),p.jsx("p",{className:"text-gray-600 mb-6",children:"Choose a subscription plan to get started with premium features"}),p.jsx(s,{onClick:()=>L("/vendor/subscription-plans"),children:"Choose Plan"})]})}),p.jsxs(t,{children:[p.jsx(i,{children:p.jsxs(r,{className:"flex items-center justify-between",children:[p.jsx("span",{children:"Available Addon Services"}),_.length>0&&p.jsxs(l,{variant:"outline",children:[_.length," selected"]})]})}),p.jsxs(n,{children:[p.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:(()=>{N?.addons?.map(e=>e._id);return w.filter(e=>!N?.addons?.some(s=>s._id===e._id))})().map(e=>{const s=_.some(s=>s._id===e._id);return p.jsxs(t,{className:"cursor-pointer transition-all duration-200 hover:shadow-md "+(s?"ring-2 ring-blue-500 bg-blue-50":""),onClick:()=>z(e),children:[p.jsxs(i,{className:"pb-3",children:[p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsx(r,{className:"text-lg",children:e.name}),s?p.jsx(d,{className:"w-6 h-6 text-blue-600"}):p.jsx(m,{className:"w-6 h-6 text-gray-400"})]}),p.jsxs("div",{className:"text-xl font-bold text-blue-600",children:["₹",e.price.toLocaleString(),p.jsxs("span",{className:"text-sm text-gray-500 font-normal",children:["/",e.billingType.replace("_"," ").replace("per property","per listing")]})]})]}),p.jsxs(n,{children:[p.jsx("p",{className:"text-gray-600 text-sm mb-3",children:e.description}),p.jsx(l,{variant:"outline",className:"capitalize",children:e.category})]})]},e._id)})}),N&&w.length>0&&w.every(e=>N.addons?.some(s=>s._id===e._id))&&p.jsxs("div",{className:"text-center py-8",children:[p.jsx(d,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),p.jsx("h3",{className:"text-lg font-semibold mb-2",children:"All Addons Purchased!"}),p.jsx("p",{className:"text-gray-600",children:"You have already purchased all available addon services."})]}),_.length>0&&p.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:p.jsxs("div",{className:"flex items-center justify-between",children:[p.jsxs("div",{children:[p.jsxs("p",{className:"font-semibold",children:[_.length," addon(s) selected"]}),p.jsxs("p",{className:"text-sm text-gray-600",children:["Total: ₹",B().toLocaleString()]})]}),p.jsx(s,{onClick:async()=>{if(0!==_.length)if(N){D(!0);try{const s={addons:_.map(e=>e._id),totalAmount:B()},a=await v.processAddonPayment(s);if(!a.success)throw new Error(a.message||"Payment failed");T({title:"Addons Purchased Successfully!",description:`Successfully purchased ${_.length} addon service(s)`}),A([]),E();try{const{vendorService:e}=await h(async()=>{const{vendorService:e}=await import("./vendorService-BBU9_Mqe.js");return{vendorService:e}},__vite__mapDeps([0,1,2,3,4,5]));await e.refreshSubscriptionData()}catch(e){}}catch(s){T({title:"Purchase Failed",description:s instanceof Error?s.message:"Failed to purchase addons",variant:"destructive"})}finally{D(!1)}}else T({title:"No active subscription",description:"Please subscribe to a plan first before purchasing addons",variant:"destructive"});else T({title:"No addons selected",description:"Please select at least one addon to purchase",variant:"destructive"})},disabled:C,size:"lg",children:C?"Processing...":`Purchase Addons - ₹${B().toLocaleString()}`})]})})]})]})]})};export{N as default};

import{j as e}from"./ui-s1SEoZIF.js";import{r as s}from"./router-D8v2YSKU.js";import{u as a,t as i,o as t,s as r,d as l}from"./types-KiqUWZa9.js";import{a2 as d,u as c,G as o,f as n,al as p,am as m,an as h,a as x,b as f,c as u,d as j,e as g,ao as N,ap as v,aq as y,B as C,g as b,x as w,M as E,S,af as P,ag as z,ah as k,ai as A,L as F,I as M,T as _,k as D,K as U}from"./index-CJkfZmVJ.js";import{P as I}from"./PasswordChangeDialog-BwEbM1vL.js";import{P as V}from"./PincodeAutocomplete-Fw4fZdtc.js";import{u as R}from"./uploadService-C_cH8Ofp.js";import{C as T}from"./camera-DCAybF5C.js";import"./vendor-BxThA0WO.js";import"./alert-DAXS2Fru.js";import"./input-otp-B1TdT9sA.js";import"./key-DaxqUxu6.js";import"./eye-off-Fn7jj4AE.js";const B=t({first_name:r().min(2,"First name must be at least 2 characters"),last_name:r().optional(),email:r().email("Invalid email address"),phone:r().regex(/^[0-9]{10}$/,"Must be exactly 10 digits").min(10,"Must be exactly 10 digits").max(10,"Must be exactly 10 digits"),birthday:l().optional(),bio:r().optional(),department:r().optional(),designation:r().optional(),street:r().optional(),state:r().optional(),district:r().optional(),city:r().optional(),zipCode:r().optional().refine(e=>!e||/^[0-9]{6}$/.test(e),"Pincode must be exactly 6 digits")}),L=()=>{const{toast:t}=d(),{user:r,checkAuth:l}=c(),[L,G]=s.useState(!0),[O,$]=s.useState(!1),[q,K]=s.useState(!1),[Q,W]=s.useState(!1),[H,J]=s.useState(null),[X,Y]=s.useState(null),[Z,ee]=s.useState(""),[se,ae]=s.useState(!1),[ie,te]=s.useState("profile"),[re,le]=s.useState(!1),de=s.useRef(null),ce=a({resolver:i(B),defaultValues:{first_name:"",last_name:"",email:"",phone:"",bio:"",department:"",designation:"",street:"",state:"",district:"",city:"",zipCode:""}}),oe=s.useCallback(async()=>{if(r)try{G(!0),J(r),Y(r),ee(r?.profile?.avatar||""),ce.reset({first_name:r?.profile?.firstName||"",last_name:r?.profile?.lastName||"",email:r?.email||"",phone:r?.profile?.phone||"",birthday:r?.profile?.birthday?new Date(r.profile.birthday):void 0,bio:r?.profile?.bio||"",department:r?.profile?.department||"",designation:r?.profile?.designation||"",street:r?.profile?.address?.street||"",state:r?.profile?.address?.state||"",district:r?.profile?.address?.district||"",city:r?.profile?.address?.city||"",zipCode:r?.profile?.address?.zipCode||r?.profile?.address?.pincode||""})}catch(e){t({variant:"destructive",title:"Error",description:"Failed to load profile"})}finally{G(!1)}},[r,ce,t]);s.useEffect(()=>{oe()},[oe]);const ne=(e,s)=>{if(!X)return;const a=e.split("."),i={...X};let t=i;for(let r=0;r<a.length-1;r++)t[a[r]]||(t[a[r]]={}),t=t[a[r]];t[a[a.length-1]]=s,Y(i)},pe=e=>e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ");return L?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(o,{className:"h-8 w-8 animate-spin"})}):e.jsxs("div",{className:"container mx-auto p-6 max-w-6xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"My Profile"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your account settings"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{onClick:async()=>{K(!0),await oe(),K(!1),t({title:"Success",description:"Profile refreshed successfully"})},variant:"outline",size:"sm",disabled:q,children:[e.jsx(p,{className:m("h-4 w-4 mr-2",q&&"animate-spin")}),"Refresh"]}),Q?e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"outline",size:"sm",onClick:()=>{Y(H),W(!1)},disabled:O,children:"Cancel"}),e.jsx(n,{size:"sm",onClick:async()=>{if(X)try{$(!0);const e={profile:{firstName:X.profile?.firstName,lastName:X.profile?.lastName,phone:X.profile?.phone,birthday:X.profile?.birthday,bio:X.profile?.bio,department:X.profile?.department,designation:X.profile?.designation,address:{street:X.profile?.address?.street,state:X.profile?.address?.state,district:X.profile?.address?.district,city:X.profile?.address?.city,zipCode:X.profile?.address?.zipCode},preferences:X.profile?.preferences||{notifications:{email:!0,sms:!1,push:!0},privacy:{showEmail:!1,showPhone:!1},security:{twoFactorEnabled:!1,loginAlerts:!0,sessionTimeout:"30"}}}};await U.updateCurrentUser(e),await l(),await oe(),W(!1),t({title:"Success",description:"Profile updated successfully"})}catch(e){t({variant:"destructive",title:"Error",description:e.response?.data?.message||e.message||"Failed to update profile"})}finally{$(!1)}},disabled:O,children:O?e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"Save"]})})]}):e.jsx(n,{size:"sm",onClick:()=>W(!0),children:"Edit Profile"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(x,{className:"lg:col-span-1",children:[e.jsxs(f,{children:[e.jsx(u,{children:"Profile Picture"}),e.jsx(j,{children:"Update your avatar"})]}),e.jsxs(g,{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(N,{className:"h-32 w-32",children:[e.jsx(v,{src:Z,alt:H?.profile?.firstName}),e.jsx(y,{className:"text-2xl",children:(me=H?.profile?.firstName,he=H?.profile?.lastName,((me?.charAt(0)||"")+(he?.charAt(0)||"")).toUpperCase()||"?")})]}),e.jsx(n,{size:"sm",variant:"secondary",className:"absolute bottom-0 right-0 rounded-full h-10 w-10 p-0",onClick:()=>de.current?.click(),disabled:re,children:re?e.jsx(o,{className:"h-4 w-4 animate-spin"}):e.jsx(T,{className:"h-4 w-4"})}),e.jsx("input",{ref:de,type:"file",accept:"image/*",className:"hidden",onChange:async e=>{const s=e.target.files?.[0];if(s)if(s.type.startsWith("image/"))if(s.size>5242880)t({variant:"destructive",title:"Error",description:"Image size must be less than 5MB"});else try{le(!0);const e=await R.uploadAvatar(s);await U.updateCurrentUser({profile:{...r?.profile,avatar:e,preferences:r?.profile?.preferences||{notifications:{email:!0,sms:!1,push:!0},privacy:{showEmail:!1,showPhone:!1},security:{twoFactorEnabled:!1,loginAlerts:!0,sessionTimeout:"30"}}}}),ee(e),await l(),t({title:"Success",description:"Avatar updated successfully"})}catch(a){t({variant:"destructive",title:"Error",description:a.message||"Failed to upload avatar"})}finally{le(!1)}else t({variant:"destructive",title:"Error",description:"Please upload an image file"})}})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:[H?.profile?.firstName," ",H?.profile?.lastName]}),e.jsx(C,{variant:"secondary",children:pe(H?.role)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:H?.email})]}),e.jsx(b,{}),e.jsxs("div",{className:"w-full space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Role:"}),e.jsx("span",{className:"font-medium",children:pe(H?.role)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Email:"}),e.jsx("span",{className:"font-medium",children:H?.emailVerified?"Verified":"Not Verified"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Status:"}),e.jsx(C,{variant:"active"===H?.status?"default":"destructive",children:H?.status})]})]})]})]}),e.jsxs(x,{className:"lg:col-span-2",children:[e.jsxs(f,{children:[e.jsx(u,{children:"Account Information"}),e.jsx(j,{children:"Update your personal details"})]}),e.jsx(g,{children:e.jsxs(P,{value:ie,onValueChange:te,children:[e.jsxs(z,{className:"grid w-full grid-cols-2",children:[e.jsx(k,{value:"profile",children:"Profile"}),e.jsx(k,{value:"security",children:"Security"})]}),e.jsx(A,{value:"profile",className:"space-y-4 mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"First Name"}),Q?e.jsx(M,{value:X?.profile?.firstName||"",onChange:e=>ne("profile.firstName",e.target.value),placeholder:"Enter first name"}):e.jsx("p",{className:"text-sm py-2",children:H?.profile?.firstName||"Not set"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Last Name"}),Q?e.jsx(M,{value:X?.profile?.lastName||"",onChange:e=>ne("profile.lastName",e.target.value),placeholder:"Enter last name"}):e.jsx("p",{className:"text-sm py-2",children:H?.profile?.lastName||"Not set"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Email"}),Q?e.jsx(M,{type:"email",value:X?.email||"",onChange:e=>Y(s=>s?{...s,email:e.target.value}:null),placeholder:"Enter email"}):e.jsx("p",{className:"text-sm py-2",children:H?.email||"Not set"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Phone"}),Q?e.jsx(M,{value:X?.profile?.phone||"",onChange:e=>ne("profile.phone",e.target.value),placeholder:"Enter phone number"}):e.jsx("p",{className:"text-sm py-2",children:H?.profile?.phone||"Not set"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Department"}),Q?e.jsx(M,{value:X?.profile?.department||"",onChange:e=>ne("profile.department",e.target.value),placeholder:"e.g., Sales, Marketing"}):e.jsx("p",{className:"text-sm py-2",children:H?.profile?.department||"Not set"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Designation"}),Q?e.jsx(M,{value:X?.profile?.designation||"",onChange:e=>ne("profile.designation",e.target.value),placeholder:"e.g., Manager, Executive"}):e.jsx("p",{className:"text-sm py-2",children:H?.profile?.designation||"Not set"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Bio"}),Q?e.jsx(_,{value:X?.profile?.bio||"",onChange:e=>ne("profile.bio",e.target.value),rows:3,placeholder:"Tell us about yourself"}):e.jsx("p",{className:"text-sm py-2",children:H?.profile?.bio||"Not set"})]}),e.jsx(b,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Address Information"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Street Address"}),Q?e.jsx(M,{value:X?.profile?.address?.street||"",onChange:e=>ne("profile.address.street",e.target.value),placeholder:"Enter street address"}):e.jsx("p",{className:"text-sm py-2",children:H?.profile?.address?.street||"Not set"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Pincode"}),Q?e.jsx(V,{value:X?.profile?.address?.zipCode||"",onChange:(e,s)=>{ne("profile.address.zipCode",e),s&&(ne("profile.address.state",s.state),ne("profile.address.district",s.district),ne("profile.address.city",s.city))}}):e.jsx("p",{className:"text-sm py-2",children:H?.profile?.address?.zipCode||"Not set"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"State"}),Q?e.jsx(M,{value:X?.profile?.address?.state||"",onChange:e=>ne("profile.address.state",e.target.value),placeholder:"Enter state"}):e.jsx("p",{className:"text-sm py-2",children:H?.profile?.address?.state||"Not set"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"District"}),Q?e.jsx(M,{value:X?.profile?.address?.district||"",onChange:e=>ne("profile.address.district",e.target.value),placeholder:"Enter district"}):e.jsx("p",{className:"text-sm py-2",children:H?.profile?.address?.district||"Not set"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"City"}),Q?e.jsx(M,{value:X?.profile?.address?.city||"",onChange:e=>ne("profile.address.city",e.target.value),placeholder:"Enter city"}):e.jsx("p",{className:"text-sm py-2",children:H?.profile?.address?.city||"Not set"})]})]})]})]})}),e.jsx(A,{value:"security",className:"space-y-4 mt-4",children:e.jsxs(x,{children:[e.jsxs(f,{children:[e.jsx(u,{children:"Password"}),e.jsx(j,{children:"Change your account password"})]}),e.jsx(g,{children:e.jsx(n,{onClick:()=>ae(!0),children:"Change Password"})})]})})]})})]})]}),e.jsx(I,{open:se,onOpenChange:ae})]});var me,he};export{L as default};

import{j as e}from"./ui-CEFKCYQo.js";import{r as s}from"./router-Bi51YGN-.js";import{a1 as a,aD as t,S as l,r,s as i,v as c,w as n,a as d,e as m,au as o,b as x,c as p,B as u,x as h,M as j,n as f,a5 as N,f as g,E as v,W as y,Y as k,Z as w,_ as b,$ as S,a2 as C,L as T,T as _}from"./index-DbnZmv1f.js";import{s as R}from"./subAdminService-CiNgAnD3.js";import"./vendor-eVk5PToZ.js";const A=()=>{const[A,E]=s.useState([]),[F,M]=s.useState(!0),[P,D]=s.useState("open"),[z,L]=s.useState(1),[O,$]=s.useState(1),[q,I]=s.useState(null),[V,Y]=s.useState(!1),[B,W]=s.useState(!1),[Z,G]=s.useState(""),[H,J]=s.useState(!1),{toast:K}=a();s.useEffect(()=>{Q()},[z,P]);const Q=async()=>{try{M(!0);const e=await R.getSupportTickets(z,10,P);E(e.tickets),$(e.totalPages)}catch(e){K({title:"Error",description:e.message||"Failed to fetch support tickets",variant:"destructive"})}finally{M(!1)}};t("support_ticket_created",e=>{K({title:"New Support Ticket",description:"A new support ticket has been created"}),Q()}),t("support_ticket_updated",e=>{Q()}),t("message_received",e=>{"support"===e.type&&Q()});const U=e=>{switch(e){case"open":return"destructive";case"in_progress":case"in-progress":return"default";case"resolved":return"secondary";default:return"outline"}},X=e=>{switch(e){case"urgent":case"high":return"destructive";case"medium":return"default";case"low":return"secondary";default:return"outline"}},ee=e=>{I(e),W(!0)},se=async(e,s)=>{try{J(!0),await R.updateSupportTicket(e,s,""),K({title:"Success",description:`Ticket marked as ${s.replace("_"," ")}`}),Q()}catch(a){K({title:"Error",description:a.message||"Failed to update ticket status",variant:"destructive"})}finally{J(!1)}};return F&&0===A.length?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Support Tickets"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage customer support requests and complaints"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Support Tickets"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage customer support requests and complaints"})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-4",children:e.jsxs(l,{value:P,onValueChange:D,children:[e.jsx(r,{className:"w-full sm:w-48",children:e.jsx(i,{placeholder:"Filter by status"})}),e.jsxs(c,{children:[e.jsx(n,{value:"open",children:"Open Tickets"}),e.jsx(n,{value:"in-progress",children:"In Progress"}),e.jsx(n,{value:"resolved",children:"Resolved"}),e.jsx(n,{value:"closed",children:"Closed"}),e.jsx(n,{value:"all",children:"All Tickets"})]})]})}),e.jsx("div",{className:"space-y-4",children:0===A.length?e.jsx(d,{children:e.jsxs(m,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(o,{className:"h-12 w-12 text-blue-500 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Support Tickets"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"open"===P?"No open support tickets at the moment.":`No ${P} tickets found.`})]})}):A.map(s=>e.jsxs(d,{children:[e.jsx(x,{children:e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[e.jsxs(p,{className:"text-lg",children:[s.ticketNumber&&e.jsxs("span",{className:"text-muted-foreground mr-2",children:["#",s.ticketNumber]}),s.subject||"Support Request"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx(u,{variant:U(s.status),children:s.status.replace("_"," ")}),s.priority&&e.jsx(u,{variant:X(s.priority),children:s.priority}),s.category&&e.jsx(u,{variant:"outline",children:s.category})]})]}),e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(h,{className:"h-3 w-3 flex-shrink-0"}),e.jsxs("span",{className:"truncate",children:[s.sender.profile.firstName," ",s.sender.profile.lastName]})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.sender.email})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(f,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:new Date(s.createdAt).toLocaleDateString()})]})]})})]})})}),e.jsxs(m,{className:"space-y-4",children:[e.jsx("div",{className:"bg-muted p-3 sm:p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(N,{className:"h-4 w-4 mt-1 text-muted-foreground flex-shrink-0"}),e.jsx("p",{className:"text-sm leading-relaxed break-words",children:s.message})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>(e=>{I(e),Y(!0)})(s),className:"flex-1 touch-manipulation min-h-[40px]",children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"View Full Conversation"]}),e.jsxs(g,{size:"sm",onClick:()=>ee(s),className:"flex-1 touch-manipulation min-h-[40px]",children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Reply"]}),"open"===s.status&&e.jsx(g,{size:"sm",variant:"secondary",onClick:()=>se(s._id,"in-progress"),disabled:H,className:"flex-1 touch-manipulation min-h-[40px]",children:"Mark In Progress"}),"in-progress"===s.status&&e.jsx(g,{size:"sm",variant:"secondary",onClick:()=>se(s._id,"resolved"),disabled:H,className:"flex-1 touch-manipulation min-h-[40px]",children:"Mark Resolved"})]})]})]},s._id))}),O>1&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-2",children:[e.jsx(g,{variant:"outline",disabled:1===z,onClick:()=>L(z-1),className:"w-full sm:w-auto",children:"Previous"}),e.jsxs("span",{className:"px-3 py-2 text-sm text-center",children:["Page ",z," of ",O]}),e.jsx(g,{variant:"outline",disabled:z===O,onClick:()=>L(z+1),className:"w-full sm:w-auto",children:"Next"})]}),e.jsx(y,{open:V,onOpenChange:Y,children:e.jsxs(k,{className:"max-w-3xl max-h-[80vh] overflow-y-auto mx-4 sm:mx-auto",children:[e.jsxs(w,{children:[e.jsxs(b,{className:"text-lg sm:text-xl",children:[q?.ticketNumber&&`#${q.ticketNumber} - `,q?.subject||"Support Ticket"]}),e.jsxs(S,{className:"text-sm",children:["Conversation history with ",q?.sender.profile.firstName," ",q?.sender.profile.lastName]})]}),q&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsxs("span",{className:"font-semibold text-sm",children:[q.sender.profile.firstName," ",q.sender.profile.lastName]})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(q.createdAt).toLocaleString()})]}),e.jsx("p",{className:"text-sm",children:q.message})]}),q.responses&&q.responses.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Responses"}),q.responses.map((s,a)=>e.jsxs("div",{className:"p-4 rounded-lg "+(s.isAdmin?"bg-blue-50 dark:bg-blue-950":"bg-muted"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.isAdmin?e.jsx(o,{className:"h-4 w-4 text-blue-600"}):e.jsx(h,{className:"h-4 w-4"}),e.jsxs("span",{className:"font-semibold text-sm",children:[s.author,s.isAdmin&&e.jsx(u,{variant:"outline",className:"ml-2",children:"Support"})]})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleString()})]}),e.jsx("p",{className:"text-sm",children:s.message})]},a))]})]}),e.jsxs(C,{children:[e.jsx(g,{variant:"outline",onClick:()=>Y(!1),children:"Close"}),e.jsx(g,{onClick:()=>{Y(!1),q&&ee(q)},children:"Reply to Ticket"})]})]})}),e.jsx(y,{open:B,onOpenChange:W,children:e.jsxs(k,{className:"mx-4 sm:mx-auto",children:[e.jsxs(w,{children:[e.jsx(b,{className:"text-lg sm:text-xl",children:"Reply to Support Ticket"}),e.jsxs(S,{className:"text-sm",children:["Send a response to ",q?.sender.profile.firstName," ",q?.sender.profile.lastName]})]}),e.jsxs("div",{className:"space-y-4",children:[q&&e.jsxs("div",{className:"bg-muted p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm font-semibold mb-1",children:"Original Message:"}),e.jsx("p",{className:"text-sm",children:q.message})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"reply",children:"Your Response"}),e.jsx(_,{id:"reply",placeholder:"Type your response here...",value:Z,onChange:e=>G(e.target.value),rows:6,className:"mt-2"})]})]}),e.jsxs(C,{children:[e.jsx(g,{variant:"outline",onClick:()=>{W(!1),G("")},children:"Cancel"}),e.jsx(g,{onClick:async()=>{if(q&&Z.trim())try{J(!0),await R.updateSupportTicket(q._id,q.status,Z),K({title:"Success",description:"Reply sent successfully"}),W(!1),G(""),I(null),Q()}catch(e){K({title:"Error",description:e.message||"Failed to send reply",variant:"destructive"})}finally{J(!1)}else K({title:"Error",description:"Please enter a reply message",variant:"destructive"})},disabled:H||!Z.trim(),children:H?"Sending...":"Send Reply"})]})]})})]})};export{A as default};

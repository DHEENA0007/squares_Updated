import{j as e}from"./ui-DOY6021Z.js";import{r as d}from"./router-2SVJvIbS.js";import{A as J,av as re,t as k,aw as $,aF as q,f as x,D as E,q as y,r as w,s as S,v as b,w as i,a as u,e as h,T as ae,K as ce,L as M,ac as O,H as le,I as ie,B as C,aq as H,h as ne,O as oe,Q as de,R as me,y as xe,ai as B,o as V,$ as ue,J as U,aj as he,n as z,C as ge}from"./index-SPvHGBGF.js";import{D as pe,f as je,a as ve,b as fe,c as Ne}from"./dialog-LNpiSwLW.js";import{T as ye}from"./textarea-CVqyUzcD.js";import{L as T}from"./label-BbghIvjf.js";import{R as we}from"./refresh-cw-BxN4QFjr.js";import{C as Se}from"./circle-alert-DxF8stXX.js";import"./vendor-Dazix4UH.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=J("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=J("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]),Pe="https://squares-v2.onrender.com/api";class Re{async makeRequest(t,r={}){const a=`${Pe}${t}`,l={headers:{"Content-Type":"application/json",...r.headers},...r},o=localStorage.getItem("token");o&&(l.headers={...l.headers,Authorization:`Bearer ${o}`});try{const c=await fetch(a,l);if(!c.ok){const N=await c.json().catch(()=>({}));throw new Error(N.message||`${c.statusText} - ${t}`)}return await c.json()}catch(c){throw console.error("Service Request API request failed:",c),c}}async getServiceRequests(t={}){try{const r=new URLSearchParams;Object.entries(t).forEach(([o,c])=>{c!=null&&c!==""&&r.append(o,String(c))});const a=`/services/requests${r.toString()?`?${r.toString()}`:""}`,l=await this.makeRequest(a);return l.success&&l.data?l.data:{requests:[],pagination:{currentPage:1,totalPages:0,totalCount:0,hasNextPage:!1,hasPrevPage:!1,limit:10}}}catch(r){throw console.error("Failed to fetch service requests:",r),r}}async createServiceRequest(t){try{const r=await this.makeRequest("/services/requests",{method:"POST",body:JSON.stringify(t)});return r.success&&r.data?r.data.request:null}catch(r){throw console.error("Failed to create service request:",r),r}}async updateServiceRequest(t,r){try{const a=await this.makeRequest(`/services/requests/${t}`,{method:"PUT",body:JSON.stringify(r)});return a.success&&a.data?a.data.request:null}catch(a){throw console.error("Failed to update service request:",a),a}}async cancelServiceRequest(t,r){try{return(await this.makeRequest(`/services/requests/${t}/cancel`,{method:"POST",body:JSON.stringify({reason:r})})).success}catch(a){throw console.error("Failed to cancel service request:",a),a}}async rateServiceRequest(t,r,a){try{return(await this.makeRequest(`/services/requests/${t}/rate`,{method:"POST",body:JSON.stringify({rating:r,review:a})})).success}catch(l){throw console.error("Failed to rate service request:",l),l}}async getServiceProviders(t={}){try{const r=new URLSearchParams;Object.entries(t).forEach(([o,c])=>{c!=null&&c!==""&&r.append(o,String(c))});const a=`/services/providers${r.toString()?`?${r.toString()}`:""}`,l=await this.makeRequest(a);return l.success&&l.data?l.data:{providers:[],pagination:{currentPage:1,totalPages:0,totalCount:0,hasNextPage:!1,hasPrevPage:!1,limit:12}}}catch(r){throw console.error("Failed to fetch service providers:",r),r}}async getServiceCategories(){try{const t=await this.makeRequest("/services/categories");return t.success&&t.data?t.data.categories:[]}catch(t){throw console.error("Failed to fetch service categories:",t),t}}formatCurrency(t){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)}getServiceTypeLabel(t){return{home_loan:"Home Loans",movers:"Packers & Movers",legal:"Legal Services",interior:"Interior Design",cleaning:"Cleaning Services",security:"Security Services"}[t]||t}getStatusColor(t){return{pending:"bg-yellow-100 text-yellow-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"}[t]||"bg-gray-100 text-gray-800"}getPriorityColor(t){return{low:"bg-gray-100 text-gray-800",medium:"bg-orange-100 text-orange-800",high:"bg-red-100 text-red-800"}[t]||"bg-gray-100 text-gray-800"}getStatusText(t){return{pending:"Pending",in_progress:"In Progress",completed:"Completed",cancelled:"Cancelled"}[t]||t}}const g=new Re,Me=()=>{const{isConnected:P}=re(),[t,r]=d.useState("active"),[a,l]=d.useState(""),[o,c]=d.useState([]),[N,Q]=d.useState([]),[L,D]=d.useState(!0),[p,K]=d.useState("all"),[j,G]=d.useState("all"),[X,v]=d.useState(!1),[F,ke]=d.useState(1),[qe,W]=d.useState(1),R=d.useCallback(async()=>{try{D(!0);const s=await g.getServiceRequests({page:F,limit:10,status:p!=="all"?p:void 0,serviceType:j!=="all"?j:void 0,sortBy:"created_at",sortOrder:"desc"});c(s.requests||[]),W(s.pagination.totalPages)}catch(s){console.error("Error loading service requests:",s),k({title:"Error",description:"Failed to load service requests. Please try again.",variant:"destructive"})}finally{D(!1)}},[F,p,j]),I=d.useCallback(async()=>{try{const s=await g.getServiceCategories();Q(s||[])}catch(s){console.error("Error loading service categories:",s)}},[]);$("service_request_updated",s=>{c(n=>n.map(m=>m.id===s.requestId?{...m,...s.updates}:m))}),$("service_request_created",s=>{c(n=>[s.request,...n])}),d.useEffect(()=>{R(),I()},[R,I]);const Y=async s=>{try{if(!window.confirm("Are you sure you want to cancel this service request?"))return;await g.cancelServiceRequest(s),k({title:"Success",description:"Service request cancelled successfully"}),R()}catch(n){console.error("Error cancelling request:",n),k({title:"Error",description:"Failed to cancel request",variant:"destructive"})}},A=[{id:"home_loan",name:"Home Loans",icon:he,description:"Get competitive home loan rates",color:"bg-blue-500"},{id:"movers",name:"Packers & Movers",icon:Ce,description:"Professional moving services",color:"bg-green-500"},{id:"legal",name:"Legal Services",icon:V,description:"Property legal assistance",color:"bg-purple-500"},{id:"interior",name:"Interior Design",icon:H,description:"Transform your space",color:"bg-orange-500"}],Z=s=>g.getStatusText(s),ee=s=>{switch(s){case"pending":return z;case"in_progress":return Se;case"completed":return ge;case"cancelled":return U;default:return z}},se=s=>g.getStatusColor(s),_=o.filter(s=>{const n=s.title.toLowerCase().includes(a.toLowerCase())||s.description.toLowerCase().includes(a.toLowerCase()),m=p==="all"||s.status===p,te=j==="all"||s.serviceType===j;return n&&m&&te}),f={total:o.length,pending:o.filter(s=>s.status==="pending").length,inProgress:o.filter(s=>s.status==="in_progress").length,completed:o.filter(s=>s.status==="completed").length,totalAmount:o.reduce((s,n)=>s+(n.amount||0),0)};return e.jsxs("div",{className:"space-y-6 pt-16",children:[e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${P?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-sm text-muted-foreground",children:P?"Real-time service updates active":"Offline mode"})]}),L&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"}),"Loading requests..."]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(q,{className:"w-8 h-8 text-primary"}),"Service Requests"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Request and manage property-related services"})]}),e.jsxs(pe,{open:X,onOpenChange:v,children:[e.jsx(je,{asChild:!0,children:e.jsxs(x,{children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"New Request"]})}),e.jsxs(ve,{children:[e.jsx(fe,{children:e.jsx(Ne,{children:"Request New Service"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(T,{children:"Service Type"}),e.jsxs(y,{children:[e.jsx(w,{children:e.jsx(S,{placeholder:"Select service type"})}),e.jsxs(b,{children:[e.jsx(i,{value:"home_loan",children:"Home Loan"}),e.jsx(i,{value:"movers",children:"Packers & Movers"}),e.jsx(i,{value:"legal",children:"Legal Services"}),e.jsx(i,{value:"interior",children:"Interior Design"})]})]})]}),e.jsxs("div",{children:[e.jsx(T,{children:"Description"}),e.jsx(ye,{placeholder:"Describe your requirements..."})]}),e.jsxs("div",{children:[e.jsx(T,{children:"Property (Optional)"}),e.jsxs(y,{children:[e.jsx(w,{children:e.jsx(S,{placeholder:"Select property"})}),e.jsxs(b,{children:[e.jsx(i,{value:"1",children:"Luxury 3BHK Apartment - Powai"}),e.jsx(i,{value:"2",children:"Modern Villa - Baner"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{onClick:()=>v(!1),className:"flex-1",children:"Submit Request"}),e.jsx(x,{variant:"outline",onClick:()=>v(!1),children:"Cancel"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(u,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:f.total}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Requests"})]})})}),e.jsx(u,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:f.pending}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending"})]})})}),e.jsx(u,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:f.inProgress}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"In Progress"})]})})}),e.jsx(u,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:f.completed}),e.jsx("p",{className:"text-sm text-muted-forequest",children:"Completed"})]})})}),e.jsx(u,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-2xl font-bold",children:["₹",(f.totalAmount/1e5).toFixed(1),"L"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Value"})]})})})]}),e.jsxs(ae,{defaultValue:"requests",className:"space-y-6",children:[e.jsxs(ce,{children:[e.jsx(M,{value:"requests",children:"My Requests"}),e.jsx(M,{value:"services",children:"Browse Services"})]}),e.jsxs(O,{value:"requests",className:"space-y-6",children:[e.jsx(u,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ie,{type:"text",placeholder:"Search requests...",className:"pl-10",value:a,onChange:s=>l(s.target.value)})]}),e.jsxs(y,{value:p,onValueChange:s=>K(s),children:[e.jsx(w,{className:"w-full sm:w-40",children:e.jsx(S,{placeholder:"Status"})}),e.jsxs(b,{children:[e.jsx(i,{value:"all",children:"All Status"}),e.jsx(i,{value:"pending",children:"Pending"}),e.jsx(i,{value:"in_progress",children:"In Progress"}),e.jsx(i,{value:"completed",children:"Completed"}),e.jsx(i,{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs(y,{value:j,onValueChange:G,children:[e.jsx(w,{className:"w-full sm:w-40",children:e.jsx(S,{placeholder:"Service"})}),e.jsxs(b,{children:[e.jsx(i,{value:"all",children:"All Services"}),e.jsx(i,{value:"home_loan",children:"Home Loans"}),e.jsx(i,{value:"movers",children:"Movers"}),e.jsx(i,{value:"legal",children:"Legal"}),e.jsx(i,{value:"interior",children:"Interior"})]})]})]})})}),e.jsx("div",{className:"space-y-4",children:L?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(we,{className:"w-8 h-8 animate-spin mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading service requests..."})]}):_.length===0?e.jsx(u,{children:e.jsxs(h,{className:"p-12 text-center",children:[e.jsx(q,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No service requests found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:a||p!=="all"||j!=="all"?"Try adjusting your filters":"Create your first service request to get started"}),e.jsxs(x,{onClick:()=>v(!0),children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"New Request"]})]})}):_.map(s=>{const n=ee(s.status);return e.jsx(u,{children:e.jsx(h,{className:"p-6",children:e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-start gap-6",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"text-xl font-semibold",children:s.title}),e.jsx(C,{variant:"outline",className:"text-xs",children:g.getServiceTypeLabel(s.serviceType)})]}),e.jsx("p",{className:"text-muted-foreground mb-3",children:s.description}),s.property&&e.jsxs("div",{className:"bg-muted/50 p-3 rounded-lg mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(H,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:s.property.title})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.property.city,", ",s.property.state]})]})]}),s.provider&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg mb-3",children:[e.jsxs(oe,{children:[e.jsx(de,{src:s.provider.avatar}),e.jsx(me,{children:s.provider.name.substring(0,2)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.provider.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(xe,{className:"w-3 h-3"}),e.jsx("span",{children:s.provider.phone}),s.provider.rating&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx(B,{className:"w-3 h-3 fill-yellow-400 text-yellow-400"}),e.jsx("span",{children:s.provider.rating.toFixed(1)})]})]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs(C,{className:`${se(s.status)} mb-2`,children:[e.jsx(n,{className:"w-3 h-3 mr-1"}),Z(s.status)]}),s.amount&&e.jsx(e.Fragment,{children:e.jsx("p",{className:"text-2xl font-bold text-primary",children:g.formatCurrency(s.amount)})}),s.priority&&e.jsx(C,{variant:"outline",className:`mt-2 ${g.getPriorityColor(s.priority)}`,children:s.priority.toUpperCase()})]})]}),s.status==="in_progress"&&s.progress!==void 0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"Progress"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.progress,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${s.progress}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm text-muted-foreground mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block",children:"Created"}),e.jsx("span",{className:"font-medium",children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block",children:"Updated"}),e.jsx("span",{className:"font-medium",children:new Date(s.updatedAt).toLocaleDateString()})]}),s.estimatedCompletion&&e.jsxs("div",{children:[e.jsx("span",{className:"block",children:"Est. Completion"}),e.jsx("span",{className:"font-medium",children:new Date(s.estimatedCompletion).toLocaleDateString()})]})]}),s.documents&&s.documents.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-sm font-medium mb-2",children:"Documents"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.documents.map(m=>e.jsxs(C,{variant:"outline",className:"text-xs",children:[e.jsx(V,{className:"w-3 h-3 mr-1"}),m.document_type]},m.id))})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.provider&&e.jsxs(x,{size:"sm",variant:"outline",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Contact Provider"]}),s.status==="pending"&&e.jsxs(x,{size:"sm",variant:"destructive",onClick:()=>Y(s.id),children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Cancel Request"]}),s.status==="completed"&&e.jsxs(x,{size:"sm",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Rate Service"]}),e.jsxs(x,{size:"sm",variant:"outline",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"View Details"]})]})]})})})},s.id)})})]}),e.jsx(O,{value:"services",className:"space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(N.length>0?N:A).map(s=>{const n=A.find(m=>m.id===s.id)?.icon||q;return e.jsx(u,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`${s.color||"bg-primary"} w-16 h-16 rounded-lg flex items-center justify-center mx-auto mb-4`,children:e.jsx(n,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s.name}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:s.description}),e.jsx("div",{className:"space-y-2 text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Providers:"}),e.jsx("span",{className:"font-semibold",children:s.providerCount||0})]})}),e.jsx(x,{className:"w-full mt-4",onClick:()=>v(!0),children:"Request Service"})]})})},s.id)})})})]})]})};export{Me as default};

import{j as e}from"./ui-BNZSgpjP.js";import{r as s,d as t,h as a}from"./router-D8v2YSKU.js";import{a2 as r,aL as l,a as i,e as n,$ as o,I as c,L as d,q as m,r as x,s as u,v as p,w as h,f,G as g,J as y,a1 as j,B as v,k as N,bP as b,bQ as w,a3 as S,l as T}from"./index-CM8T-gRV.js";import{C}from"./checkbox-CHt0TJj6.js";import{f as F}from"./favoriteService-BJOMEB2d.js";import{S as _}from"./square-Yal29bIt.js";import"./vendor-BxThA0WO.js";const k=({value:t,onChange:a})=>{const[r,l]=s.useState(t||""),[i,n]=s.useState([]),[d,m]=s.useState(!1),[x,u]=s.useState(!1),[p,h]=s.useState(T.isReady()),f=s.useRef(null);s.useEffect(()=>{T.initialize().then(()=>h(!0))},[]),s.useEffect(()=>{void 0!==t&&l(t)},[t]),s.useEffect(()=>{const e=e=>{f.current&&!f.current.contains(e.target)&&m(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);return e.jsxs("div",{ref:f,className:"relative w-full",children:[e.jsxs("div",{className:"relative",children:[e.jsx(o,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(c,{placeholder:p?"Search Location...":"Loading...",value:r,onChange:e=>{const s=e.target.value;if(l(s),s.length<2)return n([]),void m(!1);u(!0),setTimeout(()=>{const e=T.searchLocations(s);n(e),u(!1),m(!0)},100)},className:"pl-10",disabled:!p,onFocus:()=>{r.length>=2&&m(!0)},onKeyDown:e=>{"Enter"===e.key&&(a(r),m(!1))}}),x&&e.jsx("div",{className:"absolute right-3 top-3",children:e.jsx(g,{className:"h-4 w-4 animate-spin text-muted-foreground"})})]}),d&&e.jsx("div",{className:"absolute z-[100] w-full mt-1 bg-popover border rounded-md shadow-md max-h-[200px] overflow-y-auto bg-white dark:bg-slate-950",children:i.length>0?i.map((s,t)=>e.jsxs("div",{className:"px-3 py-2 text-sm cursor-pointer hover:bg-accent hover:text-accent-foreground border-b last:border-0",onClick:()=>(e=>{l(e.city),a(e.city),m(!1)})(s),children:[e.jsx("div",{className:"font-medium",children:s.city}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.district,", ",s.state]})]},`${s.pincode}-${t}`)):e.jsx("div",{className:"px-3 py-2 text-sm text-muted-foreground text-center",children:"No locations found"})})]})},L=()=>{const[T,L]=s.useState([]),[P,$]=s.useState([]),[E,A]=s.useState([]),V=t(),{toast:M}=r(),[z]=a(),[O,D]=s.useState([]),[R,q]=s.useState(!0),[B,K]=s.useState(""),[U,I]=s.useState(""),[G,J]=s.useState("all"),[Q,W]=s.useState("all"),[H,X]=s.useState([0,2e7]),[Y,Z]=s.useState([0,1e4]),[ee,se]=s.useState([]),[te,ae]=s.useState({}),[re,le]=s.useState(1),[ie,ne]=s.useState(1),[oe,ce]=s.useState(new Set),de=s.useMemo(()=>{const e=Array.from(new Set(P.map(e=>e.filterType))),s=["location","listing_type","property_type"];return e.sort((e,t)=>{const a=s.includes(e),r=s.includes(t);return a&&!r?-1:!a&&r?1:a&&r?s.indexOf(e)-s.indexOf(t):e.localeCompare(t)})},[P]),[me,xe]=s.useState({min:0,max:5e7}),[ue,pe]=s.useState({min:0,max:1e4}),[he,fe]=s.useState([]),[ge,ye]=s.useState([]);s.useEffect(()=>{(async()=>{try{const[e,s,t,a]=await Promise.all([S.getAllPropertyTypes(!1),S.getAllFilterConfigurations(!1),S.getFilterDependencies(),S.getFilterOptionVisibility()]);L(e),$(s),fe(t),ye(a);const r=s.filter(e=>"budget"===e.filterType);if(r.length>0){const e=Math.min(...r.map(e=>e.minValue||0)),s=Math.max(...r.map(e=>e.maxValue||0));s>0&&(xe({min:e,max:s}),X([e,s]))}const l=s.filter(e=>"area"===e.filterType);if(l.length>0){const e=Math.min(...l.map(e=>e.minValue||0)),s=Math.max(...l.map(e=>e.maxValue||0));s>0&&(pe({min:e,max:s}),Z([e,s]))}}catch(e){}})()},[]);s.useEffect(()=>{T.length>0&&(async()=>{try{if("all"===Q){const e=await S.getAllAmenities(!1);A(e)}else{const e=T.find(e=>e.value===Q);if(e){const s=await S.getPropertyTypeAmenities(e._id);A(s)}else A([])}}catch(e){A([])}})()},[Q,T]),s.useEffect(()=>{const e=z.get("q"),s=z.get("listingType"),t=z.get("propertyType");e&&K(e),s&&"all"!==s&&J(s),t&&"all"!==t&&W(t),le(1)},[z]),s.useEffect(()=>{je()},[B,U,G,Q,H,Y,ee,te,re]);const je=async()=>{q(!0);try{const e={page:re,limit:12};B.trim()&&(e.search=B),U.trim()&&(e.location=U),"all"!==G&&(e.listingType=G),"all"!==Q&&(e.propertyType=Q),Object.entries(te).forEach(([s,t])=>{t&&"any"!==t&&(e[s]=t)}),H[0]>me.min&&(e.minPrice=H[0]),H[1]<me.max&&(e.maxPrice=H[1]),Y[0]>ue.min&&(e.minArea=Y[0]),Y[1]<ue.max&&(e.maxArea=Y[1]),ee.length>0&&(e.amenities=ee);const s=await l.getProperties(e);s.success&&(D(s.data.properties),ne(s.data.pagination.totalPages))}catch(e){M({title:"Error",description:"Failed to load properties",variant:"destructive"})}finally{q(!1)}};s.useEffect(()=>{ve()},[]);const ve=async()=>{try{const e=await F.getFavorites();if(e.success){const s=new Set(e.data.favorites.map(e=>e.property?._id).filter(Boolean));ce(s)}}catch(e){}},Ne=()=>{K(""),I(""),J("all"),W("all"),X([me.min,me.max]),Z([ue.min,ue.max]),se([]),ae({}),le(1)},be=e=>{const s=P.find(s=>s.value===e&&("listing_type"===s.filterType||"listingType"===s.filterType));return s?s.displayLabel||s.name:e.charAt(0).toUpperCase()+e.slice(1)},we=e=>e>=1e7?`₹${(e/1e7).toFixed(2)} Cr`:e>=1e5?`₹${(e/1e5).toFixed(2)} L`:`₹${e.toLocaleString()}`;return e.jsxs("div",{className:"min-h-screen",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary/10 to-primary/5 border-b",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Search Properties"}),e.jsx("p",{className:"text-muted-foreground",children:"Find your dream property from our verified listings"})]})}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("aside",{className:"lg:w-80 flex-shrink-0",children:e.jsx(i,{className:"sticky top-20 max-h-[calc(100vh-6rem)] overflow-y-auto",children:e.jsxs(n,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Filters"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Location"}),e.jsx(k,{value:U,onChange:I})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Keyword Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(o,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(c,{placeholder:"Property name, ID...",value:B,onChange:e=>K(e.target.value),className:"pl-10"})]})]}),de.filter(e=>(e=>{const s=he.find(s=>s.targetFilterType===e);if(!s)return!0;let t;return t="property_type"===s.sourceFilterType?Q:"listing_type"===s.sourceFilterType?G:te[s.sourceFilterType],!(!t||"all"===t||"any"===t)&&s.sourceFilterValues.some(e=>String(e).toLowerCase()===String(t).toLowerCase())})(e)&&"location"!==e&&"budget"!==e&&"area"!==e).map(s=>{const t=P.filter(e=>e.filterType===s).sort((e,s)=>e.displayOrder-s.displayOrder);if(0===t.length)return null;const a=s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),r="listing_type"===s?G:"property_type"===s?Q:te[s]||"any";return e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:a}),e.jsxs(m,{value:r,onValueChange:e=>{"listing_type"===s?J(e):"property_type"===s?(W(e),ae({}),se([])):ae(t=>({...t,[s]:e}))},children:[e.jsx(x,{children:e.jsx(u,{placeholder:`Select ${a}`})}),e.jsxs(p,{className:"max-h-[300px] overflow-y-auto",children:[e.jsx(h,{value:"listing_type"===s||"property_type"===s?"all":"any",children:"listing_type"===s||"property_type"===s?`All ${a}s`:`Any ${a}`}),t.filter(e=>((e,s)=>{const t=ge.filter(t=>t.filterType===e&&t.optionValue===s);return 0===t.length||t.some(e=>{let s;return s="property_type"===e.sourceFilterType?Q:"listing_type"===e.sourceFilterType?G:te[e.sourceFilterType],!s||"all"===s||"any"===s||e.sourceFilterValues.some(e=>String(e).toLowerCase()===String(s).toLowerCase())})})(s,e.value)).map(s=>e.jsx(h,{value:s.value,children:s.displayLabel||s.name},s.id||s._id))]})]})]},s)}),me.max>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Price Range"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Min Price"}),e.jsx(c,{type:"number",defaultValue:H[0],onBlur:e=>X([Number(e.target.value),H[1]]),onKeyDown:e=>{"Enter"===e.key&&X([Number(e.currentTarget.value),H[1]])},min:me.min,max:me.max,className:"w-full"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:we(H[0])})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Max Price"}),e.jsx(c,{type:"number",defaultValue:H[1],onBlur:e=>X([H[0],Number(e.target.value)]),onKeyDown:e=>{"Enter"===e.key&&X([H[0],Number(e.currentTarget.value)])},min:me.min,max:me.max,className:"w-full"}),e.jsx("div",{className:"text-xs text-muted-foreground text-right",children:we(H[1])})]})]})]}),E.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Amenities"}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2 border rounded-md p-3",children:E.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{id:s._id,checked:ee.includes(s.name),onCheckedChange:e=>{se(e?[...ee,s.name]:ee.filter(e=>e!==s.name))}}),e.jsx("label",{htmlFor:s._id,className:"text-sm font-normal cursor-pointer leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:s.name})]},s._id))}),ee.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:[ee.length," selected"]})]}),e.jsx(f,{variant:"outline",onClick:Ne,className:"w-full",children:"Reset Filters"})]})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Available Properties"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:R?"Loading...":`${O.length} properties found`})]}),R?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(g,{className:"h-8 w-8 animate-spin text-primary"})}):0===O.length?e.jsx(i,{children:e.jsxs(n,{className:"p-12 text-center",children:[e.jsx(y,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No properties found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Try adjusting your filters or search criteria"}),e.jsx(f,{onClick:Ne,children:"Clear Filters"})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:O.map(s=>e.jsxs(i,{className:"overflow-hidden hover:shadow-lg transition-shadow cursor-pointer",children:[e.jsxs("div",{className:"relative h-48 bg-muted",onClick:()=>V(`/property/${s._id}`),children:[s.images&&s.images.length>0?e.jsx("img",{src:"string"==typeof s.images[0]?s.images[0]:s.images[0]?.url,alt:s.title,className:"w-full h-full object-cover",onError:e=>{e.target.src="/placeholder-property.jpg"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(y,{className:"h-12 w-12 text-muted-foreground"})}),e.jsx(f,{size:"icon",variant:"secondary",className:"absolute top-2 right-2",onClick:e=>{e.stopPropagation(),(async e=>{try{oe.has(e)?(await F.removeFromFavorites(e),ce(s=>{const t=new Set(s);return t.delete(e),t}),M({title:"Removed from favorites",description:"Property removed from your favorites"})):(await F.addToFavorites(e),ce(s=>new Set(s).add(e)),M({title:"Added to favorites",description:"Property added to your favorites"}))}catch(s){M({title:"Error",description:"Failed to update favorite",variant:"destructive"})}})(s._id)},children:e.jsx(j,{className:"h-4 w-4 "+(oe.has(s._id)?"fill-red-500 text-red-500":"")})})]}),e.jsxs(n,{className:"p-4",onClick:()=>V(`/customer/property/${s._id}`),children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx(v,{className:"bg-blue-50 text-blue-700 border-blue-100 capitalize",children:be(s.listingType).toLowerCase().startsWith("for ")?be(s.listingType):`For ${be(s.listingType)}`}),e.jsx(v,{variant:"outline",className:"border-gray-200 text-gray-600 capitalize",children:s.type})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg line-clamp-1",children:s.title}),e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground mt-1",children:[e.jsx(N,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"line-clamp-1",children:s.address.district?`${s.address.city}, ${s.address.district}, ${s.address.state}`:`${s.address.city}, ${s.address.state}`})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:we(s.price)}),"rent"===s.listingType&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"/month"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[s.bedrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx("span",{children:s.bedrooms})]}),s.bathrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsx("span",{children:s.bathrooms})]}),s.area?.builtUp&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.area.builtUp," sqft"]})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t",children:e.jsx(v,{variant:"outline",className:"capitalize",children:s.type})})]})]},s._id))}),ie>1&&e.jsxs("div",{className:"flex justify-center gap-2 mt-8",children:[e.jsx(f,{variant:"outline",disabled:1===re,onClick:()=>le(e=>e-1),children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:Array.from({length:ie},(e,s)=>s+1).map(s=>e.jsx(f,{variant:re===s?"default":"outline",onClick:()=>le(s),className:"w-10",children:s},s))}),e.jsx(f,{variant:"outline",disabled:re===ie,onClick:()=>le(e=>e+1),children:"Next"})]})]})]})]})})]})};export{L as default};

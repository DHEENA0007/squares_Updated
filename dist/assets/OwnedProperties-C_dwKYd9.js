import{j as e}from"./ui-BHyUY8Z8.js";import{d as le,r as l}from"./router-2SVJvIbS.js";import{aQ as re,D as z,t as o,aB as M,f as r,a as m,e as x,Y as ne,I as Y,s as ce,v as de,w as oe,x as me,y as P,B as U,at as p,h as xe,E as he,a9 as q,J as H,K as Q,O as V,Q as G,R as J,L as N,q as ue,ap as K,A as je,M as ge}from"./index-Bd1eLXM_.js";import{R as k}from"./refresh-cw-D2lAUAYb.js";import{C as fe}from"./camera-B-Udk_6_.js";import{C as ve}from"./calendar-5Rt0tQ5m.js";import{P as we}from"./pen-line-D_6gHzXx.js";import{C as pe}from"./circle-alert--1esrBFY.js";import"./vendor-Dazix4UH.js";const Fe=()=>{const{isConnected:I}=re(),$=le(),[b,F]=l.useState(""),[S,D]=l.useState("all"),[j,E]=l.useState(!0),[C,L]=l.useState(!1),[c,W]=l.useState([]),[t,g]=l.useState(null),[X,f]=l.useState(!1),[h,y]=l.useState(!1),[R,O]=l.useState(!1),[Z,v]=l.useState(!1),[a,d]=l.useState({propertyId:"",vendorId:"",rating:0,title:"",comment:"",tags:[],isPublic:!0}),w="https://api.akodefy.com/api",u=l.useCallback(async()=>{try{E(!0);const s=z.getToken(),n=await(await fetch(`${w}/customer/owned-properties`,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}})).json();n.success?W(n.data.properties||[]):o({title:"Error",description:n.message||"Failed to load owned properties",variant:"destructive"})}catch(s){console.error("Failed to load owned properties:",s),o({title:"Error",description:"Failed to load owned properties. Please try again.",variant:"destructive"})}finally{E(!1)}},[w]),ee=l.useCallback(async()=>{L(!0),await u(),L(!1)},[u]);l.useEffect(()=>{u()},[u]);const T=c.filter(s=>{const i=s.title.toLowerCase().includes(b.toLowerCase())||`${s.address.city}, ${s.address.state}`.toLowerCase().includes(b.toLowerCase()),n=S==="all"||s.status===S;return i&&n}),se=async()=>{if(t){if(a.rating===0){o({title:"Rating Required",description:"Please select a rating for the property",variant:"destructive"});return}if(!a.title.trim()||!a.comment.trim()){o({title:"Missing Information",description:"Please provide both a title and comment for your review",variant:"destructive"});return}try{O(!0);const s=z.getToken(),i=h&&t.reviewId?`${w}/customer/reviews/${t.reviewId}`:`${w}/customer/reviews`,A=await(await fetch(i,{method:h?"PUT":"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({propertyId:t._id,vendorId:t.owner?._id||t.assignedBy?._id,rating:a.rating,title:a.title,comment:a.comment,reviewType:"property",tags:a.tags,isPublic:a.isPublic})})).json();A.success?(o({title:"Success",description:h?"Review updated successfully":"Review submitted successfully"}),f(!1),g(null),d({propertyId:"",vendorId:"",rating:0,title:"",comment:"",tags:[],isPublic:!0}),y(!1),await u()):o({title:"Error",description:A.message||"Failed to submit review",variant:"destructive"})}catch(s){console.error("Failed to submit review:",s),o({title:"Error",description:"Failed to submit review. Please try again.",variant:"destructive"})}finally{O(!1)}}},_=(s,i=!1)=>{g(s),y(i),i&&s.review?d({propertyId:s._id,vendorId:s.owner?._id||s.assignedBy?._id||"",rating:s.review.rating,title:s.review.title,comment:s.review.comment,tags:[],isPublic:!0}):d({propertyId:s._id,vendorId:s.owner?._id||s.assignedBy?._id||"",rating:0,title:"",comment:"",tags:[],isPublic:!0}),f(!0)},te=(s,i)=>i==="rent"?`₹${s.toLocaleString("en-IN")}/month`:i==="lease"?`₹${s.toLocaleString("en-IN")}/year`:s>=1e7?`₹${(s/1e7).toFixed(1)} Cr`:s>=1e5?`₹${(s/1e5).toFixed(1)} Lac`:`₹${s.toLocaleString("en-IN")}`,ae=s=>s.builtUp?`${s.builtUp} ${s.unit}`:s.plot?`${s.plot} ${s.unit}`:s.carpet?`${s.carpet} ${s.unit}`:"Area not specified",B=s=>new Date(s).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"}),ie=s=>s.images.find(n=>n.isPrimary)?.url||s.images[0]?.url||"/placeholder-property.jpg";return e.jsxs("div",{className:"space-y-6 pt-16",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(M,{className:"w-8 h-8 text-primary"}),"Owned Properties"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Properties you have purchased or rented"})]}),e.jsxs(r,{variant:"outline",onClick:ee,disabled:C,children:[e.jsx(k,{className:`w-4 h-4 mr-2 ${C?"animate-spin":""}`}),C?"Refreshing...":"Refresh"]})]}),e.jsx("div",{className:"flex items-center justify-between bg-muted/50 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${I?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-sm text-muted-foreground",children:I?"Real-time updates active":"Offline mode"})]})}),!j&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(m,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:c.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Owned"})]})})}),e.jsx(m,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:c.filter(s=>s.status==="sold").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Purchased"})]})})}),e.jsx(m,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:c.filter(s=>s.status==="rented").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rented"})]})})})]}),e.jsx(m,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Y,{type:"text",placeholder:"Search properties...",className:"pl-10",value:b,onChange:s=>F(s.target.value)})]}),e.jsxs(ce,{value:S,onValueChange:D,children:[e.jsx(de,{className:"w-full sm:w-40",children:e.jsx(oe,{placeholder:"Status"})}),e.jsxs(me,{children:[e.jsx(P,{value:"all",children:"All Status"}),e.jsx(P,{value:"sold",children:"Purchased"}),e.jsx(P,{value:"rented",children:"Rented"})]})]})]})})}),!j&&e.jsx("div",{className:"space-y-4",children:T.map(s=>e.jsx(m,{className:"overflow-hidden",children:e.jsx(x,{className:"p-0",children:e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[e.jsxs("div",{className:"lg:w-64 h-48 lg:h-auto bg-muted relative",children:[s.images.length>0?e.jsx("img",{src:ie(s),alt:s.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(fe,{className:"w-12 h-12 text-muted-foreground"})}),e.jsxs("div",{className:"absolute top-3 left-3 flex gap-2",children:[e.jsx(U,{className:s.status==="sold"?"bg-purple-600 text-white":"bg-blue-600 text-white",children:s.status==="sold"?"Purchased":"Rented"}),s.hasReviewed&&e.jsxs(U,{className:"bg-green-600 text-white",children:[e.jsx(p,{className:"w-3 h-3 mr-1 fill-white"}),"Reviewed"]})]})]}),e.jsxs("div",{className:"flex-1 p-6",children:[e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold mb-1",children:s.title}),e.jsxs("div",{className:"flex items-center gap-4 text-muted-foreground text-sm mb-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-4 h-4"}),s.address.city,", ",s.address.state]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4"}),s.status==="sold"?"Purchased":"Rented"," on ",B(s.assignedAt)]})]}),e.jsx("p",{className:"text-muted-foreground text-sm line-clamp-2 mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[e.jsx("span",{children:ae(s.area)}),e.jsxs("span",{children:[s.bedrooms," BHK"]}),e.jsx("span",{className:"capitalize",children:s.listingType})]}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:te(s.price,s.listingType)})]})}),s.owner&&e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2 text-sm",children:"Seller Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Name: "}),e.jsx("span",{className:"font-medium",children:s.owner.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Email: "}),e.jsx("span",{className:"font-medium",children:s.owner.email})]}),s.owner.phone&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Phone: "}),e.jsx("span",{className:"font-medium",children:s.owner.phone})]})]})]}),s.hasReviewed&&s.review?e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-950/20 rounded-lg mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-green-800 dark:text-green-200",children:"Your Review"}),e.jsxs(r,{size:"sm",variant:"ghost",onClick:()=>_(s,!0),children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Edit Review"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(i=>e.jsx(p,{className:`w-4 h-4 ${i<=s.review.rating?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},i))}),e.jsx("span",{className:"text-sm text-muted-foreground",children:B(s.review.createdAt)})]}),e.jsx("h5",{className:"font-medium mb-1",children:s.review.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.review.comment})]}):e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-800 dark:text-blue-200 mb-1",children:"Share Your Experience"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Help others by reviewing this property"})]}),e.jsxs(r,{size:"sm",onClick:()=>_(s,!1),children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"Write Review"]})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(r,{size:"sm",variant:"outline",onClick:()=>$(`/property/${s._id}`),children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"View Details"]}),e.jsxs(r,{size:"sm",variant:"outline",onClick:()=>{g(s),v(!0)},children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Contact Seller"]})]})]})]})})},s._id))}),j&&e.jsx(m,{children:e.jsx(x,{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Loading your properties..."})]})})}),!j&&T.length===0&&e.jsx(m,{children:e.jsxs(x,{className:"p-12 text-center",children:[e.jsx(M,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:c.length===0?"No owned properties found":"No properties match your filters"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:c.length===0?"You haven't purchased or rented any properties yet.":"Try adjusting your search criteria or clear some filters."}),c.length>0&&e.jsx(r,{variant:"outline",onClick:()=>{F(""),D("all")},children:"Clear Filters"})]})}),e.jsx(H,{open:X,onOpenChange:f,children:e.jsxs(Q,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(V,{children:[e.jsx(G,{children:h?"Edit Your Review":"Write a Review"}),e.jsx(J,{children:"Share your experience with this property to help other buyers make informed decisions."})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-1",children:t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.address.city,", ",t.address.state]})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Rating *"}),e.jsx("div",{className:"flex gap-2 mt-2",children:[1,2,3,4,5].map(s=>e.jsx("button",{type:"button",onClick:()=>d({...a,rating:s}),className:"focus:outline-none",children:e.jsx(p,{className:`w-8 h-8 cursor-pointer transition-colors ${s<=a.rating?"fill-yellow-400 text-yellow-400":"text-gray-300 hover:text-yellow-200"}`})},s))}),a.rating>0&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[a.rating===1&&"Poor",a.rating===2&&"Fair",a.rating===3&&"Good",a.rating===4&&"Very Good",a.rating===5&&"Excellent"]})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"review-title",children:"Review Title *"}),e.jsx(Y,{id:"review-title",placeholder:"Sum up your experience in one line",value:a.title,onChange:s=>d({...a,title:s.target.value}),className:"mt-2",maxLength:200})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"review-comment",children:"Your Review *"}),e.jsx(ue,{id:"review-comment",placeholder:"Share your experience with this property...",value:a.comment,onChange:s=>d({...a,comment:s.target.value}),className:"mt-2",rows:6,maxLength:1e3}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[a.comment.length,"/1000 characters"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"public-review",checked:a.isPublic,onChange:s=>d({...a,isPublic:s.target.checked}),className:"rounded"}),e.jsx(N,{htmlFor:"public-review",className:"cursor-pointer",children:"Make this review public"})]})]}),e.jsxs(K,{children:[e.jsx(r,{variant:"outline",onClick:()=>{f(!1),g(null),y(!1)},disabled:R,children:"Cancel"}),e.jsx(r,{onClick:se,disabled:R,children:R?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-4 h-4 mr-2 animate-spin"}),"Submitting..."]}):e.jsx(e.Fragment,{children:h?"Update Review":"Submit Review"})})]})]})}),e.jsx(H,{open:Z,onOpenChange:v,children:e.jsxs(Q,{className:"max-w-md",children:[e.jsxs(V,{children:[e.jsx(G,{children:"Contact Seller"}),e.jsx(J,{children:"Choose your preferred method to get in touch with the property seller."})]}),t&&t.owner&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Seller Information"}),e.jsxs("p",{className:"text-sm mb-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Name: "}),e.jsx("span",{className:"font-medium",children:t.owner.name})]}),t.owner.email&&e.jsxs("p",{className:"text-sm mb-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Email: "}),e.jsx("span",{className:"font-medium",children:t.owner.email})]}),t.owner.phone&&e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Phone: "}),e.jsx("span",{className:"font-medium",children:t.owner.phone})]})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-1",children:t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.address.city,", ",t.address.state]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[t.owner.phone&&e.jsxs(r,{className:"w-full",onClick:()=>{window.location.href=`tel:${t.owner.phone}`},children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Call Seller"]}),t.owner.email&&e.jsxs(r,{variant:"outline",className:"w-full",onClick:()=>{window.location.href=`mailto:${t.owner.email}?subject=Inquiry about ${t.title}`},children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Email Seller"]}),e.jsxs(r,{variant:"outline",className:"w-full",onClick:()=>{v(!1),$("/customer/messages")},children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Send Message"]})]})]}),t&&!t.owner&&e.jsxs("div",{className:"p-4 text-center text-muted-foreground",children:[e.jsx(pe,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{children:"Seller contact information is not available."})]}),e.jsx(K,{children:e.jsx(r,{variant:"outline",onClick:()=>v(!1),children:"Close"})})]})})]})};export{Fe as default};

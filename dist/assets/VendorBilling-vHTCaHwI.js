import{j as e}from"./ui-CEt46o3G.js";import{r as h}from"./router-2SVJvIbS.js";import{C as d,d as m,a as j,b as f}from"./card-YvDMUmzt.js";import{t as u,a as o,T as V,h as H,i as b,v as y,E as F,B as w,P as Y,a0 as _}from"./index-CiYV0Sy0.js";import{S as J,a as X,b as G,c as K,d as S}from"./select-BHWxeluH.js";import{L as Q}from"./loader-circle-Cj-dvH02.js";import{D as C}from"./download-Cdv771o8.js";import{T as W}from"./trending-up-BLutZFyR.js";import{D as P}from"./dollar-sign-DeqxH75V.js";import{E as $}from"./eye-CDS1ofgA.js";import{F as E}from"./file-text-BHu0z9sa.js";import{C as Z}from"./circle-alert-_lmm6JT-.js";import{C as ee}from"./circle-x-CEHPKjJl.js";import{C as se}from"./clock-oZpCo30L.js";import{C as te}from"./circle-check-big-CdpP5k9T.js";import"./vendor-Dazix4UH.js";import"./index-BdQq_4o_.js";import"./index-DHzxUTm5.js";import"./chevron-down-DeDu0PPf.js";const k="https://squares-9d84.onrender.com/api";class ae{async makeRequest(t,s={}){const i=`${k}${t}`,r={headers:{"Content-Type":"application/json",...s.headers},...s},x=localStorage.getItem("token");x&&(r.headers={...r.headers,Authorization:`Bearer ${x}`});try{const n=await fetch(i,r);if(!n.ok){const I=await n.json().catch(()=>({success:!1,message:`HTTP ${n.status}: ${n.statusText}`}));throw new Error(I.message||"An error occurred")}return await n.json()}catch(n){throw console.error("Billing API request failed:",n),n}}async getSubscriptionPlans(){try{const t=await this.makeRequest("/billing/plans");return t.success?t.data:[]}catch(t){return console.error("Failed to fetch subscription plans:",t),[]}}async getCurrentSubscription(){try{const t=await this.makeRequest("/vendors/subscription/current");return t.success?t.data:null}catch(t){return console.error("Failed to fetch current subscription:",t),null}}async upgradeSubscription(t,s){try{const i=await this.makeRequest("/vendors/subscription/upgrade",{method:"POST",body:JSON.stringify({planId:t,billingCycle:s})});return i.success&&u({title:"Success",description:i.message||"Subscription upgrade initiated!"}),{success:i.success,paymentUrl:i.data?.paymentUrl,message:i.message}}catch(i){const r=i instanceof Error?i.message:"Failed to upgrade subscription";return u({title:"Error",description:r,variant:"destructive"}),{success:!1,message:r}}}async cancelSubscription(t){try{const s=await this.makeRequest("/vendors/subscription/cancel",{method:"POST",body:JSON.stringify({reason:t})});if(s.success)return u({title:"Success",description:s.message||"Subscription cancelled successfully!"}),!0;throw new Error(s.message||"Failed to cancel subscription")}catch(s){const i=s instanceof Error?s.message:"Failed to cancel subscription";return u({title:"Error",description:i,variant:"destructive"}),!1}}async reactivateSubscription(){try{const t=await this.makeRequest("/vendors/subscription/reactivate",{method:"POST"});if(t.success)return u({title:"Success",description:t.message||"Subscription reactivated successfully!"}),!0;throw new Error(t.message||"Failed to reactivate subscription")}catch(t){const s=t instanceof Error?t.message:"Failed to reactivate subscription";return u({title:"Error",description:s,variant:"destructive"}),!1}}async getPayments(t={}){try{const s=new URLSearchParams;Object.entries(t).forEach(([x,n])=>{n!=null&&n!==""&&s.append(x,n.toString())});const i=`/vendors/payments${s.toString()?`?${s.toString()}`:""}`,r=await this.makeRequest(i);return r.success&&r.data?r.data:{payments:[],totalCount:0,totalPages:0,currentPage:1}}catch(s){return console.error("Failed to fetch payments:",s),{payments:[],totalCount:0,totalPages:0,currentPage:1}}}async getInvoices(t={}){try{const s=new URLSearchParams;Object.entries(t).forEach(([x,n])=>{n!=null&&n!==""&&s.append(x,n.toString())});const i=`/vendors/invoices${s.toString()?`?${s.toString()}`:""}`,r=await this.makeRequest(i);return r.success&&r.data?r.data:{invoices:[],totalCount:0,totalPages:0,currentPage:1}}catch(s){return console.error("Failed to fetch invoices:",s),{invoices:[],totalCount:0,totalPages:0,currentPage:1}}}async downloadInvoice(t){try{const s=await fetch(`${k}/vendors/invoices/${t}/download`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!s.ok)throw new Error("Failed to download invoice");const i=await s.blob();return u({title:"Success",description:"Invoice downloaded successfully!"}),i}catch(s){const i=s instanceof Error?s.message:"Failed to download invoice";return u({title:"Error",description:i,variant:"destructive"}),null}}async getBillingStats(){try{const t=await this.makeRequest("/vendors/billing/stats");return t.success&&t.data?t.data:{totalRevenue:0,monthlyRevenue:0,activeSubscriptions:0,totalInvoices:0,paidInvoices:0,overdueInvoices:0,nextBillingAmount:0,nextBillingDate:new Date().toISOString(),subscriptionStatus:"inactive",usageStats:{properties:{used:0,limit:0},leads:{used:0,limit:0},messages:{used:0,limit:0}}}}catch(t){return console.error("Failed to fetch billing stats:",t),{totalRevenue:0,monthlyRevenue:0,activeSubscriptions:0,totalInvoices:0,paidInvoices:0,overdueInvoices:0,nextBillingAmount:0,nextBillingDate:new Date().toISOString(),subscriptionStatus:"inactive",usageStats:{properties:{used:0,limit:0},leads:{used:0,limit:0},messages:{used:0,limit:0}}}}}formatCurrency(t){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)}formatDate(t){return new Date(t).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})}getStatusColor(t){return{active:"text-green-600 bg-green-100",cancelled:"text-red-600 bg-red-100",expired:"text-orange-600 bg-orange-100",pending:"text-yellow-600 bg-yellow-100",trial:"text-blue-600 bg-blue-100",completed:"text-green-600 bg-green-100",failed:"text-red-600 bg-red-100",refunded:"text-purple-600 bg-purple-100",paid:"text-green-600 bg-green-100",overdue:"text-red-600 bg-red-100",sent:"text-blue-600 bg-blue-100",draft:"text-gray-600 bg-gray-100"}[t]||"text-gray-600 bg-gray-100"}getUsagePercentage(t,s){return s===0?0:Math.min(t/s*100,100)}downloadBlob(t,s){const i=window.URL.createObjectURL(t),r=document.createElement("a");r.href=i,r.download=s,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(i)}}const D=new ae,we=()=>{const[T,t]=h.useState(!0),[s,i]=h.useState(null),[r,x]=h.useState([]),[n,I]=h.useState([]),[c,L]=h.useState(null),[R,U]=h.useState("last_30_days"),[M,q]=h.useState("overview");h.useEffect(()=>{z()},[R]);const O=a=>{const l=new Date,A={last_7_days:7,last_30_days:30,last_90_days:90,last_year:365}[a]||30;return new Date(l.getTime()-A*24*60*60*1e3).toISOString().split("T")[0]},z=async()=>{try{t(!0);const[a,l,A,B]=await Promise.all([D.getCurrentSubscription(),D.getPayments({page:1,limit:20,dateFrom:O(R)}),D.getInvoices({page:1,limit:10}),D.getBillingStats()]);i(a),x(l.payments||[]),I(A.invoices||[]),L(B)}catch(a){console.error("Failed to load billing data:",a),u({title:"Error",description:"Failed to load billing information. Please try again.",variant:"destructive"})}finally{t(!1)}},v=a=>{switch(a){case"completed":case"active":case"paid":return e.jsx(te,{className:"w-4 h-4 text-green-600"});case"pending":case"sent":return e.jsx(se,{className:"w-4 h-4 text-yellow-600"});case"failed":case"cancelled":case"expired":case"overdue":return e.jsx(ee,{className:"w-4 h-4 text-red-600"});default:return e.jsx(Z,{className:"w-4 h-4 text-gray-600"})}},N=a=>{switch(a){case"completed":case"active":case"paid":return"bg-green-100 text-green-800";case"pending":case"sent":return"bg-yellow-100 text-yellow-800";case"failed":case"cancelled":case"expired":case"overdue":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},g=(a,l="INR")=>new Intl.NumberFormat("en-IN",{style:"currency",currency:l,minimumFractionDigits:0,maximumFractionDigits:0}).format(a),p=a=>new Date(a).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"});return T?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{children:"Loading billing information..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Billing & Payments"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your subscription and payment history"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(J,{value:R,onValueChange:U,children:[e.jsx(X,{className:"w-40",children:e.jsx(G,{placeholder:"Select period"})}),e.jsxs(K,{children:[e.jsx(S,{value:"last_7_days",children:"Last 7 days"}),e.jsx(S,{value:"last_30_days",children:"Last 30 days"}),e.jsx(S,{value:"last_90_days",children:"Last 90 days"}),e.jsx(S,{value:"last_year",children:"Last year"})]})]}),e.jsxs(o,{variant:"outline",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Export"]})]})]}),c&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(d,{children:e.jsxs(m,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g(c.totalRevenue)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Revenue"})]})}),e.jsx(d,{children:e.jsxs(m,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:g(c.nextBillingAmount)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Next Payment"})]})}),e.jsx(d,{children:e.jsxs(m,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:c.totalInvoices}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Invoices"})]})}),e.jsx(d,{children:e.jsxs(m,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:s?g(s.amount):"₹0"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Monthly Cost"})]})})]}),e.jsxs(V,{value:M,onValueChange:q,className:"space-y-6",children:[e.jsxs(H,{children:[e.jsx(b,{value:"overview",children:"Overview"}),e.jsx(b,{value:"payments",children:"Payment History"}),e.jsx(b,{value:"invoices",children:"Invoices"}),e.jsx(b,{value:"usage",children:"Usage Stats"})]}),e.jsxs(y,{value:"overview",className:"space-y-6",children:[e.jsxs(d,{children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center",children:[e.jsx(F,{className:"w-5 h-5 mr-2"}),"Current Subscription"]})}),e.jsx(m,{children:s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:s.plan?.name||"N/A"}),e.jsxs("p",{className:"text-muted-foreground",children:[s.billingCycle==="monthly"?"Monthly":"Yearly"," Plan"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[v(s.status),e.jsx(w,{className:N(s.status),children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Monthly Cost"}),e.jsx("p",{className:"text-lg font-semibold",children:g(s.amount,s.currency)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Next Billing Date"}),e.jsx("p",{className:"text-lg font-semibold",children:p(s.nextBillingDate)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Auto Renewal"}),e.jsx("p",{className:"text-lg font-semibold",children:s.autoRenew?"Enabled":"Disabled"})]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"outline",children:"Change Plan"}),e.jsx(o,{variant:"outline",children:"Manage Subscription"})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(F,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Active Subscription"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Choose a plan to get started with our services"}),e.jsxs(o,{children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Choose Plan"]})]})})]}),e.jsxs(d,{children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center",children:[e.jsx(W,{className:"w-5 h-5 mr-2"}),"Recent Transactions"]})}),e.jsx(m,{children:r&&r.length>0?e.jsx("div",{className:"space-y-4",children:r.slice(0,5).map((a,l)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 bg-muted rounded-full",children:e.jsx(P,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a?.description||"Subscription Payment"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a?.paymentMethod||"Credit Card"," • ",a?.createdAt?p(a.createdAt):"N/A"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[v(a?.status||"pending"),e.jsx("span",{className:"font-semibold",children:g(a?.amount||0,a?.currency||"INR")})]}),e.jsx(w,{className:`text-xs ${N(a?.status||"pending")}`,children:a?.status||"pending"})]})]},a?._id||`payment-${l}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(P,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No transactions found"})]})})]})]}),e.jsx(y,{value:"payments",className:"space-y-4",children:e.jsxs(d,{children:[e.jsx(j,{children:e.jsx(f,{children:"Payment History"})}),e.jsx(m,{children:r&&r.length>0?e.jsx("div",{className:"space-y-4",children:r.map((a,l)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 bg-muted rounded-full",children:e.jsx(P,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a?.description||"Subscription Payment"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Payment ID: ",a?._id?.slice(-8)||"N/A"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a?.createdAt?p(a.createdAt):"N/A"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[v(a.status),e.jsx("span",{className:"font-semibold",children:g(a.amount,a.currency)})]}),e.jsx(w,{className:`text-xs ${N(a.status)}`,children:a.status}),e.jsxs("div",{className:"flex space-x-2 mt-2",children:[e.jsxs(o,{size:"sm",variant:"outline",children:[e.jsx($,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsxs(o,{size:"sm",variant:"outline",children:[e.jsx(C,{className:"w-4 h-4 mr-1"}),"Receipt"]})]})]})]},a?._id||`payment-full-${l}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(P,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Payment History"}),e.jsx("p",{className:"text-muted-foreground",children:"Your payment history will appear here"})]})})]})}),e.jsx(y,{value:"invoices",className:"space-y-4",children:e.jsxs(d,{children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(E,{className:"w-5 h-5 mr-2"}),"Invoices"]}),e.jsxs(o,{variant:"outline",size:"sm",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Download All"]})]})}),e.jsx(m,{children:n&&n.length>0?e.jsx("div",{className:"space-y-4",children:n.map((a,l)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 bg-muted rounded-full",children:e.jsx(E,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Invoice #",a?.invoiceNumber||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Issued: ",a?.issueDate?p(a.issueDate):"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Due: ",p(a.dueDate)]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[v(a.status),e.jsx("span",{className:"font-semibold",children:g(a.total,a.currency)})]}),e.jsx(w,{className:`text-xs ${N(a.status)}`,children:a.status}),e.jsxs("div",{className:"flex space-x-2 mt-2",children:[e.jsxs(o,{size:"sm",variant:"outline",children:[e.jsx($,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsxs(o,{size:"sm",variant:"outline",children:[e.jsx(C,{className:"w-4 h-4 mr-1"}),"Download"]})]})]})]},a?._id||`invoice-${l}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(E,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Invoices"}),e.jsx("p",{className:"text-muted-foreground",children:"Your invoices will appear here"})]})})]})}),e.jsx(y,{value:"usage",className:"space-y-4",children:e.jsxs(d,{children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center",children:[e.jsx(_,{className:"w-5 h-5 mr-2"}),"Usage Statistics"]})}),e.jsx(m,{children:c?.usageStats?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Properties"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[c?.usageStats?.properties?.used||0," / ",c?.usageStats?.properties?.limit||0]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${Math.min((c?.usageStats?.properties?.used||0)/(c?.usageStats?.properties?.limit||1)*100,100)}%`}})})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Leads"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[c?.usageStats?.leads?.used||0," / ",c?.usageStats?.leads?.limit||0]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${Math.min((c?.usageStats?.leads?.used||0)/(c?.usageStats?.leads?.limit||1)*100,100)}%`}})})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Messages"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[c?.usageStats?.messages?.used||0," / ",c?.usageStats?.messages?.limit||0]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${Math.min((c?.usageStats?.messages?.used||0)/(c?.usageStats?.messages?.limit||1)*100,100)}%`}})})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Usage resets on your billing cycle date: ",c.nextBillingDate]}),e.jsx(o,{variant:"outline",children:"Upgrade Plan"})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Usage Data"}),e.jsx("p",{className:"text-muted-foreground",children:"Usage statistics will appear here"})]})})]})})]})]})};export{we as default};

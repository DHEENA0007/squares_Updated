import{j as e}from"./ui-BNZSgpjP.js";import{r as s}from"./router-D8v2YSKU.js";import{a4 as r,a5 as a,a6 as t,a7 as n,a8 as o,H as l,L as d,I as i,f as c,E as m,S as w,ae as h,K as u,t as x}from"./index-Bb9pk9gg.js";import{A as p,a as j}from"./alert-CcvFTH-i.js";import{I as g,a as f,b as P}from"./input-otp-DDqpx_PU.js";import{K as N}from"./key-C_rHrnj6.js";import{E as y}from"./eye-off-B-Zbh9Fy.js";const b=({open:b,onOpenChange:v,onSuccess:C})=>{const[S,O]=s.useState({currentPassword:"",newPassword:"",confirmPassword:"",otp:""}),[F,k]=s.useState("currentPassword"),[T,V]=s.useState(!1),[E,z]=s.useState([]),[A,W]=s.useState(!1),[q,K]=s.useState(5),[M,R]=s.useState({current:!1,new:!1,confirm:!1}),$=e=>{const s=[];return e.length<8&&s.push("At least 8 characters"),/[A-Z]/.test(e)||s.push("One uppercase letter"),/[a-z]/.test(e)||s.push("One lowercase letter"),/\d/.test(e)||s.push("One number"),/[!@#$%^&*(),.?":{}|<>]/.test(e)||s.push("One special character"),s},I=()=>S.currentPassword.length>0,L=()=>S.newPassword.length>=8&&S.newPassword===S.confirmPassword&&0===$(S.newPassword).length&&S.currentPassword!==S.newPassword,Y=async()=>{if("currentPassword"===F){if(!I())return;try{V(!0),z([]);const e=await u.requestPasswordChangeOTP(S.currentPassword);e.success&&(k("otp"),W(!0),K(e.expiryMinutes||5),x({title:"OTP Sent",description:"Verification code sent to your email"}))}catch(e){z([e.message||"Failed to send OTP"])}finally{V(!1)}}else if("otp"===F){if(!S.otp.trim())return void z(["Please enter the OTP"]);k("newPassword"),z([]),x({title:"OTP Verified",description:"Now set your new password"})}else if("newPassword"===F){if(!L())return;try{V(!0),z([]);const e=await u.changePasswordWithOTP(S.otp,S.newPassword);if(!e.success)throw new Error(e.message||"Failed to change password");x({title:"âœ… Password Changed Successfully",description:"Your password has been updated securely."}),O({currentPassword:"",newPassword:"",confirmPassword:"",otp:""}),k("currentPassword"),W(!1),v(!1),C?.(),x({title:"ðŸ“§ Confirmation Sent",description:"Password change confirmation sent to your email."})}catch(e){const s=e.message||"Failed to change password";s.includes("Current password is incorrect")?z(["Your current password is incorrect. Please try again."]):s.includes("same as current")?z(["New password must be different from your current password."]):(s.includes("OTP"),z([s])),x({title:"âŒ Password Change Failed",description:s,variant:"destructive"})}finally{V(!1)}}},Z=(e=>{let s=0;return e.length>=8&&s++,/[A-Z]/.test(e)&&s++,/[a-z]/.test(e)&&s++,/\d/.test(e)&&s++,/[!@#$%^&*(),.?":{}|<>]/.test(e)&&s++,5===s?{score:s,label:"Very Strong",color:"text-green-600"}:s>=4?{score:s,label:"Strong",color:"text-green-500"}:s>=3?{score:s,label:"Medium",color:"text-yellow-500"}:s>=2?{score:s,label:"Weak",color:"text-orange-500"}:{score:s,label:"Very Weak",color:"text-red-500"}})(S.newPassword),G=$(S.newPassword);return e.jsx(r,{open:b,onOpenChange:v,children:e.jsxs(a,{className:"sm:max-w-md",children:[e.jsxs(t,{children:[e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5"}),"currentPassword"===F?"Change Password":"otp"===F?"Verify Email":"Set New Password"]}),e.jsx(o,{children:"currentPassword"===F?"Enter your current password to proceed.":"otp"===F?"We've sent a verification code to your registered email. Please enter the code below.":"Choose a new secure password for your account."})]}),e.jsxs("div",{className:"space-y-4",children:[E.length>0&&e.jsxs(p,{variant:"destructive",children:[e.jsx(l,{className:"w-4 h-4"}),e.jsx(j,{children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:E.map((s,r)=>e.jsx("li",{children:s},r))})})]}),"currentPassword"===F&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"currentPassword",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(i,{id:"currentPassword",type:M.current?"text":"password",value:S.currentPassword,onChange:e=>O(s=>({...s,currentPassword:e.target.value})),placeholder:"Enter your current password",className:"pr-10",disabled:T,autoFocus:!0}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>R(e=>({...e,current:!e.current})),disabled:T,children:M.current?e.jsx(y,{className:"h-4 w-4"}):e.jsx(m,{className:"h-4 w-4"})})]})]})}),"otp"===F&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"otp",children:"Verification Code"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(g,{value:S.otp,onChange:e=>O(s=>({...s,otp:e})),maxLength:6,className:"gap-2",children:e.jsxs(f,{children:[e.jsx(P,{index:0,className:"w-12 h-12 text-lg"}),e.jsx(P,{index:1,className:"w-12 h-12 text-lg"}),e.jsx(P,{index:2,className:"w-12 h-12 text-lg"}),e.jsx(P,{index:3,className:"w-12 h-12 text-lg"}),e.jsx(P,{index:4,className:"w-12 h-12 text-lg"}),e.jsx(P,{index:5,className:"w-12 h-12 text-lg"})]})})}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Code expires in ",q," minutes"]}),e.jsx(c,{variant:"ghost",size:"sm",onClick:async()=>{try{V(!0),z([]);const e=await u.requestPasswordChangeOTP(S.currentPassword);e.success&&(K(e.expiryMinutes||5),x({title:"OTP Resent",description:"A new OTP has been sent to your email"}))}catch(e){z([e.message||"Failed to resend OTP"])}finally{V(!1)}},disabled:T,children:"Resend Code"})]})]}),e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(w,{className:"w-4 h-4 text-yellow-600 mt-0.5"}),e.jsxs("div",{className:"text-xs text-yellow-700",children:[e.jsx("p",{className:"font-medium",children:"Security Notice:"}),e.jsx("p",{children:"We've sent a verification code to your registered email address for additional security. Please check your email and enter the code above."})]})]})})]}),"newPassword"===F&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"newPassword",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(i,{id:"newPassword",type:M.new?"text":"password",value:S.newPassword,onChange:e=>O(s=>({...s,newPassword:e.target.value})),placeholder:"Enter your new password",className:"pr-10",disabled:T,autoFocus:!0}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>R(e=>({...e,new:!e.new})),disabled:T,children:M.new?e.jsx(y,{className:"h-4 w-4"}):e.jsx(m,{className:"h-4 w-4"})})]})]}),S.newPassword&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Password Strength:"}),e.jsx("span",{className:`font-medium ${Z.color}`,children:Z.label})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full transition-all duration-300 "+(5===Z.score?"bg-green-600":Z.score>=4?"bg-green-500":Z.score>=3?"bg-yellow-500":Z.score>=2?"bg-orange-500":"bg-red-500"),style:{width:Z.score/5*100+"%"}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"confirmPassword",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(i,{id:"confirmPassword",type:M.confirm?"text":"password",value:S.confirmPassword,onChange:e=>O(s=>({...s,confirmPassword:e.target.value})),placeholder:"Confirm your new password",className:"pr-10",disabled:T}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>R(e=>({...e,confirm:!e.confirm})),disabled:T,children:M.confirm?e.jsx(y,{className:"h-4 w-4"}):e.jsx(m,{className:"h-4 w-4"})})]})]}),S.newPassword&&G.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{className:"text-sm font-medium text-red-600",children:"Password Requirements:"}),e.jsx("ul",{className:"text-sm text-red-600 space-y-1",children:G.map((s,r)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 bg-red-600 rounded-full"}),s]},r))})]}),S.confirmPassword&&S.newPassword!==S.confirmPassword&&e.jsxs("div",{className:"text-sm text-red-600 flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 bg-red-600 rounded-full"}),"Passwords do not match"]})]})]}),e.jsxs(h,{className:"gap-2",children:[e.jsx(c,{variant:"outline",onClick:()=>{O({currentPassword:"",newPassword:"",confirmPassword:"",otp:""}),z([]),k("currentPassword"),W(!1),v(!1)},disabled:T,children:"Cancel"}),"currentPassword"===F&&e.jsx(c,{onClick:Y,disabled:!I()||T,className:"min-w-[120px]",children:T?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Sending OTP..."]}):"Send Verification Code"}),"otp"===F&&e.jsx(c,{onClick:Y,disabled:!S.otp||6!==S.otp.length||T,className:"min-w-[120px]",children:T?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Verifying..."]}):"Verify Code"}),"newPassword"===F&&e.jsx(c,{onClick:Y,disabled:!L()||T,className:"min-w-[120px]",children:T?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Changing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Change Password"]})})]})]})})};export{b as P};

import{j as e}from"./ui-DHQhougw.js";import{d as s,r as a}from"./router-Bi51YGN-.js";import{z as t,u as l,K as i,f as c,Z as r,a as n,b as d,c as m,e as x,d as o,B as u,U as h,Q as j,R as p,V as f,W as N,Y as g,a0 as v,aa as b,ab as w,ac as y,am as S,an as A,ad as C,t as R}from"./index-BXXWUbfo.js";import{P as k,a as T,b as D,c as _,d as z,e as P}from"./pagination-4Yeq-L1v.js";import{D as L}from"./DataTable-CGqRm03L.js";import{S as F}from"./SearchFilter-DjyuAt_G.js";import{r as I}from"./roleService-BbVzZVbZ.js";import{S as U}from"./shield-CHxDQaVC.js";import{S as V}from"./square-pen-Chtq4VLr.js";import{E}from"./ellipsis-Cwu7I5jj.js";import{T as O}from"./trash-2-Vx1507RH.js";import"./vendor-eVk5PToZ.js";import"./table-BBRox6go.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=t("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]),$=t("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),B=()=>{const t=s(),{isSuperAdmin:B}=l(),[M,Y]=a.useState(""),[q,K]=a.useState("all"),[Q,X]=a.useState([]),[Z,G]=a.useState(!0),[H,J]=a.useState(1),[ee,se]=a.useState(1),[ae,te]=a.useState(0),[le,ie]=a.useState(null),[ce,re]=a.useState(null),[ne,de]=a.useState(!1),[me,xe]=a.useState(null),[oe,ue]=a.useState(!1),he=a.useRef(),je=a.useCallback(async()=>{try{G(!0);const e={page:H,limit:10,search:M||void 0,isActive:"all"===q?void 0:"active"===q},s=await I.getRoles(e),a=s.data.roles.map(e=>({...e,pages:e.pages||[]}));X(a),se(s.data.pagination.totalPages),te(s.data.pagination.totalRoles);const t=a.find(e=>"superadmin"===e.name.toLowerCase()),l=a.find(e=>"subadmin"===e.name.toLowerCase());ie(t||null),re(l||null)}catch(e){}finally{G(!1)}},[H,M,q]);a.useEffect(()=>{je()},[je]),a.useEffect(()=>()=>{he.current&&clearTimeout(he.current)},[]);const pe=a.useCallback(e=>{he.current&&clearTimeout(he.current),he.current=setTimeout(()=>{Y(e),J(1)},300)},[]),fe=a.useCallback(e=>{K(e),J(1)},[]),Ne=s=>{const a=s.name.toLowerCase();return"superadmin"===a?e.jsxs(u,{variant:"destructive",className:"text-xs",children:[e.jsx(U,{className:"w-3 h-3 mr-1"}),"Super Admin"]}):"subadmin"===a?e.jsxs(u,{variant:"default",className:"text-xs bg-orange-500 hover:bg-orange-500/80",children:[e.jsx(U,{className:"w-3 h-3 mr-1"}),"Sub Admin"]}):s.isSystemRole?e.jsxs(u,{variant:"outline",className:"text-xs",children:[e.jsx(U,{className:"w-3 h-3 mr-1"}),"System"]}):null},ge=[{key:"name",label:"Role Name",render:s=>e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[s.name,Ne(s)]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description})]})},{key:"userCount",label:"Users",render:s=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(h,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:s.userCount||0})]})},{key:"isActive",label:"Status",render:s=>e.jsx(u,{variant:s.isActive?"default":"secondary",children:s.isActive?"Active":"Inactive"})},{key:"actions",label:"Actions",render:s=>e.jsxs(b,{children:[e.jsx(w,{asChild:!0,children:e.jsxs(c,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(E,{className:"w-4 h-4"})]})}),e.jsxs(y,{align:"end",className:"w-48",children:[e.jsx(S,{children:"Actions"}),e.jsx(A,{}),e.jsxs(C,{onClick:e=>{e.stopPropagation(),(async e=>{try{const s=await I.toggleRoleStatus(e._id);X(e=>e.map(e=>e._id===s.data.role._id?s.data.role:e)),R({title:"Success",description:`Role ${s.data.role.isActive?"activated":"deactivated"} successfully!`})}catch(s){}})(s)},disabled:s.isSystemRole&&s.isActive&&!B,className:"cursor-pointer",children:[s.isActive?e.jsx(W,{className:"w-4 h-4 mr-2"}):e.jsx($,{className:"w-4 h-4 mr-2"}),s.isActive?"Deactivate":"Activate"]}),e.jsx(A,{}),e.jsxs(C,{onClick:e=>{e.stopPropagation(),(e=>{xe(e),de(!0)})(s)},disabled:s.isSystemRole&&!B,className:"text-destructive focus:text-destructive cursor-pointer",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Delete Role"]})]})]})}];return Z?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(i,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading roles..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:justify-between md:items-center md:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Role Management"}),e.jsx("p",{className:"text-sm md:text-base text-muted-foreground mt-1 md:mt-2",children:"Manage user roles and permissions"})]}),e.jsxs(c,{onClick:()=>t("/admin/roles/add"),className:"flex items-center gap-2 w-full md:w-auto",size:"sm",children:[e.jsx(r,{className:"h-4 w-4"}),"Add New Role"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2 md:gap-3",children:[e.jsxs(n,{children:[e.jsx(d,{className:"pb-1 px-2 md:px-6",children:e.jsx(m,{className:"text-xs font-medium text-muted-foreground",children:"Total Roles"})}),e.jsx(x,{className:"pt-1 px-2 md:px-6",children:e.jsx("div",{className:"text-base md:text-lg lg:text-xl font-bold",children:ae})})]}),e.jsxs(n,{children:[e.jsx(d,{className:"pb-1 px-2 md:px-6",children:e.jsx(m,{className:"text-xs font-medium text-muted-foreground",children:"Active Roles"})}),e.jsx(x,{className:"pt-1 px-2 md:px-6",children:e.jsx("div",{className:"text-base md:text-lg lg:text-xl font-bold text-green-500",children:Q.filter(e=>e.isActive).length})})]}),e.jsxs(n,{children:[e.jsx(d,{className:"pb-1 px-2 md:px-6",children:e.jsx(m,{className:"text-xs font-medium text-muted-foreground",children:"System Roles"})}),e.jsx(x,{className:"pt-1 px-2 md:px-6",children:e.jsx("div",{className:"text-base md:text-lg lg:text-xl font-bold text-blue-500",children:Q.filter(e=>e.isSystemRole).length})})]}),e.jsxs(n,{className:"border-destructive/20 bg-destructive/10",children:[e.jsx(d,{className:"pb-1 px-2 md:px-6",children:e.jsxs(m,{className:"text-xs font-medium text-destructive flex items-center gap-1",children:[e.jsx(U,{className:"w-3 h-3"}),"Super Admin"]})}),e.jsx(x,{className:"pt-1 px-2 md:px-6",children:e.jsx("div",{className:"text-base md:text-lg lg:text-xl font-bold text-destructive",children:le?.userCount||0})})]}),e.jsxs(n,{className:"border-orange-500/20 bg-orange-500/10",children:[e.jsx(d,{className:"pb-1 px-2 md:px-6",children:e.jsxs(m,{className:"text-xs font-medium text-orange-600 flex items-center gap-1",children:[e.jsx(U,{className:"w-3 h-3"}),"Sub Admin"]})}),e.jsx(x,{className:"pt-1 px-2 md:px-6",children:e.jsx("div",{className:"text-base md:text-lg lg:text-xl font-bold text-orange-500",children:ce?.userCount||0})})]})]}),(le||ce)&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[le&&e.jsxs(n,{className:"border-destructive/20 bg-gradient-to-br from-destructive/10 to-card",children:[e.jsxs(d,{className:"pb-3",children:[e.jsxs(m,{className:"flex items-center gap-2 text-destructive text-base md:text-lg",children:[e.jsx(U,{className:"w-4 h-4 md:w-5 md:h-5"}),"Super Admin Role"]}),e.jsx(o,{className:"text-sm",children:le.description})]}),e.jsxs(x,{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsx(u,{variant:le.isActive?"default":"secondary",className:"w-fit",children:le.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Users:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(h,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-bold",children:le.userCount||0})]})]}),e.jsx("div",{className:"pt-2",children:e.jsxs(c,{variant:"outline",size:"sm",className:"w-full",onClick:()=>t(`/admin/roles/edit/${le._id}`),children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"View Details"]})})]})]}),ce&&e.jsxs(n,{className:"border-orange-500/20 bg-gradient-to-br from-orange-500/10 to-card",children:[e.jsxs(d,{className:"pb-3",children:[e.jsxs(m,{className:"flex items-center gap-2 text-orange-600 text-base md:text-lg",children:[e.jsx(U,{className:"w-4 h-4 md:w-5 md:h-5"}),"Sub Admin Role"]}),e.jsx(o,{className:"text-sm",children:ce.description})]}),e.jsxs(x,{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsx(u,{variant:ce.isActive?"default":"secondary",className:"w-fit",children:ce.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Users:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(h,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-bold",children:ce.userCount||0})]})]}),e.jsx("div",{className:"pt-2",children:e.jsxs(c,{variant:"outline",size:"sm",className:"w-full",onClick:()=>t(`/admin/roles/edit/${ce._id}`),children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"View Details"]})})]})]})]}),e.jsxs(n,{children:[e.jsxs(d,{className:"pb-4",children:[e.jsx(m,{className:"text-lg md:text-xl",children:"All Roles"}),e.jsxs(o,{className:"text-sm md:text-base",children:[ae," role",1!==ae?"s":""," found"]})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsx(F,{searchTerm:M,onSearchChange:pe,filterValue:q,onFilterChange:fe,filterOptions:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}],filterPlaceholder:"Filter by status"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(L,{columns:ge,data:Q.map(e=>({...e,id:e._id})),hideDefaultActions:!0})}),ee>1&&e.jsx("div",{className:"mt-4 md:mt-6",children:e.jsx(k,{children:e.jsxs(T,{className:"flex-wrap gap-1",children:[e.jsx(D,{children:e.jsx(_,{onClick:()=>{H>1&&J(H-1)},className:"text-xs md:text-sm "+(1===H?"pointer-events-none opacity-50":"cursor-pointer")})}),Array.from({length:ee},(e,s)=>s+1).map(s=>e.jsx(D,{children:e.jsx(z,{onClick:()=>(e=>{J(e)})(s),isActive:H===s,className:"cursor-pointer text-xs md:text-sm",children:s})},s)),e.jsx(D,{children:e.jsx(P,{onClick:()=>{H<ee&&J(H+1)},className:"text-xs md:text-sm "+(H===ee?"pointer-events-none opacity-50":"cursor-pointer")})})]})})})]})]}),e.jsx(j,{open:ne,onOpenChange:de,children:e.jsxs(p,{className:"sm:max-w-[425px] mx-4",children:[e.jsxs(f,{children:[e.jsx(N,{className:"text-base md:text-lg",children:"Delete Role"}),e.jsxs(g,{className:"text-sm md:text-base",children:['Are you sure you want to delete the role "',me?.name,'"? This action cannot be undone.',me?.userCount&&me.userCount>0&&e.jsxs("p",{className:"text-destructive mt-2 text-sm",children:["Warning: This role is currently assigned to ",me.userCount," user(s)."]})]})]}),e.jsxs(v,{className:"flex flex-col-reverse sm:flex-row gap-2 sm:gap-0",children:[e.jsx(c,{variant:"outline",onClick:()=>{de(!1),xe(null)},disabled:oe,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(c,{variant:"destructive",onClick:async()=>{if(me)try{ue(!0),await I.deleteRole(me._id),de(!1);const e=me._id;xe(null),X(s=>s.filter(s=>s._id!==e)),te(e=>e-1),R({title:"Success",description:"Role deleted successfully!"})}catch(e){}finally{ue(!1)}},disabled:oe,className:"w-full sm:w-auto",children:oe?e.jsxs(e.Fragment,{children:[e.jsx(i,{className:"w-4 h-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete Role"})]})]})})]})};
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{B as default};

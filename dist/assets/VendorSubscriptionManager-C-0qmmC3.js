const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendorService-BaZvT96Z.js","assets/index-SPvHGBGF.js","assets/ui-DOY6021Z.js","assets/router-2SVJvIbS.js","assets/vendor-Dazix4UH.js","assets/index-C5H5ZItn.css"])))=>i.map(i=>d[i]);
import{G as $,f as d,D as z,a as x,b as g,c as j,B as b,e as p,aj as R,C as h,aK as S,aC as _,S as V,ai as q,_ as G}from"./index-SPvHGBGF.js";import{j as e}from"./ui-DOY6021Z.js";import{r as l,d as H}from"./router-2SVJvIbS.js";import{a as U}from"./addonService-Crqz8Zz5.js";import{paymentService as K}from"./paymentService-BtfYYZrM.js";import{C}from"./calendar-CTLer1S7.js";import"./vendor-Dazix4UH.js";const ee=()=>{const[a,P]=l.useState(null),[o,f]=l.useState([]),[r,v]=l.useState([]),[k,D]=l.useState(!0),[y,N]=l.useState(!1),{toast:c}=$(),m=H();l.useEffect(()=>{w(),T()},[]);const w=async()=>{try{const s=await fetch("https://squares-v2.onrender.com/api/vendors/subscription-status",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(console.log("Subscription API response status:",s.status),s.ok){const t=await s.json();console.log("Subscription API response data:",t),t.success&&t.data.hasActiveSubscription?(console.log("Setting subscription data:",t.data.subscription),P(t.data.subscription)):console.log("No active subscription found:",t)}else console.log("Subscription API response not ok:",s.status,await s.text())}catch(s){console.error("Failed to load subscription:",s)}finally{D(!1)}},T=async()=>{try{const s=await U.getAddons();f(s.filter(t=>t.isActive))}catch(s){console.error("Failed to load addons:",s),f([{_id:"1",name:"Professional Photography",description:"High-quality property photography service",price:2999,category:"photography",billingType:"per_property",isActive:!0},{_id:"2",name:"Virtual Tours",description:"360° virtual property tours",price:4999,category:"technology",billingType:"per_property",isActive:!0},{_id:"3",name:"Social Media Marketing",description:"Promote your listings on social platforms",price:1999,category:"marketing",billingType:"monthly",isActive:!0}])}},L=s=>{switch(s?.toLowerCase()){case"basic":return e.jsx(_,{className:"w-8 h-8 text-blue-500"});case"premium":return e.jsx(q,{className:"w-8 h-8 text-yellow-500"});case"enterprise":return e.jsx(V,{className:"w-8 h-8 text-purple-500"});default:return e.jsx(S,{className:"w-8 h-8 text-green-500"})}},A=s=>new Date(s).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"}),E=s=>{const t=new Date(s),i=new Date,n=t.getTime()-i.getTime(),M=Math.ceil(n/(1e3*60*60*24));return Math.max(0,M)},I=s=>a?.addons?.some(t=>t._id===s)||!1,B=s=>{if(I(s._id)){c({title:"Addon Already Active",description:`${s.name} is already included in your subscription`,variant:"default"});return}v(t=>t.find(n=>n._id===s._id)?t.filter(n=>n._id!==s._id):[...t,s])},u=()=>r.reduce((s,t)=>s+t.price,0),F=async()=>{if(r.length===0){c({title:"No addons selected",description:"Please select at least one addon to purchase",variant:"destructive"});return}if(!a){c({title:"No active subscription",description:"Please subscribe to a plan first before purchasing addons",variant:"destructive"});return}N(!0);try{const s={addons:r.map(i=>i._id),totalAmount:u()},t=await K.processAddonPayment(s);if(t.success){c({title:"Addons Purchased Successfully!",description:`Successfully purchased ${r.length} addon service(s)`}),v([]),w();try{const{vendorService:i}=await G(async()=>{const{vendorService:n}=await import("./vendorService-BaZvT96Z.js");return{vendorService:n}},__vite__mapDeps([0,1,2,3,4,5]));await i.refreshSubscriptionData()}catch(i){console.warn("Failed to refresh subscription data globally:",i)}}else throw new Error(t.message||"Payment failed")}catch(s){console.error("Addon purchase failed:",s),c({title:"Purchase Failed",description:s instanceof Error?s.message:"Failed to purchase addons",variant:"destructive"})}finally{N(!1)}};return k?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading subscription details..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"sm:flex sm:items-center",children:e.jsxs("div",{className:"sm:flex-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Subscription Management"}),e.jsx("p",{className:"mt-2 text-sm text-gray-700 dark:text-gray-300",children:"Manage your subscription and addon services"})]})}),!a&&e.jsxs(d,{onClick:()=>m("/vendor/subscription-plans"),children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Get Started"]})]}),a?e.jsxs(x,{children:[e.jsx(g,{children:e.jsxs(j,{className:"flex items-center space-x-3",children:[L(a.planName),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[a.planName," Plan"]}),e.jsx(b,{variant:a.status==="active"?"default":"secondary",children:a.status.toUpperCase()})]})]})}),e.jsxs(p,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(C,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Start Date"}),e.jsx("p",{className:"font-medium",children:A(a.startDate)})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(C,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"End Date"}),e.jsx("p",{className:"font-medium",children:A(a.endDate)})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(R,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Days Remaining"}),e.jsxs("p",{className:"font-medium text-green-600",children:[E(a.endDate)," days"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Plan Features"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:a.features.map((s,t)=>{const i=typeof s=="string"?s:typeof s=="object"&&s!==null&&"name"in s?s.name:String(s);return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:String(i)})]},t)})})]}),a.addons&&a.addons.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Purchased Add-ons"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:a.addons.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-1.5 rounded bg-blue-100",children:e.jsx(h,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.name}),e.jsx("p",{className:"text-xs text-gray-600 capitalize",children:s.category})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-blue-600",children:["₹",s.price.toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-500",children:s.billingType.replace("_"," ").replace("per property","per listing")})]})]},t))})]}),a.amount&&e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-black",children:"Total Amount"}),e.jsxs("p",{className:"font-semibold text-lg dark:text-black",children:["₹",a.amount.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-black",children:"Billing"}),e.jsx("p",{className:"font-medium dark:text-black",children:a.billingCycle})]})]})}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(d,{variant:"outline",onClick:()=>m("/vendor/subscription-plans"),children:"Upgrade Plan"}),e.jsx(d,{variant:"outline",onClick:()=>m("/vendor/billing"),children:"View Billing"})]})]})]}):e.jsx(x,{children:e.jsxs(p,{className:"text-center py-12",children:[e.jsx(S,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"No Active Subscription"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Choose a subscription plan to get started with premium features"}),e.jsx(d,{onClick:()=>m("/vendor/subscription-plans"),children:"Choose Plan"})]})}),e.jsxs(x,{children:[e.jsx(g,{children:e.jsxs(j,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Available Addon Services"}),r.length>0&&e.jsxs(b,{variant:"outline",children:[r.length," selected"]})]})}),e.jsxs(p,{children:[e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:(()=>{const s=a?.addons?.map(i=>i._id)||[];console.log("Purchased addon IDs:",s),console.log("Available addons:",o.map(i=>({id:i._id,name:i.name})));const t=o.filter(i=>!a?.addons?.some(n=>n._id===i._id));return console.log("Filtered addons (after removing purchased):",t.map(i=>({id:i._id,name:i.name}))),t})().map(s=>{const t=r.some(i=>i._id===s._id);return e.jsxs(x,{className:`cursor-pointer transition-all duration-200 hover:shadow-md ${t?"ring-2 ring-blue-500 bg-blue-50":""}`,onClick:()=>B(s),children:[e.jsxs(g,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(j,{className:"text-lg",children:s.name}),t?e.jsx(h,{className:"w-6 h-6 text-blue-600"}):e.jsx(_,{className:"w-6 h-6 text-gray-400"})]}),e.jsxs("div",{className:"text-xl font-bold text-blue-600",children:["₹",s.price.toLocaleString(),e.jsxs("span",{className:"text-sm text-gray-500 font-normal",children:["/",s.billingType.replace("_"," ").replace("per property","per listing")]})]})]}),e.jsxs(p,{children:[e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:s.description}),e.jsx(b,{variant:"outline",className:"capitalize",children:s.category})]})]},s._id)})}),a&&o.length>0&&o.every(s=>a.addons?.some(t=>t._id===s._id))&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(h,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"All Addons Purchased!"}),e.jsx("p",{className:"text-gray-600",children:"You have already purchased all available addon services."})]}),r.length>0&&e.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:[r.length," addon(s) selected"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Total: ₹",u().toLocaleString()]})]}),e.jsx(d,{onClick:F,disabled:y,size:"lg",children:y?"Processing...":`Purchase Addons - ₹${u().toLocaleString()}`})]})})]})]})]})};export{ee as default};

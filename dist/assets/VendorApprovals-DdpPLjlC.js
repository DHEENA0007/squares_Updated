import{j as e}from"./ui-CEFKCYQo.js";import{r as s}from"./router-Bi51YGN-.js";import{a,b as t,c as l,n as r,e as i,C as n,E as c,o as d,Q as m,I as o,S as x,r as p,s as u,v as h,w as f,f as j,M as v,y as N,q as g,W as w,Y as y,Z as b,_ as S,$ as k,B as E,a2 as R,O as A,t as C}from"./index-DbnZmv1f.js";import{f as I,h as _}from"./apiUtils-H5kZq7Df.js";import{D}from"./download-iSjWnlgE.js";import"./vendor-eVk5PToZ.js";const P=()=>{const[P,F]=s.useState([]),[O,T]=s.useState(null),[V,U]=s.useState(!0),[B,L]=s.useState(null),[$,q]=s.useState(!1),[G,J]=s.useState({status:"pending",search:"",page:1,limit:10}),[z,M]=s.useState(null),Q=async()=>{try{const e=new URLSearchParams({page:G.page.toString(),limit:G.limit.toString(),status:G.status,search:G.search,sortBy:"submittedAt",sortOrder:"desc"}),s=await I(`/admin/vendor-approvals?${e}`),a=await _(s);F(a.data.vendors||[])}catch(e){C({title:"Error",description:e instanceof Error?e.message:"Failed to fetch vendor applications",variant:"destructive"}),F([])}},W=async()=>{try{const e=await I("/admin/vendor-approval-stats"),s=await _(e);T(s.data||null)}catch(e){C({title:"Error",description:e instanceof Error?e.message:"Failed to fetch statistics",variant:"destructive"}),T(null)}};s.useEffect(()=>{(async()=>{U(!0),await Promise.all([Q(),W()]),U(!1)})()},[G.status,G.page,G.search]);const Y=({status:s})=>{const a={pending:{variant:"secondary",icon:r},approved:{variant:"default",icon:n},rejected:{variant:"destructive",icon:A},under_review:{variant:"default",icon:c}},t=a[s]||a.pending,l=t.icon;return e.jsxs(E,{variant:t.variant,children:[e.jsx(l,{className:"w-3 h-3 mr-1"}),s.replace("_"," ")]})};return V?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col space-y-2 md:flex-row md:justify-between md:items-start md:space-y-0",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Vendor Applications"}),e.jsx("p",{className:"mt-1 md:mt-2 text-sm md:text-base text-muted-foreground",children:"Review and manage vendor applications"})]})}),O&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6",children:[e.jsxs(a,{children:[e.jsxs(t,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-xs md:text-sm font-medium",children:"Pending"}),e.jsx(r,{className:"h-3 w-3 md:h-4 md:w-4 text-muted-foreground"})]}),e.jsx(i,{children:e.jsx("div",{className:"text-lg md:text-2xl font-bold",children:O.overview.pendingApplications})})]}),e.jsxs(a,{children:[e.jsxs(t,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-xs md:text-sm font-medium",children:"Approved"}),e.jsx(n,{className:"h-3 w-3 md:h-4 md:w-4 text-muted-foreground"})]}),e.jsx(i,{children:e.jsx("div",{className:"text-lg md:text-2xl font-bold",children:O.overview.approvedApplications})})]}),e.jsxs(a,{children:[e.jsxs(t,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-xs md:text-sm font-medium",children:"Under Review"}),e.jsx(c,{className:"h-3 w-3 md:h-4 md:w-4 text-muted-foreground"})]}),e.jsx(i,{children:e.jsx("div",{className:"text-lg md:text-2xl font-bold",children:O.overview.underReviewApplications})})]}),e.jsxs(a,{children:[e.jsxs(t,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-xs md:text-sm font-medium",children:"Approval Rate"}),e.jsx(d,{className:"h-3 w-3 md:h-4 md:w-4 text-muted-foreground"})]}),e.jsx(i,{children:e.jsxs("div",{className:"text-lg md:text-2xl font-bold",children:[O.overview.approvalRate,"%"]})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(o,{placeholder:"Search by company name, email, or license number...",value:G.search,onChange:e=>J({...G,search:e.target.value,page:1}),className:"pl-10"})]}),e.jsxs(x,{value:G.status,onValueChange:e=>J({...G,status:e,page:1}),children:[e.jsx(p,{className:"w-full sm:w-48",children:e.jsx(u,{placeholder:"Filter by status"})}),e.jsxs(h,{children:[e.jsx(f,{value:"all",children:"All Status"}),e.jsx(f,{value:"pending",children:"Pending"}),e.jsx(f,{value:"under_review",children:"Under Review"}),e.jsx(f,{value:"approved",children:"Approved"}),e.jsx(f,{value:"rejected",children:"Rejected"})]})]})]}),e.jsx(a,{children:e.jsx(i,{className:"p-0",children:e.jsx("ul",{className:"divide-y divide-border",children:0===P.length?e.jsx("li",{className:"p-6 text-center text-muted-foreground",children:"No applications found matching your criteria"}):P.map(s=>{return e.jsx("li",{className:"p-4 md:p-6 hover:bg-muted/50",children:e.jsx("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-col space-y-3 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:items-center md:space-x-4 md:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base md:text-lg font-medium",children:s.businessInfo.companyName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.user.profile.firstName," ",s.user.profile.lastName]})]}),e.jsx(Y,{status:s.approval.status})]}),e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:items-center md:space-x-4 md:space-y-0",children:[e.jsxs("div",{className:"text-left md:text-right text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Submitted: ",(a=s.approval.submittedAt,new Date(a).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))]}),e.jsxs("p",{children:["Documents: ",s.approval.submittedDocuments.length]})]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>{L(s),q(!0)},className:"w-full md:w-auto",children:[e.jsx(c,{className:"h-4 w-4 mr-2"}),"Review"]})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.user.email})]}),s.user.profile.phone&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:s.user.profile.phone})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.businessInfo.businessType})]})]})]})})},s._id);var a})})})}),e.jsx(w,{open:$,onOpenChange:q,children:e.jsxs(y,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(b,{children:[e.jsx(S,{className:"text-lg md:text-xl",children:"Vendor Application Details"}),e.jsx(k,{children:"Review and take action on the vendor application."})]}),B&&e.jsxs("div",{className:"space-y-4 md:space-y-6 py-2 md:py-4",children:[e.jsxs(a,{children:[e.jsx(t,{children:e.jsx(l,{className:"text-base md:text-lg",children:"Basic Information"})}),e.jsx(i,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Company Name:"}),e.jsx("span",{className:"break-words",children:B.businessInfo.companyName})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Business Type:"}),e.jsx("span",{children:B.businessInfo.businessType})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Contact Person:"}),e.jsxs("span",{children:[B.user.profile.firstName," ",B.user.profile.lastName]})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Email:"}),e.jsx("span",{className:"break-all",children:B.user.email})]}),B.businessInfo.licenseNumber&&e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"License Number:"}),e.jsx("span",{className:"break-all",children:B.businessInfo.licenseNumber})]}),B.businessInfo.gstNumber&&e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"GST Number:"}),e.jsx("span",{className:"break-all",children:B.businessInfo.gstNumber})]})]})})]}),e.jsxs(a,{children:[e.jsx(t,{children:e.jsx(l,{className:"text-base md:text-lg",children:"Submitted Documents"})}),e.jsx(i,{children:e.jsx("div",{className:"space-y-2",children:B.approval.submittedDocuments.map((s,a)=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between p-3 bg-muted/50 rounded-md gap-2 sm:gap-0",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx(d,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.documentName}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.documentType.replace("_"," ")})]})]}),e.jsxs("div",{className:"flex items-center justify-between sm:justify-end space-x-2 sm:flex-shrink-0",children:[s.verified?e.jsx(E,{variant:"default",className:"text-xs",children:"Verified"}):e.jsx(E,{variant:"secondary",className:"text-xs",children:"Pending"}),e.jsx("a",{href:s.documentUrl,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline p-1",children:e.jsx(D,{className:"h-4 w-4"})})]})]},a))})})]})]}),e.jsxs(R,{className:"flex flex-col-reverse sm:flex-row gap-2 sm:gap-0",children:[e.jsx(j,{variant:"outline",onClick:()=>q(!1),className:"w-full sm:w-auto",children:"Close"}),"pending"===B?.approval.status&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:space-x-4 w-full sm:w-auto",children:[e.jsx(j,{onClick:()=>(async e=>{const s=prompt("Enter rejection reason (required):");if(s){M("reject");try{const a=await I(`/admin/vendor-approvals/${e}/reject`,{method:"POST",body:JSON.stringify({rejectionReason:s,allowResubmission:!0})}),t=await _(a);if(!t.success)throw new Error(t.message||"Failed to reject vendor");C({title:"Success",description:"Vendor application rejected and vendor notified",variant:"default"}),Q(),W(),q(!1)}catch(a){C({title:"Error",description:a instanceof Error?a.message:"Failed to reject vendor application",variant:"destructive"})}finally{M(null)}}})(B._id),disabled:"reject"===z,variant:"destructive",className:"w-full sm:w-auto",children:"reject"===z?"Rejecting...":"Reject"}),e.jsx(j,{onClick:()=>(async e=>{const s=prompt("Enter approval notes (optional):");M("approve");try{const a=await I(`/admin/vendor-approvals/${e}/approve`,{method:"POST",body:JSON.stringify({approvalNotes:s,verificationLevel:"basic"})}),t=await _(a);if(!t.success)throw new Error(t.message||"Failed to approve vendor");C({title:"Success",description:"Vendor application approved successfully",variant:"default"}),Q(),W(),q(!1)}catch(a){C({title:"Error",description:a instanceof Error?a.message:"Failed to approve vendor application",variant:"destructive"})}finally{M(null)}})(B._id),disabled:"approve"===z,variant:"default",className:"w-full sm:w-auto",children:"approve"===z?"Approving...":"Approve"})]})]})]})})]})};export{P as default};

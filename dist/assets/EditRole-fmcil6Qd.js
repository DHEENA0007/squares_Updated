import{j as e}from"./ui-BHyUY8Z8.js";import{g as O,d as $,r as m}from"./router-2SVJvIbS.js";import{W as V,u as W,H as k,f as h,B as u,S as L,a as g,b as j,c as f,d as M,e as v,L as x,I as D,q as Y}from"./index-Bd1eLXM_.js";import{C as G}from"./checkbox-CFGICxZb.js";import{S as J}from"./switch-DhuCaVX7.js";import{A as N,a as y}from"./alert-DQvV8n_v.js";import{r as b}from"./roleService-aAI-qze7.js";import{A as I}from"./arrow-left-Dy16oLhe.js";import{I as E}from"./info-CXcNcErv.js";import{C as S}from"./circle-alert--1esrBFY.js";import{C as T}from"./circle-check-DJZyI1A1.js";import{S as K}from"./save-VRl1U5Be.js";import"./vendor-Dazix4UH.js";const oe=()=>{const{id:d}=O(),n=$(),{toast:w}=V(),{isSuperAdmin:l}=W(),[s,c]=m.useState(null),[U,C]=m.useState(!0),[p,A]=m.useState(!1),[q,z]=m.useState([]);m.useEffect(()=>{(async()=>{if(d)try{C(!0);const[t,r]=await Promise.all([b.getRole(d),b.getPermissions()]);console.log("Fetched role:",t.data.role),console.log("Fetched permissions:",r),c(t.data.role),z(r)}catch(t){console.error("Failed to fetch role:",t),w({title:"Error",description:"Failed to load role data.",variant:"destructive"}),n("/admin/roles")}finally{C(!1)}})()},[d,n,w]);const B=async a=>{if(a.preventDefault(),!(!s||!d))try{A(!0),await b.updateRole(d,{name:s.name,description:s.description,permissions:s.permissions,isActive:s.isActive,level:s.level}),n("/admin/roles")}catch(t){console.error("Failed to update role:",t)}finally{A(!1)}},R=a=>{if(!s||s.isSystemRole&&!l)return;console.log("Toggling permission:",a),console.log("Current permissions:",s.permissions);const t=s.permissions.includes(a)?s.permissions.filter(r=>r!==a):[...s.permissions,a];console.log("New permissions:",t),c({...s,permissions:t})},_=a=>a.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase()),H=()=>{const a={"Property Management":[],"User Management":[],"Vendor Management":[],"System Management":[],Communication:[],"Support & Operations":[],Analytics:[]};return q.forEach(t=>{t.includes("property")||t.includes("review")||t.includes("approve_properties")||t.includes("reject_properties")?a["Property Management"].push(t):t.includes("user")||t.includes("role")?a["User Management"].push(t):t.includes("vendor")?a["Vendor Management"].push(t):t.includes("plan")||t.includes("dashboard")||t.includes("settings")||t.includes("content")&&!t.includes("moderate")?a["System Management"].push(t):t.includes("message")||t.includes("moderate")||t.includes("notification")?a.Communication.push(t):t.includes("support")||t.includes("promotion")||t.includes("report")?a["Support & Operations"].push(t):t.includes("analytics")&&a.Analytics.push(t)}),Object.entries(a).filter(([t,r])=>r.length>0)};return U?e.jsxs("div",{className:"flex justify-center items-center py-12 relative top-[60px]",children:[e.jsx(k,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading role..."})]}):s?e.jsxs("div",{className:"space-y-6 relative top-[60px] pb-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>n("/admin/roles"),children:e.jsx(I,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Edit Role"}),s.isSystemRole&&e.jsxs(u,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(L,{className:"h-3 w-3"}),"System Role"]})]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Update role details and permissions"})]})]}),s.isSystemRole&&e.jsxs(N,{children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(y,{children:"This is a system role. Some fields are restricted to maintain system integrity. You can only update the description."})]}),e.jsxs("form",{onSubmit:B,className:"space-y-6",children:[e.jsxs(g,{children:[e.jsxs(j,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:"1"})}),"Basic Information"]}),e.jsx(M,{children:"Core details about this role"})]}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{htmlFor:"name",className:"flex items-center gap-1",children:["Role Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(D,{id:"name",value:s.name,onChange:a=>c({...s,name:a.target.value}),disabled:s.isSystemRole&&!l,required:!0,className:s.isSystemRole&&!l?"bg-muted":""}),s.isSystemRole&&!l&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(S,{className:"h-3 w-3"}),"System roles cannot be renamed"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{htmlFor:"level",className:"flex items-center gap-1",children:["Authorization Level ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(D,{id:"level",type:"number",min:1,max:10,value:s.level,onChange:a=>c({...s,level:parseInt(a.target.value)||1}),disabled:s.isSystemRole&&!l,required:!0,className:s.isSystemRole&&!l?"bg-muted":""}),e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(E,{className:"h-3 w-3"}),"Level ",s.level,"/10 - ",s.level>=8?"High Authority":s.level>=5?"Medium Authority":"Low Authority"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{htmlFor:"description",className:"flex items-center gap-1",children:["Description ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(Y,{id:"description",value:s.description,onChange:a=>c({...s,description:a.target.value}),rows:4,required:!0}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.description.length," characters"]}),s.description.length>=10&&e.jsx(T,{className:"h-4 w-4 text-green-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(x,{htmlFor:"isActive",className:"text-base font-medium cursor-pointer",children:"Active Role"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.isActive?"Users can be assigned to this role":"Role is currently disabled"})]}),e.jsx(J,{id:"isActive",checked:s.isActive,onCheckedChange:a=>c({...s,isActive:a}),disabled:s.isSystemRole&&s.isActive&&!l})]}),s.isSystemRole&&s.isActive&&!l&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(S,{className:"h-3 w-3"}),"System roles cannot be deactivated"]})]})]}),e.jsxs(g,{children:[e.jsxs(j,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:"2"})}),"Permissions"]}),e.jsx(M,{children:"Define what actions users with this role can perform"})]}),e.jsxs(v,{className:"space-y-6",children:[s.isSystemRole&&e.jsxs(N,{children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx(y,{children:"System role permissions are managed by the system and cannot be modified"})]}),H().map(([a,t])=>{const r=t.filter(i=>s.permissions.includes(i)).length,F=r===t.length;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{variant:F?"default":"outline",className:"text-sm px-3 py-1",children:a}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[r," of ",t.length," selected"]})]}),F&&e.jsx(T,{className:"h-5 w-5 text-green-600"})]}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:t.map(i=>{const P=s.permissions.includes(i),o=s.isSystemRole&&!l;return e.jsxs("div",{className:`flex items-start space-x-3 p-3 border-2 rounded-lg transition-all ${o?"opacity-70 cursor-not-allowed":"cursor-pointer"} ${P?"border-primary bg-primary/5":"border-border hover:border-primary/50 hover:bg-muted/50"}`,children:[e.jsx(G,{id:i,checked:P,onCheckedChange:()=>!o&&R(i),disabled:o,className:"mt-1"}),e.jsx("div",{className:"flex-1",onClick:()=>!o&&R(i),children:e.jsx(x,{htmlFor:i,className:`font-medium text-sm ${o?"cursor-not-allowed":"cursor-pointer"}`,children:_(i)})})]},i)})})]},a)}),s.permissions.length===0&&!s.isSystemRole&&e.jsxs(N,{variant:"destructive",children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx(y,{children:"This role has no permissions assigned. Users with this role won't be able to perform any actions."})]})]})]}),e.jsxs(g,{children:[e.jsx(j,{children:e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:"3"})}),"Review & Save"]})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Role Name"}),e.jsx("p",{className:"font-medium",children:s.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Level"}),e.jsxs(u,{variant:s.level>=8?"destructive":s.level>=5?"default":"secondary",children:["Level ",s.level]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Permissions"}),e.jsxs("p",{className:"font-medium",children:[s.permissions.length," selected"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(u,{variant:s.isActive?"default":"secondary",children:s.isActive?"Active":"Inactive"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(h,{type:"submit",disabled:p,className:"flex items-center gap-2",size:"lg",children:p?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-4 w-4 animate-spin"}),"Saving Changes..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4"}),"Save Changes"]})}),e.jsx(h,{type:"button",variant:"outline",onClick:()=>n("/admin/roles"),disabled:p,size:"lg",children:"Cancel"})]})]})]})]})]}):e.jsx("div",{className:"space-y-6 relative top-[60px]",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>n("/admin/roles"),children:e.jsx(I,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Role Not Found"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"The requested role could not be found."})]})]})})};export{oe as default};

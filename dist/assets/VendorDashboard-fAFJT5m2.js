import{j as e}from"./ui-DOY6021Z.js";import{r as c}from"./router-2SVJvIbS.js";import{A as z,t as D,av as K,f as u,aq as P,U as L,E as I,$ as O,ad as Y,aI as G,a as w,e as N,b as T,c as E,B as F,V as W,W as X,Y as J,Z as $,h as Q,at as Z}from"./index-SPvHGBGF.js";import{L as ee}from"./loader-circle-B83afoI3.js";import{R as B}from"./refresh-cw-BxN4QFjr.js";import{D as se}from"./dollar-sign-CwZezxSE.js";import{T as te}from"./trending-up-ohBLGDCN.js";import{T as re}from"./trending-down-B09w3R_6.js";import{g as ae,B as V,X as _,Y as H,f as ne,R as oe,C as ce,T as ie}from"./generateCategoricalChart-Xql8RzzI.js";import{A as U}from"./activity-CNIF8xj6.js";import{E as le}from"./ellipsis-Na0dZh58.js";import"./vendor-Dazix4UH.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=z("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);var he=ae({chartName:"BarChart",GraphicalChild:V,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:_},{axisType:"yAxis",AxisComp:H}],formatAxisMap:ne});const me="https://squares-v2.onrender.com/api";class ue{async makeRequest(a,s={}){const m=`${me}${a}`,i={headers:{"Content-Type":"application/json",...s.headers},...s},d=localStorage.getItem("token");d&&(i.headers={...i.headers,Authorization:`Bearer ${d}`});try{const n=await fetch(m,i);if(!n.ok){const h=await n.json().catch(()=>({success:!1,message:`HTTP ${n.status}: ${n.statusText}`}));throw new Error(h.message||"An error occurred")}return await n.json()}catch(n){throw console.error("Vendor Dashboard API request failed:",n),n}}async getDashboardData(a={}){try{const s=new URLSearchParams;Object.entries(a).forEach(([d,n])=>{n!=null&&n!==""&&s.append(d,n.toString())});const m=`/vendors/dashboard${s.toString()?`?${s.toString()}`:""}`,i=await this.makeRequest(m);return i.success&&i.data?i.data:this.getEmptyDashboardData()}catch(s){return console.error("Failed to fetch vendor dashboard data:",s),this.getEmptyDashboardData()}}async getVendorStats(a="7d"){try{const s=await this.makeRequest(`/vendors/stats?dateRange=${a}`);if(s.success&&s.data)return s.data;throw new Error("Failed to fetch vendor stats")}catch(s){return console.error("Failed to fetch vendor stats:",s),{totalProperties:0,totalPropertiesChange:"+0",activeLeads:0,activeLeadsChange:"+0",propertyViews:0,propertyViewsChange:"+0%",unreadMessages:0,totalMessages:0,messagesChange:"0 unread",totalRevenue:0,revenueChange:"+0%",conversionRate:0,conversionChange:"+0%"}}}async getRecentProperties(a=6){try{const s=await this.makeRequest(`/vendors/properties/recent?limit=${a}`);if(s.success&&s.data)return s.data.properties;throw new Error("Failed to fetch recent properties")}catch(s){return console.error("Failed to fetch recent properties:",s),[]}}async getRecentLeads(a=10){try{const s=await this.makeRequest(`/vendors/leads/recent?limit=${a}`);if(s.success&&s.data)return s.data.leads;throw new Error("Failed to fetch recent leads")}catch(s){return console.error("Failed to fetch recent leads:",s),[]}}async getPerformanceData(a="7d"){try{const s=await this.makeRequest(`/vendors/performance?dateRange=${a}`);if(s.success&&s.data)return s.data.performance;throw new Error("Failed to fetch performance data")}catch(s){return console.error("Failed to fetch performance data:",s),[]}}async getVendorAnalytics(a="30d"){try{const s=await this.makeRequest(`/vendors/analytics?dateRange=${a}`);if(s.success&&s.data)return s.data;throw new Error("Failed to fetch vendor analytics")}catch(s){return console.error("Failed to fetch vendor analytics:",s),{monthlyPerformance:[],leadsBySource:[],propertyPerformance:[],topPerformingAreas:[]}}}async getNotifications(){try{const a=await this.makeRequest("/vendors/notifications");return a.success&&a.data?a.data.notifications:[]}catch(a){return console.error("Failed to fetch notifications:",a),[]}}async markNotificationAsRead(a){try{return(await this.makeRequest(`/vendors/notifications/${a}/read`,{method:"PATCH"})).success}catch(s){return console.error("Failed to mark notification as read:",s),!1}}async updateLeadStatus(a,s){try{return(await this.makeRequest(`/vendors/leads/${a}/status`,{method:"PATCH",body:JSON.stringify({status:s})})).success?(D({title:"Success",description:"Lead status updated successfully!"}),!0):!1}catch(m){const i=m instanceof Error?m.message:"Failed to update lead status";return D({title:"Error",description:i,variant:"destructive"}),!1}}formatPrice(a,s="₹"){return a>=1e7?`${s}${(a/1e7).toFixed(1)} Cr`:a>=1e5?`${s}${(a/1e5).toFixed(1)} L`:`${s}${a.toLocaleString("en-IN")}`}formatPercentageChange(a){const s=a.startsWith("+");return{value:a,isPositive:s}}getStatusColor(a){return{active:"bg-green-500",pending:"bg-yellow-500",sold:"bg-blue-500",rented:"bg-purple-500",inactive:"bg-gray-500",new:"bg-blue-500",contacted:"bg-yellow-500",qualified:"bg-orange-500",converted:"bg-green-500",lost:"bg-red-500"}[a]||"bg-gray-500"}getInterestColor(a){return{high:"text-green-600 bg-green-100 dark:text-green-400 dark:bg-green-900",medium:"text-yellow-600 bg-yellow-100 dark:text-yellow-400 dark:bg-yellow-900",low:"text-red-600 bg-red-100 dark:text-red-400 dark:bg-red-900"}[a]||"text-gray-600 bg-gray-100"}getEmptyDashboardData(){return{stats:{totalProperties:0,totalPropertiesChange:"+0",activeLeads:0,activeLeadsChange:"+0",propertyViews:0,propertyViewsChange:"+0%",unreadMessages:0,totalMessages:0,messagesChange:"0 unread",totalRevenue:0,revenueChange:"+0%",conversionRate:0,conversionChange:"+0%"},recentProperties:[],recentLeads:[],performanceData:[],analytics:{monthlyPerformance:[],leadsBySource:[],propertyPerformance:[],topPerformingAreas:[]},notifications:[]}}}const l=new ue,xe=(p={})=>{const{autoRefresh:a=!0,refreshInterval:s=3e4,enableRealtime:m=!0}=p,{isConnected:i}=K(),d=c.useRef(null),n=c.useRef({}),[h,b]=c.useState({stats:null,recentProperties:[],recentLeads:[],performanceData:[],notifications:[],isLoading:!0,error:null,lastUpdated:null}),o=c.useCallback(t=>{b(x=>({...x,...t,lastUpdated:new Date}))},[]),j=c.useCallback(async()=>{try{const t=await l.getVendorStats();o({stats:t})}catch(t){console.error("Failed to refresh vendor stats:",t),o({error:t instanceof Error?t.message:"Failed to load stats"})}},[o]),v=c.useCallback(async()=>{try{const t=await l.getRecentProperties(6);o({recentProperties:t})}catch(t){console.error("Failed to refresh properties:",t)}},[o]),C=c.useCallback(async()=>{try{const t=await l.getRecentLeads(10);o({recentLeads:t})}catch(t){console.error("Failed to refresh leads:",t)}},[o]),R=c.useCallback(async()=>{try{const t=await l.getPerformanceData();o({performanceData:t})}catch(t){console.error("Failed to refresh performance data:",t)}},[o]),A=c.useCallback(async()=>{try{const t=await l.getNotifications();o({notifications:t})}catch(t){console.error("Failed to refresh notifications:",t)}},[o]),g=c.useCallback(async()=>{o({isLoading:!0,error:null});try{const t=await l.getDashboardData(n.current);o({stats:t.stats,recentProperties:t.recentProperties,recentLeads:t.recentLeads,performanceData:t.performanceData,notifications:t.notifications,isLoading:!1,error:null})}catch(t){console.error("Failed to refresh dashboard data:",t),o({isLoading:!1,error:t instanceof Error?t.message:"Failed to load dashboard data"})}},[o]),k=c.useCallback(t=>{n.current={...n.current,...t},g()},[g]),M=c.useCallback(async t=>{try{await l.markNotificationAsRead(t)&&o({notifications:h.notifications.map(f=>f.id===t?{...f,isRead:!0}:f)})}catch(x){console.error("Failed to mark notification as read:",x),D({title:"Error",description:"Failed to mark notification as read",variant:"destructive"})}},[h.notifications,o]),y=c.useCallback(async(t,x)=>{try{await l.updateLeadStatus(t,x)&&(o({recentLeads:h.recentLeads.map(r=>r._id===t?{...r,status:x,updatedAt:new Date().toISOString()}:r)}),j())}catch(f){console.error("Failed to update lead status:",f)}},[h.recentLeads,o,j]);return c.useEffect(()=>{},[m,i]),c.useEffect(()=>{if(a&&s>0)return d.current=setInterval(()=>{h.isLoading||g()},s),()=>{d.current&&clearInterval(d.current)}},[a,s,g,h.isLoading]),c.useEffect(()=>{g()},[]),c.useEffect(()=>()=>{d.current&&clearInterval(d.current)},[]),[h,{refreshData:g,refreshStats:j,refreshProperties:v,refreshLeads:C,refreshPerformance:R,refreshNotifications:A,updateFilters:k,markNotificationAsRead:M,updateLeadStatus:y}]},Pe=()=>{const[p,a]=c.useState("7d"),[s,m]=c.useState("overview"),[i,d]=xe({autoRefresh:!0,refreshInterval:3e4,enableRealtime:!0}),{stats:n,recentProperties:h,recentLeads:b,performanceData:o,notifications:j,isLoading:v,error:C,lastUpdated:R}=i,{refreshData:A,refreshStats:g,updateFilters:k,markNotificationAsRead:M,updateLeadStatus:y}=d;c.useEffect(()=>{k({dateRange:p})},[p,k]);const S=()=>{A(),D({title:"Dashboard Refreshed",description:"All data has been updated with the latest information."})};if(v&&!n)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ee,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading your dashboard..."})]})});if(C&&!n)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 mb-4",children:C}),e.jsxs(u,{onClick:S,children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Try Again"]})]})});const t=j.filter(r=>!r.isRead).length,x=[{title:"Total Properties",value:n?.totalProperties||0,change:n?.totalPropertiesChange||"+0",icon:P,color:"text-blue-600"},{title:"Active Leads",value:n?.activeLeads||0,change:n?.activeLeadsChange||"+0",icon:L,color:"text-green-600"},{title:"Property Views",value:n?.propertyViews||0,change:n?.propertyViewsChange||"+0%",icon:I,color:"text-purple-600"},{title:"Messages",value:n?.totalMessages||0,change:n?.messagesChange||"0 unread",icon:O,color:"text-orange-600"},{title:"Total Revenue",value:l.formatPrice(n?.totalRevenue||0),change:n?.revenueChange||"+0%",icon:se,color:"text-emerald-600"},{title:"Conversion Rate",value:`${n?.conversionRate||0}%`,change:n?.conversionChange||"+0%",icon:de,color:"text-indigo-600"}],f=o.length>0?o:[];return e.jsxs("div",{className:"space-y-6 mt-16",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Vendor Dashboard"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-muted-foreground",children:"Manage your properties and track your performance"}),R&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["• Last updated: ",R.toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{variant:"outline",onClick:S,disabled:v,children:[e.jsx(B,{className:`w-4 h-4 mr-2 ${v?"animate-spin":""}`}),"Refresh"]}),t>0&&e.jsxs(u,{variant:"outline",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Notifications (",t,")"]}),e.jsxs(u,{variant:"outline",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"View Analytics"]}),e.jsxs(u,{children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Add Property"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6",children:x.map(r=>{const q=l.formatPercentageChange(r.change);return e.jsx(w,{children:e.jsx(N,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:r.title}),e.jsx("p",{className:"text-2xl font-bold",children:r.value}),e.jsxs("div",{className:"flex items-center mt-1",children:[q.isPositive?e.jsx(te,{className:"h-4 w-4 text-green-500 mr-1"}):e.jsx(re,{className:"h-4 w-4 text-red-500 mr-1"}),e.jsx("p",{className:`text-xs ${q.isPositive?"text-green-500":"text-red-500"}`,children:r.change})]})]}),e.jsx(r.icon,{className:`h-8 w-8 ${r.color}`})]})})},r.title)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsx(T,{children:e.jsxs(E,{className:"flex items-center justify-between",children:["Leads & Views Performance",e.jsx("div",{className:"flex gap-2",children:["7d","30d","90d"].map(r=>e.jsx(u,{variant:p===r?"default":"ghost",size:"sm",onClick:()=>a(r),children:r},r))})]})}),e.jsx(N,{children:f.length>0?e.jsx(oe,{width:"100%",height:300,children:e.jsxs(he,{data:f,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(_,{dataKey:"date"}),e.jsx(H,{}),e.jsx(ie,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"6px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)",color:"hsl(var(--foreground))"},labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(V,{dataKey:"views",fill:"#8884d8",name:"Views"}),e.jsx(V,{dataKey:"leads",fill:"#82ca9d",name:"Leads"})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-[300px] text-center",children:[e.jsx(U,{className:"w-16 h-16 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:"No Performance Data"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md",children:"Performance metrics will appear here once your properties start receiving views and generating leads."})]})})]}),e.jsxs(w,{children:[e.jsx(T,{children:e.jsxs(E,{className:"flex items-center justify-between",children:["Recent Leads",e.jsx(u,{variant:"ghost",size:"sm",children:"View All"})]})}),e.jsx(N,{children:e.jsx("div",{className:"space-y-4",children:b.length>0?b.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center",children:e.jsx(L,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:r.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.propertyTitle}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.phone})]})]}),e.jsxs("div",{className:"text-right space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:l.getInterestColor(r.interestLevel),children:r.interestLevel}),e.jsxs(W,{children:[e.jsx(X,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"sm",children:e.jsx(le,{className:"h-4 w-4"})})}),e.jsxs(J,{children:[e.jsx($,{onClick:()=>y(r._id,"contacted"),children:"Mark as Contacted"}),e.jsx($,{onClick:()=>y(r._id,"qualified"),children:"Mark as Qualified"}),e.jsx($,{onClick:()=>y(r._id,"converted"),children:"Mark as Converted"})]})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center",children:[e.jsx(U,{className:"w-3 h-3 mr-1"}),new Date(r.createdAt).toLocaleDateString()]})]})]},r._id)):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(L,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No recent leads"}),e.jsx("p",{className:"text-sm",children:"New leads will appear here"})]})})})]})]}),e.jsxs(w,{children:[e.jsx(T,{children:e.jsxs(E,{className:"flex items-center justify-between",children:["Recent Properties",e.jsx(u,{variant:"ghost",size:"sm",children:"View All"})]})}),e.jsx(N,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.length>0?h.map(r=>e.jsxs(w,{className:"overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r.images[0]||"https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=300&h=200&fit=crop&auto=format",alt:r.title,className:"w-full h-32 object-cover"}),e.jsx(F,{className:`absolute top-2 right-2 ${l.getStatusColor(r.status)} text-white`,children:r.status}),e.jsx("div",{className:"absolute bottom-2 left-2",children:e.jsx(F,{variant:"secondary",className:"text-xs",children:r.listingType})})]}),e.jsxs(N,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold line-clamp-1",children:r.title}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2 flex items-center",children:[e.jsx(Q,{className:"w-3 h-3 mr-1"}),r.location]}),e.jsx("p",{className:"text-lg font-bold text-primary mb-3",children:l.formatPrice(r.price,r.currency)}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),r.views," views"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),r.leads," leads"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(Z,{className:"w-4 h-4 mr-1"}),r.favorites]})]})]})]},r._id)):e.jsxs("div",{className:"col-span-full text-center py-8 text-muted-foreground",children:[e.jsx(P,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No properties found"}),e.jsx("p",{className:"text-sm",children:"Add your first property to get started"}),e.jsxs(u,{className:"mt-4",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Add Property"]})]})})})]})]})};export{Pe as default};

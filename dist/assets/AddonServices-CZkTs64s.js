import{j as e}from"./ui-s1SEoZIF.js";import{d as s,r as t}from"./router-D8v2YSKU.js";import{u as a,_ as d,a as r,b as l,c as n,s as i,e as c,Q as o,X as m,I as x,ab as u,ac as h,ad as p,ae as g,B as j,d as v,f as N,E as b,a0 as f,a1 as S,a2 as y,a3 as w,a4 as k,L as D,T as A,aa as C,V as _}from"./index-YrVmIx3a.js";import{f as E,h as L}from"./apiUtils-B8LmEMCW.js";import{C as P}from"./calendar-BA5iLWFv.js";import"./vendor-BxThA0WO.js";const R=(e,s="INR")=>new Intl.NumberFormat("en-IN",{style:"currency",currency:s,minimumFractionDigits:0}).format(e),V=e=>{const s={photography:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",videography:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300",virtual_tour:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",drone_photography:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300",floor_plan:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",staging:"bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-300",inspection:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",other:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"};return s[e]||s.other},I=()=>{const{user:I}=a(),O=s(),F=I?.rolePermissions||[],{toast:T}=d(),$="admin"===I?.role||"superadmin"===I?.role,z=e=>F.includes(e),U=$||z(_.ADDON_SERVICES_READ),M=$||z(_.ADDON_SERVICES_SCHEDULE),B=$||z(_.ADDON_SERVICES_MANAGE),H=$||z(_.ADDON_SERVICES_STATUS),Y=$||z(_.ADDON_SERVICES_NOTES),[q,J]=t.useState([]),[G,Q]=t.useState(!0),[W,X]=t.useState(""),[K,Z]=t.useState("active"),[ee,se]=t.useState(null),[te,ae]=t.useState(!1),[de,re]=t.useState(!1),[le,ne]=t.useState(!1),[ie,ce]=t.useState(null),[oe,me]=t.useState(""),[xe,ue]=t.useState(""),[he,pe]=t.useState(""),[ge,je]=t.useState({}),[ve,Ne]=t.useState(null),[be,fe]=t.useState(""),[Se,ye]=t.useState(""),[we,ke]=t.useState(""),[De,Ae]=t.useState(""),[Ce,_e]=t.useState(""),[Ee,Le]=t.useState("medium"),[Pe,Re]=t.useState(1),[Ve,Ie]=t.useState(1),[Oe,Fe]=t.useState({activeVendors:0,totalAddons:0,totalSchedules:0,completedSchedules:0,inProgressSchedules:0,scheduledSchedules:0,categories:0});t.useEffect(()=>{if(!U)return T({title:"Access Denied",description:"You don't have permission to view addon services.",variant:"destructive"}),void O("/rolebased");Te(),$e()},[K,W,Pe]),t.useEffect(()=>{Re(1)},[K,W]);const Te=async()=>{if(U)try{Q(!0);const e=await E(`/subadmin/addon-services?status=${K}&search=${W}&page=${Pe}&limit=10`),s=await L(e);J(s.data.vendorAddons||[]),Ie(s.data.totalPages||1)}catch(e){T({title:"Error",description:e.message||"Error fetching addon services",variant:"destructive"}),J([])}finally{Q(!1)}},$e=async()=>{try{const e=await E(`/subadmin/addon-services/stats?status=${K}`),s=await L(e);Fe(s.data)}catch(e){}},ze=async e=>{M?(ce(e),Le("medium"),pe(""),me(`Schedule ${e.name} Service`),ue(`Dear Vendor,\n\nWe would like to schedule the ${e.name} service that you have purchased.\n\nPlease confirm the scheduled date and time for the service.\n\nService Details:\n- Name: ${e.name}\n- Description: ${e.description}\n- Category: ${e.category.charAt(0).toUpperCase()+e.category.slice(1)}\n\nThank you!\n\nBest regards,\nAdmin Team`),re(!0)):T({title:"Access Denied",description:"You don't have permission to schedule services.",variant:"destructive"})},Ue=e=>{Ne(e),fe(e.status),ye(e.scheduledDate?new Date(e.scheduledDate).toISOString().slice(0,16):""),ke(e.vendorResponse||""),Ae(e.cancellationReason||""),ne(!0)},Me=e=>{switch(e){case"completed":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"in_progress":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"scheduled":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200";case"cancelled":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200"}},Be=e=>{switch(e){case"urgent":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";case"high":return"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200";case"medium":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";default:return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"}};return G&&0===q.length?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Addon Services"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage vendor addon services and schedule appointments"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Addon Services"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"View vendors who have purchased addon services and schedule appointments"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs(r,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Active Vendors"}),e.jsx(i,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold",children:Oe.activeVendors})})]}),e.jsxs(r,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Total Addons"}),e.jsx(o,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold",children:Oe.totalAddons})})]}),e.jsxs(r,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Scheduled"}),e.jsx(P,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:Oe.totalSchedules}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[Oe.completedSchedules," completed"]})]})]}),e.jsxs(r,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"In Progress"}),e.jsx(o,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:Oe.inProgressSchedules}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[Oe.scheduledSchedules," scheduled"]})]})]}),e.jsxs(r,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Categories"}),e.jsx(o,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold",children:Oe.categories})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Search vendors...",value:W,onChange:e=>X(e.target.value),className:"pl-10"})]}),e.jsxs(u,{value:K,onValueChange:Z,children:[e.jsxs(h,{children:[e.jsx(p,{value:"active",children:"Active Subscriptions"}),e.jsx(p,{value:"expired",children:"Expired"}),e.jsx(p,{value:"all",children:"All Vendors"})]}),e.jsxs(g,{value:K,className:"space-y-4 mt-6",children:[0===q.length?e.jsx(r,{children:e.jsxs(c,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(o,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Addon Services Found"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"active"===K?"No vendors with active addon subscriptions":`No vendors with ${K} addon subscriptions`})]})}):q.map(s=>e.jsxs(r,{children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(n,{className:"text-lg",children:[s.user.profile.firstName," ",s.user.profile.lastName]}),e.jsxs(j,{variant:"outline",children:[s.totalAddons," Addon",1!==s.totalAddons?"s":""]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{className:"text-sm",children:s.user.email}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.activeAddons.slice(0,3).map(s=>e.jsx(j,{className:V(s.category),children:s.name},s._id)),s.activeAddons.length>3&&e.jsxs(j,{variant:"outline",children:["+",s.activeAddons.length-3," more"]})]})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Value"}),e.jsx("div",{className:"text-xl font-bold text-primary",children:R(s.activeAddons.reduce((e,s)=>e+s.price,0))})]})]})}),e.jsxs(c,{children:[s.schedules&&s.schedules.length>0&&e.jsxs("div",{className:"mb-4 space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold mb-2",children:["Scheduled Services (",s.schedules.length,")"]}),e.jsx("div",{className:"space-y-2",children:s.schedules.map(s=>e.jsxs("div",{className:"bg-muted/50 p-3 rounded-md border border-border hover:bg-muted transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm",children:s.addon.name}),e.jsx(j,{className:V(s.addon.category),variant:"outline",children:s.addon.category})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:Me(s.status),children:s.status.replace("_"," ")}),e.jsx(j,{className:Be(s.priority),children:s.priority})]}),s.scheduledDate&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Scheduled: ",new Date(s.scheduledDate).toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Created: ",new Date(s.createdAt).toLocaleDateString()]})]}),B&&e.jsx(N,{size:"sm",variant:"outline",onClick:()=>Ue(s),children:"Manage"}),!B&&H&&e.jsx(N,{size:"sm",variant:"outline",onClick:()=>Ue(s),children:"Update Status"}),!B&&!H&&Y&&e.jsx(N,{size:"sm",variant:"outline",onClick:()=>Ue(s),children:"Add Notes"})]}),s.notes&&s.notes.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-border/50",children:[e.jsx("p",{className:"text-xs font-medium mb-1",children:"Latest Note:"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.notes[s.notes.length-1].message}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["- ",s.notes[s.notes.length-1].author.profile.firstName," on ",new Date(s.notes[s.notes.length-1].createdAt).toLocaleDateString()]})]})]},s._id))})]}),U&&e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>{se(s),ae(!0)},className:"w-full",children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),"View All Details",M?" & Schedule":""]})]})]},s._id)),Ve>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-6",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:()=>Re(e=>Math.max(1,e-1)),disabled:1===Pe,children:"Previous"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Ve},(e,s)=>s+1).map(s=>e.jsx(N,{variant:Pe===s?"default":"outline",size:"sm",onClick:()=>Re(s),children:s},s))}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>Re(e=>Math.min(Ve,e+1)),disabled:Pe===Ve,children:"Next"})]})]})]}),e.jsx(f,{open:te,onOpenChange:ae,children:e.jsxs(S,{className:"max-w-3xl",children:[e.jsxs(y,{children:[e.jsx(w,{children:"Vendor Addon Services"}),e.jsx(k,{children:"Detailed information about vendor's purchased addon services"})]}),ee&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Vendor Information"}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("p",{className:"font-medium",children:[ee.user.profile.firstName," ",ee.user.profile.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:ee.user.email}),e.jsxs("p",{className:"text-sm mt-2",children:[e.jsx("strong",{children:"Total Addons:"})," ",ee.totalAddons]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Active Addon Services"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:ee.activeAddons.map(s=>{const t=ee.schedules?.find(e=>e.addon._id===s._id&&["scheduled","in_progress"].includes(e.status)),a=!!t,d=ee.subscriptions.find(e=>e.addons.some(e=>e._id===s._id)),i=d&&"active"===d.status&&new Date(d.endDate)>new Date;return e.jsxs(r,{className:"hover:shadow-md transition-shadow",children:[e.jsx(l,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(n,{className:"text-sm",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(j,{className:V(s.category),children:s.category}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.billingType.replace("_"," ")}),a&&e.jsx(j,{className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:"Scheduled"}),!i&&e.jsx(j,{className:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:"Expired"})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"font-bold text-primary",children:R(s.price,s.currency)})})]})}),e.jsxs(c,{className:"pt-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:s.description}),M&&i&&e.jsx(e.Fragment,{children:a?e.jsxs(N,{size:"sm",className:"w-full bg-amber-500 hover:bg-amber-600 text-white",onClick:()=>{ae(!1),ze(s)},children:[e.jsx(P,{className:"h-3 w-3 mr-2"}),"Re-schedule Service"]}):e.jsxs(N,{size:"sm",className:"w-full",onClick:()=>{ae(!1),ze(s)},children:[e.jsx(P,{className:"h-3 w-3 mr-2"}),"Schedule This Service"]})}),!i&&e.jsx("div",{className:"text-xs text-red-600 dark:text-red-400 text-center py-2",children:"Subscription expired - Cannot schedule"})]})]},s._id)})})]}),ee.schedules&&ee.schedules.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-4",children:["Service Schedules (",ee.schedules.length,")"]}),e.jsx("div",{className:"space-y-3",children:ee.schedules.map(s=>e.jsx(r,{className:"hover:shadow-md transition-shadow",children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.addon.name}),e.jsx(j,{className:Me(s.status),children:s.status.replace("_"," ")}),e.jsx(j,{className:Be(s.priority),variant:"outline",children:s.priority})]}),s.scheduledDate&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["ðŸ“… ",new Date(s.scheduledDate).toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Created: ",new Date(s.createdAt).toLocaleDateString()]}),s.notes&&s.notes.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t",children:[e.jsx("p",{className:"text-xs font-medium",children:"Latest Note:"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.notes[s.notes.length-1].message.substring(0,100),s.notes[s.notes.length-1].message.length>100?"...":""]})]})]}),B&&e.jsx(N,{size:"sm",variant:"outline",onClick:()=>{ae(!1),Ue(s)},children:"Manage"}),!B&&H&&e.jsx(N,{size:"sm",variant:"outline",onClick:()=>{ae(!1),Ue(s)},children:"Update Status"}),!B&&!H&&Y&&e.jsx(N,{size:"sm",variant:"outline",onClick:()=>{ae(!1),Ue(s)},children:"Add Notes"})]})})},s._id))})]}),ee.subscriptions.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Subscription History"}),e.jsx("div",{className:"space-y-2",children:ee.subscriptions.map(s=>e.jsx("div",{className:"bg-muted p-3 rounded-lg text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium",children:["Status: ",e.jsx(j,{variant:"active"===s.status?"default":"secondary",children:s.status})]}),e.jsxs("span",{className:"text-muted-foreground",children:[new Date(s.startDate).toLocaleDateString()," - ",new Date(s.endDate).toLocaleDateString()]})]})},s._id))})]})]})]})}),e.jsx(f,{open:de,onOpenChange:re,children:e.jsxs(S,{className:"max-w-2xl",children:[e.jsxs(y,{children:[e.jsx(w,{children:"Schedule Addon Service"}),e.jsx(k,{children:"Send a scheduling email to the vendor for their purchased addon service"})]}),ee&&ie&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("p",{className:"font-medium",children:["Vendor: ",ee.user.profile.firstName," ",ee.user.profile.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:ee.user.email}),e.jsxs("p",{className:"text-sm mt-1",children:[e.jsx("strong",{children:"Service:"})," ",ie.name]})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"subject",children:"Email Subject"}),e.jsx(x,{id:"subject",value:oe,onChange:e=>me(e.target.value),placeholder:"Enter email subject"})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"priority",children:"Priority"}),e.jsxs("select",{id:"priority",value:Ee,onChange:e=>Le(e.target.value),className:"w-full p-2 border rounded-md",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"scheduledDate",children:"Scheduled Service Date & Time *"}),e.jsx(x,{id:"scheduledDate",type:"datetime-local",value:he,onChange:e=>pe(e.target.value),min:(new Date).toISOString().slice(0,16),className:"w-full",required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Select when this service will be performed"})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"message",children:"Email Message"}),e.jsx(A,{id:"message",value:xe,onChange:e=>ue(e.target.value),placeholder:"Enter email message",rows:8})]})]}),e.jsxs(C,{children:[e.jsx(N,{variant:"outline",onClick:()=>re(!1),children:"Cancel"}),e.jsx(N,{onClick:async()=>{if(!ee||!ie)return;if(!he)return void T({title:"Error",description:"Please select a scheduled date for the service",variant:"destructive"});const e=ee.subscriptions.find(e=>e.addons.some(e=>e._id===ie._id));if(e)try{je({...ge,email:!0});const s=await E("/subadmin/addon-services/schedule",{method:"POST",body:JSON.stringify({vendorId:ee.user._id,addonId:ie._id,subscriptionId:e._id,subject:oe,message:xe,vendorEmail:ee.user.email,priority:Ee,scheduledDate:he})});await L(s);T({title:"Success",description:"Service scheduled successfully and email sent to vendor"}),re(!1),ce(null),pe(""),Te()}catch(s){T({title:"Error",description:s.message||"Failed to schedule service",variant:"destructive"})}finally{je({...ge,email:!1})}else T({title:"Error",description:"No subscription found for this addon",variant:"destructive"})},disabled:ge.email||!oe||!xe||!he,children:ge.email?"Scheduling...":"Schedule & Send Email"})]})]})}),e.jsx(f,{open:le,onOpenChange:ne,children:e.jsxs(S,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(y,{children:[e.jsx(w,{children:"Manage Service Schedule"}),e.jsx(k,{children:"Update status, add notes, and track service progress"})]}),ve&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-lg",children:ve.addon.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:Me(ve.status),children:ve.status.replace("_"," ")}),e.jsx(j,{className:Be(ve.priority),children:ve.priority})]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Scheduled by: ",ve.scheduledBy.profile.firstName," ",ve.scheduledBy.profile.lastName," (",ve.scheduledBy.email,")"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Created: ",new Date(ve.createdAt).toLocaleString()]}),ve.scheduledDate&&e.jsxs("p",{className:"text-sm font-semibold text-green-600 dark:text-green-400",children:["ðŸ—“ï¸ Service Date: ",new Date(ve.scheduledDate).toLocaleString()]}),ve.inProgressAt&&e.jsxs("p",{className:"text-sm font-semibold text-blue-600 dark:text-blue-400",children:["ðŸ”„ Started: ",new Date(ve.inProgressAt).toLocaleString()]}),ve.completedAt&&e.jsxs("p",{className:"text-sm font-semibold text-green-700 dark:text-green-300",children:["âœ“ Completed: ",new Date(ve.completedAt).toLocaleString()]}),ve.cancelledAt&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-sm font-semibold text-red-600 dark:text-red-400",children:["âœ— Cancelled: ",new Date(ve.cancelledAt).toLocaleString()]}),ve.cancellationReason&&e.jsxs("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1 p-2 bg-red-50 dark:bg-red-950 rounded",children:["Reason: ",ve.cancellationReason]})]}),e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-2 p-2 bg-amber-50 dark:bg-amber-950 rounded",children:"âš ï¸ Status updates will automatically send email notifications to the vendor"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Original Email"}),e.jsxs("div",{className:"bg-muted/50 p-3 rounded-md space-y-2 border",children:[e.jsx("p",{className:"font-medium text-sm",children:ve.emailSubject}),e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:ve.emailMessage})]})]}),B&&e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold",children:"Update Status"}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",value:be,onChange:e=>fe(e.target.value),className:"w-full p-2 border rounded-md",disabled:"completed"===ve?.status||"cancelled"===ve?.status,children:[e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}),("completed"===ve?.status||"cancelled"===ve?.status)&&e.jsxs("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-1",children:["âš ï¸ Cannot change status from ",ve.status]}),ve?.scheduledDate&&("in_progress"===be||"completed"===be)&&(new Date(ve.scheduledDate)>new Date?e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1 p-2 bg-red-50 dark:bg-red-950 rounded",children:['âš ï¸ Cannot mark as "',be.replace("_"," "),'" before scheduled date (',new Date(ve.scheduledDate).toLocaleString(),")"]}):e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:"âœ“ Service date has passed, can proceed"}))]}),"cancelled"===be&&e.jsxs("div",{children:[e.jsx(D,{htmlFor:"cancellationReason",children:"Cancellation Reason *"}),e.jsx(A,{id:"cancellationReason",value:De,onChange:e=>Ae(e.target.value),placeholder:"Please provide the reason for cancellation...",rows:3,required:!0,className:"border-red-300 focus:border-red-500"}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:"* Cancellation reason is required. Email will be sent to vendor."})]}),"in_progress"===be&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950 p-3 rounded-md border border-blue-200 dark:border-blue-800",children:[e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:'ðŸ”„ "In Progress" timestamp will be automatically recorded and vendor will be notified via email'}),ve?.inProgressAt&&e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:["Started on: ",new Date(ve.inProgressAt).toLocaleString()]})]}),"completed"===be&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-950 p-3 rounded-md border border-green-200 dark:border-green-800",children:[e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"âœ“ Completion date will be automatically set and vendor will receive completion email"}),ve?.completedAt&&e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:["Completed on: ",new Date(ve.completedAt).toLocaleString()]})]}),"completed"!==be&&"cancelled"!==be&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(D,{htmlFor:"scheduledDate",children:"in_progress"===be?"In Progress Since":"Scheduled Date & Time"}),e.jsx(x,{id:"scheduledDate",type:"datetime-local",value:Se,onChange:e=>ye(e.target.value),className:"w-full"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:ve?.scheduledDate?`Current: ${new Date(ve.scheduledDate).toLocaleString()}`:"Not set"}),Se&&Se!==new Date(ve?.scheduledDate||"").toISOString().slice(0,16)&&e.jsx("p",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1 p-2 bg-orange-50 dark:bg-orange-950 rounded",children:"ðŸ“§ Re-scheduling email will be sent to vendor with new date"})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"vendorResponse",children:"Vendor Response/Notes"}),e.jsx(A,{id:"vendorResponse",value:we,onChange:e=>ke(e.target.value),placeholder:"Enter vendor response or status update notes...",rows:3})]})]}),e.jsx(N,{onClick:async()=>{if(B){if(ve)if("cancelled"!==be||De.trim())try{je({...ge,status:!0});const e=await E(`/subadmin/addon-services/schedule/${ve._id}/status`,{method:"PATCH",body:JSON.stringify({status:be,scheduledDate:Se||void 0,vendorResponse:we||void 0,cancellationReason:"cancelled"===be?De:void 0})});await L(e),T({title:"Success",description:"cancelled"===be?"Service cancelled successfully":"completed"===be?"Service marked as completed":"Schedule status updated successfully"}),ne(!1),Ne(null),Ae(""),Te()}catch(e){T({title:"Error",description:e.message||"Failed to update schedule status",variant:"destructive"})}finally{je({...ge,status:!1})}else T({title:"Validation Error",description:"Please provide a cancellation reason",variant:"destructive"})}else T({title:"Access Denied",description:"You don't have permission to update schedule status.",variant:"destructive"})},disabled:ge.status||"completed"===ve?.status||"cancelled"===ve?.status||"cancelled"===be&&!De.trim(),className:"w-full",children:ge.status?"Updating...":"Update Status & Send Email"})]}),B&&e.jsxs("div",{className:"space-y-3 pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold",children:"Communication Notes"}),ve.notes&&ve.notes.length>0&&e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Previous notes:"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:ve.notes.map((s,t)=>e.jsxs("div",{className:"bg-muted/50 p-3 rounded-md border text-sm",children:[e.jsx("p",{className:"whitespace-pre-wrap",children:s.message}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["- ",s.author.profile.firstName," ",s.author.profile.lastName," on ",new Date(s.createdAt).toLocaleString()]})]},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"newNote",children:"Add New Note"}),e.jsx(A,{id:"newNote",value:Ce,onChange:e=>_e(e.target.value),placeholder:"Add a communication note or update...",rows:3}),e.jsx(N,{onClick:async()=>{if(B){if(ve&&Ce.trim())try{je({...ge,note:!0});const e=await E(`/subadmin/addon-services/schedule/${ve._id}/notes`,{method:"POST",body:JSON.stringify({message:Ce})}),s=await L(e);T({title:"Success",description:"Note added successfully"}),_e(""),s.data?.schedule&&Ne(s.data.schedule),Te()}catch(e){T({title:"Error",description:e.message||"Failed to add note",variant:"destructive"})}finally{je({...ge,note:!1})}}else T({title:"Access Denied",description:"You don't have permission to add notes.",variant:"destructive"})},disabled:ge.note||!Ce.trim(),variant:"outline",className:"w-full",children:ge.note?"Adding...":"Add Note"})]})]})]}),e.jsx(C,{children:e.jsx(N,{variant:"outline",onClick:()=>ne(!1),children:"Close"})})]})})]})};export{I as default};

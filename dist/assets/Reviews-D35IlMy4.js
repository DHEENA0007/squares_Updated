import{j as e}from"./ui-BNZSgpjP.js";import{D as s,u as t,t as a,a as l,b as r,c as i,Q as n,e as d,H as c,d as o,$ as x,I as m,q as h,r as u,s as p,v,w as j,B as g,f,ad as w,a4 as N,a5 as y,a6 as R,a7 as b,a8 as E,T as S,ae as A,Z as V}from"./index-BUFRx16p.js";import{d as k,r as C}from"./router-D8v2YSKU.js";import{r as D}from"./reviewsService-CKmE9oB6.js";import{T as F}from"./thumbs-up-DvRU9l0o.js";import{M as I}from"./message-circle-CQUxWDzo.js";import"./vendor-BxThA0WO.js";const P=s("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]),W=s("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]),M=()=>{const{user:s}=t(),M=k(),T=s?.rolePermissions||[],[_,O]=C.useState([]),[z,B]=C.useState({total:0,approved:0,pending:0,flagged:0,avgRating:0}),[L,Y]=C.useState(!0),[H,q]=C.useState(""),[Q,U]=C.useState("all"),[Z,$]=C.useState("all"),[G,J]=C.useState(1),[K,X]=C.useState(1),[ee,se]=C.useState(!1),[te,ae]=C.useState(null),[le,re]=C.useState(""),ie=e=>T.includes(e);C.useEffect(()=>{ie(V.REVIEWS_VIEW)||M("/rolebased")},[T]),C.useEffect(()=>{ne(),de()},[H,Q,Z,G]);const ne=async()=>{try{const e=await D.getAdminReviewStats();B(e)}catch(e){}},de=async()=>{Y(!0);try{const e={page:G,limit:10};H&&(e.search=H),"all"!==Q&&(e.status=Q),"all"!==Z&&(e.rating=parseInt(Z));const s=await D.getAdminReviews(e);O(s.reviews||[]),X(s.pagination?.pages||1)}catch(e){a({title:"Error",description:"Failed to fetch reviews",variant:"destructive"})}finally{Y(!1)}};return ie(V.REVIEWS_VIEW)?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Review Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage property reviews and ratings"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Total Reviews"}),e.jsx(n,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:z.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All published reviews"})]})]}),e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Average Rating"}),e.jsx(F,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:(z.avgRating||0).toFixed(1)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Out of 5 stars"})]})]}),e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Flagged"}),e.jsx(c,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:z.flagged}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Inappropriate reviews"})]})]})]}),e.jsxs(l,{children:[e.jsxs(r,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(i,{children:"All Reviews"}),e.jsx(o,{children:"Moderate and manage property reviews"})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mt-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(x,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(m,{placeholder:"Search reviews...",value:H,onChange:e=>q(e.target.value),className:"pl-8"})]})}),e.jsxs(h,{value:Q,onValueChange:U,children:[e.jsx(u,{className:"w-[180px]",children:e.jsx(p,{placeholder:"Status"})}),e.jsxs(v,{children:[e.jsx(j,{value:"all",children:"All Reviews"}),e.jsx(j,{value:"flagged",children:"Flagged Only"})]})]}),e.jsxs(h,{value:Z,onValueChange:$,children:[e.jsx(u,{className:"w-[180px]",children:e.jsx(p,{placeholder:"Rating"})}),e.jsxs(v,{children:[e.jsx(j,{value:"all",children:"All Ratings"}),e.jsx(j,{value:"5",children:"5 Stars"}),e.jsx(j,{value:"4",children:"4 Stars"}),e.jsx(j,{value:"3",children:"3 Stars"}),e.jsx(j,{value:"2",children:"2 Stars"}),e.jsx(j,{value:"1",children:"1 Star"})]})]})]})]}),e.jsxs(d,{children:[L?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading reviews..."})}):0===_.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(n,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"No Reviews Found"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"No reviews match your current filters"})]}):e.jsx("div",{className:"space-y-4",children:_.map(s=>e.jsx("div",{className:"p-4 border rounded-lg space-y-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"flex",children:[...Array(5)].map((t,a)=>e.jsx(n,{className:"h-4 w-4 "+(a<s.rating?"fill-yellow-400 text-yellow-400":"text-gray-300")},a))}),e.jsx(g,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Published"}),s.isFlagged&&e.jsx(g,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200",children:"Flagged"})]}),e.jsx("h4",{className:"font-semibold",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.comment}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["By: ",s.user?.name||"Unknown"]}),s.property&&e.jsxs("span",{children:["Property: ",s.property.name]}),s.vendor&&e.jsxs("span",{children:["Vendor: ",s.vendor.name]}),e.jsx("span",{children:new Date(s.createdAt).toLocaleDateString()})]}),s.vendorResponse&&e.jsxs("div",{className:"mt-4 pl-4 border-l-2 border-blue-200 bg-blue-50 p-3 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(I,{className:"h-3 w-3 text-blue-600"}),e.jsxs("span",{className:"text-xs font-semibold text-blue-700",children:[s.vendorResponse.respondedBy||"Admin",s.vendorResponse.respondedByRole&&e.jsxs("span",{className:"text-blue-600",children:[" (",s.vendorResponse.respondedByRole,")"]})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(s.vendorResponse.respondedAt).toLocaleDateString()})]}),e.jsx("p",{className:"text-sm text-gray-700",children:s.vendorResponse.message})]})]}),e.jsxs("div",{className:"flex gap-2",children:[ie(V.REVIEWS_RESPOND)&&e.jsx(f,{size:"sm",variant:"outline",onClick:()=>(async e=>{ie(V.REVIEWS_RESPOND)?(ae(e),se(!0)):a({title:"Access Denied",description:"You don't have permission to reply to reviews",variant:"destructive"})})(s.id),className:"text-blue-600 hover:text-blue-700",title:"Reply to review",children:e.jsx(W,{className:"h-4 w-4"})}),ie(V.REVIEWS_REPORT)&&!s.isFlagged&&e.jsx(f,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(ie(V.REVIEWS_REPORT))try{await D.flagReview(e),a({title:"Success",description:"Review flagged successfully"}),de(),ne()}catch(s){a({title:"Error",description:"Failed to flag review",variant:"destructive"})}else a({title:"Access Denied",description:"You don't have permission to flag reviews",variant:"destructive"})})(s.id),className:"text-orange-600 hover:text-orange-700",title:"Flag as inappropriate",children:e.jsx(P,{className:"h-4 w-4"})}),ie(V.REVIEWS_DELETE)&&e.jsx(f,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(ie(V.REVIEWS_DELETE)){if(confirm("Are you sure you want to delete this review?"))try{await D.deleteReview(e),a({title:"Success",description:"Review deleted successfully"}),de(),ne()}catch(s){a({title:"Error",description:"Failed to delete review",variant:"destructive"})}}else a({title:"Access Denied",description:"You don't have permission to delete reviews",variant:"destructive"})})(s.id),className:"text-red-600 hover:text-red-700",title:"Delete review",children:e.jsx(w,{className:"h-4 w-4"})})]})]})},s.id))}),!L&&_.length>0&&K>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>J(e=>Math.max(1,e-1)),disabled:1===G,children:"Previous"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",G," of ",K]}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>J(e=>Math.min(K,e+1)),disabled:G===K,children:"Next"})]})]})]}),e.jsx(N,{open:ee,onOpenChange:se,children:e.jsxs(y,{children:[e.jsxs(R,{children:[e.jsx(b,{children:"Reply to Review"}),e.jsx(E,{children:"Write a response to this customer review"})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(S,{placeholder:"Enter your reply...",value:le,onChange:e=>re(e.target.value),rows:5})}),e.jsxs(A,{children:[e.jsx(f,{variant:"outline",onClick:()=>{se(!1),re(""),ae(null)},children:"Cancel"}),e.jsx(f,{onClick:async()=>{if(le.trim()){if(te)try{await D.replyToReview(te,le),a({title:"Success",description:"Reply posted successfully"}),se(!1),re(""),ae(null),de()}catch(e){a({title:"Error",description:"Failed to post reply",variant:"destructive"})}}else a({title:"Error",description:"Please enter a reply message",variant:"destructive"})},children:"Post Reply"})]})]})})]}):null};export{M as default};

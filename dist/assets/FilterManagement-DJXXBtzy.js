import{j as e}from"./ui-BNZSgpjP.js";import{r as s,d as a}from"./router-D8v2YSKU.js";import{u as l,a2 as r,a3 as i,f as t,a9 as n,af as c,ag as d,ah as o,ai as u,a4 as p,a5 as h,a6 as x,a7 as m,a8 as j,L as y,q as v,r as f,s as g,v as F,w as N,B as _,ad as T,I as C,ae as b,Z as w,ac as S,aj as E,a as V,e as A}from"./index-XQ_rcKIR.js";import{T as D,a as k,b as L,c as R,d as O,e as I}from"./table-BaUPikoR.js";import{P}from"./pencil-COMNF2Ix.js";import{A as q,a as M}from"./alert-Bbcf9Ir0.js";import"./vendor-BxThA0WO.js";const z=()=>{const{user:a}=l(),{toast:E}=r(),V=a?.rolePermissions||[],A="admin"===a?.role||"superadmin"===a?.role,q=e=>V.includes(e),M=A||q(w.FILTER_CREATE_NTP),z=A||q(w.FILTER_CREATE_FTO),U=A||q(w.FILTER_EDIT),B=A||q(w.FILTER_DELETE),K=A||q(w.FILTER_STATUS);A||q(w.FILTER_ORDER);const[Y,$]=s.useState([]),[Z,G]=s.useState([]),[H,J]=s.useState(!0),[Q,W]=s.useState(!1),[X,ee]=s.useState(!1),[se,ae]=s.useState(null),[le,re]=s.useState(""),[ie,te]=s.useState(""),[ne,ce]=s.useState(""),[de,oe]=s.useState({filter_type:"",name:"",value:"",min_value:void 0,max_value:void 0,display_label:"",display_order:0}),[ue,pe]=s.useState([]),[he,xe]=s.useState(!1),[me,je]=s.useState({targetFilterType:"",sourceFilterType:"",sourceFilterValues:[]}),[ye,ve]=s.useState([]);s.useEffect(()=>{ge(),fe()},[]);const fe=async()=>{try{const e=await i.getFilterDependencies();pe(e)}catch(e){}};s.useEffect(()=>{(async()=>{if(me.sourceFilterType)if("property_type"===me.sourceFilterType){const e=await i.getAllPropertyTypes(!1);ve(e.map(e=>({label:e.name,value:e.value})))}else{const e=Fe(me.sourceFilterType);ve(e.map(e=>({label:e.displayLabel||e.name,value:e.value})))}else ve([])})()},[me.sourceFilterType,Y]);const ge=async()=>{try{J(!0);const e=await i.getAllFilterConfigurations(!0);$(e);const s=Array.from(new Set(e.map(e=>e.filterType)));G(s.sort()),s.length>0&&!le&&re(s[0])}catch(e){E({title:"Error",description:"Failed to fetch filter configurations",variant:"destructive"})}finally{J(!1)}},Fe=e=>Y.filter(s=>s.filterType===e).sort((e,s)=>e.displayOrder-s.displayOrder),Ne=()=>{if(!ie.trim())return;const e=ie.toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"");Z.includes(e)?E({title:"Error",description:"Filter type already exists",variant:"destructive"}):(G([...Z,e].sort()),re(e),ee(!1),te(""),E({title:"Success",description:`Filter type "${e}" created. You can now add options to it.`}))},_e=e=>{e?(ae(e),oe({filter_type:e.filterType,name:e.name,value:e.value,min_value:e.minValue,max_value:e.maxValue,display_label:e.displayLabel,display_order:e.displayOrder})):(ae(null),oe({filter_type:le,name:"",value:"",min_value:void 0,max_value:void 0,display_label:"",display_order:0})),W(!0)},Te=()=>{W(!1),ae(null),oe({filter_type:"",name:"",value:"",min_value:void 0,max_value:void 0,display_label:"",display_order:0})},Ce=s=>{const a=Fe(s);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground",children:[a.length," options configured"]})}),z&&e.jsxs(t,{size:"sm",onClick:()=>_e(),children:[e.jsx(n,{className:"h-4 w-4 mr-2"}),"Add Option"]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(D,{children:[e.jsx(k,{children:e.jsxs(L,{children:[e.jsx(R,{children:"Display Order"}),e.jsx(R,{children:"Name"}),e.jsx(R,{children:"Value"}),e.jsx(R,{children:"Display Label"}),e.jsx(R,{children:"Status"}),e.jsx(R,{className:"text-right",children:"Actions"})]})}),e.jsx(O,{children:0===a.length?e.jsx(L,{children:e.jsx(I,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No options found for this filter type."})}):a.map(s=>e.jsxs(L,{children:[e.jsx(I,{children:s.displayOrder}),e.jsx(I,{className:"font-medium",children:s.name}),e.jsx(I,{children:e.jsx(_,{variant:"outline",children:s.value})}),e.jsx(I,{children:s.displayLabel||"-"}),e.jsx(I,{children:e.jsx(S,{checked:s.isActive,onCheckedChange:()=>K&&(async e=>{try{await i.updateFilterConfiguration(e.id,{isActive:!e.isActive}),E({title:"Success",description:`Filter ${e.isActive?"deactivated":"activated"} successfully`}),ge()}catch(s){E({title:"Error",description:"Failed to update filter status",variant:"destructive"})}})(s),disabled:!K})}),e.jsx(I,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[U&&e.jsx(t,{variant:"ghost",size:"icon",onClick:()=>_e(s),children:e.jsx(P,{className:"h-4 w-4"})}),B&&e.jsx(t,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this filter option?"))try{await i.deleteFilterConfiguration(e),E({title:"Success",description:"Filter deleted successfully"}),ge()}catch(s){E({title:"Error",description:"Failed to delete filter",variant:"destructive"})}})(s.id),children:e.jsx(T,{className:"h-4 w-4"})})]})})]},s.id))})]})})]})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Filter Configurations"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage filter options for property search and filtering"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{variant:"outline",onClick:()=>xe(!0),children:"Manage Dependencies"}),M&&e.jsxs(t,{onClick:()=>ee(!0),children:[e.jsx(n,{className:"h-4 w-4 mr-2"}),"New Filter Type"]})]})]}),0===Z.length?e.jsxs("div",{className:"border rounded-lg p-8 text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"No filter types found. Create your first filter type to get started."}),M&&e.jsxs(t,{onClick:()=>ee(!0),children:[e.jsx(n,{className:"h-4 w-4 mr-2"}),"Create First Filter Type"]})]}):e.jsxs(c,{value:le,onValueChange:re,children:[e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto",children:e.jsx(d,{className:"inline-flex",children:Z.map(s=>e.jsx(o,{value:s,children:s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())},s))})}),Z.map(s=>e.jsx(u,{value:s,children:Ce(s)},s))]}),e.jsx(p,{open:he,onOpenChange:xe,children:e.jsxs(h,{className:"max-w-3xl",children:[e.jsxs(x,{children:[e.jsx(m,{children:"Manage Filter Dependencies"}),e.jsx(j,{children:"Configure which filters should appear based on other filter selections."})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-end border p-4 rounded-lg bg-muted/20",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Target Filter (Show this...)"}),e.jsxs(v,{value:me.targetFilterType,onValueChange:e=>je({...me,targetFilterType:e}),children:[e.jsx(f,{children:e.jsx(g,{placeholder:"Select filter"})}),e.jsx(F,{children:Z.map(s=>e.jsx(N,{value:s,children:s.replace(/_/g," ")},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Source Filter (...when this is selected)"}),e.jsxs(v,{value:me.sourceFilterType,onValueChange:e=>je({...me,sourceFilterType:e,sourceFilterValues:[]}),children:[e.jsx(f,{children:e.jsx(g,{placeholder:"Select parent filter"})}),e.jsxs(F,{children:[e.jsx(N,{value:"property_type",children:"Property Type"}),Z.filter(e=>e!==me.targetFilterType).map(s=>e.jsx(N,{value:s,children:s.replace(/_/g," ")},s))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Trigger Values (Matches any)"}),e.jsxs(v,{disabled:!me.sourceFilterType,onValueChange:e=>{me.sourceFilterValues.includes(e)||je({...me,sourceFilterValues:[...me.sourceFilterValues,e]})},children:[e.jsx(f,{children:e.jsx(g,{placeholder:"Add value..."})}),e.jsx(F,{children:ye.map(s=>e.jsx(N,{value:s.value,children:s.label},s.value))})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:me.sourceFilterValues.map(s=>e.jsxs(_,{variant:"secondary",className:"cursor-pointer",onClick:()=>{je({...me,sourceFilterValues:me.sourceFilterValues.filter(e=>e!==s)})},children:[ye.find(e=>e.value===s)?.label||s," ×"]},s))})]})]}),e.jsx(t,{onClick:async()=>{if(!me.targetFilterType||!me.sourceFilterType||0===me.sourceFilterValues.length)return void E({title:"Error",description:"Please fill all fields",variant:"destructive"});const e=[...ue,me];try{await i.saveFilterDependencies(e),pe(e),xe(!1),je({targetFilterType:"",sourceFilterType:"",sourceFilterValues:[]}),E({title:"Success",description:"Dependency saved successfully"})}catch(s){E({title:"Error",description:"Failed to save dependency",variant:"destructive"})}},className:"w-full",children:"Add Rule"}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(D,{children:[e.jsx(k,{children:e.jsxs(L,{children:[e.jsx(R,{children:"Target Filter"}),e.jsx(R,{children:"Depends On"}),e.jsx(R,{children:"Values"}),e.jsx(R,{className:"text-right",children:"Action"})]})}),e.jsx(O,{children:0===ue.length?e.jsx(L,{children:e.jsx(I,{colSpan:4,className:"text-center text-muted-foreground",children:"No dependencies configured"})}):ue.map((s,a)=>e.jsxs(L,{children:[e.jsx(I,{className:"font-medium",children:s.targetFilterType}),e.jsx(I,{children:s.sourceFilterType}),e.jsx(I,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.sourceFilterValues.map(s=>e.jsx(_,{variant:"outline",className:"text-xs",children:s},s))})}),e.jsx(I,{className:"text-right",children:e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>(async e=>{const s=ue.filter((s,a)=>a!==e);try{await i.saveFilterDependencies(s),pe(s),E({title:"Success",description:"Dependency deleted successfully"})}catch(a){E({title:"Error",description:"Failed to delete dependency",variant:"destructive"})}})(a),children:e.jsx(T,{className:"h-4 w-4 text-destructive"})})})]},a))})]})})]})]})}),e.jsx(p,{open:Q,onOpenChange:W,children:e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(m,{children:se?"Edit Filter":"Add Filter"}),e.jsx(j,{children:se?"Update the filter details below":"Create a new filter option"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"filter_type",children:"Filter Type"}),e.jsxs(v,{value:de.filter_type,onValueChange:e=>oe({...de,filter_type:e}),disabled:!!se,children:[e.jsx(f,{children:e.jsx(g,{})}),e.jsx(F,{children:Z.map(s=>e.jsx(N,{value:s,children:s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"name",children:"Name *"}),e.jsx(C,{id:"name",value:de.name,onChange:e=>oe({...de,name:e.target.value}),placeholder:"e.g., For Sale",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"value",children:"Value (Unique ID) *"}),e.jsx(C,{id:"value",value:de.value,onChange:e=>oe({...de,value:e.target.value}),placeholder:"e.g., sale",disabled:!!se,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"display_label",children:"Display Label (Optional)"}),e.jsx(C,{id:"display_label",value:de.display_label,onChange:e=>oe({...de,display_label:e.target.value}),placeholder:"Defaults to Name if not provided"})]}),["budget","area"].includes(de.filter_type)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(y,{htmlFor:"min_value",children:["Min Value ","budget"===de.filter_type?"(₹)":"(sq ft)"]}),e.jsx(C,{id:"min_value",type:"number",value:de.min_value||"",onChange:e=>oe({...de,min_value:e.target.value?parseFloat(e.target.value):void 0}),placeholder:"budget"===de.filter_type?"e.g., 2000000":"e.g., 1000"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(y,{htmlFor:"max_value",children:["Max Value ","budget"===de.filter_type?"(₹)":"(sq ft)"]}),e.jsx(C,{id:"max_value",type:"number",value:de.max_value||"",onChange:e=>oe({...de,max_value:e.target.value?parseFloat(e.target.value):void 0}),placeholder:"budget"===de.filter_type?"e.g., 4000000":"e.g., 2000"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"display_order",children:"Display Order"}),e.jsx(C,{id:"display_order",type:"number",value:de.display_order,onChange:e=>oe({...de,display_order:parseInt(e.target.value)||0})})]})]}),e.jsxs(b,{children:[e.jsx(t,{variant:"outline",onClick:Te,children:"Cancel"}),e.jsx(t,{onClick:async()=>{try{if(!de.filter_type||!de.name||!de.value)return void E({title:"Error",description:"Please fill in all required fields",variant:"destructive"});se?(await i.updateFilterConfiguration(se.id,de),E({title:"Success",description:"Filter updated successfully"})):(await i.createFilterConfiguration(de),E({title:"Success",description:"Filter created successfully"})),ge(),Te()}catch(e){E({title:"Error",description:"Failed to save filter configuration",variant:"destructive"})}},children:se?"Update":"Create"})]})]})}),e.jsx(p,{open:X,onOpenChange:ee,children:e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(m,{children:"Create New Filter Type"}),e.jsx(j,{children:"Create a new filter category to organize your property search filters"})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"newFilterTypeName",children:"Filter Type Name *"}),e.jsx(C,{id:"newFilterTypeName",value:ie,onChange:e=>te(e.target.value),placeholder:"e.g., Property Status, Location Type, Price Range",onKeyDown:e=>{"Enter"===e.key&&Ne()}}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'This will be converted to lowercase with underscores (e.g., "property_status")'})]})}),e.jsxs(b,{children:[e.jsx(t,{variant:"outline",onClick:()=>{ee(!1),te("")},children:"Cancel"}),e.jsx(t,{onClick:Ne,children:"Create Filter Type"})]})]})})]})},U=()=>{const{user:i}=l(),t=a(),{toast:n}=r(),c=i?.rolePermissions||[],d="admin"===i?.role||"superadmin"===i?.role||(o=w.FILTER_READ,c.includes(o));var o;return s.useEffect(()=>{d||(n({title:"Access Denied",description:"You don't have permission to view filter management.",variant:"destructive"}),t("/rolebased"))},[d,t,n]),d?e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(E,{className:"h-8 w-8"}),"Filter Management"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Configure search filters for the property search page"})]})}),e.jsx(q,{children:e.jsxs(M,{children:[e.jsx("strong",{children:"Note:"})," These filters appear on the customer property search page. Create dynamic filter types like Bedrooms, Budget, Listing Type, Furnishing, etc."]})}),e.jsx(V,{children:e.jsx(A,{className:"pt-6",children:e.jsx(z,{})})})]}):null};export{U as default};

import{j as e}from"./ui-s1SEoZIF.js";import{r as s,d as a}from"./router-D8v2YSKU.js";import{a2 as t,a as r,b as i,c as l,e as c,d as n,E as d,x as o,h as x,I as m,q as h,r as j,s as u,v as p,w as v,f as g,aa as N,ab as f,y as w,M as y,B as b,k as A,u as S,U as C,R as V,af as k,ag as D,ah as P,ai as T,V as I,Z as E}from"./index-DvBXyKtT.js";import{a as L}from"./analyticsService-DLxkuhVG.js";import{T as R,a as U,b as F,c as G,d as W,e as M}from"./table-Bkp50phG.js";import{M as _,C as q}from"./mouse-pointer-BgheIzEz.js";import{C as B}from"./calendar-JKH5plE4.js";import{f as O}from"./format-PfF_OkS9.js";import{T as Y}from"./trending-up-D3HFnEB_.js";import{D as $}from"./dollar-sign-BlNquT1W.js";import{R as z,B as H,X as K,Y as X,E as Z,F as J,I as Q}from"./generateCategoricalChart-BcNksiWQ.js";import{L as ee}from"./LineChart-FSLniYU_.js";import{G as se}from"./globe-D7-SMjbJ.js";import"./vendor-BxThA0WO.js";import"./reviewsService-C63_b63b.js";const ae=({propertyId:a,dateRange:S})=>{const{toast:C}=t(),[V,k]=s.useState(!0),[D,P]=s.useState(null),[T,I]=s.useState(new Set),[E,q]=s.useState(""),[Y,$]=s.useState("all");s.useEffect(()=>{a&&z()},[a,S]);const z=async()=>{if(a){k(!0);try{const e=await L.getPropertyViewDetails(a,S);P(e.data)}catch(e){C({title:"Error",description:"Failed to fetch property view details",variant:"destructive"})}finally{k(!1)}}},H=D?.views?.filter(e=>{const s=""===E||e.viewer?.email?.toLowerCase().includes(E.toLowerCase())||e.viewer?.profile?.firstName?.toLowerCase().includes(E.toLowerCase())||e.viewer?.profile?.lastName?.toLowerCase().includes(E.toLowerCase()),a="all"===Y||"registered"===Y&&e.viewer||"guest"===Y&&!e.viewer||"interacted"===Y&&(e.interactions?.clickedPhone||e.interactions?.clickedEmail||e.interactions?.clickedWhatsApp);return s&&a})||[];return V?e.jsxs(r,{children:[e.jsx(i,{children:e.jsx(l,{children:"Loading..."})}),e.jsx(c,{children:e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},s))})})]}):a&&D?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(r,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(d,{className:"h-8 w-8 mx-auto mb-2 text-blue-600"}),e.jsx("p",{className:"text-2xl font-bold",children:D.aggregateData?.totalViews?.[0]?.count||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Views"})]})})}),e.jsx(r,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(o,{className:"h-8 w-8 mx-auto mb-2 text-green-600"}),e.jsx("p",{className:"text-2xl font-bold",children:D.aggregateData?.uniqueViewers?.[0]?.count||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Unique Visitors"})]})})}),e.jsx(r,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(x,{className:"h-8 w-8 mx-auto mb-2 text-purple-600"}),e.jsxs("p",{className:"text-2xl font-bold",children:[Math.round(D.aggregateData?.avgDuration?.[0]?.avg||0),"s"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg. Duration"})]})})}),e.jsx(r,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{className:"h-8 w-8 mx-auto mb-2 text-orange-600"}),e.jsx("p",{className:"text-2xl font-bold",children:(D.aggregateData?.interactions?.[0]?.phoneClicks||0)+(D.aggregateData?.interactions?.[0]?.emailClicks||0)+(D.aggregateData?.interactions?.[0]?.whatsappClicks||0)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Interactions"})]})})})]}),e.jsxs(r,{children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Visitor Details"}),e.jsx(n,{children:"Complete list of customers who viewed this property"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{placeholder:"Search visitors...",value:E,onChange:e=>q(e.target.value),className:"w-64"}),e.jsxs(h,{value:Y,onValueChange:$,children:[e.jsx(j,{className:"w-40",children:e.jsx(u,{})}),e.jsxs(p,{children:[e.jsx(v,{value:"all",children:"All Visitors"}),e.jsx(v,{value:"registered",children:"Registered"}),e.jsx(v,{value:"guest",children:"Guests"}),e.jsx(v,{value:"interacted",children:"Interacted"})]})]})]})]})}),e.jsxs(c,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(R,{children:[e.jsx(U,{children:e.jsxs(F,{children:[e.jsx(G,{className:"w-12"}),e.jsx(G,{children:"Visitor"}),e.jsx(G,{children:"Contact"}),e.jsx(G,{children:"View Time"}),e.jsx(G,{children:"Duration"}),e.jsx(G,{children:"Interactions"}),e.jsx(G,{children:"Status"})]})}),e.jsx(W,{children:0===H.length?e.jsx(F,{children:e.jsx(M,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No visitors found"})}):H.map(s=>e.jsxs(e.Fragment,{children:[e.jsxs(F,{className:"cursor-pointer hover:bg-muted/50",children:[e.jsx(M,{children:e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>(e=>{const s=new Set(T);s.has(e)?s.delete(e):s.add(e),I(s)})(s._id),children:T.has(s._id)?e.jsx(N,{className:"h-4 w-4"}):e.jsx(f,{className:"h-4 w-4"})})}),e.jsx(M,{children:e.jsx("div",{className:"flex items-center gap-2",children:s.viewer?e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"h-4 w-4 text-green-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.viewer.profile?.firstName," ",s.viewer.profile?.lastName]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.viewer.email})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:"Guest Visitor"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.ipAddress||"Unknown IP"})]})]})})}),e.jsx(M,{children:s.viewer?e.jsxs("div",{className:"space-y-1",children:[s.viewer.profile?.phone&&e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(w,{className:"h-3 w-3"}),s.viewer.profile.phone]}),s.viewer.email&&e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(y,{className:"h-3 w-3"}),s.viewer.email]})]}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"N/A"})}),e.jsx(M,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(B,{className:"h-3 w-3"}),O(new Date(s.viewedAt),"MMM dd, yyyy HH:mm")]})}),e.jsx(M,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(x,{className:"h-3 w-3"}),s.viewDuration>0?`${s.viewDuration}s`:"N/A"]})}),e.jsx(M,{children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.interactions?.clickedPhone&&e.jsxs(b,{variant:"outline",className:"text-xs",children:[e.jsx(w,{className:"h-3 w-3 mr-1"})," Phone"]}),s.interactions?.clickedEmail&&e.jsxs(b,{variant:"outline",className:"text-xs",children:[e.jsx(y,{className:"h-3 w-3 mr-1"})," Email"]}),s.interactions?.clickedWhatsApp&&e.jsx(b,{variant:"outline",className:"text-xs",children:"WhatsApp"}),s.interactions?.viewedGallery&&e.jsx(b,{variant:"outline",className:"text-xs",children:"Gallery"}),s.interactions?.sharedProperty&&e.jsx(b,{variant:"outline",className:"text-xs",children:"Shared"})]})}),e.jsx(M,{children:s.viewer?e.jsx(b,{variant:"default",className:"bg-green-600",children:"Registered"}):e.jsx(b,{variant:"secondary",children:"Guest"})})]},s._id),T.has(s._id)&&e.jsx(F,{children:e.jsx(M,{colSpan:7,className:"bg-muted/30",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.viewer&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"User Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Role:"})," ",s.viewer.role]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",s.viewer.status]}),s.viewer.profile?.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"h-3 w-3"}),e.jsx("span",{children:s.viewer.profile.location})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Session Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"IP Address:"})," ",s.ipAddress||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"User Agent:"})," ",s.userAgent?.substring(0,50)||"N/A","..."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Referrer:"})," ",s.referrer||"Direct"]})]})]})]}),Object.values(s.interactions||{}).some(e=>e)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Actions Taken"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.interactions?.clickedPhone&&e.jsx(b,{variant:"default",children:"Clicked Phone Number"}),s.interactions?.clickedEmail&&e.jsx(b,{variant:"default",children:"Clicked Email"}),s.interactions?.clickedWhatsApp&&e.jsx(b,{variant:"default",children:"Contacted via WhatsApp"}),s.interactions?.viewedGallery&&e.jsx(b,{variant:"default",children:"Viewed Image Gallery"}),s.interactions?.sharedProperty&&e.jsx(b,{variant:"default",children:"Shared Property"})]})]})]})})})]}))})]})}),H.length>0&&e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground text-center",children:["Showing ",H.length," of ",D.views?.length||0," visitors"]})]})]})]}):e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsx(l,{children:"Property View Details"}),e.jsx(n,{children:"Select a property to view detailed visitor information"})]}),e.jsx(c,{children:e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(d,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No property selected"})]})})]})},te=()=>{const{user:o}=S(),{toast:x}=t(),m=a(),[g,N]=s.useState("30"),[f,w]=s.useState(!0),[y,b]=s.useState(null),[A,R]=s.useState(null),[U,F]=s.useState(null),[G,W]=s.useState(null),[M,_]=s.useState(null),[B,O]=s.useState(""),te=e=>"superadmin"===o?.role||(o?.rolePermissions?.includes(e)||!1);s.useEffect(()=>{if(!te(E.ANALYTICS_VIEW))return x({title:"Access Denied",description:"You don't have permission to view analytics.",variant:"destructive"}),void m("/rolebased");re()},[g]);const re=async()=>{w(!0);try{const[e,s,a,t,r]=await Promise.all([L.getOverview(g),L.getPropertyViews(g),L.getUserConversion(g),L.getTrafficAnalytics(g),L.getEngagementAnalytics(g)]);b(e.data),R(s.data),F(a.data),W(t.data),_(r.data)}catch(e){x({title:"Error",description:"Failed to fetch analytics data",variant:"destructive"})}finally{w(!1)}};if(!te(E.ANALYTICS_VIEW))return null;if(f)return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-3xl font-bold",children:"Analytics Dashboard"})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(s=>e.jsxs(r,{className:"animate-pulse",children:[e.jsx(i,{className:"pb-2",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})}),e.jsx(c,{children:e.jsx("div",{className:"h-8 bg-gray-200 rounded w-16"})})]},s))})]});const ie=({title:s,value:a,icon:t,change:n,color:d})=>e.jsxs(r,{children:[e.jsx(i,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{className:"text-sm font-medium text-muted-foreground",children:s}),e.jsx(t,{className:`h-4 w-4 ${d}`})]})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a}),n&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.jsxs("span",{className:n>=0?"text-green-600":"text-red-600",children:[n>=0?"+":"",n,"%"]})," from previous period"]})]})]});return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Comprehensive insights and metrics"})]}),e.jsxs(h,{value:g,onValueChange:N,children:[e.jsx(j,{className:"w-[180px]",children:e.jsx(u,{placeholder:"Select range"})}),e.jsxs(p,{children:[e.jsx(v,{value:"7",children:"Last 7 days"}),e.jsx(v,{value:"30",children:"Last 30 days"}),e.jsx(v,{value:"90",children:"Last 90 days"}),e.jsx(v,{value:"365",children:"Last year"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(ie,{title:"Total Users",value:y?.overview?.totalUsers||0,icon:C,color:"text-blue-600"}),e.jsx(ie,{title:"Total Properties",value:y?.overview?.totalProperties||0,icon:d,color:"text-green-600"}),e.jsx(ie,{title:"Total Views",value:y?.overview?.totalViews||0,icon:V,color:"text-purple-600"}),e.jsx(ie,{title:"New Registrations",value:y?.overview?.totalRegistrations||0,icon:Y,color:"text-orange-600"}),e.jsx(ie,{title:"Revenue",value:`$${(y?.overview?.totalRevenue||0).toFixed(2)}`,icon:$,color:"text-emerald-600"})]}),e.jsxs(k,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(D,{className:"grid w-full grid-cols-5",children:[e.jsx(P,{value:"overview",children:"Overview"}),e.jsx(P,{value:"properties",children:"Properties"}),e.jsx(P,{value:"users",children:"Users"}),e.jsx(P,{value:"traffic",children:"Traffic"}),e.jsx(P,{value:"engagement",children:"Engagement"})]}),e.jsx(T,{value:"overview",className:"space-y-4",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(I,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"Analytics Dashboard - Full Implementation"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Comprehensive analytics for property views, user behavior, traffic sources, and engagement metrics"})]})}),e.jsx(T,{value:"properties",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs(r,{children:[e.jsx(i,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Property Views Over Time"]})}),e.jsx(c,{children:e.jsx(z,{width:"100%",height:300,children:e.jsxs(ee,{data:A?.viewsByDate||[],children:[e.jsx(H,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"_id"}),e.jsx(X,{}),e.jsx(Z,{}),e.jsx(J,{}),e.jsx(Q,{type:"monotone",dataKey:"views",stroke:"#8884d8",strokeWidth:2})]})})})]}),e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(d,{className:"h-5 w-5"}),"Top Viewed Properties"]}),e.jsx(n,{children:"Click on a property to see detailed visitor information"})]}),e.jsx(c,{children:e.jsx("div",{className:"space-y-3",children:(A?.viewsByProperty||[]).slice(0,10).map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg cursor-pointer hover:bg-muted transition-colors",onClick:()=>O(s.propertyId),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary text-primary-foreground font-bold",children:a+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.propertyTitle}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.uniqueViewers," unique viewers"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold",children:s.totalViews}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"views"})]})]},s.propertyId))})})]}),B&&e.jsx(ae,{propertyId:B,dateRange:g})]})}),e.jsx(T,{value:"users",className:"space-y-4",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(C,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"User Analytics"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Monitor user registrations, conversions, and engagement patterns"})]})}),e.jsx(T,{value:"traffic",className:"space-y-4",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(se,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"Traffic Analytics"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Analyze traffic sources, devices, locations, and peak usage hours"})]})}),e.jsx(T,{value:"engagement",className:"space-y-4",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(V,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"Engagement Analytics"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Track active users, messages, reviews, and top contributors"})]})})]})]})};export{te as default};

import{j as e}from"./ui-DHQhougw.js";import{r as s,L as t}from"./router-Bi51YGN-.js";import{$ as a,y as r,aH as i,f as l,a as c,b as n,c as d,d as o,e as m,L as x,I as u,G as h,a3 as j,a4 as p,a5 as g,aj as v,ae as N,B as b,E as y,Q as k,R as f,V as w,W as C,Y as S,T,C as L,D as A,aI as D,m as E}from"./index-BElMMwCt.js";import{L as R}from"./log-in-DamO1Ttm.js";import{C as O}from"./circle-alert-CSs_70zd.js";import"./vendor-eVk5PToZ.js";const P=()=>{const{toast:P}=a(),[V,Y]=s.useState([]),[F,I]=s.useState(!1),[U,$]=s.useState("all"),[q,B]=s.useState(""),[z,H]=s.useState(""),[M,G]=s.useState(""),[K,Q]=s.useState(null),[W,_]=s.useState(!1),[J,X]=s.useState(!1),[Z,ee]=s.useState(""),[se,te]=s.useState(!1),[ae,re]=s.useState(!1);s.useEffect(()=>{const e=r.getToken();re(!!e),e&&ie()},[U]);const ie=async()=>{if(ae)try{I(!0);const e={};"all"!==U&&(e.status=U);const s=await i.getMyTickets(e);Y(s.data.tickets)}catch(e){e.message?.includes("token")||e.message?.includes("401")||P({title:"Error",description:"Failed to fetch tickets",variant:"destructive"})}finally{I(!1)}else Y([])},le=e=>{const s={open:{icon:O,class:"bg-blue-600",label:"Open"},"in-progress":{icon:E,class:"bg-yellow-600",label:"In Progress"},resolved:{icon:L,class:"bg-green-600",label:"Resolved"},closed:{icon:A,class:"bg-gray-600",label:"Closed"}};return s[e]||s.open},ce=e=>{const s={low:"bg-gray-100 text-gray-800",medium:"bg-blue-100 text-blue-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"};return s[e]||s.medium},ne=V.filter(e=>e.subject.toLowerCase().includes(q.toLowerCase())||e.ticketNumber.toLowerCase().includes(q.toLowerCase()));return e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Support & Help Desk"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track your support requests and get help"})]}),e.jsx(l,{onClick:()=>X(!0),children:"Create Support Ticket"})]}),e.jsxs(c,{children:[e.jsxs(n,{children:[e.jsx(d,{children:"Track Ticket by Number"}),e.jsx(o,{children:"Enter your ticket number and email to view its status"})]}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"ticketNumber",children:"Ticket Number"}),e.jsx(u,{id:"ticketNumber",placeholder:"TKT-123456",value:z,onChange:e=>H(e.target.value.toUpperCase())})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"trackingEmail",children:"Email Address"}),e.jsx(u,{id:"trackingEmail",type:"email",placeholder:"your@email.com",value:M,onChange:e=>G(e.target.value)})]})]}),e.jsxs(l,{onClick:async()=>{if(z.trim())if(M.trim())try{const e=await i.getTicketByNumber(z,M);Q(e.data.ticket),_(!0)}catch(e){}else P({title:"Validation Error",description:"Please enter your email address",variant:"destructive"});else P({title:"Validation Error",description:"Please enter a ticket number",variant:"destructive"})},className:"w-full md:w-auto",children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"Track Ticket"]})]})})]}),e.jsxs(c,{children:[e.jsxs(n,{children:[e.jsx(d,{children:"My Support Tickets"}),e.jsx(o,{children:ae?"View and manage your support requests":"Login to view your support tickets"})]}),e.jsx(m,{children:ae?F?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading tickets..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(h,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(u,{placeholder:"Search tickets...",value:q,onChange:e=>B(e.target.value),className:"pl-10"})]}),e.jsxs(j,{value:U,onValueChange:$,children:[e.jsxs(p,{children:[e.jsx(g,{value:"all",children:"All"}),e.jsx(g,{value:"open",children:"Open"}),e.jsx(g,{value:"in-progress",children:"In Progress"}),e.jsx(g,{value:"resolved",children:"Resolved"}),e.jsx(g,{value:"closed",children:"Closed"})]}),e.jsx(v,{value:U,className:"space-y-4 mt-4",children:0===ne.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Tickets Found"}),e.jsx("p",{className:"text-muted-foreground",children:"all"===U?"You haven't created any support tickets yet":`No ${U} tickets to display`})]}):ne.map(s=>{const t=le(s.status),a=t.icon;return e.jsxs(c,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(n,{children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"text-lg",children:s.subject}),e.jsxs(b,{className:t.class,children:[e.jsx(a,{className:"w-3 h-3 mr-1"}),t.label]}),e.jsx(b,{className:ce(s.priority),children:s.priority.toUpperCase()})]}),e.jsxs(o,{children:["Ticket #",s.ticketNumber," â€¢ ",new Date(s.createdAt).toLocaleDateString()]})]})})}),e.jsxs(m,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-2",children:s.description}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{Q(s),_(!0)},children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"View Details"]})]})]},s._id)})})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(R,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Authentication Required"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Please login to view and manage your support tickets"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(l,{asChild:!0,children:e.jsx(t,{to:"/login",children:"Login"})}),e.jsx(l,{variant:"outline",asChild:!0,children:e.jsx(t,{to:"/signup",children:"Create Account"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-6",children:'Already have a ticket? Use the "Track by Number" section above to check your ticket status.'})]})})]}),e.jsx(k,{open:W,onOpenChange:_,children:e.jsxs(f,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(w,{children:[e.jsx(C,{children:"Ticket Details"}),e.jsxs(S,{children:["Ticket #",K?.ticketNumber]})]}),K&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Status"}),e.jsx("div",{className:"mt-1",children:e.jsx(b,{className:le(K.status).class,children:le(K.status).label})})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Priority"}),e.jsx("div",{className:"mt-1",children:e.jsx(b,{className:ce(K.priority),children:K.priority.toUpperCase()})})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Category"}),e.jsx("p",{className:"text-sm mt-1 capitalize",children:K.category})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Created"}),e.jsx("p",{className:"text-sm mt-1",children:new Date(K.createdAt).toLocaleString()})]})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Subject"}),e.jsx("p",{className:"text-sm mt-1 font-semibold",children:K.subject})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Description"}),e.jsx("p",{className:"text-sm mt-1 whitespace-pre-wrap",children:K.description})]}),K.responses&&K.responses.length>0&&e.jsxs("div",{children:[e.jsx(x,{children:"Conversation"}),e.jsx("div",{className:"space-y-3 mt-2",children:K.responses.map((s,t)=>e.jsxs("div",{className:"p-4 rounded-lg "+(s.isAdmin?"bg-blue-50 dark:bg-blue-950":"bg-muted"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm",children:s.author}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.isAdmin?"Support Team":"You"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleString()})]}),e.jsx("p",{className:"text-sm",children:s.message})]},t))})]}),"closed"!==K.status&&"resolved"!==K.status&&e.jsxs("div",{children:[e.jsx(x,{children:"Add Response"}),e.jsx(T,{placeholder:"Type your message...",value:Z,onChange:e=>ee(e.target.value),rows:4,className:"mt-2"}),e.jsx("div",{className:"flex gap-2 mt-2",children:e.jsxs(l,{onClick:async()=>{if(K&&Z.trim())try{te(!0),await i.addResponse(K.ticketNumber,Z),ee(""),P({title:"Success",description:"Your reply has been sent. Our support team will respond soon."});const e=await i.getTicketByNumber(K.ticketNumber,M||K.email);Q(e.data.ticket),ae&&ie()}catch(e){}finally{te(!1)}else P({title:"Validation Error",description:"Please enter a message",variant:"destructive"})},disabled:se,children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),se?"Sending...":"Send Reply"]})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Our support team will review and respond to your message. Only support staff can resolve tickets."})]}),"resolved"===K.status&&e.jsx("div",{className:"bg-green-50 dark:bg-green-950 border border-green-200 dark:border-green-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(L,{className:"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:"Ticket Resolved"}),e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300 mt-1",children:["This ticket has been marked as resolved by our support team.",K.resolvedAt&&` on ${new Date(K.resolvedAt).toLocaleDateString()}`]}),K.responses&&K.responses.length>0&&e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400 mt-2",children:"If you need further assistance, please create a new support ticket."})]})]})}),"closed"===K.status&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(A,{className:"h-5 w-5 text-gray-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:"Ticket Closed"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mt-1",children:"This ticket has been closed. For new issues, please create a new support ticket."})]})]})})]})]})}),e.jsx(D,{open:J,onOpenChange:X,onSuccess:e=>{P({title:"Ticket Created",description:`Your ticket number is ${e}. You can track it anytime.`}),ie()}})]})};export{P as default};

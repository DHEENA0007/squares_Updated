import{j as e}from"./ui-s1SEoZIF.js";import{r as s,d as a}from"./router-D8v2YSKU.js";import{D as l,u as i,G as t,K as r,B as d,f as c,E as n,at as o,au as m,ad as x,av as h,aw as j,ax as u,ay as p,az as f,aA as N,aB as g,a4 as v,a5 as b,a6 as y,a7 as w,a8 as C,a as S,b as A,c as k,x as U,e as P,S as V,k as F,R as E,q as D,r as _,s as R,v as z,w as M,Z as O,aC as I,a9 as T,I as L,aj as B}from"./index-DvBXyKtT.js";import{u as J}from"./use-mobile-C5fBmhy-.js";import{T as Q,a as q,b as G,c as K,d as W,e as Z}from"./table-Bkp50phG.js";import{P as H,a as X,b as Y,c as $,d as ee,e as se}from"./pagination-Di26qYlD.js";import{r as ae}from"./roleService-BiYuYiOl.js";import{C as le}from"./calendar-JKH5plE4.js";import"./vendor-BxThA0WO.js";import"./ellipsis-Cl__aAUc.js";const ie=l("CircleArrowUp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]),te=({searchQuery:a,roleFilter:l,monthFilter:I})=>{const{isSuperAdmin:T,user:L}=i(),B=L?.rolePermissions||[],te=T||(re=O.USERS_PROMOTE,B.includes(re));var re;const de=J(),[ce,ne]=s.useState(1),[oe,me]=s.useState([]),[xe,he]=s.useState(!0),[je,ue]=s.useState(!1),[pe,fe]=s.useState(0),[Ne,ge]=s.useState(0),[ve,be]=s.useState(null),[ye,we]=s.useState(null),[Ce,Se]=s.useState(!1),[Ae,ke]=s.useState(!1),[Ue,Pe]=s.useState(null),[Ve,Fe]=s.useState(""),[Ee,De]=s.useState([]);s.useEffect(()=>{(async()=>{try{const e=await ae.getRoles({limit:100,isActive:!0});De(e.data.roles)}catch(e){}})()},[]),s.useEffect(()=>{(async()=>{xe||ue(!0);try{const e=await r.getUsers({page:ce,limit:10,search:a||void 0,role:l||void 0,month:I||void 0});e.success&&(me(e.data.users),fe(e.data.pagination.totalPages),ge(e.data.pagination.totalUsers))}catch(e){}finally{he(!1),ue(!1)}})()},[ce,a,l,I]);return xe?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(t,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading users..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(Q,{className:de?"min-w-[450px]":"",children:[e.jsx(q,{children:e.jsxs(G,{children:[e.jsx(K,{className:de?"text-xs":"",children:"S.No"}),e.jsx(K,{className:de?"text-xs":"",children:"Name"}),e.jsx(K,{className:de?"text-xs":"",children:"Email"}),e.jsx(K,{className:"hidden md:table-cell "+(de?"text-xs":""),children:"Phone"}),e.jsx(K,{className:"hidden sm:table-cell "+(de?"text-xs":""),children:"Role"}),e.jsx(K,{className:"hidden lg:table-cell "+(de?"text-xs":""),children:"Status"}),e.jsx(K,{className:"hidden lg:table-cell "+(de?"text-xs":""),children:"Created"}),e.jsx(K,{className:"text-right "+(de?"text-xs":""),children:"Actions"})]})}),e.jsx(W,{children:0===oe.length?e.jsx(G,{children:e.jsx(Z,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No users found."})}):oe.map((s,l)=>e.jsxs(G,{children:[e.jsx(Z,{className:de?"text-xs":"",children:10*(ce-1)+l+1}),e.jsx(Z,{className:"font-medium "+(de?"text-xs":""),children:r.getFullName(s)}),e.jsx(Z,{className:de?"text-xs":"",children:s.email}),e.jsx(Z,{className:"hidden md:table-cell "+(de?"text-xs":""),children:s.profile.phone||"-"}),e.jsx(Z,{className:"hidden sm:table-cell "+(de?"text-xs":""),children:e.jsx(d,{variant:"admin"===s.role?"default":"secondary",className:de?"text-xs px-1 py-0":"",children:s.role})}),e.jsx(Z,{className:"hidden lg:table-cell "+(de?"text-xs":""),children:e.jsx(d,{variant:"active"===s.status?"default":"pending"===s.status?"secondary":"destructive",className:de?"text-xs px-1 py-0":"",children:s.status})}),e.jsx(Z,{className:"hidden lg:table-cell "+(de?"text-xs":""),children:r.formatCreationDate(s.createdAt)}),e.jsx(Z,{className:"text-right "+(de?"text-xs":""),children:e.jsxs("div",{className:"flex justify-end gap-1 "+(de?"gap-0.5":"gap-2"),children:[e.jsx(c,{variant:"ghost",size:de?"sm":"icon",onClick:()=>(e=>{we(e),Se(!0)})(s),title:"View User Details",className:de?"h-6 w-6 p-1":"",children:e.jsx(n,{className:de?"h-3 w-3":"h-4 w-4"})}),te&&e.jsx(c,{variant:"ghost",size:de?"sm":"icon",onClick:()=>(e=>{we(e),Fe(e.role),ke(!0)})(s),title:"Promote User",className:de?"h-6 w-6 p-1":"",children:e.jsx(ie,{className:de?"h-3 w-3":"h-4 w-4"})}),e.jsxs(o,{children:[e.jsx(m,{asChild:!0,children:e.jsx(c,{variant:"ghost",size:de?"sm":"icon",className:de?"h-6 w-6 p-1":"",children:e.jsx(x,{className:de?"h-3 w-3":"h-4 w-4"})})}),e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsx(u,{children:"Are you absolutely sure?"}),e.jsx(p,{children:"This action cannot be undone. This will permanently delete the user account and remove their data from our servers."})]}),e.jsxs(f,{children:[e.jsx(N,{children:"Cancel"}),e.jsxs(g,{onClick:()=>(async e=>{be(e);try{await r.deleteUser(e);const s=await r.getUsers({page:ce,limit:10,search:a||void 0});s.success&&(me(s.data.users),fe(s.data.pagination.totalPages),ge(s.data.pagination.totalUsers))}catch(s){}finally{be(null)}})(s._id),disabled:ve===s._id,children:[ve===s._id?e.jsx(t,{className:"h-4 w-4 animate-spin mr-2"}):null,"Delete"]})]})]})]})]})})]},s._id))})]})}),pe>1&&e.jsx(H,{className:"mt-4",children:e.jsxs(X,{children:[e.jsx(Y,{children:e.jsx($,{onClick:()=>ne(e=>Math.max(1,e-1)),className:1===ce?"pointer-events-none opacity-50":"cursor-pointer"})}),[...Array(pe)].map((s,a)=>{const l=a+1;return 1===l||l===pe||l>=ce-1&&l<=ce+1?e.jsx(Y,{children:e.jsx(ee,{onClick:()=>ne(l),isActive:ce===l,className:"cursor-pointer",children:l})},l):l===ce-2||l===ce+2?e.jsx(Y,{children:"..."},l):null}),e.jsx(Y,{children:e.jsx(se,{onClick:()=>ne(e=>Math.min(pe,e+1)),className:ce===pe?"pointer-events-none opacity-50":"cursor-pointer"})})]})}),e.jsx(v,{open:Ce,onOpenChange:Se,children:e.jsxs(b,{className:(de?"max-w-[95vw] max-h-[95vh]":"max-w-4xl max-h-[90vh]")+" overflow-y-auto",children:[e.jsxs(y,{children:[e.jsx(w,{children:"User Details"}),e.jsxs(C,{children:["Complete information about ",ye?r.getFullName(ye):"user"]})]}),ye&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5"}),"Basic Information"]})}),e.jsx(P,{className:"space-y-3",children:e.jsxs("div",{className:"grid gap-4 "+(de?"grid-cols-1":"grid-cols-1 md:grid-cols-2"),children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Full Name"}),e.jsx("p",{className:"text-base",children:r.getFullName(ye)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Email"}),e.jsx("p",{className:"text-base",children:ye.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"text-base",children:ye.profile?.phone||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"User ID"}),e.jsx("p",{className:"text-base font-mono text-sm",children:ye._id})]})]})})]}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Account Status"]})}),e.jsx(P,{className:"space-y-3",children:e.jsxs("div",{className:"grid gap-4 "+(de?"grid-cols-1":"grid-cols-1 md:grid-cols-2"),children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Role"}),e.jsx(d,{variant:"admin"===ye.role?"default":"secondary",className:"mt-1",children:ye.role})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx(d,{variant:"active"===ye.status?"default":"pending"===ye.status?"secondary":"destructive",className:"mt-1",children:ye.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Email Verified"}),e.jsx(d,{variant:ye.profile?.emailVerified?"default":"destructive",className:"mt-1",children:ye.profile?.emailVerified?"Verified":"Not Verified"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Phone Verified"}),e.jsx(d,{variant:ye.profile?.phoneVerified?"default":"destructive",className:"mt-1",children:ye.profile?.phoneVerified?"Verified":"Not Verified"})]})]})})]}),ye.profile?.address&&e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"Address Information"]})}),e.jsx(P,{className:"space-y-3",children:e.jsxs("div",{className:"grid gap-4 "+(de?"grid-cols-1":"grid-cols-1 md:grid-cols-2"),children:[ye.profile?.address?.street&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Street"}),e.jsx("p",{className:"text-base",children:ye.profile.address.street})]}),ye.profile?.address?.city&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"City"}),e.jsx("p",{className:"text-base",children:ye.profile.address.city})]}),ye.profile?.address?.state&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"State"}),e.jsx("p",{className:"text-base",children:ye.profile.address.state})]}),ye.profile?.address?.zipCode&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pincode"}),e.jsx("p",{className:"text-base",children:ye.profile.address.zipCode})]})]})})]}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"User Preferences"]})}),e.jsxs(P,{className:"space-y-3",children:[e.jsxs("div",{className:"grid gap-4 "+(de?"grid-cols-1":"grid-cols-1 md:grid-cols-2"),children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Language"}),e.jsx("p",{className:"text-base",children:"Not available"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Currency"}),e.jsx("p",{className:"text-base",children:"Not available"})]})]}),ye.profile?.preferences?.notifications&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Notification Preferences"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(d,{variant:ye.profile.preferences.notifications.email?"default":"secondary",children:["Email: ",ye.profile.preferences.notifications.email?"Enabled":"Disabled"]}),e.jsxs(d,{variant:ye.profile.preferences.notifications.sms?"default":"secondary",children:["SMS: ",ye.profile.preferences.notifications.sms?"Enabled":"Disabled"]}),e.jsxs(d,{variant:ye.profile.preferences.notifications.push?"default":"secondary",children:["Push: ",ye.profile.preferences.notifications.push?"Enabled":"Disabled"]})]})]})]})]}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5"}),"Account Timeline"]})}),e.jsx(P,{className:"space-y-3",children:e.jsxs("div",{className:"grid gap-4 "+(de?"grid-cols-1":"grid-cols-1 md:grid-cols-2"),children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Created At"}),e.jsx("p",{className:"text-base",children:r.formatCreationDate(ye.createdAt)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Last Updated"}),e.jsx("p",{className:"text-base",children:r.formatCreationDate(ye.updatedAt)})]})]})})]}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsx(k,{children:"Quick Actions"})}),e.jsx(P,{children:e.jsx("div",{className:"flex gap-2 flex-wrap",children:e.jsx(c,{variant:"outline",size:"sm",onClick:()=>Se(!1),children:"Close"})})})]})]})]})}),e.jsx(v,{open:Ae,onOpenChange:ke,children:e.jsxs(b,{children:[e.jsxs(y,{children:[e.jsx(w,{children:"Promote User"}),e.jsxs(C,{children:["Change the role of ",ye?r.getFullName(ye):"user"]})]}),ye&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Current Role"}),e.jsx(d,{variant:"secondary",children:ye.role})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"New Role"}),e.jsxs(D,{value:Ve,onValueChange:Fe,children:[e.jsx(_,{children:e.jsx(R,{placeholder:"Select a role"})}),e.jsx(z,{children:Ee.length>0?Ee.map(s=>e.jsx(M,{value:s.name,children:s.name},s._id)):e.jsxs(e.Fragment,{children:[e.jsx(M,{value:"customer",children:"Customer"}),e.jsx(M,{value:"agent",children:"Vendor/Agent"}),e.jsx(M,{value:"subadmin",children:"Sub Admin"}),e.jsx(M,{value:"superadmin",children:"Super Admin"})]})})]})]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-950/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("strong",{children:"Warning:"})," Changing a user's role will affect their permissions and access to features."]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{variant:"outline",onClick:()=>{ke(!1),we(null),Fe("")},children:"Cancel"}),e.jsx(c,{onClick:async()=>{if(ye&&Ve){Pe(ye._id);try{await r.promoteUser(ye._id,Ve);const e=await r.getUsers({page:ce,limit:10,search:a||void 0});e.success&&(me(e.data.users),fe(e.data.pagination.totalPages),ge(e.data.pagination.totalUsers)),ke(!1),we(null),Fe("")}catch(e){}finally{Pe(null)}}},disabled:!Ve||Ve===ye.role||Ue===ye._id,children:Ue===ye._id?e.jsxs(e.Fragment,{children:[e.jsx(t,{className:"h-4 w-4 animate-spin mr-2"}),"Promoting..."]}):"Promote User"})]})]})]})})]})},re=()=>{const l=a(),i=J(),[t,r]=s.useState(""),d=I(t,500),[n,o]=s.useState("all"),[m,x]=s.useState("all"),[h,j]=s.useState([]),[u,p]=s.useState(!1);s.useEffect(()=>{(async()=>{try{const e=await ae.getRoles({limit:100,isActive:!0});j(e.data.roles)}catch(e){}})()},[]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex "+(i?"flex-col gap-4":"flex-row justify-between items-start sm:items-center gap-4"),children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold "+(i?"text-2xl":"text-3xl"),children:"Users"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"View and manage system users"})]}),e.jsxs(c,{onClick:()=>l("/admin/users/add"),className:i?"w-full":"",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Add User"]})]}),e.jsxs("div",{className:"bg-card rounded-lg border p-4 md:p-6",children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(L,{placeholder:"Search users...",value:t,onChange:e=>r(e.target.value),className:"flex-1"}),e.jsx(c,{variant:"outline",size:"icon",onClick:()=>p(!u),className:u?"bg-accent":"",children:e.jsx(B,{className:"h-4 w-4"})})]}),u&&e.jsxs("div",{className:"grid gap-4 "+(i?"grid-cols-1":"grid-cols-2 md:grid-cols-3"),children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Role"}),e.jsxs(D,{value:n,onValueChange:o,children:[e.jsx(_,{children:e.jsx(R,{placeholder:"All roles"})}),e.jsxs(z,{children:[e.jsx(M,{value:"all",children:"All roles"}),h.map(s=>e.jsx(M,{value:s.name.toLowerCase(),children:s.name},s._id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Month Created"}),e.jsxs(D,{value:m,onValueChange:x,children:[e.jsx(_,{children:e.jsx(R,{placeholder:"All months"})}),e.jsxs(z,{children:[e.jsx(M,{value:"all",children:"All months"}),[{value:"1",label:"January"},{value:"2",label:"February"},{value:"3",label:"March"},{value:"4",label:"April"},{value:"5",label:"May"},{value:"6",label:"June"},{value:"7",label:"July"},{value:"8",label:"August"},{value:"9",label:"September"},{value:"10",label:"October"},{value:"11",label:"November"},{value:"12",label:"December"}].map(s=>e.jsx(M,{value:s.value,children:s.label},s.value))]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(c,{variant:"outline",onClick:()=>{o("all"),x("all")},className:"w-full",children:"Clear Filters"})})]})]}),e.jsx(te,{searchQuery:d,roleFilter:"all"===n?"":n,monthFilter:"all"===m?"":m})]})]})};export{re as default};

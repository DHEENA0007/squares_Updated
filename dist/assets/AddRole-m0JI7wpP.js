import{j as e}from"./ui-DOY6021Z.js";import{d as P,r as j}from"./router-2SVJvIbS.js";import{f as p,a as g,b as f,c as v,e as h,I as C,B as A,t as u}from"./index-SPvHGBGF.js";import{L as l}from"./label-BbghIvjf.js";import{T as _}from"./textarea-CVqyUzcD.js";import{C as R}from"./checkbox-BLKtZrMn.js";import{S as k}from"./switch-BWUjTo_6.js";import{r as M}from"./roleService-CiQYSDCz.js";import{A as B}from"./arrow-left-KXNCpd3b.js";import{L as D}from"./loader-circle-B83afoI3.js";import{S as E}from"./save-D5MdAwIN.js";import"./vendor-Dazix4UH.js";const x=[{id:"create_property",label:"Create Properties",description:"Can create new property listings",category:"Property"},{id:"read_property",label:"View Properties",description:"Can view property listings",category:"Property"},{id:"update_property",label:"Edit Properties",description:"Can edit existing properties",category:"Property"},{id:"delete_property",label:"Delete Properties",description:"Can delete property listings",category:"Property"},{id:"manage_users",label:"Manage Users",description:"Can manage user accounts",category:"User Management"},{id:"manage_roles",label:"Manage Roles",description:"Can create and manage user roles",category:"User Management"},{id:"manage_plans",label:"Manage Plans",description:"Can manage subscription plans",category:"System"},{id:"view_dashboard",label:"View Dashboard",description:"Can access admin dashboard",category:"System"},{id:"manage_settings",label:"Manage Settings",description:"Can modify system settings",category:"System"},{id:"manage_content",label:"Manage Content",description:"Can manage site content",category:"System"},{id:"send_messages",label:"Send Messages",description:"Can send messages to users",category:"Communication"},{id:"moderate_content",label:"Moderate Content",description:"Can moderate user content",category:"Communication"},{id:"access_analytics",label:"Access Analytics",description:"Can view system analytics",category:"Analytics"}],K=()=>{const d=P(),[m,y]=j.useState(!1),[a,o]=j.useState({name:"",description:"",permissions:[],isActive:!0,level:1}),c=(s,t)=>{o(i=>({...i,[s]:t}))},b=s=>{o(t=>({...t,permissions:t.permissions.includes(s)?t.permissions.filter(i=>i!==s):[...t.permissions,s]}))},N=s=>{const t=x.filter(r=>r.category===s).map(r=>r.id),i=t.every(r=>a.permissions.includes(r));o(i?r=>({...r,permissions:r.permissions.filter(n=>!t.includes(n))}):r=>({...r,permissions:[...new Set([...r.permissions,...t])]}))},S=async s=>{if(s.preventDefault(),!a.name.trim()){u({title:"Error",description:"Role name is required",variant:"destructive"});return}if(!a.description.trim()){u({title:"Error",description:"Role description is required",variant:"destructive"});return}if(a.permissions.length===0){u({title:"Error",description:"At least one permission must be selected",variant:"destructive"});return}try{y(!0),await M.createRole(a),d("/admin/roles")}catch(t){console.error("Failed to create role:",t)}finally{y(!1)}},w=[...new Set(x.map(t=>t.category))].reduce((t,i)=>(t[i]=x.filter(r=>r.category===i),t),{});return e.jsxs("div",{className:"space-y-6 relative top-[60px]",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>d("/admin/roles"),className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),"Back to Roles"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Add New Role"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Create a new user role with specific permissions"})]})]}),e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(v,{children:"Basic Information"})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"name",children:"Role Name *"}),e.jsx(C,{id:"name",placeholder:"e.g., Property Manager",value:a.name,onChange:s=>c("name",s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"level",children:"Level (1-10) *"}),e.jsx(C,{id:"level",type:"number",min:1,max:10,value:a.level,onChange:s=>c("level",parseInt(s.target.value)),required:!0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Higher levels have more authority (1 = lowest, 10 = highest)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"description",children:"Description *"}),e.jsx(_,{id:"description",placeholder:"Describe what this role is responsible for...",value:a.description,onChange:s=>c("description",s.target.value),required:!0,rows:3})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{id:"isActive",checked:a.isActive,onCheckedChange:s=>c("isActive",s)}),e.jsx(l,{htmlFor:"isActive",children:"Active Role"})]})]})]}),e.jsxs(g,{children:[e.jsxs(f,{children:[e.jsx(v,{children:"Permissions"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select the permissions this role should have. You can select all permissions in a category by clicking the category badge."})]}),e.jsx(h,{className:"space-y-6",children:Object.entries(w).map(([s,t])=>{const i=t.filter(n=>a.permissions.includes(n.id)).length,r=i===t.length;return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(A,{variant:r?"default":"outline",className:"cursor-pointer",onClick:()=>N(s),children:[s," (",i,"/",t.length,")"]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:t.map(n=>e.jsxs("div",{className:"flex items-start space-x-3 p-3 border rounded-lg hover:bg-muted/50",children:[e.jsx(R,{id:n.id,checked:a.permissions.includes(n.id),onCheckedChange:()=>b(n.id),className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:n.id,className:"cursor-pointer font-medium text-sm",children:n.label}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:n.description})]})]},n.id))})]},s)})})]}),e.jsx(g,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[a.permissions.length," permission",a.permissions.length!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>d("/admin/roles"),disabled:m,children:"Cancel"}),e.jsxs(p,{type:"submit",disabled:m,className:"flex items-center gap-2",children:[m?e.jsx(D,{className:"h-4 w-4 animate-spin"}):e.jsx(E,{className:"h-4 w-4"}),"Create Role"]})]})]})})})]})]})};export{K as default};

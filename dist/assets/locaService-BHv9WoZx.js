const t=new class{locationData=[];initialized=!1;loading=!1;initPromise=null;async initialize(){if(!this.initialized){if(this.loading&&this.initPromise)return this.initPromise;this.loading=!0,this.initPromise=this.loadData();try{await this.initPromise}finally{this.loading=!1}}}async loadData(){try{const t="/v2/",i=await fetch(`${t}loca.json`);if(!i.ok)throw new Error(`Failed to load loca.json: ${i.statusText}`);const e=await i.json();this.locationData=e.records||[],this.initialized=!0}catch(t){throw this.locationData=[],t}}getStates(){const t=new Set(this.locationData.map(t=>t.state));return Array.from(t).sort()}getDistricts(t){if(!t)return[];const i=t.toUpperCase(),e=new Set(this.locationData.filter(t=>t.state.toUpperCase()===i).map(t=>t.district));return Array.from(e).sort()}getCities(t,i){if(!t||!i)return[];const e=t.toUpperCase(),o=i.toUpperCase(),a=new Set(this.locationData.filter(t=>t.state.toUpperCase()===e&&t.district.toUpperCase()===o).map(t=>t.city));return Array.from(a).sort()}getPincodeSuggestions(t,i,e,o){let a=this.locationData;if(t){const i=t.toUpperCase();a=a.filter(t=>t.state.toUpperCase()===i)}if(i){const t=i.toUpperCase();a=a.filter(i=>i.district.toUpperCase()===t)}if(e){const t=e.toUpperCase();a=a.filter(i=>i.city.toUpperCase()===t)}if(o&&o.trim()){const t=o.trim();a=a.filter(i=>i.pincode.startsWith(t))}const s=new Map;return a.forEach(t=>{s.has(t.pincode)||s.set(t.pincode,{pincode:t.pincode,city:t.city,district:t.district,state:t.state})}),Array.from(s.values()).sort((t,i)=>t.pincode.localeCompare(i.pincode)).slice(0,50)}getLocationByPincode(t){if(!t||!t.trim())return[];const i=t.trim();return this.locationData.filter(t=>t.pincode===i).map(t=>({pincode:t.pincode,city:t.city,district:t.district,state:t.state}))}validatePincode(t){if(!t||!t.trim())return!1;const i=t.trim();return this.locationData.some(t=>t.pincode===i)}searchLocations(t,i=20){if(!t||!t.trim())return[];const e=t.trim().toLowerCase(),o=this.locationData.filter(t=>t.city.toLowerCase().includes(e)||t.district.toLowerCase().includes(e)||t.state.toLowerCase().includes(e)||t.pincode.includes(e)),a=new Map;return o.forEach(t=>{const i=`${t.pincode}-${t.city}`;a.has(i)||a.set(i,{pincode:t.pincode,city:t.city,district:t.district,state:t.state})}),Array.from(a.values()).slice(0,i)}isReady(){return this.initialized}getRecordCount(){return this.locationData.length}};export{t as locaService};

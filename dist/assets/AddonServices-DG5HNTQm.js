import{j as e}from"./ui-BNZSgpjP.js";import{d as s,r as a}from"./router-D8v2YSKU.js";import{u as t,a2 as l,aP as r,aQ as d,a as i,b as n,c,x as o,e as m,X as u,h as x,af as h,ag as g,ah as p,$ as j,I as v,ap as f,ar as N,B as b,f as y,E as S,aB as w,a4 as k,a5 as A,a6 as C,a7 as D,a8 as E,L as _,T as V,ae as P,Z as I}from"./index-BxQlwZ4N.js";import{S as O,a as T,b as R,c as $,d as U}from"./sheet-BFok3I82.js";import{T as M,a as z,b as L,c as F,d as H,e as Y}from"./table-DislQvtG.js";import{C as B}from"./calendar-D1Xo3Yen.js";import"./vendor-BxThA0WO.js";const J=(e,s="INR")=>new Intl.NumberFormat("en-IN",{style:"currency",currency:s,minimumFractionDigits:0}).format(e),W=e=>{const s={photography:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",videography:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300",virtual_tour:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",drone_photography:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300",floor_plan:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",staging:"bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-300",inspection:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",other:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"};return s[e]||s.other},G=()=>{const{user:G}=t(),Q=s(),X=G?.rolePermissions||[],{toast:Z}=l(),q="admin"===G?.role||"superadmin"===G?.role,K=e=>X.includes(e),ee=q||K(I.ADDON_SERVICES_READ),se=q||K(I.ADDON_SERVICES_SCHEDULE),ae=q||K(I.ADDON_SERVICES_MANAGE),te=q||K(I.ADDON_SERVICES_STATUS);q||K(I.ADDON_SERVICES_NOTES);const[le,re]=a.useState([]),[de,ie]=a.useState(!0),[ne,ce]=a.useState(""),[oe,me]=a.useState("active"),[ue,xe]=a.useState(null),[he,ge]=a.useState(!1),[pe,je]=a.useState(!1),[ve,fe]=a.useState(!1),[Ne,be]=a.useState(null),[ye,Se]=a.useState(""),[we,ke]=a.useState(""),[Ae,Ce]=a.useState(""),[De,Ee]=a.useState({}),[_e,Ve]=a.useState(null),[Pe,Ie]=a.useState(""),[Oe,Te]=a.useState(""),[Re,$e]=a.useState(""),[Ue,Me]=a.useState(""),[ze,Le]=a.useState(""),[Fe,He]=a.useState("medium"),[Ye,Be]=a.useState(1),[Je,We]=a.useState(1),[Ge,Qe]=a.useState({activeVendors:0,totalAddons:0,totalSchedules:0,completedSchedules:0,inProgressSchedules:0,scheduledSchedules:0,categories:0});a.useEffect(()=>{if(!ee)return Z({title:"Access Denied",description:"You don't have permission to view addon services.",variant:"destructive"}),void Q("/rolebased");Xe(),Ze()},[oe,ne,Ye]),a.useEffect(()=>{Be(1)},[oe,ne]);const Xe=async()=>{if(ee)try{ie(!0);const e=await r(`/subadmin/addon-services?status=${oe}&search=${ne}&page=${Ye}&limit=10`),s=await d(e);re(s.data.vendorAddons||[]),We(s.data.totalPages||1)}catch(e){Z({title:"Error",description:e.message||"Error fetching addon services",variant:"destructive"}),re([])}finally{ie(!1)}},Ze=async()=>{try{const e=await r(`/subadmin/addon-services/stats?status=${oe}`),s=await d(e);Qe(s.data)}catch(e){}},qe=e=>{Ve(e),Ie(e.status),Te(e.scheduledDate?new Date(e.scheduledDate).toISOString().slice(0,16):""),$e(e.vendorResponse||""),Me(e.cancellationReason||""),fe(!0)},Ke=e=>{switch(e){case"completed":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"in_progress":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"scheduled":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200";case"cancelled":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200"}},es=e=>{switch(e){case"urgent":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";case"high":return"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200";case"medium":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";default:return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"}},ss=e=>{xe(e),ge(!0)};return de&&0===le.length?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Addon Services"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage vendor addon services and schedule appointments"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"},s))})]}):e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Addon Services"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"View vendors who have purchased addon services and schedule appointments"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs(i,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Active Vendors"}),e.jsx(o,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:Ge.activeVendors})})]}),e.jsxs(i,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Total Addons"}),e.jsx(u,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:Ge.totalAddons})})]}),e.jsxs(i,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Scheduled"}),e.jsx(B,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold",children:Ge.totalSchedules}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[Ge.completedSchedules," completed"]})]})]}),e.jsxs(i,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"In Progress"}),e.jsx(x,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold",children:Ge.inProgressSchedules}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[Ge.scheduledSchedules," scheduled"]})]})]}),e.jsxs(i,{className:"col-span-2 md:col-span-1",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Categories"}),e.jsx(u,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:Ge.categories})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx(h,{value:oe,onValueChange:me,className:"w-full sm:w-auto",children:e.jsxs(g,{className:"grid w-full grid-cols-3 sm:w-auto",children:[e.jsx(p,{value:"active",children:"Active"}),e.jsx(p,{value:"expired",children:"Expired"}),e.jsx(p,{value:"all",children:"All"})]})}),e.jsxs("div",{className:"relative w-full sm:w-72",children:[e.jsx(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(v,{placeholder:"Search vendors...",value:ne,onChange:e=>ce(e.target.value),className:"pl-10"})]})]}),e.jsx(i,{children:e.jsx(m,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(M,{children:[e.jsx(z,{children:e.jsxs(L,{children:[e.jsx(F,{children:"Vendor"}),e.jsx(F,{className:"hidden md:table-cell",children:"Email"}),e.jsx(F,{className:"hidden lg:table-cell",children:"Active Addons"}),e.jsx(F,{children:"Total Value"}),e.jsx(F,{className:"text-right",children:"Actions"})]})}),e.jsx(H,{children:0===le.length?e.jsx(L,{children:e.jsx(Y,{colSpan:5,className:"h-24 text-center",children:"No vendors found."})}):le.map(s=>e.jsxs(L,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>ss(s),children:[e.jsx(Y,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-8 w-8",children:e.jsx(N,{children:s.user.profile.firstName[0]})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{children:[s.user.profile.firstName," ",s.user.profile.lastName]}),e.jsx("span",{className:"text-xs text-muted-foreground md:hidden",children:s.user.email})]})]})}),e.jsx(Y,{className:"hidden md:table-cell",children:s.user.email}),e.jsx(Y,{className:"hidden lg:table-cell",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.activeAddons.slice(0,2).map(s=>e.jsx(b,{variant:"secondary",className:"text-xs",children:s.name},s._id)),s.activeAddons.length>2&&e.jsxs(b,{variant:"outline",className:"text-xs",children:["+",s.activeAddons.length-2," more"]})]})}),e.jsx(Y,{className:"font-medium",children:J(s.activeAddons.reduce((e,s)=>e+s.price,0))}),e.jsx(Y,{className:"text-right",children:e.jsx(y,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),ss(s)},children:e.jsx(S,{className:"h-4 w-4"})})})]},s._id))})]})})})}),Je>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4",children:[e.jsx(y,{variant:"outline",size:"sm",onClick:()=>Be(e=>Math.max(1,e-1)),disabled:1===Ye,children:"Previous"}),e.jsxs("span",{className:"text-sm",children:["Page ",Ye," of ",Je]}),e.jsx(y,{variant:"outline",size:"sm",onClick:()=>Be(e=>Math.min(Je,e+1)),disabled:Ye===Je,children:"Next"})]}),e.jsx(O,{open:he,onOpenChange:ge,children:e.jsxs(T,{className:"w-full sm:max-w-2xl flex flex-col p-0 gap-0",children:[e.jsxs(R,{className:"p-6 border-b",children:[e.jsx($,{children:"Vendor Addon Services"}),e.jsx(U,{children:"Detailed information about vendor's purchased addon services"})]}),e.jsx(w,{className:"flex-1 p-6",children:ue&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center gap-4 bg-muted/50 p-4 rounded-lg",children:[e.jsx(f,{className:"h-12 w-12",children:e.jsx(N,{className:"text-lg",children:ue.user.profile.firstName[0]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg",children:[ue.user.profile.firstName," ",ue.user.profile.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:ue.user.email}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(b,{variant:"outline",children:[ue.totalAddons," Addons"]}),e.jsxs(b,{variant:"secondary",className:"text-green-700 bg-green-100 dark:bg-green-900/30 dark:text-green-400",children:["Total Value: ",J(ue.activeAddons.reduce((e,s)=>e+s.price,0))]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm uppercase text-muted-foreground mb-4",children:"Active Services"}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:ue.activeAddons.map(s=>{const a=ue.schedules?.find(e=>e.addon._id===s._id&&["scheduled","in_progress"].includes(e.status));return e.jsx(i,{className:"overflow-hidden border-l-4 border-l-primary",children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h5",{className:"font-semibold",children:s.name}),e.jsx(b,{className:W(s.category),variant:"secondary",children:s.category})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:s.description}),e.jsx("p",{className:"font-medium text-primary",children:J(s.price)})]}),se&&!a&&e.jsx(y,{size:"sm",onClick:()=>(async e=>{se?(be(e),He("medium"),Ce(""),Se(`Schedule ${e.name} Service`),ke(`Dear Vendor,\n\nWe would like to schedule the ${e.name} service that you have purchased.\n\nPlease confirm the scheduled date and time for the service.\n\nService Details:\n- Name: ${e.name}\n- Description: ${e.description}\n- Category: ${e.category.charAt(0).toUpperCase()+e.category.slice(1)}\n\nThank you!\n\nBest regards,\nAdmin Team`),je(!0)):Z({title:"Access Denied",description:"You don't have permission to schedule services.",variant:"destructive"})})(s),children:"Schedule Service"}),a&&e.jsx(b,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:"in_progress"===a.status?"In Progress":"Scheduled"})]})})},s._id)})})]}),ue.schedules&&ue.schedules.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm uppercase text-muted-foreground mb-4",children:"Service History"}),e.jsx("div",{className:"space-y-4",children:ue.schedules.map(s=>e.jsxs("div",{className:"relative pl-6 border-l-2 border-muted pb-6 last:pb-0",children:[e.jsx("div",{className:"absolute -left-[9px] top-0 h-4 w-4 rounded-full border-2 border-background "+("completed"===s.status?"bg-green-500":"cancelled"===s.status?"bg-red-500":"in_progress"===s.status?"bg-blue-500":"bg-purple-500")}),e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4 border",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium",children:s.addon.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(b,{className:Ke(s.status),variant:"secondary",children:s.status.replace("_"," ")}),e.jsx(b,{className:es(s.priority),variant:"outline",children:s.priority})]})]}),e.jsxs("div",{className:"flex gap-2",children:[ae&&e.jsx(y,{size:"sm",variant:"ghost",onClick:()=>qe(s),children:"Manage"}),!ae&&te&&e.jsx(y,{size:"sm",variant:"ghost",onClick:()=>qe(s),children:"Update"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-muted-foreground mb-3",children:[s.scheduledDate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{children:new Date(s.scheduledDate).toLocaleString()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-4 w-4"}),e.jsxs("span",{children:["Created: ",new Date(s.createdAt).toLocaleDateString()]})]})]}),s.notes&&s.notes.length>0&&e.jsxs("div",{className:"bg-background rounded p-3 text-sm border",children:[e.jsx("p",{className:"font-medium text-xs uppercase text-muted-foreground mb-2",children:"Latest Note"}),e.jsx("p",{className:"mb-1",children:s.notes[s.notes.length-1].message}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["â€” ",s.notes[s.notes.length-1].author?.profile?.firstName||"Unknown",", ",new Date(s.notes[s.notes.length-1].createdAt).toLocaleDateString()]})]})]})]},s._id))})]})]})})]})}),e.jsx(k,{open:pe,onOpenChange:je,children:e.jsxs(A,{className:"max-w-md",children:[e.jsxs(C,{children:[e.jsx(D,{children:"Schedule Service"}),e.jsxs(E,{children:["Set a date and time for the ",Ne?.name," service."]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Service Date & Time"}),e.jsx(v,{type:"datetime-local",value:Ae,onChange:e=>Ce(e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Priority"}),e.jsx(h,{value:Fe,onValueChange:e=>He(e),children:e.jsxs(g,{className:"grid grid-cols-4",children:[e.jsx(p,{value:"low",children:"Low"}),e.jsx(p,{value:"medium",children:"Med"}),e.jsx(p,{value:"high",children:"High"}),e.jsx(p,{value:"urgent",children:"Urg"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Email Subject"}),e.jsx(v,{value:ye,onChange:e=>Se(e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Email Message"}),e.jsx(V,{value:we,onChange:e=>ke(e.target.value),rows:5})]})]}),e.jsxs(P,{children:[e.jsx(y,{variant:"outline",onClick:()=>je(!1),children:"Cancel"}),e.jsx(y,{onClick:async()=>{if(!ue||!Ne)return;if(!Ae)return void Z({title:"Error",description:"Please select a scheduled date for the service",variant:"destructive"});const e=ue.subscriptions.find(e=>e.addons.some(e=>e._id===Ne._id));if(e)try{Ee({...De,email:!0});const s=await r("/subadmin/addon-services/schedule",{method:"POST",body:JSON.stringify({vendorId:ue.user._id,addonId:Ne._id,subscriptionId:e._id,subject:ye,message:we,vendorEmail:ue.user.email,priority:Fe,scheduledDate:Ae})});await d(s);Z({title:"Success",description:"Service scheduled successfully and email sent to vendor"}),je(!1),be(null),Ce(""),Xe()}catch(s){Z({title:"Error",description:s.message||"Failed to schedule service",variant:"destructive"})}finally{Ee({...De,email:!1})}else Z({title:"Error",description:"No subscription found for this addon",variant:"destructive"})},disabled:De.email,children:De.email?"Sending...":"Schedule & Send Email"})]})]})}),e.jsx(k,{open:ve,onOpenChange:fe,children:e.jsxs(A,{className:"max-w-md",children:[e.jsxs(C,{children:[e.jsx(D,{children:"Update Service Status"}),e.jsx(E,{children:"Manage the status of this scheduled service."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Status"}),e.jsx(h,{value:Pe,onValueChange:Ie,children:e.jsxs(g,{className:"grid grid-cols-4",children:[e.jsx(p,{value:"scheduled",children:"Sched"}),e.jsx(p,{value:"in_progress",children:"Active"}),e.jsx(p,{value:"completed",children:"Done"}),e.jsx(p,{value:"cancelled",children:"Cancel"})]})})]}),"cancelled"===Pe&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Cancellation Reason"}),e.jsx(V,{value:Ue,onChange:e=>Me(e.target.value),placeholder:"Why is this service being cancelled?"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Add Note"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{value:ze,onChange:e=>Le(e.target.value),placeholder:"Add a note about this service..."}),e.jsx(y,{size:"sm",onClick:async()=>{if(ae){if(_e&&ze.trim())try{Ee({...De,note:!0});const e=await r(`/subadmin/addon-services/schedule/${_e._id}/notes`,{method:"POST",body:JSON.stringify({message:ze})}),s=await d(e);Z({title:"Success",description:"Note added successfully"}),Le(""),s.data?.schedule&&Ve(s.data.schedule),Xe()}catch(e){Z({title:"Error",description:e.message||"Failed to add note",variant:"destructive"})}finally{Ee({...De,note:!1})}}else Z({title:"Access Denied",description:"You don't have permission to add notes.",variant:"destructive"})},disabled:!ze.trim()||De.note,children:"Add"})]})]})]}),e.jsxs(P,{children:[e.jsx(y,{variant:"outline",onClick:()=>fe(!1),children:"Close"}),e.jsx(y,{onClick:async()=>{if(ae){if(_e)if("cancelled"!==Pe||Ue.trim())try{Ee({...De,status:!0});const e=await r(`/subadmin/addon-services/schedule/${_e._id}/status`,{method:"PATCH",body:JSON.stringify({status:Pe,scheduledDate:Oe||void 0,vendorResponse:Re||void 0,cancellationReason:"cancelled"===Pe?Ue:void 0})});await d(e),Z({title:"Success",description:"cancelled"===Pe?"Service cancelled successfully":"completed"===Pe?"Service marked as completed":"Schedule status updated successfully"}),fe(!1),Ve(null),Me(""),Xe()}catch(e){Z({title:"Error",description:e.message||"Failed to update schedule status",variant:"destructive"})}finally{Ee({...De,status:!1})}else Z({title:"Validation Error",description:"Please provide a cancellation reason",variant:"destructive"})}else Z({title:"Access Denied",description:"You don't have permission to update schedule status.",variant:"destructive"})},disabled:De.status,children:De.status?"Updating...":"Update Status"})]})]})})]})};export{G as default};

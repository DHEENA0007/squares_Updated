import{j as e}from"./ui-BHyUY8Z8.js";import{r as t}from"./router-2SVJvIbS.js";import{W,aC as y,s as Y,v as G,w as X,x as Z,y as d,a as R,e as D,av as _,b as ee,c as se,B as j,z as b,M as ae,n as te,a9 as P,f as r,E as re,J as A,K as E,O as M,Q as F,R as O,ap as L,L as le,q as ie}from"./index-Bd1eLXM_.js";import{s as S}from"./subAdminService-BJfyyqUR.js";import"./vendor-Dazix4UH.js";const pe=()=>{const[g,V]=t.useState([]),[q,w]=t.useState(!0),[c,z]=t.useState("open"),[l,C]=t.useState(1),[f,B]=t.useState(1),[a,N]=t.useState(null),[$,o]=t.useState(!1),[H,m]=t.useState(!1),[p,v]=t.useState(""),[u,x]=t.useState(!1),{toast:i}=W();t.useEffect(()=>{n()},[l,c]);const n=async()=>{try{w(!0);const s=await S.getSupportTickets(l,10,c);V(s.tickets),B(s.totalPages)}catch(s){i({title:"Error",description:s.message||"Failed to fetch support tickets",variant:"destructive"})}finally{w(!1)}};y("support_ticket_created",s=>{i({title:"New Support Ticket",description:"A new support ticket has been created"}),n()}),y("support_ticket_updated",s=>{n()}),y("message_received",s=>{s.type==="support"&&n()});const I=s=>{switch(s){case"open":return"destructive";case"in_progress":case"in-progress":return"default";case"resolved":return"secondary";case"closed":return"outline";default:return"outline"}},U=s=>{switch(s){case"urgent":return"destructive";case"high":return"destructive";case"medium":return"default";case"low":return"secondary";default:return"outline"}},J=s=>{N(s),o(!0)},k=s=>{N(s),m(!0)},K=async()=>{if(!a||!p.trim()){i({title:"Error",description:"Please enter a reply message",variant:"destructive"});return}try{x(!0),await S.updateSupportTicket(a._id,a.status,p),i({title:"Success",description:"Reply sent successfully"}),m(!1),v(""),N(null),n()}catch(s){i({title:"Error",description:s.message||"Failed to send reply",variant:"destructive"})}finally{x(!1)}},T=async(s,h)=>{try{x(!0),await S.updateSupportTicket(s,h,""),i({title:"Success",description:`Ticket marked as ${h.replace("_"," ")}`}),n()}catch(Q){i({title:"Error",description:Q.message||"Failed to update ticket status",variant:"destructive"})}finally{x(!1)}};return q&&g.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Support Tickets"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage customer support requests and complaints"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"},s))})]}):e.jsxs("div",{className:"p-6 space-y-6 mt-16",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Support Tickets"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage customer support requests and complaints"})]}),e.jsx("div",{className:"flex gap-4",children:e.jsxs(Y,{value:c,onValueChange:z,children:[e.jsx(G,{className:"w-48",children:e.jsx(X,{placeholder:"Filter by status"})}),e.jsxs(Z,{children:[e.jsx(d,{value:"open",children:"Open Tickets"}),e.jsx(d,{value:"in-progress",children:"In Progress"}),e.jsx(d,{value:"resolved",children:"Resolved"}),e.jsx(d,{value:"closed",children:"Closed"}),e.jsx(d,{value:"all",children:"All Tickets"})]})]})}),e.jsx("div",{className:"space-y-4",children:g.length===0?e.jsx(R,{children:e.jsxs(D,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(_,{className:"h-12 w-12 text-blue-500 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Support Tickets"}),e.jsx("p",{className:"text-muted-foreground text-center",children:c==="open"?"No open support tickets at the moment.":`No ${c} tickets found.`})]})}):g.map(s=>e.jsxs(R,{children:[e.jsx(ee,{children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(se,{className:"text-lg",children:[s.ticketNumber&&e.jsxs("span",{className:"text-muted-foreground mr-2",children:["#",s.ticketNumber]}),s.subject||"Support Request"]}),e.jsx(j,{variant:I(s.status),children:s.status.replace("_"," ")}),s.priority&&e.jsx(j,{variant:U(s.priority),children:s.priority}),s.category&&e.jsx(j,{variant:"outline",children:s.category})]}),e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"h-3 w-3"}),s.sender.profile.firstName," ",s.sender.profile.lastName]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"h-3 w-3"}),s.sender.email]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"h-3 w-3"}),new Date(s.createdAt).toLocaleDateString()]})]})})]})})}),e.jsxs(D,{className:"space-y-4",children:[e.jsx("div",{className:"bg-muted p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(P,{className:"h-4 w-4 mt-1 text-muted-foreground"}),e.jsx("p",{className:"text-sm leading-relaxed",children:s.message})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{size:"sm",variant:"outline",onClick:()=>J(s),children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"View Full Conversation"]}),e.jsxs(r,{size:"sm",onClick:()=>k(s),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Reply"]}),s.status==="open"&&e.jsx(r,{size:"sm",variant:"secondary",onClick:()=>T(s._id,"in-progress"),disabled:u,children:"Mark In Progress"}),s.status==="in-progress"&&e.jsx(r,{size:"sm",variant:"secondary",onClick:()=>T(s._id,"resolved"),disabled:u,children:"Mark Resolved"})]})]})]},s._id))}),f>1&&e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(r,{variant:"outline",disabled:l===1,onClick:()=>C(l-1),children:"Previous"}),e.jsxs("span",{className:"px-3 py-2 text-sm",children:["Page ",l," of ",f]}),e.jsx(r,{variant:"outline",disabled:l===f,onClick:()=>C(l+1),children:"Next"})]}),e.jsx(A,{open:$,onOpenChange:o,children:e.jsxs(E,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(M,{children:[e.jsxs(F,{children:[a?.ticketNumber&&`#${a.ticketNumber} - `,a?.subject||"Support Ticket"]}),e.jsxs(O,{children:["Conversation history with ",a?.sender.profile.firstName," ",a?.sender.profile.lastName]})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsxs("span",{className:"font-semibold text-sm",children:[a.sender.profile.firstName," ",a.sender.profile.lastName]})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(a.createdAt).toLocaleString()})]}),e.jsx("p",{className:"text-sm",children:a.message})]}),a.responses&&a.responses.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Responses"}),a.responses.map((s,h)=>e.jsxs("div",{className:`p-4 rounded-lg ${s.isAdmin?"bg-blue-50 dark:bg-blue-950":"bg-muted"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.isAdmin?e.jsx(_,{className:"h-4 w-4 text-blue-600"}):e.jsx(b,{className:"h-4 w-4"}),e.jsxs("span",{className:"font-semibold text-sm",children:[s.author,s.isAdmin&&e.jsx(j,{variant:"outline",className:"ml-2",children:"Support"})]})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleString()})]}),e.jsx("p",{className:"text-sm",children:s.message})]},h))]})]}),e.jsxs(L,{children:[e.jsx(r,{variant:"outline",onClick:()=>o(!1),children:"Close"}),e.jsx(r,{onClick:()=>{o(!1),a&&k(a)},children:"Reply to Ticket"})]})]})}),e.jsx(A,{open:H,onOpenChange:m,children:e.jsxs(E,{children:[e.jsxs(M,{children:[e.jsx(F,{children:"Reply to Support Ticket"}),e.jsxs(O,{children:["Send a response to ",a?.sender.profile.firstName," ",a?.sender.profile.lastName]})]}),e.jsxs("div",{className:"space-y-4",children:[a&&e.jsxs("div",{className:"bg-muted p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm font-semibold mb-1",children:"Original Message:"}),e.jsx("p",{className:"text-sm",children:a.message})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"reply",children:"Your Response"}),e.jsx(ie,{id:"reply",placeholder:"Type your response here...",value:p,onChange:s=>v(s.target.value),rows:6,className:"mt-2"})]})]}),e.jsxs(L,{children:[e.jsx(r,{variant:"outline",onClick:()=>{m(!1),v("")},children:"Cancel"}),e.jsx(r,{onClick:K,disabled:u||!p.trim(),children:u?"Sending...":"Send Reply"})]})]})})]})};export{pe as default};

import{j as e}from"./ui-BNZSgpjP.js";import{r as s}from"./router-D8v2YSKU.js";import{D as t,a2 as a,a as r,b as l,q as i,r as d,s as n,v as c,w as o,f as x,c as p,p as m,e as h,U as j,h as u,V as g,d as N,C as v,_ as f,R as y,i as b}from"./index-RW7CCy7D.js";import{s as w}from"./subAdminService-D3h16DsI.js";import{E as k,a as T}from"./jspdf.plugin.autotable-DIo-plB3.js";import{u as A,a as S}from"./xlsx-BjkOj9O8.js";import{D as P}from"./download-C-8zRh4U.js";import{T as D}from"./trending-up-BMvAL35N.js";import"./vendor-BxThA0WO.js";const R=t("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]),L=()=>{const{toast:t}=a(),[L,_]=s.useState(!0),[C,M]=s.useState("30days"),[F,$]=s.useState(null);s.useEffect(()=>{H()},[C]);const H=async()=>{try{_(!0);const e=await w.getDashboardStats();$(e)}catch(e){t({title:"Error",description:e.message||"Failed to fetch report data",variant:"destructive"})}finally{_(!1)}},Y=async e=>{try{t({title:"Exporting Report",description:`Preparing ${e.toUpperCase()} report...`});const s=await w.getExportData(C);if("csv"===e){const e=A.book_new();if(s.properties&&s.properties.length>0){const t=A.json_to_sheet(s.properties);A.book_append_sheet(e,t,"Properties")}if(s.tickets&&s.tickets.length>0){const t=A.json_to_sheet(s.tickets);A.book_append_sheet(e,t,"Support Tickets")}S(e,`subadmin_report_${C}_${(new Date).toISOString().split("T")[0]}.xlsx`)}else{const e=new k;e.setFontSize(18),e.text("Sub-Admin Activity Report",14,22),e.setFontSize(11),e.text(`Date Range: ${C}`,14,30),e.text(`Generated: ${(new Date).toLocaleDateString()}`,14,36);let t=45;s.properties&&s.properties.length>0&&(e.setFontSize(14),e.text("Approved Properties",14,t),t+=5,T(e,{startY:t,head:[["Title","Type","Price","Owner","Approved Date"]],body:s.properties.map(e=>[e.title,e.type,e.price,e.ownerName,new Date(e.approvedAt).toLocaleDateString()])}),t=e.lastAutoTable.finalY+15),s.tickets&&s.tickets.length>0&&(e.setFontSize(14),e.text("Support Tickets Handled",14,t),t+=5,T(e,{startY:t,head:[["Ticket #","Subject","Status","Priority","User","Updated"]],body:s.tickets.map(e=>[e.ticketNumber,e.subject,e.status,e.priority,e.userName,new Date(e.updatedAt).toLocaleDateString()])})),e.save(`subadmin_report_${C}_${(new Date).toISOString().split("T")[0]}.pdf`)}t({title:"Success",description:`Report exported as ${e.toUpperCase()}`})}catch(s){t({title:"Error",description:s.message||"Failed to export report",variant:"destructive"})}};return L?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Analytics & Reports"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Comprehensive insights into your moderation activities"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(s=>e.jsx(r,{children:e.jsxs(l,{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2 mt-2"})]})},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Analytics & Reports"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Comprehensive insights into your moderation activities"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(i,{value:C,onValueChange:e=>M(e),children:[e.jsx(d,{className:"w-[180px]",children:e.jsx(n,{placeholder:"Select time range"})}),e.jsxs(c,{children:[e.jsx(o,{value:"7days",children:"Last 7 Days"}),e.jsx(o,{value:"30days",children:"Last 30 Days"}),e.jsx(o,{value:"90days",children:"Last 90 Days"}),e.jsx(o,{value:"all",children:"All Time"})]})]}),e.jsxs(x,{variant:"outline",onClick:()=>Y("pdf"),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"PDF"]}),e.jsxs(x,{variant:"outline",onClick:()=>Y("csv"),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"CSV"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(r,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Total Properties Reviewed"}),e.jsx(m,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:F?.totalPropertiesApproved||0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:F?.analytics&&e.jsxs("span",{className:"text-green-600",children:["+",F.analytics.propertiesApprovedLast7Days," this week"]})})]})]}),e.jsxs(r,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Approval Rate"}),e.jsx(R,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[F?.totalPropertiesApproved>0?(F.availablePropertiesApproved/F.totalPropertiesApproved*100).toFixed(1):0,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Properties approved vs rejected"})]})]}),e.jsxs(r,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Support Tickets"}),e.jsx(j,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:F?.totalSupport||0}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[F?.closedSupport||0," closed, ",F?.openSupport||0," open"]})]})]}),e.jsxs(r,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Avg Response Time"}),e.jsx(u,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[F?.analytics?.avgResponseTimeHours||0,"h"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Average ticket resolution time"})]})]})]}),F?.analytics&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(r,{children:[e.jsxs(l,{children:[e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-5 w-5"}),"Property Review Performance"]}),e.jsx(N,{children:"Breakdown of your property moderation activities"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-green-50 dark:bg-green-950",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Approved Properties"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Available listings"})]})]}),e.jsx("p",{className:"text-2xl font-bold",children:F.availablePropertiesApproved})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-red-50 dark:bg-red-950",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(f,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Rejected Properties"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Not approved"})]})]}),e.jsx("p",{className:"text-2xl font-bold",children:F.rejectedPropertiesApproved})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-yellow-50 dark:bg-yellow-950",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{className:"h-5 w-5 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Pending Review"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Awaiting action"})]})]}),e.jsx("p",{className:"text-2xl font-bold",children:F.pendingProperties})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Time-based Analytics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-blue-50 dark:bg-blue-950",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 7 Days"}),e.jsx("p",{className:"text-xl font-bold",children:F.analytics.propertiesApprovedLast7Days})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-purple-50 dark:bg-purple-950",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 30 Days"}),e.jsx("p",{className:"text-xl font-bold",children:F.analytics.propertiesApprovedLast30Days})]})]})]})]})]}),e.jsxs(r,{children:[e.jsxs(l,{children:[e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),"Support Ticket Performance"]}),e.jsx(N,{children:"Your customer support metrics and trends"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-orange-50 dark:bg-orange-950",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{className:"h-5 w-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Open Tickets"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending response"})]})]}),e.jsx("p",{className:"text-2xl font-bold",children:F.openSupport})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-green-50 dark:bg-green-950",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Closed Tickets"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Successfully completed"})]})]}),e.jsx("p",{className:"text-2xl font-bold",children:F.closedSupport})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Resolution Analytics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-green-50 dark:bg-green-950",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Closed (7d)"}),e.jsx("p",{className:"text-xl font-bold",children:F.analytics.supportTicketsResolvedLast7Days})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-teal-50 dark:bg-teal-950",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Closed (30d)"}),e.jsx("p",{className:"text-xl font-bold",children:F.analytics.supportTicketsResolvedLast30Days})]})]})]})]})]})]}),F?.analytics&&e.jsxs(r,{children:[e.jsxs(l,{children:[e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Monthly Trends & Comparison"]}),e.jsx(N,{children:"Compare this month's performance with last month"})]}),e.jsx(h,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold",children:"Property Approvals"}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"This Month"}),e.jsx("p",{className:"text-3xl font-bold",children:F.analytics.propertiesApprovedThisMonth})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-1 text-lg font-semibold "+(F.analytics.propertyApprovalTrend>=0?"text-green-600":"text-red-600"),children:[F.analytics.propertyApprovalTrend>=0?e.jsx(D,{className:"h-5 w-5"}):e.jsx(D,{className:"h-5 w-5 rotate-180"}),e.jsxs("span",{children:[Math.abs(F.analytics.propertyApprovalTrend),"%"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"vs last month"})]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-muted",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Last Month"}),e.jsx("p",{className:"text-xl font-bold",children:F.analytics.propertiesApprovedLastMonth})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold",children:"Support Tickets"}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"This Month"}),e.jsx("p",{className:"text-3xl font-bold",children:F.analytics.supportTicketsThisMonth})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center gap-1 text-lg font-semibold "+(F.analytics.supportTicketTrend>=0?"text-green-600":"text-red-600"),children:[F.analytics.supportTicketTrend>=0?e.jsx(D,{className:"h-5 w-5"}):e.jsx(D,{className:"h-5 w-5 rotate-180"}),e.jsxs("span",{children:[Math.abs(F.analytics.supportTicketTrend),"%"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"vs last month"})]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-muted",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Last Month"}),e.jsx("p",{className:"text-xl font-bold",children:F.analytics.supportTicketsLastMonth})]})]})]})})]}),e.jsxs(r,{children:[e.jsxs(l,{children:[e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5"}),"Performance Insights"]}),e.jsx(N,{children:"Key insights and recommendations"})]}),e.jsx(h,{children:e.jsx("div",{className:"space-y-3",children:F?.analytics?e.jsxs(e.Fragment,{children:[F.analytics.propertyApprovalTrend>10&&e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-green-50 dark:bg-green-950",children:[e.jsx(D,{className:"h-5 w-5 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:"Excellent Property Review Performance"}),e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300",children:["You've increased your property approvals by ",F.analytics.propertyApprovalTrend,"% compared to last month. Keep up the great work!"]})]})]}),F.analytics.avgResponseTimeHours>0&&F.analytics.avgResponseTimeHours<24&&e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-blue-50 dark:bg-blue-950",children:[e.jsx(u,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:"Fast Response Time"}),e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:["Your average response time of ",F.analytics.avgResponseTimeHours,"h is excellent. Users appreciate quick responses!"]})]})]}),F.openSupport>10&&e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-yellow-50 dark:bg-yellow-950",children:[e.jsx(y,{className:"h-5 w-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-900 dark:text-yellow-100",children:"High Open Ticket Volume"}),e.jsxs("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:["You have ",F.openSupport," open tickets. Consider prioritizing ticket resolution to improve response times."]})]})]}),0===F.totalPropertiesApproved&&0===F.totalSupport&&e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-gray-50 dark:bg-gray-950",children:[e.jsx(b,{className:"h-5 w-5 text-gray-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:"Get Started"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Start reviewing properties and handling support tickets to build your performance metrics."})]})]}),F.totalPropertiesApproved>0&&F.analytics.propertyApprovalTrend<=10&&(0===F.analytics.avgResponseTimeHours||F.analytics.avgResponseTimeHours>=24)&&F.openSupport<=10&&e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-blue-50 dark:bg-blue-950",children:[e.jsx(y,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:"Steady Performance"}),e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:["You've reviewed ",F.totalPropertiesApproved," properties and handled ",F.totalSupport," support tickets.",F.analytics.propertiesApprovedThisMonth>0&&` This month: ${F.analytics.propertiesApprovedThisMonth} properties approved.`]})]})]})]}):e.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[e.jsx(b,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No performance data available yet"})]})})})]})]})};export{L as default};

import{j as e}from"./ui-BNZSgpjP.js";import{r as s,d as a}from"./router-D8v2YSKU.js";import{t,aL as r,Q as l,f as i,al as n,a as c,e as d,q as o,r as x,s as m,v as h,w as p,ap as j,aq as u,ar as f,aj as g}from"./index-C1UN0dDZ.js";import{T as N,a as v,b,c as w,d as y,e as S}from"./table-BZw2TPZ0.js";import{T as R}from"./trending-up-DfJHcky0.js";import{S as k}from"./square-pen-B-q-sx16.js";import"./vendor-BxThA0WO.js";const A=()=>{const[A,C]=s.useState(!0),[P,T]=s.useState(!1),[$,D]=s.useState([]),[E,F]=s.useState(null),[L,q]=s.useState(""),[z,U]=s.useState("all"),[B,I]=s.useState("all"),[V,_]=s.useState("newest"),[O,M]=s.useState([]),Q=a(),G="https://app.buildhomemartsquares.com/api",H=s.useCallback(async()=>{try{C(!0);const e=localStorage.getItem("token"),s=new URLSearchParams;"all"!==z&&s.append("rating",z),"all"!==B&&s.append("reviewType",B),L&&s.append("search",L),s.append("sortBy","newest"===V||"oldest"===V?"createdAt":"rating"),s.append("sortOrder","oldest"===V||"rating-low"===V?"asc":"desc");const a=await fetch(`${G}/vendors/reviews?${s.toString()}`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),r=await a.json();r.success?D(r.data.reviews||[]):t({title:"Error",description:r.message||"Failed to load reviews",variant:"destructive"})}catch(e){t({title:"Error",description:"Failed to load reviews. Please try again.",variant:"destructive"})}finally{C(!1)}},[G,z,B,L,V]),J=s.useCallback(async()=>{try{const e=await r.getVendorProperties();e.success&&M(e.data.properties)}catch(e){}},[]),K=s.useCallback(async()=>{try{const e=localStorage.getItem("token"),s=await fetch(`${G}/vendors/reviews/stats`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),a=await s.json();a.success&&F(a.data)}catch(e){}},[G]),W=s.useCallback(async()=>{T(!0),await Promise.all([H(),K(),J()]),T(!1)},[H,K,J]);s.useEffect(()=>{H(),K(),J()},[H,K,J]);const X=e=>{if(!e)return"N/A";const s=new Date(e);return isNaN(s.getTime())?"N/A":s.toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"})},Y=e=>{if(!e||0===e.length)return"/placeholder-property.jpg";const s=e.find(e=>e.isPrimary);return s?.url||e[0]?.url||"/placeholder-property.jpg"},Z=$;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(l,{className:"w-8 h-8 text-primary fill-primary"}),"Reviews & Ratings"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage customer feedback and maintain your reputation"})]}),e.jsxs(i,{variant:"outline",onClick:W,disabled:P,children:[e.jsx(n,{className:"w-4 h-4 mr-2 "+(P?"animate-spin":"")}),P?"Refreshing...":"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:E&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(c,{className:"bg-primary text-primary-foreground border-none shadow-md",children:e.jsxs(d,{className:"p-6 flex flex-col justify-between h-32",children:[e.jsx("p",{className:"text-sm font-medium opacity-90",children:"Total Reviews"}),e.jsx("p",{className:"text-4xl font-bold",children:E.totalReviews})]})}),e.jsx(c,{className:"bg-card border-border shadow-md",children:e.jsxs(d,{className:"p-6 flex flex-col justify-between h-32",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Average Rating"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-4xl font-bold text-foreground",children:E.averageRating.toFixed(1)}),e.jsx(l,{className:"w-6 h-6 fill-primary text-primary"})]})]})}),e.jsx(c,{className:"bg-card border-border shadow-md",children:e.jsxs(d,{className:"p-6 flex flex-col justify-between h-32",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Positive Reviews"}),e.jsx("p",{className:"text-4xl font-bold text-green-600",children:E.ratingDistribution[5]+E.ratingDistribution[4]})]})}),e.jsx(c,{className:"bg-card border-border shadow-md",children:e.jsxs(d,{className:"p-6 flex flex-col justify-between h-32",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Public Reviews"}),e.jsx("p",{className:"text-4xl font-bold text-foreground",children:$.filter(e=>e.isPublic).length})]})})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(c,{className:"h-full bg-secondary/30 dark:bg-muted/20 border-none shadow-inner min-h-[300px]",children:e.jsxs(d,{className:"p-4 h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Ratings List"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(o,{value:z,onValueChange:U,children:[e.jsx(x,{className:"w-[100px] h-8 text-xs bg-background",children:e.jsx(m,{placeholder:"Rating"})}),e.jsxs(h,{children:[e.jsx(p,{value:"all",children:"All"}),e.jsx(p,{value:"5",children:"5 Stars"}),e.jsx(p,{value:"4",children:"4 Stars"}),e.jsx(p,{value:"3",children:"3 Stars"}),e.jsx(p,{value:"2",children:"2 Stars"}),e.jsx(p,{value:"1",children:"1 Star"})]})]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 space-y-3 max-h-[400px] custom-scrollbar",children:!A&&Z.length>0?Z.map(s=>{return e.jsxs("div",{className:"bg-card p-3 rounded-lg shadow-sm border border-border",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{className:"w-8 h-8",children:[e.jsx(u,{src:s.client?.avatar}),e.jsx(f,{children:s.client?(a=s.client.name,a.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2)):"U"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.client?.name||"Anonymous"}),e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(a=>e.jsx(l,{className:"w-3 h-3 "+(a<=s.rating?"fill-primary text-primary":"text-muted")},a))})]})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:X(s.createdAt)})]}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:s.comment}),s.property&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2 truncate",children:["For: ",s.property.title]})]},s._id);var a}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsx("p",{children:"No reviews found"})})})]})})})]}),e.jsxs(c,{className:"border-none shadow-md overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b flex items-center justify-between bg-card",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Active Property"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Overview of your listed properties"})]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>J(),children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),"Filter"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(N,{children:[e.jsx(v,{children:e.jsxs(b,{className:"bg-muted/50 hover:bg-muted/50",children:[e.jsx(w,{className:"w-[300px]",children:"Property"}),e.jsx(w,{children:"Location"}),e.jsx(w,{children:"Contact"}),e.jsx(w,{children:"Date"}),e.jsx(w,{children:"Engagement"}),e.jsx(w,{children:"Price"}),e.jsx(w,{className:"text-right",children:"Action"})]})}),e.jsx(y,{children:O.length>0?O.map(s=>e.jsxs(b,{className:"hover:bg-muted/50",children:[e.jsx(S,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden bg-muted flex-shrink-0",children:e.jsx("img",{src:Y(s.images),alt:s.title,className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm truncate max-w-[200px]",children:s.title}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.bedrooms," beds • ",s.bathrooms," bath • ",s.area?.builtUp||s.area?.plot||0," ",s.area?.unit]})]})]})}),e.jsx(S,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:s.address.city}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.address.state})]})}),e.jsx(S,{children:e.jsx("div",{className:"text-sm",children:s.owner?.profile?.phone||"N/A"})}),e.jsx(S,{children:e.jsx("span",{className:"text-sm",children:X(s.createdAt)})}),e.jsx(S,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(R,{className:"w-3 h-3 text-green-500"}),e.jsxs("span",{children:[s.views||0," Views"]})]})}),e.jsx(S,{children:e.jsx("span",{className:"font-medium text-sm",children:r.formatPrice(s.price,s.listingType)})}),e.jsx(S,{className:"text-right",children:e.jsx(i,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>Q(`/vendor/properties/edit/${s._id}`),children:e.jsx(k,{className:"w-4 h-4 text-muted-foreground hover:text-primary"})})})]},s._id)):e.jsx(b,{children:e.jsx(S,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No active properties found"})})})]})})]})]})};export{A as default};

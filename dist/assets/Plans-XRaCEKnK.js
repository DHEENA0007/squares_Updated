import{j as e}from"./ui-s1SEoZIF.js";import{d as s,r as a}from"./router-D8v2YSKU.js";import{u as i,a2 as r,G as n,f as t,a9 as l,a as c,b as o,c as d,d as m,e as p,$ as x,I as h,Z as u,B as j}from"./index-CJkfZmVJ.js";import{u as f}from"./usePagination-1Z845fFX.js";import{P as g,a as v,b as N,c as b,d as P,e as y}from"./pagination-BnFw6TCs.js";import{p as C}from"./planService-CPSpmdfZ.js";import{D as w}from"./DataTable-BcTBbf73.js";import{P as A}from"./PriceRangeFilter-BvAW6v5j.js";import"./vendor-BxThA0WO.js";import"./ellipsis-DCXRa9jK.js";import"./table-CzkDMlQH.js";import"./square-pen-PwGlc3xO.js";import"./slider-B5chMXFl.js";const S=()=>{const S=s(),{user:k}=i(),{toast:M}=r(),D=k?.rolePermissions||[],E="admin"===k?.role||"superadmin"===k?.role,I=e=>D.includes(e),L=E||I(u.PLANS_READ),_=E||I(u.PLANS_CREATE),F=E||I(u.PLANS_EDIT),[T,R]=a.useState(""),[B,Y]=a.useState(""),[$,q]=a.useState(""),[G,K]=a.useState(""),[V,W]=a.useState(1e5),[Z,z]=a.useState([]),[H,J]=a.useState(!0);a.useEffect(()=>{L||(M({title:"Access Denied",description:"You don't have permission to view plans.",variant:"destructive"}),S("/rolebased"))},[L,S,M]),a.useEffect(()=>{(async()=>{try{const e=await C.getPlans({limit:1e3});if(e.success){z(e.data.plans);const s=Math.max(...e.data.plans.map(e=>e.price),0);W(s||1e5)}}catch(e){}finally{J(!1)}})()},[]);const O=a.useMemo(()=>Z.filter(e=>{const s=e.name.toLowerCase().includes(T.toLowerCase()),a=""===B||void 0!==e.billingCycleMonths&&e.billingCycleMonths===parseInt(B),i=""===$||e.price>=parseFloat($),r=""===G||e.price<=parseFloat(G);return s&&a&&i&&r}),[Z,T,B,$,G]),{paginatedItems:Q,currentPage:U,totalPages:X,goToPage:ee,nextPage:se,previousPage:ae}=f(O,10),ie=[{key:"name",label:"Plan Name",render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.description.substring(0,50),"..."]})]})},{key:"price",label:"Price",render:s=>e.jsx("span",{className:"font-semibold",children:C.formatPrice(s)})},{key:"features",label:"Features",render:s=>{const a=Array.isArray(s.features)?s.features.map(e=>"string"==typeof e?e:e.name):[];return e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,2).map((s,a)=>e.jsx(j,{variant:"secondary",className:"text-xs",children:s},a)),a.length>2&&e.jsxs(j,{variant:"secondary",className:"text-xs",children:["+",a.length-2]})]})}},{key:"subscriberCount",label:"Subscribers",render:s=>e.jsx("span",{className:"font-medium",children:s.subscriberCount||0})},{key:"isActive",label:"Status",render:s=>e.jsx(j,{variant:C.getPlanBadgeVariant(s),children:s.isActive?"Active":"Inactive"})}];return H?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(n,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading plans..."})]}):e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"dashboard-header-responsive",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"dashboard-title-responsive",children:"Plan Management"}),e.jsx("p",{className:"text-muted-foreground mt-1 md:mt-2 text-sm md:text-base",children:"Manage subscription plans and pricing"})]}),_&&e.jsxs(t,{onClick:()=>S("/admin/plans/create"),className:"w-full sm:w-auto",children:[e.jsx(l,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Create Plan"}),e.jsx("span",{className:"sm:hidden",children:"Create"})]})]}),e.jsxs(c,{children:[e.jsxs(o,{children:[e.jsx(d,{className:"text-lg md:text-xl",children:"All Plans"}),e.jsxs(m,{className:"text-sm md:text-base",children:[O.length," plan",1!==O.length?"s":""," found"]})]}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(x,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(h,{placeholder:"Search plans...",value:T,onChange:e=>R(e.target.value),className:"pl-10"})]}),e.jsx("div",{className:"flex-1",children:e.jsx(h,{placeholder:"Filter by months (e.g., 1, 12)",value:B,onChange:e=>Y(e.target.value)})})]})}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-2 lg:w-80",children:e.jsx(A,{minPrice:$,maxPrice:G,onMinPriceChange:q,onMaxPriceChange:K,maxPossiblePrice:V,currency:"INR"})})]}),e.jsx("div",{className:"table-responsive-wrapper",children:e.jsx(w,{columns:ie,data:Q.map(e=>({...e,id:e._id})),editPath:F?e=>`/admin/plans/edit/${e._id}`:void 0,hideDefaultActions:!F})}),X>1&&e.jsx("div",{className:"mt-4 md:mt-6",children:e.jsx(g,{children:e.jsxs(v,{className:"pagination-responsive",children:[e.jsx(N,{children:e.jsx(b,{onClick:ae,className:"pagination-button-responsive "+(1===U?"pointer-events-none opacity-50":"cursor-pointer")})}),Array.from({length:X},(e,s)=>s+1).map(s=>e.jsx(N,{children:e.jsx(P,{onClick:()=>ee(s),isActive:U===s,className:"pagination-button-responsive cursor-pointer",children:s})},s)),e.jsx(N,{children:e.jsx(y,{onClick:se,className:"pagination-button-responsive "+(U===X?"pointer-events-none opacity-50":"cursor-pointer")})})]})})})]})})]})]})};export{S as default};

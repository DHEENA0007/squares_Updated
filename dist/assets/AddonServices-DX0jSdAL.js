import{j as e}from"./ui-DHQhougw.js";import{r as s}from"./router-Bi51YGN-.js";import{$ as a,a as t,b as i,c as l,w as r,e as d,ap as n,G as c,I as o,a3 as m,a4 as x,a5 as h,aj as u,B as j,d as p,f as v,E as f,M as N,Q as g,R as b,V as y,W as w,Y as S,L as A,T as C,a0 as E}from"./index-BXXWUbfo.js";import{f as D,h as V}from"./apiUtils-CzxUIkbq.js";import{C as T}from"./calendar-DvgVTGqB.js";import"./vendor-eVk5PToZ.js";const $=()=>{const[$,k]=s.useState([]),[_,I]=s.useState(!0),[F,z]=s.useState(""),[M,O]=s.useState("active"),[L,U]=s.useState(null),[B,P]=s.useState(!1),[R,W]=s.useState(!1),[q,G]=s.useState(null),[H,J]=s.useState(""),[Q,Y]=s.useState(""),[K,X]=s.useState({}),{toast:Z}=a();s.useEffect(()=>{ee()},[M,F]);const ee=async()=>{try{I(!0);const e=await D(`/subadmin/addon-services?status=${M}&search=${F}`),s=await V(e);k(s.data.vendorAddons||[])}catch(e){Z({title:"Error",description:e.message||"Error fetching addon services",variant:"destructive"}),k([])}finally{I(!1)}},se=async e=>{G(e),J(`Schedule ${e.name} Service`),Y(`Dear Vendor,\n\nWe would like to schedule the ${e.name} service that you have purchased.\n\nPlease reply to this email with your preferred dates and times for the service.\n\nService Details:\n- Name: ${e.name}\n- Description: ${e.description}\n- Category: ${e.category.charAt(0).toUpperCase()+e.category.slice(1)}\n\nThank you!\n\nBest regards,\nAdmin Team`),W(!0)},ae=e=>{switch(e){case"photography":return"bg-blue-600";case"marketing":return"bg-green-600";case"technology":return"bg-purple-600";case"support":return"bg-orange-600";case"crm":return"bg-red-600";default:return"bg-gray-600"}},te=(e,s="INR")=>new Intl.NumberFormat("en-IN",{style:"currency",currency:s,maximumFractionDigits:0}).format(e);return _&&0===$.length?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Addon Services"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage vendor addon services and schedule appointments"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Addon Services"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"View vendors who have purchased addon services and schedule appointments"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(t,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Active Vendors"}),e.jsx(r,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:$.filter(e=>e.totalAddons>0).length})})]}),e.jsxs(t,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Total Addons"}),e.jsx(n,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:$.reduce((e,s)=>e+s.totalAddons,0)})})]}),e.jsxs(t,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Unique Services"}),e.jsx(n,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:new Set($.flatMap(e=>e.activeAddons.map(e=>e._id))).size})})]}),e.jsxs(t,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Categories"}),e.jsx(n,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:new Set($.flatMap(e=>e.activeAddons.map(e=>e.category))).size})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(o,{placeholder:"Search vendors...",value:F,onChange:e=>z(e.target.value),className:"pl-10"})]}),e.jsxs(m,{value:M,onValueChange:O,children:[e.jsxs(x,{children:[e.jsx(h,{value:"active",children:"Active Subscriptions"}),e.jsx(h,{value:"expired",children:"Expired"}),e.jsx(h,{value:"all",children:"All Vendors"})]}),e.jsx(u,{value:M,className:"space-y-4 mt-6",children:0===$.length?e.jsx(t,{children:e.jsxs(d,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(n,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Addon Services Found"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"active"===M?"No vendors with active addon subscriptions":`No vendors with ${M} addon subscriptions`})]})}):$.map(s=>e.jsxs(t,{children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(l,{className:"text-lg",children:[s.user.profile.firstName," ",s.user.profile.lastName]}),e.jsxs(j,{variant:"outline",children:[s.totalAddons," Addon",1!==s.totalAddons?"s":""]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"text-sm",children:s.user.email}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.activeAddons.slice(0,3).map(s=>e.jsx(j,{className:ae(s.category),children:s.name},s._id)),s.activeAddons.length>3&&e.jsxs(j,{variant:"outline",children:["+",s.activeAddons.length-3," more"]})]})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Value"}),e.jsx("div",{className:"text-xl font-bold text-primary",children:te(s.activeAddons.reduce((e,s)=>e+s.price,0))})]})]})}),e.jsx(d,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>{U(s),P(!0)},children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"View Details"]}),e.jsxs(v,{size:"sm",onClick:()=>{U(s),1===s.activeAddons.length?se(s.activeAddons[0]):P(!0)},children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Schedule Service"]})]})})]},s._id))})]}),e.jsx(g,{open:B,onOpenChange:P,children:e.jsxs(b,{className:"max-w-3xl",children:[e.jsxs(y,{children:[e.jsx(w,{children:"Vendor Addon Services"}),e.jsx(S,{children:"Detailed information about vendor's purchased addon services"})]}),L&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Vendor Information"}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("p",{className:"font-medium",children:[L.user.profile.firstName," ",L.user.profile.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:L.user.email}),e.jsxs("p",{className:"text-sm mt-2",children:[e.jsx("strong",{children:"Total Addons:"})," ",L.totalAddons]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Active Addon Services"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:L.activeAddons.map(s=>e.jsxs(t,{className:"hover:shadow-md transition-shadow",children:[e.jsx(i,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{className:"text-sm",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(j,{className:ae(s.category),children:s.category}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.billingType.replace("_"," ")})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"font-bold text-primary",children:te(s.price,s.currency)})})]})}),e.jsxs(d,{className:"pt-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:s.description}),e.jsxs(v,{size:"sm",className:"w-full",onClick:()=>{P(!1),se(s)},children:[e.jsx(T,{className:"h-3 w-3 mr-2"}),"Schedule This Service"]})]})]},s._id))})]}),L.subscriptions.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Subscription History"}),e.jsx("div",{className:"space-y-2",children:L.subscriptions.map(s=>e.jsx("div",{className:"bg-muted p-3 rounded-lg text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium",children:["Status: ",e.jsx(j,{variant:"active"===s.status?"default":"secondary",children:s.status})]}),e.jsxs("span",{className:"text-muted-foreground",children:[new Date(s.startDate).toLocaleDateString()," - ",new Date(s.endDate).toLocaleDateString()]})]})},s._id))})]})]})]})}),e.jsx(g,{open:R,onOpenChange:W,children:e.jsxs(b,{className:"max-w-2xl",children:[e.jsxs(y,{children:[e.jsx(w,{children:"Schedule Addon Service"}),e.jsx(S,{children:"Send a scheduling email to the vendor for their purchased addon service"})]}),L&&q&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("p",{className:"font-medium",children:["Vendor: ",L.user.profile.firstName," ",L.user.profile.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:L.user.email}),e.jsxs("p",{className:"text-sm mt-1",children:[e.jsx("strong",{children:"Service:"})," ",q.name]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"subject",children:"Email Subject"}),e.jsx(o,{id:"subject",value:H,onChange:e=>J(e.target.value),placeholder:"Enter email subject"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"message",children:"Email Message"}),e.jsx(C,{id:"message",value:Q,onChange:e=>Y(e.target.value),placeholder:"Enter email message",rows:8})]})]}),e.jsxs(E,{children:[e.jsx(v,{variant:"outline",onClick:()=>W(!1),children:"Cancel"}),e.jsx(v,{onClick:async()=>{if(L&&q)try{X({...K,email:!0});const e=await D("/subadmin/addon-services/schedule",{method:"POST",body:JSON.stringify({vendorId:L.user._id,addonId:q._id,subject:H,message:Q,vendorEmail:L.user.email})});await V(e);Z({title:"Success",description:"Scheduling email sent successfully"}),W(!1),G(null)}catch(e){Z({title:"Error",description:"Failed to send scheduling email",variant:"destructive"})}finally{X({...K,email:!1})}},disabled:K.email||!H||!Q,children:K.email?"Sending...":"Send Email"})]})]})})]})};export{$ as default};

import{j as e}from"./ui-CEFKCYQo.js";import{r as s}from"./router-Bi51YGN-.js";import{a,b as r,c as i,n,e as t,C as l,E as c,o as d,Q as o,I as m,S as x,r as p,s as u,v as h,w as f,f as v,M as j,y as N,q as g,a2 as y,a3 as b,a4 as w,a5 as C,a6 as k,B as S,a7 as A,L as V,T as R,O as E,t as F}from"./index-Ds-LUfCl.js";import{C as T}from"./checkbox-DscVYI3N.js";import{f as M,h as I}from"./apiUtils-Bbv9G39a.js";import{D as P}from"./download-CY8u_MKP.js";import"./vendor-eVk5PToZ.js";const D=()=>{const[D,O]=s.useState([]),[B,_]=s.useState(null),[q,L]=s.useState(!0),[U,$]=s.useState(null),[J,z]=s.useState(!1),[G,H]=s.useState({status:"pending",search:"",businessType:"",experienceMin:"",experienceMax:"",page:1,limit:10}),[Q,K]=s.useState(null),[W,X]=s.useState(!1),[Y,Z]=s.useState("approve"),[ee,se]=s.useState(""),[ae,re]=s.useState({businessVerified:!1,documentsVerified:!1,licenseValid:!1,experienceConfirmed:!1,referencesChecked:!1,complianceVerified:!1}),[ie,ne]=s.useState(""),[te,le]=s.useState(""),ce=async()=>{try{const e=new URLSearchParams({page:G.page.toString(),limit:G.limit.toString(),status:G.status,search:G.search,businessType:G.businessType,experienceMin:G.experienceMin,experienceMax:G.experienceMax,sortBy:"submittedAt",sortOrder:"desc"}),s=await M(`/admin/vendor-approvals?${e}`),a=await I(s);O(a.data.vendors||[])}catch(e){F({title:"Error",description:e instanceof Error?e.message:"Failed to fetch vendor applications",variant:"destructive"}),O([])}},de=async()=>{try{const e=await M("/admin/vendor-approval-stats"),s=await I(e);_(s.data||null)}catch(e){F({title:"Error",description:e instanceof Error?e.message:"Failed to fetch statistics",variant:"destructive"}),_(null)}};s.useEffect(()=>{(async()=>{L(!0),await Promise.all([ce(),de()]),L(!1)})()},[G.status,G.page,G.search,G.businessType,G.experienceMin,G.experienceMax]);const oe=()=>{re({businessVerified:!1,documentsVerified:!1,licenseValid:!1,experienceConfirmed:!1,referencesChecked:!1,complianceVerified:!1}),ne(""),le(""),se("")},me=(e,s)=>{$(e),Z(s),oe(),X(!0)},xe=({status:s})=>{const a={pending:{variant:"secondary",icon:n},approved:{variant:"default",icon:l},rejected:{variant:"destructive",icon:E},under_review:{variant:"default",icon:c}},r=a[s]||a.pending,i=r.icon;return e.jsxs(S,{variant:r.variant,children:[e.jsx(i,{className:"w-3 h-3 mr-1"}),s.replace("_"," ")]})};return q?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col space-y-2 md:flex-row md:justify-between md:items-start md:space-y-0",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Vendor Applications"}),e.jsx("p",{className:"mt-1 md:mt-2 text-sm md:text-base text-muted-foreground",children:"Review and manage vendor applications"})]})}),B&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6",children:[e.jsxs(a,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-xs md:text-sm font-medium",children:"Pending"}),e.jsx(n,{className:"h-3 w-3 md:h-4 md:w-4 text-muted-foreground"})]}),e.jsx(t,{children:e.jsx("div",{className:"text-lg md:text-2xl font-bold",children:B.overview.pendingApplications})})]}),e.jsxs(a,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-xs md:text-sm font-medium",children:"Approved"}),e.jsx(l,{className:"h-3 w-3 md:h-4 md:w-4 text-muted-foreground"})]}),e.jsx(t,{children:e.jsx("div",{className:"text-lg md:text-2xl font-bold",children:B.overview.approvedApplications})})]}),e.jsxs(a,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-xs md:text-sm font-medium",children:"Under Review"}),e.jsx(c,{className:"h-3 w-3 md:h-4 md:w-4 text-muted-foreground"})]}),e.jsx(t,{children:e.jsx("div",{className:"text-lg md:text-2xl font-bold",children:B.overview.underReviewApplications})})]}),e.jsxs(a,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-xs md:text-sm font-medium",children:"Approval Rate"}),e.jsx(d,{className:"h-3 w-3 md:h-4 md:w-4 text-muted-foreground"})]}),e.jsx(t,{children:e.jsxs("div",{className:"text-lg md:text-2xl font-bold",children:[B.overview.approvalRate,"%"]})})]})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(o,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(m,{placeholder:"Search by company name, email, or license number...",value:G.search,onChange:e=>H({...G,search:e.target.value,page:1}),className:"pl-10"})]}),e.jsxs(x,{value:G.status,onValueChange:e=>H({...G,status:e,page:1}),children:[e.jsx(p,{className:"w-full sm:w-48",children:e.jsx(u,{placeholder:"Filter by status"})}),e.jsxs(h,{children:[e.jsx(f,{value:"all",children:"All Status"}),e.jsx(f,{value:"pending",children:"Pending"}),e.jsx(f,{value:"under_review",children:"Under Review"}),e.jsx(f,{value:"approved",children:"Approved"}),e.jsx(f,{value:"rejected",children:"Rejected"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs(x,{value:G.businessType||"all",onValueChange:e=>H({...G,businessType:"all"===e?"":e,page:1}),children:[e.jsx(p,{children:e.jsx(u,{placeholder:"Business Type"})}),e.jsxs(h,{children:[e.jsx(f,{value:"all",children:"All Types"}),e.jsx(f,{value:"Real Estate Agent",children:"Real Estate Agent"}),e.jsx(f,{value:"Property Developer",children:"Property Developer"}),e.jsx(f,{value:"Construction Company",children:"Construction Company"}),e.jsx(f,{value:"Interior Designer",children:"Interior Designer"}),e.jsx(f,{value:"Property Manager",children:"Property Manager"}),e.jsx(f,{value:"Legal Services",children:"Legal Services"}),e.jsx(f,{value:"Financial Services",children:"Financial Services"}),e.jsx(f,{value:"Other",children:"Other"})]})]}),e.jsx(m,{type:"number",placeholder:"Min Experience (years)",value:G.experienceMin,onChange:e=>H({...G,experienceMin:e.target.value,page:1})}),e.jsx(m,{type:"number",placeholder:"Max Experience (years)",value:G.experienceMax,onChange:e=>H({...G,experienceMax:e.target.value,page:1})})]})]}),e.jsx(a,{children:e.jsx(t,{className:"p-0",children:e.jsx("ul",{className:"divide-y divide-border",children:0===D.length?e.jsx("li",{className:"p-6 text-center text-muted-foreground",children:"No applications found matching your criteria"}):D.map(s=>{return e.jsx("li",{className:"p-4 md:p-6 hover:bg-muted/50",children:e.jsx("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-col space-y-3 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:items-center md:space-x-4 md:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base md:text-lg font-medium",children:s.businessInfo.companyName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.user?.profile?.firstName||"N/A"," ",s.user?.profile?.lastName||""]})]}),e.jsx(xe,{status:s.approval.status})]}),e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:items-center md:space-x-4 md:space-y-0",children:[e.jsxs("div",{className:"text-left md:text-right text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Submitted: ",(a=s.approval.submittedAt,new Date(a).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))]}),e.jsxs("p",{children:["Documents: ",s.approval.submittedDocuments.length]})]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>{$(s),z(!0)},className:"w-full md:w-auto",children:[e.jsx(c,{className:"h-4 w-4 mr-2"}),"Review"]})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4 text-sm text-muted-foreground",children:[s.user?.email&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.user.email})]}),s.user?.profile?.phone&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{children:s.user.profile.phone})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.businessInfo.businessType})]})]})]})})},s._id);var a})})})}),e.jsx(y,{open:J,onOpenChange:z,children:e.jsxs(b,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(w,{children:[e.jsx(C,{className:"text-lg md:text-xl",children:"Vendor Application Details"}),e.jsx(k,{children:"Review and take action on the vendor application."})]}),U&&e.jsxs("div",{className:"space-y-4 md:space-y-6 py-2 md:py-4",children:[e.jsxs(a,{children:[e.jsx(r,{children:e.jsx(i,{className:"text-base md:text-lg",children:"Basic Information"})}),e.jsx(t,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Company Name:"}),e.jsx("span",{className:"break-words",children:U.businessInfo.companyName})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Business Type:"}),e.jsx("span",{children:U.businessInfo.businessType})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Contact Person:"}),e.jsxs("span",{children:[U.user?.profile?.firstName||"N/A"," ",U.user?.profile?.lastName||""]})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Email:"}),e.jsx("span",{className:"break-all",children:U.user?.email||"N/A"})]}),U.businessInfo.licenseNumber&&e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"License Number:"}),e.jsx("span",{className:"break-all",children:U.businessInfo.licenseNumber})]}),U.businessInfo.gstNumber&&e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"GST Number:"}),e.jsx("span",{className:"break-all",children:U.businessInfo.gstNumber})]})]})})]}),e.jsxs(a,{children:[e.jsx(r,{children:e.jsx(i,{className:"text-base md:text-lg",children:"Submitted Documents"})}),e.jsx(t,{children:e.jsx("div",{className:"space-y-2",children:U.approval.submittedDocuments.map((s,a)=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between p-3 bg-muted/50 rounded-md gap-2 sm:gap-0",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx(d,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.documentName}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.documentType.replace("_"," ")})]})]}),e.jsxs("div",{className:"flex items-center justify-between sm:justify-end space-x-2 sm:flex-shrink-0",children:[s.verified?e.jsx(S,{variant:"default",className:"text-xs",children:"Verified"}):e.jsx(S,{variant:"secondary",className:"text-xs",children:"Pending"}),e.jsx("a",{href:s.documentUrl,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline p-1",children:e.jsx(P,{className:"h-4 w-4"})})]})]},a))})})]})]}),e.jsxs(A,{className:"flex flex-col-reverse sm:flex-row gap-2 sm:gap-0",children:[e.jsx(v,{variant:"outline",onClick:()=>z(!1),className:"w-full sm:w-auto",children:"Close"}),"pending"===U?.approval.status&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:space-x-4 w-full sm:w-auto",children:[e.jsx(v,{onClick:()=>{z(!1),me(U,"reject")},disabled:"reject"===Q,variant:"destructive",className:"w-full sm:w-auto",children:"Reject"}),e.jsx(v,{onClick:()=>{z(!1),me(U,"approve")},disabled:"approve"===Q,variant:"default",className:"w-full sm:w-auto",children:"Approve"})]})]})]})}),e.jsx(y,{open:W,onOpenChange:X,children:e.jsxs(b,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(w,{children:[e.jsx(C,{children:"approve"===Y?"Approve Vendor Application":"Reject Vendor Application"}),e.jsx(k,{children:"approve"===Y?`Complete the verification checklist and provide your approval for ${U?.businessInfo.companyName}.`:`Complete the form and provide a reason for rejecting ${U?.businessInfo.companyName}. The vendor will be notified.`})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"approver-name-vendor",children:"Approver Name *"}),e.jsx(m,{id:"approver-name-vendor",placeholder:"Enter your full name",value:ee,onChange:e=>se(e.target.value),className:"mt-1"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(V,{className:"text-base font-semibold",children:"approve"===Y?"Verification Checklist":"Issues Found (Check applicable items)"}),e.jsxs("div",{className:"space-y-3 border rounded-lg p-4 bg-muted/30",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(T,{id:"business",checked:ae.businessVerified,onCheckedChange:e=>re({...ae,businessVerified:e})}),e.jsx("label",{htmlFor:"business",className:"text-sm font-medium cursor-pointer",children:"approve"===Y?"Business information is verified and legitimate":"Business information is incomplete or invalid"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(T,{id:"documents-vendor",checked:ae.documentsVerified,onCheckedChange:e=>re({...ae,documentsVerified:e})}),e.jsx("label",{htmlFor:"documents-vendor",className:"text-sm font-medium cursor-pointer",children:"approve"===Y?"All required documents are submitted and verified":"Required documents are missing or invalid"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(T,{id:"license",checked:ae.licenseValid,onCheckedChange:e=>re({...ae,licenseValid:e})}),e.jsx("label",{htmlFor:"license",className:"text-sm font-medium cursor-pointer",children:"approve"===Y?"Business license/registration is valid":"Business license/registration is invalid or expired"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(T,{id:"experience",checked:ae.experienceConfirmed,onCheckedChange:e=>re({...ae,experienceConfirmed:e})}),e.jsx("label",{htmlFor:"experience",className:"text-sm font-medium cursor-pointer",children:"approve"===Y?"Professional experience is confirmed":"Professional experience cannot be verified"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(T,{id:"references",checked:ae.referencesChecked,onCheckedChange:e=>re({...ae,referencesChecked:e})}),e.jsx("label",{htmlFor:"references",className:"text-sm font-medium cursor-pointer",children:"approve"===Y?"References have been checked and validated":"References are insufficient or not verified"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(T,{id:"compliance",checked:ae.complianceVerified,onCheckedChange:e=>re({...ae,complianceVerified:e})}),e.jsx("label",{htmlFor:"compliance",className:"text-sm font-medium cursor-pointer",children:"approve"===Y?"Compliance requirements are met":"Compliance requirements are not met"})]})]})]}),"reject"===Y&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"rejection-reason-vendor",children:"Rejection Reason *"}),e.jsx(R,{id:"rejection-reason-vendor",placeholder:"Enter the detailed reason for rejection...",value:te,onChange:e=>le(e.target.value),className:"mt-1",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"handwritten-comments-vendor",children:"approve"===Y?"Approval Notes & Comments":"Additional Feedback"}),e.jsx(R,{id:"handwritten-comments-vendor",placeholder:"Type your handwritten comments or notes here...",value:ie,onChange:e=>ne(e.target.value),className:"mt-1 min-h-[120px] font-handwriting",rows:6}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"approve"===Y?"Add any additional observations, recommendations, or special notes":"Add any additional feedback or suggestions for the vendor"})]})]}),e.jsxs(A,{children:[e.jsx(v,{variant:"outline",onClick:()=>X(!1),children:"Cancel"}),"approve"===Y?e.jsx(v,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{if(U&&ee.trim()){K("approve");try{const e=await M(`/admin/vendor-approvals/${U._id}/approve`,{method:"POST",body:JSON.stringify({approvalNotes:ie,verificationLevel:"basic"})}),s=await I(e);if(!s.success)throw new Error(s.message||"Failed to approve vendor");F({title:"Success",description:"Vendor application approved successfully",variant:"default"}),ce(),de(),z(!1),X(!1),oe()}catch(e){F({title:"Error",description:e instanceof Error?e.message:"Failed to approve vendor application",variant:"destructive"})}finally{K(null)}}else F({title:"Error",description:"Approver name is required",variant:"destructive"})},disabled:!ee.trim()||"approve"===Q,children:"approve"===Q?"Approving...":"Approve Vendor"}):e.jsx(v,{variant:"destructive",onClick:async()=>{if(U&&te.trim()&&ee.trim()){K("reject");try{const e=await M(`/admin/vendor-approvals/${U._id}/reject`,{method:"POST",body:JSON.stringify({rejectionReason:te,allowResubmission:!0})}),s=await I(e);if(!s.success)throw new Error(s.message||"Failed to reject vendor");F({title:"Success",description:"Vendor application rejected and vendor notified",variant:"default"}),ce(),de(),z(!1),X(!1),oe()}catch(e){F({title:"Error",description:e instanceof Error?e.message:"Failed to reject vendor application",variant:"destructive"})}finally{K(null)}}else F({title:"Error",description:"Approver name and rejection reason are required",variant:"destructive"})},disabled:!te.trim()||!ee.trim()||"reject"===Q,children:"reject"===Q?"Rejecting...":"Reject Vendor"})]})]})})]})};export{D as default};

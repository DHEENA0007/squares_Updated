import{j as e}from"./ui-CEFKCYQo.js";import{r as s,L as t}from"./router-Bi51YGN-.js";import{a1 as a,z as r,aJ as i,f as l,a as n,b as c,c as d,d as o,e as m,L as x,I as h,Q as u,aj as p,ak as j,al as g,am as v,a5 as b,aK as N,aL as y,aM as k,B as f,aN as w,E as C,W as S,Y as T,Z as L,_ as A,$ as D,T as R,C as E,O,aO as Y,n as P}from"./index-DbnZmv1f.js";import{L as I}from"./log-in-DbCuhiIH.js";import{C as U}from"./circle-alert-DlwBmKIS.js";import"./vendor-eVk5PToZ.js";const V=()=>{const{toast:V}=a(),[F,q]=s.useState([]),[$,z]=s.useState(!1),[B,H]=s.useState("all"),[M,K]=s.useState(""),[_,J]=s.useState(""),[Q,W]=s.useState(""),[Z,G]=s.useState(null),[X,ee]=s.useState(!1),[se,te]=s.useState(!1),[ae,re]=s.useState(""),[ie,le]=s.useState(!1),[ne,ce]=s.useState(!1);s.useEffect(()=>{const e=r.getToken();ce(!!e),e&&de()},[B]);const de=async()=>{if(ne)try{z(!0);const e={};"all"!==B&&(e.status=B);const s=await i.getMyTickets(e);q(s.data.tickets)}catch(e){e.message?.includes("token")||e.message?.includes("401")||V({title:"Error",description:"Failed to fetch tickets",variant:"destructive"})}finally{z(!1)}else q([])},oe=e=>{const s={open:{icon:U,class:"bg-blue-600",label:"Open"},"in-progress":{icon:P,class:"bg-yellow-600",label:"In Progress"},resolved:{icon:E,class:"bg-green-600",label:"Resolved"},closed:{icon:O,class:"bg-gray-600",label:"Closed"}};return s[e]||s.open},me=e=>{const s={low:"bg-gray-100 text-gray-800",normal:"bg-blue-100 text-blue-800",medium:"bg-blue-100 text-blue-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"};return s[e]||s.normal},xe=e=>{const s={open:"Your ticket has been received and is waiting to be reviewed","in-progress":"Our support team is currently working on your ticket",resolved:"Your issue has been resolved. You can reopen if needed",closed:"This ticket has been closed and is archived"};return s[e]||s.open},he=e=>{const s={low:"Low priority - Response within 3-5 business days",normal:"Normal priority - Response within 1-2 business days",medium:"Normal priority - Response within 1-2 business days",high:"High priority - Response within 24 hours",urgent:"Urgent - Immediate attention required"};return s[e]||s.normal},ue=F.filter(e=>e.subject.toLowerCase().includes(M.toLowerCase())||e.ticketNumber.toLowerCase().includes(M.toLowerCase()));return e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Support & Help Desk"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track your support requests and get help"})]}),e.jsx(l,{onClick:()=>te(!0),children:"Create Support Ticket"})]}),!ne&&e.jsxs(n,{children:[e.jsxs(c,{children:[e.jsx(d,{children:"Track Ticket by Number"}),e.jsx(o,{children:"Enter your ticket number and email to view its status"})]}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"ticketNumber",children:"Ticket Number"}),e.jsx(h,{id:"ticketNumber",placeholder:"TKT-123456",value:_,onChange:e=>J(e.target.value.toUpperCase())})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"trackingEmail",children:"Email Address"}),e.jsx(h,{id:"trackingEmail",type:"email",placeholder:"your@email.com",value:Q,onChange:e=>W(e.target.value)})]})]}),e.jsxs(l,{onClick:async()=>{if(_.trim())if(Q.trim())try{const e=await i.getTicketByNumber(_,Q);G(e.data.ticket),ee(!0)}catch(e){}else V({title:"Validation Error",description:"Please enter your email address",variant:"destructive"});else V({title:"Validation Error",description:"Please enter a ticket number",variant:"destructive"})},className:"w-full md:w-auto",children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"Track Ticket"]})]})})]}),e.jsxs(n,{children:[e.jsxs(c,{children:[e.jsx(d,{children:"My Support Tickets"}),e.jsx(o,{children:ne?"View and manage your support requests":"Login to view your support tickets"})]}),e.jsx(m,{children:ne?$?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading tickets..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(u,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(h,{placeholder:"Search by ticket title or ticket ID...",value:M,onChange:e=>K(e.target.value),className:"pl-10"})]}),e.jsxs(p,{value:B,onValueChange:H,children:[e.jsxs(j,{children:[e.jsx(g,{value:"all",children:"All"}),e.jsx(g,{value:"open",children:"Open"}),e.jsx(g,{value:"in-progress",children:"In Progress"}),e.jsx(g,{value:"resolved",children:"Resolved"}),e.jsx(g,{value:"closed",children:"Closed"})]}),e.jsx(v,{value:B,className:"space-y-4 mt-4",children:0===ue.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(b,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Tickets Found"}),e.jsx("p",{className:"text-muted-foreground",children:"all"===B?"You haven't created any support tickets yet":`No ${B} tickets to display`})]}):ue.map(s=>{const t=oe(s.status),a=t.icon;return e.jsxs(n,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(c,{children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"text-lg",children:s.subject}),e.jsx(N,{children:e.jsxs(y,{children:[e.jsx(k,{children:e.jsxs(f,{className:t.class,children:[e.jsx(a,{className:"w-3 h-3 mr-1"}),t.label]})}),e.jsx(w,{children:e.jsx("p",{children:xe(s.status)})})]})}),e.jsx(N,{children:e.jsxs(y,{children:[e.jsx(k,{children:e.jsx(f,{className:me(s.priority),children:(r=s.priority,{low:"Low",normal:"Normal",medium:"Normal",high:"High",urgent:"Urgent"}[r]||"Normal")})}),e.jsx(w,{children:e.jsx("p",{children:he(s.priority)})})]})})]}),e.jsxs(o,{children:["Ticket #",s.ticketNumber," • Created: ",new Date(s.createdAt).toLocaleDateString()," • Updated: ",new Date(s.updatedAt).toLocaleDateString()]})]})})}),e.jsxs(m,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-2",children:s.description}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{G(s),ee(!0)},children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"View Details"]})]})]},s._id);var r})})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(I,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Authentication Required"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Please login to view and manage your support tickets"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(l,{asChild:!0,children:e.jsx(t,{to:"/login",children:"Login"})}),e.jsx(l,{variant:"outline",asChild:!0,children:e.jsx(t,{to:"/signup",children:"Create Account"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-6",children:'Already have a ticket? Use the "Track by Number" section above to check your ticket status.'})]})})]}),e.jsx(S,{open:X,onOpenChange:ee,children:e.jsxs(T,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(L,{children:[e.jsx(A,{children:"Ticket Details"}),e.jsxs(D,{children:["Ticket #",Z?.ticketNumber]})]}),Z&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Status"}),e.jsx("div",{className:"mt-1",children:e.jsx(f,{className:oe(Z.status).class,children:oe(Z.status).label})})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Priority"}),e.jsx("div",{className:"mt-1",children:e.jsx(f,{className:me(Z.priority),children:Z.priority.toUpperCase()})})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Category"}),e.jsx("p",{className:"text-sm mt-1 capitalize",children:Z.category})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Created"}),e.jsx("p",{className:"text-sm mt-1",children:new Date(Z.createdAt).toLocaleString()})]})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Subject"}),e.jsx("p",{className:"text-sm mt-1 font-semibold",children:Z.subject})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Description"}),e.jsx("p",{className:"text-sm mt-1 whitespace-pre-wrap",children:Z.description})]}),Z.responses&&Z.responses.length>0&&e.jsxs("div",{children:[e.jsx(x,{children:"Conversation"}),e.jsx("div",{className:"space-y-3 mt-2",children:Z.responses.map((s,t)=>e.jsxs("div",{className:"p-4 rounded-lg "+(s.isAdmin?"bg-blue-50 dark:bg-blue-950":"bg-muted"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm",children:s.author}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.isAdmin?"Support Team":"You"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleString()})]}),e.jsx("p",{className:"text-sm",children:s.message})]},t))})]}),"closed"!==Z.status&&"resolved"!==Z.status&&e.jsxs("div",{children:[e.jsx(x,{children:"Add Response"}),e.jsx(R,{placeholder:"Type your message...",value:ae,onChange:e=>re(e.target.value),rows:4,className:"mt-2"}),e.jsx("div",{className:"flex gap-2 mt-2",children:e.jsxs(l,{onClick:async()=>{if(Z&&ae.trim())try{le(!0),await i.addResponse(Z.ticketNumber,ae),re(""),V({title:"Success",description:"Your reply has been sent. Our support team will respond soon."});const e=await i.getTicketByNumber(Z.ticketNumber,Q||Z.email);G(e.data.ticket),ne&&de()}catch(e){}finally{le(!1)}else V({title:"Validation Error",description:"Please enter a message",variant:"destructive"})},disabled:ie,children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),ie?"Sending...":"Send Reply"]})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Our support team will review and respond to your message. Only support staff can resolve tickets."})]}),"resolved"===Z.status&&e.jsx("div",{className:"bg-green-50 dark:bg-green-950 border border-green-200 dark:border-green-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(E,{className:"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:"Ticket Resolved"}),e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300 mt-1",children:["This ticket has been marked as resolved by our support team.",Z.resolvedAt&&` on ${new Date(Z.resolvedAt).toLocaleDateString()}`]}),Z.responses&&Z.responses.length>0&&e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400 mt-2",children:"If you need further assistance, please create a new support ticket."})]})]})}),"closed"===Z.status&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(O,{className:"h-5 w-5 text-gray-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:"Ticket Closed"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mt-1",children:"This ticket has been closed. For new issues, please create a new support ticket."})]})]})})]})]})}),e.jsx(Y,{open:se,onOpenChange:te,onSuccess:e=>{V({title:"Ticket Created",description:`Your ticket number is ${e}. You can track it anytime.`}),de()}})]})};export{V as default};

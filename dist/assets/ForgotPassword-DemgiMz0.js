import{j as e}from"./ui-s1SEoZIF.js";import{d as s,r as t,L as a}from"./router-D8v2YSKU.js";import{N as r,a as i,e as n,L as o,M as l,I as d,f as c,A as m,E as u,F as p,t as x}from"./index-CJkfZmVJ.js";import{I as h,a as f,b as v}from"./input-otp-B1TdT9sA.js";import{L as j}from"./lock-BGPZvnBE.js";import{E as w}from"./eye-off-Fn7jj4AE.js";import{C as g}from"./circle-check-sv2qJ51i.js";import"./vendor-BxThA0WO.js";const y=()=>{const y=s(),[P,N]=t.useState("email"),[b,T]=t.useState(""),[E,S]=t.useState(""),[O,C]=t.useState(""),[k,R]=t.useState(""),[q,I]=t.useState(!1),[F,M]=t.useState(!1),[A,L]=t.useState(10),[D,Y]=t.useState(!1),[_,$]=t.useState(0);t.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"smooth"})},[P]),t.useEffect(()=>{if(_>0){const e=setTimeout(()=>{$(_-1)},1e3);return()=>clearTimeout(e)}Y(!0)},[_]);return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(r,{}),e.jsx("main",{className:"container mx-auto px-4 py-12",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold mb-2",children:["email"===P&&"Forgot Password","otp"===P&&"Reset Your Password","success"===P&&"Password Reset Successful"]}),e.jsxs("p",{className:"text-muted-foreground",children:["email"===P&&"Enter your email to receive a reset code","otp"===P&&"Enter the OTP sent to your email","success"===P&&"You can now login with your new password"]})]}),e.jsx(i,{children:e.jsxs(n,{className:"p-6",children:["email"===P&&e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!b)return void x({title:"Email Required",description:"Please enter your email address",variant:"destructive"});if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(b)){M(!0);try{const e=await fetch("https://app.buildhomemartsquares.com/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:b})}),s=await e.json();e.ok&&s.success?(N("otp"),s.expiryMinutes&&L(s.expiryMinutes),$(120),Y(!1),x({title:"OTP Sent!",description:"Check your email for the password reset code."})):404===e.status&&"EMAIL_NOT_REGISTERED"===s.error?x({title:"Email Not Registered",description:s.message||"This email is not registered. Please check your email or sign up for a new account.",variant:"destructive"}):429===e.status?x({title:"Too Many Requests",description:s.message||"Please wait before requesting another OTP",variant:"destructive"}):x({title:"Error",description:s.message||"Failed to send password reset code. Please try again.",variant:"destructive"})}catch(s){x({title:"Connection Error",description:"Failed to connect to the server. Please try again.",variant:"destructive"})}finally{M(!1)}}else x({title:"Invalid Email",description:"Please enter a valid email address",variant:"destructive"})},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"email",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(d,{id:"email",type:"email",placeholder:"you@example.com",value:b,onChange:e=>T(e.target.value),className:"pl-10",required:!0})]})]}),e.jsx(c,{type:"submit",className:"w-full",disabled:F,children:F?"Sending...":"Send Reset Code"}),e.jsx("div",{className:"text-center",children:e.jsxs(a,{to:"/login",className:"inline-flex items-center text-sm text-primary hover:underline",children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"Back to Login"]})})]}),"otp"===P&&e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!E||!O||!k)return void x({title:"All Fields Required",description:"Please fill in all fields",variant:"destructive"});if(6!==E.length)return void x({title:"Invalid OTP",description:"Please enter the complete 6-digit OTP",variant:"destructive"});if(O!==k)return void x({title:"Passwords Don't Match",description:"Please make sure your passwords match",variant:"destructive"});if(O.length<8)return void x({title:"Password Too Short",description:"Password must be at least 8 characters",variant:"destructive"});const s=/[A-Z]/.test(O),t=/[a-z]/.test(O),a=/[0-9]/.test(O),r=/[!@#$%^&*]/.test(O);if(s&&t&&a&&r){M(!0);try{const e=await fetch("https://app.buildhomemartsquares.com/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:b,otp:E,newPassword:O})}),s=await e.json();e.ok&&s.success?(N("success"),x({title:"Password Reset!",description:"Your password has been successfully reset."}),S(""),C(""),R("")):"OTP_EXPIRED"===s.error?(x({title:"OTP Expired",description:"Your OTP has expired. Please request a new one.",variant:"destructive"}),N("email")):"INVALID_OTP"===s.error?x({title:"Invalid OTP",description:s.attemptsLeft?`Invalid OTP. ${s.attemptsLeft} attempts remaining.`:"Invalid OTP. Please try again.",variant:"destructive"}):"MAX_ATTEMPTS_EXCEEDED"===s.error?(x({title:"Too Many Attempts",description:"Maximum attempts exceeded. Please request a new OTP.",variant:"destructive"}),N("email")):x({title:"Reset Failed",description:s.message||"Invalid OTP or password",variant:"destructive"})}catch(i){x({title:"Connection Error",description:"Failed to reset password. Please try again.",variant:"destructive"})}finally{M(!1)}}else x({title:"Weak Password",description:"Password must contain uppercase, lowercase, number, and special character (!@#$%^&*)",variant:"destructive"})},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(o,{className:"text-base",children:"Verification Code"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Enter the 6-digit code sent to ",b]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(h,{maxLength:6,value:E,onChange:e=>S(e),children:e.jsxs(f,{children:[e.jsx(v,{index:0}),e.jsx(v,{index:1}),e.jsx(v,{index:2}),e.jsx(v,{index:3}),e.jsx(v,{index:4}),e.jsx(v,{index:5})]})})}),e.jsxs("p",{className:"text-xs text-center text-muted-foreground",children:["Code expires in ",A," minutes"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"newPassword",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(d,{id:"newPassword",type:q?"text":"password",placeholder:"Enter new password",value:O,onChange:e=>C(e.target.value),className:"pl-10 pr-10",required:!0}),e.jsx("button",{type:"button",onClick:()=>I(!q),className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:q?e.jsx(w,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(u,{className:"h-5 w-5 text-muted-foreground"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Must be at least 8 characters with uppercase, lowercase, and numbers"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(d,{id:"confirmPassword",type:q?"text":"password",placeholder:"Confirm new password",value:k,onChange:e=>R(e.target.value),className:"pl-10",required:!0})]})]}),e.jsx(c,{type:"submit",className:"w-full",disabled:F,children:F?"Resetting...":"Reset Password"}),e.jsxs("div",{className:"text-center space-y-2",children:[D?e.jsx("button",{type:"button",onClick:async()=>{if(D){M(!0);try{const e=await fetch("https://app.buildhomemartsquares.com/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:b})}),s=await e.json();if(e.ok&&s.success)$(120),Y(!1),x({title:"OTP Resent!",description:"A new OTP has been sent to your email."});else if(429===e.status){const e=s.remainingSeconds||120;$(e),Y(!1),x({title:"Please Wait",description:`You can request a new OTP in ${e} seconds`,variant:"destructive"})}else x({title:"Error",description:s.message||"Failed to resend OTP",variant:"destructive"})}catch(e){x({title:"Connection Error",description:"Failed to resend OTP. Please try again.",variant:"destructive"})}finally{M(!1)}}},className:"text-sm text-primary hover:underline",disabled:F,children:"Didn't receive code? Resend OTP"}):e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Resend OTP in ",Math.floor(_/60),":",(_%60).toString().padStart(2,"0")]}),e.jsx("button",{type:"button",onClick:()=>{N("email"),S(""),C(""),R("")},className:"block w-full text-sm text-muted-foreground hover:text-primary",children:"Use a different email"})]})]}),"success"===P&&e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto",children:e.jsx(g,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Password Reset Successful!"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your password has been successfully changed. You can now sign in with your new password."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{onClick:()=>y("/login"),className:"w-full",children:"Go to Login"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["A confirmation email has been sent to ",b]})]})]})]})})]})}),e.jsx(p,{})]})};export{y as default};

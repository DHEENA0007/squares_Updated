import{j as e}from"./ui-s1SEoZIF.js";import{d as s,r as a}from"./router-D8v2YSKU.js";import{u as i,_ as r,x as n,f as t,a5 as l,a as c,b as o,c as d,d as m,e as p,X as x,I as h,V as u,B as j}from"./index-YrVmIx3a.js";import{u as f}from"./usePagination-1Z845fFX.js";import{P as g,a as v,b as N,c as b,d as P,e as y}from"./pagination-BsAF6nms.js";import{p as C}from"./planService-z4EWzAl8.js";import{D as w}from"./DataTable-zGMW-aZT.js";import{P as A}from"./PriceRangeFilter-u7Fqt9qb.js";import"./vendor-BxThA0WO.js";import"./ellipsis-XCtCMAGV.js";import"./table-BdC2txne.js";import"./square-pen-PCmihWrK.js";import"./slider-D_-wbR6w.js";const S=()=>{const S=s(),{user:k}=i(),{toast:M}=r(),_=k?.rolePermissions||[],D="admin"===k?.role||"superadmin"===k?.role,E=e=>_.includes(e),I=D||E(u.PLANS_READ),L=D||E(u.PLANS_CREATE),F=D||E(u.PLANS_EDIT),[T,R]=a.useState(""),[B,V]=a.useState(""),[Y,q]=a.useState(""),[K,W]=a.useState(""),[X,$]=a.useState(1e5),[z,G]=a.useState([]),[H,J]=a.useState(!0);a.useEffect(()=>{I||(M({title:"Access Denied",description:"You don't have permission to view plans.",variant:"destructive"}),S("/rolebased"))},[I,S,M]),a.useEffect(()=>{(async()=>{try{const e=await C.getPlans({limit:1e3});if(e.success){G(e.data.plans);const s=Math.max(...e.data.plans.map(e=>e.price),0);$(s||1e5)}}catch(e){}finally{J(!1)}})()},[]);const O=a.useMemo(()=>z.filter(e=>{const s=e.name.toLowerCase().includes(T.toLowerCase()),a=""===B||void 0!==e.billingCycleMonths&&e.billingCycleMonths===parseInt(B),i=""===Y||e.price>=parseFloat(Y),r=""===K||e.price<=parseFloat(K);return s&&a&&i&&r}),[z,T,B,Y,K]),{paginatedItems:Q,currentPage:U,totalPages:Z,goToPage:ee,nextPage:se,previousPage:ae}=f(O,10),ie=[{key:"name",label:"Plan Name",render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.description.substring(0,50),"..."]})]})},{key:"price",label:"Price",render:s=>e.jsx("span",{className:"font-semibold",children:C.formatPrice(s)})},{key:"features",label:"Features",render:s=>{const a=Array.isArray(s.features)?s.features.map(e=>"string"==typeof e?e:e.name):[];return e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,2).map((s,a)=>e.jsx(j,{variant:"secondary",className:"text-xs",children:s},a)),a.length>2&&e.jsxs(j,{variant:"secondary",className:"text-xs",children:["+",a.length-2]})]})}},{key:"subscriberCount",label:"Subscribers",render:s=>e.jsx("span",{className:"font-medium",children:s.subscriberCount||0})},{key:"isActive",label:"Status",render:s=>e.jsx(j,{variant:C.getPlanBadgeVariant(s),children:s.isActive?"Active":"Inactive"})}];return H?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(n,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading plans..."})]}):e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"dashboard-header-responsive",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"dashboard-title-responsive",children:"Plan Management"}),e.jsx("p",{className:"text-muted-foreground mt-1 md:mt-2 text-sm md:text-base",children:"Manage subscription plans and pricing"})]}),L&&e.jsxs(t,{onClick:()=>S("/admin/plans/create"),className:"w-full sm:w-auto",children:[e.jsx(l,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Create Plan"}),e.jsx("span",{className:"sm:hidden",children:"Create"})]})]}),e.jsxs(c,{children:[e.jsxs(o,{children:[e.jsx(d,{className:"text-lg md:text-xl",children:"All Plans"}),e.jsxs(m,{className:"text-sm md:text-base",children:[O.length," plan",1!==O.length?"s":""," found"]})]}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(x,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(h,{placeholder:"Search plans...",value:T,onChange:e=>R(e.target.value),className:"pl-10"})]}),e.jsx("div",{className:"flex-1",children:e.jsx(h,{placeholder:"Filter by months (e.g., 1, 12)",value:B,onChange:e=>V(e.target.value)})})]})}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-2 lg:w-80",children:e.jsx(A,{minPrice:Y,maxPrice:K,onMinPriceChange:q,onMaxPriceChange:W,maxPossiblePrice:X,currency:"INR"})})]}),e.jsx("div",{className:"table-responsive-wrapper",children:e.jsx(w,{columns:ie,data:Q.map(e=>({...e,id:e._id})),editPath:F?e=>`/admin/plans/edit/${e._id}`:void 0,hideDefaultActions:!F})}),Z>1&&e.jsx("div",{className:"mt-4 md:mt-6",children:e.jsx(g,{children:e.jsxs(v,{className:"pagination-responsive",children:[e.jsx(N,{children:e.jsx(b,{onClick:ae,className:"pagination-button-responsive "+(1===U?"pointer-events-none opacity-50":"cursor-pointer")})}),Array.from({length:Z},(e,s)=>s+1).map(s=>e.jsx(N,{children:e.jsx(P,{onClick:()=>ee(s),isActive:U===s,className:"pagination-button-responsive cursor-pointer",children:s})},s)),e.jsx(N,{children:e.jsx(y,{onClick:se,className:"pagination-button-responsive "+(U===Z?"pointer-events-none opacity-50":"cursor-pointer")})})]})})})]})})]})]})};export{S as default};

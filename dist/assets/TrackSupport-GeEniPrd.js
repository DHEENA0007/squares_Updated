import{j as e}from"./ui-BNZSgpjP.js";import{r as s,L as r}from"./router-D8v2YSKU.js";import{D as a,a2 as t,z as l,bU as i,f as d,a as o,b as c,c as n,$ as m,d as x,e as u,L as h,I as p,bV as g,af as b,ag as j,ah as f,ai as N,am as y,B as v,h as w,a4 as k,a5 as C,a7 as T,a8 as S,T as A,C as L,bW as D}from"./index-uSA-3vk3.js";import{A as z}from"./arrow-right-4xoSwhr-.js";import{L as E}from"./log-in-CTq4yGty.js";import{C as V}from"./circle-alert-CZ2NYBOE.js";import"./vendor-BxThA0WO.js";const M=a("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]),O=()=>{const{toast:a}=t(),[O,P]=s.useState([]),[$,I]=s.useState(!1),[Y,B]=s.useState("all"),[U,q]=s.useState(""),[F,H]=s.useState(""),[R,_]=s.useState(""),[K,W]=s.useState(null),[J,Z]=s.useState(!1),[G,Q]=s.useState(!1),[X,ee]=s.useState(""),[se,re]=s.useState(!1),[ae,te]=s.useState(!1);s.useEffect(()=>{const e=l.getToken();te(!!e),e&&le()},[Y]);const le=async()=>{if(ae)try{I(!0);const e={};"all"!==Y&&(e.status=Y);const s=await i.getMyTickets(e);P(s.data.tickets)}catch(e){e.message?.includes("token")||e.message?.includes("401")||a({title:"Error",description:"Failed to fetch tickets",variant:"destructive"})}finally{I(!1)}else P([])},ie=e=>{const s={open:{icon:V,class:"bg-primary/10 text-primary border-primary/20 hover:bg-primary/20",label:"Open"},in_progress:{icon:w,class:"bg-amber-100 text-amber-700 border-amber-200 hover:bg-amber-200",label:"In Progress"},closed:{icon:L,class:"bg-slate-100 text-slate-700 border-slate-200 hover:bg-slate-200",label:"Closed"}};return s[e]||s.open},de=e=>{const s={low:"bg-slate-100 text-slate-700 border-slate-200",normal:"bg-primary/10 text-primary border-primary/20",medium:"bg-primary/10 text-primary border-primary/20",high:"bg-orange-50 text-orange-700 border-orange-200",urgent:"bg-red-50 text-red-700 border-red-200"};return s[e]||s.normal},oe=e=>({low:"Low",normal:"Normal",medium:"Normal",high:"High",urgent:"Urgent"}[e]||"Normal"),ce=O.filter(e=>e.subject.toLowerCase().includes(U.toLowerCase())||e.ticketNumber.toLowerCase().includes(U.toLowerCase()));return e.jsxs("div",{className:"min-h-screen bg-background py-12 px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-6 bg-card/80 backdrop-blur-xl p-8 rounded-3xl border border-border/60 shadow-sm",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-4xl font-extrabold tracking-tight text-foreground",children:"Support Center"}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl",children:"Need help? Track your existing tickets or create a new one. We're here to assist you."})]}),e.jsxs(d,{onClick:()=>Q(!0),size:"lg",className:"bg-primary hover:bg-primary/90 text-primary-foreground shadow-lg shadow-primary/20 transition-all duration-300 hover:scale-105",children:[e.jsx(M,{className:"w-5 h-5 mr-2"}),"Create New Ticket"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-8",children:[!ae&&e.jsxs(o,{className:"border-0 shadow-xl bg-card/90 backdrop-blur-sm overflow-hidden",children:[e.jsx("div",{className:"h-2 bg-gradient-to-r from-primary to-accent"}),e.jsxs(c,{children:[e.jsxs(n,{className:"flex items-center gap-2 text-xl",children:[e.jsx(m,{className:"w-5 h-5 text-primary"}),"Track Ticket"]}),e.jsx(x,{children:"Check the status of your ticket without logging in"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"ticketNumber",children:"Ticket Number"}),e.jsx(p,{id:"ticketNumber",placeholder:"TKT-123456",value:F,onChange:e=>H(e.target.value.toUpperCase()),className:"bg-background border-input focus:ring-2 focus:ring-primary transition-all"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"trackingEmail",children:"Email Address"}),e.jsx(p,{id:"trackingEmail",type:"email",placeholder:"your@email.com",value:R,onChange:e=>_(e.target.value),className:"bg-background border-input focus:ring-2 focus:ring-primary transition-all"})]}),e.jsxs(d,{onClick:async()=>{if(F.trim())if(R.trim())try{const e=await i.getTicketByNumber(F,R);W(e.data.ticket),Z(!0)}catch(e){}else a({title:"Validation Error",description:"Please enter your email address",variant:"destructive"});else a({title:"Validation Error",description:"Please enter a ticket number",variant:"destructive"})},className:"w-full bg-foreground hover:bg-foreground/90 text-background transition-all",children:["Track Status ",e.jsx(z,{className:"w-4 h-4 ml-2"})]})]})]}),e.jsxs(o,{className:"border-0 shadow-lg bg-primary text-primary-foreground overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16 blur-2xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-black/10 rounded-full -ml-12 -mb-12 blur-xl"}),e.jsx(c,{children:e.jsxs(n,{className:"flex items-center gap-2 text-xl text-primary-foreground",children:[e.jsx(g,{className:"w-5 h-5"}),"Need Immediate Help?"]})}),e.jsxs(u,{className:"relative z-10 space-y-4",children:[e.jsx("p",{className:"text-primary-foreground/90",children:"Check our knowledge base for quick answers to common questions before creating a ticket."}),e.jsx(d,{variant:"secondary",className:"w-full bg-background text-foreground hover:bg-background/90 border-0",children:"Visit Knowledge Base"})]})]})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(o,{className:"border-0 shadow-xl bg-card/90 backdrop-blur-sm h-full",children:[e.jsx(c,{className:"border-b border-border pb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-2xl font-bold text-foreground",children:"My Tickets"}),e.jsx(x,{className:"mt-1",children:ae?"Manage and view your support history":"Login to access your full ticket history"})]}),ae&&e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(p,{placeholder:"Search tickets...",value:U,onChange:e=>q(e.target.value),className:"pl-10 bg-background border-input focus:ring-2 focus:ring-primary transition-all rounded-full"})]})]})}),e.jsx(u,{className:"p-6",children:ae?$?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading your tickets..."})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs(b,{value:Y,onValueChange:B,className:"w-full",children:[e.jsxs(j,{className:"w-full justify-start bg-muted p-1 rounded-xl mb-6 overflow-x-auto flex-nowrap",children:[e.jsx(f,{value:"all",className:"rounded-lg px-6 data-[state=active]:bg-card data-[state=active]:shadow-sm",children:"All"}),e.jsx(f,{value:"open",className:"rounded-lg px-6 data-[state=active]:bg-card data-[state=active]:shadow-sm",children:"Open"}),e.jsx(f,{value:"in_progress",className:"rounded-lg px-6 data-[state=active]:bg-card data-[state=active]:shadow-sm",children:"In Progress"}),e.jsx(f,{value:"closed",className:"rounded-lg px-6 data-[state=active]:bg-card data-[state=active]:shadow-sm",children:"Closed"})]}),e.jsx(N,{value:Y,className:"space-y-4 focus:outline-none",children:0===ce.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center border-2 border-dashed border-border rounded-2xl bg-muted/50",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mb-4",children:e.jsx(y,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"No Tickets Found"}),e.jsx("p",{className:"text-muted-foreground max-w-sm",children:"all"===Y?"You haven't created any support tickets yet. Need help? Create a new ticket.":`No ${Y.replace("_"," ")} tickets found in your history.`})]}):e.jsx("div",{className:"space-y-4",children:ce.map(s=>{const r=ie(s.status),a=r.icon;return e.jsx("div",{className:"group relative bg-card border border-border rounded-xl p-5 hover:shadow-md hover:border-primary/50 transition-all duration-200 cursor-pointer",onClick:()=>{W(s),Z(!0)},children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs(v,{variant:"outline",className:`${r.class} px-2.5 py-0.5 rounded-full font-medium border`,children:[e.jsx(a,{className:"w-3.5 h-3.5 mr-1.5"}),r.label]}),e.jsx(v,{variant:"outline",className:`${de(s.priority)} px-2.5 py-0.5 rounded-full font-medium border`,children:oe(s.priority)}),e.jsxs("span",{className:"text-xs text-muted-foreground font-mono",children:["#",s.ticketNumber]})]}),e.jsx("h4",{className:"text-lg font-semibold text-foreground truncate group-hover:text-primary transition-colors",children:s.subject}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-3.5 h-3.5"}),"Created ",new Date(s.createdAt).toLocaleDateString()]}),e.jsx("span",{className:"w-1 h-1 rounded-full bg-muted-foreground/30"}),e.jsxs("span",{children:["Updated ",new Date(s.updatedAt).toLocaleDateString()]})]})]}),e.jsx("div",{className:"self-center opacity-0 group-hover:opacity-100 transition-opacity -translate-x-2 group-hover:translate-x-0 duration-200",children:e.jsx(d,{size:"icon",variant:"ghost",className:"rounded-full",children:e.jsx(z,{className:"w-5 h-5 text-primary"})})})]})},s._id)})})})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center space-y-6",children:[e.jsx("div",{className:"w-20 h-20 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(E,{className:"h-10 w-10 text-primary"})}),e.jsxs("div",{className:"max-w-md space-y-2",children:[e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:"Authentication Required"}),e.jsx("p",{className:"text-muted-foreground",children:"Please login to view your support tickets and manage your conversations with our team."})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(d,{asChild:!0,size:"lg",className:"px-8 bg-primary text-primary-foreground hover:bg-primary/90",children:e.jsx(r,{to:"/login",children:"Login"})}),e.jsx(d,{variant:"outline",size:"lg",asChild:!0,className:"px-8",children:e.jsx(r,{to:"/signup",children:"Create Account"})})]})]})})]})})]})]}),e.jsx(k,{open:J,onOpenChange:Z,children:e.jsxs(C,{className:"max-w-4xl max-h-[90vh] overflow-y-auto p-0 gap-0 bg-card rounded-2xl overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-border bg-muted/30",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(M,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx(T,{className:"text-xl font-bold text-foreground",children:"Ticket Details"}),e.jsxs(S,{className:"text-muted-foreground",children:["Reference #",K?.ticketNumber]})]})]}),K&&e.jsx(v,{className:`${ie(K.status).class} px-3 py-1 text-sm`,children:ie(K.status).label})]})}),e.jsx("div",{className:"p-6",children:K&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-8",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:K.subject}),e.jsx("div",{className:"bg-muted/30 p-4 rounded-xl border border-border text-foreground text-sm leading-relaxed whitespace-pre-wrap",children:K.description})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h4",{className:"font-medium text-foreground flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4"}),"Conversation History"]})}),K.responses&&K.responses.length>0?e.jsx("div",{className:"space-y-4 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar",children:K.responses.map((s,r)=>e.jsx("div",{className:"flex "+(s.isAdmin?"justify-start":"justify-end"),children:e.jsxs("div",{className:"max-w-[85%] rounded-2xl p-4 "+(s.isAdmin?"bg-muted text-foreground rounded-tl-none":"bg-primary text-primary-foreground rounded-tr-none shadow-md shadow-primary/10"),children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-1",children:[e.jsx("span",{className:"text-xs font-medium "+(s.isAdmin?"text-muted-foreground":"text-primary-foreground/80"),children:s.isAdmin?"Support Agent":"You"}),e.jsx("span",{className:"text-xs "+(s.isAdmin?"text-muted-foreground":"text-primary-foreground/80"),children:new Date(s.createdAt).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsx("p",{className:"text-sm leading-relaxed",children:s.message})]})},r))}):e.jsx("div",{className:"text-center py-8 text-muted-foreground italic text-sm bg-muted/30 rounded-xl border border-dashed border-border",children:"No responses yet"})]}),"closed"!==K.status&&e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx(h,{className:"mb-2 block",children:"Reply to Ticket"}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{placeholder:"Type your message here...",value:X,onChange:e=>ee(e.target.value),rows:4,className:"resize-none bg-background border-input focus:ring-2 focus:ring-primary rounded-xl pr-12"}),e.jsx(d,{onClick:async()=>{if(K&&X.trim())try{if(re(!0),await i.addResponse(K.ticketNumber,X),ee(""),a({title:"Success",description:"Your reply has been sent. Our support team will respond soon."}),ae){const e=await i.getTicketByNumberAuth(K.ticketNumber);W(e.data.ticket),le()}else{const e=await i.getTicketByNumber(K.ticketNumber,R||K.email);W(e.data.ticket)}}catch(e){}finally{re(!1)}else a({title:"Validation Error",description:"Please enter a message",variant:"destructive"})},disabled:se||!X.trim(),size:"icon",className:"absolute bottom-3 right-3 h-8 w-8 rounded-lg bg-primary hover:bg-primary/90 text-primary-foreground transition-all",children:e.jsx(z,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Our support team typically responds within 24 hours."})]}),"closed"===K.status&&e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/20 border border-slate-100 dark:border-slate-900/30 rounded-xl p-4 flex items-start gap-3",children:[e.jsx(L,{className:"h-5 w-5 text-slate-600 dark:text-slate-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-slate-100",children:"Ticket Closed"}),e.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300 mt-1",children:["This ticket was closed on ",new Date(K.updatedAt).toLocaleDateString(),"."]})]})]})]})}),e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-muted/30 rounded-xl p-5 border border-border space-y-4",children:[e.jsx("h4",{className:"font-medium text-foreground text-sm uppercase tracking-wider",children:"Ticket Info"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground block mb-1",children:"Priority"}),e.jsx(v,{className:`${de(K.priority)} px-2.5 py-0.5`,children:oe(K.priority)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground block mb-1",children:"Category"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-foreground capitalize",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"}),K.category]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground block mb-1",children:"Created Date"}),e.jsx("p",{className:"text-sm font-medium text-foreground",children:new Date(K.createdAt).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground block mb-1",children:"Last Updated"}),e.jsx("p",{className:"text-sm font-medium text-foreground",children:new Date(K.updatedAt).toLocaleString()})]})]})]}),e.jsxs("div",{className:"bg-primary/5 rounded-xl p-5 border border-primary/10",children:[e.jsx("h4",{className:"font-medium text-primary text-sm mb-2",children:"Need more help?"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:"If this ticket is closed but you have a new issue, please create a new ticket."}),e.jsx(d,{variant:"outline",size:"sm",className:"w-full bg-background border-primary/20 text-primary hover:bg-primary/5",onClick:()=>{Z(!1),Q(!0)},children:"Open New Ticket"})]})]})]})})]})}),e.jsx(D,{open:G,onOpenChange:Q,onSuccess:e=>{a({title:"Ticket Created",description:`Your ticket number is ${e}. You can track it anytime.`}),le()}})]})};export{O as default};

import{j as e}from"./ui-BNZSgpjP.js";import{u as s,a2 as a,aC as r,z as t,G as n,a as l,b as i,c as d,O as o,e as c,h as x,U as m,C as p,_ as h,d as j,$ as u,I as v,q as g,r as f,s as N,v as w,w as b,f as y,E as A,B as R,Z as S}from"./index-Z2ZeqOLK.js";import{d as V,r as C}from"./router-D8v2YSKU.js";import{T as E,a as _,b as k,c as P,d as D,e as $}from"./table-CpGlDsC8.js";import"./vendor-BxThA0WO.js";const I="https://app.buildhomemartsquares.com/api",O=()=>{const{user:O}=s(),T=V(),{toast:U}=a(),B=O?.rolePermissions||[],[z,L]=C.useState(!0),[q,F]=C.useState({total:0,pending:0,approved:0,rejected:0,underReview:0}),[M,W]=C.useState([]),[G,Y]=C.useState(""),[Z,H]=C.useState("all"),J=r(G,500),K=e=>B.includes(e);C.useEffect(()=>{K(S.VENDORS_VIEW)?Q():T("/rolebased")},[B,J,Z]);const Q=async()=>{try{L(!0);await t.getCurrentUser();const e=localStorage.getItem("token"),s=await fetch(`${I}/admin/vendor-approval-stats`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(s.ok){const e=(await s.json()).data.overview;F({total:e.totalApplications||0,pending:e.pendingApplications||0,approved:e.approvedApplications||0,rejected:e.rejectedApplications||0,underReview:e.underReviewApplications||0})}const a=new URLSearchParams({limit:"50",status:Z,search:J}),r=await fetch(`${I}/admin/vendor-approvals?${a}`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(r.ok){const e=await r.json();W(e.data.vendors||[])}}catch(e){U({title:"Error",description:"Failed to load vendor data",variant:"destructive"})}finally{L(!1)}},X=s=>{const a={pending:{variant:"outline",label:"Pending"},under_review:{variant:"secondary",label:"Under Review"},approved:{variant:"default",label:"Approved"},rejected:{variant:"destructive",label:"Rejected"}},r=a[s]||a.pending;return e.jsx(R,{variant:r.variant,children:r.label})};return K(S.VENDORS_VIEW)?z?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(n,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading vendor data..."})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Vendor Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage vendor applications and approvals"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs(l,{className:"cursor-pointer transition-all duration-200 hover:shadow-lg hover:border-primary/50 "+("all"===Z?"border-primary ring-2 ring-primary/20":""),onClick:()=>H("all"),children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Total Applications"}),e.jsx(o,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:q.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total vendor applications"})]})]}),e.jsxs(l,{className:"cursor-pointer transition-all duration-200 hover:shadow-lg hover:border-yellow-500/50 "+("pending"===Z?"border-yellow-500 ring-2 ring-yellow-500/20":""),onClick:()=>H("pending"),children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Pending Approvals"}),e.jsx(x,{className:"h-4 w-4 text-yellow-600"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:q.pending}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Awaiting review"})]})]}),e.jsxs(l,{className:"cursor-pointer transition-all duration-200 hover:shadow-lg hover:border-blue-500/50 "+("under_review"===Z?"border-blue-500 ring-2 ring-blue-500/20":""),onClick:()=>H("under_review"),children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Under Review"}),e.jsx(m,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:q.underReview}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Being reviewed"})]})]}),e.jsxs(l,{className:"cursor-pointer transition-all duration-200 hover:shadow-lg hover:border-green-500/50 "+("approved"===Z?"border-green-500 ring-2 ring-green-500/20":""),onClick:()=>H("approved"),children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Approved Vendors"}),e.jsx(p,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:q.approved}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active vendors"})]})]}),e.jsxs(l,{className:"cursor-pointer transition-all duration-200 hover:shadow-lg hover:border-red-500/50 "+("rejected"===Z?"border-red-500 ring-2 ring-red-500/20":""),onClick:()=>H("rejected"),children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Rejected"}),e.jsx(h,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:q.rejected}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Declined applications"})]})]})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsx(d,{children:"Vendor Applications"}),e.jsx(j,{children:"View and manage vendor applications"})]}),e.jsxs(c,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(u,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(v,{placeholder:"Search vendors...",value:G,onChange:e=>Y(e.target.value),className:"pl-8"})]}),e.jsxs(g,{value:Z,onValueChange:H,children:[e.jsx(f,{className:"w-[180px]",children:e.jsx(N,{placeholder:"Filter by status"})}),e.jsxs(w,{children:[e.jsx(b,{value:"all",children:"All Status"}),e.jsx(b,{value:"pending",children:"Pending"}),e.jsx(b,{value:"approved",children:"Approved"}),e.jsx(b,{value:"rejected",children:"Rejected"}),e.jsx(b,{value:"under_review",children:"Under Review"})]})]})]}),0===M.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(o,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"No Vendor Applications"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"There are no vendor applications at the moment"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-4",children:["Your permissions: ",K(S.VENDORS_APPROVE)?"View & Approve":"View Only"]})]}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(E,{children:[e.jsx(_,{children:e.jsxs(k,{children:[e.jsx(P,{children:"S.no"}),e.jsx(P,{children:"Business Name"}),e.jsx(P,{children:"Contact Person"}),e.jsx(P,{children:"Email"}),e.jsx(P,{children:"Phone"}),e.jsx(P,{children:"Status"}),e.jsx(P,{children:"Submitted"}),e.jsx(P,{children:"Action"})]})}),e.jsx(D,{children:M.map((s,a)=>e.jsxs(k,{children:[e.jsx($,{children:a+1}),e.jsx($,{className:"font-medium",children:s.businessInfo?.companyName||"N/A"}),e.jsxs($,{children:[s.user?.profile?.firstName," ",s.user?.profile?.lastName]}),e.jsx($,{children:s.user?.email}),e.jsx($,{children:s.user?.profile?.phone||"N/A"}),e.jsx($,{children:X(s.approval?.status)}),e.jsx($,{children:new Date(s.approval?.submittedAt).toLocaleDateString()}),e.jsx($,{children:e.jsxs(y,{variant:"ghost",size:"sm",onClick:()=>T(`/rolebased/vendor-details?vendorId=${s._id}`),children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"View Details"]})})]},s._id))})]})})]})]})]}):null};export{O as default};

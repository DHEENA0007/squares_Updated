import{j as e}from"./ui-BNZSgpjP.js";import{d as t,r as s}from"./router-D8v2YSKU.js";import{z as a,t as r,f as n,A as i,a as l,b as o,c,e as d,$ as m,I as h,a0 as u}from"./index-FHRTVVMJ.js";import{E as g}from"./exportUtils-tXm36D7m.js";import{D as w}from"./download-DxaTuK19.js";import{U as x}from"./user-x-CrZk9SjR.js";import"./vendor-BxThA0WO.js";import"./xlsx-BjkOj9O8.js";const p=()=>{const p=t(),[f,N]=s.useState([]),[v,D]=s.useState([]),[A,j]=s.useState(!0),[U,y]=s.useState(""),[L,T]=s.useState({totalUsers:0,thisMonthUsers:0,activeUsers:0,vendorUsers:0,customerUsers:0});s.useEffect(()=>{S()},[]),s.useEffect(()=>{if(U){const e=f.filter(e=>e.email.toLowerCase().includes(U.toLowerCase())||`${e.profile.firstName} ${e.profile.lastName}`.toLowerCase().includes(U.toLowerCase())||e.role.toLowerCase().includes(U.toLowerCase()));D(e)}else D(f)},[U,f]);const S=async()=>{try{const e=a.getToken(),t=await fetch("https://app.buildhomemartsquares.com/api/users/all",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch users data");const s=await t.json();if(s.success){const e=s.data.users.filter(e=>!["admin","superadmin","subadmin"].includes(e.role));N(e),D(e);const t=new Date,a=new Date(t.getFullYear(),t.getMonth(),1),r=e.filter(e=>"customer"===e.role||"agent"===e.role),n=r.filter(e=>new Date(e.createdAt)>=a).length;T({totalUsers:r.length,thisMonthUsers:n,activeUsers:r.filter(e=>"active"===e.status).length,vendorUsers:e.filter(e=>"agent"===e.role).length,customerUsers:e.filter(e=>"customer"===e.role).length})}}catch(e){r({title:"Error",description:"Failed to load users data",variant:"destructive"})}finally{j(!1)}},C=e=>{switch(e){case"vendor":return"bg-blue-100 text-blue-800";case"customer":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return A?e.jsx("div",{className:"flex justify-center items-center py-12",children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(n,{variant:"ghost",onClick:()=>p("/admin/dashboard"),children:[e.jsx(i,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Users Details"}),e.jsx("p",{className:"text-muted-foreground",children:"Complete user list and statistics (excluding admins)"})]}),e.jsxs(n,{variant:"outline",onClick:()=>{try{if(0===f.length)return void r({title:"No Data",description:"No user data available to export",variant:"destructive"});const e=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),t=e=>e?new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}):"N/A",s=e=>e?new Date(e).toLocaleString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",a=f.filter(e=>"active"===e.status).length,n=f.filter(e=>"pending"===e.status).length,i=f.filter(e=>"suspended"===e.status).length,l=f.filter(e=>"inactive"===e.status).length,o=new Date;o.setDate(o.getDate()-30);const c=f.filter(e=>e.lastLogin&&new Date(e.lastLogin)>o),d=f.filter(e=>!e.lastLogin||new Date(e.lastLogin)<=o),m=new Date;m.setDate(m.getDate()-7);const h=f.filter(e=>new Date(e.createdAt)>m),u=[{Metric:"Total Users",Value:L.totalUsers,Details:"All non-admin users in the system"},{Metric:"New Users This Month",Value:L.thisMonthUsers,Details:"Registered in current month"},{Metric:"New Users This Week",Value:h.length,Details:"Registered in last 7 days"},{Metric:"Active Users",Value:L.activeUsers,Details:"Users with active status"},{Metric:"Pending Verification",Value:n,Details:"Awaiting email/phone verification"},{Metric:"Suspended Users",Value:i,Details:"Temporarily suspended accounts"},{Metric:"Inactive Users",Value:l,Details:"Deactivated accounts"},{Metric:"Vendors (Agents)",Value:L.vendorUsers,Details:"Property vendor accounts"},{Metric:"Customers",Value:L.customerUsers,Details:"Regular customer accounts"},{Metric:"Recently Active (30 days)",Value:c.length,Details:"Logged in within last 30 days"},{Metric:"Dormant Users",Value:d.length,Details:"No login in 30+ days"},{Metric:"Vendor Percentage",Value:`${L.totalUsers>0?(L.vendorUsers/L.totalUsers*100).toFixed(1):0}%`,Details:"Vendors vs total users"},{Metric:"Activity Rate",Value:`${f.length>0?(c.length/f.length*100).toFixed(1):0}%`,Details:"Recently active / Total"}],w=[{Role:"Vendor/Agent","Total Count":L.vendorUsers,Active:f.filter(e=>"agent"===e.role&&"active"===e.status).length,Inactive:f.filter(e=>"agent"===e.role&&"active"!==e.status).length,Percentage:`${L.totalUsers>0?(L.vendorUsers/L.totalUsers*100).toFixed(1):0}%`},{Role:"Customer","Total Count":L.customerUsers,Active:f.filter(e=>"customer"===e.role&&"active"===e.status).length,Inactive:f.filter(e=>"customer"===e.role&&"active"!==e.status).length,Percentage:`${L.totalUsers>0?(L.customerUsers/L.totalUsers*100).toFixed(1):0}%`}],x=[{Status:"Active",Count:a,Percentage:`${f.length>0?(a/f.length*100).toFixed(1):0}%`,Description:"Fully verified and active"},{Status:"Pending",Count:n,Percentage:`${f.length>0?(n/f.length*100).toFixed(1):0}%`,Description:"Awaiting verification"},{Status:"Suspended",Count:i,Percentage:`${f.length>0?(i/f.length*100).toFixed(1):0}%`,Description:"Temporarily disabled"},{Status:"Inactive",Count:l,Percentage:`${f.length>0?(l/f.length*100).toFixed(1):0}%`,Description:"Deactivated accounts"}],p={};f.forEach(e=>{if(e.createdAt){const t=new Date(e.createdAt),s=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`;p[s]||(p[s]={vendors:0,customers:0,total:0}),p[s].total+=1,"agent"===e.role&&(p[s].vendors+=1),"customer"===e.role&&(p[s].customers+=1)}});const N=Object.entries(p).sort((e,t)=>t[0].localeCompare(e[0])).slice(0,24).map(([e,t])=>({Month:e,"Total Registrations":t.total,"New Vendors":t.vendors,"New Customers":t.customers,"Vendor %":`${t.total>0?(t.vendors/t.total*100).toFixed(1):0}%`})),v=f.filter(e=>"agent"===e.role).sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()).map((e,a)=>{const r=Math.ceil((Date.now()-new Date(e.createdAt).getTime())/864e5),n=e.lastLogin?Math.ceil((Date.now()-new Date(e.lastLogin).getTime())/864e5):null;return{"#":a+1,"User ID":e._id,"First Name":e.profile.firstName||"N/A","Last Name":e.profile.lastName||"N/A","Full Name":`${e.profile.firstName||""} ${e.profile.lastName||""}`.trim()||"N/A",Email:e.email,Phone:e.profile.phone||"N/A",Role:"Vendor/Agent",Status:e.status.charAt(0).toUpperCase()+e.status.slice(1),"Registered On":t(e.createdAt),"Account Age (Days)":r,"Last Login":s(e.lastLogin||""),"Days Since Login":null!==n?n:"Never","Activity Status":null!==n&&n<=7?"Active":null!==n&&n<=30?"Moderate":"Dormant"}}),D=f.filter(e=>"customer"===e.role).sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()).map((e,a)=>{const r=Math.ceil((Date.now()-new Date(e.createdAt).getTime())/864e5),n=e.lastLogin?Math.ceil((Date.now()-new Date(e.lastLogin).getTime())/864e5):null;return{"#":a+1,"User ID":e._id,"First Name":e.profile.firstName||"N/A","Last Name":e.profile.lastName||"N/A","Full Name":`${e.profile.firstName||""} ${e.profile.lastName||""}`.trim()||"N/A",Email:e.email,Phone:e.profile.phone||"N/A",Role:"Customer",Status:e.status.charAt(0).toUpperCase()+e.status.slice(1),"Registered On":t(e.createdAt),"Account Age (Days)":r,"Last Login":s(e.lastLogin||""),"Days Since Login":null!==n?n:"Never","Activity Status":null!==n&&n<=7?"Active":null!==n&&n<=30?"Moderate":"Dormant"}}),A=f.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()).map((e,t)=>{const a=Math.ceil((Date.now()-new Date(e.createdAt).getTime())/864e5),r=e.lastLogin?Math.ceil((Date.now()-new Date(e.lastLogin).getTime())/864e5):null;return{"#":t+1,"User ID":e._id,"First Name":e.profile.firstName||"N/A","Last Name":e.profile.lastName||"N/A",Email:e.email,Phone:e.profile.phone||"N/A",Role:"agent"===e.role?"Vendor":e.role.charAt(0).toUpperCase()+e.role.slice(1),Status:e.status.charAt(0).toUpperCase()+e.status.slice(1),"Registered On":s(e.createdAt),"Account Age (Days)":a,"Last Login":s(e.lastLogin||""),"Days Since Login":null!==r?r:"Never","Activity Status":null!==r&&r<=7?"Active":null!==r&&r<=30?"Moderate":"Dormant"}}),j=f.filter(e=>new Date(e.createdAt)>o).sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()).map((e,t)=>({"#":t+1,"Full Name":`${e.profile.firstName||""} ${e.profile.lastName||""}`.trim()||"N/A",Email:e.email,Phone:e.profile.phone||"N/A",Role:"agent"===e.role?"Vendor":"Customer",Status:e.status.charAt(0).toUpperCase()+e.status.slice(1),"Registered On":s(e.createdAt),"Has Logged In":e.lastLogin?"Yes":"No"})),U=d.sort((e,t)=>(e.lastLogin?new Date(e.lastLogin).getTime():new Date(e.createdAt).getTime())-(t.lastLogin?new Date(t.lastLogin).getTime():new Date(t.createdAt).getTime())).map((e,s)=>{const a=e.lastLogin||e.createdAt,r=Math.ceil((Date.now()-new Date(a).getTime())/864e5);return{"#":s+1,"Full Name":`${e.profile.firstName||""} ${e.profile.lastName||""}`.trim()||"N/A",Email:e.email,Phone:e.profile.phone||"N/A",Role:"agent"===e.role?"Vendor":"Customer","Last Activity":t(a),"Days Inactive":r,"Re-engagement Priority":r>90?"High":r>60?"Medium":"Low"}}),y={filename:"users_comprehensive_report",title:"Comprehensive Users Analysis Report",metadata:{"Generated on":e,"Report Type":"Full User Analytics","Total Users":L.totalUsers.toString(),"Active Users":L.activeUsers.toString(),"Total Vendors":L.vendorUsers.toString(),"Total Customers":L.customerUsers.toString(),"Report Generated By":"Admin Dashboard"}},T=[{name:"Executive Summary",data:u,columns:[{wch:30},{wch:15},{wch:40}]},{name:"Role Analysis",data:w,columns:[{wch:20},{wch:12},{wch:10},{wch:10},{wch:12}]},{name:"Status Breakdown",data:x,columns:[{wch:15},{wch:10},{wch:12},{wch:30}]},{name:"Monthly Trends",data:N,columns:[{wch:12},{wch:18},{wch:12},{wch:15},{wch:12}]},{name:"Vendors Detail",data:v,columns:[{wch:5},{wch:25},{wch:15},{wch:15},{wch:25},{wch:30},{wch:15},{wch:12},{wch:10},{wch:15},{wch:12},{wch:20},{wch:15},{wch:12}]},{name:"Customers Detail",data:D,columns:[{wch:5},{wch:25},{wch:15},{wch:15},{wch:25},{wch:30},{wch:15},{wch:12},{wch:10},{wch:15},{wch:12},{wch:20},{wch:15},{wch:12}]},{name:"Recent Registrations",data:j,columns:[{wch:5},{wch:25},{wch:30},{wch:15},{wch:10},{wch:10},{wch:20},{wch:12}]},{name:"Dormant Users",data:U,columns:[{wch:5},{wch:25},{wch:30},{wch:15},{wch:10},{wch:15},{wch:12},{wch:18}]},{name:"All Users",data:A,columns:[{wch:5},{wch:25},{wch:15},{wch:15},{wch:30},{wch:15},{wch:10},{wch:10},{wch:20},{wch:12},{wch:20},{wch:15},{wch:12}]}];g.generateExcelReport(y,T),r({title:"Export Successful",description:`Comprehensive users report with ${T.length} sheets has been downloaded`})}catch(e){r({title:"Export Failed",description:"Failed to export users report. Please try again.",variant:"destructive"})}},children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Export Users"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-5",children:[e.jsxs(l,{children:[e.jsx(o,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"Total Users"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:L.totalUsers})})]}),e.jsxs(l,{children:[e.jsx(o,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"This Month"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:L.thisMonthUsers})})]}),e.jsxs(l,{children:[e.jsx(o,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"Active Users"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:L.activeUsers})})]}),e.jsxs(l,{children:[e.jsx(o,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"Vendors"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:L.vendorUsers})})]}),e.jsxs(l,{children:[e.jsx(o,{className:"pb-2",children:e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"Customers"})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:L.customerUsers})})]})]}),e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(h,{placeholder:"Search users by name, email, or role...",value:U,onChange:e=>y(e.target.value),className:"pl-10"})]})}),e.jsxs(l,{children:[e.jsx(o,{children:e.jsxs(c,{children:["All Users (",v.length,")"]})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-3",children:0===v.length?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No users found"}):v.map(t=>{return e.jsx("div",{className:"border rounded-lg p-4 hover:bg-accent/50 transition",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 items-center",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsxs("p",{className:"font-medium",children:[t.profile.firstName," ",t.profile.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.email}),t.profile.phone&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t.profile.phone})]}),e.jsx("div",{children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${C(t.role)}`,children:t.role})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Joined"}),e.jsx("p",{className:"text-sm",children:(s=t.createdAt,new Date(s).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}))})]}),e.jsx("div",{className:"flex items-center gap-2",children:"active"===t.status?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-600",children:"Active"})]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-sm text-red-600",children:"Inactive"})]})})]})},t._id);var s})})})]})]})};export{p as default};

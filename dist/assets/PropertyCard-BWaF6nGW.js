import{j as e}from"./ui-s1SEoZIF.js";import{r as s,d as a}from"./router-D8v2YSKU.js";import{J as r,al as i,s as t,v as l,w as n,x as o,y as c,f as d,a6 as m,u as x,aC as p,a as h,b0 as u,B as j,a4 as v,e as g,i as f,aA as y,aB as b,b1 as N,aF as w,A as C}from"./index-l5vY_naC.js";import{a as L}from"./propertyUtils-41DuwCMc.js";import{P,a as _}from"./PropertyContactDialog-BzFOw6VD.js";import{E as S}from"./EnterprisePropertyContactDialog-hhee3N7V.js";import{vendorService as V}from"./vendorService-BlMcLpHe.js";import{f as T}from"./favoriteService-CGynaSz_.js";import{S as F}from"./square-DZVNA3pE.js";const k=({onFilterChange:a,initialFilters:x})=>{const[p,h]=s.useState({propertyType:void 0,bedrooms:void 0,minPrice:void 0,maxPrice:void 0,listingType:void 0}),[u,j]=s.useState([]),[v,g]=s.useState([]),[f,y]=s.useState([]),[b,N]=s.useState(!0);s.useEffect(()=>{(async()=>{try{N(!0);const[e,s]=await Promise.all([m.getAllPropertyTypes(!1),m.getFilterConfigurationsByType("listing_type",!1)]);j(e),y(s),g([{id:"20-40",name:"20-40L",displayLabel:"₹20L - ₹40L",minValue:2e6,maxValue:4e6},{id:"40-60",name:"40-60L",displayLabel:"₹40L - ₹60L",minValue:4e6,maxValue:6e6},{id:"60-80",name:"60-80L",displayLabel:"₹60L - ₹80L",minValue:6e6,maxValue:8e6},{id:"80-1cr",name:"80L-1Cr",displayLabel:"₹80L - ₹1Cr",minValue:8e6,maxValue:1e7},{id:"1cr+",name:"1Cr+",displayLabel:"₹1Cr+",minValue:1e7,maxValue:null}])}catch(e){}finally{N(!1)}})()},[]),s.useEffect(()=>{x&&h(x)},[x]);const w=(e,s)=>{const r={...p,[e]:"all"===s||"any"===s||"any-budget"===s?void 0:s};h(r),a(r)};return b?e.jsx("div",{className:"bg-card border border-border rounded-xl p-4 shadow-[var(--shadow-soft)]",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 py-2",children:[e.jsx(r,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{className:"text-muted-foreground",children:"Loading filters..."})]})}):e.jsx("div",{className:"bg-card border border-border rounded-xl p-4 shadow-[var(--shadow-soft)]",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(i,{className:"h-5 w-5"}),e.jsx("span",{children:"Filters:"})]}),e.jsxs(t,{value:p.listingType||"all",onValueChange:e=>w("listingType",e),disabled:b,children:[e.jsx(l,{className:"w-[150px]",children:e.jsx(n,{placeholder:b?"Loading...":"Listing Type"})}),e.jsxs(o,{children:[e.jsx(c,{value:"all",children:"All Types"}),f.map(s=>e.jsx(c,{value:s.value,children:s.displayLabel||s.name},s.id))]})]}),e.jsxs(t,{value:p.propertyType||"all",onValueChange:e=>w("propertyType",e),children:[e.jsx(l,{className:"w-[180px]",children:e.jsx(n,{placeholder:"Property Type"})}),e.jsxs(o,{children:[e.jsx(c,{value:"all",children:"All Properties"}),u.map(s=>e.jsx(c,{value:s.value,children:s.name},s.id))]})]}),e.jsxs(t,{value:p.bedrooms?.toString()||"any",onValueChange:e=>{const s="any"===e?void 0:parseInt(e);w("bedrooms",s&&!isNaN(s)?s:void 0)},children:[e.jsx(l,{className:"w-[150px]",children:e.jsx(n,{placeholder:"BHK"})}),e.jsxs(o,{children:[e.jsx(c,{value:"any",children:"Any BHK"}),e.jsx(c,{value:"1",children:"1 BHK"}),e.jsx(c,{value:"2",children:"2 BHK"}),e.jsx(c,{value:"3",children:"3 BHK"}),e.jsx(c,{value:"4",children:"4+ BHK"})]})]}),e.jsxs(t,{value:2e6===p.minPrice&&4e6===p.maxPrice?"20-40":4e6===p.minPrice&&6e6===p.maxPrice?"40-60":6e6===p.minPrice&&8e6===p.maxPrice?"60-80":8e6===p.minPrice&&1e7===p.maxPrice?"80-1cr":1e7!==p.minPrice||p.maxPrice?"any-budget":"1cr+",onValueChange:e=>{let s,r;switch(e){case"20-40":s=2e6,r=4e6;break;case"40-60":s=4e6,r=6e6;break;case"60-80":s=6e6,r=8e6;break;case"80-1cr":s=8e6,r=1e7;break;case"1cr+":s=1e7,r=void 0;break;default:s=void 0,r=void 0}const i={...p,minPrice:s,maxPrice:r};h(i),a(i)},children:[e.jsx(l,{className:"w-[180px]",children:e.jsx(n,{placeholder:"Budget"})}),e.jsxs(o,{children:[e.jsx(c,{value:"any-budget",children:"Any Budget"}),e.jsx(c,{value:"20-40",children:"₹20L - ₹40L"}),e.jsx(c,{value:"40-60",children:"₹40L - ₹60L"}),e.jsx(c,{value:"60-80",children:"₹60L - ₹80L"}),e.jsx(c,{value:"80-1cr",children:"₹80L - ₹1Cr"}),e.jsx(c,{value:"1cr+",children:"₹1Cr+"})]})]}),e.jsx(d,{variant:"secondary",className:"ml-auto",onClick:()=>{const e={propertyType:void 0,bedrooms:void 0,minPrice:void 0,maxPrice:void 0,listingType:void 0};h(e),a(e)},children:"Reset Filters"})]})})},B=({property:r})=>{const i=a(),{isAuthenticated:t,user:l,isVendor:n,isCustomer:o}=x(),[c,m]=s.useState(!1),[k,B]=s.useState(!1),[A,$]=s.useState(!1),[E,H]=s.useState(!1),[K,z]=s.useState(!0),[D,O]=s.useState(!1),[I,M]=s.useState(!1),R=p.getPrimaryImage(r),U=p.formatPrice(r.price,r.listingType),q=p.formatArea(r.area),J=r.address.district?`${r.address.city}, ${r.address.district}, ${r.address.state}`:`${r.address.city}, ${r.address.state}`;s.useEffect(()=>{(async()=>{if(r.vendor?._id||r.owner?._id)try{z(!0);const e=r.vendor?._id||r.owner?._id,s=await V.isVendorEnterpriseProperty(e);H(s)}catch(e){H(!1)}finally{z(!1)}else z(!1)})()},[r.vendor?._id,r.owner?._id]),s.useEffect(()=>{(async()=>{if(t&&o)try{const e=await T.isFavorite(r._id);O(e)}catch(e){}})()},[t,o,r._id]);return e.jsxs(h,{className:"group overflow-hidden hover:shadow-[var(--shadow-large)] transition-all duration-300",children:[e.jsxs("div",{className:"relative h-48 overflow-hidden",children:[e.jsx("img",{src:R,alt:r.title,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-300",onError:e=>{e.target.src=u}}),r.featured&&e.jsx(j,{className:"absolute top-3 left-3 bg-accent text-accent-foreground",children:"Featured"}),r.verified&&e.jsx(j,{className:"absolute top-3 left-3 mt-8 bg-green-500 text-white",children:"Verified"}),e.jsx(j,{className:`absolute top-3 ${t&&o?"right-12":"right-3"} ${"available"===r.status?"bg-green-500":"sold"===r.status?"bg-red-500":"rented"===r.status?"bg-blue-500":"bg-yellow-500"} text-white`,children:r.status.charAt(0).toUpperCase()+r.status.slice(1)}),t&&o&&e.jsx(d,{size:"icon",variant:"ghost",className:"absolute top-3 right-3 bg-background/80 backdrop-blur hover:bg-background "+(D?"text-red-500":""),onClick:async e=>{if(e.stopPropagation(),t){if(!I)try{M(!0),D?(await T.removeFromFavorites(r._id),O(!1)):(await T.addToFavorites(r._id),O(!0))}catch(s){}finally{M(!1)}}else i("/login",{state:{from:`/property/${r._id}`,action:"favorite"}})},disabled:I,children:e.jsx(v,{className:"h-5 w-5 "+(D?"fill-current":"")})})]}),e.jsxs(g,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg line-clamp-1",children:r.title}),e.jsx(j,{variant:"secondary",children:"sale"===r.listingType?"For Sale":"rent"===r.listingType?"For Rent":"For Lease"})]}),e.jsxs("div",{className:"flex items-center text-muted-foreground mb-2",children:[e.jsx(f,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-sm line-clamp-1",children:J})]}),e.jsx("div",{className:"text-xs text-muted-foreground mb-3 capitalize",children:r.type?r.type.replace("_"," "):"property"}),e.jsx("div",{className:"text-xs text-muted-foreground mb-3",children:L(r)}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[r.bedrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"h-4 w-4"}),e.jsxs("span",{children:[r.bedrooms," BHK"]})]}),r.bathrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsxs("span",{children:[r.bathrooms," Bath"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{children:q})]})]}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:U}),r.amenities.length>0&&e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[r.amenities.slice(0,3).map((s,a)=>e.jsx(j,{variant:"outline",className:"text-xs",children:s},a)),r.amenities.length>3&&e.jsxs(j,{variant:"outline",className:"text-xs",children:["+",r.amenities.length-3," more"]})]})]}),e.jsxs(N,{className:"p-4 pt-0 flex gap-2",children:[!K&&!E&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{variant:"outline",className:"flex-1",onClick:()=>{t?E?$(!0):m(!0):i("/login",{state:{from:`/property/${r._id}`,action:"message"}})},children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Message"]}),e.jsxs(d,{variant:"outline",className:"flex-1",onClick:()=>{t?E?$(!0):B(!0):i("/login",{state:{from:`/property/${r._id}`,action:"contact"}})},children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Contact"]})]}),!K&&E&&e.jsxs(d,{variant:"outline",className:"flex-1 bg-green-50 hover:bg-green-100 text-green-700 border-green-200",onClick:()=>$(!0),children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"WhatsApp Contact"]}),e.jsx(d,{className:"flex-1",onClick:()=>{t&&n&&(r.owner?._id===l?.id||r.vendor?._id===l?.id)?i(`/vendor/properties/details/${r._id}`):i(`/property/${r._id}`)},children:"View Details"})]}),e.jsx(P,{open:c,onOpenChange:m,property:r,onMessageSent:()=>{}}),e.jsx(_,{open:k,onOpenChange:B,property:r}),e.jsx(S,{open:A,onOpenChange:$,property:r})]})};export{k as P,B as a};

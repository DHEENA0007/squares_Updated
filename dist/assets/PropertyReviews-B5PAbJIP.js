import{j as e}from"./ui-CEFKCYQo.js";import{r as s}from"./router-Bi51YGN-.js";import{a1 as t,aD as r,Q as a,I as i,a as l,e as c,C as n,b as d,aE as o,c as m,d as x,h,x as p,B as j,f as u,E as g,O as f,W as v,Y as y,Z as N,_ as b,$ as w,T as $,a2 as P}from"./index-DbnZmv1f.js";import{f as S,h as C}from"./apiUtils-H5kZq7Df.js";import{V as k}from"./VirtualTourViewer-CATgOrGu.js";import{C as E}from"./calendar-BEL7L1vu.js";import"./vendor-eVk5PToZ.js";import"./external-link-BZvf9Mrd.js";const T=e=>{if(!e)return o;const s="object"==typeof e?e.url:e;if(!s||"string"!=typeof s)return o;if(s.startsWith("http://")||s.startsWith("https://"))return s;const t=s.startsWith("/api")?s.substring(4):s;return`${"https://api.buildhomemartsquares.com/api".replace("/api","")}${t}`},_=()=>{const[_,A]=s.useState([]),[O,R]=s.useState(!0),[V,D]=s.useState(""),[z,L]=s.useState(1),[W,B]=s.useState(1),[F,I]=s.useState(null),[U,G]=s.useState(!1),[Z,q]=s.useState(!1),[J,Q]=s.useState(""),[Y,H]=s.useState({}),{toast:K}=t();s.useEffect(()=>{M()},[z,V]);const M=async()=>{try{R(!0);const e=await S(`/subadmin/properties/pending?page=${z}&search=${V}`),s=await C(e);A(s.data.properties||[]),B(s.data.totalPages||1)}catch(e){K({title:"Error",description:e.message||"Error fetching properties",variant:"destructive"}),A([])}finally{R(!1)}};r("property_created",e=>{K({title:"New Property",description:"A new property has been submitted for review"}),M()}),r("property_updated",e=>{M()});const X=e=>`₹${e.toLocaleString("en-IN")}`;return O&&0===_.length?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Property Reviews"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Review and approve property listings"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Property Reviews"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Review and approve property listings"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(a,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(i,{placeholder:"Search properties by title or city...",value:V,onChange:e=>D(e.target.value),className:"pl-10"})]}),e.jsx("div",{className:"space-y-4",children:0===_.length?e.jsx(l,{children:e.jsxs(c,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(n,{className:"h-12 w-12 text-green-500 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Pending Properties"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"All properties have been reviewed. Great job!"})]})}):_.map(s=>e.jsxs(l,{className:"overflow-hidden",children:[e.jsx(d,{className:"pb-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[s.images&&s.images.length>0&&e.jsx("div",{className:"flex-shrink-0 mx-auto sm:mx-0",children:e.jsx("img",{src:T(s.images[0]),alt:s.title,className:"w-20 h-20 sm:w-24 sm:h-24 object-cover rounded-lg shadow-sm",onError:e=>{e.target.src=o}})}),e.jsxs("div",{className:"flex-1 space-y-2 text-center sm:text-left",children:[e.jsx(m,{className:"text-lg sm:text-xl leading-tight",children:s.title}),e.jsx(x,{className:"space-y-1",children:e.jsxs("div",{className:"flex flex-wrap justify-center sm:justify-start items-center gap-2 sm:gap-4 text-xs sm:text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(h,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.address.district?`${s.address.city}, ${s.address.district}, ${s.address.state}`:`${s.address.city}, ${s.address.state}`})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(E,{className:"h-3 w-3 flex-shrink-0"}),new Date(s.createdAt).toLocaleDateString()]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(p,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.owner.email})]})]})})]}),e.jsxs("div",{className:"text-center sm:text-right flex-shrink-0",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-primary",children:X(s.price)}),e.jsxs(j,{variant:"outline",className:"mt-1 text-xs",children:[s.type," • ",s.listingType]})]})]})}),e.jsx(c,{className:"pt-0",children:e.jsxs("div",{className:"flex flex-wrap justify-center sm:justify-start gap-2",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>{I(s),q(!0)},className:"flex-1 min-w-[120px] touch-manipulation",children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"View Details"]}),e.jsxs(u,{size:"sm",onClick:()=>(async e=>{try{H({...Y,[e]:!0});const s=await S(`/subadmin/properties/${e}/approve`,{method:"POST"});await C(s),K({title:"Success",description:"Property approved successfully"}),M()}catch(s){K({title:"Error",description:s.message||"Failed to approve property",variant:"destructive"})}finally{H({...Y,[e]:!1})}})(s._id),disabled:Y[s._id],className:"flex-1 min-w-[120px] bg-green-600 hover:bg-green-700 touch-manipulation",children:[e.jsx(n,{className:"h-4 w-4 mr-2"}),"Approve"]}),e.jsxs(u,{variant:"destructive",size:"sm",onClick:()=>{I(s),G(!0)},disabled:Y[s._id],className:"flex-1 min-w-[120px] touch-manipulation",children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"Reject"]})]})})]},s._id))}),W>1&&e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(u,{variant:"outline",disabled:1===z,onClick:()=>L(z-1),children:"Previous"}),e.jsxs("span",{className:"px-3 py-2 text-sm",children:["Page ",z," of ",W]}),e.jsx(u,{variant:"outline",disabled:z===W,onClick:()=>L(z+1),children:"Next"})]}),e.jsx(v,{open:U,onOpenChange:G,children:e.jsxs(y,{children:[e.jsxs(N,{children:[e.jsx(b,{children:"Reject Property"}),e.jsx(w,{children:"Please provide a reason for rejecting this property listing."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:F?.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:F?.address.district?`${F?.address.city}, ${F?.address.district}, ${F?.address.state}`:`${F?.address.city}, ${F?.address.state}`})]}),e.jsx($,{placeholder:"Enter rejection reason...",value:J,onChange:e=>Q(e.target.value),rows:4})]}),e.jsxs(P,{children:[e.jsx(u,{variant:"outline",onClick:()=>{G(!1),Q("")},children:"Cancel"}),e.jsx(u,{variant:"destructive",onClick:async()=>{if(F&&J.trim())try{H({...Y,[F._id]:!0});const e=await S(`/subadmin/properties/${F._id}/reject`,{method:"POST",body:JSON.stringify({reason:J})});await C(e),K({title:"Success",description:"Property rejected successfully"}),G(!1),Q(""),I(null),M()}catch(e){K({title:"Error",description:"Failed to reject property",variant:"destructive"})}finally{H({...Y,[F._id]:!1})}else K({title:"Error",description:"Please provide a rejection reason",variant:"destructive"})},disabled:!J.trim()||Y[F?._id||""],children:"Reject Property"})]})]})}),e.jsx(v,{open:Z,onOpenChange:q,children:e.jsxs(y,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(N,{children:[e.jsx(b,{children:F?.title}),e.jsx(w,{children:"Property details and information"})]}),F&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Property Details"}),e.jsxs("ul",{className:"text-sm space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Type:"})," ",F.type]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Listing Type:"})," ",F.listingType]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Price:"})," ",X(F.price)]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Area:"})," ",(ee=F.area,ee.builtUp?`${ee.builtUp} ${ee.unit}`:ee.plot?`${ee.plot} ${ee.unit}`:ee.carpet?`${ee.carpet} ${ee.unit}`:"N/A")]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bedrooms:"})," ",F.bedrooms]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bathrooms:"})," ",F.bathrooms]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Location & Contact"}),e.jsxs("ul",{className:"text-sm space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Address:"})," ",F.address.street]}),e.jsxs("li",{children:[e.jsx("strong",{children:"City:"})," ",F.address.city]}),e.jsxs("li",{children:[e.jsx("strong",{children:"State:"})," ",F.address.state]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Zip Code:"})," ",F.address.zipCode]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Owner:"})," ",F.owner.name]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Email:"})," ",F.owner.email]})]})]})]}),F.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Description"}),e.jsx("p",{className:"text-sm",children:F.description})]}),F.images&&F.images.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Images"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:F.images.map((s,t)=>e.jsx("img",{src:T(s),alt:`Property ${t+1}`,className:"w-full h-32 object-cover rounded",onError:e=>{e.target.src=o}},t))})]}),F.videos&&F.videos.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Videos"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:F.videos.map((s,t)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"relative aspect-video rounded-lg overflow-hidden border bg-black",children:s.url&&(s.url.includes("youtube.com")||s.url.includes("youtu.be"))?e.jsx("iframe",{src:s.url.replace("watch?v=","embed/").replace("youtu.be/","youtube.com/embed/"),className:"w-full h-full",allowFullScreen:!0,title:s.caption||`Video ${t+1}`}):e.jsx("video",{src:s.url,controls:!0,className:"w-full h-full object-contain",poster:s.thumbnail})}),s.caption&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.caption})]},t))})]}),F.virtualTour&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Virtual Tour"}),e.jsx(k,{url:F.virtualTour})]})]})]})})]});var ee};export{_ as default};

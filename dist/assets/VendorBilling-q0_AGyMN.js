import{j as e}from"./ui-DHQhougw.js";import{r as t}from"./router-Bi51YGN-.js";import{t as s,K as a,Q as i,R as r,V as n,W as l,Y as c,B as o,f as d,S as m,q as u,r as x,s as h,v as p,a as g,e as v,a3 as f,a4 as y,a5 as j,aj as N,b as w,c as b,ar as S,Z as D,E as F,n as I,aD as P,D as R,m as $,C}from"./index-CV77Hym3.js";import{u as A}from"./use-mobile-WsBtvUz6.js";import{E,a as T}from"./jspdf.plugin.autotable-CWgOXssF.js";import{E as z,F as M}from"./exportUtils-wr0jVq1Z.js";import{D as B}from"./download-LkklH1Ul.js";import{T as U}from"./trending-up-BiEUbM3m.js";import{D as k}from"./dollar-sign-DYhSNXxj.js";import{C as V}from"./circle-alert-COMJkl4O.js";import"./vendor-eVk5PToZ.js";const _="https://api.buildhomemartsquares.com/api";const L=new class{async makeRequest(e,t={}){const s=`${_}${e}`,a={headers:{"Content-Type":"application/json",...t.headers},...t},i=localStorage.getItem("token");i&&(a.headers={...a.headers,Authorization:`Bearer ${i}`});try{const e=await fetch(s,a);if(!e.ok){const t=await e.json().catch(()=>({success:!1,message:`HTTP ${e.status}: ${e.statusText}`}));throw new Error(t.message||"An error occurred")}return await e.json()}catch(r){throw r}}async getSubscriptionPlans(){try{const e=await this.makeRequest("/billing/plans");return e.success?e.data:[]}catch(e){return[]}}async getCurrentSubscription(){try{const e=await this.makeRequest("/vendors/subscription/current");return e.success?e.data:null}catch(e){return null}}async upgradeSubscription(e,t){try{const a=await this.makeRequest("/vendors/subscription/upgrade",{method:"POST",body:JSON.stringify({planId:e,billingCycle:t})});return a.success&&s({title:"Success",description:a.message||"Subscription upgrade initiated!"}),{success:a.success,paymentUrl:a.data?.paymentUrl,message:a.message}}catch(a){const e=a instanceof Error?a.message:"Failed to upgrade subscription";return s({title:"Error",description:e,variant:"destructive"}),{success:!1,message:e}}}async cancelSubscription(e){try{const t=await this.makeRequest("/vendors/subscription/cancel",{method:"POST",body:JSON.stringify({reason:e})});if(t.success)return s({title:"Success",description:t.message||"Subscription cancelled successfully!"}),!0;throw new Error(t.message||"Failed to cancel subscription")}catch(t){const e=t instanceof Error?t.message:"Failed to cancel subscription";return s({title:"Error",description:e,variant:"destructive"}),!1}}async reactivateSubscription(){try{const e=await this.makeRequest("/vendors/subscription/reactivate",{method:"POST"});if(e.success)return s({title:"Success",description:e.message||"Subscription reactivated successfully!"}),!0;throw new Error(e.message||"Failed to reactivate subscription")}catch(e){const t=e instanceof Error?e.message:"Failed to reactivate subscription";return s({title:"Error",description:t,variant:"destructive"}),!1}}async getPayments(e={}){try{const t=new URLSearchParams;Object.entries(e).forEach(([e,s])=>{null!=s&&""!==s&&t.append(e,s.toString())});const s="/vendors/payments"+(t.toString()?`?${t.toString()}`:""),a=await this.makeRequest(s);return a.success&&a.data?a.data:{payments:[],totalCount:0,totalPages:0,currentPage:1}}catch(t){return{payments:[],totalCount:0,totalPages:0,currentPage:1}}}async getInvoices(e={}){try{const t=new URLSearchParams;Object.entries(e).forEach(([e,s])=>{null!=s&&""!==s&&t.append(e,s.toString())});const s="/vendors/invoices"+(t.toString()?`?${t.toString()}`:""),a=await this.makeRequest(s);return a.success&&a.data?a.data:{invoices:[],totalCount:0,totalPages:0,currentPage:1}}catch(t){return{invoices:[],totalCount:0,totalPages:0,currentPage:1}}}async downloadInvoice(e){try{const t=await this.getInvoiceDetails(e);if(t)return this.generateInvoicePDF(t);const a=await fetch(`${_}/vendors/invoices/${e}/download`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!a.ok){const e=await a.text();let t="Failed to download invoice";try{t=JSON.parse(e).message||t}catch{t=e||t}throw new Error(t)}const i=a.headers.get("content-type");if(!i||!i.includes("application/pdf"))throw new Error("Invalid invoice format received from server");const r=await a.blob();if(0===r.size)throw new Error("Invoice file is empty");return s({title:"Success",description:"Invoice downloaded successfully!"}),r}catch(t){const e=t instanceof Error?t.message:"Failed to download invoice";return s({title:"Error",description:e,variant:"destructive"}),null}}generateInvoicePDF(e){const t=new E({orientation:"portrait",unit:"mm",format:"a4"});try{const s=20,a=t.internal.pageSize.getWidth(),i=t.internal.pageSize.getHeight();let r=25;t.setFontSize(18),t.setFont("courier","bold");const n="=====================================";t.text(n,a/2,r,{align:"center"}),r+=10,t.setFontSize(14),t.text("         INVOICE",a/2,r,{align:"center"}),r+=10,t.setFontSize(18),t.text(n,a/2,r,{align:"center"}),r+=20,t.setFontSize(10),t.setFont("courier","normal"),t.text(`Invoice #: ${e.invoiceNumber}`,s,r),r+=7,t.text(`Issue Date: ${this.formatDate(e.issueDate)}`,s,r),r+=7,t.text(`Due Date: ${this.formatDate(e.dueDate)}`,s,r),r+=7,t.text(`Status: ${e.status.toUpperCase()}`,s,r),r+=15,t.setFontSize(11),t.setFont("courier","bold"),t.text("Bill To:",s,r),r+=8,t.setFontSize(9),t.setFont("courier","normal"),t.text(e.vendorDetails.name,s,r),r+=6,t.text(e.vendorDetails.email,s,r),r+=6,t.text(e.vendorDetails.phone,s,r),r+=6,e.vendorDetails.address&&(t.text(e.vendorDetails.address,s,r),r+=6),e.vendorDetails.gst&&(t.text(`GST: ${e.vendorDetails.gst}`,s,r),r+=6),r+=8,t.setFontSize(11),t.setFont("courier","bold"),t.text("Items:",s,r),r+=7,t.setFontSize(9),t.setFont("courier","normal");const l="-------------------------------------";return t.text(l,s,r),r+=7,e.items.forEach(e=>{t.text(`Description: ${e.description}`,s,r),r+=5,t.text(`Quantity: ${e.quantity}`,s,r),r+=5,t.text(`Unit Price: ₹${this.formatCurrency(e.unitPrice)}`,s,r),r+=5,t.text(`Total: ₹${this.formatCurrency(e.total)}`,s,r),r+=8}),t.text(l,s,r),r+=8,t.setFontSize(10),t.setFont("courier","normal"),t.text(`Subtotal: ₹${this.formatCurrency(e.amount)}`,s,r),r+=6,t.text(`Tax (${e.tax>0?Math.round(e.tax/e.amount*100):18}% GST): ₹${this.formatCurrency(e.tax)}`,s,r),r+=10,t.setFontSize(12),t.setFont("courier","bold"),t.text("=====================================",a/2,r,{align:"center"}),r+=7,t.text(`TOTAL: ₹${this.formatCurrency(e.total)}`,a/2,r,{align:"center"}),r+=7,t.text("=====================================",a/2,r,{align:"center"}),r+=15,e.paidDate&&(t.setFontSize(10),t.setFont("courier","normal"),t.text("Payment Method: "+("paid"===e.status?"Razorpay":"Pending"),s,r),r+=6,t.text(`Paid Date: ${this.formatDate(e.paidDate)}`,s,r),r+=15),t.setFontSize(9),t.setFont("courier","normal"),t.text("Thank you for your business!",a/2,i-20,{align:"center"}),t.setFontSize(11),t.setFont("courier","bold"),t.text("BuildHomeMartSquares",a/2,i-12,{align:"center"}),t.setFontSize(8),t.setFont("courier","normal"),t.text("www.buildhomemartsquares.com",a/2,i-6,{align:"center"}),t.output("blob")}catch(s){throw new Error("Failed to generate invoice PDF")}}async getBillingStats(){try{const e=await this.makeRequest("/vendors/billing/stats");return e.success&&e.data?e.data:{totalRevenue:0,monthlyRevenue:0,activeSubscriptions:0,totalInvoices:0,paidInvoices:0,overdueInvoices:0,nextBillingAmount:0,nextBillingDate:(new Date).toISOString(),subscriptionStatus:"inactive",usageStats:{properties:{used:0,limit:0},leads:{used:0,limit:0},messages:{used:0,limit:0}}}}catch(e){return{totalRevenue:0,monthlyRevenue:0,activeSubscriptions:0,totalInvoices:0,paidInvoices:0,overdueInvoices:0,nextBillingAmount:0,nextBillingDate:(new Date).toISOString(),subscriptionStatus:"inactive",usageStats:{properties:{used:0,limit:0},leads:{used:0,limit:0},messages:{used:0,limit:0}}}}}formatCurrency(e){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}formatDate(e){return new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})}getStatusColor(e){return{active:"text-green-600 bg-green-100",cancelled:"text-red-600 bg-red-100",expired:"text-orange-600 bg-orange-100",pending:"text-yellow-600 bg-yellow-100",trial:"text-blue-600 bg-blue-100",completed:"text-green-600 bg-green-100",failed:"text-red-600 bg-red-100",refunded:"text-purple-600 bg-purple-100",paid:"text-green-600 bg-green-100",overdue:"text-red-600 bg-red-100",sent:"text-blue-600 bg-blue-100",draft:"text-gray-600 bg-gray-100"}[e]||"text-gray-600 bg-gray-100"}getUsagePercentage(e,t){return 0===t?0:Math.min(e/t*100,100)}downloadBlob(e,t){const s=window.URL.createObjectURL(e),a=document.createElement("a");a.href=s,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(s)}async getPaymentDetails(e){try{const t=await this.makeRequest(`/vendors/payments/${e}`);return t.success?t.data:null}catch(t){return s({title:"Error",description:"Failed to load payment details",variant:"destructive"}),null}}async getInvoiceDetails(e){try{const t=await this.makeRequest(`/vendors/invoices/${e}`);return t.success?t.data:null}catch(t){return s({title:"Error",description:"Failed to load invoice details",variant:"destructive"}),null}}async downloadReceipt(e){try{const t=await this.getPaymentDetails(e);if(t)return this.generateReceiptPDF(t);const a=await fetch(`${_}/vendors/payments/${e}/receipt`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!a.ok){const e=await a.text();let t="Failed to download receipt";try{t=JSON.parse(e).message||t}catch{t=e||t}throw new Error(t)}const i=a.headers.get("content-type");if(!i||!i.includes("application/pdf"))throw new Error("Invalid receipt format received from server");const r=await a.blob();if(0===r.size)throw new Error("Receipt file is empty");return s({title:"Success",description:"Receipt downloaded successfully!"}),r}catch(t){const e=t instanceof Error?t.message:"Failed to download receipt";return s({title:"Error",description:e,variant:"destructive"}),null}}generateReceiptPDF(e){const t=new E({orientation:"portrait",unit:"mm",format:"a4"});try{const s=20,a=t.internal.pageSize.getWidth(),i=t.internal.pageSize.getHeight();let r=25;t.setFontSize(18),t.setFont("courier","bold");const n="=====================================";t.text(n,a/2,r,{align:"center"}),r+=10,t.setFontSize(14),t.text("       PAYMENT RECEIPT",a/2,r,{align:"center"}),r+=10,t.setFontSize(18),t.text(n,a/2,r,{align:"center"}),r+=20,t.setFontSize(10),t.setFont("courier","normal"),t.text(`Receipt #: ${e._id.slice(-8).toUpperCase()}`,s,r),r+=7,t.text(`Date: ${this.formatDate(e.paidAt||e.createdAt)}`,s,r),r+=7,t.text(`Status: ${e.status.toUpperCase()}`,s,r),r+=15,t.setFontSize(11),t.setFont("courier","bold"),t.text("Payment Details:",s,r),r+=8,t.setFontSize(9),t.setFont("courier","normal");const l="-------------------------------------";return t.text(l,s,r),r+=7,t.text(`Description: ${e.description||"Payment"}`,s,r),r+=5,t.text(`Amount: ₹${this.formatCurrency(e.amount)}`,s,r),r+=8,t.text(l,s,r),r+=8,t.setFontSize(11),t.setFont("courier","bold"),t.text("Transaction Details:",s,r),r+=8,t.setFontSize(9),t.setFont("courier","normal"),t.text(l,s,r),r+=7,t.text(`Payment Method: ${e.paymentMethod.replace("_"," ").toUpperCase()}`,s,r),r+=5,e.transactionId&&(t.text(`Transaction ID: ${e.transactionId}`,s,r),r+=5),e.gatewayOrderId&&(t.text(`Gateway Order ID: ${e.gatewayOrderId}`,s,r),r+=5),t.text(`Payment Gateway: ${e.paymentGateway.toUpperCase()}`,s,r),r+=5,e.subscriptionId&&(t.text(`Subscription ID: ${e.subscriptionId.slice(-8).toUpperCase()}`,s,r),r+=5),t.text(l,s,r),r+=15,t.setFontSize(9),t.setFont("courier","normal"),t.text("Thank you for your business!",a/2,i-20,{align:"center"}),t.setFontSize(11),t.setFont("courier","bold"),t.text("BuildHomeMartSquares",a/2,i-12,{align:"center"}),t.setFontSize(8),t.setFont("courier","normal"),t.text("www.buildhomemartsquares.com",a/2,i-6,{align:"center"}),t.output("blob")}catch(s){throw new Error("Failed to generate receipt PDF")}}async exportBillingData(e,t={}){try{if("excel"===e)return this.generateBillingReportExcel(t);const a=new URLSearchParams;a.append("format",e),Object.entries(t).forEach(([e,t])=>{null!=t&&""!==t&&a.append(e,t.toString())});const i=await fetch(`${_}/vendors/billing/export?${a.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!i.ok)throw new Error("Failed to export billing data");const r=await i.blob();return s({title:"Success",description:"Billing data exported successfully!"}),r}catch(a){const e=a instanceof Error?a.message:"Failed to export billing data";return s({title:"Error",description:e,variant:"destructive"}),null}}async generateBillingReportPDF(e={}){const t=new E({orientation:"portrait",unit:"mm",format:"a4"});try{const s=20,a=20,i=t.internal.pageSize.getWidth(),r=t.internal.pageSize.getHeight(),n=i-s-a;let l=25;t.setFontSize(18),t.setFont("helvetica","bold"),t.text("BILLING REPORT",i/2,l,{align:"center"}),t.setFontSize(11),t.setFont("helvetica","normal"),l+=15;const c=e.dateFrom&&e.dateTo?`${this.formatDate(e.dateFrom)} - ${this.formatDate(e.dateTo)}`:"All Time";t.text(`Report Period: ${c}`,s,l),l+=8,t.text(`Generated: ${this.formatDate((new Date).toISOString())}`,s,l),l+=20;const o=await this.getBillingStats();t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Summary",s,l),l+=10;const d=[["Metric","Value"],["Total Revenue",`₹${this.formatCurrency(o.totalRevenue)}`],["Monthly Revenue",`₹${this.formatCurrency(o.monthlyRevenue)}`],["Active Subscriptions",o.activeSubscriptions.toString()],["Total Invoices",o.totalInvoices.toString()],["Paid Invoices",o.paidInvoices.toString()],["Overdue Invoices",o.overdueInvoices.toString()]];T(t,{body:d,startY:l,theme:"grid",styles:{fontSize:9,cellPadding:3},headStyles:{fillColor:[41,128,185],fontSize:10},columnStyles:{0:{cellWidth:.6*n},1:{cellWidth:.4*n,halign:"right"}},margin:{left:s,right:a}}),l=t.lastAutoTable.finalY+15;const m=await this.getPayments(e);if(m.payments.length>0){l>r-80&&(t.addPage(),l=25),t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Recent Payments",s,l),l+=10;const e=[["Date","Description","Amount","Status","Method"]];m.payments.slice(0,10).forEach(t=>{e.push([this.formatDate(t.paidAt||t.createdAt),t.description,`₹${this.formatCurrency(t.amount)}`,t.status.toUpperCase(),t.paymentMethod.replace("_"," ").toUpperCase()])}),T(t,{body:e,startY:l,theme:"grid",styles:{fontSize:7,cellPadding:2},headStyles:{fillColor:[52,152,219],fontSize:8},columnStyles:{0:{cellWidth:.2*n},1:{cellWidth:.35*n},2:{cellWidth:.2*n,halign:"right"},3:{cellWidth:.15*n,halign:"center"},4:{cellWidth:.1*n}},margin:{left:s,right:a}})}const u=await this.getInvoices(e);if(u.invoices.length>0){l=t.lastAutoTable.finalY+15,l>r-80&&(t.addPage(),l=25),t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Recent Invoices",s,l),l+=10;const e=[["Invoice #","Date","Amount","Status"]];u.invoices.slice(0,10).forEach(t=>{e.push([t.invoiceNumber,this.formatDate(t.issueDate),`₹${this.formatCurrency(t.total)}`,t.status.toUpperCase()])}),T(t,{body:e,startY:l,theme:"grid",styles:{fontSize:8,cellPadding:2},headStyles:{fillColor:[155,89,182],fontSize:9},columnStyles:{0:{cellWidth:.3*n},1:{cellWidth:.25*n},2:{cellWidth:.25*n,halign:"right"},3:{cellWidth:.2*n,halign:"center"}},margin:{left:s,right:a}})}return t.setFontSize(8),t.setFont("helvetica","italic"),t.text("Generated by Squares Billing System",i/2,r-10,{align:"center"}),t.output("blob")}catch(s){const e=new E({orientation:"portrait",unit:"mm",format:"a4"}),t=e.internal.pageSize.getWidth();return e.internal.pageSize.getHeight(),e.setFontSize(16),e.setFont("helvetica","bold"),e.text("BILLING REPORT",t/2,40,{align:"center"}),e.setFontSize(12),e.setFont("helvetica","normal"),e.text("Error generating detailed report.",20,60),e.text("Please try again later.",20,70),e.output("blob")}}async generateBillingReportExcel(e={}){try{const[t,s,a]=await Promise.all([this.getPayments({...e,limit:1e3}),this.getInvoices({...e,limit:1e3}),this.getBillingStats()]),i=t.payments.map((e,t)=>({"#":t+1,"Payment ID":e._id?.slice(-8)||"N/A","Transaction ID":e.transactionId||"N/A",Date:z.formatDate(e.createdAt),Description:e.description||"Subscription Payment",Amount:e.amount,Currency:e.currency,Status:e.status.toUpperCase(),"Payment Method":e.paymentMethod.replace("_"," ").toUpperCase(),Gateway:e.paymentGateway||"N/A","Paid At":e.paidAt?z.formatDate(e.paidAt):"N/A","Failure Reason":e.failureReason||"N/A"})),r=s.invoices.map((e,t)=>({"#":t+1,"Invoice Number":e.invoiceNumber,"Issue Date":z.formatDate(e.issueDate),"Due Date":z.formatDate(e.dueDate),"Paid Date":e.paidDate?z.formatDate(e.paidDate):"N/A",Amount:e.amount,Tax:e.tax,Total:e.total,Currency:e.currency,Status:e.status.toUpperCase(),"Vendor Name":e.vendorDetails.name||"N/A","Vendor Email":e.vendorDetails.email||"N/A","Vendor GST":e.vendorDetails.gst||"N/A"})),n=[{Metric:"Total Revenue",Value:a.totalRevenue,Formatted:z.formatCurrency(a.totalRevenue)},{Metric:"Monthly Revenue",Value:a.monthlyRevenue,Formatted:z.formatCurrency(a.monthlyRevenue)},{Metric:"Active Subscriptions",Value:a.activeSubscriptions,Formatted:a.activeSubscriptions.toString()},{Metric:"Total Invoices",Value:a.totalInvoices,Formatted:a.totalInvoices.toString()},{Metric:"Paid Invoices",Value:a.paidInvoices,Formatted:a.paidInvoices.toString()},{Metric:"Overdue Invoices",Value:a.overdueInvoices,Formatted:a.overdueInvoices.toString()},{Metric:"Next Billing Amount",Value:a.nextBillingAmount,Formatted:z.formatCurrency(a.nextBillingAmount)},{Metric:"Next Billing Date",Value:a.nextBillingDate,Formatted:z.formatDate(a.nextBillingDate)},{Metric:"Subscription Status",Value:a.subscriptionStatus,Formatted:a.subscriptionStatus.toUpperCase()}],l=[];a.usageStats&&l.push({Resource:"Properties",Used:a.usageStats.properties.used,Limit:a.usageStats.properties.limit,"Usage %":Math.round(a.usageStats.properties.used/a.usageStats.properties.limit*100)},{Resource:"Leads",Used:a.usageStats.leads.used,Limit:a.usageStats.leads.limit,"Usage %":Math.round(a.usageStats.leads.used/a.usageStats.leads.limit*100)},{Resource:"Messages",Used:a.usageStats.messages.used,Limit:a.usageStats.messages.limit,"Usage %":Math.round(a.usageStats.messages.used/a.usageStats.messages.limit*100)});const c=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),o={filename:"billing-report",title:"Vendor Billing Report",metadata:{"Report Generated":c,Period:e.dateFrom&&e.dateTo?`${z.formatDate(e.dateFrom)} - ${z.formatDate(e.dateTo)}`:"All Time","Generated By":"BuildHomeMartSquares Vendor Portal","Total Payments":i.length.toString(),"Total Invoices":r.length.toString(),"Report Type":"Comprehensive Billing Summary"}},d=[{name:"Summary",data:n,columns:[{wch:25},{wch:15},{wch:20}]},{name:"Payments",data:i,columns:[{wch:5},{wch:15},{wch:15},{wch:12},{wch:25},{wch:12},{wch:10},{wch:12},{wch:15},{wch:10},{wch:12},{wch:20}]},{name:"Invoices",data:r,columns:[{wch:5},{wch:15},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:10},{wch:12},{wch:20},{wch:20},{wch:15}]}];l.length>0&&d.push({name:"Usage Statistics",data:l,columns:[{wch:20},{wch:10},{wch:10},{wch:15}]});const m=z.generateWorkbook(o,d),u=z.writeWorkbookToBuffer(m);return new Blob([u],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})}catch(t){throw new Error("Failed to generate Excel billing report")}}},O=()=>{const E=A(),[T,_]=t.useState(!0),[O,q]=t.useState(null),[G,W]=t.useState([]),[H,Y]=t.useState([]),[J,Q]=t.useState(null),[Z,K]=t.useState("last_30_days"),[X,ee]=t.useState("overview"),[te,se]=t.useState(null),[ae,ie]=t.useState(null),[re,ne]=t.useState(!1),[le,ce]=t.useState(!1),[oe,de]=t.useState(!1);t.useEffect(()=>{ue()},[Z]);const me=e=>{const t={last_7_days:7,last_30_days:30,last_90_days:90,last_year:365}[e]||30;return new Date((new Date).getTime()-24*t*60*60*1e3).toISOString().split("T")[0]},ue=async()=>{try{_(!0);const[e,t,s,a]=await Promise.all([L.getCurrentSubscription(),L.getPayments({page:1,limit:20,dateFrom:me(Z)}),L.getInvoices({page:1,limit:10}),L.getBillingStats()]);q(e),W(t.payments||[]),Y(s.invoices||[]),Q(a)}catch(e){s({title:"Error",description:"Failed to load billing information. Please try again.",variant:"destructive"})}finally{_(!1)}},xe=t=>{switch(t){case"completed":case"active":case"paid":return e.jsx(C,{className:"w-4 h-4 text-green-600"});case"pending":case"sent":return e.jsx($,{className:"w-4 h-4 text-yellow-600"});case"failed":return e.jsx(V,{className:"w-4 h-4 text-red-600"});case"cancelled":case"expired":case"overdue":return e.jsx(R,{className:"w-4 h-4 text-red-600"});default:return e.jsx(V,{className:"w-4 h-4 text-gray-600"})}},he=e=>{switch(e){case"completed":case"active":case"paid":return"bg-green-100 text-green-800";case"pending":case"sent":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},pe=(e,t="INR")=>new Intl.NumberFormat("en-IN",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:0}).format(e),ge=e=>new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),ve=async e=>{try{const t=await L.downloadReceipt(e._id);t?(L.downloadBlob(t,`receipt-${e._id.slice(-8)}.pdf`),s({title:"Success",description:"Payment receipt downloaded successfully."})):s({title:"Error",description:"Failed to generate receipt. No data received.",variant:"destructive"})}catch(t){s({title:"Error",description:"Failed to download receipt. Please try again.",variant:"destructive"})}},fe=async e=>{try{const t=await L.downloadInvoice(e._id);t?(L.downloadBlob(t,`invoice-${e.invoiceNumber}.pdf`),s({title:"Success",description:`Invoice ${e.invoiceNumber} downloaded successfully.`})):s({title:"Error",description:`Failed to generate invoice ${e.invoiceNumber}. No data received.`,variant:"destructive"})}catch(t){s({title:"Error",description:`Failed to download invoice ${e.invoiceNumber}. Please try again.`,variant:"destructive"})}};return T?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{children:"Loading billing information..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(i,{open:re,onOpenChange:ne,children:e.jsxs(r,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(n,{children:[e.jsx(l,{children:"Payment Details"}),e.jsx(c,{children:"Complete information about this payment transaction"})]}),oe?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(a,{className:"h-6 w-6 animate-spin"})}):te?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Payment ID"}),e.jsx("p",{className:"font-medium",children:te._id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Transaction ID"}),e.jsx("p",{className:"font-medium",children:te.transactionId||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Amount"}),e.jsx("p",{className:"font-medium text-lg",children:pe(te.amount,te.currency)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(o,{className:he(te.status),children:te.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Payment Method"}),e.jsx("p",{className:"font-medium capitalize",children:te.paymentMethod.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Payment Gateway"}),e.jsx("p",{className:"font-medium capitalize",children:te.paymentGateway})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Created At"}),e.jsx("p",{className:"font-medium",children:ge(te.createdAt)})]}),te.paidAt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Paid At"}),e.jsx("p",{className:"font-medium",children:ge(te.paidAt)})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Description"}),e.jsx("p",{className:"font-medium",children:te.description})]}),te.failureReason&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Failure Reason"}),e.jsx("p",{className:"text-sm text-red-800",children:te.failureReason})]}),e.jsx("div",{className:"flex gap-2 pt-4",children:e.jsxs(d,{onClick:()=>ve(te),className:"w-full",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Download Receipt"]})})]}):e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"No payment details available"})]})}),e.jsx(i,{open:le,onOpenChange:ce,children:e.jsxs(r,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(n,{children:[e.jsx(l,{children:"Invoice Details"}),e.jsx(c,{children:"Complete information about this invoice"})]}),oe?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(a,{className:"h-6 w-6 animate-spin"})}):ae?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Invoice Number"}),e.jsx("p",{className:"font-medium text-lg",children:ae.invoiceNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(o,{className:he(ae.status),children:ae.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Issue Date"}),e.jsx("p",{className:"font-medium",children:ge(ae.issueDate)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Due Date"}),e.jsx("p",{className:"font-medium",children:ge(ae.dueDate)})]}),ae.paidDate&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Paid Date"}),e.jsx("p",{className:"font-medium",children:ge(ae.paidDate)})]})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Vendor Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Name:"})," ",ae.vendorDetails.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Email:"})," ",ae.vendorDetails.email]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Phone:"})," ",ae.vendorDetails.phone]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Address:"})," ",ae.vendorDetails.address]}),ae.vendorDetails.gst&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"GST:"})," ",ae.vendorDetails.gst]})]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Description"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Qty"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Unit Price"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Total"})]})}),e.jsx("tbody",{children:ae.items.map((t,s)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-3 text-sm",children:t.description}),e.jsx("td",{className:"p-3 text-sm text-right",children:t.quantity}),e.jsx("td",{className:"p-3 text-sm text-right",children:pe(t.unitPrice,ae.currency)}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:pe(t.total,ae.currency)})]},s))}),e.jsxs("tfoot",{className:"border-t-2",children:[e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{colSpan:3,className:"p-3 text-sm text-right font-medium",children:"Subtotal"}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:pe(ae.amount,ae.currency)})]}),e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{colSpan:3,className:"p-3 text-sm text-right font-medium",children:"Tax"}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:pe(ae.tax,ae.currency)})]}),e.jsxs("tr",{className:"border-t bg-muted",children:[e.jsx("td",{colSpan:3,className:"p-3 text-base text-right font-bold",children:"Total"}),e.jsx("td",{className:"p-3 text-base text-right font-bold",children:pe(ae.total,ae.currency)})]})]})]})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(d,{onClick:()=>fe(ae),className:"w-full",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Download PDF"]})})]}):e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"No invoice details available"})]})}),e.jsxs("div",{className:"flex "+(E?"flex-col space-y-4":"justify-between items-center"),children:[e.jsxs("div",{children:[e.jsx("h1",{className:(E?"text-2xl":"text-3xl")+" font-bold tracking-tight",children:"Billing & Payments"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your subscription and payment history"})]}),e.jsxs("div",{className:"flex "+(E?"flex-col space-y-2":"gap-2"),children:[e.jsxs(m,{value:Z,onValueChange:K,children:[e.jsx(u,{className:""+(E?"w-full":"w-40"),children:e.jsx(x,{placeholder:"Select period"})}),e.jsxs(h,{children:[e.jsx(p,{value:"last_7_days",children:"Last 7 days"}),e.jsx(p,{value:"last_30_days",children:"Last 30 days"}),e.jsx(p,{value:"last_90_days",children:"Last 90 days"}),e.jsx(p,{value:"last_year",children:"Last year"})]})]}),e.jsxs(d,{variant:"outline",onClick:async()=>{try{const[e,t,a]=await Promise.all([L.getPayments({dateFrom:me(Z),limit:100}),L.getInvoices({limit:100}),L.getBillingStats()]),i=e.payments.map((e,t)=>({"#":t+1,"Payment ID":e._id?.slice(-8)||"N/A","Transaction ID":e.transactionId||"N/A",Date:z.formatDate(e.createdAt),Description:e.description||"Subscription Payment",Amount:`₹${e.amount}`,Currency:e.currency,Status:e.status.toUpperCase(),"Payment Method":e.paymentMethod.replace("_"," ").toUpperCase(),Gateway:e.paymentGateway||"N/A","Paid At":e.paidAt?z.formatDate(e.paidAt):"N/A","Failure Reason":e.failureReason||"N/A"})),r=t.invoices.map((e,t)=>({"#":t+1,"Invoice Number":e.invoiceNumber,"Issue Date":z.formatDate(e.issueDate),"Due Date":z.formatDate(e.dueDate),"Paid Date":e.paidDate?z.formatDate(e.paidDate):"N/A",Amount:`₹${e.amount}`,Tax:`₹${e.tax}`,Total:`₹${e.total}`,Currency:e.currency,Status:e.status.toUpperCase(),"Vendor Name":e.vendorDetails.name||"N/A","Vendor Email":e.vendorDetails.email||"N/A","Vendor GST":e.vendorDetails.gst||"N/A"})),n=[{Metric:"Total Revenue",Value:`₹${a.totalRevenue}`},{Metric:"Monthly Revenue",Value:`₹${a.monthlyRevenue}`},{Metric:"Active Subscriptions",Value:a.activeSubscriptions},{Metric:"Total Invoices",Value:a.totalInvoices},{Metric:"Paid Invoices",Value:a.paidInvoices},{Metric:"Overdue Invoices",Value:a.overdueInvoices},{Metric:"Next Billing Amount",Value:`₹${a.nextBillingAmount}`},{Metric:"Next Billing Date",Value:z.formatDate(a.nextBillingDate)},{Metric:"Subscription Status",Value:a.subscriptionStatus.toUpperCase()}],l=[];a.usageStats&&l.push({Resource:"Properties",Used:a.usageStats.properties.used,Limit:a.usageStats.properties.limit,"Usage %":`${Math.round(a.usageStats.properties.used/a.usageStats.properties.limit*100)}%`},{Resource:"Leads",Used:a.usageStats.leads.used,Limit:a.usageStats.leads.limit,"Usage %":`${Math.round(a.usageStats.leads.used/a.usageStats.leads.limit*100)}%`},{Resource:"Messages",Used:a.usageStats.messages.used,Limit:a.usageStats.messages.limit,"Usage %":`${Math.round(a.usageStats.messages.used/a.usageStats.messages.limit*100)}%`});const c=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),o=Z.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),d={filename:`vendor-billing-report-${Z}`,title:"Vendor Billing Report",metadata:{"Report Generated":c,Period:o,"Generated By":"BuildHomeMartSquares Vendor Portal","Total Payments":i.length.toString(),"Total Invoices":r.length.toString(),"Report Type":"Comprehensive Billing Summary"}},m=[{name:"Summary",data:n,columns:[{wch:25},{wch:20}]},{name:"Payments",data:i,columns:[{wch:5},{wch:15},{wch:15},{wch:12},{wch:25},{wch:12},{wch:10},{wch:12},{wch:15},{wch:10},{wch:12},{wch:20}]},{name:"Invoices",data:r,columns:[{wch:5},{wch:15},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:10},{wch:12},{wch:20},{wch:20},{wch:15}]}];l.length>0&&m.push({name:"Usage Statistics",data:l,columns:[{wch:20},{wch:10},{wch:10},{wch:15}]}),z.generateExcelReport(d,m),s({title:"Export Successful",description:"Billing report exported to Excel successfully!"})}catch(e){s({title:"Export Failed",description:"Failed to export billing report to Excel. Please try again.",variant:"destructive"})}},className:""+(E?"w-full h-11":"h-9"),children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Export Excel"]})]})]}),J&&e.jsxs("div",{className:"grid gap-4 "+(E?"grid-cols-2":"grid-cols-1 md:grid-cols-4"),children:[e.jsx(g,{children:e.jsxs(v,{className:(E?"p-3":"p-4")+" text-center",children:[e.jsx("div",{className:(E?"text-lg":"text-2xl")+" font-bold text-blue-600",children:pe(J.totalRevenue)}),e.jsx("div",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:"Total Revenue"})]})}),e.jsx(g,{children:e.jsxs(v,{className:(E?"p-3":"p-4")+" text-center",children:[e.jsx("div",{className:(E?"text-lg":"text-2xl")+" font-bold text-green-600",children:pe(J.nextBillingAmount)}),e.jsx("div",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:"Next Payment"})]})}),e.jsx(g,{children:e.jsxs(v,{className:(E?"p-3":"p-4")+" text-center",children:[e.jsx("div",{className:(E?"text-lg":"text-2xl")+" font-bold text-purple-600",children:J.totalInvoices}),e.jsx("div",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:"Total Invoices"})]})}),e.jsx(g,{children:e.jsxs(v,{className:(E?"p-3":"p-4")+" text-center",children:[e.jsx("div",{className:(E?"text-lg":"text-2xl")+" font-bold text-orange-600",children:O?pe(O.amount):"₹0"}),e.jsx("div",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:"Monthly Cost"})]})})]}),e.jsxs(f,{value:X,onValueChange:ee,className:"space-y-6",children:[e.jsxs(y,{children:[e.jsx(j,{value:"overview",children:"Overview"}),e.jsx(j,{value:"payments",children:"Payment History"}),e.jsx(j,{value:"invoices",children:"Invoices"}),e.jsx(j,{value:"usage",children:"Usage Stats"})]}),e.jsxs(N,{value:"overview",className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(w,{children:e.jsxs(b,{className:"flex items-center",children:[e.jsx(S,{className:"w-5 h-5 mr-2"}),"Current Subscription"]})}),e.jsx(v,{children:O?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:O.plan?.name||"N/A"}),e.jsxs("p",{className:"text-muted-foreground",children:["monthly"===O.billingCycle?"Monthly":"Yearly"," Plan"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[xe(O.status),e.jsx(o,{className:he(O.status),children:O.status.charAt(0).toUpperCase()+O.status.slice(1)})]})]}),e.jsxs("div",{className:"grid gap-4 "+(E?"grid-cols-1":"grid-cols-1 md:grid-cols-3"),children:[e.jsxs("div",{children:[e.jsx("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:"Monthly Cost"}),e.jsx("p",{className:(E?"text-base":"text-lg")+" font-semibold",children:pe(O.amount,O.currency)})]}),e.jsxs("div",{children:[e.jsx("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:"Next Billing Date"}),e.jsx("p",{className:(E?"text-base":"text-lg")+" font-semibold",children:ge(O.nextBillingDate)})]}),e.jsxs("div",{children:[e.jsx("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:"Auto Renewal"}),e.jsx("p",{className:(E?"text-base":"text-lg")+" font-semibold",children:O.autoRenew?"Enabled":"Disabled"})]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("div",{className:"flex "+(E?"flex-col space-y-2":"gap-2"),children:[e.jsx(d,{variant:"outline",onClick:()=>window.location.href="/v2/vendor/subscription-plans",className:""+(E?"w-full h-11":""),children:"Change Plan"}),e.jsx(d,{variant:"outline",onClick:()=>window.location.href="/v2/vendor/subscription-manager",className:""+(E?"w-full h-11":""),children:"Manage Subscription"})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(S,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Active Subscription"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Choose a plan to get started with our services"}),e.jsxs(d,{onClick:()=>window.location.href="/v2/vendor/subscription-plans",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Choose Plan"]})]})})]}),e.jsxs(g,{children:[e.jsx(w,{children:e.jsxs(b,{className:"flex items-center",children:[e.jsx(U,{className:"w-5 h-5 mr-2"}),"Recent Transactions"]})}),e.jsx(v,{children:G&&G.length>0?e.jsx("div",{className:"space-y-4",children:G.slice(0,5).map((t,s)=>e.jsxs("div",{className:`flex ${E?"flex-col space-y-3":"items-center justify-between"} p-4 border rounded-lg`,children:[e.jsxs("div",{className:"flex "+(E?"flex-col space-y-2":"items-center space-x-4"),children:[e.jsx("div",{className:"p-2 bg-muted rounded-full",children:e.jsx(k,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:""+(E?"text-sm":"font-medium"),children:t?.description||"Subscription Payment"}),e.jsxs("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:[t?.paymentMethod||"Credit Card"," • ",t?.createdAt?ge(t.createdAt):"N/A"]})]})]}),e.jsxs("div",{className:""+(E?"text-left":"text-right"),children:[e.jsxs("div",{className:"flex "+(E?"justify-between items-center":"items-center space-x-2"),children:[xe(t?.status||"pending"),e.jsx("span",{className:""+(E?"text-sm":"font-semibold"),children:pe(t?.amount||0,t?.currency||"INR")})]}),e.jsx(o,{className:`text-xs ${he(t?.status||"pending")}`,children:t?.status||"pending"})]})]},t?._id||`payment-${s}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(k,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No transactions found"})]})})]})]}),e.jsx(N,{value:"payments",className:"space-y-4",children:e.jsxs(g,{children:[e.jsx(w,{children:e.jsx(b,{children:"Payment History"})}),e.jsx(v,{children:G&&G.length>0?e.jsx("div",{className:"space-y-4",children:G.map((t,s)=>e.jsxs("div",{className:`flex ${E?"flex-col space-y-3":"items-center justify-between"} p-4 border rounded-lg hover:shadow-sm transition-shadow`,children:[e.jsxs("div",{className:"flex "+(E?"flex-col space-y-2":"items-center space-x-4"),children:[e.jsx("div",{className:"p-2 bg-muted rounded-full",children:e.jsx(k,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:""+(E?"text-sm":"font-medium"),children:t?.description||"Subscription Payment"}),e.jsxs("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:["Payment ID: ",t?._id?.slice(-8)||"N/A"]}),e.jsx("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:t?.createdAt?ge(t.createdAt):"N/A"}),("failed"===t.status||"refunded"===t.status)&&t.failureReason&&e.jsx("p",{className:"text-xs text-red-600 mt-1 max-w-md",children:t.failureReason.includes("timeout")||t.failureReason.includes("exceeded")?"⏱️ Payment expired - exceeded 15-minute time limit":`❌ ${t.failureReason}`})]})]}),e.jsxs("div",{className:""+(E?"text-left":"text-right"),children:[e.jsxs("div",{className:`flex ${E?"justify-between items-center":"items-center space-x-2"} mb-1`,children:[xe(t.status),e.jsx("span",{className:""+(E?"text-sm":"font-semibold"),children:pe(t.amount,t.currency)})]}),e.jsx(o,{className:`text-xs ${he(t.status)}`,children:t.status}),e.jsxs("div",{className:`flex ${E?"flex-col space-y-2":"space-x-2"} mt-2`,children:[e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>(async e=>{de(!0),ne(!0);try{const t=await L.getPaymentDetails(e);t&&se(t)}catch(t){ne(!1)}finally{de(!1)}})(t._id),className:""+(E?"w-full h-9":""),children:[e.jsx(F,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>ve(t),className:""+(E?"w-full h-9":""),children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),"Receipt"]})]})]})]},t?._id||`payment-full-${s}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(k,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Payment History"}),e.jsx("p",{className:"text-muted-foreground",children:"Your payment history will appear here"})]})})]})}),e.jsx(N,{value:"invoices",className:"space-y-4",children:e.jsxs(g,{children:[e.jsx(w,{children:e.jsxs(b,{className:"flex "+(E?"flex-col space-y-2":"items-center justify-between"),children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(I,{className:"w-5 h-5 mr-2"}),"Invoices"]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:async()=>{try{for(const e of H)await fe(e),await new Promise(e=>setTimeout(e,500));s({title:"Success",description:`Downloaded ${H.length} invoices`})}catch(e){}},className:""+(E?"w-full h-9":""),children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Download All"]})]})}),e.jsx(v,{children:H&&H.length>0?e.jsx("div",{className:"space-y-4",children:H.map((t,s)=>e.jsxs("div",{className:`flex ${E?"flex-col space-y-3":"items-center justify-between"} p-4 border rounded-lg hover:shadow-sm transition-shadow`,children:[e.jsxs("div",{className:"flex "+(E?"flex-col space-y-2":"items-center space-x-4"),children:[e.jsx("div",{className:"p-2 bg-muted rounded-full",children:e.jsx(I,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsxs("p",{className:""+(E?"text-sm":"font-medium"),children:["Invoice #",t?.invoiceNumber||"N/A"]}),e.jsxs("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:["Issued: ",t?.issueDate?ge(t.issueDate):"N/A"]}),e.jsxs("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:["Due: ",ge(t.dueDate)]})]})]}),e.jsxs("div",{className:""+(E?"text-left":"text-right"),children:[e.jsxs("div",{className:`flex ${E?"justify-between items-center":"items-center space-x-2"} mb-1`,children:[xe(t.status),e.jsx("span",{className:""+(E?"text-sm":"font-semibold"),children:pe(t.total,t.currency)})]}),e.jsx(o,{className:`text-xs ${he(t.status)}`,children:t.status}),e.jsxs("div",{className:`flex ${E?"flex-col space-y-2":"space-x-2"} mt-2`,children:[e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>(async e=>{de(!0),ce(!0);try{const t=await L.getInvoiceDetails(e);t&&ie(t)}catch(t){ce(!1)}finally{de(!1)}})(t._id),className:""+(E?"w-full h-9":""),children:[e.jsx(F,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>fe(t),className:""+(E?"w-full h-9":""),children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),"Download"]})]})]})]},t?._id||`invoice-${s}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(I,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Invoices"}),e.jsx("p",{className:"text-muted-foreground",children:"Your invoices will appear here"})]})})]})}),e.jsx(N,{value:"usage",className:"space-y-4",children:e.jsxs(g,{children:[e.jsx(w,{children:e.jsxs(b,{className:"flex items-center",children:[e.jsx(P,{className:"w-5 h-5 mr-2"}),"Usage Statistics"]})}),e.jsx(v,{children:J?.usageStats?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 "+(E?"grid-cols-1":"grid-cols-1 md:grid-cols-3"),children:[e.jsxs("div",{className:(E?"p-3":"p-4")+" border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:(E?"text-xs":"text-sm")+" font-medium",children:"Properties"}),e.jsxs("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:[J?.usageStats?.properties?.used||0," / ",J?.usageStats?.properties?.limit||0]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${Math.min((J?.usageStats?.properties?.used||0)/(J?.usageStats?.properties?.limit||1)*100,100)}%`}})})]}),e.jsxs("div",{className:(E?"p-3":"p-4")+" border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:(E?"text-xs":"text-sm")+" font-medium",children:"Leads"}),e.jsxs("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:[J?.usageStats?.leads?.used||0," / ",J?.usageStats?.leads?.limit||0]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${Math.min((J?.usageStats?.leads?.used||0)/(J?.usageStats?.leads?.limit||1)*100,100)}%`}})})]}),e.jsxs("div",{className:(E?"p-3":"p-4")+" border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:(E?"text-xs":"text-sm")+" font-medium",children:"Messages"}),e.jsxs("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:[J?.usageStats?.messages?.used||0," / ",J?.usageStats?.messages?.limit||0]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${Math.min((J?.usageStats?.messages?.used||0)/(J?.usageStats?.messages?.limit||1)*100,100)}%`}})})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground mb-4",children:["Usage resets on your billing cycle date: ",J.nextBillingDate]}),e.jsx(d,{variant:"outline",onClick:()=>window.location.href="/v2/vendor/subscription-manager",className:""+(E?"w-full h-11":""),children:"Upgrade Plan"})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(P,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Usage Data"}),e.jsx("p",{className:"text-muted-foreground",children:"Usage statistics will appear here"})]})})]})})]})]})};export{O as default};

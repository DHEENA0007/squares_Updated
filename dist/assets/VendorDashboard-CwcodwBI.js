import{j as e}from"./ui-BHyUY8Z8.js";import{r as c}from"./router-2SVJvIbS.js";import{G as z,t as D,aQ as U,H as _,f as u,aB as L,U as P,E as q,a9 as H,an as O,aD as W,a as w,e as b,T as G,b as F,c as E,B as $,a5 as K,a6 as Q,a7 as X,a8 as T,h as Y,aK as J}from"./index-Bd1eLXM_.js";import{R as I}from"./refresh-cw-D2lAUAYb.js";import{D as Z}from"./dollar-sign-Ce6I0kKs.js";import{T as ee}from"./trending-down-eQbUB_Gl.js";import{R as te,L as se,C as re,X as ae,Y as oe,T as ne,a as ce}from"./LineChart-CN_TXT6y.js";import{A as B}from"./activity-CJP-ixEL.js";import{E as ie}from"./ellipsis-CXpaKV_5.js";import"./vendor-Dazix4UH.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=z("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),de="https://api.akodefy.com/api";class he{async makeRequest(a,t={}){const m=`${de}${a}`,i={headers:{"Content-Type":"application/json",...t.headers},...t},d=localStorage.getItem("token");d&&(i.headers={...i.headers,Authorization:`Bearer ${d}`});try{const o=await fetch(m,i);if(!o.ok){const h=await o.json().catch(()=>({success:!1,message:`HTTP ${o.status}: ${o.statusText}`}));throw new Error(h.message||"An error occurred")}return await o.json()}catch(o){throw console.error("Vendor Dashboard API request failed:",o),o}}async getDashboardData(a={}){try{const t=new URLSearchParams;Object.entries(a).forEach(([d,o])=>{o!=null&&o!==""&&t.append(d,o.toString())});const m=`/vendors/dashboard${t.toString()?`?${t.toString()}`:""}`,i=await this.makeRequest(m);return i.success&&i.data?i.data:this.getEmptyDashboardData()}catch(t){return console.error("Failed to fetch vendor dashboard data:",t),this.getEmptyDashboardData()}}async getVendorStats(a="7d"){try{const t=await this.makeRequest(`/vendors/stats?dateRange=${a}`);if(t.success&&t.data)return t.data;throw new Error("Failed to fetch vendor stats")}catch(t){return console.error("Failed to fetch vendor stats:",t),{totalProperties:0,totalPropertiesChange:"+0",activeLeads:0,activeLeadsChange:"+0",propertyViews:0,propertyViewsChange:"+0%",unreadMessages:0,totalMessages:0,messagesChange:"0 unread",totalRevenue:0,revenueChange:"+0%",conversionRate:0,conversionChange:"+0%"}}}async getRecentProperties(a=6){try{const t=await this.makeRequest(`/vendors/properties/recent?limit=${a}`);if(t.success&&t.data)return t.data.properties;throw new Error("Failed to fetch recent properties")}catch(t){return console.error("Failed to fetch recent properties:",t),[]}}async getRecentLeads(a=10){try{const t=await this.makeRequest(`/vendors/leads/recent?limit=${a}`);if(t.success&&t.data)return t.data.leads;throw new Error("Failed to fetch recent leads")}catch(t){return console.error("Failed to fetch recent leads:",t),[]}}async getPerformanceData(a="7d"){try{const t=await this.makeRequest(`/vendors/performance?dateRange=${a}`);if(t.success&&t.data)return t.data.performance;throw new Error("Failed to fetch performance data")}catch(t){return console.error("Failed to fetch performance data:",t),[]}}async getVendorAnalytics(a="30d"){try{const t=await this.makeRequest(`/vendors/analytics?dateRange=${a}`);if(t.success&&t.data)return t.data;throw new Error("Failed to fetch vendor analytics")}catch(t){return console.error("Failed to fetch vendor analytics:",t),{monthlyPerformance:[],leadsBySource:[],propertyPerformance:[],topPerformingAreas:[]}}}async getNotifications(){try{const a=await this.makeRequest("/vendors/notifications");return a.success&&a.data?a.data.notifications:[]}catch(a){return console.error("Failed to fetch notifications:",a),[]}}async markNotificationAsRead(a){try{return(await this.makeRequest(`/vendors/notifications/${a}/read`,{method:"PATCH"})).success}catch(t){return console.error("Failed to mark notification as read:",t),!1}}async updateLeadStatus(a,t){try{return(await this.makeRequest(`/vendors/leads/${a}/status`,{method:"PATCH",body:JSON.stringify({status:t})})).success?(D({title:"Success",description:"Lead status updated successfully!"}),!0):!1}catch(m){const i=m instanceof Error?m.message:"Failed to update lead status";return D({title:"Error",description:i,variant:"destructive"}),!1}}formatPrice(a,t="₹"){return a>=1e7?`${t}${(a/1e7).toFixed(1)} Cr`:a>=1e5?`${t}${(a/1e5).toFixed(1)} L`:`${t}${a.toLocaleString("en-IN")}`}formatPercentageChange(a){const t=a.startsWith("+");return{value:a,isPositive:t}}getStatusColor(a){return{active:"bg-green-500",pending:"bg-yellow-500",sold:"bg-blue-500",rented:"bg-purple-500",inactive:"bg-gray-500",new:"bg-blue-500",contacted:"bg-yellow-500",qualified:"bg-orange-500",converted:"bg-green-500",lost:"bg-red-500"}[a]||"bg-gray-500"}getInterestColor(a){return{high:"text-green-600 bg-green-100 dark:text-green-400 dark:bg-green-900",medium:"text-yellow-600 bg-yellow-100 dark:text-yellow-400 dark:bg-yellow-900",low:"text-red-600 bg-red-100 dark:text-red-400 dark:bg-red-900"}[a]||"text-gray-600 bg-gray-100"}getEmptyDashboardData(){return{stats:{totalProperties:0,totalPropertiesChange:"+0",activeLeads:0,activeLeadsChange:"+0",propertyViews:0,propertyViewsChange:"+0%",unreadMessages:0,totalMessages:0,messagesChange:"0 unread",totalRevenue:0,revenueChange:"+0%",conversionRate:0,conversionChange:"+0%"},recentProperties:[],recentLeads:[],performanceData:[],analytics:{monthlyPerformance:[],leadsBySource:[],propertyPerformance:[],topPerformingAreas:[]},notifications:[]}}}const l=new he,me=(p={})=>{const{autoRefresh:a=!0,refreshInterval:t=3e4,enableRealtime:m=!0}=p,{isConnected:i}=U(),d=c.useRef(null),o=c.useRef({}),[h,N]=c.useState({stats:null,recentProperties:[],recentLeads:[],performanceData:[],notifications:[],isLoading:!0,error:null,lastUpdated:null}),n=c.useCallback(r=>{N(f=>({...f,...r,lastUpdated:new Date}))},[]),j=c.useCallback(async()=>{try{const r=await l.getVendorStats(o.current.dateRange||"7d");n({stats:r})}catch(r){console.error("Failed to refresh vendor stats:",r),n({error:r instanceof Error?r.message:"Failed to load stats"})}},[n]),v=c.useCallback(async()=>{try{const r=await l.getRecentProperties(6);n({recentProperties:r})}catch(r){console.error("Failed to refresh properties:",r)}},[n]),C=c.useCallback(async()=>{try{const r=await l.getRecentLeads(10);n({recentLeads:r})}catch(r){console.error("Failed to refresh leads:",r)}},[n]),k=c.useCallback(async()=>{try{const r=await l.getPerformanceData(o.current.dateRange||"7d");n({performanceData:r})}catch(r){console.error("Failed to refresh performance data:",r)}},[n]),S=c.useCallback(async()=>{try{const r=await l.getNotifications();n({notifications:r})}catch(r){console.error("Failed to refresh notifications:",r)}},[n]),g=c.useCallback(async()=>{n({isLoading:!0,error:null});try{const r=await l.getDashboardData(o.current);n({stats:r.stats,recentProperties:r.recentProperties,recentLeads:r.recentLeads,performanceData:r.performanceData,notifications:r.notifications,isLoading:!1,error:null})}catch(r){console.error("Failed to refresh dashboard data:",r),n({isLoading:!1,error:r instanceof Error?r.message:"Failed to load dashboard data"})}},[n]),R=c.useCallback(r=>{o.current={...o.current,...r},g()},[g]),V=c.useCallback(async r=>{try{await l.markNotificationAsRead(r)&&n({notifications:h.notifications.map(x=>x.id===r?{...x,isRead:!0}:x)})}catch(f){console.error("Failed to mark notification as read:",f),D({title:"Error",description:"Failed to mark notification as read",variant:"destructive"})}},[h.notifications,n]),y=c.useCallback(async(r,f)=>{try{await l.updateLeadStatus(r,f)&&(n({recentLeads:h.recentLeads.map(s=>s._id===r?{...s,status:f,updatedAt:new Date().toISOString()}:s)}),j())}catch(x){console.error("Failed to update lead status:",x)}},[h.recentLeads,n,j]);return c.useEffect(()=>{},[m,i]),c.useEffect(()=>{if(a&&t>0)return d.current=setInterval(()=>{h.isLoading||g()},t),()=>{d.current&&clearInterval(d.current)}},[a,t,g,h.isLoading]),c.useEffect(()=>{g()},[]),c.useEffect(()=>()=>{d.current&&clearInterval(d.current)},[]),[h,{refreshData:g,refreshStats:j,refreshProperties:v,refreshLeads:C,refreshPerformance:k,refreshNotifications:S,updateFilters:R,markNotificationAsRead:V,updateLeadStatus:y}]},Ne=()=>{const[p,a]=c.useState("7d"),[t,m]=c.useState("overview"),[i,d]=me({autoRefresh:!0,refreshInterval:3e4,enableRealtime:!0}),{stats:o,recentProperties:h,recentLeads:N,performanceData:n,notifications:j,isLoading:v,error:C,lastUpdated:k}=i,{refreshData:S,refreshStats:g,updateFilters:R,markNotificationAsRead:V,updateLeadStatus:y}=d;c.useEffect(()=>{R({dateRange:p})},[p,R]);const A=()=>{S(),D({title:"Dashboard Refreshed",description:"All data has been updated with the latest information."})};if(v&&!o)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading your dashboard..."})]})});if(C&&!o)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 mb-4",children:C}),e.jsxs(u,{onClick:A,children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Try Again"]})]})});const r=j.filter(s=>!s.isRead).length,f=[{title:"Total Properties",value:o?.totalProperties||0,change:o?.totalPropertiesChange||"+0",icon:L,color:"text-blue-600"},{title:"Active Leads",value:o?.activeLeads||0,change:o?.activeLeadsChange||"+0",icon:P,color:"text-green-600"},{title:"Property Views",value:o?.propertyViews||0,change:o?.propertyViewsChange||"+0%",icon:q,color:"text-purple-600"},{title:"Messages",value:o?.totalMessages||0,change:o?.messagesChange||"0 unread",icon:H,color:"text-orange-600"},{title:"Total Revenue",value:l.formatPrice(o?.totalRevenue||0),change:o?.revenueChange||"+0%",icon:Z,color:"text-emerald-600"},{title:"Conversion Rate",value:`${o?.conversionRate||0}%`,change:o?.conversionChange||"+0%",icon:le,color:"text-indigo-600"}],x=n.length>0?n:[];return e.jsxs("div",{className:"space-y-6 mt-16",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Vendor Dashboard"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-muted-foreground",children:"Manage your properties and track your performance"}),k&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["• Last updated: ",k.toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{variant:"outline",onClick:A,disabled:v,children:[e.jsx(I,{className:`w-4 h-4 mr-2 ${v?"animate-spin":""}`}),"Refresh"]}),r>0&&e.jsxs(u,{variant:"outline",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Notifications (",r,")"]}),e.jsxs(u,{variant:"outline",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"View Analytics"]}),e.jsxs(u,{children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Add Property"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6",children:f.map(s=>{const M=l.formatPercentageChange(s.change);return e.jsx(w,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:s.title}),e.jsx("p",{className:"text-2xl font-bold",children:s.value}),e.jsxs("div",{className:"flex items-center mt-1",children:[M.isPositive?e.jsx(G,{className:"h-4 w-4 text-green-500 mr-1"}):e.jsx(ee,{className:"h-4 w-4 text-red-500 mr-1"}),e.jsx("p",{className:`text-xs ${M.isPositive?"text-green-500":"text-red-500"}`,children:s.change})]})]}),e.jsx(s.icon,{className:`h-8 w-8 ${s.color}`})]})})},s.title)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsx(F,{children:e.jsxs(E,{className:"flex items-center justify-between",children:["Views Performance",e.jsx("div",{className:"flex gap-2",children:["7d","30d","90d"].map(s=>e.jsx(u,{variant:p===s?"default":"ghost",size:"sm",onClick:()=>a(s),children:s},s))})]})}),e.jsx(b,{children:x.length>0?e.jsx(te,{width:"100%",height:300,children:e.jsxs(se,{data:x,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorViews",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:0})]})}),e.jsx(re,{strokeDasharray:"3 3",stroke:"hsl(var(--border))",opacity:.3,vertical:!1}),e.jsx(ae,{dataKey:"date",stroke:"hsl(var(--muted-foreground))",fontSize:12,tickLine:!1,axisLine:!1}),e.jsx(oe,{stroke:"hsl(var(--muted-foreground))",fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:s=>`${s}`}),e.jsx(ne,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",boxShadow:"0 10px 15px -3px rgb(0 0 0 / 0.1)",color:"hsl(var(--popover-foreground))",fontSize:"13px"},labelStyle:{color:"hsl(var(--popover-foreground))",fontWeight:600,marginBottom:"4px"},cursor:{stroke:"hsl(var(--border))",strokeWidth:1}}),e.jsx(ce,{type:"monotone",dataKey:"views",stroke:"#10b981",strokeWidth:2.5,dot:!1,activeDot:{r:5,fill:"#10b981",stroke:"#fff",strokeWidth:2},name:"Views",fill:"url(#colorViews)"})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-[300px] text-center",children:[e.jsx(B,{className:"w-16 h-16 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:"No Performance Data"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md",children:"Performance metrics will appear here once your properties start receiving views."})]})})]}),e.jsxs(w,{children:[e.jsx(F,{children:e.jsxs(E,{className:"flex items-center justify-between",children:["Recent Leads",e.jsx(u,{variant:"ghost",size:"sm",children:"View All"})]})}),e.jsx(b,{children:e.jsx("div",{className:"space-y-4",children:N.length>0?N.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center",children:e.jsx(P,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.propertyTitle}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.phone})]})]}),e.jsxs("div",{className:"text-right space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:l.getInterestColor(s.interestLevel),children:s.interestLevel}),e.jsxs(K,{children:[e.jsx(Q,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"sm",children:e.jsx(ie,{className:"h-4 w-4"})})}),e.jsxs(X,{children:[e.jsx(T,{onClick:()=>y(s._id,"contacted"),children:"Mark as Contacted"}),e.jsx(T,{onClick:()=>y(s._id,"qualified"),children:"Mark as Qualified"}),e.jsx(T,{onClick:()=>y(s._id,"converted"),children:"Mark as Converted"})]})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center",children:[e.jsx(B,{className:"w-3 h-3 mr-1"}),new Date(s.createdAt).toLocaleDateString()]})]})]},s._id)):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(P,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No recent leads"}),e.jsx("p",{className:"text-sm",children:"New leads will appear here"})]})})})]})]}),e.jsxs(w,{children:[e.jsx(F,{children:e.jsxs(E,{className:"flex items-center justify-between",children:["Recent Properties",e.jsx(u,{variant:"ghost",size:"sm",children:"View All"})]})}),e.jsx(b,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.length>0?h.map(s=>e.jsxs(w,{className:"overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.images[0]||"https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=300&h=200&fit=crop&auto=format",alt:s.title,className:"w-full h-32 object-cover"}),e.jsx($,{className:`absolute top-2 right-2 ${l.getStatusColor(s.status)} text-white`,children:s.status}),e.jsx("div",{className:"absolute bottom-2 left-2",children:e.jsx($,{variant:"secondary",className:"text-xs",children:s.listingType})})]}),e.jsxs(b,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold line-clamp-1",children:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2 flex items-center",children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),s.location]}),e.jsx("p",{className:"text-lg font-bold text-primary mb-3",children:l.formatPrice(s.price,s.currency)}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(q,{className:"w-4 h-4 mr-1"}),s.views," views"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(P,{className:"w-4 h-4 mr-1"}),s.leads," leads"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),s.favorites]})]})]})]},s._id)):e.jsxs("div",{className:"col-span-full text-center py-8 text-muted-foreground",children:[e.jsx(L,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No properties found"}),e.jsx("p",{className:"text-sm",children:"Add your first property to get started"}),e.jsxs(u,{className:"mt-4",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Add Property"]})]})})})]})]})};export{Ne as default};

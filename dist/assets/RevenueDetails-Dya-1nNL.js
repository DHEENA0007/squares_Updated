import{j as e}from"./ui-DHQhougw.js";import{d as s,r as t}from"./router-Bi51YGN-.js";import{y as a,t as r,f as n,A as i,a as l,b as c,c as d,e as o,m,D as x,C as u}from"./index-CV77Hym3.js";import{D as h}from"./download-LkklH1Ul.js";import"./vendor-eVk5PToZ.js";const j=()=>{const j=s(),[p,f]=t.useState([]),[v,N]=t.useState(!0),[g,b]=t.useState({totalRevenue:0,thisMonthRevenue:0,activeSubscriptions:0,expiredSubscriptions:0,averageRevenue:0});t.useEffect(()=>{y()},[]);const y=async()=>{try{const e=a.getToken(),s=await fetch("https://api.buildhomemartsquares.com/api/subscriptions/all",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!s.ok)throw new Error("Failed to fetch revenue data");const t=await s.json();if(t.success){const e=t.data.subscriptions;f(e);const s=new Date,a=new Date(s.getFullYear(),s.getMonth(),1),r=e.filter(e=>["active","expired"].includes(e.status)&&e.lastPaymentDate).reduce((e,s)=>e+s.amount,0),n=e.filter(e=>["active","expired"].includes(e.status)&&e.lastPaymentDate&&new Date(e.lastPaymentDate)>=a).reduce((e,s)=>e+s.amount,0);b({totalRevenue:r,thisMonthRevenue:n,activeSubscriptions:e.filter(e=>"active"===e.status).length,expiredSubscriptions:e.filter(e=>"expired"===e.status).length,averageRevenue:e.length>0?r/e.length:0})}}catch(e){r({title:"Error",description:"Failed to load revenue data",variant:"destructive"})}finally{N(!1)}},w=e=>`â‚¹${e.toLocaleString("en-IN")}`,D=s=>{switch(s){case"active":return e.jsx(u,{className:"w-4 h-4 text-green-600"});case"expired":return e.jsx(x,{className:"w-4 h-4 text-red-600"});case"cancelled":return e.jsx(x,{className:"w-4 h-4 text-gray-600"});default:return e.jsx(m,{className:"w-4 h-4 text-yellow-600"})}};return v?e.jsx("div",{className:"flex justify-center items-center py-12",children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(n,{variant:"ghost",onClick:()=>j("/admin/dashboard"),children:[e.jsx(i,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Revenue Details"}),e.jsx("p",{className:"text-muted-foreground",children:"Complete revenue breakdown and subscription history"})]}),e.jsxs(n,{variant:"outline",children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"Export Report"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-5",children:[e.jsxs(l,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"Total Revenue"})}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:w(g.totalRevenue)})})]}),e.jsxs(l,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"This Month"})}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:w(g.thisMonthRevenue)})})]}),e.jsxs(l,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"Active Subscriptions"})}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:g.activeSubscriptions})})]}),e.jsxs(l,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"Expired"})}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:g.expiredSubscriptions})})]}),e.jsxs(l,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(d,{className:"text-sm font-medium text-muted-foreground",children:"Average Revenue"})}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:w(Math.round(g.averageRevenue))})})]})]}),e.jsxs(l,{children:[e.jsx(c,{children:e.jsx(d,{children:"All Subscriptions"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-3",children:0===p.length?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No subscriptions found"}):p.map(s=>{return e.jsx("div",{className:"border rounded-lg p-4 hover:bg-accent/50 transition",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 items-center",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsxs("p",{className:"font-medium",children:[s.user?.profile?.firstName," ",s.user?.profile?.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.user?.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Plan"}),e.jsx("p",{className:"font-medium",children:s.plan?.name||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Amount"}),e.jsx("p",{className:"font-bold text-emerald-600",children:w(s.amount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Payment Date"}),e.jsx("p",{className:"text-sm",children:s.lastPaymentDate?(t=s.lastPaymentDate,new Date(t).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})):"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[D(s.status),e.jsx("span",{className:"text-sm capitalize",children:s.status})]})]})},s._id);var t})})})]})]})};export{j as default};

import{j as e}from"./ui-DYmpZ3pJ.js";import{r as l}from"./router-2SVJvIbS.js";import{t as d,D as X,f as m,A as D,I as y,p as B,q as L,r as _,s as $,ah as Z,U as M,n as ee,aC as se,S as te,aD as k,v as E,a as u,e as x,T as re,G as ae,H as T,J as ie,$ as F,B as ce,E as ne,a9 as oe,Y as le,o as de}from"./index-BbgqWuYN.js";import{T as me}from"./textarea-Cl1lQCIh.js";import{D as ue,f as xe,a as ge,b as he,c as ve}from"./dialog-DsX3mE8Q.js";import{L as j}from"./label-DRahLfWI.js";import{L as q}from"./loader-circle-DtIJ61xE.js";import{D as pe}from"./dollar-sign-BPJ6xT4m.js";import{T as je}from"./truck-jcI5olw4.js";import{S as fe}from"./square-pen-uFfo4AcD.js";import{T as ye}from"./trash-yXs_LzzT.js";import"./vendor-Dazix4UH.js";const Se="https://squares-v2.onrender.com/api";class Ne{async makeRequest(r,s={}){const a=`${Se}${r}`,o={headers:{"Content-Type":"application/json",...s.headers},...s},g=localStorage.getItem("token");g&&(o.headers={...o.headers,Authorization:`Bearer ${g}`});try{const c=await fetch(a,o);if(!c.ok){const S=await c.json().catch(()=>({success:!1,message:`HTTP ${c.status}: ${c.statusText}`}));throw new Error(S.message||"An error occurred")}return await c.json()}catch(c){throw console.error("Services API request failed:",c),c}}async getServices(r={}){try{const s=new URLSearchParams;Object.entries(r).forEach(([g,c])=>{c!=null&&c!==""&&s.append(g,c.toString())});const a=`/vendors/services${s.toString()?`?${s.toString()}`:""}`,o=await this.makeRequest(a);return o.success&&o.data?o.data:{services:[],totalCount:0,totalPages:0,currentPage:1}}catch(s){return console.error("Failed to fetch services:",s),{services:[],totalCount:0,totalPages:0,currentPage:1}}}async getServiceById(r){try{const s=await this.makeRequest(`/vendors/services/${r}`);return s.success?s.data:null}catch(s){return console.error("Failed to fetch service:",s),null}}async createService(r){try{const s=await this.makeRequest("/vendors/services",{method:"POST",body:JSON.stringify(r)});if(s.success)return d({title:"Success",description:s.message||"Service created successfully!"}),s.data;throw new Error(s.message||"Failed to create service")}catch(s){const a=s instanceof Error?s.message:"Failed to create service";throw d({title:"Error",description:a,variant:"destructive"}),s}}async updateService(r,s){try{const a=await this.makeRequest(`/vendors/services/${r}`,{method:"PUT",body:JSON.stringify(s)});if(a.success)return d({title:"Success",description:a.message||"Service updated successfully!"}),a.data;throw new Error(a.message||"Failed to update service")}catch(a){const o=a instanceof Error?a.message:"Failed to update service";throw d({title:"Error",description:o,variant:"destructive"}),a}}async deleteService(r){try{const s=await this.makeRequest(`/vendors/services/${r}`,{method:"DELETE"});if(s.success)return d({title:"Success",description:s.message||"Service deleted successfully!"}),!0;throw new Error(s.message||"Failed to delete service")}catch(s){const a=s instanceof Error?s.message:"Failed to delete service";return d({title:"Error",description:a,variant:"destructive"}),!1}}async toggleServiceStatus(r){try{const s=await this.makeRequest(`/vendors/services/${r}/toggle-status`,{method:"PATCH"});if(s.success)return d({title:"Success",description:s.message||"Service status updated!"}),s.data;throw new Error(s.message||"Failed to update service status")}catch(s){const a=s instanceof Error?s.message:"Failed to update service status";return d({title:"Error",description:a,variant:"destructive"}),null}}async getServiceBookings(r){try{const s=await this.makeRequest(`/vendors/services/${r}/bookings`);return s.success?s.data:[]}catch(s){return console.error("Failed to fetch service bookings:",s),[]}}async getServiceStats(){try{const r=await this.makeRequest("/vendors/services/stats");return r.success&&r.data?r.data:{totalServices:0,activeServices:0,totalBookings:0,pendingBookings:0,completedBookings:0,totalRevenue:0,monthlyRevenue:0,averageRating:0,popularCategories:[]}}catch(r){return console.error("Failed to fetch service stats:",r),{totalServices:0,activeServices:0,totalBookings:0,pendingBookings:0,completedBookings:0,totalRevenue:0,monthlyRevenue:0,averageRating:0,popularCategories:[]}}}async updateBookingStatus(r,s){try{const a=await this.makeRequest(`/vendors/bookings/${r}/status`,{method:"PATCH",body:JSON.stringify({status:s})});if(a.success)return d({title:"Success",description:a.message||"Booking status updated!"}),a.data;throw new Error(a.message||"Failed to update booking status")}catch(a){const o=a instanceof Error?a.message:"Failed to update booking status";return d({title:"Error",description:o,variant:"destructive"}),null}}formatCurrency(r){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(r)}formatDuration(r){if(r<60)return`${r} min`;const s=Math.floor(r/60),a=r%60;return a>0?`${s}h ${a}m`:`${s}h`}getServiceCategoryLabel(r){return{property_management:"Property Management",consultation:"Real Estate Consultation",legal_services:"Legal Services",home_loans:"Home Loans",interior_design:"Interior Design",moving_services:"Moving Services",insurance:"Property Insurance",other:"Other Services"}[r]||r}getStatusColor(r){return{active:"text-green-600 bg-green-100",inactive:"text-gray-600 bg-gray-100",pending:"text-yellow-600 bg-yellow-100",confirmed:"text-blue-600 bg-blue-100",in_progress:"text-purple-600 bg-purple-100",completed:"text-green-600 bg-green-100",cancelled:"text-red-600 bg-red-100"}[r]||"text-gray-600 bg-gray-100"}getPricingDisplay(r){if(!r)return"Contact for pricing";if(r.type==="negotiable")return"Negotiable";if(!r.amount)return"Contact for pricing";const s=this.formatCurrency(r.amount);switch(r.type){case"hourly":return`${s}/hour`;case"percentage":return`${r.amount}% commission`;case"fixed":default:return s}}}const v=new Ne,Oe=()=>{const{toast:P}=X(),[r,s]=l.useState("all"),[a,o]=l.useState(""),[g,c]=l.useState(!1),[S,R]=l.useState(!0),[N,b]=l.useState([]),[h,O]=l.useState(null),[A,be]=l.useState(1),[we,I]=l.useState(1),[Ce,ke]=l.useState(null),[Ee,H]=l.useState(null),[w,f]=l.useState(null),V={page:A,limit:10,category:r!=="all"?r:void 0,search:a||void 0,status:"all",sortBy:"updatedAt",sortOrder:"desc"},z=async()=>{try{R(!0);const[t,i]=await Promise.all([v.getServices(V),v.getServiceStats()]);b(t.services),I(t.totalPages),O(i)}catch(t){console.error("Failed to load services:",t),P({title:"Error",description:"Failed to load services. Please try again.",variant:"destructive"})}finally{R(!1)}};l.useEffect(()=>{z()},[A,r,a]);const U=async t=>{try{f(t);const i=await v.toggleServiceStatus(t);i&&b(N.map(n=>n._id===t?i:n))}catch(i){console.error("Failed to toggle service status:",i)}finally{f(null)}},J=async t=>{if(confirm("Are you sure you want to delete this service?"))try{f(t),await v.deleteService(t)&&b(N.filter(n=>n._id!==t))}catch(i){console.error("Failed to delete service:",i)}finally{f(null)}},p=[{id:"property_management",name:"Property Management",icon:Z,color:"text-blue-600"},{id:"consultation",name:"Real Estate Consultation",icon:M,color:"text-green-600"},{id:"legal_services",name:"Legal Services",icon:ee,color:"text-purple-600"},{id:"home_loans",name:"Home Loans",icon:pe,color:"text-pink-600"},{id:"interior_design",name:"Interior Design",icon:se,color:"text-orange-600"},{id:"moving_services",name:"Moving Services",icon:je,color:"text-indigo-600"},{id:"insurance",name:"Property Insurance",icon:te,color:"text-red-600"},{id:"other",name:"Other Services",icon:k,color:"text-teal-600"}],C=N.filter(t=>{const i=r==="all"||t.category===r,n=!a||t.title.toLowerCase().includes(a.toLowerCase())||t.description.toLowerCase().includes(a.toLowerCase());return i&&n});if(S)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{children:"Loading services..."})]})});const Y=t=>{const i=p.find(n=>n.id===t);return i?i.icon:k},Q=t=>{const i=p.find(n=>n.id===t);return i?i.color:"text-gray-600"},G=t=>{const i=p.find(n=>n.id===t);return i?i.name:"Other"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Value-Added Services"}),e.jsx("p",{className:"text-muted-foreground",children:"Offer additional services to your property clients"})]}),e.jsxs(ue,{open:g,onOpenChange:c,children:[e.jsx(xe,{asChild:!0,children:e.jsxs(m,{children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Add Service"]})}),e.jsxs(ge,{className:"max-w-2xl",children:[e.jsx(he,{children:e.jsx(ve,{children:"Add New Service"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"service-title",children:"Service Title"}),e.jsx(y,{id:"service-title",placeholder:"Enter service title"})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"service-category",children:"Category"}),e.jsxs(B,{children:[e.jsx(L,{children:e.jsx(_,{placeholder:"Select category"})}),e.jsx($,{children:p.map(t=>e.jsx(E,{value:t.id,children:t.name},t.id))})]})]})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"service-description",children:"Description"}),e.jsx(me,{id:"service-description",placeholder:"Describe your service"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"service-price",children:"Price Range"}),e.jsx(y,{id:"service-price",placeholder:"₹0 - ₹0"})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"service-commission",children:"Commission (%)"}),e.jsx(y,{id:"service-commission",placeholder:"15%"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(m,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(m,{onClick:()=>c(!1),children:"Add Service"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(u,{children:e.jsxs(x,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:h?.totalServices||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Services"})]})}),e.jsx(u,{children:e.jsxs(x,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:h?.activeServices||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Active Services"})]})}),e.jsx(u,{children:e.jsxs(x,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:h?.totalBookings||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Orders"})]})}),e.jsx(u,{children:e.jsxs(x,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:h?v.formatCurrency(h.totalRevenue):"₹0"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Revenue Earned"})]})}),e.jsx(u,{children:e.jsxs(x,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:h?.averageRating.toFixed(1)||"0.0"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Avg Rating"})]})})]}),e.jsxs(re,{defaultValue:"my-services",className:"space-y-6",children:[e.jsxs(ae,{children:[e.jsxs(T,{value:"my-services",children:["My Services (",C.length,")"]}),e.jsx(T,{value:"marketplace",children:"Service Marketplace"}),e.jsx(T,{value:"orders",children:"Orders & Bookings"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(y,{placeholder:"Search services...",value:a,onChange:t=>o(t.target.value),className:"pl-10"})]}),e.jsxs(B,{value:r,onValueChange:s,children:[e.jsx(L,{className:"w-full sm:w-48",children:e.jsx(_,{placeholder:"All Categories"})}),e.jsxs($,{children:[e.jsx(E,{value:"all",children:"All Categories"}),p.map(t=>e.jsx(E,{value:t.id,children:t.name},t.id))]})]})]}),e.jsx(F,{value:"my-services",className:"space-y-4",children:C.length>0?e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:C.map(t=>{const i=Y(t.category);return e.jsx(u,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(x,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-muted",children:e.jsx(i,{className:`w-5 h-5 ${Q(t.category)}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:G(t.category)})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{variant:t.isActive?"default":"secondary",className:t.isActive?"bg-green-100 text-green-800":"",children:t.isActive?"Active":"Inactive"}),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>H(t),children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>U(t._id),disabled:w===t._id,children:w===t._id?e.jsx(q,{className:"w-4 h-4 animate-spin"}):e.jsx(ne,{className:"w-4 h-4"})}),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>J(t._id),disabled:w===t._id,children:e.jsx(ye,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:t.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Price Range"}),e.jsx("p",{className:"font-semibold",children:v.getPricingDisplay(t.pricing)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Duration"}),e.jsx("p",{className:"font-semibold text-green-600",children:t.duration||"Flexible"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Bookings"}),e.jsx("p",{className:"font-semibold",children:t.statistics.totalBookings})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Rating"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(oe,{className:"w-4 h-4 text-yellow-500 fill-current mr-1"}),e.jsx("span",{className:"font-semibold",children:t.statistics.averageRating.toFixed(1)}),e.jsxs("span",{className:"text-xs text-muted-foreground ml-1",children:["(",t.statistics.totalBookings,")"]})]})]})]}),e.jsx("div",{className:"space-y-2 mb-4",children:t.features.slice(0,2).map((n,K)=>{const W=typeof n=="string"?n:n.name||String(n);return e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-primary rounded-full mr-2"}),e.jsx("span",{children:W})]},K)})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["by ",t.vendorId]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(m,{size:"sm",variant:"outline",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Messages"]}),e.jsx(m,{size:"sm",children:"View Details"})]})]})]})},t._id)})}):e.jsx(u,{children:e.jsxs(x,{className:"p-12 text-center",children:[e.jsx(M,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Services Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Start offering value-added services to your clients"}),e.jsxs(m,{onClick:()=>c(!0),children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Add Your First Service"]})]})})}),e.jsx(F,{value:"marketplace",className:"space-y-4",children:e.jsx(u,{children:e.jsxs(x,{className:"p-12 text-center",children:[e.jsx(de,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Service Marketplace Coming Soon"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Discover and add third-party services to expand your offerings. This feature will be available soon."}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsx("p",{children:"• Browse professional service providers"}),e.jsx("p",{children:"• Add services to your portfolio"}),e.jsx("p",{children:"• Earn commissions on referrals"})]})]})})}),e.jsx(F,{value:"orders",className:"space-y-4",children:e.jsx(u,{children:e.jsxs(x,{className:"p-12 text-center",children:[e.jsx(k,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Orders Yet"}),e.jsx("p",{className:"text-muted-foreground",children:"Service orders and bookings will appear here"})]})})})]})]})};export{Oe as default};

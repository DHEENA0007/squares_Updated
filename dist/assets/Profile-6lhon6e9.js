import{j as e}from"./ui-CEt46o3G.js";import{r as i}from"./router-2SVJvIbS.js";import{C as u,d as N,a as w,b as C}from"./card-YvDMUmzt.js";import{O as re,t as le,R,B as G,a as P,e as ne,T as ce,h as oe,i as k,v as A,A as de,j as me,k as xe,M as pe,I as g,X as he,o as L,z as H,s as fe}from"./index-CiYV0Sy0.js";import{L as h}from"./label-BV_cIshD.js";import{T as je}from"./textarea-BbecYreM.js";import{S as v}from"./separator--OCztuR5.js";import{S as p}from"./switch-b3R448ud.js";import{u as y}from"./userService-BPsaMP6Y.js";import{c as J}from"./customerDashboardService-62dTpgP4.js";import{c as ue}from"./customerPropertiesService-Dj-chyEI.js";import{R as X}from"./refresh-cw-B8zbtsbT.js";import{P as Ne}from"./pen-line-hrB0mI2q.js";import{C as ge}from"./camera-2k-Wb9vt.js";import{S as ve}from"./shield-CFIF9xqz.js";import{M as ye}from"./mail-hCxVaHOS.js";import{P as be}from"./phone-BlyPoB6i.js";import{C as we}from"./calendar-DWj9NFdt.js";import{S as Ce}from"./save-Br7oaQ85.js";import{E as Pe}from"./eye-CDS1ofgA.js";import{T as Se}from"./trending-up-BLutZFyR.js";import{L as Re}from"./lock-DY62iqoZ.js";import{A as K}from"./activity-C0RoF-dL.js";import"./vendor-Dazix4UH.js";import"./index-DHzxUTm5.js";const Ze=()=>{const{isConnected:q,lastEvent:V}=re(),[c,E]=i.useState(!1),[S,M]=i.useState(!0),[I,U]=i.useState(!1),[D,B]=i.useState(!1),[_,Q]=i.useState(null),[t,x]=i.useState({name:"",email:"",phone:"",location:"",address:"",pincode:"",bio:"",joinDate:"",avatar:"",verified:!1}),[o,T]=i.useState({emailNotifications:!0,smsNotifications:!1,pushNotifications:!0,marketingEmails:!1,propertyAlerts:!0,priceDropAlerts:!0}),[F,$]=i.useState({showPhone:!0,showEmail:!1,profileVisibility:"public"}),[d,f]=i.useState({propertiesPosted:0,inquiriesReceived:0,responseRate:0,avgResponseTime:"N/A",rating:0,reviews:0,totalViews:0,totalFavorites:0}),[z,W]=i.useState([]),b=i.useCallback(async()=>{try{M(!0);const[s,a,l]=await Promise.all([y.getCurrentUser(),J.getCustomerDashboardData().catch(()=>null),ue.getCustomerPropertyStats().catch(()=>null)]),r=s.data.user;if(Q(r),x({name:y.getFullName(r),email:r.email,phone:r.profile.phone||"",location:r.profile.address?`${r.profile.address.city||""}, ${r.profile.address.state||""}`.replace(/^,\s*|,\s*$/g,""):"",address:r.profile.address?.street||"",pincode:r.profile.address?.pincode||"",bio:"",joinDate:y.formatCreationDate(r.createdAt),avatar:"",verified:r.emailVerified}),T({emailNotifications:r.preferences?.notifications?.email??!0,smsNotifications:r.preferences?.notifications?.sms??!1,pushNotifications:r.preferences?.notifications?.push??!0,marketingEmails:!1,propertyAlerts:!0,priceDropAlerts:!0}),a?.success){const n=a.data.stats;f(m=>({...m,inquiriesReceived:n.activeInquiries,totalViews:n.propertiesViewed,totalFavorites:n.savedFavorites})),W(a.data.recentActivities.map(m=>({id:m._id,type:m.type,message:m.message,timestamp:m.time,icon:m.icon})))}if(l?.success){const n=l.data;f(m=>({...m,propertiesPosted:n.totalProperties,responseRate:Math.round(n.conversionRate)||0,avgResponseTime:n.averageInquiries>0?"< 2 hours":"N/A"}))}}catch(s){console.error("Error loading user data:",s),le({title:"Error",description:"Failed to load profile data",variant:"destructive"})}finally{M(!1)}},[]),Y=i.useCallback(async()=>{B(!0),await b(),B(!1)},[]);i.useEffect(()=>{b()},[b]);const Z=i.useCallback(()=>{console.log("Profile updated via realtime"),b()},[]),ee=i.useCallback(()=>{f(s=>({...s,inquiriesReceived:s.inquiriesReceived+1}))},[]),se=i.useCallback(()=>{f(s=>({...s,totalViews:s.totalViews+1}))},[]),ae=i.useCallback(s=>{s.action==="add"?f(a=>({...a,totalFavorites:a.totalFavorites+1})):s.action==="remove"&&f(a=>({...a,totalFavorites:Math.max(0,a.totalFavorites-1)}))},[]);R("profile_updated",Z),R("property_inquiry",ee),R("property_viewed",se),R("property_favorited",ae);const te=async()=>{if(_)try{U(!0);const s={profile:{firstName:t.name.split(" ")[0]||"",lastName:t.name.split(" ").slice(1).join(" ")||"",phone:t.phone,address:{street:t.address,city:t.location.split(",")[0]?.trim()||"",state:t.location.split(",")[1]?.trim()||"",pincode:t.pincode}},preferences:{..._.preferences,notifications:{email:o.emailNotifications,sms:o.smsNotifications,push:o.pushNotifications}}};await y.updateCurrentUser(s),await b(),E(!1)}catch(s){console.error("Error saving profile:",s)}finally{U(!1)}},ie=()=>{E(!1)},j=async(s,a)=>{const l={...o,[s]:a};T(l);try{await y.updateUserPreferences({preferences:{notifications:{email:l.emailNotifications,sms:l.smsNotifications,push:l.pushNotifications}}})}catch{T(n=>({...n,[s]:!a}))}},O=async(s,a)=>{const l={...F,[s]:a};$(l);try{await y.updateUserPreferences({preferences:{privacy:l}})}catch{$(n=>({...n,[s]:typeof a=="boolean"?!a:n[s]}))}};return S?e.jsx("div",{className:"space-y-6 pt-24",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-lg",children:"Loading profile..."})})}):e.jsxs("div",{className:"space-y-6 pt-16",children:[e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${q?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-sm text-muted-foreground",children:q?"Real-time profile updates active":"Offline mode"}),V&&e.jsxs(G,{variant:"secondary",className:"text-xs",children:["Last update: ",new Date(V.timestamp).toLocaleTimeString()]})]}),e.jsxs(P,{variant:"outline",size:"sm",onClick:Y,disabled:D,children:[e.jsx(X,{className:`w-4 h-4 mr-2 ${D?"animate-spin":""}`}),D?"Refreshing...":"Refresh"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(ne,{className:"w-8 h-8 text-primary"}),"My Profile"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your personal information and preferences"})]}),!c&&!S&&e.jsxs(P,{onClick:()=>E(!0),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Edit Profile"]})]}),e.jsxs(ce,{defaultValue:"profile",className:"space-y-6",children:[e.jsxs(oe,{className:"grid w-full grid-cols-4",children:[e.jsx(k,{value:"profile",children:"Profile"}),e.jsx(k,{value:"preferences",children:"Preferences"}),e.jsx(k,{value:"privacy",children:"Privacy"}),e.jsx(k,{value:"activity",children:"Activity"})]}),e.jsxs(A,{value:"profile",className:"space-y-6",children:[e.jsx(u,{children:e.jsx(N,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(de,{className:"w-24 h-24",children:[e.jsx(me,{src:t.avatar}),e.jsx(xe,{className:"text-2xl",children:t.name.split(" ").map(s=>s[0]).join("")})]}),c&&e.jsx(P,{size:"icon",variant:"secondary",className:"absolute -bottom-2 -right-2 rounded-full",children:e.jsx(ge,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-2xl font-bold",children:t.name}),t.verified&&e.jsxs(G,{variant:"default",className:"bg-green-100 text-green-800",children:[e.jsx(ve,{className:"w-3 h-3 mr-1"}),"Verified"]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-4 h-4"}),t.email]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-4 h-4"}),t.phone]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"w-4 h-4"}),t.location]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"w-4 h-4"}),"Joined ",t.joinDate]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:d.rating.toFixed(1)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Rating"})]}),e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:d.propertiesPosted}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Properties"})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(u,{children:[e.jsx(w,{children:e.jsx(C,{children:"Personal Information"})}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Full Name"}),c?e.jsx(g,{value:t.name,onChange:s=>x(a=>({...a,name:s.target.value}))}):e.jsx("p",{className:"text-sm",children:t.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Email"}),c?e.jsx(g,{type:"email",value:t.email,onChange:s=>x(a=>({...a,email:s.target.value}))}):e.jsx("p",{className:"text-sm",children:t.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Phone"}),c?e.jsx(g,{value:t.phone,onChange:s=>x(a=>({...a,phone:s.target.value}))}):e.jsx("p",{className:"text-sm",children:t.phone})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Location"}),c?e.jsx(g,{value:t.location,onChange:s=>x(a=>({...a,location:s.target.value}))}):e.jsx("p",{className:"text-sm",children:t.location})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Address"}),c?e.jsx(g,{value:t.address,onChange:s=>x(a=>({...a,address:s.target.value})),placeholder:"Street address"}):e.jsx("p",{className:"text-sm",children:t.address})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Pincode"}),c?e.jsx(g,{value:t.pincode,onChange:s=>x(a=>({...a,pincode:s.target.value})),placeholder:"Postal code"}):e.jsx("p",{className:"text-sm",children:t.pincode})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Bio"}),c?e.jsx(je,{rows:3,value:t.bio,onChange:s=>x(a=>({...a,bio:s.target.value}))}):e.jsx("p",{className:"text-sm",children:t.bio})]}),c&&e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(P,{onClick:te,disabled:I,children:I?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Save Changes"]})}),e.jsxs(P,{variant:"outline",onClick:ie,children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})]}),e.jsxs(u,{children:[e.jsx(w,{children:e.jsx(C,{children:"Account Statistics"})}),e.jsx(N,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm",children:"Properties Posted"})]}),e.jsx("span",{className:"font-semibold",children:d.propertiesPosted})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"Inquiries Received"})]}),e.jsx("span",{className:"font-semibold",children:d.inquiriesReceived})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{className:"text-sm",children:"Total Views"})]}),e.jsx("span",{className:"font-semibold",children:d.totalViews.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-sm",children:"Total Favorites"})]}),e.jsx("span",{className:"font-semibold",children:d.totalFavorites})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-sm",children:"Average Rating"})]}),e.jsxs("span",{className:"font-semibold",children:[d.rating.toFixed(1),"/5.0"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-sm",children:"Response Rate"})]}),e.jsxs("span",{className:"font-semibold",children:[d.responseRate,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"Avg Response Time"})]}),e.jsx("span",{className:"font-semibold",children:d.avgResponseTime})]})]})})]})]})]}),e.jsx(A,{value:"preferences",className:"space-y-6",children:e.jsxs(u,{children:[e.jsx(w,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5"}),"Notification Preferences"]})}),e.jsx(N,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Email Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive updates and alerts via email"})]}),e.jsx(p,{checked:o.emailNotifications,onCheckedChange:s=>j("emailNotifications",s)})]}),e.jsx(v,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"SMS Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Get important updates via text message"})]}),e.jsx(p,{checked:o.smsNotifications,onCheckedChange:s=>j("smsNotifications",s)})]}),e.jsx(v,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Push Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Browser notifications for instant updates"})]}),e.jsx(p,{checked:o.pushNotifications,onCheckedChange:s=>j("pushNotifications",s)})]}),e.jsx(v,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Marketing Emails"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Promotional content and special offers"})]}),e.jsx(p,{checked:o.marketingEmails,onCheckedChange:s=>j("marketingEmails",s)})]}),e.jsx(v,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Property Alerts"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"New properties matching your criteria"})]}),e.jsx(p,{checked:o.propertyAlerts,onCheckedChange:s=>j("propertyAlerts",s)})]}),e.jsx(v,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Price Drop Alerts"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Notifications when saved properties drop in price"})]}),e.jsx(p,{checked:o.priceDropAlerts,onCheckedChange:s=>j("priceDropAlerts",s)})]})]})})]})}),e.jsx(A,{value:"privacy",className:"space-y-6",children:e.jsxs(u,{children:[e.jsx(w,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5"}),"Privacy Settings"]})}),e.jsx(N,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Show Phone Number"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Display your phone number on your public profile"})]}),e.jsx(p,{checked:F.showPhone,onCheckedChange:s=>O("showPhone",s)})]}),e.jsx(v,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Show Email Address"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Display your email address on your public profile"})]}),e.jsx(p,{checked:F.showEmail,onCheckedChange:s=>O("showEmail",s)})]})]})})]})}),e.jsx(A,{value:"activity",className:"space-y-6",children:e.jsxs(u,{children:[e.jsx(w,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"Recent Activity"]})}),e.jsx(N,{children:!S&&z.length>0?e.jsx("div",{className:"space-y-4",children:z.map(s=>{const a=l=>{switch(l){case"property_posted":return"bg-green-500";case"inquiry":return"bg-blue-500";case"favorite":return"bg-red-500";case"search":return"bg-purple-500";default:return"bg-gray-500"}};return e.jsxs("div",{className:"flex items-start gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mt-2 ${a(s.type)}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:J.formatTimeAgo(s.timestamp)})]})]},s.id)})}):S?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading activity..."})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(K,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"No recent activity"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start browsing properties to see your activity here"})]})})]})})]})]})};export{Ze as default};

import{j as e}from"./ui-BHyUY8Z8.js";import{g as E,d as H,r as h}from"./router-2SVJvIbS.js";import{W as V,H as k,f as p,a as j,b as f,c as g,e as v,L as t,I as n,q as W,s as w,v as B,w as L,x as I,y as c,V as D,X as U}from"./index-Bd1eLXM_.js";import{C as d}from"./checkbox-CFGICxZb.js";import{p as S}from"./planService-CRX5BtDQ.js";import{A as q}from"./arrow-left-Dy16oLhe.js";import"./vendor-Dazix4UH.js";const G=()=>{const{id:o}=E(),m=H(),{toast:y}=V(),[s,a]=h.useState(null),[R,N]=h.useState(!0),[b,C]=h.useState(!1),[x,F]=h.useState("");h.useEffect(()=>{(async()=>{if(o)try{N(!0);const r=(await S.getPlan(o)).data.plan,A=r.features.map(u=>typeof u=="string"?{name:u,description:"",enabled:!0}:u);a({...r,features:A,limits:{properties:r.limits?.properties||0,featuredListings:r.limits?.featuredListings||0,photos:r.limits?.photos||10,videoTours:r.limits?.videoTours||0,leads:r.limits?.leads||0,posters:r.limits?.posters||0,topRated:r.limits?.topRated||!1,verifiedBadge:r.limits?.verifiedBadge||!1,messages:r.limits?.messages||1e3},benefits:{topRatedInWebsite:r.benefits?.topRatedInWebsite||!1,verifiedOwnerBadge:r.benefits?.verifiedOwnerBadge||!1,marketingConsultation:r.benefits?.marketingConsultation||!1,commissionBased:r.benefits?.commissionBased||!1}})}catch(l){console.error("Failed to fetch plan:",l),y({title:"Error",description:"Failed to load plan data.",variant:"destructive"}),m("/admin/plans")}finally{N(!1)}})()},[o,m,y]);const T=async i=>{if(i.preventDefault(),!(!s||!o))try{C(!0),await S.updatePlan(o,s),m("/admin/plans")}catch(l){console.error("Failed to update plan:",l)}finally{C(!1)}},P=()=>{if(!s||!x.trim())return;const i={name:x.trim(),description:"",enabled:!0};a({...s,features:[...s.features,i]}),F("")},O=i=>{s&&a({...s,features:s.features.filter((l,r)=>r!==i)})};return R?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(k,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading plan..."})]}):s?e.jsxs("div",{className:"space-y-6 relative top-[60px]",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>m("/admin/plans"),children:e.jsx(q,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Edit Plan"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Update plan details and pricing"})]})]}),e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(g,{children:"Basic Information"})}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"name",children:"Plan Name *"}),e.jsx(n,{id:"name",value:s.name,onChange:i=>a({...s,name:i.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(t,{htmlFor:"description",children:"Description *"}),e.jsx(W,{id:"description",value:s.description,onChange:i=>a({...s,description:i.target.value}),required:!0,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"price",children:"Price *"}),e.jsx(n,{id:"price",type:"number",step:"0.01",min:"0",value:s.price,onChange:i=>a({...s,price:parseFloat(i.target.value)||0}),required:!0}),s.priceHistory&&s.priceHistory.length>1&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Previous price: ₹",s.priceHistory[s.priceHistory.length-2]?.price||"N/A"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"currency",children:"Currency"}),e.jsxs(w,{value:s.currency,onValueChange:i=>a({...s,currency:i}),children:[e.jsx(B,{children:e.jsx(L,{})}),e.jsxs(I,{children:[e.jsx(c,{value:"INR",children:"INR (₹)"}),e.jsx(c,{value:"USD",children:"USD ($)"}),e.jsx(c,{value:"EUR",children:"EUR (€)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"billing",children:"Billing Period *"}),e.jsxs(w,{value:s.billingPeriod,onValueChange:i=>a({...s,billingPeriod:i}),children:[e.jsx(B,{children:e.jsx(L,{})}),e.jsxs(I,{children:[e.jsx(c,{value:"monthly",children:"Monthly"}),e.jsx(c,{value:"yearly",children:"Yearly"}),e.jsx(c,{value:"lifetime",children:"Lifetime"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"sortOrder",children:"Sort Order"}),e.jsx(n,{id:"sortOrder",type:"number",min:"0",value:s.sortOrder,onChange:i=>a({...s,sortOrder:parseInt(i.target.value)||0})})]})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(d,{id:"isActive",checked:s.isActive,onCheckedChange:i=>a({...s,isActive:i})}),e.jsx(t,{htmlFor:"isActive",className:"cursor-pointer",children:"Active"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(d,{id:"isPopular",checked:s.isPopular,onCheckedChange:i=>a({...s,isPopular:i})}),e.jsx(t,{htmlFor:"isPopular",className:"cursor-pointer",children:"Mark as Popular"})]})]})]})]}),e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(g,{children:"Limits & Benefits"})}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"properties",children:"Properties Limit"}),e.jsx(n,{id:"properties",type:"number",min:"-1",value:s.limits.properties,onChange:i=>a({...s,limits:{...s.limits,properties:parseInt(i.target.value)||0}})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"0 = unlimited"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"leads",children:"Leads Limit"}),e.jsx(n,{id:"leads",type:"number",min:"0",value:s.limits.leads,onChange:i=>a({...s,limits:{...s.limits,leads:parseInt(i.target.value)||0}})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Monthly limit"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"posters",children:"Promotional Posters"}),e.jsx(n,{id:"posters",type:"number",min:"0",value:s.limits.posters,onChange:i=>a({...s,limits:{...s.limits,posters:parseInt(i.target.value)||0}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"featuredListings",children:"Featured Listings"}),e.jsx(n,{id:"featuredListings",type:"number",min:"0",value:s.limits.featuredListings,onChange:i=>a({...s,limits:{...s.limits,featuredListings:parseInt(i.target.value)||0}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"photos",children:"Photos per Property"}),e.jsx(n,{id:"photos",type:"number",min:"0",value:s.limits.photos,onChange:i=>a({...s,limits:{...s.limits,photos:parseInt(i.target.value)||0}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"videoTours",children:"Video Tours"}),e.jsx(n,{id:"videoTours",type:"number",min:"0",value:s.limits.videoTours,onChange:i=>a({...s,limits:{...s.limits,videoTours:parseInt(i.target.value)||0}})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold",children:"Benefits"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(d,{id:"topRated",checked:s.benefits?.topRatedInWebsite||!1,onCheckedChange:i=>a({...s,benefits:{...s.benefits,topRatedInWebsite:i}})}),e.jsx(t,{htmlFor:"topRated",className:"cursor-pointer",children:"Top Rated in Website"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(d,{id:"verifiedBadge",checked:s.benefits?.verifiedOwnerBadge||!1,onCheckedChange:i=>a({...s,benefits:{...s.benefits,verifiedOwnerBadge:i}})}),e.jsx(t,{htmlFor:"verifiedBadge",className:"cursor-pointer",children:"Verified Owner Badge"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(d,{id:"marketing",checked:s.benefits?.marketingConsultation||!1,onCheckedChange:i=>a({...s,benefits:{...s.benefits,marketingConsultation:i}})}),e.jsx(t,{htmlFor:"marketing",className:"cursor-pointer",children:"Marketing Consultation"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(d,{id:"commission",checked:s.benefits?.commissionBased||!1,onCheckedChange:i=>a({...s,benefits:{...s.benefits,commissionBased:i}})}),e.jsx(t,{htmlFor:"commission",className:"cursor-pointer",children:"Commission Based"})]})]})]})]})]}),e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(g,{children:"Features"})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{placeholder:"Add a new feature...",value:x,onChange:i=>F(i.target.value),onKeyPress:i=>i.key==="Enter"&&(i.preventDefault(),P())}),e.jsx(p,{type:"button",onClick:P,size:"icon",children:e.jsx(D,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-2",children:s.features.map((i,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[e.jsx("span",{className:"text-sm",children:i.name}),e.jsx(p,{type:"button",variant:"ghost",size:"icon",onClick:()=>O(l),children:e.jsx(U,{className:"w-4 h-4"})})]},l))})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(p,{type:"submit",disabled:b,children:[b&&e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Changes"]}),e.jsx(p,{type:"button",variant:"outline",onClick:()=>m("/admin/plans"),children:"Cancel"})]})]})]}):e.jsx("div",{children:"Plan not found"})};export{G as default};

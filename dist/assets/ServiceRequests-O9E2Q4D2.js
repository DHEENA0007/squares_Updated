import{j as e}from"./ui-CEt46o3G.js";import{r as d}from"./router-2SVJvIbS.js";import{C as x,d as u}from"./card-YvDMUmzt.js";import{c as te,O as re,t as q,R as E,a1 as k,a as h,P as $,T as ae,h as ie,i as O,v as M,S as le,I as ce,B as y,K as B,M as ne,A as oe,j as de,k as me,z as H,o as xe,E as ue}from"./index-CiYV0Sy0.js";import{S,a as b,b as w,c as C,d as c}from"./select-BHWxeluH.js";import{D as he,f as pe,a as ge,b as je,c as ve}from"./dialog-B2oiH0OC.js";import{T as fe}from"./textarea-BbecYreM.js";import{L as T}from"./label-BV_cIshD.js";import{R as Ne}from"./refresh-cw-B8zbtsbT.js";import{P as ye}from"./phone-BlyPoB6i.js";import{F as V}from"./file-text-BHu0z9sa.js";import{C as z}from"./circle-x-CEHPKjJl.js";import{T as Se}from"./truck-DK_R_OBX.js";import{C as U}from"./clock-oZpCo30L.js";import{C as be}from"./circle-check-big-CdpP5k9T.js";import{C as we}from"./circle-alert-_lmm6JT-.js";import"./vendor-Dazix4UH.js";import"./index-BdQq_4o_.js";import"./index-DHzxUTm5.js";import"./chevron-down-DeDu0PPf.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=te("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),Pe="https://squares-9d84.onrender.com/api";class Re{async makeRequest(t,r={}){const a=`${Pe}${t}`,l={headers:{"Content-Type":"application/json",...r.headers},...r},o=localStorage.getItem("token");o&&(l.headers={...l.headers,Authorization:`Bearer ${o}`});try{const i=await fetch(a,l);if(!i.ok){const N=await i.json().catch(()=>({}));throw new Error(N.message||`${i.statusText} - ${t}`)}return await i.json()}catch(i){throw console.error("Service Request API request failed:",i),i}}async getServiceRequests(t={}){try{const r=new URLSearchParams;Object.entries(t).forEach(([o,i])=>{i!=null&&i!==""&&r.append(o,String(i))});const a=`/services/requests${r.toString()?`?${r.toString()}`:""}`,l=await this.makeRequest(a);return l.success&&l.data?l.data:{requests:[],pagination:{currentPage:1,totalPages:0,totalCount:0,hasNextPage:!1,hasPrevPage:!1,limit:10}}}catch(r){throw console.error("Failed to fetch service requests:",r),r}}async createServiceRequest(t){try{const r=await this.makeRequest("/services/requests",{method:"POST",body:JSON.stringify(t)});return r.success&&r.data?r.data.request:null}catch(r){throw console.error("Failed to create service request:",r),r}}async updateServiceRequest(t,r){try{const a=await this.makeRequest(`/services/requests/${t}`,{method:"PUT",body:JSON.stringify(r)});return a.success&&a.data?a.data.request:null}catch(a){throw console.error("Failed to update service request:",a),a}}async cancelServiceRequest(t,r){try{return(await this.makeRequest(`/services/requests/${t}/cancel`,{method:"POST",body:JSON.stringify({reason:r})})).success}catch(a){throw console.error("Failed to cancel service request:",a),a}}async rateServiceRequest(t,r,a){try{return(await this.makeRequest(`/services/requests/${t}/rate`,{method:"POST",body:JSON.stringify({rating:r,review:a})})).success}catch(l){throw console.error("Failed to rate service request:",l),l}}async getServiceProviders(t={}){try{const r=new URLSearchParams;Object.entries(t).forEach(([o,i])=>{i!=null&&i!==""&&r.append(o,String(i))});const a=`/services/providers${r.toString()?`?${r.toString()}`:""}`,l=await this.makeRequest(a);return l.success&&l.data?l.data:{providers:[],pagination:{currentPage:1,totalPages:0,totalCount:0,hasNextPage:!1,hasPrevPage:!1,limit:12}}}catch(r){throw console.error("Failed to fetch service providers:",r),r}}async getServiceCategories(){try{const t=await this.makeRequest("/services/categories");return t.success&&t.data?t.data.categories:[]}catch(t){throw console.error("Failed to fetch service categories:",t),t}}formatCurrency(t){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)}getServiceTypeLabel(t){return{home_loan:"Home Loans",movers:"Packers & Movers",legal:"Legal Services",interior:"Interior Design",cleaning:"Cleaning Services",security:"Security Services"}[t]||t}getStatusColor(t){return{pending:"bg-yellow-100 text-yellow-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"}[t]||"bg-gray-100 text-gray-800"}getPriorityColor(t){return{low:"bg-gray-100 text-gray-800",medium:"bg-orange-100 text-orange-800",high:"bg-red-100 text-red-800"}[t]||"bg-gray-100 text-gray-800"}getStatusText(t){return{pending:"Pending",in_progress:"In Progress",completed:"Completed",cancelled:"Cancelled"}[t]||t}}const p=new Re,Xe=()=>{const{isConnected:P}=re(),[t,r]=d.useState("active"),[a,l]=d.useState(""),[o,i]=d.useState([]),[N,J]=d.useState([]),[L,D]=d.useState(!0),[g,K]=d.useState("all"),[j,Q]=d.useState("all"),[G,v]=d.useState(!1),[F,qe]=d.useState(1),[ke,X]=d.useState(1),R=d.useCallback(async()=>{try{D(!0);const s=await p.getServiceRequests({page:F,limit:10,status:g!=="all"?g:void 0,serviceType:j!=="all"?j:void 0,sortBy:"created_at",sortOrder:"desc"});i(s.requests||[]),X(s.pagination.totalPages)}catch(s){console.error("Error loading service requests:",s),q({title:"Error",description:"Failed to load service requests. Please try again.",variant:"destructive"})}finally{D(!1)}},[F,g,j]),I=d.useCallback(async()=>{try{const s=await p.getServiceCategories();J(s||[])}catch(s){console.error("Error loading service categories:",s)}},[]);E("service_request_updated",s=>{i(n=>n.map(m=>m.id===s.requestId?{...m,...s.updates}:m))}),E("service_request_created",s=>{i(n=>[s.request,...n])}),d.useEffect(()=>{R(),I()},[R,I]);const W=async s=>{try{if(!window.confirm("Are you sure you want to cancel this service request?"))return;await p.cancelServiceRequest(s),q({title:"Success",description:"Service request cancelled successfully"}),R()}catch(n){console.error("Error cancelling request:",n),q({title:"Error",description:"Failed to cancel request",variant:"destructive"})}},A=[{id:"home_loan",name:"Home Loans",icon:ue,description:"Get competitive home loan rates",color:"bg-blue-500"},{id:"movers",name:"Packers & Movers",icon:Se,description:"Professional moving services",color:"bg-green-500"},{id:"legal",name:"Legal Services",icon:V,description:"Property legal assistance",color:"bg-purple-500"},{id:"interior",name:"Interior Design",icon:B,description:"Transform your space",color:"bg-orange-500"}],Y=s=>p.getStatusText(s),Z=s=>{switch(s){case"pending":return U;case"in_progress":return we;case"completed":return be;case"cancelled":return z;default:return U}},ee=s=>p.getStatusColor(s),_=o.filter(s=>{const n=s.title.toLowerCase().includes(a.toLowerCase())||s.description.toLowerCase().includes(a.toLowerCase()),m=g==="all"||s.status===g,se=j==="all"||s.serviceType===j;return n&&m&&se}),f={total:o.length,pending:o.filter(s=>s.status==="pending").length,inProgress:o.filter(s=>s.status==="in_progress").length,completed:o.filter(s=>s.status==="completed").length,totalAmount:o.reduce((s,n)=>s+(n.amount||0),0)};return e.jsxs("div",{className:"space-y-6 pt-16",children:[e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${P?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-sm text-muted-foreground",children:P?"Real-time service updates active":"Offline mode"})]}),L&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"}),"Loading requests..."]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(k,{className:"w-8 h-8 text-primary"}),"Service Requests"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Request and manage property-related services"})]}),e.jsxs(he,{open:G,onOpenChange:v,children:[e.jsx(pe,{asChild:!0,children:e.jsxs(h,{children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"New Request"]})}),e.jsxs(ge,{children:[e.jsx(je,{children:e.jsx(ve,{children:"Request New Service"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(T,{children:"Service Type"}),e.jsxs(S,{children:[e.jsx(b,{children:e.jsx(w,{placeholder:"Select service type"})}),e.jsxs(C,{children:[e.jsx(c,{value:"home_loan",children:"Home Loan"}),e.jsx(c,{value:"movers",children:"Packers & Movers"}),e.jsx(c,{value:"legal",children:"Legal Services"}),e.jsx(c,{value:"interior",children:"Interior Design"})]})]})]}),e.jsxs("div",{children:[e.jsx(T,{children:"Description"}),e.jsx(fe,{placeholder:"Describe your requirements..."})]}),e.jsxs("div",{children:[e.jsx(T,{children:"Property (Optional)"}),e.jsxs(S,{children:[e.jsx(b,{children:e.jsx(w,{placeholder:"Select property"})}),e.jsxs(C,{children:[e.jsx(c,{value:"1",children:"Luxury 3BHK Apartment - Powai"}),e.jsx(c,{value:"2",children:"Modern Villa - Baner"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{onClick:()=>v(!1),className:"flex-1",children:"Submit Request"}),e.jsx(h,{variant:"outline",onClick:()=>v(!1),children:"Cancel"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(x,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:f.total}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Requests"})]})})}),e.jsx(x,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:f.pending}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending"})]})})}),e.jsx(x,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:f.inProgress}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"In Progress"})]})})}),e.jsx(x,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:f.completed}),e.jsx("p",{className:"text-sm text-muted-forequest",children:"Completed"})]})})}),e.jsx(x,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-2xl font-bold",children:["₹",(f.totalAmount/1e5).toFixed(1),"L"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Value"})]})})})]}),e.jsxs(ae,{defaultValue:"requests",className:"space-y-6",children:[e.jsxs(ie,{children:[e.jsx(O,{value:"requests",children:"My Requests"}),e.jsx(O,{value:"services",children:"Browse Services"})]}),e.jsxs(M,{value:"requests",className:"space-y-6",children:[e.jsx(x,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ce,{type:"text",placeholder:"Search requests...",className:"pl-10",value:a,onChange:s=>l(s.target.value)})]}),e.jsxs(S,{value:g,onValueChange:s=>K(s),children:[e.jsx(b,{className:"w-full sm:w-40",children:e.jsx(w,{placeholder:"Status"})}),e.jsxs(C,{children:[e.jsx(c,{value:"all",children:"All Status"}),e.jsx(c,{value:"pending",children:"Pending"}),e.jsx(c,{value:"in_progress",children:"In Progress"}),e.jsx(c,{value:"completed",children:"Completed"}),e.jsx(c,{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs(S,{value:j,onValueChange:Q,children:[e.jsx(b,{className:"w-full sm:w-40",children:e.jsx(w,{placeholder:"Service"})}),e.jsxs(C,{children:[e.jsx(c,{value:"all",children:"All Services"}),e.jsx(c,{value:"home_loan",children:"Home Loans"}),e.jsx(c,{value:"movers",children:"Movers"}),e.jsx(c,{value:"legal",children:"Legal"}),e.jsx(c,{value:"interior",children:"Interior"})]})]})]})})}),e.jsx("div",{className:"space-y-4",children:L?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ne,{className:"w-8 h-8 animate-spin mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading service requests..."})]}):_.length===0?e.jsx(x,{children:e.jsxs(u,{className:"p-12 text-center",children:[e.jsx(k,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No service requests found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:a||g!=="all"||j!=="all"?"Try adjusting your filters":"Create your first service request to get started"}),e.jsxs(h,{onClick:()=>v(!0),children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"New Request"]})]})}):_.map(s=>{const n=Z(s.status);return e.jsx(x,{children:e.jsx(u,{className:"p-6",children:e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-start gap-6",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"text-xl font-semibold",children:s.title}),e.jsx(y,{variant:"outline",className:"text-xs",children:p.getServiceTypeLabel(s.serviceType)})]}),e.jsx("p",{className:"text-muted-foreground mb-3",children:s.description}),s.property&&e.jsxs("div",{className:"bg-muted/50 p-3 rounded-lg mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(B,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:s.property.title})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.property.city,", ",s.property.state]})]})]}),s.provider&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg mb-3",children:[e.jsxs(oe,{children:[e.jsx(de,{src:s.provider.avatar}),e.jsx(me,{children:s.provider.name.substring(0,2)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.provider.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ye,{className:"w-3 h-3"}),e.jsx("span",{children:s.provider.phone}),s.provider.rating&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx(H,{className:"w-3 h-3 fill-yellow-400 text-yellow-400"}),e.jsx("span",{children:s.provider.rating.toFixed(1)})]})]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs(y,{className:`${ee(s.status)} mb-2`,children:[e.jsx(n,{className:"w-3 h-3 mr-1"}),Y(s.status)]}),s.amount&&e.jsx(e.Fragment,{children:e.jsx("p",{className:"text-2xl font-bold text-primary",children:p.formatCurrency(s.amount)})}),s.priority&&e.jsx(y,{variant:"outline",className:`mt-2 ${p.getPriorityColor(s.priority)}`,children:s.priority.toUpperCase()})]})]}),s.status==="in_progress"&&s.progress!==void 0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"Progress"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.progress,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${s.progress}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm text-muted-foreground mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block",children:"Created"}),e.jsx("span",{className:"font-medium",children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block",children:"Updated"}),e.jsx("span",{className:"font-medium",children:new Date(s.updatedAt).toLocaleDateString()})]}),s.estimatedCompletion&&e.jsxs("div",{children:[e.jsx("span",{className:"block",children:"Est. Completion"}),e.jsx("span",{className:"font-medium",children:new Date(s.estimatedCompletion).toLocaleDateString()})]})]}),s.documents&&s.documents.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-sm font-medium mb-2",children:"Documents"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.documents.map(m=>e.jsxs(y,{variant:"outline",className:"text-xs",children:[e.jsx(V,{className:"w-3 h-3 mr-1"}),m.document_type]},m.id))})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.provider&&e.jsxs(h,{size:"sm",variant:"outline",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Contact Provider"]}),s.status==="pending"&&e.jsxs(h,{size:"sm",variant:"destructive",onClick:()=>W(s.id),children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Cancel Request"]}),s.status==="completed"&&e.jsxs(h,{size:"sm",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Rate Service"]}),e.jsxs(h,{size:"sm",variant:"outline",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"View Details"]})]})]})})})},s.id)})})]}),e.jsx(M,{value:"services",className:"space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(N.length>0?N:A).map(s=>{const n=A.find(m=>m.id===s.id)?.icon||k;return e.jsx(x,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`${s.color||"bg-primary"} w-16 h-16 rounded-lg flex items-center justify-center mx-auto mb-4`,children:e.jsx(n,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s.name}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:s.description}),e.jsx("div",{className:"space-y-2 text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Providers:"}),e.jsx("span",{className:"font-semibold",children:s.providerCount||0})]})}),e.jsx(h,{className:"w-full mt-4",onClick:()=>v(!0),children:"Request Service"})]})})},s.id)})})})]})]})};export{Xe as default};

import{D as n,t as s}from"./index-Bd1eLXM_.js";class d{baseUrl="https://api.akodefy.com/api";async makeRequest(t,e={}){const r=`${this.baseUrl}${t}`,o={headers:{"Content-Type":"application/json",...e.headers},...e},a=n.getToken();a&&(o.headers={...o.headers,Authorization:`Bearer ${a}`});try{const i=await fetch(r,o);if(!i.ok){const c=await i.json().catch(()=>({success:!1,message:`HTTP ${i.status}: ${i.statusText}`}));throw new Error(c.message||"An error occurred")}return await i.json()}catch(i){throw console.error("API request failed:",i),i}}async getUsers(t={}){try{const e=new URLSearchParams;Object.entries(t).forEach(([a,i])=>{i!=null&&i!==""&&e.append(a,String(i))});const r=`/users${e.toString()?`?${e.toString()}`:""}`;return await this.makeRequest(r)}catch(e){const r=e instanceof Error?e.message:"Failed to fetch users";throw s({title:"Error",description:r,variant:"destructive"}),e}}async getUser(t){try{return await this.makeRequest(`/users/${t}`)}catch(e){const r=e instanceof Error?e.message:"Failed to fetch user";throw s({title:"Error",description:r,variant:"destructive"}),e}}async createUser(t){try{const e=await this.makeRequest("/users",{method:"POST",body:JSON.stringify(t)});return s({title:"Success",description:"User created successfully!"}),e}catch(e){const r=e instanceof Error?e.message:"Failed to create user";throw s({title:"Error",description:r,variant:"destructive"}),e}}async updateUser(t,e){try{const r=await this.makeRequest(`/users/${t}`,{method:"PUT",body:JSON.stringify(e)});return s({title:"Success",description:"User updated successfully!"}),r}catch(r){const o=r instanceof Error?r.message:"Failed to update user";throw s({title:"Error",description:o,variant:"destructive"}),r}}async deleteUser(t){try{await this.makeRequest(`/users/${t}`,{method:"DELETE"}),s({title:"Success",description:"User deleted successfully!"})}catch(e){const r=e instanceof Error?e.message:"Failed to delete user";throw s({title:"Error",description:r,variant:"destructive"}),e}}async updateUserStatus(t,e){try{const r=await this.makeRequest(`/users/${t}/status`,{method:"PATCH",body:JSON.stringify({status:e})});return s({title:"Success",description:`User status updated to ${e}!`}),r}catch(r){const o=r instanceof Error?r.message:"Failed to update user status";throw s({title:"Error",description:o,variant:"destructive"}),r}}async getCurrentUser(){try{return await this.makeRequest("/auth/me")}catch(t){const e=t instanceof Error?t.message:"Failed to fetch current user";throw s({title:"Error",description:e,variant:"destructive"}),t}}async updateCurrentUser(t){try{console.log("Update data being sent:",t),t.profile&&(t.profile.preferences===void 0?t.profile.preferences={notifications:{email:!0,sms:!1,push:!0},privacy:{showEmail:!1,showPhone:!1}}:t.profile.preferences&&(t.profile.preferences.notifications||(t.profile.preferences.notifications={email:!0,sms:!1,push:!0}),t.profile.preferences.privacy||(t.profile.preferences.privacy={showEmail:!1,showPhone:!1}))),console.log("Cleaned update data:",t);let e=null;const r=n.getStoredUser();if(console.log("Stored user data:",r),r&&(r.id||r._id)&&(e=r.id||r._id),!e){console.log("No stored user ID, getting from API...");const a=await this.getCurrentUser();console.log("API response:",a),e=a.data?.user?._id}if(!e)throw console.error("No user ID available"),new Error("Unable to get user ID. Please log in again.");console.log("Updating user with ID:",e);const o=await this.makeRequest(`/users/${e}`,{method:"PUT",body:JSON.stringify(t)});return s({title:"Success",description:"Profile updated successfully!"}),o}catch(e){const r=e instanceof Error?e.message:"Failed to update profile";throw console.error("Update profile error:",e),s({title:"Error",description:r,variant:"destructive"}),e}}async updateUserPreferences(t){try{let e=null;const r=n.getStoredUser();if(r&&r.id&&(e=r.id),e||(e=(await this.getCurrentUser()).data.user._id),!e)throw new Error("Unable to get user ID. Please log in again.");return await this.makeRequest(`/users/${e}`,{method:"PUT",body:JSON.stringify(t)})}catch(e){const r=e instanceof Error?e.message:"Failed to update preferences";throw s({title:"Error",description:r,variant:"destructive"}),e}}async updatePassword(t){try{const e=await this.makeRequest("/auth/change-password",{method:"POST",body:JSON.stringify({password:t})});return s({title:"Success",description:"Password updated successfully!"}),e}catch(e){const r=e instanceof Error?e.message:"Failed to update password";throw s({title:"Error",description:r,variant:"destructive"}),e}}async requestPasswordChangeOTP(t){try{const e=await this.makeRequest("/auth/request-password-change-otp",{method:"POST",body:JSON.stringify({currentPassword:t})});return s({title:"OTP Sent",description:"Please check your email for the verification code"}),e}catch(e){const r=e instanceof Error?e.message:"Failed to send OTP";throw s({title:"Error",description:r,variant:"destructive"}),e}}async changePasswordWithOTP(t,e){try{const r=await this.makeRequest("/auth/change-password-with-otp",{method:"POST",body:JSON.stringify({otp:t,newPassword:e})});return s({title:"Success",description:"Password changed successfully!"}),r}catch(r){const o=r instanceof Error?r.message:"Failed to change password";throw s({title:"Error",description:o,variant:"destructive"}),r}}async changePassword(t,e){try{const r=await this.makeRequest("/auth/change-password",{method:"POST",body:JSON.stringify({currentPassword:t,newPassword:e})});return r.requiresOTP?(s({title:"Enhanced Security",description:r.message,variant:"default"}),r):(s({title:"Success",description:"Password changed successfully!"}),r)}catch(r){const o=r instanceof Error?r.message:"Failed to change password";throw s({title:"Error",description:o,variant:"destructive"}),r}}async sendOTP(t,e){try{const r=await this.makeRequest("/auth/send-otp",{method:"POST",body:JSON.stringify({email:t,firstName:e})});return s({title:"OTP Sent",description:`Verification code sent to ${t}. Valid for ${r.expiryMinutes} minutes.`}),r}catch(r){const o=r instanceof Error?r.message:"Failed to send OTP";throw s({title:"Error",description:o,variant:"destructive"}),new Error(o)}}async verifyOTP(t,e){try{const r=await this.makeRequest("/auth/verify-otp",{method:"POST",body:JSON.stringify({email:t,otp:e})});return r.success&&s({title:"Email Verified",description:"Your email has been verified successfully!"}),r}catch(r){const o=r instanceof Error?r.message:"Failed to verify OTP";throw s({title:"Verification Failed",description:o,variant:"destructive"}),new Error(o)}}getFullName(t){return`${t.profile.firstName} ${t.profile.lastName}`.trim()}formatCreationDate(t){return new Date(t).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})}}const p=new d;export{p as u};

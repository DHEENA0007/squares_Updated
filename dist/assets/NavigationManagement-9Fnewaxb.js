import{j as e}from"./ui-s1SEoZIF.js";import{r as a,d as s}from"./router-D8v2YSKU.js";import{D as t,a2 as i,a3 as r,af as l,ag as n,ah as d,ai as c,a4 as o,a5 as h,a6 as u,a7 as p,a8 as m,L as x,I as g,q as y,r as v,s as j,v as N,w as f,f as b,ae as C,a9 as w,aa as S,ab as k,B as L,ac as O,ad as A,H as F,u as I,ak as P,a as q,e as E}from"./index-xsqbJ4m0.js";import{T as M,a as T,b as _,c as z,d as V,e as D}from"./table-B_mPL_j-.js";import{P as R}from"./pencil-BdonbVNp.js";import{A as U,a as H}from"./alert-Dux5JL-p.js";import"./vendor-BxThA0WO.js";const J=t("FolderTree",[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]]),$=t("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),B=()=>{const[s,t]=a.useState([]),[F,I]=a.useState([]),[P,q]=a.useState([]),[E,U]=a.useState(!0),[H,J]=a.useState(!1),[B,G]=a.useState(null),[Q,Z]=a.useState("all"),[W,K]=a.useState(""),[X,Y]=a.useState({name:"",value:"",displayLabel:"",category:"",parentId:"",queryParams:"",displayOrder:0}),{toast:ee}=i();a.useEffect(()=>{te(),ae(),se()},[]);const ae=async()=>{try{const e=await r.getFilterConfigurationsByType("listing_type",!1);I(e)}catch(e){}},se=async()=>{try{const e=await r.getNavigationCategories();q(e.filter(e=>e.isActive))}catch(e){}},te=async()=>{try{U(!0);const e=await r.getAllNavigationItems(!0);t(e)}catch(e){ee({title:"Error",description:"Failed to fetch navigation items",variant:"destructive"})}finally{U(!1)}},ie=e=>{if(e)G(e),Y({name:e.name,value:e.value,displayLabel:e.displayLabel||"",category:e.category,parentId:e.parentId||"",queryParams:e.queryParams?JSON.stringify(e.queryParams):"",displayOrder:e.displayOrder});else{G(null);const e=P.length>0?P[0].value:"";Y({name:"",value:"",displayLabel:"",category:e,parentId:"all"===Q?"":Q,queryParams:"",displayOrder:s.length})}J(!0)},re=()=>{J(!1),G(null);const e=P.length>0?P[0].value:"";Y({name:"",value:"",displayLabel:"",category:e,parentId:"",queryParams:"",displayOrder:0})},le=async(e,a,t)=>{const i=(e=>s.filter(a=>a.category===e))(t),l=i.findIndex(a=>a._id===e);if("up"===a&&0===l||"down"===a&&l===i.length-1)return;const n=[...i],d="up"===a?l-1:l+1;[n[l],n[d]]=[n[d],n[l]];try{await Promise.all(n.map((e,a)=>r.updateNavigationItem(e._id,{displayOrder:a}))),te(),ee({title:"Success",description:"Navigation items reordered successfully"})}catch(c){ee({title:"Error",description:"Failed to reorder navigation items",variant:"destructive"})}},ne=a=>{const t=null===a?s.filter(e=>!e.parentId):(e=>s.filter(a=>a.parentId===e))(a),i=t.filter(e=>e.name.toLowerCase().includes(W.toLowerCase())||e.displayLabel?.toLowerCase().includes(W.toLowerCase())||e.value.toLowerCase().includes(W.toLowerCase())),l=a?F.find(e=>e.value===a):null,n=l?l.displayLabel||l.name:"Unassigned";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:l?`Property types shown under "${n}" in the navbar dropdown`:"Property types not yet assigned to any listing type"}),e.jsxs(b,{onClick:()=>ie(),children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Add Property Type"]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(g,{placeholder:"Search navigation items...",value:W,onChange:e=>K(e.target.value),className:"max-w-sm"})}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(M,{children:[e.jsx(T,{children:e.jsxs(_,{children:[e.jsx(z,{className:"w-[100px]",children:"Order"}),e.jsx(z,{children:"Name"}),e.jsx(z,{children:"Display Label"}),e.jsx(z,{children:"Category"}),e.jsx(z,{children:"Value"}),e.jsx(z,{children:"Listing Type"}),e.jsx(z,{children:"Status"}),e.jsx(z,{className:"text-right w-[120px]",children:"Actions"})]})}),e.jsx(V,{children:0===i.length?e.jsx(_,{children:e.jsx(D,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:W?"No navigation items match your search.":l?`No property types assigned to "${n}" yet. Create one to get started.`:"No unassigned property types. All items are assigned to listing types."})}):i.map((s,i)=>{const l=t.findIndex(e=>e._id===s._id);return e.jsxs(_,{children:[e.jsx(D,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>le(s._id,"up",a),disabled:0===l,children:e.jsx(S,{className:"h-4 w-4"})}),e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>le(s._id,"down",a),disabled:l===t.length-1,children:e.jsx(k,{className:"h-4 w-4"})})]})}),e.jsx(D,{className:"font-medium",children:s.name}),e.jsx(D,{children:s.displayLabel||"-"}),e.jsx(D,{children:e.jsx(L,{variant:"outline",children:s.category})}),e.jsx(D,{children:e.jsx("code",{className:"text-sm bg-muted px-2 py-1 rounded",children:s.value})}),e.jsx(D,{children:s.parentId?e.jsx(L,{variant:"secondary",children:F.find(e=>e.value===s.parentId)?.displayLabel||s.parentId}):e.jsx(L,{variant:"outline",children:"Unassigned"})}),e.jsx(D,{children:e.jsx(O,{checked:s.isActive,onCheckedChange:()=>(async(e,a)=>{try{await r.updateNavigationItem(e,{isActive:!a}),ee({title:"Success",description:`Navigation item ${a?"deactivated":"activated"} successfully`}),te()}catch(s){ee({title:"Error",description:"Failed to update navigation item status",variant:"destructive"})}})(s._id,s.isActive)})}),e.jsx(D,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>ie(s),children:e.jsx(R,{className:"h-4 w-4"})}),e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this navigation item? This action cannot be undone."))try{await r.deleteNavigationItem(e),ee({title:"Success",description:"Navigation item deleted successfully"}),te()}catch(a){ee({title:"Error",description:"Failed to delete navigation item",variant:"destructive"})}})(s._id),children:e.jsx(A,{className:"h-4 w-4 text-destructive"})})]})})]},s._id)})})]})})]})};return E?e.jsx("div",{className:"text-center py-8",children:"Loading navigation..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Navigation Property Types"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Create property types and assign them to listing types. They will appear as dropdown options in the navbar."})]}),0===F.length?e.jsx("div",{className:"border rounded-lg p-8 text-center",children:e.jsxs("p",{className:"text-muted-foreground",children:["No listing types found. Please create listing types in ",e.jsx("strong",{children:"Filter Management"})," first (e.g., For Sale, For Rent)."]})}):e.jsxs(l,{value:Q,onValueChange:Z,children:[e.jsxs(n,{className:"w-full justify-start overflow-x-auto flex-wrap h-auto",children:[e.jsx(d,{value:"all",className:"flex-shrink-0",children:"All / Unassigned"}),F.map(a=>e.jsx(d,{value:a.value,className:"flex-shrink-0",children:a.displayLabel||a.name},a._id))]}),e.jsx(c,{value:"all",children:ne(null)}),F.map(a=>e.jsx(c,{value:a.value,children:ne(a.value)},a._id))]}),e.jsx(o,{open:H,onOpenChange:e=>{e||re()},children:e.jsxs(h,{className:"max-w-2xl",children:[e.jsxs(u,{children:[e.jsx(p,{children:B?"Edit Property Type":"Add Property Type"}),e.jsx(m,{children:"Configure property type with name, value, and assign it to a listing type"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"name",children:"Name *"}),e.jsx(g,{id:"name",value:X.name,onChange:e=>Y({...X,name:e.target.value}),placeholder:"e.g., Flat / Apartment",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"value",children:"Value *"}),e.jsx(g,{id:"value",value:X.value,onChange:e=>Y({...X,value:e.target.value}),placeholder:"e.g., apartment",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"displayLabel",children:"Display Label (Optional)"}),e.jsx(g,{id:"displayLabel",value:X.displayLabel,onChange:e=>Y({...X,displayLabel:e.target.value}),placeholder:"Defaults to Name if not provided"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"category",children:"Category *"}),e.jsxs(y,{value:X.category,onValueChange:e=>Y({...X,category:e}),children:[e.jsx(v,{children:e.jsx(j,{placeholder:"Select category..."})}),e.jsx(N,{children:0===P.length?e.jsx(f,{value:"",disabled:!0,children:"No categories available"}):P.map(a=>e.jsx(f,{value:a.value,children:a.label},a.value))})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Manage categories in Configuration Management"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"parentId",children:"Listing Type (Parent)"}),e.jsxs(y,{value:X.parentId||"none",onValueChange:e=>Y({...X,parentId:"none"===e?"":e}),children:[e.jsx(v,{children:e.jsx(j,{placeholder:"Select listing type..."})}),e.jsxs(N,{children:[e.jsx(f,{value:"none",children:"No parent (top level)"}),F.map(a=>e.jsx(f,{value:a.value,children:a.displayLabel||a.name},a._id))]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select which listing type (For Sale, For Rent) this property appears under"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"displayOrder",children:"Display Order"}),e.jsx(g,{id:"displayOrder",type:"number",value:X.displayOrder,onChange:e=>Y({...X,displayOrder:parseInt(e.target.value)||0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{htmlFor:"queryParams",children:"Query Parameters (JSON)"}),e.jsxs(b,{type:"button",variant:"outline",size:"sm",onClick:()=>{const e={};if(X.value&&(e.propertyType=X.value),X.parentId){const a=F.find(e=>e.value===X.parentId);a&&(e.listingType=a.value)}X.category&&(e.category=X.category);const a=Object.keys(e).length>0?JSON.stringify(e,null,2):"";Y({...X,queryParams:a}),ee({title:"Success",description:"Query parameters generated automatically"})},className:"h-8",children:[e.jsx($,{className:"h-3.5 w-3.5 mr-1.5"}),"Generate"]})]}),e.jsx(g,{id:"queryParams",value:X.queryParams,onChange:e=>Y({...X,queryParams:e.target.value}),placeholder:'{"listingType": "sale", "propertyType": "apartment"}'}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'Optional: JSON object for URL query parameters. Click "Generate" to auto-create based on form values.'})]})]}),e.jsxs(C,{children:[e.jsx(b,{variant:"outline",onClick:re,children:"Cancel"}),e.jsx(b,{onClick:async()=>{try{let a;if(X.queryParams&&X.queryParams.trim())try{a=JSON.parse(X.queryParams)}catch(e){return void ee({title:"Error",description:"Invalid JSON format for query parameters",variant:"destructive"})}const s={name:X.name,value:X.value,displayLabel:X.displayLabel||void 0,category:X.category,parentId:X.parentId||void 0,queryParams:a,displayOrder:X.displayOrder};B?(await r.updateNavigationItem(B._id,s),ee({title:"Success",description:"Navigation item updated successfully"})):(await r.createNavigationItem(s),ee({title:"Success",description:"Navigation item created successfully"})),te(),re()}catch(a){ee({title:"Error",description:B?"Failed to update navigation item":"Failed to create navigation item",variant:"destructive"})}},children:B?"Update":"Create"})]})]})})]})},G=()=>{const[s,t]=a.useState([]),[l,n]=a.useState(!0),[d,c]=a.useState(!1),[y,v]=a.useState(null),[j,N]=a.useState({value:"",label:"",isActive:!0,displayOrder:0}),{toast:f}=i();a.useEffect(()=>{L()},[]);const L=async()=>{try{n(!0);const e=await r.getNavigationCategories();t(e.sort((e,a)=>e.displayOrder-a.displayOrder))}catch(e){f({title:"Error",description:"Failed to fetch categories",variant:"destructive"})}finally{n(!1)}},I=e=>{if(void 0!==e){v(e);const a=s[e];N({value:a.value,label:a.label,isActive:a.isActive,displayOrder:a.displayOrder})}else v(null),N({value:"",label:"",isActive:!0,displayOrder:s.length});c(!0)},P=()=>{c(!1),v(null),N({value:"",label:"",isActive:!0,displayOrder:0})},q=async(e,a)=>{if(!("up"===a&&0===e||"down"===a&&e===s.length-1))try{const t=[...s],i="up"===a?e-1:e+1;[t[e],t[i]]=[t[i],t[e]],t.forEach((e,a)=>{e.displayOrder=a}),await r.updateNavigationCategories(t),f({title:"Success",description:"Categories reordered successfully"}),L()}catch(t){f({title:"Error",description:"Failed to reorder categories",variant:"destructive"})}};return l?e.jsx("div",{className:"text-center py-8",children:"Loading categories..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Navigation Categories"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage property categories used in navigation items (e.g., Residential, Commercial)"})]}),e.jsxs(b,{onClick:()=>I(),children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Add Category"]})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(F,{className:"h-5 w-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Important:"}),e.jsx("p",{children:"Deleting or modifying categories may affect existing navigation items. Ensure navigation items are updated accordingly."})]})]}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(M,{children:[e.jsx(T,{children:e.jsxs(_,{children:[e.jsx(z,{className:"w-[100px]",children:"Order"}),e.jsx(z,{children:"Value"}),e.jsx(z,{children:"Label"}),e.jsx(z,{children:"Status"}),e.jsx(z,{className:"text-right w-[150px]",children:"Actions"})]})}),e.jsx(V,{children:0===s.length?e.jsx(_,{children:e.jsx(D,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No categories found. Create one to get started."})}):s.map((a,t)=>e.jsxs(_,{children:[e.jsx(D,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>q(t,"up"),disabled:0===t,children:e.jsx(S,{className:"h-4 w-4"})}),e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>q(t,"down"),disabled:t===s.length-1,children:e.jsx(k,{className:"h-4 w-4"})})]})}),e.jsx(D,{children:e.jsx("code",{className:"text-sm bg-muted px-2 py-1 rounded",children:a.value})}),e.jsx(D,{className:"font-medium",children:a.label}),e.jsx(D,{children:e.jsx(O,{checked:a.isActive,onCheckedChange:()=>(async e=>{try{const a=[...s];a[e].isActive=!a[e].isActive,await r.updateNavigationCategories(a),f({title:"Success",description:`Category ${a[e].isActive?"activated":"deactivated"} successfully`}),L()}catch(a){f({title:"Error",description:"Failed to update category status",variant:"destructive"})}})(t)})}),e.jsx(D,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>I(t),children:e.jsx(R,{className:"h-4 w-4"})}),e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this category? This may affect existing navigation items."))try{const a=s.filter((a,s)=>s!==e);await r.updateNavigationCategories(a),f({title:"Success",description:"Category deleted successfully"}),L()}catch(a){f({title:"Error",description:"Failed to delete category",variant:"destructive"})}})(t),children:e.jsx(A,{className:"h-4 w-4 text-destructive"})})]})})]},a.value))})]})}),e.jsx(o,{open:d,onOpenChange:e=>{e||P()},children:e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(p,{children:null!==y?"Edit Category":"Add Category"}),e.jsx(m,{children:"Configure category for organizing navigation items"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"value",children:"Value * (lowercase, no spaces)"}),e.jsx(g,{id:"value",value:j.value,onChange:e=>N({...j,value:e.target.value.toLowerCase().replace(/\s+/g,"_")}),placeholder:"e.g., residential",required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Used internally, must be unique"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"label",children:"Label *"}),e.jsx(g,{id:"label",value:j.label,onChange:e=>N({...j,label:e.target.value}),placeholder:"e.g., Residential",required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Display name shown to users"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{id:"isActive",checked:j.isActive,onCheckedChange:e=>N({...j,isActive:e})}),e.jsx(x,{htmlFor:"isActive",children:"Active"})]})]}),e.jsxs(C,{children:[e.jsx(b,{variant:"outline",onClick:P,children:"Cancel"}),e.jsx(b,{onClick:async()=>{try{if(!j.value.trim()||!j.label.trim())return void f({title:"Error",description:"Value and Label are required",variant:"destructive"});if(s.some((e,a)=>e.value.toLowerCase()===j.value.toLowerCase().trim()&&a!==y))return void f({title:"Error",description:"A category with this value already exists",variant:"destructive"});let e=[...s];null!==y?e[y]={...j,value:j.value.trim(),label:j.label.trim()}:e.push({...j,value:j.value.trim(),label:j.label.trim()}),await r.updateNavigationCategories(e),f({title:"Success",description:null!==y?"Category updated successfully":"Category created successfully"}),L(),P()}catch(e){f({title:"Error",description:"Failed to save category",variant:"destructive"})}},children:null!==y?"Update":"Create"})]})]})})]})},Q=()=>{const{isSuperAdmin:t}=I(),i=s(),[r,o]=a.useState("navigation");return a.useEffect(()=>{t||i("/admin/dashboard")},[t,i]),t?e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(P,{className:"h-8 w-8"}),"Navigation Management"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Configure hierarchical navigation structure and categories"})]})}),e.jsx(U,{children:e.jsx(H,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{children:e.jsx("strong",{children:"How it works:"})}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 ml-2",children:[e.jsxs("li",{children:["First, create ",e.jsx("strong",{children:"categories"})," to organize property types (e.g., Residential, Commercial)"]}),e.jsxs("li",{children:["Navbar dropdowns are created from ",e.jsx("strong",{children:"listing types"})," in Filter Management (For Sale, For Rent, etc.)"]}),e.jsx("li",{children:"Create property types and assign them to a listing type and category"}),e.jsx("li",{children:"Property types appear as options in their assigned listing type's dropdown"})]})]})})}),e.jsx(q,{children:e.jsx(E,{className:"pt-6",children:e.jsxs(l,{value:r,onValueChange:o,children:[e.jsxs(n,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(d,{value:"navigation",className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Navigation Items"]}),e.jsxs(d,{value:"categories",className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),"Categories"]})]}),e.jsx(c,{value:"navigation",children:e.jsx(B,{})}),e.jsx(c,{value:"categories",children:e.jsx(G,{})})]})})})]}):null};export{Q as default};

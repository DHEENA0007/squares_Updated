import{j as e}from"./ui-BNZSgpjP.js";import{r as s,d as a}from"./router-D8v2YSKU.js";import{D as i,u as t,l,G as r,K as n,B as c,f as d,E as o,as as m,at as x,C as u,au as h,av as p,aw as j,ax as f,ay as N,az as g,aA as v,a4 as b,a5 as y,a6 as C,a7 as w,a8 as S,a as I,b as A,c as D,x as U,e as P,S as T,k,R as _,q as E,r as V,s as L,v as F,w as R,aB as B,L as q,I as M,T as z,Z as O,aC as J,a9 as Q,aj as W}from"./index-Bb9pk9gg.js";import{u as G}from"./use-mobile-C5fBmhy-.js";import{T as H,a as K,b as Y,c as Z,d as X,e as $}from"./table-CGhtAVSx.js";import{P as ee,a as se,b as ae,c as ie,d as te,e as le}from"./pagination-CkQwRztG.js";import{r as re}from"./roleService-DGtL3NHm.js";import{P as ne}from"./PincodeAutocomplete-DuEKpKRc.js";import{C as ce}from"./calendar-0PcqI4cQ.js";import{C as de}from"./circle-alert-CWvhLuCN.js";import"./vendor-BxThA0WO.js";import"./ellipsis-BrdifMkx.js";const oe=i("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]),me=i("CircleArrowUp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]),xe=({searchQuery:a,roleFilter:i,monthFilter:J,statusFilter:Q,startDate:W,endDate:xe})=>{const{isSuperAdmin:ue,user:he}=t(),pe=he?.rolePermissions||[],je=e=>pe.includes(e),fe=ue||je(O.USERS_PROMOTE),Ne=ue||je(O.USERS_STATUS),ge=G(),[ve,be]=s.useState(1),[ye,Ce]=s.useState([]),[we,Se]=s.useState(!0),[Ie,Ae]=s.useState(!1),[De,Ue]=s.useState(0),[Pe,Te]=s.useState(0),[ke,_e]=s.useState(null),[Ee,Ve]=s.useState(null),[Le,Fe]=s.useState(!1),[Re,Be]=s.useState(!1),[qe,Me]=s.useState(null),[ze,Oe]=s.useState(""),[Je,Qe]=s.useState([]),[We,Ge]=s.useState({businessName:"",businessType:"",businessDescription:"",experience:"0",licenseNumber:"",gstNumber:"",panNumber:"",website:"",address:"",city:"",district:"",state:"",pincode:""}),[He,Ke]=s.useState([]),[Ye,Ze]=s.useState([]),[Xe,$e]=s.useState([]),[es,ss]=s.useState(""),[as,is]=s.useState(""),[ts,ls]=s.useState(""),[rs,ns]=s.useState(!1);s.useEffect(()=>{(async()=>{try{l.isReady()||await l.initialize();const e=l.getStates();Ke(e),ns(!0)}catch(e){Ke([])}})()},[]),s.useEffect(()=>{if(es&&rs){const e=l.getDistricts(es);Ze(e),e.includes(as)||(is(""),Ge(e=>({...e,district:"",city:""}))),$e([])}else Ze([]),es||(is(""),Ge(e=>({...e,district:"",city:""})),$e([]))},[es,rs]),s.useEffect(()=>{if(es&&as&&rs){const e=l.getCities(es,as);$e(e),e.includes(ts)||(ls(""),Ge(e=>({...e,city:""})))}else $e([]),as||(ls(""),Ge(e=>({...e,city:""})))},[es,as,rs]),s.useEffect(()=>{Ge(e=>({...e,state:es,district:as,city:ts}))},[es,as,ts]),s.useEffect(()=>{(async()=>{try{const e=await re.getRoles({limit:100,isActive:!0});Qe(e.data.roles)}catch(e){}})()},[]),s.useEffect(()=>{(async()=>{we||Ae(!0);try{const e=await n.getUsers({page:ve,limit:10,search:a||void 0,role:i||void 0,month:J||void 0,status:Q||void 0,startDate:W||void 0,endDate:xe||void 0});e.success&&(Ce(e.data.users),Ue(e.data.pagination.totalPages),Te(e.data.pagination.totalUsers))}catch(e){}finally{Se(!1),Ae(!1)}})()},[ve,a,i,J,Q,W,xe]);return we?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(r,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading users..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(H,{className:ge?"min-w-[450px]":"",children:[e.jsx(K,{children:e.jsxs(Y,{children:[e.jsx(Z,{className:ge?"text-xs":"",children:"S.No"}),e.jsx(Z,{className:ge?"text-xs":"",children:"Name"}),e.jsx(Z,{className:ge?"text-xs":"",children:"Email"}),e.jsx(Z,{className:"hidden md:table-cell "+(ge?"text-xs":""),children:"Phone"}),e.jsx(Z,{className:"hidden sm:table-cell "+(ge?"text-xs":""),children:"Role"}),e.jsx(Z,{className:"hidden lg:table-cell "+(ge?"text-xs":""),children:"Status"}),e.jsx(Z,{className:"hidden lg:table-cell "+(ge?"text-xs":""),children:"Created"}),e.jsx(Z,{className:"text-right "+(ge?"text-xs":""),children:"Actions"})]})}),e.jsx(X,{children:0===ye.length?e.jsx(Y,{children:e.jsx($,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No users found."})}):ye.map((s,t)=>e.jsxs(Y,{children:[e.jsx($,{className:ge?"text-xs":"",children:10*(ve-1)+t+1}),e.jsx($,{className:"font-medium "+(ge?"text-xs":""),children:n.getFullName(s)}),e.jsx($,{className:ge?"text-xs":"",children:s.email}),e.jsx($,{className:"hidden md:table-cell "+(ge?"text-xs":""),children:s.profile.phone||"-"}),e.jsx($,{className:"hidden sm:table-cell "+(ge?"text-xs":""),children:e.jsx(c,{variant:"admin"===s.role?"default":"secondary",className:ge?"text-xs px-1 py-0":"",children:s.role})}),e.jsx($,{className:"hidden lg:table-cell "+(ge?"text-xs":""),children:e.jsx(c,{variant:"active"===s.status?"default":"pending"===s.status?"secondary":"destructive",className:ge?"text-xs px-1 py-0":"",children:s.status})}),e.jsx($,{className:"hidden lg:table-cell "+(ge?"text-xs":""),children:n.formatCreationDate(s.createdAt)}),e.jsx($,{className:"text-right "+(ge?"text-xs":""),children:e.jsxs("div",{className:"flex justify-end gap-1 "+(ge?"gap-0.5":"gap-2"),children:[e.jsx(d,{variant:"ghost",size:ge?"sm":"icon",onClick:()=>(e=>{Ve(e),Fe(!0)})(s),title:"View User Details",className:ge?"h-6 w-6 p-1":"",children:e.jsx(o,{className:ge?"h-3 w-3":"h-4 w-4"})}),fe&&e.jsx(d,{variant:"ghost",size:ge?"sm":"icon",onClick:()=>(e=>{Ve(e),Oe(""),e.businessInfo?(Ge({businessName:e.businessInfo.businessName||"",businessType:e.businessInfo.businessType||"",businessDescription:e.businessInfo.businessDescription||"",experience:e.businessInfo.experience?.toString()||"0",licenseNumber:e.businessInfo.licenseNumber||"",gstNumber:e.businessInfo.gstNumber||"",panNumber:e.businessInfo.panNumber||"",website:e.businessInfo.website||"",address:e.businessInfo.address||"",city:e.businessInfo.city||"",district:e.businessInfo.district||"",state:e.businessInfo.state||"",pincode:e.businessInfo.pincode||""}),e.businessInfo.state&&ss(e.businessInfo.state),e.businessInfo.district&&is(e.businessInfo.district),e.businessInfo.city&&ls(e.businessInfo.city)):(Ge({businessName:"",businessType:"",businessDescription:"",experience:"0",licenseNumber:"",gstNumber:"",panNumber:"",website:"",address:"",city:"",district:"",state:"",pincode:""}),ss(""),is(""),ls("")),Be(!0)})(s),title:"Promote User",className:ge?"h-6 w-6 p-1":"",children:e.jsx(me,{className:ge?"h-3 w-3":"h-4 w-4"})}),Ne&&e.jsxs(m,{children:[e.jsx(x,{asChild:!0,children:e.jsx(d,{variant:"ghost",size:ge?"sm":"icon",className:ge?"h-6 w-6 p-1":"",title:"suspended"===s.status?"Activate User":"Suspend User",children:"suspended"===s.status?e.jsx(u,{className:"text-green-600 "+(ge?"h-3 w-3":"h-4 w-4")}):e.jsx(oe,{className:"text-red-600 "+(ge?"h-3 w-3":"h-4 w-4")})})}),e.jsxs(h,{children:[e.jsxs(p,{children:[e.jsx(j,{children:"suspended"===s.status?"Activate User?":"Suspend User?"}),e.jsx(f,{children:"suspended"===s.status?"This will restore the user's access to the platform.":"This will temporarily disable the user's access to the platform. They won't be able to log in."})]}),e.jsxs(N,{children:[e.jsx(g,{children:"Cancel"}),e.jsxs(v,{onClick:()=>(async e=>{const s="suspended"===e.status?"active":"suspended";_e(e._id);try{await n.updateUserStatus(e._id,s);const t=await n.getUsers({page:ve,limit:10,search:a||void 0,role:i||void 0,month:J||void 0,status:Q||void 0});t.success&&(Ce(t.data.users),Ue(t.data.pagination.totalPages),Te(t.data.pagination.totalUsers))}catch(t){}finally{_e(null)}})(s),disabled:ke===s._id,className:"suspended"===s.status?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700",children:[ke===s._id?e.jsx(r,{className:"h-4 w-4 animate-spin mr-2"}):null,"suspended"===s.status?"Activate":"Suspend"]})]})]})]})]})})]},s._id))})]})}),De>1&&e.jsx(ee,{className:"mt-4",children:e.jsxs(se,{children:[e.jsx(ae,{children:e.jsx(ie,{onClick:()=>be(e=>Math.max(1,e-1)),className:1===ve?"pointer-events-none opacity-50":"cursor-pointer"})}),[...Array(De)].map((s,a)=>{const i=a+1;return 1===i||i===De||i>=ve-1&&i<=ve+1?e.jsx(ae,{children:e.jsx(te,{onClick:()=>be(i),isActive:ve===i,className:"cursor-pointer",children:i})},i):i===ve-2||i===ve+2?e.jsx(ae,{children:"..."},i):null}),e.jsx(ae,{children:e.jsx(le,{onClick:()=>be(e=>Math.min(De,e+1)),className:ve===De?"pointer-events-none opacity-50":"cursor-pointer"})})]})}),e.jsx(b,{open:Le,onOpenChange:Fe,children:e.jsxs(y,{className:(ge?"max-w-[95vw] max-h-[95vh]":"max-w-4xl max-h-[90vh]")+" overflow-y-auto",children:[e.jsxs(C,{children:[e.jsx(w,{children:"User Details"}),e.jsxs(S,{children:["Complete information about ",Ee?n.getFullName(Ee):"user"]})]}),Ee&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(I,{children:[e.jsx(A,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5"}),"Basic Information"]})}),e.jsx(P,{className:"space-y-3",children:e.jsxs("div",{className:"grid gap-4 "+(ge?"grid-cols-1":"grid-cols-1 md:grid-cols-2"),children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Full Name"}),e.jsx("p",{className:"text-base",children:n.getFullName(Ee)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Email"}),e.jsx("p",{className:"text-base",children:Ee.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"text-base",children:Ee.profile?.phone||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"User ID"}),e.jsx("p",{className:"text-base font-mono text-sm",children:Ee._id})]})]})})]}),e.jsxs(I,{children:[e.jsx(A,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"Account Status"]})}),e.jsx(P,{className:"space-y-3",children:e.jsxs("div",{className:"grid gap-4 "+(ge?"grid-cols-1":"grid-cols-1 md:grid-cols-2"),children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Role"}),e.jsx(c,{variant:"admin"===Ee.role?"default":"secondary",className:"mt-1",children:Ee.role})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx(c,{variant:"active"===Ee.status?"default":"pending"===Ee.status?"secondary":"destructive",className:"mt-1",children:Ee.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Email Verified"}),e.jsx(c,{variant:Ee.profile?.emailVerified?"default":"destructive",className:"mt-1",children:Ee.profile?.emailVerified?"Verified":"Not Verified"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Phone Verified"}),e.jsx(c,{variant:Ee.profile?.phoneVerified?"default":"destructive",className:"mt-1",children:Ee.profile?.phoneVerified?"Verified":"Not Verified"})]})]})})]}),Ee.profile?.address&&e.jsxs(I,{children:[e.jsx(A,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Address Information"]})}),e.jsx(P,{className:"space-y-3",children:e.jsxs("div",{className:"grid gap-4 "+(ge?"grid-cols-1":"grid-cols-1 md:grid-cols-2"),children:[Ee.profile?.address?.street&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Street"}),e.jsx("p",{className:"text-base",children:Ee.profile.address.street})]}),Ee.profile?.address?.city&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"City"}),e.jsx("p",{className:"text-base",children:Ee.profile.address.city})]}),Ee.profile?.address?.state&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"State"}),e.jsx("p",{className:"text-base",children:Ee.profile.address.state})]}),Ee.profile?.address?.zipCode&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pincode"}),e.jsx("p",{className:"text-base",children:Ee.profile.address.zipCode})]})]})})]}),e.jsxs(I,{children:[e.jsx(A,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"User Preferences"]})}),e.jsxs(P,{className:"space-y-3",children:[e.jsxs("div",{className:"grid gap-4 "+(ge?"grid-cols-1":"grid-cols-1 md:grid-cols-2"),children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Language"}),e.jsx("p",{className:"text-base",children:"Not available"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Currency"}),e.jsx("p",{className:"text-base",children:"Not available"})]})]}),Ee.profile?.preferences?.notifications&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Notification Preferences"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(c,{variant:Ee.profile.preferences.notifications.email?"default":"secondary",children:["Email: ",Ee.profile.preferences.notifications.email?"Enabled":"Disabled"]}),e.jsxs(c,{variant:Ee.profile.preferences.notifications.sms?"default":"secondary",children:["SMS: ",Ee.profile.preferences.notifications.sms?"Enabled":"Disabled"]}),e.jsxs(c,{variant:Ee.profile.preferences.notifications.push?"default":"secondary",children:["Push: ",Ee.profile.preferences.notifications.push?"Enabled":"Disabled"]})]})]})]})]}),e.jsxs(I,{children:[e.jsx(A,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5"}),"Account Timeline"]})}),e.jsx(P,{className:"space-y-3",children:e.jsxs("div",{className:"grid gap-4 "+(ge?"grid-cols-1":"grid-cols-1 md:grid-cols-2"),children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Created At"}),e.jsx("p",{className:"text-base",children:n.formatCreationDate(Ee.createdAt)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Last Updated"}),e.jsx("p",{className:"text-base",children:n.formatCreationDate(Ee.updatedAt)})]})]})})]}),e.jsxs(I,{children:[e.jsx(A,{children:e.jsx(D,{children:"Quick Actions"})}),e.jsx(P,{children:e.jsx("div",{className:"flex gap-2 flex-wrap",children:e.jsx(d,{variant:"outline",size:"sm",onClick:()=>Fe(!1),children:"Close"})})})]})]})]})}),e.jsx(b,{open:Re,onOpenChange:Be,children:e.jsxs(y,{children:[e.jsxs(C,{children:[e.jsx(w,{children:"Promote User"}),e.jsxs(S,{children:["Change the role of ",Ee?n.getFullName(Ee):"user"]})]}),Ee&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Current Role"}),e.jsx(c,{variant:"secondary",children:Ee.role})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"New Role"}),e.jsxs(E,{value:ze,onValueChange:Oe,children:[e.jsx(V,{children:e.jsx(L,{placeholder:"Select a role"})}),e.jsx(F,{children:Je.length>0?Je.filter(e=>e.name&&""!==e.name.trim()&&"superadmin"!==e.name.toLowerCase()&&"super admin"!==e.name.toLowerCase()&&e.name.toLowerCase()!==Ee.role.toLowerCase()).map(s=>e.jsx(R,{value:s.name,children:s.name},s._id)):e.jsxs(e.Fragment,{children:["customer"!==Ee.role.toLowerCase()&&e.jsx(R,{value:"customer",children:"Customer"}),"agent"!==Ee.role.toLowerCase()&&e.jsx(R,{value:"agent",children:"Vendor/Agent"}),"subadmin"!==Ee.role.toLowerCase()&&e.jsx(R,{value:"subadmin",children:"Sub Admin"})]})})]})]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-950/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("strong",{children:"Warning:"})," Changing a user's role will affect their permissions and access to features."]})}),("agent"===ze.toLowerCase()||"vendor"===ze.toLowerCase())&&e.jsx(B,{className:"h-[300px] pr-4 border rounded-md p-2",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(T,{className:"w-4 h-4 text-primary"}),e.jsx("h3",{className:"font-semibold",children:Ee.businessInfo?"Business Information":"Business Information Required"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Business Name *"}),e.jsx(M,{value:We.businessName,onChange:e=>Ge({...We,businessName:e.target.value}),placeholder:"Enter business name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Business Type *"}),e.jsxs(E,{value:We.businessType,onValueChange:e=>Ge({...We,businessType:e}),children:[e.jsx(V,{children:e.jsx(L,{placeholder:"Select type"})}),e.jsxs(F,{children:[e.jsx(R,{value:"real_estate_agent",children:"Real Estate Agent"}),e.jsx(R,{value:"property_developer",children:"Property Developer"}),e.jsx(R,{value:"construction_company",children:"Construction Company"}),e.jsx(R,{value:"interior_designer",children:"Interior Designer"}),e.jsx(R,{value:"legal_services",children:"Legal Services"}),e.jsx(R,{value:"home_loan_provider",children:"Home Loan Provider"}),e.jsx(R,{value:"packers_movers",children:"Packers & Movers"}),e.jsx(R,{value:"property_management",children:"Property Management"}),e.jsx(R,{value:"other",children:"Other"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Description * (min 10 chars)"}),e.jsx(z,{value:We.businessDescription,onChange:e=>Ge({...We,businessDescription:e.target.value}),placeholder:"Describe your business..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Experience (Years)"}),e.jsx(M,{type:"number",value:We.experience,onChange:e=>Ge({...We,experience:e.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"PAN Number *"}),e.jsx(M,{value:We.panNumber,onChange:e=>Ge({...We,panNumber:e.target.value.toUpperCase()}),placeholder:"ABCDE1234F",maxLength:10})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"GST Number"}),e.jsx(M,{value:We.gstNumber,onChange:e=>Ge({...We,gstNumber:e.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"License Number"}),e.jsx(M,{value:We.licenseNumber,onChange:e=>Ge({...We,licenseNumber:e.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Website"}),e.jsx(M,{value:We.website,onChange:e=>Ge({...We,website:e.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Address *"}),e.jsx(M,{value:We.address,onChange:e=>Ge({...We,address:e.target.value})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"State *"}),e.jsxs(E,{value:es,onValueChange:e=>{ss(e),is(""),ls(""),Ge(s=>({...s,state:e,district:"",city:""}))},disabled:!rs,children:[e.jsx(V,{children:e.jsx(L,{placeholder:rs?"Select state":"Loading..."})}),e.jsx(F,{children:He.map(s=>e.jsx(R,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"District *"}),e.jsxs(E,{value:as,onValueChange:e=>{is(e),ls(""),Ge(s=>({...s,district:e,city:""}))},disabled:!es||0===Ye.length,children:[e.jsx(V,{children:e.jsx(L,{placeholder:es?"Select district":"Select state first"})}),e.jsx(F,{children:Ye.map(s=>e.jsx(R,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"City *"}),e.jsxs(E,{value:ts,onValueChange:e=>{ls(e),Ge(s=>({...s,city:e}))},disabled:!as||0===Xe.length,children:[e.jsx(V,{children:e.jsx(L,{placeholder:as?"Select city":"Select district first"})}),e.jsx(F,{children:Xe.map(s=>e.jsx(R,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Pincode *"}),e.jsx(ne,{value:We.pincode,onChange:(e,s)=>{if(Ge(s=>({...s,pincode:e})),s){const a=s.state,i=He.find(e=>e.toUpperCase()===a.toUpperCase());i&&(ss(i),setTimeout(()=>{const a=l.getDistricts(i).find(e=>e.toUpperCase()===s.district.toUpperCase());a&&(is(a),setTimeout(()=>{if(s.city){const t=l.getCities(i,a).find(e=>e.toUpperCase()===s.city.toUpperCase());t&&(ls(t),Ge(s=>({...s,state:i,district:a,city:t,pincode:e})))}},100))},100))}},state:es,district:as,city:ts,placeholder:"Enter pincode"}),We.pincode&&6===We.pincode.length&&l.isReady()&&e.jsx("div",{className:"text-xs",children:l.validatePincode(We.pincode)?e.jsxs("span",{className:"text-green-600 flex items-center gap-1",children:[e.jsx(u,{className:"w-3 h-3"}),"Valid PIN code"]}):e.jsxs("span",{className:"text-amber-600 flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),"PIN code not found"]})})]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{variant:"outline",onClick:()=>{Be(!1),Ve(null),Oe("")},children:"Cancel"}),e.jsx(d,{onClick:async()=>{if(!Ee||!ze)return;let e=null;if("agent"===ze.toLowerCase()||"vendor"===ze.toLowerCase())if(Ee.businessInfo&&Ee.businessInfo.businessName)e={businessName:We.businessName||Ee.businessInfo.businessName,businessType:We.businessType||Ee.businessInfo.businessType,businessDescription:We.businessDescription||Ee.businessInfo.businessDescription,panNumber:We.panNumber||Ee.businessInfo.panNumber,address:We.address||Ee.businessInfo.address,city:We.city||Ee.businessInfo.city,district:We.district||Ee.businessInfo.district,state:We.state||Ee.businessInfo.state,pincode:We.pincode||Ee.businessInfo.pincode,experience:parseInt(We.experience)||Ee.businessInfo.experience||0,licenseNumber:We.licenseNumber||Ee.businessInfo.licenseNumber||"",gstNumber:We.gstNumber||Ee.businessInfo.gstNumber||"",website:We.website||Ee.businessInfo.website||""};else{if(!We.businessName)return alert("Business Name is required");if(!We.businessType)return alert("Business Type is required");if(!We.businessDescription||We.businessDescription.length<10)return alert("Description must be at least 10 chars");if(!We.panNumber)return alert("PAN Number is required");if(!We.address)return alert("Address is required");if(!We.city)return alert("City is required");if(!We.district)return alert("District is required");if(!We.state)return alert("State is required");if(!We.pincode)return alert("Pincode is required");e={...We,experience:parseInt(We.experience)||0}}Me(Ee._id);try{await n.promoteUser(Ee._id,ze,e);const s=await n.getUsers({page:ve,limit:10,search:a||void 0});s.success&&(Ce(s.data.users),Ue(s.data.pagination.totalPages),Te(s.data.pagination.totalUsers)),Be(!1),Ve(null),Oe("")}catch(s){}finally{Me(null)}},disabled:!ze||ze===Ee.role||qe===Ee._id,children:qe===Ee._id?e.jsxs(e.Fragment,{children:[e.jsx(r,{className:"h-4 w-4 animate-spin mr-2"}),"Promoting..."]}):"Promote User"})]})]})]})})]})},ue=()=>{const i=a(),t=G(),[l,r]=s.useState(""),n=J(l,500),[c,o]=s.useState("all"),[m,x]=s.useState("all"),[u,h]=s.useState("all"),[p,j]=s.useState(""),[f,N]=s.useState(""),[g,v]=s.useState([]),[b,y]=s.useState(!1);s.useEffect(()=>{(async()=>{try{const e=await re.getRoles({limit:100,isActive:!0});v(e.data.roles)}catch(e){}})()},[]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex "+(t?"flex-col gap-4":"flex-row justify-between items-start sm:items-center gap-4"),children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold "+(t?"text-2xl":"text-3xl"),children:"Users"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"View and manage system users"})]}),e.jsxs(d,{onClick:()=>i("/admin/users/add"),className:t?"w-full":"",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Add User"]})]}),e.jsxs("div",{className:"bg-card rounded-lg border p-4 md:p-6",children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(M,{placeholder:"Search users...",value:l,onChange:e=>r(e.target.value),className:"flex-1"}),e.jsx(d,{variant:"outline",size:"icon",onClick:()=>y(!b),className:b?"bg-accent":"",children:e.jsx(W,{className:"h-4 w-4"})})]}),b&&e.jsxs("div",{className:"grid gap-4 "+(t?"grid-cols-1":"grid-cols-1 sm:grid-cols-3 lg:grid-cols-6"),children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Role"}),e.jsxs(E,{value:c,onValueChange:o,children:[e.jsx(V,{children:e.jsx(L,{placeholder:"All roles"})}),e.jsxs(F,{children:[e.jsx(R,{value:"all",children:"All roles"}),g.filter(e=>"superadmin"!==e.name.toLowerCase()).map(s=>e.jsx(R,{value:s.name,children:s.name},s._id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Month Created"}),e.jsxs(E,{value:m,onValueChange:x,children:[e.jsx(V,{children:e.jsx(L,{placeholder:"All months"})}),e.jsxs(F,{children:[e.jsx(R,{value:"all",children:"All months"}),[{value:"1",label:"January"},{value:"2",label:"February"},{value:"3",label:"March"},{value:"4",label:"April"},{value:"5",label:"May"},{value:"6",label:"June"},{value:"7",label:"July"},{value:"8",label:"August"},{value:"9",label:"September"},{value:"10",label:"October"},{value:"11",label:"November"},{value:"12",label:"December"}].map(s=>e.jsx(R,{value:s.value,children:s.label},s.value))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsxs(E,{value:u,onValueChange:h,children:[e.jsx(V,{children:e.jsx(L,{placeholder:"All statuses"})}),e.jsxs(F,{children:[e.jsx(R,{value:"all",children:"All statuses"}),e.jsx(R,{value:"active",children:"Active"}),e.jsx(R,{value:"pending",children:"Pending"}),e.jsx(R,{value:"suspended",children:"Suspended"}),e.jsx(R,{value:"inactive",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"From"}),e.jsx(M,{type:"date",placeholder:"dd / mm / yyyy",value:p,onChange:e=>j(e.target.value),className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"To"}),e.jsx(M,{type:"date",placeholder:"dd / mm / yyyy",value:f,onChange:e=>N(e.target.value),className:"w-full"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(d,{variant:"outline",onClick:()=>{o("all"),x("all"),h("all"),j(""),N("")},className:"w-full",children:"Clear Filters"})})]})]}),e.jsx(xe,{searchQuery:n,roleFilter:"all"===c?"":c,monthFilter:"all"===m?"":m,statusFilter:"all"===u?"":u,startDate:p,endDate:f})]})]})};export{ue as default};

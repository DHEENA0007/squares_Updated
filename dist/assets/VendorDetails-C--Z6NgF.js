import{j as e}from"./ui-BNZSgpjP.js";import{d as s,h as a,r}from"./router-D8v2YSKU.js";import{D as i,u as t,a2 as n,f as l,A as o,a0 as d,S as c,C as p,_ as m,a as x,b as f,c as h,e as u,x as v,M as j,y as N,p as g,i as y,a4 as b,a5 as w,a6 as k,a7 as V,a8 as A,L as S,I as B,G as C,B as $,h as I,T as F,ae as T,q as R,r as _,s as E,v as D,w as P,Z as O}from"./index-CbYcfsaZ.js";import{C as L}from"./checkbox-CKO3DUj9.js";import{A as z,b as M,a as U}from"./alert-DW6JzyOG.js";import{L as q}from"./lock-DvDlmF1b.js";import{C as Y}from"./calendar-BrHa3Er4.js";import"./vendor-BxThA0WO.js";const J=i("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]),G="https://app.buildhomemartsquares.com/api",H=()=>{const{user:i}=t(),H=s(),{toast:W}=n(),[K]=a(),Z=K.get("vendorId"),Q=i?.rolePermissions||[],[X,ee]=r.useState(!0),[se,ae]=r.useState(null),[re,ie]=r.useState(!1),[te,ne]=r.useState("approve"),[le,oe]=r.useState(!1),[de,ce]=r.useState(!1),[pe,me]=r.useState(null),[xe,fe]=r.useState(""),[he,ue]=r.useState(""),[ve,je]=r.useState(""),[Ne,ge]=r.useState(!1),[ye,be]=r.useState(!1),[we,ke]=r.useState([]),[Ve,Ae]=r.useState(""),[Se,Be]=r.useState({phoneVerified:!1,emailVerified:!1,identityProofVerified:!1,businessNameVerified:!1,businessTypeVerified:!1,businessDescriptionVerified:!1,experienceVerified:!1,addressVerified:!1,panNumberVerified:!1,gstNumberVerified:!1,licenseNumberVerified:!1,businessRegistrationVerified:!1}),Ce=e=>Q.includes(e),$e=()=>i?.profile?.firstName&&i?.profile?.lastName?`${i.profile.firstName} ${i.profile.lastName}`:i?.email?.split("@")[0]||"";r.useEffect(()=>{Ce(O.VENDORS_VIEW)?Z?Ie():H("/rolebased/vendors"):H("/rolebased")},[Z]),r.useEffect(()=>{if(se?.approval.phoneVerifiedAt&&Se.phoneVerified){const e=()=>{const e=new Date(se.approval.phoneVerifiedAt).getTime(),s=6e5-((new Date).getTime()-e);me(s>0?s:0)};e();const s=setInterval(e,1e3);return()=>clearInterval(s)}me(null)},[se,Se.phoneVerified]);const Ie=async()=>{try{ee(!0);const e=localStorage.getItem("token"),s=await fetch(`${G}/admin/vendor-approvals/${Z}`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(s.ok){const e=await s.json();ae(e.data.vendor),e.data.vendor.approval.verificationChecklist&&Be(e.data.vendor.approval.verificationChecklist),fe(e.data.vendor.approval.approverName||$e())}else W({title:"Error",description:"Failed to load vendor details",variant:"destructive"}),H("/rolebased/vendors")}catch(e){W({title:"Error",description:"Failed to load vendor details",variant:"destructive"})}finally{ee(!1)}},Fe=e=>{ne(e),ue(""),je(""),se?.approval.verificationChecklist||Be({phoneVerified:!1,emailVerified:!1,identityProofVerified:!1,businessNameVerified:!1,businessTypeVerified:!1,businessDescriptionVerified:!1,experienceVerified:!1,addressVerified:!1,panNumberVerified:!1,gstNumberVerified:!1,licenseNumberVerified:!1,businessRegistrationVerified:!1}),fe(se?.approval.approverName||$e()),ie(!0)},Te=()=>{if(!se)return!1;if(!Se.phoneVerified)return!1;if(!se.approval.phoneVerifiedAt)return!1;const e=new Date(se.approval.phoneVerifiedAt).getTime();return(new Date).getTime()-e>=6e5};return X?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):se?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:justify-between md:items-start md:space-y-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>H("/rolebased/vendors"),children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"Back to Vendors"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:se.businessInfo.companyName}),e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"Vendor Application Details"})]})]}),(s=>{const a={pending:{variant:"outline",icon:I,label:"Pending"},under_review:{variant:"secondary",icon:c,label:"Under Review"},approved:{variant:"default",icon:p,label:"Approved"},rejected:{variant:"destructive",icon:m,label:"Rejected"}},r=a[s]||a.pending,i=r.icon;return e.jsxs($,{variant:r.variant,children:[e.jsx(i,{className:"w-3 h-3 mr-1"}),r.label]})})(se.approval.status)]}),se.approval.lockedBy&&se.approval.lockedBy._id!==i?.id&&"superadmin"!==i?.role&&e.jsxs(z,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(q,{className:"h-4 w-4 text-yellow-600"}),e.jsx(M,{children:"Application Locked"}),e.jsxs(U,{children:["This vendor application is currently being handled by"," ",se.approval.lockedBy.profile?.firstName?`${se.approval.lockedBy.profile.firstName} ${se.approval.lockedBy.profile.lastName||""}`:se.approval.lockedBy.email,". You cannot make changes to this application."]})]}),Ce(O.VENDORS_APPROVE)&&"approved"!==se.approval.status&&"rejected"!==se.approval.status&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[se.approval.verificationChecklist?.phoneVerified&&(!se.approval.lockedBy||se.approval.lockedBy._id!==i?.id)&&"superadmin"!==i?.role&&e.jsxs(l,{variant:"outline",onClick:async()=>{if(se)try{oe(!0);const e=localStorage.getItem("token"),s=await fetch(`${G}/admin/vendor-approvals/${se._id}/accept`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(s.ok)W({title:"Success",description:"Vendor approval accepted. You are now responsible for completing the verification process."}),Ie();else{const e=await s.json();W({title:"Error",description:e.message||"Failed to accept vendor approval",variant:"destructive"})}}catch(e){W({title:"Error",description:"Failed to accept vendor approval",variant:"destructive"})}finally{oe(!1)}},disabled:le||se.approval.lockedBy&&se.approval.lockedBy._id!==i?.id,children:[e.jsx(d,{className:"w-4 h-4 mr-2"}),"Accept Responsibility"]}),(se.approval.lockedBy&&se.approval.lockedBy._id===i?.id||"superadmin"===i?.role)&&e.jsxs(l,{variant:"outline",onClick:()=>{(async()=>{try{const e=localStorage.getItem("token"),s=await fetch(`${G}/admin/vendor-approvals/transfer-users`,{headers:{Authorization:`Bearer ${e}`}});if(s.ok){const e=await s.json();ke(e.data.users||[])}else{const e=await s.json();W({title:"Error",description:e.message||"Failed to fetch transfer users",variant:"destructive"})}}catch(e){W({title:"Error",description:"Failed to fetch transfer users",variant:"destructive"})}})(),ge(!0)},children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Transfer"]}),"pending"===se.approval.status&&e.jsxs(l,{variant:"secondary",onClick:()=>Fe("under_review"),children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),"Mark Under Review"]}),e.jsxs(l,{variant:"default",className:"bg-green-600 hover:bg-green-700",onClick:()=>Fe("approve"),disabled:se.approval.lockedBy&&se.approval.lockedBy._id!==i?.id&&"superadmin"!==i?.role,children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"Approve Application"]}),e.jsxs(l,{variant:"destructive",onClick:()=>Fe("reject"),disabled:se.approval.lockedBy&&se.approval.lockedBy._id!==i?.id&&"superadmin"!==i?.role,children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"Reject Application"]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(x,{children:[e.jsx(f,{children:e.jsx(h,{className:"text-base",children:"Contact Information"})}),e.jsxs(u,{className:"grid grid-cols-1 gap-3 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs("span",{className:"font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4"}),"Name:"]}),e.jsxs("span",{children:[se.user?.profile?.firstName," ",se.user?.profile?.lastName]})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs("span",{className:"font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4"}),"Email:"]}),e.jsx("span",{className:"break-words",children:se.user?.email||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs("span",{className:"font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4"}),"Phone:"]}),e.jsx("span",{children:se.user?.profile?.phone||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs("span",{className:"font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Registered:"]}),e.jsx("span",{children:new Date(se.user.createdAt).toLocaleDateString()})]})]})]}),e.jsxs(x,{children:[e.jsx(f,{children:e.jsx(h,{className:"text-base",children:"Business Information"})}),e.jsxs(u,{className:"grid grid-cols-1 gap-3 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs("span",{className:"font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4"}),"Company Name:"]}),e.jsx("span",{children:se.businessInfo.companyName})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Business Type:"}),e.jsx("span",{children:se.businessInfo.businessType})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Experience:"}),e.jsx("span",{children:se.businessInfo.experience?`${se.businessInfo.experience} years`:"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs("span",{className:"font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Applied On:"]}),e.jsx("span",{children:new Date(se.approval.submittedAt).toLocaleDateString()})]})]})]}),(se.businessInfo.businessDescription||se.professionalInfo?.description)&&e.jsxs(x,{className:"md:col-span-2",children:[e.jsx(f,{children:e.jsx(h,{className:"text-base",children:"Business Description"})}),e.jsx(u,{className:"text-sm",children:e.jsx("span",{className:"break-words",children:se.businessInfo.businessDescription||se.professionalInfo?.description||"N/A"})})]}),se.professionalInfo?.officeAddress&&e.jsxs(x,{className:"md:col-span-2",children:[e.jsx(f,{children:e.jsx(h,{className:"text-base",children:"Address Information"})}),e.jsxs(u,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Address:"}),e.jsx("span",{className:"break-words",children:se.professionalInfo.officeAddress.area||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"City:"}),e.jsx("span",{children:se.professionalInfo.officeAddress.city||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"State:"}),e.jsx("span",{children:se.professionalInfo.officeAddress.state||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Pincode:"}),e.jsx("span",{children:se.professionalInfo.officeAddress.pincode||"N/A"})]})]})]}),e.jsxs(x,{className:"md:col-span-2",children:[e.jsx(f,{children:e.jsx(h,{className:"text-base",children:"Legal Documents"})}),e.jsxs(u,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"PAN Number:"}),e.jsx("span",{children:se.businessInfo.panNumber||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"GST Number:"}),e.jsx("span",{children:se.businessInfo.gstNumber||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"License Number:"}),e.jsx("span",{children:se.businessInfo.licenseNumber||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Website:"}),e.jsx("span",{children:se.businessInfo.website||"N/A"})]})]})]}),se.approval.submittedDocuments&&se.approval.submittedDocuments.length>0&&e.jsxs(x,{className:"md:col-span-2",children:[e.jsx(f,{children:e.jsx(h,{className:"text-base",children:"Submitted Documents"})}),e.jsx(u,{children:e.jsx("div",{className:"space-y-2",children:se.approval.submittedDocuments.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.documentName}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.documentType})]})]}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>window.open(s.documentUrl,"_blank"),children:"View"})]},a))})})]}),se.approval.reviewedAt&&e.jsxs(x,{className:"md:col-span-2",children:[e.jsx(f,{children:e.jsx(h,{className:"text-base",children:"Review History"})}),e.jsxs(u,{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Reviewed By:"}),e.jsx("span",{children:se.approval.reviewedBy?`${se.approval.reviewedBy.profile.firstName} ${se.approval.reviewedBy.profile.lastName}`:se.approval.approverName||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Reviewed At:"}),e.jsx("span",{children:new Date(se.approval.reviewedAt).toLocaleString()})]}),se.approval.approvalNotes&&e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Approval Notes:"}),e.jsx("span",{className:"text-green-600",children:se.approval.approvalNotes})]}),se.approval.rejectionReason&&e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Rejection Reason:"}),e.jsx("span",{className:"text-red-600",children:se.approval.rejectionReason})]})]})]}),se.approval.activityLog&&se.approval.activityLog.length>0&&e.jsxs(x,{className:"md:col-span-2",children:[e.jsx(f,{children:e.jsx(h,{className:"text-base",children:"Activity Log"})}),e.jsx(u,{children:e.jsx("div",{className:"space-y-3",children:[...se.approval.activityLog].reverse().map((s,a)=>{const r=s.performedBy.profile?.firstName?`${s.performedBy.profile.firstName} ${s.performedBy.profile.lastName||""}`:s.performedBy.email;return e.jsx("div",{className:`p-3 border rounded-lg ${(()=>{switch(s.action){case"phone_verified":return"bg-blue-50 border-blue-200";case"accepted":case"approved":return"bg-green-50 border-green-200";case"transferred":return"bg-orange-50 border-orange-200";case"rejected":return"bg-red-50 border-red-200";case"marked_under_review":return"bg-yellow-50 border-yellow-200";default:return"bg-gray-50 border-gray-200"}})()}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5",children:(()=>{switch(s.action){case"phone_verified":return e.jsx(N,{className:"w-4 h-4 text-blue-600"});case"accepted":return e.jsx(d,{className:"w-4 h-4 text-green-600"});case"transferred":return e.jsx(J,{className:"w-4 h-4 text-orange-600"});case"approved":return e.jsx(p,{className:"w-4 h-4 text-green-600"});case"rejected":return e.jsx(m,{className:"w-4 h-4 text-red-600"});case"marked_under_review":return e.jsx(c,{className:"w-4 h-4 text-yellow-600"});default:return e.jsx(I,{className:"w-4 h-4 text-gray-600"})}})()}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:s.details}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(s.performedAt).toLocaleString()})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["By: ",r]}),s.notes&&e.jsxs("p",{className:"text-xs text-muted-foreground italic",children:["Note: ",s.notes]})]})]})},a)})})})]})]}),e.jsx(b,{open:re,onOpenChange:ie,children:e.jsxs(w,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(k,{children:[e.jsx(V,{children:"approve"===te?"Approve Application":"reject"===te?"Reject Application":"Mark Under Review"}),e.jsx(A,{children:"approve"===te?"Complete the verification checklist and provide approval details":"reject"===te?"Provide a reason for rejecting this application":"Mark this application as under review"})]}),se&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:se.businessInfo.companyName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[se.user.profile.firstName," ",se.user.profile.lastName," â€¢ ",se.user.email]}),se.approval.lockedBy&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("p",{className:"text-xs font-medium text-primary",children:"Currently Handling:"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[se.approval.lockedBy.profile?.firstName?`${se.approval.lockedBy.profile.firstName} ${se.approval.lockedBy.profile.lastName||""}`:se.approval.lockedBy.email,se.approval.lockedBy._id===i?.id&&" (You)"]}),se.approval.lockedAt&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Since: ",new Date(se.approval.lockedAt).toLocaleString()]})]}),se.approval.phoneVerifiedBy&&se.approval.phoneVerifiedBy._id!==se.approval.lockedBy?._id&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("p",{className:"text-xs font-medium text-blue-600",children:"Phone Verified By:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:se.approval.phoneVerifiedBy.profile?.firstName?`${se.approval.phoneVerifiedBy.profile.firstName} ${se.approval.phoneVerifiedBy.profile.lastName||""}`:se.approval.phoneVerifiedBy.email})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(S,{htmlFor:"approverName",children:["Approver Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"approverName",value:xe,onChange:e=>fe(e.target.value),placeholder:"Enter your full name",disabled:Se.phoneVerified}),se.approval.lockedBy&&se.approval.lockedBy._id===i?.id&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"You are currently handling this application. Your name is pre-filled from the initial action."})]}),"approve"===te&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{className:"border-2 border-primary/20",children:[e.jsx(f,{children:e.jsxs(h,{className:"text-base flex items-center gap-2",children:[e.jsx(c,{className:"w-5 h-5 text-primary"}),"Step 1: Phone Verification (Required)"]})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Phone: ",se.user.profile.phone||"N/A"]})]}),Se.phoneVerified?e.jsxs($,{variant:"default",className:"bg-green-600",children:[e.jsx(p,{className:"w-4 h-4 mr-1"}),"Verified"]}):e.jsx(l,{onClick:async()=>{if(se&&xe.trim())try{ce(!0);const e=localStorage.getItem("token"),s=await fetch(`${G}/admin/vendor-approvals/${se._id}/verify-phone`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({approverName:xe.trim()})});if(s.ok)W({title:"Success",description:"Phone verification completed. 10-minute freeze period started."}),Be({...Se,phoneVerified:!0}),Ie();else{const e=await s.json();W({title:"Error",description:e.message||"Failed to verify phone",variant:"destructive"})}}catch(e){W({title:"Error",description:"Failed to verify phone",variant:"destructive"})}finally{ce(!1)}else W({title:"Error",description:"Approver name is required",variant:"destructive"})},disabled:de||!xe.trim(),size:"sm",children:de?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 mr-2 animate-spin"}),"Verifying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"Verify Phone"]})})]}),se.approval.phoneVerifiedAt&&null!==pe&&e.jsxs(z,{children:[e.jsx(I,{className:"h-4 w-4"}),e.jsx(M,{children:"Verification Freeze Period"}),e.jsx(U,{children:pe>0?e.jsxs(e.Fragment,{children:["Time remaining: ",e.jsx("strong",{children:(Re=pe,`${Math.floor(Re/6e4)}:${Math.floor(Re%6e4/1e3).toString().padStart(2,"0")}`)})]}):e.jsx("span",{className:"text-green-600 font-semibold",children:"Freeze period completed! You can now proceed."})})]})]})]}),e.jsxs(x,{children:[e.jsx(f,{children:e.jsx(h,{className:"text-base",children:"Step 2: Verification Checklist"})}),e.jsx(u,{className:"space-y-3",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Object.entries({emailVerified:"Email Verified",identityProofVerified:"Identity Proof Verified",businessNameVerified:"Business Name Verified",businessTypeVerified:"Business Type Verified",businessDescriptionVerified:"Business Description Verified",experienceVerified:"Experience Verified",addressVerified:"Address Verified",panNumberVerified:"PAN Number Verified",gstNumberVerified:"GST Number Verified",licenseNumberVerified:"License Number Verified",businessRegistrationVerified:"Business Registration Verified"}).map(([s,a])=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{id:s,checked:Se[s],onCheckedChange:e=>Be({...Se,[s]:e}),disabled:!Te()}),e.jsx(S,{htmlFor:s,className:"text-sm",children:a})]},s))})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"approvalComments",children:"Approval Notes (Optional)"}),e.jsx(F,{id:"approvalComments",value:he,onChange:e=>ue(e.target.value),placeholder:"Add any notes about this approval...",rows:3})]})]}),"reject"===te&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(S,{htmlFor:"rejectionComments",children:["Rejection Reason ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(F,{id:"rejectionComments",value:ve,onChange:e=>je(e.target.value),placeholder:"Provide a detailed reason for rejection...",rows:4,required:!0})]}),"under_review"===te&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"reviewNotes",children:"Review Notes (Optional)"}),e.jsx(F,{id:"reviewNotes",value:he,onChange:e=>ue(e.target.value),placeholder:"Add any notes about this review...",rows:3})]})]}),e.jsxs(T,{children:[e.jsx(l,{variant:"outline",onClick:()=>ie(!1),disabled:le,children:"Cancel"}),"approve"===te&&e.jsx(l,{onClick:async()=>{if(!se)return;if(Object.values(Se).every(e=>!0===e))try{oe(!0);const e=localStorage.getItem("token"),s=await fetch(`${G}/admin/vendor-approvals/${se._id}/approve`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({approvalNotes:he||"Application approved",verificationLevel:"basic",approverName:xe.trim(),verificationChecklist:Se})});if(s.ok)W({title:"Success",description:"Vendor application approved successfully"}),ie(!1),Ie();else{const e=await s.json();W({title:"Error",description:e.message||"Failed to approve vendor",variant:"destructive"})}}catch(e){W({title:"Error",description:"Failed to approve vendor application",variant:"destructive"})}finally{oe(!1)}else W({title:"Error",description:"Please complete all verification checklist items",variant:"destructive"})},disabled:le||!xe.trim(),className:"bg-green-600 hover:bg-green-700",children:le?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 mr-2 animate-spin"}),"Approving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"Approve Application"]})}),"reject"===te&&e.jsx(l,{variant:"destructive",onClick:async()=>{if(se&&ve.trim())try{oe(!0);const e=localStorage.getItem("token"),s=await fetch(`${G}/admin/vendor-approvals/${se._id}/reject`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({rejectionReason:ve,approverName:xe.trim()})});if(s.ok)W({title:"Success",description:"Vendor application rejected"}),ie(!1),Ie();else{const e=await s.json();W({title:"Error",description:e.message||"Failed to reject vendor",variant:"destructive"})}}catch(e){W({title:"Error",description:"Failed to reject vendor application",variant:"destructive"})}finally{oe(!1)}else W({title:"Error",description:"Rejection reason is required",variant:"destructive"})},disabled:le||!ve.trim()||!xe.trim(),children:le?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 mr-2 animate-spin"}),"Rejecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"Reject Application"]})}),"under_review"===te&&e.jsx(l,{variant:"secondary",onClick:async()=>{if(se)try{oe(!0);const e=localStorage.getItem("token"),s=await fetch(`${G}/admin/vendor-approvals/${se._id}/under-review`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({notes:he||"Application under review",approverName:xe.trim()})});if(s.ok)W({title:"Success",description:"Vendor application marked as under review"}),ie(!1),Ie();else{const e=await s.json();W({title:"Error",description:e.message||"Failed to update status",variant:"destructive"})}}catch(e){W({title:"Error",description:"Failed to update vendor status",variant:"destructive"})}finally{oe(!1)}},disabled:le||!xe.trim(),children:le?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 mr-2 animate-spin"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),"Mark Under Review"]})})]})]})}),e.jsx(b,{open:Ne,onOpenChange:ge,children:e.jsxs(w,{className:"max-w-md",children:[e.jsxs(k,{children:[e.jsx(V,{children:"Transfer Vendor Approval"}),e.jsx(A,{children:"Transfer this vendor approval to another user. They will take over the verification process."})]}),se&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-1",children:se.businessInfo.companyName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[se.user.profile.firstName," ",se.user.profile.lastName]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(S,{htmlFor:"transferUser",children:["Select User ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(R,{value:Ve,onValueChange:Ae,children:[e.jsx(_,{children:e.jsx(E,{placeholder:"Select a user to transfer to"})}),e.jsx(D,{children:we.map(s=>e.jsx(P,{value:s._id,children:s.profile?.firstName?`${s.profile.firstName} ${s.profile.lastName||""} (${s.role})`:`${s.email} (${s.role})`},s._id))})]})]})]}),e.jsxs(T,{children:[e.jsx(l,{variant:"outline",onClick:()=>{ge(!1),Ae("")},disabled:ye,children:"Cancel"}),e.jsx(l,{onClick:async()=>{if(se&&Ve)try{be(!0);const e=localStorage.getItem("token"),s=await fetch(`${G}/admin/vendor-approvals/${se._id}/transfer`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({targetUserId:Ve})});if(s.ok)W({title:"Success",description:"Vendor approval transferred successfully"}),ge(!1),Ae(""),Ie();else{const e=await s.json();W({title:"Error",description:e.message||"Failed to transfer vendor approval",variant:"destructive"})}}catch(e){W({title:"Error",description:"Failed to transfer vendor approval",variant:"destructive"})}finally{be(!1)}},disabled:ye||!Ve,children:ye?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 mr-2 animate-spin"}),"Transferring..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Transfer"]})})]})]})})]}):null;var Re};export{H as default};

import{j as e}from"./ui-s1SEoZIF.js";import{r as s}from"./router-D8v2YSKU.js";import{a2 as t,f as a,a9 as i,a as n,b as l,c as r,e as c,U as d,E as o,$ as m,I as x,af as h,ag as u,ah as j,ai as p,bz as f,B as g,d as N,a4 as v,a5 as b,a6 as y,a7 as w,a8 as S,L as C,T as E,q as A,r as F,s as k,v as D,w as I,M,ae as T,p as U}from"./index-xsqbJ4m0.js";import{f as R,h as $}from"./apiUtils-B8LmEMCW.js";import{C as O}from"./checkbox-B8OQMtjB.js";import{S as P}from"./send-BajDPXlc.js";import"./vendor-BxThA0WO.js";const V=()=>{const[V,B]=s.useState([]),[z,L]=s.useState(!0),[_,q]=s.useState(""),[W,G]=s.useState("sent"),[J,H]=s.useState(null),[K,Q]=s.useState(!1),[X,Y]=s.useState(!1),[Z,ee]=s.useState(!1),{toast:se}=t(),[te,ae]=s.useState({title:"",message:"",type:"info",recipients:"all",sendEmail:!0,sendInApp:!0});s.useEffect(()=>{ie()},[W,_]);const ie=async()=>{try{L(!0);const e=await R(`/subadmin/notifications?status=${W}&search=${_}`),s=await $(e);B(s.data.notifications||[])}catch(e){se({title:"Error",description:e.message||"Error fetching notifications",variant:"destructive"}),B([])}finally{L(!1)}},ne=async(e=!1)=>{if(te.title.trim()&&te.message.trim())if(e||te.sendEmail||te.sendInApp)try{ee(!0);const s=e?"/subadmin/notifications/draft":"/subadmin/notifications/send",t=await R(s,{method:"POST",body:JSON.stringify(te)});if(e)await $(t),se({title:"Success",description:"Notification saved as draft"});else{const e=await $(t),{recipientCount:s,emailsSent:a,inAppSent:i}=e.data;se({title:"Success",description:`Notification sent to ${s} users (${a} emails, ${i} in-app)`})}Y(!1),ae({title:"",message:"",type:"info",recipients:"all",sendEmail:!0,sendInApp:!0}),ie()}catch(s){se({title:"Error",description:s.message||(e?"Failed to save draft":"Failed to send notification"),variant:"destructive"})}finally{ee(!1)}else se({title:"Validation Error",description:"Please select at least one delivery method (Email or In-App)",variant:"destructive"});else se({title:"Validation Error",description:"Please fill in all required fields",variant:"destructive"})},le=e=>{switch(e){case"info":return{label:"Info",class:"bg-blue-600"};case"warning":return{label:"Warning",class:"bg-yellow-600"};case"success":return{label:"Success",class:"bg-green-600"};case"error":return{label:"Error",class:"bg-red-600"};default:return{label:e,class:"bg-gray-600"}}},re=s=>{switch(s){case"vendors":return e.jsx(U,{className:"h-4 w-4"});case"customers":return e.jsx(d,{className:"h-4 w-4"});default:return e.jsx(f,{className:"h-4 w-4"})}};return z&&0===V.length?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Notifications"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage and send system notifications"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Notifications"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage and send system notifications"})]}),e.jsxs(a,{onClick:()=>Y(!0),children:[e.jsx(i,{className:"h-4 w-4 mr-2"}),"Send Notification"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(n,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"sent"===W?"Total Sent":"Total Drafts"}),e.jsx(P,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:V.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"sent"===W?"Notifications sent":"Draft notifications"})]})]}),e.jsxs(n,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Total Recipients"}),e.jsx(d,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:V.reduce((e,s)=>e+s.recipientCount,0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Users notified"})]})]}),e.jsxs(n,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"sent"===W?"Read Rate":"Average Recipients"}),e.jsx(o,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["sent"===W?V.length>0?Math.round(V.reduce((e,s)=>e+s.readCount,0)/V.reduce((e,s)=>e+s.recipientCount,0)*100):0:V.length>0?Math.round(V.reduce((e,s)=>e+s.recipientCount,0)/V.length):0,"sent"===W?"%":""]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"sent"===W?"Average read rate":"Per notification"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Search notifications...",value:_,onChange:e=>q(e.target.value),className:"pl-10"})]}),e.jsxs(h,{value:W,onValueChange:G,children:[e.jsxs(u,{children:[e.jsx(j,{value:"sent",children:"Sent"}),e.jsx(j,{value:"draft",children:"Drafts"})]}),e.jsx(p,{value:W,className:"space-y-4 mt-6",children:0===V.length?e.jsx(n,{children:e.jsxs(c,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(f,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Notifications Found"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"sent"===W?"No notifications have been sent yet":"No draft notifications available"})]})}):V.map(s=>{const t=le(s.type);return e.jsxs(n,{children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:"text-lg",children:s.title}),e.jsx(g,{className:t.class,children:t.label})]}),e.jsx(N,{children:e.jsx("p",{className:"line-clamp-2",children:s.message})}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[re(s.recipients),"Recipients: ","all"===s.recipients?"All Users":s.recipients.charAt(0).toUpperCase()+s.recipients.slice(1)]}),e.jsxs("span",{children:["‚Ä¢ ",s.recipientCount," users"]}),"sent"===s.status&&e.jsxs("span",{children:["‚Ä¢ ",s.readCount," read (",Math.round(s.readCount/s.recipientCount*100),"%)"]})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleDateString()}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["By: ",s.sentBy.name]})]})]})}),e.jsx(c,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>{H(s),Q(!0)},children:[e.jsx(o,{className:"h-4 w-4 mr-2"}),"View Details"]}),"draft"===s.status&&e.jsxs(e.Fragment,{children:[e.jsxs(a,{variant:"default",size:"sm",onClick:()=>(async e=>{try{ee(!0);const s=await R(`/subadmin/notifications/draft/${e}/send`,{method:"POST"}),t=await $(s),{recipientCount:a,emailsSent:i,inAppSent:n}=t.data;se({title:"Success",description:`Notification sent to ${a} users (${i} emails, ${n} in-app)`}),ie()}catch(s){se({title:"Error",description:s.message||"Failed to send draft notification",variant:"destructive"})}finally{ee(!1)}})(s._id),disabled:Z,children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),Z?"Sending...":"Send Now"]}),e.jsx(a,{variant:"destructive",size:"sm",onClick:()=>(async e=>{try{const s=await R(`/subadmin/notifications/draft/${e}`,{method:"DELETE"});await $(s),se({title:"Success",description:"Draft deleted successfully"}),ie()}catch(s){se({title:"Error",description:s.message||"Failed to delete draft",variant:"destructive"})}})(s._id),children:"Delete Draft"})]})]})})]},s._id)})})]}),e.jsx(v,{open:K,onOpenChange:Q,children:e.jsxs(b,{className:"max-w-2xl",children:[e.jsxs(y,{children:[e.jsx(w,{children:"Notification Details"}),e.jsx(S,{children:"Detailed information about the notification"})]}),J&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Title"}),e.jsx("p",{children:J.title})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Message"}),e.jsx("div",{className:"bg-muted p-4 rounded-lg",children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:J.message})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Type"}),e.jsx(g,{className:le(J.type).class,children:le(J.type).label})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Status"}),e.jsx(g,{children:J.status})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Recipients"}),e.jsxs("p",{className:"text-sm flex items-center gap-2",children:[re(J.recipients),"all"===J.recipients?"All Users":J.recipients.charAt(0).toUpperCase()+J.recipients.slice(1)]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Recipient Count"}),e.jsxs("p",{className:"text-sm",children:[J.recipientCount," users"]})]})]}),"sent"===J.status&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Engagement"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950 p-4 rounded-lg text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:J.readCount}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Read"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-950 p-4 rounded-lg text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-gray-600",children:[Math.round(J.readCount/J.recipientCount*100),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Read Rate"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Sent By"}),e.jsx("p",{className:"text-sm",children:J.sentBy.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(J.createdAt).toLocaleString()})]})]})]})}),e.jsx(v,{open:X,onOpenChange:Y,children:e.jsxs(b,{className:"max-w-2xl",children:[e.jsxs(y,{children:[e.jsx(w,{children:"Send New Notification"}),e.jsx(S,{children:"Create and send a notification to users via email and/or in-app"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"title",children:"Title *"}),e.jsx(x,{id:"title",placeholder:"e.g., System Maintenance, New Feature, Important Update",value:te.title,onChange:e=>ae({...te,title:e.target.value})})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"message",children:"Message *"}),e.jsx(E,{id:"message",placeholder:"Enter your notification message...",value:te.message,onChange:e=>ae({...te,message:e.target.value}),rows:5}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Use clear and concise language. This message will be sent to all selected recipients."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"type",children:"Notification Type"}),e.jsxs(A,{value:te.type,onValueChange:e=>ae({...te,type:e}),children:[e.jsx(F,{children:e.jsx(k,{})}),e.jsxs(D,{children:[e.jsx(I,{value:"info",children:"‚ÑπÔ∏è Info"}),e.jsx(I,{value:"success",children:"‚úÖ Success"}),e.jsx(I,{value:"warning",children:"‚ö†Ô∏è Warning"}),e.jsx(I,{value:"error",children:"üî¥ Error/Alert"})]})]})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"recipients",children:"Recipients"}),e.jsxs(A,{value:te.recipients,onValueChange:e=>ae({...te,recipients:e}),children:[e.jsx(F,{children:e.jsx(k,{})}),e.jsxs(D,{children:[e.jsx(I,{value:"all",children:"All Users"}),e.jsx(I,{value:"vendors",children:"Vendors Only"}),e.jsx(I,{value:"customers",children:"Customers Only"})]})]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsx(C,{className:"text-base",children:"Delivery Methods *"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(O,{id:"sendEmail",checked:te.sendEmail,onCheckedChange:e=>ae({...te,sendEmail:e})}),e.jsxs(C,{htmlFor:"sendEmail",className:"flex items-center gap-2 font-normal cursor-pointer",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx("span",{children:"Email Notification"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground ml-7",children:"Send formatted email to users' registered email addresses"})]}),!te.sendEmail&&!te.sendInApp&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-3 mt-2",children:e.jsx("p",{className:"text-xs text-destructive",children:"‚ö†Ô∏è Please select at least one delivery method"})})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"üìã Common Use Cases:"}),e.jsxs("ul",{className:"text-xs text-blue-700 dark:text-blue-300 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ System Maintenance: Scheduled downtime notifications"}),e.jsx("li",{children:"‚Ä¢ Platform Updates: New features or policy changes"}),e.jsx("li",{children:"‚Ä¢ Security Alerts: Important security updates"}),e.jsx("li",{children:"‚Ä¢ Service Announcements: General platform announcements"})]})]})]}),e.jsxs(T,{children:[e.jsx(a,{variant:"outline",onClick:()=>{Y(!1),ae({title:"",message:"",type:"info",recipients:"all",sendEmail:!0,sendInApp:!0})},children:"Cancel"}),e.jsx(a,{variant:"outline",onClick:()=>ne(!0),disabled:Z,children:Z?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2",children:"‚è≥"}),"Saving..."]}):e.jsx(e.Fragment,{children:"Save as Draft"})}),e.jsx(a,{onClick:()=>ne(!1),disabled:Z||!te.sendEmail&&!te.sendInApp,children:Z?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2",children:"‚è≥"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Send Notification"]})})]})]})})]})};export{V as default};

import{j as e}from"./ui-s1SEoZIF.js";import{h as s,r as i}from"./router-D8v2YSKU.js";import{u as a,f as r,a as t,b as l,c as n,i as d,e as c,h as o,C as p,$ as m,I as x,q as h,r as f,s as u,v,w as j,L as N,x as g,M as b,y,p as w,E as V,_ as A,aK as C,aL as k,a4 as P,a5 as S,a6 as B,a7 as I,a8 as F,ae as T,S as D,B as R,T as E,t as _}from"./index-CJkfZmVJ.js";import{C as $}from"./checkbox-YqfStp_2.js";import{f as M,h as L}from"./apiUtils-B8LmEMCW.js";import{A as Y,b as O,a as z}from"./alert-DAXS2Fru.js";import{P as U,a as q,b as G,d as J}from"./pagination-BnFw6TCs.js";import{D as W}from"./download-CWlvrHqp.js";import{C as H}from"./calendar-vbG5m687.js";import"./vendor-BxThA0WO.js";import"./ellipsis-DCXRa9jK.js";const K=()=>{const{user:K}=a(),[Q]=s(),[X,Z]=i.useState([]),[ee,se]=i.useState(null),[ie,ae]=i.useState(!0),[re,te]=i.useState(null),[le,ne]=i.useState(!1),[de,ce]=i.useState({status:"all",search:"",businessType:"",experienceMin:"",experienceMax:"",page:1,limit:10}),[oe,pe]=i.useState({currentPage:1,totalPages:0,totalCount:0,hasNextPage:!1,hasPrevPage:!1,limit:10}),[me,xe]=i.useState(null),he=()=>K?.profile?.firstName&&K?.profile?.lastName?`${K.profile.firstName} ${K.profile.lastName}`:K?.profile?.firstName?K.profile.firstName:K?.email?K.email:"",[fe,ue]=i.useState(!1),[ve,je]=i.useState("approve"),[Ne,ge]=i.useState(he()),[be,ye]=i.useState({phoneVerified:!1,emailVerified:!1,identityProofVerified:!1,businessNameVerified:!1,businessTypeVerified:!1,businessDescriptionVerified:!1,experienceVerified:!1,addressVerified:!1,panNumberVerified:!1,gstNumberVerified:!1,licenseNumberVerified:!1,businessRegistrationVerified:!1}),[we,Ve]=i.useState(""),[Ae,Ce]=i.useState(""),[ke,Pe]=i.useState(!1),[Se,Be]=i.useState(null),Ie=async()=>{try{const e=new URLSearchParams({page:de.page.toString(),limit:de.limit.toString(),status:de.status,search:de.search,businessType:de.businessType,experienceMin:de.experienceMin,experienceMax:de.experienceMax,sortBy:"submittedAt",sortOrder:"desc"}),s=await M(`/admin/vendor-approvals?${e}`),i=await L(s);Z(i.data.vendors||[]),i.data.pagination&&pe(i.data.pagination)}catch(e){_({title:"Error",description:e instanceof Error?e.message:"Failed to fetch vendor applications",variant:"destructive"}),Z([])}},Fe=async()=>{try{const e=await M("/admin/vendor-approval-stats"),s=await L(e);se(s.data||null)}catch(e){_({title:"Error",description:e instanceof Error?e.message:"Failed to fetch statistics",variant:"destructive"}),se(null)}};i.useEffect(()=>{const e=he();e&&ge(e)},[K]),i.useEffect(()=>{const e=Q.get("vendorId");if(e&&X.length>0){const s=X.find(s=>s._id===e);s&&(te(s),ne(!0))}},[Q,X]),i.useEffect(()=>{(async()=>{ae(!0),await Promise.all([Ie(),Fe()]),ae(!1)})()},[de.status,de.page,de.search,de.businessType,de.experienceMin,de.experienceMax,de.limit]),i.useEffect(()=>{if(re?.approval.phoneVerifiedAt){const e=()=>{const e=new Date(re.approval.phoneVerifiedAt).getTime(),s=6e5-((new Date).getTime()-e);Be(s>0?s:0)};e();const s=setInterval(e,1e3);return()=>clearInterval(s)}Be(null)},[re]);const Te=()=>{ye({phoneVerified:!1,emailVerified:!1,identityProofVerified:!1,businessNameVerified:!1,businessTypeVerified:!1,businessDescriptionVerified:!1,experienceVerified:!1,addressVerified:!1,panNumberVerified:!1,gstNumberVerified:!1,licenseNumberVerified:!1,businessRegistrationVerified:!1}),Ve(""),Ce(""),ge(he())},De=(e,s)=>{te(e),je(s),Te(),e.approval.verificationChecklist&&ye(e.approval.verificationChecklist),ge(e.approval.approverName||he()),ue(!0)},Re=async()=>{if(!re||!Ne.trim())return void _({title:"Error",description:"Approver name is required",variant:"destructive"});if(!be.phoneVerified)return void _({title:"Error",description:"Phone verification must be completed first",variant:"destructive"});if(!we.trim())return void _({title:"Error",description:"Approval comments are required",variant:"destructive"});Object.values(be).every(e=>!0===e)||_({title:"Warning",description:"Not all verification steps are completed. Are you sure you want to proceed?",variant:"destructive"}),xe("approve");try{const e={approvalNotes:we,approverName:Ne,verificationChecklist:be,verificationLevel:"basic"},s=await M(`/admin/vendor-approvals/${re._id}/approve`,{method:"POST",body:JSON.stringify(e)});await L(s),_({title:"Success",description:"Vendor application approved successfully",variant:"default"}),ue(!1),await Ie(),await Fe()}catch(e){_({title:"Error",description:e instanceof Error?e.message:"Failed to approve vendor application",variant:"destructive"})}finally{xe(null)}},Ee=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),_e=e=>`${Math.floor(e/6e4)}:${Math.floor(e%6e4/1e3).toString().padStart(2,"0")}`,$e=s=>{const i={pending:{variant:"secondary",icon:o,label:"Pending"},under_review:{variant:"default",icon:V,label:"Under Review"},approved:{variant:"default",icon:p,label:"Approved"},rejected:{variant:"destructive",icon:A,label:"Rejected"}},a=i[s]||i.pending,r=a.icon;return e.jsxs(R,{variant:a.variant,children:[e.jsx(r,{className:"w-3 h-3 mr-1"}),a.label]})},Me=()=>{if(!re)return!1;if(!be.phoneVerified)return!1;if(!re.approval.phoneVerifiedAt)return!1;const e=new Date(re.approval.phoneVerifiedAt).getTime();return(new Date).getTime()-e>=6e5};return ie?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:justify-between md:items-start md:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Vendor Applications"}),e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"Review and manage vendor registration applications"})]}),e.jsxs(r,{onClick:async()=>{try{const e=await M("/admin/vendor-approvals/export"),s=await L(e),i=[["Application ID","Company Name","Applicant Name","Email","Phone","Business Type","Submitted Date","Status","Reviewed Date","Reviewed By","Approver Name","Phone Verified","Email Verified","Identity Proof Verified","Business Name Verified","Business Type Verified","Business Description Verified","Experience Verified","Address Verified","PAN Number Verified","GST Number Verified","License Number Verified","Business Registration Verified","Approval/Rejection Comments"].join(","),...s.data.map(e=>{const s=e.approval?.verificationChecklist||{},i=e.approval?.submittedAt?new Date(e.approval.submittedAt).toLocaleDateString():"N/A",a=e.approval?.reviewedAt?new Date(e.approval.reviewedAt).toLocaleDateString():"N/A",r=e.approval?.reviewedBy?`${e.approval.reviewedBy.profile?.firstName||""} ${e.approval.reviewedBy.profile?.lastName||""}`.trim():"N/A";return[e._id||"N/A",`"${e.businessInfo?.companyName||"N/A"}"`,`"${e.user?.profile?.firstName||""} ${e.user?.profile?.lastName||""}"`.trim()||"N/A",e.user?.email||"N/A",e.user?.profile?.phone||"N/A",e.businessInfo?.businessType||"N/A",i,e.approval?.status||"N/A",a,r,e.approval?.approverName||"N/A",s.phoneVerified?"Yes":"No",s.emailVerified?"Yes":"No",s.identityProofVerified?"Yes":"No",s.businessNameVerified?"Yes":"No",s.businessTypeVerified?"Yes":"No",s.businessDescriptionVerified?"Yes":"No",s.experienceVerified?"Yes":"No",s.addressVerified?"Yes":"No",s.panNumberVerified?"Yes":"No",s.gstNumberVerified?"Yes":"No",s.licenseNumberVerified?"Yes":"No",s.businessRegistrationVerified?"Yes":"No",`"${e.approval?.approvalNotes||e.approval?.rejectionReason||"N/A"}"`].join(",")})].join("\n"),a=new Blob([i],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),t=URL.createObjectURL(a);r.setAttribute("href",t),r.setAttribute("download",`vendor_approval_report_${(new Date).toISOString().split("T")[0]}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),_({title:"Success",description:"Approval report exported successfully",variant:"default"})}catch(e){_({title:"Error",description:"Failed to export approval report",variant:"destructive"})}},variant:"outline",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Export Report"]})]}),ee&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(t,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Total Applications"}),e.jsx(d,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold",children:ee.overview.totalApplications})})]}),e.jsxs(t,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Pending Review"}),e.jsx(o,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold",children:ee.overview.pendingApplications})})]}),e.jsxs(t,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Approved"}),e.jsx(p,{className:"h-4 w-4 text-green-600"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold",children:ee.overview.approvedApplications})})]}),e.jsxs(t,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Approval Rate"}),e.jsx(p,{className:"h-4 w-4 text-green-600"})]}),e.jsx(c,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[ee.overview.approvalRate.toFixed(1),"%"]})})]})]}),e.jsx(t,{children:e.jsxs(c,{className:"pt-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Search by name or email...",value:de.search,onChange:e=>ce({...de,search:e.target.value,page:1})})]}),e.jsxs(h,{value:de.status,onValueChange:e=>ce({...de,status:e,page:1}),children:[e.jsx(f,{children:e.jsx(u,{placeholder:"Filter by status"})}),e.jsxs(v,{children:[e.jsx(j,{value:"all",children:"All Statuses"}),e.jsx(j,{value:"pending",children:"Pending"}),e.jsx(j,{value:"under_review",children:"Under Review"}),e.jsx(j,{value:"approved",children:"Approved"}),e.jsx(j,{value:"rejected",children:"Rejected"})]})]}),e.jsxs(h,{value:de.businessType||"all",onValueChange:e=>ce({...de,businessType:"all"===e?"":e,page:1}),children:[e.jsx(f,{children:e.jsx(u,{placeholder:"Filter by business type"})}),e.jsxs(v,{children:[e.jsx(j,{value:"all",children:"All Types"}),e.jsx(j,{value:"real_estate_agent",children:"Real Estate Agent"}),e.jsx(j,{value:"property_management",children:"Property Management"}),e.jsx(j,{value:"developer",children:"Developer"}),e.jsx(j,{value:"individual",children:"Individual"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{type:"number",placeholder:"Min experience",value:de.experienceMin,onChange:e=>ce({...de,experienceMin:e.target.value,page:1})}),e.jsx(x,{type:"number",placeholder:"Max experience",value:de.experienceMax,onChange:e=>ce({...de,experienceMax:e.target.value,page:1})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsx(N,{htmlFor:"pageSize",className:"text-sm text-muted-foreground whitespace-nowrap",children:"Items per page:"}),e.jsxs(h,{value:de.limit.toString(),onValueChange:e=>ce({...de,limit:parseInt(e),page:1}),children:[e.jsx(f,{id:"pageSize",className:"w-[100px]",children:e.jsx(u,{})}),e.jsxs(v,{children:[e.jsx(j,{value:"10",children:"10"}),e.jsx(j,{value:"25",children:"25"}),e.jsx(j,{value:"50",children:"50"}),e.jsx(j,{value:"100",children:"100"})]})]})]})]})}),e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(n,{children:"Applications"})}),e.jsxs(c,{children:[e.jsx("div",{className:"space-y-4",children:0===X.length?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No applications found"}):X.map(s=>e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between p-4 border rounded-lg hover:bg-accent/50 transition-colors gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.businessInfo.companyName}),$e(s.approval.status)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{className:"w-3 h-3"}),s.user?.profile?.firstName," ",s.user?.profile?.lastName]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3"}),s.user?.email||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"w-3 h-3"}),s.user?.profile?.phone||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-3 h-3"}),s.businessInfo.businessType]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"w-3 h-3"}),Ee(s.approval.submittedAt)]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>{te(s),ne(!0)},children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Review"]}),"pending"===s.approval.status||"under_review"===s.approval.status?e.jsxs(e.Fragment,{children:[e.jsxs(r,{variant:"default",size:"sm",onClick:()=>De(s,"approve"),children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"under_review"===s.approval.status?"Update":"Approve"]}),e.jsxs(r,{variant:"destructive",size:"sm",onClick:()=>De(s,"reject"),children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Reject"]})]}):null]})]},s._id))}),X.length>0&&oe.totalPages>1&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(oe.currentPage-1)*oe.limit+1," to"," ",Math.min(oe.currentPage*oe.limit,oe.totalCount)," of"," ",oe.totalCount," applications"]}),e.jsx(U,{children:e.jsxs(q,{children:[e.jsx(G,{children:e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>ce({...de,page:de.page-1}),disabled:!oe.hasPrevPage,children:[e.jsx(C,{className:"h-4 w-4 mr-1"}),"Previous"]})}),Array.from({length:Math.min(5,oe.totalPages)},(s,i)=>{let a;return a=oe.totalPages<=5||oe.currentPage<=3?i+1:oe.currentPage>=oe.totalPages-2?oe.totalPages-4+i:oe.currentPage-2+i,e.jsx(G,{children:e.jsx(J,{onClick:()=>ce({...de,page:a}),isActive:oe.currentPage===a,className:"cursor-pointer",children:a})},a)}),e.jsx(G,{children:e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>ce({...de,page:de.page+1}),disabled:!oe.hasNextPage,children:["Next",e.jsx(k,{className:"h-4 w-4 ml-1"})]})})]})})]})]})]}),e.jsx(P,{open:le,onOpenChange:ne,children:e.jsxs(S,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(B,{children:[e.jsx(I,{children:"Application Review"}),e.jsx(F,{children:"Detailed information about the vendor application"})]}),re&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Status"}),e.jsx("div",{className:"mt-2",children:$e(re.approval.status)})]})}),e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(n,{className:"text-base",children:"Contact Person"})}),e.jsxs(c,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Name:"}),e.jsxs("span",{children:[re.user.profile.firstName," ",re.user.profile.lastName]})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Email:"}),e.jsx("span",{className:"break-all",children:re.user.email})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Phone:"}),e.jsx("span",{children:re.user.profile.phone||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Registered On:"}),e.jsx("span",{children:Ee(re.user.createdAt)})]})]})]}),e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(n,{className:"text-base",children:"Business Information"})}),e.jsxs(c,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Company Name:"}),e.jsx("span",{children:re.businessInfo.companyName})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Business Type:"}),e.jsx("span",{children:re.businessInfo.businessType})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Experience:"}),e.jsx("span",{children:re.professionalInfo?.experience?`${re.professionalInfo.experience} years`:"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1 md:col-span-2",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Business Description:"}),e.jsx("span",{className:"break-words",children:re.professionalInfo?.description||"N/A"})]})]})]}),e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(n,{className:"text-base",children:"Address Information"})}),e.jsxs(c,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Address:"}),e.jsx("span",{className:"break-words",children:re.professionalInfo?.officeAddress?.area||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"City:"}),e.jsx("span",{children:re.professionalInfo?.officeAddress?.city||re.professionalInfo?.serviceAreas?.[0]?.city||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"State:"}),e.jsx("span",{children:re.professionalInfo?.officeAddress?.state||re.professionalInfo?.serviceAreas?.[0]?.state||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Pincode:"}),e.jsx("span",{children:re.professionalInfo?.officeAddress?.pincode||re.professionalInfo?.serviceAreas?.[0]?.pincode||"N/A"})]})]})]}),e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(n,{className:"text-base",children:"Legal Documents"})}),e.jsxs(c,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"PAN Number:"}),e.jsx("span",{children:re.businessInfo.panNumber||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"GST Number:"}),e.jsx("span",{children:re.businessInfo.gstNumber||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"License Number:"}),e.jsx("span",{children:re.businessInfo.licenseNumber||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Website:"}),e.jsx("span",{children:re.businessInfo.website||"N/A"})]})]})]}),re.approval.submittedDocuments&&re.approval.submittedDocuments.length>0&&e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(n,{className:"text-base",children:"Submitted Documents"})}),e.jsx(c,{children:e.jsx("div",{className:"space-y-2",children:re.approval.submittedDocuments.map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.documentName}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.documentType})]})]}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>window.open(s.documentUrl,"_blank"),children:"View"})]},i))})})]})]}),e.jsx(T,{children:e.jsx(r,{variant:"outline",onClick:()=>ne(!1),children:"Close"})})]})}),e.jsx(P,{open:fe,onOpenChange:ue,children:e.jsxs(S,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(B,{children:[e.jsx(I,{children:"approve"===ve?"under_review"===re?.approval.status?"Complete Verification":"Approve Application":"Reject Application"}),e.jsx(F,{children:"approve"===ve?"Complete the verification checklist and provide approval details":"Provide a reason for rejecting this application"})]}),re&&e.jsxs("div",{className:"space-y-6",children:[re.approval.lockedBy&&String(re.approval.lockedBy._id)!==String(K?.id)&&"superadmin"!==K?.role&&e.jsxs(Y,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(D,{className:"h-4 w-4 text-yellow-600"}),e.jsx(O,{children:"Application Locked"}),e.jsxs(z,{children:["This vendor application is currently being handled by"," ",e.jsx("strong",{children:re.approval.lockedBy.profile?.firstName?`${re.approval.lockedBy.profile.firstName} ${re.approval.lockedBy.profile.lastName||""}`:re.approval.lockedBy.email}),". You cannot approve or reject this application."]})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:re.businessInfo.companyName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[re.user.profile.firstName," ",re.user.profile.lastName," â€¢ ",re.user.email]}),re.approval.lockedBy&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("p",{className:"text-xs font-medium text-primary",children:"Currently Handling:"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[re.approval.lockedBy.profile?.firstName?`${re.approval.lockedBy.profile.firstName} ${re.approval.lockedBy.profile.lastName||""}`:re.approval.lockedBy.email,re.approval.lockedBy._id===K?.id&&" (You)"]}),re.approval.lockedAt&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Since: ",new Date(re.approval.lockedAt).toLocaleString()]})]}),re.approval.phoneVerifiedBy&&re.approval.phoneVerifiedBy._id!==re.approval.lockedBy?._id&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("p",{className:"text-xs font-medium text-blue-600",children:"Phone Verified By:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:re.approval.phoneVerifiedBy.profile?.firstName?`${re.approval.phoneVerifiedBy.profile.firstName} ${re.approval.phoneVerifiedBy.profile.lastName||""}`:re.approval.phoneVerifiedBy.email})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"approverName",children:["Approver Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(x,{id:"approverName",value:Ne,onChange:e=>ge(e.target.value),placeholder:"Enter your full name",disabled:be.phoneVerified}),re.approval.lockedBy&&re.approval.lockedBy._id===K?.id&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"You are currently handling this application. Your name is pre-filled from the initial action."})]}),"approve"===ve&&e.jsxs(e.Fragment,{children:[e.jsxs(t,{className:"border-2 border-primary/20",children:[e.jsx(l,{children:e.jsxs(n,{className:"text-base flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-primary"}),"Step 1: Phone Verification (Required)"]})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Phone: ",re.user.profile.phone||"N/A"]})]}),be.phoneVerified?e.jsxs(R,{variant:"default",className:"bg-green-600",children:[e.jsx(p,{className:"w-4 h-4 mr-1"}),"Verified"]}):e.jsx(r,{onClick:async()=>{if(re&&Ne.trim()){Pe(!0);try{const e=await M(`/admin/vendor-approvals/${re._id}/verify-phone`,{method:"POST",body:JSON.stringify({approverName:Ne})});await L(e);ye(e=>({...e,phoneVerified:!0})),te(e=>e?{...e,approval:{...e.approval,status:"under_review",phoneVerifiedAt:(new Date).toISOString(),verificationChecklist:{...e.approval.verificationChecklist,phoneVerified:!0}}}:e),await Ie(),_({title:"Phone Verified",description:"Phone verification successful. Status changed to under review.",variant:"default"})}catch(e){_({title:"Error",description:e instanceof Error?e.message:"Failed to verify phone",variant:"destructive"})}finally{Pe(!1)}}else _({title:"Error",description:"Please enter approver name first",variant:"destructive"})},disabled:ke||!Ne.trim(),size:"sm",children:ke?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Verifying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"Verify Phone"]})})]}),re.approval.phoneVerifiedAt&&null!==Se&&e.jsxs(Y,{children:[e.jsx(o,{className:"h-4 w-4"}),e.jsx(O,{children:"Verification Freeze Period"}),e.jsx(z,{children:Se>0?e.jsxs(e.Fragment,{children:["Time remaining until other verifications unlock: "," ",e.jsx("strong",{className:"text-primary",children:_e(Se)})]}):e.jsx("span",{className:"text-green-600 font-semibold",children:"Freeze period completed! You can now proceed with other verifications."})})]})]})]}),e.jsxs(t,{children:[e.jsx(l,{children:e.jsxs(n,{className:"text-base",children:["Step 2: Verification Checklist ",!Me()&&"(Locked - Complete phone verification first)"]})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Personal Information"}),e.jsxs("div",{className:"space-y-2 pl-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"emailVerified",checked:be.emailVerified,onCheckedChange:e=>ye({...be,emailVerified:e}),disabled:!Me()}),e.jsx("label",{htmlFor:"emailVerified",className:"text-sm cursor-pointer",children:"Email verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"identityProofVerified",checked:be.identityProofVerified,onCheckedChange:e=>ye({...be,identityProofVerified:e}),disabled:!Me()}),e.jsx("label",{htmlFor:"identityProofVerified",className:"text-sm cursor-pointer",children:"Identity documents verified (Aadhar/Passport/DL)"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Business Information"}),e.jsxs("div",{className:"space-y-2 pl-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"businessNameVerified",checked:be.businessNameVerified,onCheckedChange:e=>ye({...be,businessNameVerified:e}),disabled:!Me()}),e.jsx("label",{htmlFor:"businessNameVerified",className:"text-sm cursor-pointer",children:"Business name verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"businessTypeVerified",checked:be.businessTypeVerified,onCheckedChange:e=>ye({...be,businessTypeVerified:e}),disabled:!Me()}),e.jsx("label",{htmlFor:"businessTypeVerified",className:"text-sm cursor-pointer",children:"Business type verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"businessDescriptionVerified",checked:be.businessDescriptionVerified,onCheckedChange:e=>ye({...be,businessDescriptionVerified:e}),disabled:!Me()}),e.jsx("label",{htmlFor:"businessDescriptionVerified",className:"text-sm cursor-pointer",children:"Business description verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"experienceVerified",checked:be.experienceVerified,onCheckedChange:e=>ye({...be,experienceVerified:e}),disabled:!Me()}),e.jsx("label",{htmlFor:"experienceVerified",className:"text-sm cursor-pointer",children:"Professional experience verified"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Address Information"}),e.jsx("div",{className:"space-y-2 pl-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"addressVerified",checked:be.addressVerified,onCheckedChange:e=>ye({...be,addressVerified:e}),disabled:!Me()}),e.jsx("label",{htmlFor:"addressVerified",className:"text-sm cursor-pointer",children:"Address verified and matches records"})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Legal Documents"}),e.jsxs("div",{className:"space-y-2 pl-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"panNumberVerified",checked:be.panNumberVerified,onCheckedChange:e=>ye({...be,panNumberVerified:e}),disabled:!Me()}),e.jsx("label",{htmlFor:"panNumberVerified",className:"text-sm cursor-pointer",children:"PAN card verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"gstNumberVerified",checked:be.gstNumberVerified,onCheckedChange:e=>ye({...be,gstNumberVerified:e}),disabled:!Me()}),e.jsx("label",{htmlFor:"gstNumberVerified",className:"text-sm cursor-pointer",children:"GST number verified (if applicable)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"licenseNumberVerified",checked:be.licenseNumberVerified,onCheckedChange:e=>ye({...be,licenseNumberVerified:e}),disabled:!Me()}),e.jsx("label",{htmlFor:"licenseNumberVerified",className:"text-sm cursor-pointer",children:"License/registration verified"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Documents"}),e.jsx("div",{className:"space-y-2 pl-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"businessRegistrationVerified",checked:be.businessRegistrationVerified,onCheckedChange:e=>ye({...be,businessRegistrationVerified:e}),disabled:!Me()}),e.jsx("label",{htmlFor:"businessRegistrationVerified",className:"text-sm cursor-pointer",children:"All required documents submitted and verified"})]})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"approvalComments",children:["Approval Comments ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(E,{id:"approvalComments",value:we,onChange:e=>Ve(e.target.value),placeholder:"Add any additional notes about this approval...",rows:4})]})]}),"reject"===ve&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"rejectionComments",children:["Rejection Reason ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(E,{id:"rejectionComments",value:Ae,onChange:e=>Ce(e.target.value),placeholder:"Provide a detailed reason for rejection...",rows:6})]})]}),e.jsxs(T,{children:[e.jsx(r,{variant:"outline",onClick:()=>{ue(!1),Te()},disabled:null!==me,children:"Cancel"}),"approve"===ve?e.jsx(r,{onClick:async()=>{re&&("under_review"===re.approval.status&&null!==Se&&Se>0?_({title:"Freeze Period Active",description:`Please wait ${_e(Se)} before completing the verification.`,variant:"destructive"}):await Re())},disabled:"approve"===me||!be.phoneVerified||null!==Se&&Se>0||re?.approval.lockedBy&&String(re.approval.lockedBy._id)!==String(K?.id)&&"superadmin"!==K?.role,children:"approve"===me?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):null!==Se&&Se>0?e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"Wait ",_e(Se)]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"under_review"===re?.approval.status?"Complete & Approve":"Approve"]})}):e.jsx(r,{variant:"destructive",onClick:async()=>{if(re)if(Ae.trim()){xe("reject");try{const e=await M(`/admin/vendor-approvals/${re._id}/reject`,{method:"POST",body:JSON.stringify({rejectionReason:Ae})});await L(e),_({title:"Success",description:"Vendor application rejected",variant:"default"}),ue(!1),await Ie(),await Fe()}catch(e){_({title:"Error",description:e instanceof Error?e.message:"Failed to reject vendor application",variant:"destructive"})}finally{xe(null)}}else _({title:"Error",description:"Rejection reason is required",variant:"destructive"})},disabled:"reject"===me||re?.approval.lockedBy&&String(re.approval.lockedBy._id)!==String(K?.id)&&"superadmin"!==K?.role,children:"reject"===me?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Reject Application"]})})]})]})})]})};export{K as default};

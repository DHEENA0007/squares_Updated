import{j as e}from"./ui-s1SEoZIF.js";import{r as s}from"./router-D8v2YSKU.js";import{_ as a,aA as t,X as r,I as i,a as l,e as c,b as d,c as n,d as o,k as m,s as x,B as h,f as p,E as j,a0 as u,a1 as v,a2 as f,a3 as N,a4 as g,aa as y,L as b,T as w}from"./index-YrVmIx3a.js";import{C as k}from"./checkbox-OYdlbG4C.js";import{f as C,h as R}from"./apiUtils-B8LmEMCW.js";import{V as S}from"./VirtualTourViewer-CQmpeFvH.js";import{C as P}from"./circle-alert-uA9gvtJK.js";import{C as $}from"./calendar-BA5iLWFv.js";import{R as F}from"./rotate-ccw-BQgocZh5.js";import"./vendor-BxThA0WO.js";import"./external-link-D82MRhUC.js";const V=()=>{const[V,T]=s.useState([]),[q,A]=s.useState(!0),[_,B]=s.useState(""),[E,I]=s.useState(1),[U,D]=s.useState(1),[L,O]=s.useState(null),[z,M]=s.useState(!1),[J,X]=s.useState(!1),[Z,G]=s.useState({}),{toast:H}=a(),[K,Q]=s.useState(""),[W,Y]=s.useState({issuesResolved:!1,documentsUpdated:!1,complianceChecked:!1,qualityImproved:!1,accuracyVerified:!1,readyForReview:!1}),[ee,se]=s.useState("");s.useEffect(()=>{ae()},[E,_]);const ae=async()=>{try{A(!0);const e=await C(`/subadmin/properties/rejected?page=${E}&search=${_}`),s=await R(e);T(s.data.properties||[]),D(s.data.totalPages||1)}catch(e){H({title:"Error",description:e.message||"Error fetching rejected properties",variant:"destructive"}),T([])}finally{A(!1)}};t("property_rejected",e=>{H({title:"Property Rejected",description:"A property has been rejected"}),ae()});const te=()=>{Y({issuesResolved:!1,documentsUpdated:!1,complianceChecked:!1,qualityImproved:!1,accuracyVerified:!1,readyForReview:!1}),se(""),Q("")},re=e=>{O(e),te(),X(!0)},ie=e=>`₹${e.toLocaleString("en-IN")}`;return q&&0===V.length?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Property Rejections"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"View and manage rejected property listings"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Property Rejections"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"View and manage rejected property listings"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(r,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(i,{placeholder:"Search rejected properties by title, city, state, email, or description...",value:_,onChange:e=>B(e.target.value),className:"pl-10"})]}),e.jsx("div",{className:"space-y-4",children:0===V.length?e.jsx(l,{children:e.jsxs(c,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(P,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Rejected Properties"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"There are no rejected properties at the moment"})]})}):V.map(s=>e.jsxs(l,{className:"border-l-4 border-l-red-500 overflow-hidden",children:[e.jsx(d,{className:"pb-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2 flex-1 text-center sm:text-left",children:[e.jsx(n,{className:"text-lg sm:text-xl leading-tight",children:s.title}),e.jsx(o,{className:"space-y-1",children:e.jsxs("div",{className:"flex flex-wrap justify-center sm:justify-start items-center gap-2 sm:gap-4 text-xs sm:text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(m,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.address.district?`${s.address.city}, ${s.address.district}, ${s.address.state}`:`${s.address.city}, ${s.address.state}`})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($,{className:"h-3 w-3 flex-shrink-0"}),e.jsxs("span",{className:"truncate",children:["Rejected: ",s.rejectedAt?new Date(s.rejectedAt).toLocaleDateString():"N/A"]})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(x,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.owner.email})]})]})}),s.rejectionReason&&e.jsx("div",{className:"bg-red-50 dark:bg-red-950 border border-red-200 dark:border-red-800 rounded-lg p-2 sm:p-3 mt-3 mx-auto sm:mx-0 max-w-full",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(P,{className:"h-4 w-4 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-red-900 dark:text-red-100",children:"Rejection Reason:"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1 break-words",children:s.rejectionReason}),s.rejectedBy&&e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1 truncate",children:["Rejected by: ",s.rejectedBy.name]})]})]})})]}),e.jsxs("div",{className:"text-center sm:text-right flex-shrink-0",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-primary mb-2",children:ie(s.price)}),e.jsxs("div",{className:"flex flex-col gap-1 items-center sm:items-end",children:[e.jsx(h,{variant:"destructive",className:"text-xs px-2 py-1 font-semibold",children:"Rejected"}),e.jsxs(h,{variant:"outline",className:"text-xs px-2 py-1 bg-blue-50 text-blue-700 border-blue-200",children:[s.type," • ",s.listingType]})]})]})]})}),e.jsx(c,{className:"pt-0",children:e.jsx("div",{className:"flex flex-col sm:flex-row gap-2 sm:justify-start",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>{O(s),M(!0)},className:"flex-1 touch-manipulation min-h-[40px]",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"View Details"]}),e.jsxs(p,{size:"sm",variant:"secondary",onClick:()=>re(s),disabled:Z[s._id],className:"flex-1 touch-manipulation min-h-[40px]",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Reactivate for Review"]})]})})})]},s._id))}),U>1&&e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(p,{variant:"outline",disabled:1===E,onClick:()=>I(E-1),children:"Previous"}),e.jsxs("span",{className:"px-3 py-2 text-sm",children:["Page ",E," of ",U]}),e.jsx(p,{variant:"outline",disabled:E===U,onClick:()=>I(E+1),children:"Next"})]}),e.jsx(u,{open:z,onOpenChange:M,children:e.jsxs(v,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(f,{children:[e.jsx(N,{children:L?.title}),e.jsx(g,{children:"Rejected property details and information"})]}),L&&e.jsxs("div",{className:"space-y-4",children:[L.rejectionReason&&e.jsx("div",{className:"bg-red-50 dark:bg-red-950 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(P,{className:"h-5 w-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-900 dark:text-red-100",children:"Rejection Reason:"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:L.rejectionReason}),L.rejectedBy&&e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400 mt-2",children:["Rejected by: ",L.rejectedBy.name," (",L.rejectedBy.email,")"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Property Details"}),e.jsxs("ul",{className:"text-sm space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Type:"})," ",L.type]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Listing Type:"})," ",L.listingType]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Price:"})," ",ie(L.price)]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Area:"})," ",(le=L.area,le.builtUp?`${le.builtUp} ${le.unit}`:le.plot?`${le.plot} ${le.unit}`:le.carpet?`${le.carpet} ${le.unit}`:"N/A")]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bedrooms:"})," ",L.bedrooms]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bathrooms:"})," ",L.bathrooms]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Location & Contact"}),e.jsxs("ul",{className:"text-sm space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Address:"})," ",L.address.street]}),e.jsxs("li",{children:[e.jsx("strong",{children:"City:"})," ",L.address.city]}),e.jsxs("li",{children:[e.jsx("strong",{children:"State:"})," ",L.address.state]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Zip Code:"})," ",L.address.zipCode]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Owner:"})," ",L.owner.name]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Email:"})," ",L.owner.email]})]})]})]}),L.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Description"}),e.jsx("p",{className:"text-sm",children:L.description})]}),L.images&&L.images.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Images"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:L.images.map((s,a)=>e.jsx("img",{src:s,alt:`Property ${a+1}`,className:"w-full h-32 object-cover rounded"},a))})]}),L.videos&&L.videos.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Videos"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:L.videos.map((s,a)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"relative aspect-video rounded-lg overflow-hidden border bg-black",children:s.url&&(s.url.includes("youtube.com")||s.url.includes("youtu.be"))?e.jsx("iframe",{src:s.url.replace("watch?v=","embed/").replace("youtu.be/","youtube.com/embed/"),className:"w-full h-full",allowFullScreen:!0,title:s.caption||`Video ${a+1}`}):e.jsx("video",{src:s.url,controls:!0,className:"w-full h-full object-contain",poster:s.thumbnail})}),s.caption&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.caption})]},a))})]}),L.virtualTour&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Virtual Tour"}),e.jsx(S,{url:L.virtualTour})]})]}),e.jsxs(y,{children:[e.jsx(p,{variant:"outline",onClick:()=>M(!1),children:"Close"}),L&&e.jsxs(p,{variant:"secondary",onClick:()=>{M(!1),re(L)},children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Reactivate for Review"]})]})]})}),e.jsx(u,{open:J,onOpenChange:X,children:e.jsxs(v,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(f,{children:[e.jsx(N,{children:"Reactivate Property for Review"}),e.jsxs(g,{children:['Complete the verification checklist to reactivate "',L?.title,'" for review. The property will move to pending status for approval.']})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"approver-name-reactivate",children:"Moderator Name *"}),e.jsx(i,{id:"approver-name-reactivate",placeholder:"Enter your full name",value:K,onChange:e=>Q(e.target.value),className:"mt-1"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(b,{className:"text-base font-semibold",children:"Reactivation Verification Checklist"}),e.jsxs("div",{className:"space-y-3 border rounded-lg p-4 bg-muted/30",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(k,{id:"issues-resolved",checked:W.issuesResolved,onCheckedChange:e=>Y({...W,issuesResolved:e})}),e.jsx("label",{htmlFor:"issues-resolved",className:"text-sm font-medium cursor-pointer",children:"Previous rejection issues have been resolved"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(k,{id:"documents-updated",checked:W.documentsUpdated,onCheckedChange:e=>Y({...W,documentsUpdated:e})}),e.jsx("label",{htmlFor:"documents-updated",className:"text-sm font-medium cursor-pointer",children:"Required documents are updated and complete"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(k,{id:"compliance-checked",checked:W.complianceChecked,onCheckedChange:e=>Y({...W,complianceChecked:e})}),e.jsx("label",{htmlFor:"compliance-checked",className:"text-sm font-medium cursor-pointer",children:"Property meets all compliance requirements"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(k,{id:"quality-improved",checked:W.qualityImproved,onCheckedChange:e=>Y({...W,qualityImproved:e})}),e.jsx("label",{htmlFor:"quality-improved",className:"text-sm font-medium cursor-pointer",children:"Content quality has been improved"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(k,{id:"accuracy-verified",checked:W.accuracyVerified,onCheckedChange:e=>Y({...W,accuracyVerified:e})}),e.jsx("label",{htmlFor:"accuracy-verified",className:"text-sm font-medium cursor-pointer",children:"Information accuracy has been verified"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(k,{id:"ready-review",checked:W.readyForReview,onCheckedChange:e=>Y({...W,readyForReview:e})}),e.jsx("label",{htmlFor:"ready-review",className:"text-sm font-medium cursor-pointer",children:"Property is ready for approval review"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"handwritten-comments-reactivate",children:"Reactivation Notes & Comments"}),e.jsx(w,{id:"handwritten-comments-reactivate",placeholder:"Type your handwritten comments or notes here...",value:ee,onChange:e=>se(e.target.value),className:"mt-1 min-h-[120px] font-handwriting",rows:6}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Add any additional observations, changes made, or special notes about the reactivation"})]})]}),e.jsxs(y,{children:[e.jsx(p,{variant:"outline",onClick:()=>X(!1),children:"Cancel"}),e.jsx(p,{className:"bg-blue-600 hover:bg-blue-700",onClick:async()=>{if(L&&K.trim())try{G({...Z,[L._id]:!0});const e=await C(`/subadmin/properties/${L._id}/reactivate`,{method:"POST",body:JSON.stringify({approver:K,notes:ee})});await R(e),H({title:"Success",description:"Property reactivated and moved to pending review"}),X(!1),te(),O(null),ae()}catch(e){H({title:"Error",description:"Failed to reactivate property",variant:"destructive"})}finally{G({...Z,[L._id]:!1})}else H({title:"Error",description:"Moderator name is required",variant:"destructive"})},disabled:!K.trim()||Z[L?._id||""],children:Z[L?._id||""]?"Reactivating...":"Reactivate Property"})]})]})})]});var le};export{V as default};

import{j as e}from"./ui-BHyUY8Z8.js";import{r,L as I}from"./router-2SVJvIbS.js";import{W as _,D as G,aN as x,f as n,a as k,b as y,c as f,d as w,e as T,L as i,I as C,Y as P,$ as ee,a0 as se,a1 as o,am as te,a9 as V,B as u,E as ae,J as re,K as ie,O as le,Q as ce,R as ne,q as oe,C as Y,Z as q,aO as de,n as me}from"./index-Bd1eLXM_.js";import{L as xe}from"./log-in-CZsPSAwd.js";import{C as ue}from"./circle-alert--1esrBFY.js";import"./vendor-Dazix4UH.js";const Ne=()=>{const{toast:c}=_(),[F,S]=r.useState([]),[M,D]=r.useState(!1),[l,$]=r.useState("all"),[h,U]=r.useState(""),[p,H]=r.useState(""),[d,z]=r.useState(""),[t,g]=r.useState(null),[K,j]=r.useState(!1),[J,L]=r.useState(!1),[v,A]=r.useState(""),[E,O]=r.useState(!1),[m,Q]=r.useState(!1);r.useEffect(()=>{const s=G.getToken();Q(!!s),s&&b()},[l]);const b=async()=>{if(!m){S([]);return}try{D(!0);const s={};l!=="all"&&(s.status=l);const a=await x.getMyTickets(s);S(a.data.tickets)}catch(s){console.error("Error fetching tickets:",s),!s.message?.includes("token")&&!s.message?.includes("401")&&c({title:"Error",description:"Failed to fetch tickets",variant:"destructive"})}finally{D(!1)}},W=async()=>{if(!p.trim()){c({title:"Validation Error",description:"Please enter a ticket number",variant:"destructive"});return}if(!d.trim()){c({title:"Validation Error",description:"Please enter your email address",variant:"destructive"});return}try{const s=await x.getTicketByNumber(p,d);g(s.data.ticket),j(!0)}catch(s){console.error("Error tracking ticket:",s)}},X=async()=>{if(!t||!v.trim()){c({title:"Validation Error",description:"Please enter a message",variant:"destructive"});return}try{O(!0),await x.addResponse(t.ticketNumber,v),A(""),c({title:"Success",description:"Your reply has been sent. Our support team will respond soon."});const s=await x.getTicketByNumber(t.ticketNumber,d||t.email);g(s.data.ticket),m&&b()}catch(s){console.error("Error adding response:",s)}finally{O(!1)}},N=s=>{const a={open:{icon:ue,class:"bg-blue-600",label:"Open"},"in-progress":{icon:me,class:"bg-yellow-600",label:"In Progress"},resolved:{icon:Y,class:"bg-green-600",label:"Resolved"},closed:{icon:q,class:"bg-gray-600",label:"Closed"}};return a[s]||a.open},R=s=>{const a={low:"bg-gray-100 text-gray-800",medium:"bg-blue-100 text-blue-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"};return a[s]||a.medium},B=F.filter(s=>s.subject.toLowerCase().includes(h.toLowerCase())||s.ticketNumber.toLowerCase().includes(h.toLowerCase()));return e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Support & Help Desk"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track your support requests and get help"})]}),e.jsx(n,{onClick:()=>L(!0),children:"Create Support Ticket"})]}),e.jsxs(k,{children:[e.jsxs(y,{children:[e.jsx(f,{children:"Track Ticket by Number"}),e.jsx(w,{children:"Enter your ticket number and email to view its status"})]}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"ticketNumber",children:"Ticket Number"}),e.jsx(C,{id:"ticketNumber",placeholder:"TKT-123456",value:p,onChange:s=>H(s.target.value.toUpperCase())})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"trackingEmail",children:"Email Address"}),e.jsx(C,{id:"trackingEmail",type:"email",placeholder:"your@email.com",value:d,onChange:s=>z(s.target.value)})]})]}),e.jsxs(n,{onClick:W,className:"w-full md:w-auto",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Track Ticket"]})]})})]}),e.jsxs(k,{children:[e.jsxs(y,{children:[e.jsx(f,{children:"My Support Tickets"}),e.jsx(w,{children:m?"View and manage your support requests":"Login to view your support tickets"})]}),e.jsx(T,{children:m?M?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading tickets..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(C,{placeholder:"Search tickets...",value:h,onChange:s=>U(s.target.value),className:"pl-10"})]}),e.jsxs(ee,{value:l,onValueChange:$,children:[e.jsxs(se,{children:[e.jsx(o,{value:"all",children:"All"}),e.jsx(o,{value:"open",children:"Open"}),e.jsx(o,{value:"in-progress",children:"In Progress"}),e.jsx(o,{value:"resolved",children:"Resolved"}),e.jsx(o,{value:"closed",children:"Closed"})]}),e.jsx(te,{value:l,className:"space-y-4 mt-4",children:B.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(V,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Tickets Found"}),e.jsx("p",{className:"text-muted-foreground",children:l==="all"?"You haven't created any support tickets yet":`No ${l} tickets to display`})]}):B.map(s=>{const a=N(s.status),Z=a.icon;return e.jsxs(k,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(y,{children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"text-lg",children:s.subject}),e.jsxs(u,{className:a.class,children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),a.label]}),e.jsx(u,{className:R(s.priority),children:s.priority.toUpperCase()})]}),e.jsxs(w,{children:["Ticket #",s.ticketNumber," â€¢ ",new Date(s.createdAt).toLocaleDateString()]})]})})}),e.jsxs(T,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-2",children:s.description}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>{g(s),j(!0)},children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"View Details"]})]})]},s._id)})})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xe,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Authentication Required"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Please login to view and manage your support tickets"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(n,{asChild:!0,children:e.jsx(I,{to:"/login",children:"Login"})}),e.jsx(n,{variant:"outline",asChild:!0,children:e.jsx(I,{to:"/signup",children:"Create Account"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-6",children:'Already have a ticket? Use the "Track by Number" section above to check your ticket status.'})]})})]}),e.jsx(re,{open:K,onOpenChange:j,children:e.jsxs(ie,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Ticket Details"}),e.jsxs(ne,{children:["Ticket #",t?.ticketNumber]})]}),t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Status"}),e.jsx("div",{className:"mt-1",children:e.jsx(u,{className:N(t.status).class,children:N(t.status).label})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Priority"}),e.jsx("div",{className:"mt-1",children:e.jsx(u,{className:R(t.priority),children:t.priority.toUpperCase()})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Category"}),e.jsx("p",{className:"text-sm mt-1 capitalize",children:t.category})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Created"}),e.jsx("p",{className:"text-sm mt-1",children:new Date(t.createdAt).toLocaleString()})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Subject"}),e.jsx("p",{className:"text-sm mt-1 font-semibold",children:t.subject})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Description"}),e.jsx("p",{className:"text-sm mt-1 whitespace-pre-wrap",children:t.description})]}),t.responses&&t.responses.length>0&&e.jsxs("div",{children:[e.jsx(i,{children:"Conversation"}),e.jsx("div",{className:"space-y-3 mt-2",children:t.responses.map((s,a)=>e.jsxs("div",{className:`p-4 rounded-lg ${s.isAdmin?"bg-blue-50 dark:bg-blue-950":"bg-muted"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm",children:s.author}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.isAdmin?"Support Team":"You"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleString()})]}),e.jsx("p",{className:"text-sm",children:s.message})]},a))})]}),t.status!=="closed"&&t.status!=="resolved"&&e.jsxs("div",{children:[e.jsx(i,{children:"Add Response"}),e.jsx(oe,{placeholder:"Type your message...",value:v,onChange:s=>A(s.target.value),rows:4,className:"mt-2"}),e.jsx("div",{className:"flex gap-2 mt-2",children:e.jsxs(n,{onClick:X,disabled:E,children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),E?"Sending...":"Send Reply"]})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Our support team will review and respond to your message. Only support staff can resolve tickets."})]}),t.status==="resolved"&&e.jsx("div",{className:"bg-green-50 dark:bg-green-950 border border-green-200 dark:border-green-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Y,{className:"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:"Ticket Resolved"}),e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300 mt-1",children:["This ticket has been marked as resolved by our support team.",t.resolvedAt&&` on ${new Date(t.resolvedAt).toLocaleDateString()}`]}),t.responses&&t.responses.length>0&&e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400 mt-2",children:"If you need further assistance, please create a new support ticket."})]})]})}),t.status==="closed"&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-gray-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:"Ticket Closed"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mt-1",children:"This ticket has been closed. For new issues, please create a new support ticket."})]})]})})]})]})}),e.jsx(de,{open:J,onOpenChange:L,onSuccess:s=>{c({title:"Ticket Created",description:`Your ticket number is ${s}. You can track it anytime.`}),b()}})]})};export{Ne as default};

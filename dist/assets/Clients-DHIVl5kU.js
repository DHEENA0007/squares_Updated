import{j as e}from"./ui-DYmpZ3pJ.js";import{r as n}from"./router-2SVJvIbS.js";import{x as K,D as ee,f as c,n as se,a as d,b as o,c as m,d as te,e as x,B as u,E as ae,a7 as F,z as ie,a8 as C,a9 as H,aa as D,U as re,ab as ne}from"./index-BbgqWuYN.js";import{D as le,a as ce,b as de,c as oe,d as me}from"./dialog-DsX3mE8Q.js";import{P as xe,a as he,b as P,c as ue,d as pe,e as je}from"./pagination-B81IIWK4.js";import{s as l}from"./subscriptionService-vz2ZVImT.js";import{S as ge}from"./SearchFilter-BrvzFCXm.js";import{T as fe,a as Ne,b as A,c as p,d as be,e as h}from"./table-Cruer2y3.js";import{L as ve}from"./loader-circle-DtIJ61xE.js";import{R as k}from"./refresh-cw-C8a82uL8.js";import{C as ye}from"./calendar-BL1izdXI.js";import{L as we,M as Se}from"./megaphone-D6nbbI42.js";import{C as Ce}from"./camera-BtNLnS3M.js";import"./vendor-Dazix4UH.js";import"./ellipsis-hsdzzVqq.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=K("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]),qe=()=>{const[w,I]=n.useState(""),[N,L]=n.useState("all"),[b,$]=n.useState([]),[z,E]=n.useState(!0),[r,g]=n.useState(1),[v,M]=n.useState(1),[t,U]=n.useState(null),[q,f]=n.useState(!1),{toast:i}=ee(),B=s=>{const a={className:"w-4 h-4"};switch(s?.toLowerCase()){case"photography":return e.jsx(Ce,{...a});case"marketing":return e.jsx(Se,{...a});case"technology":return e.jsx(we,{...a});case"support":return e.jsx(ne,{...a});case"crm":return e.jsx(re,{...a});default:return e.jsx(C,{...a})}},S=async()=>{try{E(!0);const s={page:r,limit:10,search:w||void 0,status:N==="all"?void 0:N},a=await l.getSubscriptions(s);console.log("Admin Clients - API Response:",a.data.subscriptions),a.data.subscriptions.forEach((j,y)=>{j.paymentHistory&&j.paymentHistory.length>0&&console.log(`Subscription ${y} Payment History:`,j.paymentHistory)}),$(a.data.subscriptions),M(a.data.pagination.totalPages)}catch(s){console.error("Failed to fetch subscriptions:",s),s instanceof Error&&(s.message.includes("Admin access required")?i({title:"Access Denied",description:"Admin privileges required to view subscriptions.",variant:"destructive"}):s.message.includes("Authentication required")?i({title:"Authentication Required",description:"Please log in to continue.",variant:"destructive"}):i({title:"Error",description:"Failed to load subscriptions. Please try again.",variant:"destructive"}))}finally{E(!1)}};n.useEffect(()=>{S()},[r,w,N]);const O=s=>{I(s),g(1)},V=s=>{L(s),g(1)},W=s=>{g(s)},Y=()=>{r<v&&g(r+1)},Q=()=>{r>1&&g(r-1)},X=()=>{i({title:"Exporting to Excel",description:"Your data is being exported to Excel format."})},Z=()=>{i({title:"Exporting to PDF",description:"Your data is being exported to PDF format."})},G=s=>{U(s),f(!0)},T=async s=>{if(s.status!=="active"){i({title:"Cannot Cancel",description:"Only active subscriptions can be cancelled.",variant:"destructive"});return}try{await l.cancelSubscription(s._id),i({title:"Subscription Cancelled",description:`${s.user.name}'s subscription has been cancelled.`}),S()}catch{i({title:"Error",description:"Failed to cancel subscription. Please try again.",variant:"destructive"})}},_=async s=>{if(s.status==="active"){i({title:"Cannot Renew",description:"Subscription is already active.",variant:"destructive"});return}try{await l.renewSubscription(s._id),i({title:"Subscription Renewed",description:`${s.user.name}'s subscription has been renewed.`}),S()}catch{i({title:"Error",description:"Failed to renew subscription. Please try again.",variant:"destructive"})}};return z?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(ve,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading clients..."})]}):e.jsxs("div",{className:"space-y-6 relative top-[60px]",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Subscribed Clients"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage client subscriptions and details"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",onClick:X,children:[e.jsx(De,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:"Export Excel"})]}),e.jsxs(c,{variant:"outline",onClick:Z,children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:"Export PDF"})]})]})]}),e.jsxs(d,{children:[e.jsxs(o,{children:[e.jsx(m,{children:"All Clients"}),e.jsxs(te,{children:[b.length," client",b.length!==1?"s":""," found"]})]}),e.jsxs(x,{children:[e.jsx(ge,{searchTerm:w,onSearchChange:O,filterValue:N,onFilterChange:V,filterOptions:[{label:"Active",value:"active"},{label:"Expired",value:"expired"},{label:"Cancelled",value:"cancelled"}],filterPlaceholder:"Filter by status"}),e.jsx("div",{className:"rounded-lg border border-border bg-card overflow-hidden",children:e.jsxs(fe,{children:[e.jsx(Ne,{children:e.jsxs(A,{className:"bg-muted/50",children:[e.jsx(p,{className:"font-semibold",children:"Client"}),e.jsx(p,{className:"font-semibold",children:"Plan"}),e.jsx(p,{className:"font-semibold",children:"Amount"}),e.jsx(p,{className:"font-semibold",children:"Start Date"}),e.jsx(p,{className:"font-semibold",children:"End Date"}),e.jsx(p,{className:"font-semibold",children:"Status"}),e.jsx(p,{className:"font-semibold text-right",children:"Actions"})]})}),e.jsx(be,{children:b.length===0?e.jsx(A,{children:e.jsx(h,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No subscriptions found"})}):b.map(s=>e.jsxs(A,{className:"hover:bg-muted/30 transition-colors",children:[e.jsx(h,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.user.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.user.email})]})}),e.jsx(h,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.plan?.name||"N/A"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.plan?.billingPeriod||"N/A"})]})}),e.jsx(h,{children:e.jsx("span",{className:"font-semibold",children:l.formatAmount(s)})}),e.jsx(h,{children:new Date(s.startDate).toLocaleDateString()}),e.jsx(h,{children:new Date(s.endDate).toLocaleDateString()}),e.jsx(h,{children:e.jsx(u,{variant:s.status==="active"?"default":s.status==="expired"?"destructive":"secondary",children:l.formatSubscriptionStatus(s.status).label})}),e.jsx(h,{className:"text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(c,{variant:"ghost",size:"sm",onClick:()=>G(s),children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:"View"})]}),s.status==="active"&&e.jsxs(c,{variant:"ghost",size:"sm",onClick:()=>T(s),className:"text-red-600 hover:text-red-700",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:"Cancel"})]}),(s.status==="expired"||s.status==="cancelled")&&e.jsxs(c,{variant:"ghost",size:"sm",onClick:()=>_(s),className:"text-green-600 hover:text-green-700",children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:"Renew"})]})]})})]},s._id))})]})}),v>1&&e.jsx("div",{className:"mt-6",children:e.jsx(xe,{children:e.jsxs(he,{children:[e.jsx(P,{children:e.jsx(ue,{onClick:Q,className:r===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:v},(s,a)=>a+1).map(s=>e.jsx(P,{children:e.jsx(pe,{onClick:()=>W(s),isActive:r===s,className:"cursor-pointer",children:s})},s)),e.jsx(P,{children:e.jsx(je,{onClick:Y,className:r===v?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]}),e.jsx(le,{open:q,onOpenChange:f,children:e.jsxs(ce,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(de,{children:[e.jsx(oe,{children:"Subscription Details"}),e.jsxs(me,{children:["Complete information about ",t?.user.name,"'s subscription"]})]}),t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5"}),"Client Information"]})}),e.jsx(x,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Name"}),e.jsx("p",{className:"text-base",children:t.user.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Email"}),e.jsx("p",{className:"text-base",children:t.user.email})]}),t.user.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"text-base",children:t.user.phone})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"User ID"}),e.jsx("p",{className:"text-sm font-mono",children:t.user._id})]})]})})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"Plan Information"]})}),e.jsx(x,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Plan Name"}),e.jsx("p",{className:"text-base font-semibold",children:t.plan?.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Description"}),e.jsx("p",{className:"text-base",children:t.plan?.description||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Plan Price"}),e.jsx("p",{className:"text-base font-semibold",children:t.plan?.price?l.formatAmount({...t,amount:t.plan.price}):"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Billing Period"}),e.jsx("p",{className:"text-base",children:t.plan?.billingPeriod||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Plan ID"}),e.jsx("p",{className:"text-sm font-mono",children:t.plan?._id||"N/A"})]})]})})]}),t.addons&&t.addons.length>0&&e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Purchased Addons (",t.addons.length,")"]})}),e.jsxs(x,{className:"space-y-3",children:[e.jsx("div",{className:"grid gap-4",children:t.addons.map((s,a)=>e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-border rounded-lg bg-muted/30",children:[e.jsx("div",{className:"p-2 rounded-lg bg-background border",children:B(s.category)}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:"font-semibold text-base text-foreground",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 overflow-hidden",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:s.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx(u,{variant:"outline",className:"capitalize text-xs",children:s.category}),e.jsx(u,{variant:"secondary",className:"text-xs",children:s.billingType?.replace("_"," ")||"N/A"})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:"font-semibold text-lg text-foreground",children:s.price?`${s.currency==="INR"?"₹":"$"}${s.price}`:"Free"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.billingType==="monthly"?"/month":s.billingType==="yearly"?"/year":s.billingType==="per_property"?"/property":s.billingType==="one_time"?"one-time":""})]})]})})]},s._id||a))}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50/50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Total Addons"}),e.jsxs("p",{className:"text-sm text-blue-700",children:[t.addons.length," addon",t.addons.length!==1?"s":""," purchased"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-blue-900",children:t.addons.reduce((s,a)=>s+(a.price||0),0)>0?`${t.currency==="INR"?"₹":"$"}${t.addons.reduce((s,a)=>s+(a.price||0),0)}`:"Free"}),e.jsx("p",{className:"text-xs text-blue-700",children:"addons value"})]})]})})]})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"Subscription Details"]})}),e.jsx(x,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx(u,{variant:t.status==="active"?"default":t.status==="expired"?"destructive":"secondary",className:"mt-1",children:l.formatSubscriptionStatus(t.status).label})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Auto Renew"}),e.jsx(u,{variant:t.autoRenew?"default":"secondary",className:"mt-1",children:t.autoRenew?"Enabled":"Disabled"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Start Date"}),e.jsx("p",{className:"text-base",children:new Date(t.startDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"End Date"}),e.jsx("p",{className:"text-base",children:new Date(t.endDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Days Remaining"}),e.jsx("p",{className:"text-base",children:t.status==="active"?`${l.getDaysUntilExpiry(t)} days`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Created At"}),e.jsx("p",{className:"text-base",children:new Date(t.createdAt).toLocaleDateString()})]})]})})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"Payment Information"]})}),e.jsx(x,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Amount Paid"}),e.jsx("p",{className:"text-base font-semibold",children:l.formatAmount(t)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Currency"}),e.jsx("p",{className:"text-base",children:t.currency})]}),t.paymentMethod&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Payment Method"}),e.jsx("p",{className:"text-base capitalize",children:t.paymentMethod.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Subscription ID"}),e.jsx("p",{className:"text-sm font-mono",children:t._id})]})]})})]}),t.paymentHistory&&t.paymentHistory.length>0&&e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"Payment History (",t.paymentHistory.length,")"]})}),e.jsxs(x,{className:"space-y-3",children:[e.jsx("div",{className:"space-y-4",children:t.paymentHistory.sort((s,a)=>new Date(a.date).getTime()-new Date(s.date).getTime()).map((s,a)=>e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-border rounded-lg bg-muted/20",children:[e.jsx("div",{className:"p-2 rounded-lg bg-background border",children:s.type==="addon_purchase"?e.jsx(H,{className:"w-4 h-4 text-orange-600"}):s.type==="subscription_purchase"?e.jsx(C,{className:"w-4 h-4 text-blue-600"}):s.type==="renewal"?e.jsx(k,{className:"w-4 h-4 text-green-600"}):e.jsx(D,{className:"w-4 h-4 text-purple-600"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:"font-semibold text-base text-foreground",children:s.type==="addon_purchase"?`Addon Purchase (${s.addons?.length||0} addon${(s.addons?.length||0)!==1?"s":""})`:s.type==="subscription_purchase"?"Subscription Purchase":s.type==="renewal"?"Subscription Renewal":"Subscription Upgrade"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:new Date(s.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}),s.type==="addon_purchase"&&s.addons&&s.addons.length>0&&e.jsxs("div",{className:"mt-2 p-2 bg-orange-50 border border-orange-200 rounded-md",children:[e.jsx("p",{className:"text-xs font-medium text-orange-800 mb-1",children:"Purchased Addons:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.addons.map((j,y)=>{const J=t.addons?.find(R=>R._id===j||R._id===j.toString());return e.jsx(u,{variant:"outline",className:"text-xs text-orange-700",children:J?.name||`Addon ${y+1}`},y)})})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx(u,{variant:s.type==="addon_purchase"?"default":"secondary",className:"capitalize text-xs",children:s.type.replace("_"," ")}),s.transactionId&&e.jsxs("p",{className:"text-xs text-muted-foreground font-mono",children:["ID: ",s.transactionId]})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("p",{className:"font-semibold text-lg text-foreground",children:[t.currency==="INR"?"₹":"$",s.amount]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.paymentMethod?.replace("_"," ")||"razorpay"})]})]})})]},s._id||a))}),e.jsx("div",{className:"mt-4 p-4 bg-green-50/50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900",children:"Total Payments"}),e.jsxs("p",{className:"text-sm text-green-700",children:[t.paymentHistory.length," transaction",t.paymentHistory.length!==1?"s":""]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-green-900",children:[t.currency==="INR"?"₹":"$",t.paymentHistory.reduce((s,a)=>s+(a.amount||0),0)]}),e.jsx("p",{className:"text-xs text-green-700",children:"total paid"})]})]})})]})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{children:"Quick Actions"})}),e.jsx(x,{children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[t.status==="active"&&e.jsxs(c,{variant:"destructive",size:"sm",onClick:()=>{T(t),f(!1)},children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Cancel Subscription"]}),(t.status==="expired"||t.status==="cancelled")&&e.jsxs(c,{variant:"default",size:"sm",onClick:()=>{_(t),f(!1)},children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Renew Subscription"]}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>f(!1),children:"Close"})]})})]})]})]})})]})};export{qe as default};

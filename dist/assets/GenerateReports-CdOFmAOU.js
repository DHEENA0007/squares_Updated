import{j as e}from"./ui-DOY6021Z.js";import{r as p}from"./router-2SVJvIbS.js";import{ax as L,U as I,aI as z,a as n,b as c,c as o,e as i,I as v,f as g,q as E,r as G,s as B,v as _,w as O,o as $}from"./index-SPvHGBGF.js";import{C as R}from"./checkbox-BLKtZrMn.js";import{T as H}from"./trending-up-ohBLGDCN.js";import{D as J}from"./dollar-sign-CwZezxSE.js";import{D as S}from"./download-CnSrVYPf.js";import"./vendor-Dazix4UH.js";const se=()=>{const[d,C]=p.useState(""),[r,h]=p.useState(),[u,D]=p.useState("all"),[m,f]=p.useState(["pdf"]),[l,y]=p.useState([]),[N,b]=p.useState(!1),[w,P]=p.useState(""),j=[{type:"property_performance",title:"Property Performance Report",description:"Property listings, views, leads, and conversion rates",icon:L,dataPoints:["Total Properties Listed","Properties by Type","Average Property Views","Lead Generation Rate","Property Approval Rate","Price Trends by Location"],formats:["pdf","excel","csv"]},{type:"vendor_analytics",title:"Vendor Analytics Report",description:"Vendor performance, activity, and revenue metrics",icon:I,dataPoints:["Active Vendors Count","Vendor Performance Scores","Revenue by Vendor","Vendor Response Times","Property Listings by Vendor","Vendor Subscription Status"],formats:["pdf","excel"]},{type:"user_engagement",title:"User Engagement Report",description:"User activity, searches, and platform engagement",icon:H,dataPoints:["Active User Count","User Registration Trends","Search Patterns","Page Views & Sessions","Feature Usage Statistics","User Retention Rates"],formats:["pdf","excel","csv"]},{type:"financial_summary",title:"Financial Summary Report",description:"Revenue, subscriptions, and financial metrics",icon:J,dataPoints:["Total Revenue","Subscription Revenue","Promotion Revenue","Monthly Recurring Revenue","Payment Success Rate","Revenue by City/Region"],formats:["pdf","excel"]},{type:"city_regional",title:"City/Regional Analysis",description:"Location-specific property and user metrics",icon:z,dataPoints:["Properties by City","User Distribution","Popular Localities","Price Ranges by Area","Market Demand Analysis","Growth Trends by Region"],formats:["pdf","excel","csv"]}],T=["all","Mumbai","Delhi","Bangalore","Hyderabad","Chennai","Kolkata","Pune","Ahmedabad","Jaipur","Lucknow"],F=[{id:"pdf",label:"PDF Report",description:"Formatted report with charts"},{id:"excel",label:"Excel Spreadsheet",description:"Data tables and calculations"},{id:"csv",label:"CSV Data",description:"Raw data export"}],k=s=>{C(s);const t=j.find(a=>a.type===s);t&&(y(t.dataPoints.slice(0,3)),f(t.formats.slice(0,1)))},U=(s,t)=>{f(t?[...m,s]:m.filter(a=>a!==s))},A=(s,t)=>{y(t?[...l,s]:l.filter(a=>a!==s))},M=async()=>{if(!d||l.length===0||m.length===0){alert("Please select report type, metrics, and format");return}b(!0);try{const s={reportType:d,dateRange:r?{from:r.from?.toISOString(),to:r.to?.toISOString()}:null,city:u,metrics:l,formats:m,customName:w||`${j.find(a=>a.type===d)?.title} - ${new Date().toLocaleDateString()}`},t=await fetch("/api/admin/reports/generate",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(t.ok){const a=await t.json();a.downloadUrl?window.open(a.downloadUrl,"_blank"):a.files&&a.files.forEach(V=>{window.open(V.downloadUrl,"_blank")}),alert("Report generated successfully!")}else alert("Failed to generate report")}catch(s){console.error("Failed to generate report:",s),alert("Failed to generate report")}finally{b(!1)}},x=j.find(s=>s.type===d);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Generate Reports"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Create comprehensive city/region-level reports and analytics"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(n,{children:[e.jsx(c,{children:e.jsx(o,{children:"Select Report Type"})}),e.jsx(i,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:j.map(s=>{const t=s.icon;return e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-all ${d===s.type?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"}`,onClick:()=>k(s.type),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-md ${d===s.type?"bg-primary text-white":"bg-gray-100"}`,children:e.jsx(t,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-sm mb-1",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:s.description})]})]})},s.type)})})})]}),x&&e.jsxs(n,{children:[e.jsx(c,{children:e.jsx(o,{children:"Select Data Metrics"})}),e.jsxs(i,{children:[e.jsx("div",{className:"space-y-3",children:x.dataPoints.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{id:s,checked:l.includes(s),onCheckedChange:t=>A(s,t)}),e.jsx("label",{htmlFor:s,className:"text-sm font-medium cursor-pointer",children:s})]},s))}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:["Selected ",l.length," of ",x.dataPoints.length," metrics"]})})]})]}),x&&e.jsxs(n,{children:[e.jsx(c,{children:e.jsx(o,{children:"Export Formats"})}),e.jsx(i,{children:e.jsx("div",{className:"space-y-3",children:F.map(s=>{const t=x.formats.includes(s.id);return e.jsxs("div",{className:`flex items-center space-x-3 ${t?"":"opacity-50"}`,children:[e.jsx(R,{id:s.id,checked:m.includes(s.id),onCheckedChange:a=>U(s.id,a),disabled:!t}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:s.id,className:"text-sm font-medium cursor-pointer",children:s.label}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description})]})]},s.id)})})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(n,{children:[e.jsx(c,{children:e.jsx(o,{children:"Date Range"})}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"From Date"}),e.jsx(v,{type:"date",value:r?.from?.toISOString().split("T")[0]||"",onChange:s=>h(t=>({...t,from:s.target.value?new Date(s.target.value):void 0}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"To Date"}),e.jsx(v,{type:"date",value:r?.to?.toISOString().split("T")[0]||"",onChange:s=>h(t=>({...t,to:s.target.value?new Date(s.target.value):void 0}))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{variant:"outline",size:"sm",className:"w-full",onClick:()=>h({from:new Date(new Date().getTime()-720*60*60*1e3),to:new Date}),children:"Last 30 Days"}),e.jsx(g,{variant:"outline",size:"sm",className:"w-full",onClick:()=>h({from:new Date(new Date().getTime()-2160*60*60*1e3),to:new Date}),children:"Last 90 Days"})]})]})]}),e.jsxs(n,{children:[e.jsx(c,{children:e.jsx(o,{children:"Location Filter"})}),e.jsx(i,{children:e.jsxs(E,{value:u,onValueChange:D,children:[e.jsx(G,{children:e.jsx(B,{})}),e.jsx(_,{children:T.map(s=>e.jsx(O,{value:s,children:s==="all"?"All Cities":s},s))})]})})]}),e.jsxs(n,{children:[e.jsx(c,{children:e.jsx(o,{children:"Report Name"})}),e.jsx(i,{children:e.jsx(v,{placeholder:"Custom report name (optional)",value:w,onChange:s=>P(s.target.value)})})]}),e.jsxs(n,{children:[e.jsx(c,{children:e.jsx(o,{children:"Summary"})}),e.jsxs(i,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Report Type:"}),e.jsx("span",{className:"font-medium",children:x?x.title:"None"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Metrics:"}),e.jsx("span",{className:"font-medium",children:l.length})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Formats:"}),e.jsx("span",{className:"font-medium",children:m.length})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Location:"}),e.jsx("span",{className:"font-medium",children:u==="all"?"All Cities":u})]}),r?.from&&r?.to&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Period:"}),e.jsxs("span",{className:"font-medium",children:[Math.ceil((r.to.getTime()-r.from.getTime())/(1e3*60*60*24))," days"]})]})]})]}),e.jsx(n,{children:e.jsx(i,{className:"pt-6",children:e.jsx(g,{onClick:M,disabled:N||!d||l.length===0||m.length===0,className:"w-full",children:N?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Generating..."]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4"}),"Generate Report"]})})})})]})]}),e.jsxs(n,{children:[e.jsx(c,{children:e.jsx(o,{children:"Recent Reports"})}),e.jsx(i,{children:e.jsx("div",{className:"space-y-3",children:[{name:"Property Performance - Mumbai",date:"2024-11-03",format:"PDF",size:"2.4 MB"},{name:"User Engagement Report",date:"2024-11-02",format:"Excel",size:"1.8 MB"},{name:"Financial Summary Q4",date:"2024-11-01",format:"PDF",size:"3.1 MB"}].map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.date," • ",s.format," • ",s.size]})]})]}),e.jsxs(g,{variant:"outline",size:"sm",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Download"]})]},t))})})]})]})};export{se as default};

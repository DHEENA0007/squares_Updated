import{j as e}from"./ui-s1SEoZIF.js";import{d as s,r as a}from"./router-D8v2YSKU.js";import{u as n,a2 as i,G as r,f as t,a9 as l,a as c,b as d,c as o,d as m,e as x,$ as p,I as h,at as j,av as u,aw as f,ax as g,ay as v,az as N,aA as b,aB as y,Z as P,B as C,aD as w,aE as A,aF as S,aG as k,aH as E,aI as D,ad as _}from"./index-DvBXyKtT.js";import{u as L}from"./usePagination-1Z845fFX.js";import{P as M,a as I,b as F,c as T,d as R,e as B}from"./pagination-Di26qYlD.js";import{p as O}from"./planService-BDwsJXuj.js";import{D as z}from"./DataTable-Buzwx94b.js";import{P as G}from"./PriceRangeFilter-DhBWk_6M.js";import{E as $}from"./ellipsis-Cl__aAUc.js";import{S as q}from"./square-pen-BWhTlLJ9.js";import"./vendor-BxThA0WO.js";import"./table-Bkp50phG.js";import"./slider-CXZ6CuBs.js";const H=()=>{const H=s(),{user:V}=n(),{toast:Y}=i(),Z=V?.rolePermissions||[],J="admin"===V?.role||"superadmin"===V?.role,K=e=>Z.includes(e),Q=J||K(P.PLANS_READ),U=J||K(P.PLANS_CREATE),W=J||K(P.PLANS_EDIT),X=J||K(P.PLANS_DELETE),[ee,se]=a.useState(""),[ae,ne]=a.useState(""),[ie,re]=a.useState(""),[te,le]=a.useState(""),[ce,de]=a.useState(1e5),[oe,me]=a.useState([]),[xe,pe]=a.useState(!0),[he,je]=a.useState(!1),[ue,fe]=a.useState(null);a.useEffect(()=>{Q||(Y({title:"Access Denied",description:"You don't have permission to view plans.",variant:"destructive"}),H("/rolebased"))},[Q,H,Y]),a.useEffect(()=>{(async()=>{try{const e=await O.getPlans({limit:1e3});if(e.success){me(e.data.plans);const s=Math.max(...e.data.plans.map(e=>e.price),0);de(s||1e5)}}catch(e){}finally{pe(!1)}})()},[]);const ge=a.useMemo(()=>oe.filter(e=>{const s=e.name.toLowerCase().includes(ee.toLowerCase()),a=""===ae||void 0!==e.billingCycleMonths&&e.billingCycleMonths===parseInt(ae),n=""===ie||e.price>=parseFloat(ie),i=""===te||e.price<=parseFloat(te);return s&&a&&n&&i}),[oe,ee,ae,ie,te]),{paginatedItems:ve,currentPage:Ne,totalPages:be,goToPage:ye,nextPage:Pe,previousPage:Ce}=L(ge,10),we=[{key:"name",label:"Plan Name",render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.description.substring(0,50),"..."]})]})},{key:"price",label:"Price",render:s=>e.jsx("span",{className:"font-semibold",children:O.formatPrice(s)})},{key:"features",label:"Features",render:s=>{const a=Array.isArray(s.features)?s.features.map(e=>"string"==typeof e?e:e.name):[];return e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,2).map((s,a)=>e.jsx(C,{variant:"secondary",className:"text-xs",children:s},a)),a.length>2&&e.jsxs(C,{variant:"secondary",className:"text-xs",children:["+",a.length-2]})]})}},{key:"subscriberCount",label:"Subscribers",render:s=>e.jsx("span",{className:"font-medium",children:s.subscriberCount||0})},{key:"isActive",label:"Status",render:s=>e.jsx(C,{variant:O.getPlanBadgeVariant(s),children:s.isActive?"Active":"Inactive"})},{key:"actions",label:"Actions",render:s=>e.jsxs(w,{children:[e.jsx(A,{asChild:!0,children:e.jsxs(t,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx($,{className:"w-4 h-4"})]})}),e.jsxs(S,{align:"end",children:[e.jsx(k,{children:"Actions"}),e.jsx(E,{}),W&&e.jsxs(D,{onClick:()=>H(`/admin/plans/edit/${s._id}`),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Edit Plan"]}),X&&e.jsxs(D,{onClick:()=>(e=>{fe(e),je(!0)})(s),className:"text-destructive focus:text-destructive",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Delete Plan"]})]})]})}];return xe?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(r,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading plans..."})]}):e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"dashboard-header-responsive",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"dashboard-title-responsive",children:"Plan Management"}),e.jsx("p",{className:"text-muted-foreground mt-1 md:mt-2 text-sm md:text-base",children:"Manage subscription plans and pricing"})]}),U&&e.jsxs(t,{onClick:()=>H("/admin/plans/create"),className:"w-full sm:w-auto",children:[e.jsx(l,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Create Plan"}),e.jsx("span",{className:"sm:hidden",children:"Create"})]})]}),e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsx(o,{className:"text-lg md:text-xl",children:"All Plans"}),e.jsxs(m,{className:"text-sm md:text-base",children:[ge.length," plan",1!==ge.length?"s":""," found"]})]}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(p,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(h,{placeholder:"Search plans...",value:ee,onChange:e=>se(e.target.value),className:"pl-10"})]}),e.jsx("div",{className:"flex-1",children:e.jsx(h,{placeholder:"Filter by months (e.g., 1, 12)",value:ae,onChange:e=>ne(e.target.value)})})]})}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-2 lg:w-80",children:e.jsx(G,{minPrice:ie,maxPrice:te,onMinPriceChange:re,onMaxPriceChange:le,maxPossiblePrice:ce,currency:"INR"})})]}),e.jsx("div",{className:"table-responsive-wrapper",children:e.jsx(z,{columns:we,data:ve.map(e=>({...e,id:e._id})),hideDefaultActions:!0})}),be>1&&e.jsx("div",{className:"mt-4 md:mt-6",children:e.jsx(M,{children:e.jsxs(I,{className:"pagination-responsive",children:[e.jsx(F,{children:e.jsx(T,{onClick:Ce,className:"pagination-button-responsive "+(1===Ne?"pointer-events-none opacity-50":"cursor-pointer")})}),Array.from({length:be},(e,s)=>s+1).map(s=>e.jsx(F,{children:e.jsx(R,{onClick:()=>ye(s),isActive:Ne===s,className:"pagination-button-responsive cursor-pointer",children:s})},s)),e.jsx(F,{children:e.jsx(B,{onClick:Pe,className:"pagination-button-responsive "+(Ne===be?"pointer-events-none opacity-50":"cursor-pointer")})})]})})})]})})]}),e.jsx(j,{open:he,onOpenChange:je,children:e.jsxs(u,{children:[e.jsxs(f,{children:[e.jsx(g,{children:"Delete Plan"}),e.jsxs(v,{children:['Are you sure you want to delete "',ue?.name,'"? This action cannot be undone.']})]}),e.jsxs(N,{children:[e.jsx(b,{children:"Cancel"}),e.jsx(y,{onClick:async()=>{if(ue)try{await O.deletePlan(ue._id),me(oe.filter(e=>e._id!==ue._id)),je(!1),fe(null)}catch(e){}},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})]})};export{H as default};

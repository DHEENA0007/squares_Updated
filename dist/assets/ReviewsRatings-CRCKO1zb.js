import{j as e}from"./ui-DHQhougw.js";import{d as s,r as t}from"./router-Bi51YGN-.js";import{a1 as a,y as r,t as l,aq as i,f as n,ax as c,a as d,e as o,G as x,I as m,S as h,q as u,r as p,s as j,v as g,B as v,h as w,E as f,aE as N,Q as y,R as b,V as C,W as R,Y as S,a0 as P}from"./index-CV77Hym3.js";import{R as A}from"./refresh-cw-DllRcUU9.js";import{C as k}from"./calendar-BwxHbBld.js";import{P as T}from"./pen-line-DYC6RHU2.js";import{T as L}from"./trash-2-Da1AQ7FG.js";import"./vendor-eVk5PToZ.js";const D=()=>{const{isConnected:D}=a(),E=s(),[F,$]=t.useState(!0),[V,z]=t.useState(!1),[_,B]=t.useState([]),[q,H]=t.useState(""),[I,O]=t.useState("all"),[Y,G]=t.useState("newest"),[M,Q]=t.useState(!1),[W,J]=t.useState(null),[K,U]=t.useState(!1),X="https://api.buildhomemartsquares.com/api",Z=t.useCallback(async()=>{try{$(!0);const e=r.getToken(),s=await fetch(`${X}/customer/reviews/given`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),t=await s.json();t.success?B(t.data?.reviews||[]):l({title:"Error",description:t.message||"Failed to load reviews",variant:"destructive"})}catch(e){l({title:"Error",description:"Failed to load reviews. Please try again.",variant:"destructive"})}finally{$(!1)}},[X]),ee=t.useCallback(async()=>{z(!0),await Z(),z(!1)},[Z]);t.useEffect(()=>{Z()},[Z]);const se=_.filter(e=>{const s=e.property?.title?.toLowerCase().includes(q.toLowerCase())||`${e.property?.address?.city||""}, ${e.property?.address?.state||""}`.toLowerCase().includes(q.toLowerCase())||e.title?.toLowerCase().includes(q.toLowerCase()),t="all"===I||e.rating===parseInt(I);return s&&t}).sort((e,s)=>{switch(Y){case"newest":return new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime();case"oldest":return new Date(e.createdAt).getTime()-new Date(s.createdAt).getTime();case"rating-high":return s.rating-e.rating;case"rating-low":return e.rating-s.rating;default:return 0}}),te=e=>new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"}),ae=e=>{if(!e||0===e.length)return"/placeholder-property.jpg";const s=e.find(e=>e.isPrimary);return s?.url||e[0]?.url||"/placeholder-property.jpg"};return e.jsxs("div",{className:"space-y-6 pt-16",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(i,{className:"w-8 h-8 text-primary fill-primary"}),"Reviews & Ratings"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your reviews and see what you have shared"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{variant:"outline",onClick:ee,disabled:V,children:[e.jsx(A,{className:"w-4 h-4 mr-2 "+(V?"animate-spin":"")}),V?"Refreshing...":"Refresh"]}),e.jsxs(n,{onClick:()=>E("/customer/owned-properties"),children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),"View Properties"]})]})]}),!F&&_.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(d,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:_.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Reviews"})]})})}),e.jsx(d,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:(_.reduce((e,s)=>e+s.rating,0)/_.length).toFixed(1)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Average Rating"})]})})}),e.jsx(d,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:_.filter(e=>e.rating>=4).length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Positive Reviews"})]})})}),e.jsx(d,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:_.filter(e=>e.isPublic).length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Public Reviews"})]})})})]}),e.jsx(d,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(x,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(m,{type:"text",placeholder:"Search reviews or properties...",className:"pl-10",value:q,onChange:e=>H(e.target.value)})]}),e.jsxs(h,{value:I,onValueChange:O,children:[e.jsx(u,{className:"w-full sm:w-40",children:e.jsx(p,{placeholder:"Rating"})}),e.jsxs(j,{children:[e.jsx(g,{value:"all",children:"All Ratings"}),e.jsx(g,{value:"5",children:"5 Stars"}),e.jsx(g,{value:"4",children:"4 Stars"}),e.jsx(g,{value:"3",children:"3 Stars"}),e.jsx(g,{value:"2",children:"2 Stars"}),e.jsx(g,{value:"1",children:"1 Star"})]})]}),e.jsxs(h,{value:Y,onValueChange:G,children:[e.jsx(u,{className:"w-full sm:w-40",children:e.jsx(p,{placeholder:"Sort By"})}),e.jsxs(j,{children:[e.jsx(g,{value:"newest",children:"Newest First"}),e.jsx(g,{value:"oldest",children:"Oldest First"}),e.jsx(g,{value:"rating-high",children:"Rating: High to Low"}),e.jsx(g,{value:"rating-low",children:"Rating: Low to High"})]})]})]})})}),!F&&se.length>0&&e.jsx("div",{className:"space-y-4",children:se.map(s=>e.jsx(d,{className:"overflow-hidden",children:e.jsx(o,{className:"p-0",children:e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[e.jsxs("div",{className:"lg:w-48 h-48 lg:h-auto bg-muted relative",children:[e.jsx("img",{src:ae(s.property?.images),alt:s.property?.title||"Property",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute top-3 left-3 flex gap-2",children:e.jsx(v,{className:"sold"===s.property?.status?"bg-purple-600 text-white":"bg-blue-600 text-white",children:"sold"===s.property?.status?"Purchased":"Rented"})})]}),e.jsxs("div",{className:"flex-1 p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-1",children:s.property?.title||"Property"}),e.jsxs("div",{className:"flex items-center gap-4 text-muted-foreground text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-4 h-4"}),s.property?.address?.city||"",", ",s.property?.address?.state||""]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"w-4 h-4"}),"Reviewed on ",te(s.createdAt)]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(t=>e.jsx(i,{className:"w-5 h-5 "+(t<=s.rating?"fill-yellow-400 text-yellow-400":"text-gray-300")},t))}),e.jsxs("span",{className:"font-semibold text-lg",children:[s.rating,".0"]}),s.isPublic?e.jsx(v,{variant:"secondary",children:"Public"}):e.jsx(v,{variant:"outline",children:"Private"})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold text-lg mb-2",children:s.title}),e.jsx("p",{className:"text-muted-foreground",children:s.comment})]}),s.vendor&&e.jsx("div",{className:"p-3 bg-muted/50 rounded-lg mb-4",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Seller: "}),e.jsx("span",{className:"font-medium",children:s.vendor.name})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>E(`/property/${s.property?._id}`),children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"View Property"]}),e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>E("/customer/owned-properties"),children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Edit Review"]}),e.jsxs(n,{size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",onClick:()=>{J(s),Q(!0)},children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Delete"]})]}),s.updatedAt!==s.createdAt&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-3",children:["Last updated: ",te(s.updatedAt)]})]})]})})},s._id))}),F&&e.jsx(d,{children:e.jsx(o,{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Loading your reviews..."})]})})}),!F&&0===se.length&&e.jsx(d,{children:e.jsxs(o,{className:"p-12 text-center",children:[e.jsx(i,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:0===_.length?"No reviews yet":"No reviews match your filters"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:0===_.length?"You haven't written any reviews yet. Visit your owned properties to write your first review!":"Try adjusting your search criteria or clear some filters."}),e.jsx("div",{className:"flex gap-2 justify-center",children:0===_.length?e.jsxs(n,{onClick:()=>E("/customer/owned-properties"),children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),"View Owned Properties"]}):e.jsxs(n,{variant:"outline",onClick:()=>{H(""),O("all"),G("newest")},children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Clear Filters"]})})]})}),e.jsx(y,{open:M,onOpenChange:Q,children:e.jsxs(b,{children:[e.jsxs(C,{children:[e.jsx(R,{children:"Delete Review"}),e.jsx(S,{children:"Are you sure you want to delete this review? This action cannot be undone."})]}),W&&e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"font-semibold mb-1",children:W.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:W.property?.title||"Property"})]}),e.jsxs(P,{children:[e.jsx(n,{variant:"outline",onClick:()=>{Q(!1),J(null)},disabled:K,children:"Cancel"}),e.jsx(n,{variant:"destructive",onClick:async()=>{if(W)try{U(!0);const e=r.getToken(),s=await fetch(`${X}/customer/reviews/${W._id}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),t=await s.json();t.success?(l({title:"Success",description:"Review deleted successfully"}),B(e=>e.filter(e=>e._id!==W._id)),Q(!1),J(null)):l({title:"Error",description:t.message||"Failed to delete review",variant:"destructive"})}catch(e){l({title:"Error",description:"Failed to delete review. Please try again.",variant:"destructive"})}finally{U(!1)}},disabled:K,children:K?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 mr-2 animate-spin"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Delete Review"]})})]})]})})]})};export{D as default};

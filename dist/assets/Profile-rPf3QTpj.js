import{j as e}from"./ui-DYmpZ3pJ.js";import{r}from"./router-2SVJvIbS.js";import{am as ue,Z as p,t as Y,ao as w,B as J,f as u,z as ge,a4 as K,T as ve,G as Ne,H as X,$ as Z,a as N,e as y,K as ye,L as be,O as Ce,S as we,M as Se,w as Pe,h as De,b as E,c as $,I as S,C as Re,p as F,q as L,r as T,s as k,v as V,X as Ae,E as Ee,Y as I,a9 as Q}from"./index-BbgqWuYN.js";import{L as m}from"./label-DRahLfWI.js";import{T as $e}from"./textarea-Cl1lQCIh.js";import{P as Fe}from"./PincodeAutocomplete-DpuhK1i5.js";import{u as P}from"./userService-BmC1RzMq.js";import{c as W}from"./customerDashboardService-CGiSxEyq.js";import{c as Le}from"./customerPropertiesService-B_8XMQ_n.js";import{R as ee}from"./refresh-cw-C8a82uL8.js";import{P as Te}from"./pen-line-CsOTZIbM.js";import{C as ke}from"./camera-BtNLnS3M.js";import{C as Ve}from"./calendar-BL1izdXI.js";import{S as Ie}from"./save-MzbdIAk0.js";import{T as qe}from"./trending-up-CE6F-QOW.js";import{A as se}from"./activity-CR4yNzpZ.js";import"./vendor-Dazix4UH.js";import"./command-DqNKR-gI.js";import"./dialog-DsX3mE8Q.js";import"./loader-circle-DtIJ61xE.js";const rs=()=>{const{isConnected:q,lastEvent:z}=ue(),[f,D]=r.useState(!1),[b,M]=r.useState(!0),[U,_]=r.useState(!1),[R,B]=r.useState(!1),[v,te]=r.useState(null),[a,x]=r.useState({name:"",email:"",phone:"",location:"",address:"",pincode:"",bio:"",joinDate:"",avatar:"",verified:!1}),[i,j]=r.useState({states:[],districts:[],cities:[],selectedState:"",selectedDistrict:"",selectedCity:"",loadingStates:!1,loadingDistricts:!1,loadingCities:!1}),[h,g]=r.useState({propertiesPosted:0,inquiriesReceived:0,responseRate:0,avgResponseTime:"N/A",rating:0,reviews:0,totalViews:0,totalFavorites:0}),[H,ae]=r.useState([]);r.useEffect(()=>{(async()=>{try{await p.initialize();const t=p.getStates();j(n=>({...n,states:t}))}catch(t){console.error("Error initializing location service:",t)}})()},[]);const ie=r.useCallback(s=>{j(t=>({...t,selectedState:s,selectedDistrict:"",selectedCity:"",districts:p.getDistricts(s),cities:[]})),x(t=>({...t,location:`${s}`}))},[]),re=r.useCallback(s=>{j(t=>{const n=t.selectedState;return{...t,selectedDistrict:s,selectedCity:"",cities:p.getCities(n,s)}}),x(t=>({...t,location:`${s}, ${i.selectedState}`}))},[i.selectedState]),le=r.useCallback(s=>{j(t=>({...t,selectedCity:s})),x(t=>({...t,location:`${s}, ${i.selectedDistrict}, ${i.selectedState}`}))},[i.selectedState,i.selectedDistrict]),ce=r.useCallback(s=>{if(!s)return"Not specified";const t=[];return s.city&&t.push(s.city),s.district&&s.district!==s.city&&t.push(s.district),s.state&&t.push(s.state),t.length>0?t.join(", "):"Not specified"},[]),C=r.useCallback(async()=>{try{M(!0);const[s,t,n]=await Promise.all([P.getCurrentUser(),W.getCustomerDashboardData().catch(()=>null),Le.getCustomerPropertyStats().catch(()=>null)]),d=s.data.user;te(d);const c=d.profile.address,fe=c?`${c.city||""}, ${c.state||""}`.replace(/^,\s*|,\s*$/g,""):"";if(console.log("Loading user data, address:",c),console.log("Existing zipCode from database:",c?.zipCode),x({name:P.getFullName(d),email:d.email,phone:d.profile.phone||"",location:fe,address:c?.street||"",pincode:c?.zipCode||"",bio:"",joinDate:P.formatCreationDate(d.createdAt),avatar:"",verified:d.emailVerified}),c?.state||c?.city){const l=c.state||"",o=c.city||"";if(j(A=>({...A,selectedState:l,selectedCity:o,districts:l?p.getDistricts(l):[],cities:l?p.getCities(l,""):[]})),o&&l){const A=p.getDistricts(l);for(const G of A){const O=p.getCities(l,G);if(O.includes(o)){j(je=>({...je,selectedDistrict:G,cities:O}));break}}}}if(t?.success){const l=t.data.stats;g(o=>({...o,inquiriesReceived:l.activeInquiries,totalViews:l.propertiesViewed,totalFavorites:l.savedFavorites})),ae(t.data.recentActivities.map(o=>({id:o._id,type:o.type,message:o.message,timestamp:o.time,icon:o.icon})))}if(n?.success){const l=n.data;g(o=>({...o,propertiesPosted:l.totalProperties,responseRate:Math.round(l.conversionRate)||0,avgResponseTime:l.averageInquiries>0?"< 2 hours":"N/A"}))}}catch(s){console.error("Error loading user data:",s),Y({title:"Error",description:"Failed to load profile data",variant:"destructive"})}finally{M(!1)}},[]),ne=r.useCallback(async()=>{B(!0),await C(),B(!1)},[]);r.useEffect(()=>{C()},[]);const de=r.useCallback(()=>{console.log("Profile updated via realtime"),C()},[]),oe=r.useCallback(()=>{g(s=>({...s,inquiriesReceived:s.inquiriesReceived+1}))},[]),me=r.useCallback(()=>{g(s=>({...s,totalViews:s.totalViews+1}))},[]),xe=r.useCallback(s=>{s.action==="add"?g(t=>({...t,totalFavorites:t.totalFavorites+1})):s.action==="remove"&&g(t=>({...t,totalFavorites:Math.max(0,t.totalFavorites-1)}))},[]);w("profile_updated",de),w("property_inquiry",oe),w("property_viewed",me),w("property_favorited",xe);const pe=async()=>{if(v)try{_(!0);const s={notifications:{email:!0,sms:!1,push:!0},privacy:{showEmail:!1,showPhone:!1}},t=v.profile?.preferences,n=t?{notifications:{email:t.notifications?.email??s.notifications.email,sms:t.notifications?.sms??s.notifications.sms,push:t.notifications?.push??s.notifications.push},privacy:{showEmail:t.privacy?.showEmail??s.privacy.showEmail,showPhone:t.privacy?.showPhone??s.privacy.showPhone}}:s,d={profile:{firstName:a.name.split(" ")[0]||"",lastName:a.name.split(" ").slice(1).join(" ")||"",phone:a.phone,address:{street:a.address,city:i.selectedCity||a.location.split(",")[0]?.trim()||"",district:i.selectedDistrict||"",state:i.selectedState||a.location.split(",")[1]?.trim()||"",zipCode:a.pincode||""},preferences:n}};console.log("Profile data being sent:",d),console.log("Current profile.pincode:",a.pincode),console.log("Address object being sent:",d.profile?.address),await P.updateCurrentUser(d),await C(),console.log("User data refreshed, checking pincode..."),D(!1)}catch(s){console.error("Error saving profile:",s)}finally{_(!1)}},he=()=>{D(!1)};return b?e.jsx("div",{className:"space-y-6 pt-24",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-lg",children:"Loading profile..."})})}):e.jsxs("div",{className:"space-y-6 pt-16",children:[e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${q?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-sm text-muted-foreground",children:q?"Real-time profile updates active":"Offline mode"}),z&&e.jsxs(J,{variant:"secondary",className:"text-xs",children:["Last update: ",new Date(z.timestamp).toLocaleTimeString()]})]}),e.jsxs(u,{variant:"outline",size:"sm",onClick:ne,disabled:R,children:[e.jsx(ee,{className:`w-4 h-4 mr-2 ${R?"animate-spin":""}`}),R?"Refreshing...":"Refresh"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(ge,{className:"w-8 h-8 text-primary"}),"My Profile"]}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:["View your profile information and activity. Visit ",e.jsx("span",{className:"font-medium",children:"Settings"})," to manage preferences."]})]}),e.jsxs("div",{className:"flex gap-2",children:[!f&&!b&&e.jsxs(u,{onClick:()=>D(!0),children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Edit Profile"]}),e.jsxs(u,{variant:"outline",onClick:()=>window.location.href="/customer/settings",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Settings"]})]})]}),e.jsxs(ve,{defaultValue:"profile",className:"space-y-6",children:[e.jsxs(Ne,{className:"grid w-full grid-cols-2",children:[e.jsx(X,{value:"profile",children:"Profile"}),e.jsx(X,{value:"activity",children:"Activity"})]}),e.jsxs(Z,{value:"profile",className:"space-y-6",children:[e.jsx(N,{children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(ye,{className:"w-24 h-24",children:[e.jsx(be,{src:a.avatar}),e.jsx(Ce,{className:"text-2xl",children:a.name.split(" ").map(s=>s[0]).join("")})]}),f&&e.jsx(u,{size:"icon",variant:"secondary",className:"absolute -bottom-2 -right-2 rounded-full",children:e.jsx(ke,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-2xl font-bold",children:a.name}),a.verified&&e.jsxs(J,{variant:"default",className:"bg-green-100 text-green-800",children:[e.jsx(we,{className:"w-3 h-3 mr-1"}),"Verified"]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:"w-4 h-4"}),a.email]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"w-4 h-4"}),a.phone]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"w-4 h-4"}),a.location]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ve,{className:"w-4 h-4"}),"Joined ",a.joinDate]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:h.rating.toFixed(1)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Rating"})]}),e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:h.propertiesPosted}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Properties"})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(N,{children:[e.jsx(E,{children:e.jsx($,{children:"Personal Information"})}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Full Name"}),f?e.jsx(S,{value:a.name,onChange:s=>x(t=>({...t,name:s.target.value}))}):e.jsx("p",{className:"text-sm",children:a.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Email"}),f?e.jsx(S,{type:"email",value:a.email,onChange:s=>x(t=>({...t,email:s.target.value}))}):e.jsx("p",{className:"text-sm",children:a.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Phone"}),f?e.jsx(S,{value:a.phone,onChange:s=>x(t=>({...t,phone:s.target.value}))}):e.jsx("p",{className:"text-sm",children:a.phone})]}),f?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2 col-span-2",children:[e.jsx(m,{htmlFor:"pincode",children:"PIN Code"}),e.jsx(Fe,{value:a.pincode||"",state:i.selectedState,district:i.selectedDistrict,city:i.selectedCity,onChange:(s,t)=>{if(console.log("Pincode selected:",s,t),x(n=>({...n,pincode:s})),t){console.log("Auto-filling location from pincode:",t);const n=p.getDistricts(t.state),d=p.getCities(t.state,t.district);j(c=>({...c,selectedState:t.state||"",selectedDistrict:t.district||"",selectedCity:t.city||"",districts:n,cities:d})),x(c=>({...c,location:`${t.city}, ${t.district}, ${t.state}`,pincode:s})),console.log("Profile updated with pincode and location:",{pincode:s,location:`${t.city}, ${t.district}, ${t.state}`}),Y({title:"Location Auto-filled âœ“",description:`${t.city}, ${t.district}, ${t.state}`})}},placeholder:"Enter PIN code to auto-fill location...",className:"w-full"}),e.jsxs("div",{className:"space-y-1 mt-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"ðŸ’¡ Type your PIN code to auto-fill state, district, and city"}),a.pincode&&i.selectedCity&&e.jsxs("p",{className:"text-xs text-green-600 flex items-center gap-1",children:[e.jsx(Re,{className:"w-3 h-3"}),"Location: ",i.selectedCity,", ",i.selectedDistrict,", ",i.selectedState]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"State"}),e.jsxs(F,{value:i.selectedState,onValueChange:ie,children:[e.jsx(L,{children:e.jsx(T,{placeholder:"Select state"})}),e.jsx(k,{children:i.states.map(s=>e.jsx(V,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"District"}),e.jsxs(F,{value:i.selectedDistrict,onValueChange:re,disabled:!i.selectedState,children:[e.jsx(L,{children:e.jsx(T,{placeholder:i.selectedState?i.loadingDistricts?"Loading districts...":"Select district":"Select state first"})}),e.jsx(k,{children:i.districts.map(s=>e.jsx(V,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"City"}),e.jsxs(F,{value:i.selectedCity,onValueChange:le,disabled:!i.selectedDistrict,children:[e.jsx(L,{children:e.jsx(T,{placeholder:i.selectedState?i.selectedDistrict?i.loadingCities?"Loading cities...":"Select city":"Select district first":"Select state first"})}),e.jsx(k,{children:i.cities.map(s=>e.jsx(V,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Street Address"}),e.jsx(S,{value:a.address,onChange:s=>x(t=>({...t,address:s.target.value})),placeholder:"House/Flat number, Street name, Area"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Location"}),e.jsx("p",{className:"text-sm",children:v?.profile?.address?ce(v.profile.address):"Not specified"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Address"}),e.jsx("p",{className:"text-sm",children:a.address||"Not specified"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"PIN Code"}),e.jsx("p",{className:"text-sm",children:v?.profile?.address?.zipCode||a.pincode||"Not provided"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Bio"}),f?e.jsx($e,{rows:3,value:a.bio,onChange:s=>x(t=>({...t,bio:s.target.value}))}):e.jsx("p",{className:"text-sm",children:a.bio})]}),f&&e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(u,{onClick:pe,disabled:U,children:U?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Save Changes"]})}),e.jsxs(u,{variant:"outline",onClick:he,children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})]}),e.jsxs(N,{children:[e.jsx(E,{children:e.jsx($,{children:"Account Statistics"})}),e.jsx(y,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm",children:"Properties Posted"})]}),e.jsx("span",{className:"font-semibold",children:h.propertiesPosted})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"Inquiries Received"})]}),e.jsx("span",{className:"font-semibold",children:h.inquiriesReceived})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{className:"text-sm",children:"Total Views"})]}),e.jsx("span",{className:"font-semibold",children:h.totalViews.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-sm",children:"Total Favorites"})]}),e.jsx("span",{className:"font-semibold",children:h.totalFavorites})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-sm",children:"Average Rating"})]}),e.jsxs("span",{className:"font-semibold",children:[h.rating.toFixed(1),"/5.0"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-sm",children:"Response Rate"})]}),e.jsxs("span",{className:"font-semibold",children:[h.responseRate,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"Avg Response Time"})]}),e.jsx("span",{className:"font-semibold",children:h.avgResponseTime})]})]})})]})]}),e.jsx(N,{className:"border-primary/20 bg-primary/5",children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{className:"w-8 h-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Manage Your Preferences"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure notifications, privacy, security, and account settings"})]})]}),e.jsx(u,{onClick:()=>window.location.href="/customer/settings",children:"Go to Settings"})]})})})]}),e.jsx(Z,{value:"activity",className:"space-y-6",children:e.jsxs(N,{children:[e.jsx(E,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5"}),"Recent Activity"]})}),e.jsx(y,{children:!b&&H.length>0?e.jsx("div",{className:"space-y-4",children:H.map(s=>{const t=n=>{switch(n){case"property_posted":return"bg-green-500";case"inquiry":return"bg-blue-500";case"favorite":return"bg-red-500";case"search":return"bg-purple-500";default:return"bg-gray-500"}};return e.jsxs("div",{className:"flex items-start gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mt-2 ${t(s.type)}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:W.formatTimeAgo(s.timestamp)})]})]},s.id)})}):b?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading activity..."})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(se,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"No recent activity"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start browsing properties to see your activity here"})]})})]})})]})]})};export{rs as default};

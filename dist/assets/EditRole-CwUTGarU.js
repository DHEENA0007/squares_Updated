import{j as e}from"./ui-DHQhougw.js";import{e as s,d as a,r as l}from"./router-Bi51YGN-.js";import{$ as i,u as t,K as n,f as r,A as c,a as d,b as o,c as m,d as x,e as h,L as u,I as p,T as j,a3 as g,a4 as f,a5 as v,ao as N,aj as b,B as y}from"./index-BXXWUbfo.js";import{C as S}from"./checkbox-D3MPyViC.js";import{r as w}from"./roleService-BbVzZVbZ.js";import{I as C}from"./info-CsMHxSMx.js";import"./vendor-eVk5PToZ.js";const k=()=>{const{id:k}=s(),R=a(),{toast:A}=i(),{isSuperAdmin:F}=t(),[L,z]=l.useState(null),[E,I]=l.useState(!0),[D,P]=l.useState(!1);l.useEffect(()=>{(async()=>{if(k)try{I(!0);const e=(await w.getRole(k)).data.role;z({...e,pages:e.pages||[]})}catch(e){A({title:"Error",description:"Failed to load role data.",variant:"destructive"}),R("/admin/roles")}finally{I(!1)}})()},[k,R,A]);const U=({pages:s})=>{if(!L)return null;const a=L.pages||[];return e.jsx("div",{className:"space-y-2",children:s.map(s=>e.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg hover:bg-accent/50 transition-colors",children:[e.jsx(S,{id:s.id,checked:a.includes(s.id),onCheckedChange:()=>(e=>{if(!L)return;if(L.isSystemRole&&!F)return;const s=L.pages||[],a=s.includes(e)?s.filter(s=>s!==e):[...s,e];z({...L,pages:a})})(s.id),disabled:L.isSystemRole&&!F}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs(u,{htmlFor:s.id,className:"flex items-center gap-2 cursor-pointer font-medium",children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label,s.subLabel&&e.jsx(y,{variant:"outline",className:"text-xs",children:s.subLabel})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),e.jsx("p",{className:"text-xs text-muted-foreground font-mono",children:s.path})]})]},s.id))})};return E?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(n,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading role..."})]}):L?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>R("/admin/roles"),children:e.jsx(c,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold",children:["Edit Role: ",L.name]}),e.jsx("p",{className:"text-muted-foreground",children:"Update role details and page access"})]})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),L&&k)if(L.pages&&0!==L.pages.length)try{P(!0),await w.updateRole(k,{name:L.name,description:L.description,pages:L.pages,isActive:L.isActive,level:L.level}),R("/admin/roles")}catch(s){}finally{P(!1)}else A({title:"Validation Error",description:"Please select at least one page",variant:"destructive"})},className:"space-y-6",children:[e.jsxs(d,{children:[e.jsxs(o,{children:[e.jsx(m,{children:"Basic Information"}),e.jsx(x,{children:"Core details about this role"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{htmlFor:"name",children:["Role Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(p,{id:"name",value:L.name,onChange:e=>z({...L,name:e.target.value}),disabled:L.isSystemRole&&!F,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"level",children:"Access Level (1-10)"}),e.jsx(p,{id:"level",type:"number",min:"1",max:"10",value:L.level,onChange:e=>z({...L,level:parseInt(e.target.value)||1}),disabled:L.isSystemRole&&!F})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"description",children:"Description"}),e.jsx(j,{id:"description",value:L.description,onChange:e=>z({...L,description:e.target.value}),rows:3})]})]})]}),e.jsxs(d,{children:[e.jsxs(o,{children:[e.jsx(m,{children:"Page Access"}),e.jsx(x,{children:"Select which pages this role can access"})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg flex gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-900 dark:text-blue-100",children:[e.jsxs("p",{className:"font-medium mb-1",children:["Selected: ",L.pages?.length||0," pages"]}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300",children:"Choose pages from different portal categories. Users with this role will only see and access the selected pages."})]})]}),e.jsxs(g,{defaultValue:"admin",className:"w-full",children:[e.jsxs(f,{className:"grid w-full grid-cols-4",children:[e.jsx(v,{value:"admin",children:"Super Admin"}),e.jsx(v,{value:"subadmin",children:"Sub Admin"}),e.jsx(v,{value:"vendor",children:"Vendor"}),e.jsx(v,{value:"customer",children:"Customer"})]}),["admin","subadmin","vendor","customer"].map(s=>{const a=N(s),l=L.pages||[],i=a.filter(e=>l.includes(e.id)).length;return e.jsxs(b,{value:s,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-accent/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium capitalize",children:[s," Pages"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[i," of ",a.length," selected"]})]}),e.jsx(r,{type:"button",variant:"outline",size:"sm",onClick:()=>(e=>{if(!L)return;if(L.isSystemRole&&!F)return;const s=N(e),a=L.pages||[];if(s.every(e=>a.includes(e.id)))z({...L,pages:a.filter(e=>!s.some(s=>s.id===e))});else{const e=s.map(e=>e.id);z({...L,pages:[...new Set([...a,...e])]})}})(s),disabled:L.isSystemRole&&!F,children:i===a.length?"Deselect All":"Select All"})]}),e.jsx(U,{pages:a})]},s)})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(r,{type:"submit",disabled:D,children:D?"Saving...":"Save Changes"}),e.jsx(r,{type:"button",variant:"outline",onClick:()=>R("/admin/roles"),disabled:D,children:"Cancel"})]})]})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>R("/admin/roles"),children:e.jsx(c,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Role Not Found"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"The requested role could not be found."})]})]})})};export{k as default};

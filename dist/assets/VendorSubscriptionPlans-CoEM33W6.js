const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/paymentService-Bmek8sEN.js","assets/index-Ds-LUfCl.js","assets/ui-CEFKCYQo.js","assets/router-Bi51YGN-.js","assets/vendor-eVk5PToZ.js","assets/vendorService-DaSf1bV0.js","assets/reviewsService-BjiyFrCd.js"])))=>i.map(i=>d[i]);
import{W as e,aD as s,aq as t,f as a,A as r,G as l,B as n,a as i,b as c,c as d,e as o,C as m,U as x,as as u,Q as h,bm as p}from"./index-Ds-LUfCl.js";import{j}from"./ui-CEFKCYQo.js";import{r as g,d as b}from"./router-Bi51YGN-.js";import{a as f}from"./addonService-DkkxMR__.js";import{p as N}from"./planService-BkSKNG44.js";import{Z as v}from"./zap-BuINo2JR.js";import{S as y}from"./shield-TyKi0w-x.js";import{A as w}from"./arrow-right-17g90Bos.js";import{S}from"./share-2-D83ZlLlQ.js";import{V as _}from"./video-Bv1qd4Mi.js";import{C as P}from"./camera-C8A2fCF8.js";import"./vendor-eVk5PToZ.js";const A=()=>{const[A,C]=g.useState(1),[k,$]=g.useState(null),[L,E]=g.useState([]),[Y,z]=g.useState([]),[O,T]=g.useState(null),[F,M]=g.useState(!0),[R]=g.useState("monthly"),[B,D]=g.useState(!1),[I,U]=g.useState(!0),[V,q]=g.useState([]),[G,Q]=g.useState(!0),{toast:W}=e(),Z=b();g.useEffect(()=>{H(),ee(),K()},[]);const H=async()=>{try{Q(!0);const e=await N.getPlans({isActive:!0});if(e.success&&e.data.plans){const s=e.data.plans.sort((e,s)=>e.sortOrder-s.sortOrder).map(e=>({id:e._id,name:e.name,price:e.price,description:e.description,icon:J(e.name),recommended:e.isPopular,features:Array.isArray(e.features)?e.features.map(e=>"string"==typeof e?e:e.name):[]}));q(s)}}catch(e){W({title:"Error",description:"Failed to load subscription plans. Please try again.",variant:"destructive"})}finally{Q(!1)}},J=e=>{const a=e.toLowerCase();return a.includes("free")?j.jsx(s,{className:"w-8 h-8 text-gray-600"}):a.includes("basic")?j.jsx(t,{className:"w-8 h-8 text-green-600"}):a.includes("standard")?j.jsx(v,{className:"w-8 h-8 text-blue-600"}):a.includes("premium")?j.jsx(y,{className:"w-8 h-8 text-purple-600"}):a.includes("enterprise")?j.jsx(y,{className:"w-8 h-8 text-gold-600"}):j.jsx(t,{className:"w-8 h-8 text-gray-600"})},K=async()=>{try{M(!0);const e=await fetch("https://app.buildhomemartsquares.com/api/vendors/subscription-status",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok){const s=await e.json();s.success&&s.data.hasActiveSubscription&&T(s.data.subscription)}}catch(e){}finally{M(!1)}},X=(e,t)=>{const a={className:"w-6 h-6"};switch(e){case"photography":return"video"===t?j.jsx(_,{...a}):j.jsx(P,{...a});case"marketing":return"search"===t?j.jsx(h,{...a}):j.jsx(S,{...a});case"technology":return j.jsx(v,{...a});case"support":return j.jsx(u,{...a});case"crm":return j.jsx(x,{...a});default:return j.jsx(s,{...a})}},ee=async()=>{try{U(!0);const e=await f.getAddons();z(e.filter(e=>e.isActive))}catch(e){W({title:"Failed to load addons",description:"Using default addon services",variant:"destructive"})}finally{U(!1)}},se=e=>0===e.price?(e.id,"FREE"):`â‚¹${e.price.toLocaleString()}`,te=()=>k?k.price+L.reduce((e,s)=>e+s.price,0):0,ae=async()=>{if(k){D(!0);try{const s={planId:k.id,addons:L.map(e=>e._id),billingCycle:"monthly",totalAmount:te()},{paymentService:t}=await p(async()=>{const{paymentService:e}=await import("./paymentService-Bmek8sEN.js");return{paymentService:e}},__vite__mapDeps([0,1,2,3,4])),a=await t.processSubscriptionPayment(s);if(!a.success)throw new Error(a.message||"Payment failed");W({title:"Payment Successful!",description:`Successfully subscribed to ${k.name}${L.length>0?` with ${L.length} addon(s)`:""}`});try{const{vendorService:e}=await p(async()=>{const{vendorService:e}=await import("./vendorService-DaSf1bV0.js");return{vendorService:e}},__vite__mapDeps([5,1,2,3,4,6]));await e.refreshSubscriptionData()}catch(e){}Z("/vendor/subscription-manager")}catch(s){W({title:"Payment Failed",description:s instanceof Error?s.message:"Failed to process payment",variant:"destructive"})}finally{D(!1)}}};return j.jsxs("div",{className:"space-y-8",children:[j.jsx("div",{className:"flex items-center justify-center mb-8",children:[{step:1,label:"Choose Plan"},{step:2,label:"Add Services"},{step:3,label:"Payment"}].map(({step:e,label:s},t)=>j.jsxs("div",{className:"flex items-center",children:[j.jsxs("div",{className:"flex flex-col items-center",children:[j.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium "+(e<=A?"bg-blue-600 text-white":"bg-muted text-muted-foreground"),children:e}),j.jsx("span",{className:"text-xs mt-2 "+(e<=A?"text-blue-600 font-medium":"text-muted-foreground"),children:s})]}),t<2&&j.jsx("div",{className:"w-16 h-0.5 mx-4 mt-2 "+(e<A?"bg-blue-600":"bg-border")})]},e))}),1===A&&(G?j.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:j.jsx(l,{className:"h-8 w-8 animate-spin text-primary"})}):j.jsxs("div",{className:"space-y-8",children:[j.jsxs("div",{className:"text-center",children:[j.jsx("h1",{className:"text-3xl font-bold text-foreground mb-4",children:O?"Upgrade Your Subscription Plan":"Choose Your Subscription Plan"}),j.jsx("p",{className:"text-muted-foreground text-lg mb-8",children:O?`You currently have the ${O.planName} (â‚¹${O.amount?.toLocaleString()||0}/month). Select a higher-priced plan to upgrade.`:"Select the plan that best fits your business needs"}),j.jsxs("div",{className:"text-center mb-8",children:[j.jsx(n,{variant:"outline",className:"px-4 py-2 text-sm",children:"Monthly Billing - No Long-term Commitments"}),O&&j.jsx("div",{className:"mt-2",children:j.jsxs(n,{variant:"secondary",className:"px-3 py-1 text-xs",children:[V.filter(e=>{if("free"===e.id)return!1;const s=O.amount||0;return e.price>s}).length," Upgrade Options Available"]})})]})]}),j.jsxs("div",{className:"grid md:grid-cols-3 gap-8",children:[V.filter(e=>{if("free"===e.id)return!1;if(O){const s=O.amount||0;return e.price>s}return!0}).map(e=>{const s=O&&O.planName?.toLowerCase().includes(e.name.toLowerCase());return j.jsxs(i,{className:`relative cursor-pointer transition-all duration-200 hover:shadow-lg border-2 ${k?.id===e.id?"border-blue-600 shadow-lg bg-blue-50/50":"border-border hover:border-blue-300"} ${e.recommended?"border-yellow-400":""} ${s?"opacity-50 cursor-not-allowed":""}`,onClick:()=>!s&&(e=>{$(e)})(e),children:[e.recommended&&j.jsx(n,{className:"absolute -top-3 left-1/2 transform -translate-x-1/2 bg-yellow-600 hover:bg-yellow-600",children:"Most Popular"}),s&&j.jsx(n,{className:"absolute -top-3 right-4 bg-green-600 hover:bg-green-600",children:"Current Plan"}),j.jsxs(c,{className:"text-center pb-6",children:[j.jsx("div",{className:"flex justify-center mb-4",children:e.icon}),j.jsx(d,{className:"text-2xl font-bold",children:e.name}),j.jsxs("div",{className:"text-4xl font-bold text-blue-600 mt-4",children:[se(e),e.price>0&&j.jsx("span",{className:"text-lg text-muted-foreground font-normal",children:"/month"})]}),j.jsx("p",{className:"text-muted-foreground mt-2",children:e.description})]}),j.jsx(o,{children:j.jsx("ul",{className:"space-y-4",children:e.features.map((e,s)=>{const t="string"==typeof e?e:e.name||"";return j.jsxs("li",{className:"flex items-center",children:[j.jsx(m,{className:"w-5 h-5 text-green-600 mr-3 flex-shrink-0"}),j.jsx("span",{className:"text-sm text-foreground",children:t})]},s)})})})]},e.id)}),O&&0===V.filter(e=>{if("free"===e.id)return!1;const s=O.amount||0;return e.price>s}).length&&j.jsxs("div",{className:"col-span-full text-center py-12",children:[j.jsx(y,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),j.jsx("h3",{className:"text-2xl font-bold mb-2",children:"You're on the best plan available!"}),j.jsxs("p",{className:"text-gray-600 mb-2",children:["You currently have the ",O.planName," (â‚¹",O.amount?.toLocaleString()||0,"/month)"]}),j.jsx("p",{className:"text-gray-600 mb-6",children:"There are no higher plans available to upgrade to at this time."}),j.jsx(a,{variant:"outline",onClick:()=>Z("/vendor/subscription-manager"),children:"Manage Current Plan"})]})]})]})),2===A&&j.jsxs("div",{className:"space-y-8",children:[j.jsxs("div",{className:"text-center",children:[j.jsx("h1",{className:"text-3xl font-bold text-foreground mb-4",children:"Enhance Your Plan"}),j.jsx("p",{className:"text-muted-foreground text-lg mb-8",children:O?.addons?.length>0?`Add more services to boost your property marketing. You currently have ${O.addons.length} addon(s).`:"Add optional services to boost your property marketing"})]}),I?j.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3,4,5,6].map(e=>j.jsxs(i,{className:"h-48 animate-pulse",children:[j.jsxs(c,{children:[j.jsx("div",{className:"h-4 bg-muted rounded w-3/4"}),j.jsx("div",{className:"h-6 bg-muted rounded w-1/2"})]}),j.jsxs(o,{children:[j.jsx("div",{className:"h-3 bg-muted rounded w-full mb-2"}),j.jsx("div",{className:"h-3 bg-muted rounded w-2/3"})]})]},e))}):j.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:Y.filter(e=>!O?.addons||!O.addons.some(s=>s._id===e._id)).map(e=>{const t=L.some(s=>s._id===e._id),a=O?.addons?.some(s=>s._id===e._id);return j.jsxs(i,{className:`cursor-pointer transition-all duration-200 hover:shadow-md border-2 ${t?"border-blue-600 bg-blue-50/50 shadow-md":"border-border hover:border-blue-300"} ${a?"opacity-50 cursor-not-allowed":""}`,onClick:()=>!a&&(e=>{E(s=>s.find(s=>s._id===e._id)?s.filter(s=>s._id!==e._id):[...s,e])})(e),children:[j.jsxs(c,{className:"pb-3",children:[j.jsxs("div",{className:"flex items-start justify-between",children:[j.jsxs("div",{className:"flex items-center space-x-3",children:[j.jsx("div",{className:"p-2 rounded-lg bg-muted",children:X(e.category,e.icon)}),j.jsxs("div",{children:[j.jsx(d,{className:"text-lg font-semibold",children:e.name}),j.jsx(n,{variant:"outline",className:"mt-1 capitalize text-xs",children:e.category})]})]}),a?j.jsx(n,{className:"bg-green-600 hover:bg-green-600 text-white",children:"Purchased"}):t?j.jsx(m,{className:"w-6 h-6 text-blue-600 flex-shrink-0"}):j.jsx(s,{className:"w-6 h-6 text-muted-foreground flex-shrink-0"})]}),j.jsxs("div",{className:"text-2xl font-bold text-blue-600 mt-2",children:["â‚¹",e.price.toLocaleString(),j.jsxs("span",{className:"text-sm text-muted-foreground font-normal",children:["/",e.billingType.replace("_"," ").replace("per property","per listing")]})]})]}),j.jsx(o,{children:j.jsx("p",{className:"text-muted-foreground text-sm leading-relaxed",children:e.description})})]},e._id)})}),!I&&0===Y.length&&j.jsx("div",{className:"text-center py-12",children:j.jsxs("div",{className:"text-muted-foreground",children:[j.jsx(s,{className:"w-12 h-12 mx-auto mb-4"}),j.jsx("p",{className:"text-lg",children:"No addon services available at the moment."}),j.jsx("p",{className:"text-sm",children:"You can continue without addons or check back later."})]})})]}),3===A&&j.jsxs("div",{className:"space-y-8",children:[j.jsxs("div",{className:"text-center",children:[j.jsx("h1",{className:"text-3xl font-bold text-foreground mb-4",children:"Payment Summary"}),j.jsx("p",{className:"text-muted-foreground text-lg mb-8",children:"Review your selection and complete payment"})]}),j.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[j.jsxs(i,{children:[j.jsx(c,{children:j.jsx(d,{className:"text-xl",children:"Order Summary"})}),j.jsxs(o,{className:"space-y-6",children:[j.jsxs("div",{className:"flex items-center justify-between py-4 border-b",children:[j.jsxs("div",{className:"flex items-center space-x-4",children:[j.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:k?.icon}),j.jsxs("div",{children:[j.jsxs("h4",{className:"font-semibold text-lg",children:[k?.name," Plan"]}),j.jsx("p",{className:"text-sm text-muted-foreground",children:"Billed monthly"})]})]}),j.jsx("div",{className:"text-right",children:j.jsxs("p",{className:"font-bold text-lg",children:["â‚¹",k?.price||0]})})]}),L.length>0&&j.jsxs("div",{className:"space-y-4",children:[j.jsx("h4",{className:"font-semibold text-lg",children:"Add-on Services"}),L.map(e=>j.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-dashed",children:[j.jsxs("div",{className:"flex items-center space-x-3",children:[j.jsx("div",{className:"p-1.5 rounded bg-muted",children:X(e.category,e.icon)}),j.jsxs("div",{children:[j.jsx("p",{className:"font-medium",children:e.name}),j.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:e.billingType.replace("_"," ")})]})]}),j.jsxs("p",{className:"font-semibold",children:["â‚¹",e.price.toLocaleString()]})]},e._id))]}),j.jsxs("div",{className:"flex items-center justify-between py-4 border-t-2 border-border",children:[j.jsx("span",{className:"text-xl font-bold",children:"Total Amount"}),j.jsxs("span",{className:"text-2xl font-bold text-blue-600",children:["â‚¹",te().toLocaleString()]})]})]})]}),j.jsxs("div",{className:"text-center space-y-4",children:[j.jsx(a,{size:"lg",onClick:ae,disabled:B,className:"min-w-[250px] h-12 text-lg",children:B?"Processing...":`Pay â‚¹${te().toLocaleString()}`}),j.jsx("p",{className:"text-sm text-muted-foreground",children:"ðŸ”’ Secure payment powered by Razorpay"})]})]})]}),j.jsxs("div",{className:"flex justify-between pt-8",children:[j.jsxs(a,{variant:"outline",onClick:()=>{C(e=>Math.max(e-1,1))},disabled:1===A,className:"flex items-center space-x-2",size:"lg",children:[j.jsx(r,{className:"w-4 h-4"}),j.jsx("span",{children:"Previous"})]}),A<3&&j.jsxs(a,{onClick:()=>{1!==A||k?C(e=>Math.min(e+1,3)):W({title:"Please select a plan",description:"You must select a subscription plan to continue",variant:"destructive"})},className:"flex items-center space-x-2",size:"lg",children:[j.jsx("span",{children:"Next"}),j.jsx(w,{className:"w-4 h-4"})]})]})]})};export{A as default};

import{z as c,t as o}from"./index-SPvHGBGF.js";class u{baseUrl="https://squares-v2.onrender.com/api";async makeRequest(t,e={}){const r=`${this.baseUrl}${t}`,i={headers:{"Content-Type":"application/json",...e.headers},...e},n=c.getToken();n&&(i.headers={...i.headers,Authorization:`Bearer ${n}`});try{const s=await fetch(r,i);if(!s.ok){if(s.status===401)throw console.error("Authentication failed - redirecting to login"),c.logout(),window.location.href="/login",new Error("Authentication required");if(s.status===403)throw new Error("Admin access required");const a=await s.json().catch(()=>({success:!1,message:`HTTP ${s.status}: ${s.statusText}`}));throw new Error(a.message||"An error occurred")}return await s.json()}catch(s){throw console.error("API request failed:",s),s}}async getSubscriptions(t={}){try{const e=new URLSearchParams;Object.entries(t).forEach(([n,s])=>{s!=null&&s!==""&&e.append(n,String(s))});const r=`/subscriptions${e.toString()?`?${e.toString()}`:""}`;return await this.makeRequest(r)}catch(e){const r=e instanceof Error?e.message:"Failed to fetch subscriptions";throw o({title:"Error",description:r,variant:"destructive"}),e}}async getSubscription(t){try{return await this.makeRequest(`/subscriptions/${t}`)}catch(e){const r=e instanceof Error?e.message:"Failed to fetch subscription";throw o({title:"Error",description:r,variant:"destructive"}),e}}async createSubscription(t){try{const e=await this.makeRequest("/subscriptions",{method:"POST",body:JSON.stringify(t)});return o({title:"Success",description:"Subscription created successfully!"}),e}catch(e){const r=e instanceof Error?e.message:"Failed to create subscription";throw o({title:"Error",description:r,variant:"destructive"}),e}}async updateSubscription(t,e){try{const r=await this.makeRequest(`/subscriptions/${t}`,{method:"PUT",body:JSON.stringify(e)});return o({title:"Success",description:"Subscription updated successfully!"}),r}catch(r){const i=r instanceof Error?r.message:"Failed to update subscription";throw o({title:"Error",description:i,variant:"destructive"}),r}}async cancelSubscription(t){try{const e=await this.makeRequest(`/subscriptions/${t}/cancel`,{method:"PATCH"});return o({title:"Success",description:"Subscription cancelled successfully!"}),e}catch(e){const r=e instanceof Error?e.message:"Failed to cancel subscription";throw o({title:"Error",description:r,variant:"destructive"}),e}}async renewSubscription(t){try{const e=await this.makeRequest(`/subscriptions/${t}/renew`,{method:"PATCH"});return o({title:"Success",description:"Subscription renewed successfully!"}),e}catch(e){const r=e instanceof Error?e.message:"Failed to renew subscription";throw o({title:"Error",description:r,variant:"destructive"}),e}}async getSubscriptionStats(){try{return await this.makeRequest("/subscriptions/stats")}catch(t){const e=t instanceof Error?t.message:"Failed to fetch subscription statistics";throw o({title:"Error",description:e,variant:"destructive"}),t}}formatSubscriptionStatus(t){return{active:{label:"Active",color:"green"},cancelled:{label:"Cancelled",color:"red"},expired:{label:"Expired",color:"orange"},pending:{label:"Pending",color:"blue"}}[t]||{label:t,color:"gray"}}formatAmount(t){return`${t.currency==="INR"?"₹":t.currency==="USD"?"$":"€"}${t.amount.toLocaleString()}`}isSubscriptionExpiringSoon(t,e=7){const r=new Date(t.endDate),i=new Date,n=Math.ceil((r.getTime()-i.getTime())/(1e3*60*60*24));return n<=e&&n>0}getDaysUntilExpiry(t){const e=new Date(t.endDate),r=new Date;return Math.ceil((e.getTime()-r.getTime())/(1e3*60*60*24))}}const d=new u;export{d as s};

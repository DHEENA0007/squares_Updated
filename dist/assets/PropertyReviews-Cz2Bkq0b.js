import{j as e}from"./ui-BHyUY8Z8.js";import{r}from"./router-2SVJvIbS.js";import{W as L,aC as b,Y as U,I as H,a as w,e as C,C as P,b as J,c as V,d as Z,h as q,z as G,B as K,f as c,E as M,Z as Q,J as S,K as D,O as R,Q as E,R as T,q as W,ap as X}from"./index-Bd1eLXM_.js";import{C as Y}from"./calendar-5Rt0tQ5m.js";import"./vendor-Dazix4UH.js";const ae=()=>{const[x,k]=r.useState([]),[$,v]=r.useState(!0),[m,A]=r.useState(""),[a,f]=r.useState(1),[j,O]=r.useState(1),[t,u]=r.useState(null),[_,d]=r.useState(!1),[B,N]=r.useState(!1),[h,g]=r.useState(""),[n,p]=r.useState({}),{toast:i}=L();r.useEffect(()=>{o()},[a,m]);const o=async()=>{try{v(!0);const s=await fetch(`/api/subadmin/properties/pending?page=${a}&search=${m}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(s.ok){const l=await s.json();k(l.data.properties),O(l.data.totalPages)}else i({title:"Error",description:"Failed to fetch properties",variant:"destructive"})}catch{i({title:"Error",description:"Error fetching properties",variant:"destructive"})}finally{v(!1)}};b("property_created",s=>{i({title:"New Property",description:"A new property has been submitted for review"}),o()}),b("property_updated",s=>{o()});const z=async s=>{try{p({...n,[s]:!0}),(await fetch(`/api/subadmin/properties/${s}/approve`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}})).ok?(i({title:"Success",description:"Property approved successfully"}),o()):i({title:"Error",description:"Failed to approve property",variant:"destructive"})}catch{i({title:"Error",description:"Failed to approve property",variant:"destructive"})}finally{p({...n,[s]:!1})}},F=async()=>{if(!t||!h.trim()){i({title:"Error",description:"Please provide a rejection reason",variant:"destructive"});return}try{p({...n,[t._id]:!0}),(await fetch(`/api/subadmin/properties/${t._id}/reject`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({reason:h})})).ok?(i({title:"Success",description:"Property rejected successfully"}),d(!1),g(""),u(null),o()):i({title:"Error",description:"Failed to reject property",variant:"destructive"})}catch{i({title:"Error",description:"Failed to reject property",variant:"destructive"})}finally{p({...n,[t._id]:!1})}},y=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(s),I=s=>s.builtUp?`${s.builtUp} ${s.unit}`:s.plot?`${s.plot} ${s.unit}`:s.carpet?`${s.carpet} ${s.unit}`:"N/A";return $&&x.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Property Reviews"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Review and approve property listings"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"},s))})]}):e.jsxs("div",{className:"p-6 space-y-6 mt-16",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Property Reviews"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Review and approve property listings"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(H,{placeholder:"Search properties by title or city...",value:m,onChange:s=>A(s.target.value),className:"pl-10"})]}),e.jsx("div",{className:"space-y-4",children:x.length===0?e.jsx(w,{children:e.jsxs(C,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(P,{className:"h-12 w-12 text-green-500 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Pending Properties"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"All properties have been reviewed. Great job!"})]})}):x.map(s=>e.jsxs(w,{children:[e.jsx(J,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"text-xl",children:s.title}),e.jsx(Z,{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"h-3 w-3"}),s.address.city,", ",s.address.state]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"h-3 w-3"}),new Date(s.createdAt).toLocaleDateString()]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"h-3 w-3"}),s.owner.email]})]})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:y(s.price)}),e.jsxs(K,{variant:"outline",children:[s.type," â€¢ ",s.listingType]})]})]})}),e.jsx(C,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>{u(s),N(!0)},children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"View Details"]}),e.jsxs(c,{size:"sm",onClick:()=>z(s._id),disabled:n[s._id],className:"bg-green-600 hover:bg-green-700",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Approve"]}),e.jsxs(c,{variant:"destructive",size:"sm",onClick:()=>{u(s),d(!0)},disabled:n[s._id],children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Reject"]})]})})]},s._id))}),j>1&&e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(c,{variant:"outline",disabled:a===1,onClick:()=>f(a-1),children:"Previous"}),e.jsxs("span",{className:"px-3 py-2 text-sm",children:["Page ",a," of ",j]}),e.jsx(c,{variant:"outline",disabled:a===j,onClick:()=>f(a+1),children:"Next"})]}),e.jsx(S,{open:_,onOpenChange:d,children:e.jsxs(D,{children:[e.jsxs(R,{children:[e.jsx(E,{children:"Reject Property"}),e.jsx(T,{children:"Please provide a reason for rejecting this property listing."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:t?.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t?.address.city,", ",t?.address.state]})]}),e.jsx(W,{placeholder:"Enter rejection reason...",value:h,onChange:s=>g(s.target.value),rows:4})]}),e.jsxs(X,{children:[e.jsx(c,{variant:"outline",onClick:()=>{d(!1),g("")},children:"Cancel"}),e.jsx(c,{variant:"destructive",onClick:F,disabled:!h.trim()||n[t?._id||""],children:"Reject Property"})]})]})}),e.jsx(S,{open:B,onOpenChange:N,children:e.jsxs(D,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(R,{children:[e.jsx(E,{children:t?.title}),e.jsx(T,{children:"Property details and information"})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Property Details"}),e.jsxs("ul",{className:"text-sm space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Type:"})," ",t.type]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Listing Type:"})," ",t.listingType]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Price:"})," ",y(t.price)]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Area:"})," ",I(t.area)]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bedrooms:"})," ",t.bedrooms]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bathrooms:"})," ",t.bathrooms]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Location & Contact"}),e.jsxs("ul",{className:"text-sm space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Address:"})," ",t.address.street]}),e.jsxs("li",{children:[e.jsx("strong",{children:"City:"})," ",t.address.city]}),e.jsxs("li",{children:[e.jsx("strong",{children:"State:"})," ",t.address.state]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Zip Code:"})," ",t.address.zipCode]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Owner:"})," ",t.owner.name]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Email:"})," ",t.owner.email]})]})]})]}),t.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Description"}),e.jsx("p",{className:"text-sm",children:t.description})]}),t.images&&t.images.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Images"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:t.images.map((s,l)=>e.jsx("img",{src:s,alt:`Property ${l+1}`,className:"w-full h-32 object-cover rounded"},l))})]})]})]})})]})};export{ae as default};

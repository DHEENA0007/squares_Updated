import{j as e}from"./ui-s1SEoZIF.js";import{h as s,r as i}from"./router-D8v2YSKU.js";import{u as a,f as r,a as t,b as l,c as n,p as d,e as c,o,C as p,a2 as m,I as x,s as f,v as h,w as u,x as v,y as j,z as N,M as b,A as g,r as y,E as w,a1 as V,a7 as A,a8 as k,a9 as C,aa as S,ab as B,ag as P,S as I,L as D,B as F,T as R,t as T}from"./index-l5vY_naC.js";import{C as E}from"./checkbox-Tzvu8-2g.js";import{f as _,h as $}from"./apiUtils-B8LmEMCW.js";import{A as L,b as M,a as Y}from"./alert-CHp9jSHV.js";import{D as O}from"./download-DInf8ekf.js";import{C as U}from"./calendar-Di9eH8o8.js";import"./vendor-BxThA0WO.js";const z=()=>{const{user:z}=a(),[q]=s(),[G,J]=i.useState([]),[W,H]=i.useState(null),[K,Q]=i.useState(!0),[X,Z]=i.useState(null),[ee,se]=i.useState(!1),[ie,ae]=i.useState({status:"all",search:"",businessType:"",experienceMin:"",experienceMax:"",page:1,limit:10}),[re,te]=i.useState(null),le=()=>z?.profile?.firstName&&z?.profile?.lastName?`${z.profile.firstName} ${z.profile.lastName}`:z?.profile?.firstName?z.profile.firstName:z?.email?z.email:"",[ne,de]=i.useState(!1),[ce,oe]=i.useState("approve"),[pe,me]=i.useState(le()),[xe,fe]=i.useState({phoneVerified:!1,emailVerified:!1,identityProofVerified:!1,businessNameVerified:!1,businessTypeVerified:!1,businessDescriptionVerified:!1,experienceVerified:!1,addressVerified:!1,panNumberVerified:!1,gstNumberVerified:!1,licenseNumberVerified:!1,businessRegistrationVerified:!1}),[he,ue]=i.useState(""),[ve,je]=i.useState(""),[Ne,be]=i.useState(!1),[ge,ye]=i.useState(null),we=async()=>{try{const e=new URLSearchParams({page:ie.page.toString(),limit:ie.limit.toString(),status:ie.status,search:ie.search,businessType:ie.businessType,experienceMin:ie.experienceMin,experienceMax:ie.experienceMax,sortBy:"submittedAt",sortOrder:"desc"}),s=await _(`/admin/vendor-approvals?${e}`),i=await $(s);J(i.data.vendors||[])}catch(e){T({title:"Error",description:e instanceof Error?e.message:"Failed to fetch vendor applications",variant:"destructive"}),J([])}},Ve=async()=>{try{const e=await _("/admin/vendor-approval-stats"),s=await $(e);H(s.data||null)}catch(e){T({title:"Error",description:e instanceof Error?e.message:"Failed to fetch statistics",variant:"destructive"}),H(null)}};i.useEffect(()=>{const e=le();e&&me(e)},[z]),i.useEffect(()=>{const e=q.get("vendorId");if(e&&G.length>0){const s=G.find(s=>s._id===e);s&&(Z(s),se(!0))}},[q,G]),i.useEffect(()=>{(async()=>{Q(!0),await Promise.all([we(),Ve()]),Q(!1)})()},[ie.status,ie.page,ie.search,ie.businessType,ie.experienceMin,ie.experienceMax]),i.useEffect(()=>{if(X?.approval.phoneVerifiedAt){const e=()=>{const e=new Date(X.approval.phoneVerifiedAt).getTime(),s=6e5-((new Date).getTime()-e);ye(s>0?s:0)};e();const s=setInterval(e,1e3);return()=>clearInterval(s)}ye(null)},[X]);const Ae=()=>{fe({phoneVerified:!1,emailVerified:!1,identityProofVerified:!1,businessNameVerified:!1,businessTypeVerified:!1,businessDescriptionVerified:!1,experienceVerified:!1,addressVerified:!1,panNumberVerified:!1,gstNumberVerified:!1,licenseNumberVerified:!1,businessRegistrationVerified:!1}),ue(""),je(""),me(le())},ke=(e,s)=>{Z(e),oe(s),Ae(),e.approval.verificationChecklist&&fe(e.approval.verificationChecklist),me(e.approval.approverName||le()),de(!0)},Ce=async()=>{if(!X||!pe.trim())return void T({title:"Error",description:"Approver name is required",variant:"destructive"});if(!xe.phoneVerified)return void T({title:"Error",description:"Phone verification must be completed first",variant:"destructive"});if(!he.trim())return void T({title:"Error",description:"Approval comments are required",variant:"destructive"});Object.values(xe).every(e=>!0===e)||T({title:"Warning",description:"Not all verification steps are completed. Are you sure you want to proceed?",variant:"destructive"}),te("approve");try{const e={approvalNotes:he,approverName:pe,verificationChecklist:xe,verificationLevel:"basic"},s=await _(`/admin/vendor-approvals/${X._id}/approve`,{method:"POST",body:JSON.stringify(e)});await $(s),T({title:"Success",description:"Vendor application approved successfully",variant:"default"}),de(!1),await we(),await Ve()}catch(e){T({title:"Error",description:e instanceof Error?e.message:"Failed to approve vendor application",variant:"destructive"})}finally{te(null)}},Se=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Be=e=>`${Math.floor(e/6e4)}:${Math.floor(e%6e4/1e3).toString().padStart(2,"0")}`,Pe=s=>{const i={pending:{variant:"secondary",icon:o,label:"Pending"},under_review:{variant:"default",icon:w,label:"Under Review"},approved:{variant:"default",icon:p,label:"Approved"},rejected:{variant:"destructive",icon:V,label:"Rejected"}},a=i[s]||i.pending,r=a.icon;return e.jsxs(F,{variant:a.variant,children:[e.jsx(r,{className:"w-3 h-3 mr-1"}),a.label]})},Ie=()=>{if(!X)return!1;if(!xe.phoneVerified)return!1;if(!X.approval.phoneVerifiedAt)return!1;const e=new Date(X.approval.phoneVerifiedAt).getTime();return(new Date).getTime()-e>=6e5};return K?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:justify-between md:items-start md:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Vendor Applications"}),e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"Review and manage vendor registration applications"})]}),e.jsxs(r,{onClick:async()=>{try{const e=await _("/admin/vendor-approvals/export"),s=await $(e),i=[["Application ID","Company Name","Applicant Name","Email","Phone","Business Type","Submitted Date","Status","Reviewed Date","Reviewed By","Approver Name","Phone Verified","Email Verified","Identity Proof Verified","Business Name Verified","Business Type Verified","Business Description Verified","Experience Verified","Address Verified","PAN Number Verified","GST Number Verified","License Number Verified","Business Registration Verified","Approval/Rejection Comments"].join(","),...s.data.map(e=>{const s=e.approval?.verificationChecklist||{},i=e.approval?.submittedAt?new Date(e.approval.submittedAt).toLocaleDateString():"N/A",a=e.approval?.reviewedAt?new Date(e.approval.reviewedAt).toLocaleDateString():"N/A",r=e.approval?.reviewedBy?`${e.approval.reviewedBy.profile?.firstName||""} ${e.approval.reviewedBy.profile?.lastName||""}`.trim():"N/A";return[e._id||"N/A",`"${e.businessInfo?.companyName||"N/A"}"`,`"${e.user?.profile?.firstName||""} ${e.user?.profile?.lastName||""}"`.trim()||"N/A",e.user?.email||"N/A",e.user?.profile?.phone||"N/A",e.businessInfo?.businessType||"N/A",i,e.approval?.status||"N/A",a,r,e.approval?.approverName||"N/A",s.phoneVerified?"Yes":"No",s.emailVerified?"Yes":"No",s.identityProofVerified?"Yes":"No",s.businessNameVerified?"Yes":"No",s.businessTypeVerified?"Yes":"No",s.businessDescriptionVerified?"Yes":"No",s.experienceVerified?"Yes":"No",s.addressVerified?"Yes":"No",s.panNumberVerified?"Yes":"No",s.gstNumberVerified?"Yes":"No",s.licenseNumberVerified?"Yes":"No",s.businessRegistrationVerified?"Yes":"No",`"${e.approval?.approvalNotes||e.approval?.rejectionReason||"N/A"}"`].join(",")})].join("\n"),a=new Blob([i],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),t=URL.createObjectURL(a);r.setAttribute("href",t),r.setAttribute("download",`vendor_approval_report_${(new Date).toISOString().split("T")[0]}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),T({title:"Success",description:"Approval report exported successfully",variant:"default"})}catch(e){T({title:"Error",description:"Failed to export approval report",variant:"destructive"})}},variant:"outline",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Export Report"]})]}),W&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(t,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Total Applications"}),e.jsx(d,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold",children:W.overview.totalApplications})})]}),e.jsxs(t,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Pending Review"}),e.jsx(o,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold",children:W.overview.pendingApplications})})]}),e.jsxs(t,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Approved"}),e.jsx(p,{className:"h-4 w-4 text-green-600"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold",children:W.overview.approvedApplications})})]}),e.jsxs(t,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Approval Rate"}),e.jsx(p,{className:"h-4 w-4 text-green-600"})]}),e.jsx(c,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[W.overview.approvalRate.toFixed(1),"%"]})})]})]}),e.jsx(t,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Search by name or email...",value:ie.search,onChange:e=>ae({...ie,search:e.target.value})})]}),e.jsxs(f,{value:ie.status,onValueChange:e=>ae({...ie,status:e}),children:[e.jsx(h,{children:e.jsx(u,{placeholder:"Filter by status"})}),e.jsxs(v,{children:[e.jsx(j,{value:"all",children:"All Statuses"}),e.jsx(j,{value:"pending",children:"Pending"}),e.jsx(j,{value:"under_review",children:"Under Review"}),e.jsx(j,{value:"approved",children:"Approved"}),e.jsx(j,{value:"rejected",children:"Rejected"})]})]}),e.jsxs(f,{value:ie.businessType||"all",onValueChange:e=>ae({...ie,businessType:"all"===e?"":e}),children:[e.jsx(h,{children:e.jsx(u,{placeholder:"Filter by business type"})}),e.jsxs(v,{children:[e.jsx(j,{value:"all",children:"All Types"}),e.jsx(j,{value:"real_estate_agent",children:"Real Estate Agent"}),e.jsx(j,{value:"property_management",children:"Property Management"}),e.jsx(j,{value:"developer",children:"Developer"}),e.jsx(j,{value:"individual",children:"Individual"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{type:"number",placeholder:"Min experience",value:ie.experienceMin,onChange:e=>ae({...ie,experienceMin:e.target.value})}),e.jsx(x,{type:"number",placeholder:"Max experience",value:ie.experienceMax,onChange:e=>ae({...ie,experienceMax:e.target.value})})]})]})})}),e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(n,{children:"Applications"})}),e.jsx(c,{children:e.jsx("div",{className:"space-y-4",children:0===G.length?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No applications found"}):G.map(s=>e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between p-4 border rounded-lg hover:bg-accent/50 transition-colors gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.businessInfo.companyName}),Pe(s.approval.status)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"w-3 h-3"}),s.user?.profile?.firstName," ",s.user?.profile?.lastName]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3"}),s.user?.email||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{className:"w-3 h-3"}),s.user?.profile?.phone||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"w-3 h-3"}),s.businessInfo.businessType]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-3 h-3"}),Se(s.approval.submittedAt)]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>{Z(s),se(!0)},children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Review"]}),"pending"===s.approval.status||"under_review"===s.approval.status?e.jsxs(e.Fragment,{children:[e.jsxs(r,{variant:"default",size:"sm",onClick:()=>ke(s,"approve"),children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"under_review"===s.approval.status?"Update":"Approve"]}),e.jsxs(r,{variant:"destructive",size:"sm",onClick:()=>ke(s,"reject"),children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Reject"]})]}):null]})]},s._id))})})]}),e.jsx(A,{open:ee,onOpenChange:se,children:e.jsxs(k,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(C,{children:[e.jsx(S,{children:"Application Review"}),e.jsx(B,{children:"Detailed information about the vendor application"})]}),X&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Status"}),e.jsx("div",{className:"mt-2",children:Pe(X.approval.status)})]})}),e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(n,{className:"text-base",children:"Contact Person"})}),e.jsxs(c,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Name:"}),e.jsxs("span",{children:[X.user.profile.firstName," ",X.user.profile.lastName]})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Email:"}),e.jsx("span",{className:"break-all",children:X.user.email})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Phone:"}),e.jsx("span",{children:X.user.profile.phone||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Registered On:"}),e.jsx("span",{children:Se(X.user.createdAt)})]})]})]}),e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(n,{className:"text-base",children:"Business Information"})}),e.jsxs(c,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Company Name:"}),e.jsx("span",{children:X.businessInfo.companyName})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Business Type:"}),e.jsx("span",{children:X.businessInfo.businessType})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Experience:"}),e.jsx("span",{children:X.professionalInfo?.experience?`${X.professionalInfo.experience} years`:"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1 md:col-span-2",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Business Description:"}),e.jsx("span",{className:"break-words",children:X.professionalInfo?.description||"N/A"})]})]})]}),e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(n,{className:"text-base",children:"Address Information"})}),e.jsxs(c,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Address:"}),e.jsx("span",{className:"break-words",children:X.professionalInfo?.officeAddress?.area||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"City:"}),e.jsx("span",{children:X.professionalInfo?.officeAddress?.city||X.professionalInfo?.serviceAreas?.[0]?.city||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"State:"}),e.jsx("span",{children:X.professionalInfo?.officeAddress?.state||X.professionalInfo?.serviceAreas?.[0]?.state||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Pincode:"}),e.jsx("span",{children:X.professionalInfo?.officeAddress?.pincode||X.professionalInfo?.serviceAreas?.[0]?.pincode||"N/A"})]})]})]}),e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(n,{className:"text-base",children:"Legal Documents"})}),e.jsxs(c,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"PAN Number:"}),e.jsx("span",{children:X.businessInfo.panNumber||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"GST Number:"}),e.jsx("span",{children:X.businessInfo.gstNumber||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"License Number:"}),e.jsx("span",{children:X.businessInfo.licenseNumber||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Website:"}),e.jsx("span",{children:X.businessInfo.website||"N/A"})]})]})]}),X.approval.submittedDocuments&&X.approval.submittedDocuments.length>0&&e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(n,{className:"text-base",children:"Submitted Documents"})}),e.jsx(c,{children:e.jsx("div",{className:"space-y-2",children:X.approval.submittedDocuments.map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.documentName}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.documentType})]})]}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>window.open(s.documentUrl,"_blank"),children:"View"})]},i))})})]})]}),e.jsx(P,{children:e.jsx(r,{variant:"outline",onClick:()=>se(!1),children:"Close"})})]})}),e.jsx(A,{open:ne,onOpenChange:de,children:e.jsxs(k,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(C,{children:[e.jsx(S,{children:"approve"===ce?"under_review"===X?.approval.status?"Complete Verification":"Approve Application":"Reject Application"}),e.jsx(B,{children:"approve"===ce?"Complete the verification checklist and provide approval details":"Provide a reason for rejecting this application"})]}),X&&e.jsxs("div",{className:"space-y-6",children:[X.approval.lockedBy&&String(X.approval.lockedBy._id)!==String(z?.id)&&"superadmin"!==z?.role&&e.jsxs(L,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(I,{className:"h-4 w-4 text-yellow-600"}),e.jsx(M,{children:"Application Locked"}),e.jsxs(Y,{children:["This vendor application is currently being handled by"," ",e.jsx("strong",{children:X.approval.lockedBy.profile?.firstName?`${X.approval.lockedBy.profile.firstName} ${X.approval.lockedBy.profile.lastName||""}`:X.approval.lockedBy.email}),". You cannot approve or reject this application."]})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:X.businessInfo.companyName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[X.user.profile.firstName," ",X.user.profile.lastName," â€¢ ",X.user.email]}),X.approval.lockedBy&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("p",{className:"text-xs font-medium text-primary",children:"Currently Handling:"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[X.approval.lockedBy.profile?.firstName?`${X.approval.lockedBy.profile.firstName} ${X.approval.lockedBy.profile.lastName||""}`:X.approval.lockedBy.email,X.approval.lockedBy._id===z?.id&&" (You)"]}),X.approval.lockedAt&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Since: ",new Date(X.approval.lockedAt).toLocaleString()]})]}),X.approval.phoneVerifiedBy&&X.approval.phoneVerifiedBy._id!==X.approval.lockedBy?._id&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("p",{className:"text-xs font-medium text-blue-600",children:"Phone Verified By:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:X.approval.phoneVerifiedBy.profile?.firstName?`${X.approval.phoneVerifiedBy.profile.firstName} ${X.approval.phoneVerifiedBy.profile.lastName||""}`:X.approval.phoneVerifiedBy.email})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(D,{htmlFor:"approverName",children:["Approver Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(x,{id:"approverName",value:pe,onChange:e=>me(e.target.value),placeholder:"Enter your full name",disabled:xe.phoneVerified}),X.approval.lockedBy&&X.approval.lockedBy._id===z?.id&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"You are currently handling this application. Your name is pre-filled from the initial action."})]}),"approve"===ce&&e.jsxs(e.Fragment,{children:[e.jsxs(t,{className:"border-2 border-primary/20",children:[e.jsx(l,{children:e.jsxs(n,{className:"text-base flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-primary"}),"Step 1: Phone Verification (Required)"]})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Phone: ",X.user.profile.phone||"N/A"]})]}),xe.phoneVerified?e.jsxs(F,{variant:"default",className:"bg-green-600",children:[e.jsx(p,{className:"w-4 h-4 mr-1"}),"Verified"]}):e.jsx(r,{onClick:async()=>{if(X&&pe.trim()){be(!0);try{const e=await _(`/admin/vendor-approvals/${X._id}/verify-phone`,{method:"POST",body:JSON.stringify({approverName:pe})});await $(e);fe(e=>({...e,phoneVerified:!0})),Z(e=>e?{...e,approval:{...e.approval,status:"under_review",phoneVerifiedAt:(new Date).toISOString(),verificationChecklist:{...e.approval.verificationChecklist,phoneVerified:!0}}}:e),await we(),T({title:"Phone Verified",description:"Phone verification successful. Status changed to under review.",variant:"default"})}catch(e){T({title:"Error",description:e instanceof Error?e.message:"Failed to verify phone",variant:"destructive"})}finally{be(!1)}}else T({title:"Error",description:"Please enter approver name first",variant:"destructive"})},disabled:Ne||!pe.trim(),size:"sm",children:Ne?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Verifying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"Verify Phone"]})})]}),X.approval.phoneVerifiedAt&&null!==ge&&e.jsxs(L,{children:[e.jsx(o,{className:"h-4 w-4"}),e.jsx(M,{children:"Verification Freeze Period"}),e.jsx(Y,{children:ge>0?e.jsxs(e.Fragment,{children:["Time remaining until other verifications unlock: "," ",e.jsx("strong",{className:"text-primary",children:Be(ge)})]}):e.jsx("span",{className:"text-green-600 font-semibold",children:"Freeze period completed! You can now proceed with other verifications."})})]})]})]}),e.jsxs(t,{children:[e.jsx(l,{children:e.jsxs(n,{className:"text-base",children:["Step 2: Verification Checklist ",!Ie()&&"(Locked - Complete phone verification first)"]})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Personal Information"}),e.jsxs("div",{className:"space-y-2 pl-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{id:"emailVerified",checked:xe.emailVerified,onCheckedChange:e=>fe({...xe,emailVerified:e}),disabled:!Ie()}),e.jsx("label",{htmlFor:"emailVerified",className:"text-sm cursor-pointer",children:"Email verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{id:"identityProofVerified",checked:xe.identityProofVerified,onCheckedChange:e=>fe({...xe,identityProofVerified:e}),disabled:!Ie()}),e.jsx("label",{htmlFor:"identityProofVerified",className:"text-sm cursor-pointer",children:"Identity documents verified (Aadhar/Passport/DL)"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Business Information"}),e.jsxs("div",{className:"space-y-2 pl-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{id:"businessNameVerified",checked:xe.businessNameVerified,onCheckedChange:e=>fe({...xe,businessNameVerified:e}),disabled:!Ie()}),e.jsx("label",{htmlFor:"businessNameVerified",className:"text-sm cursor-pointer",children:"Business name verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{id:"businessTypeVerified",checked:xe.businessTypeVerified,onCheckedChange:e=>fe({...xe,businessTypeVerified:e}),disabled:!Ie()}),e.jsx("label",{htmlFor:"businessTypeVerified",className:"text-sm cursor-pointer",children:"Business type verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{id:"businessDescriptionVerified",checked:xe.businessDescriptionVerified,onCheckedChange:e=>fe({...xe,businessDescriptionVerified:e}),disabled:!Ie()}),e.jsx("label",{htmlFor:"businessDescriptionVerified",className:"text-sm cursor-pointer",children:"Business description verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{id:"experienceVerified",checked:xe.experienceVerified,onCheckedChange:e=>fe({...xe,experienceVerified:e}),disabled:!Ie()}),e.jsx("label",{htmlFor:"experienceVerified",className:"text-sm cursor-pointer",children:"Professional experience verified"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Address Information"}),e.jsx("div",{className:"space-y-2 pl-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{id:"addressVerified",checked:xe.addressVerified,onCheckedChange:e=>fe({...xe,addressVerified:e}),disabled:!Ie()}),e.jsx("label",{htmlFor:"addressVerified",className:"text-sm cursor-pointer",children:"Address verified and matches records"})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Legal Documents"}),e.jsxs("div",{className:"space-y-2 pl-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{id:"panNumberVerified",checked:xe.panNumberVerified,onCheckedChange:e=>fe({...xe,panNumberVerified:e}),disabled:!Ie()}),e.jsx("label",{htmlFor:"panNumberVerified",className:"text-sm cursor-pointer",children:"PAN card verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{id:"gstNumberVerified",checked:xe.gstNumberVerified,onCheckedChange:e=>fe({...xe,gstNumberVerified:e}),disabled:!Ie()}),e.jsx("label",{htmlFor:"gstNumberVerified",className:"text-sm cursor-pointer",children:"GST number verified (if applicable)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{id:"licenseNumberVerified",checked:xe.licenseNumberVerified,onCheckedChange:e=>fe({...xe,licenseNumberVerified:e}),disabled:!Ie()}),e.jsx("label",{htmlFor:"licenseNumberVerified",className:"text-sm cursor-pointer",children:"License/registration verified"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Documents"}),e.jsx("div",{className:"space-y-2 pl-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{id:"businessRegistrationVerified",checked:xe.businessRegistrationVerified,onCheckedChange:e=>fe({...xe,businessRegistrationVerified:e}),disabled:!Ie()}),e.jsx("label",{htmlFor:"businessRegistrationVerified",className:"text-sm cursor-pointer",children:"All required documents submitted and verified"})]})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(D,{htmlFor:"approvalComments",children:["Approval Comments ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(R,{id:"approvalComments",value:he,onChange:e=>ue(e.target.value),placeholder:"Add any additional notes about this approval...",rows:4})]})]}),"reject"===ce&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(D,{htmlFor:"rejectionComments",children:["Rejection Reason ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(R,{id:"rejectionComments",value:ve,onChange:e=>je(e.target.value),placeholder:"Provide a detailed reason for rejection...",rows:6})]})]}),e.jsxs(P,{children:[e.jsx(r,{variant:"outline",onClick:()=>{de(!1),Ae()},disabled:null!==re,children:"Cancel"}),"approve"===ce?e.jsx(r,{onClick:async()=>{X&&("under_review"===X.approval.status&&null!==ge&&ge>0?T({title:"Freeze Period Active",description:`Please wait ${Be(ge)} before completing the verification.`,variant:"destructive"}):await Ce())},disabled:"approve"===re||!xe.phoneVerified||null!==ge&&ge>0||X?.approval.lockedBy&&String(X.approval.lockedBy._id)!==String(z?.id)&&"superadmin"!==z?.role,children:"approve"===re?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):null!==ge&&ge>0?e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"Wait ",Be(ge)]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"under_review"===X?.approval.status?"Complete & Approve":"Approve"]})}):e.jsx(r,{variant:"destructive",onClick:async()=>{if(X)if(ve.trim()){te("reject");try{const e=await _(`/admin/vendor-approvals/${X._id}/reject`,{method:"POST",body:JSON.stringify({rejectionReason:ve})});await $(e),T({title:"Success",description:"Vendor application rejected",variant:"default"}),de(!1),await we(),await Ve()}catch(e){T({title:"Error",description:e instanceof Error?e.message:"Failed to reject vendor application",variant:"destructive"})}finally{te(null)}}else T({title:"Error",description:"Rejection reason is required",variant:"destructive"})},disabled:"reject"===re||X?.approval.lockedBy&&String(X.approval.lockedBy._id)!==String(z?.id)&&"superadmin"!==z?.role,children:"reject"===re?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Reject Application"]})})]})]})})]})};export{z as default};

import{j as e}from"./ui-CEFKCYQo.js";import{r as s,d as a,h as l}from"./router-Bi51YGN-.js";import{W as t,aw as r,a as i,e as c,Q as n,I as d,S as o,r as m,s as x,v as h,w as p,f as u,G as j,J as f,V as v,B as N,h as g,au as y,av as b,Y as w}from"./index-Ds-LUfCl.js";import{S}from"./slider-Bl57bMOI.js";import{f as P}from"./favoriteService-BQ5QkAl-.js";import{S as C}from"./square-DcJMVZes.js";import"./vendor-eVk5PToZ.js";const F=()=>{const[F,k]=s.useState([]),[T,A]=s.useState([]),$=a(),{toast:_}=t(),[E]=l(),[V,L]=s.useState([]),[q,M]=s.useState(!0),[z,R]=s.useState(""),[O,B]=s.useState("all"),[U,G]=s.useState("all"),[I,J]=s.useState([0,2e7]),[Q,W]=s.useState([0,1e4]),[Y,D]=s.useState([]),[H,K]=s.useState({}),[X,Z]=s.useState(1),[ee,se]=s.useState(1),[ae,le]=s.useState(new Set),te=s.useMemo(()=>Array.from(new Set(T.map(e=>e.filterType))),[T]);s.useEffect(()=>{(async()=>{try{const[e,s]=await Promise.all([w.getAllPropertyTypes(!1),w.getAllFilterConfigurations(!1)]);k(e),A(s)}catch(e){}})()},[]),s.useEffect(()=>{const e=E.get("q"),s=E.get("listingType"),a=E.get("propertyType");e&&R(e),s&&"all"!==s&&B(s),a&&"all"!==a&&G(a),Z(1)},[E]),s.useEffect(()=>{re()},[z,O,U,I,Q,Y,H,X]);const re=async()=>{M(!0);try{const e={page:X,limit:12};z.trim()&&(e.search=z),"all"!==O&&(e.listingType=O),"all"!==U&&(e.propertyType=U),Object.entries(H).forEach(([s,a])=>{a&&"any"!==a&&(e[s]=a)}),I[0]>0&&(e.minPrice=I[0]),I[1]<2e7&&(e.maxPrice=I[1]),Q[0]>0&&(e.minArea=Q[0]),Q[1]<1e4&&(e.maxArea=Q[1]),Y.length>0&&(e.amenities=Y);const s=await r.getProperties(e);s.success&&(L(s.data.properties),se(s.data.pagination.totalPages))}catch(e){_({title:"Error",description:"Failed to load properties",variant:"destructive"})}finally{M(!1)}};s.useEffect(()=>{ie()},[]);const ie=async()=>{try{const e=await P.getFavorites();if(e.success){const s=new Set(e.data.favorites.map(e=>e.property?._id).filter(Boolean));le(s)}}catch(e){}},ce=()=>{R(""),B("all"),G("all"),J([0,2e7]),W([0,1e4]),D([]),K({}),Z(1)},ne=e=>e>=1e7?`₹${(e/1e7).toFixed(2)} Cr`:e>=1e5?`₹${(e/1e5).toFixed(2)} L`:`₹${e.toLocaleString()}`;return e.jsxs("div",{className:"min-h-screen",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary/10 to-primary/5 border-b",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Search Properties"}),e.jsx("p",{className:"text-muted-foreground",children:"Find your dream property from our verified listings"})]})}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("aside",{className:"lg:w-80 flex-shrink-0",children:e.jsx(i,{className:"sticky top-20 max-h-[calc(100vh-6rem)] overflow-y-auto",children:e.jsxs(c,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Filters"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(n,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(d,{placeholder:"Location, property name...",value:z,onChange:e=>R(e.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Listing Type"}),e.jsxs(o,{value:O,onValueChange:B,children:[e.jsx(m,{children:e.jsx(x,{placeholder:"Type"})}),e.jsxs(h,{children:[e.jsx(p,{value:"all",children:"All Types"}),e.jsx(p,{value:"sale",children:"For Sale"}),e.jsx(p,{value:"rent",children:"For Rent"}),e.jsx(p,{value:"lease",children:"For Lease"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Property Type"}),e.jsxs(o,{value:U,onValueChange:e=>{G(e),K({}),D([])},children:[e.jsx(m,{children:e.jsx(x,{placeholder:"Property"})}),e.jsxs(h,{children:[e.jsx(p,{value:"all",children:"All Properties"}),F.map(s=>e.jsx(p,{value:s.value,children:s.name},s.value))]})]})]}),te.map(s=>{const a=(e=>T.filter(s=>s.filterType===e&&s.isActive).sort((e,s)=>e.displayOrder-s.displayOrder))(s);return 0===a.length?null:(a.some(e=>void 0!==e.minValue||void 0!==e.maxValue),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block capitalize",children:s.replace(/_/g," ")}),e.jsxs(o,{value:H[s]||"any",onValueChange:e=>{K(a=>({...a,[s]:e}))},children:[e.jsx(m,{children:e.jsx(x,{placeholder:`Select ${s.replace(/_/g," ")}`})}),e.jsxs(h,{children:[e.jsx(p,{value:"any",children:"Any"}),a.map(s=>e.jsx(p,{value:s.value,children:s.displayLabel},s._id))]})]})]},s))}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Price Range"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{value:I,onValueChange:J,min:0,max:2e7,step:1e5,className:"w-full"}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Min Price"}),e.jsx("span",{className:"font-semibold text-primary",children:ne(I[0])})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Max Price"}),e.jsx("span",{className:"font-semibold text-primary",children:ne(I[1])})]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Area (sq ft)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{value:Q,onValueChange:W,min:0,max:1e4,step:100,className:"w-full"}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Min"}),e.jsxs("span",{className:"font-semibold text-primary",children:[Q[0]," sqft"]})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Max"}),e.jsxs("span",{className:"font-semibold text-primary",children:[Q[1]," sqft"]})]})]})]})]}),e.jsx(u,{variant:"outline",onClick:ce,className:"w-full",children:"Reset Filters"})]})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Available Properties"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:q?"Loading...":`${V.length} properties found`})]}),q?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(j,{className:"h-8 w-8 animate-spin text-primary"})}):0===V.length?e.jsx(i,{children:e.jsxs(c,{className:"p-12 text-center",children:[e.jsx(f,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No properties found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Try adjusting your filters or search criteria"}),e.jsx(u,{onClick:ce,children:"Clear Filters"})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:V.map(s=>e.jsxs(i,{className:"overflow-hidden hover:shadow-lg transition-shadow cursor-pointer",children:[e.jsxs("div",{className:"relative h-48 bg-muted",onClick:()=>$(`/property/${s._id}`),children:[s.images&&s.images.length>0?e.jsx("img",{src:"string"==typeof s.images[0]?s.images[0]:s.images[0]?.url,alt:s.title,className:"w-full h-full object-cover",onError:e=>{e.target.src="/placeholder-property.jpg"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(f,{className:"h-12 w-12 text-muted-foreground"})}),e.jsx(u,{size:"icon",variant:"secondary",className:"absolute top-2 right-2",onClick:e=>{e.stopPropagation(),(async e=>{try{ae.has(e)?(await P.removeFromFavorites(e),le(s=>{const a=new Set(s);return a.delete(e),a}),_({title:"Removed from favorites",description:"Property removed from your favorites"})):(await P.addToFavorites(e),le(s=>new Set(s).add(e)),_({title:"Added to favorites",description:"Property added to your favorites"}))}catch(s){_({title:"Error",description:"Failed to update favorite",variant:"destructive"})}})(s._id)},children:e.jsx(v,{className:"h-4 w-4 "+(ae.has(s._id)?"fill-red-500 text-red-500":"")})}),e.jsx(N,{className:"absolute top-2 left-2 capitalize",children:s.listingType})]}),e.jsxs(c,{className:"p-4",onClick:()=>$(`/customer/property/${s._id}`),children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg line-clamp-1",children:s.title}),e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground mt-1",children:[e.jsx(g,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"line-clamp-1",children:s.address.district?`${s.address.city}, ${s.address.district}, ${s.address.state}`:`${s.address.city}, ${s.address.state}`})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:ne(s.price)}),"rent"===s.listingType&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"/month"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[s.bedrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx("span",{children:s.bedrooms})]}),s.bathrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx("span",{children:s.bathrooms})]}),s.area?.builtUp&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.area.builtUp," sqft"]})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t",children:e.jsx(N,{variant:"outline",className:"capitalize",children:s.type})})]})]},s._id))}),ee>1&&e.jsxs("div",{className:"flex justify-center gap-2 mt-8",children:[e.jsx(u,{variant:"outline",disabled:1===X,onClick:()=>Z(e=>e-1),children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:Array.from({length:ee},(e,s)=>s+1).map(s=>e.jsx(u,{variant:X===s?"default":"outline",onClick:()=>Z(s),className:"w-10",children:s},s))}),e.jsx(u,{variant:"outline",disabled:X===ee,onClick:()=>Z(e=>e+1),children:"Next"})]})]})]})]})})]})};export{F as default};

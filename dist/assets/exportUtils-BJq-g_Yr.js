import{u as e,w as t,a as o}from"./xlsx-BjkOj9O8.js";import{t as r}from"./index-rSy6wPVC.js";class a{static generateWorkbook(t,o){try{const r=e.book_new();if(t.metadata){const o=Object.entries(t.metadata).map(([e,t])=>({Property:e,Value:t})),a=e.json_to_sheet(o);e.book_append_sheet(r,a,"Report Info")}return o.forEach(t=>{try{const o=e.json_to_sheet(t.data);if(t.columns&&t.columns.length>0&&(o["!cols"]=t.columns),!t.columns){const t=e.decode_range(o["!ref"]||"A1:A1"),r=[];for(let a=t.s.c;a<=t.e.c;a++){let n=10;for(let r=t.s.r;r<=t.e.r;r++){const t=o[e.encode_cell({r:r,c:a})];if(t&&t.v){const e=String(t.v);n=Math.max(n,Math.min(e.length+2,50))}}r.push({wch:n})}o["!cols"]=r}e.book_append_sheet(r,o,t.name)}catch(o){}}),r}catch(r){throw new Error("Failed to generate Excel workbook")}}static writeWorkbookToBuffer(e){try{return t(e,{bookType:"xlsx",type:"array"})}catch(o){throw new Error("Failed to write workbook to buffer")}}static generateExcelReport(t,r){try{const a=e.book_new();if(t.metadata){const o=Object.entries(t.metadata).map(([e,t])=>({Property:e,Value:t})),r=e.json_to_sheet(o);e.book_append_sheet(a,r,"Report Info")}r.forEach(t=>{try{const o=e.json_to_sheet(t.data);if(t.columns&&t.columns.length>0&&(o["!cols"]=t.columns),!t.columns){const t=e.decode_range(o["!ref"]||"A1:A1"),r=[];for(let a=t.s.c;a<=t.e.c;a++){let n=10;for(let r=t.s.r;r<=t.e.r;r++){const t=o[e.encode_cell({r:r,c:a})];if(t&&t.v){const e=String(t.v);n=Math.max(n,Math.min(e.length+2,50))}}r.push({wch:n})}o["!cols"]=r}e.book_append_sheet(a,o,t.name)}catch(o){}});const n=(new Date).toISOString().split("T")[0],s=`${t.filename}_${n}.xlsx`;o(a,s)}catch(a){throw new Error("Failed to generate Excel report")}}static generatePDFReport(e,t,o){throw new Error("PDF generation not implemented. Use specific service methods for PDF exports.")}static downloadCSV(t,o){try{if(!t||0===t.length)throw new Error("No data to export");const r=e.json_to_sheet(t),a=e.sheet_to_csv(r),n=new Blob([a],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");if(void 0!==s.download){const e=URL.createObjectURL(n);s.setAttribute("href",e),s.setAttribute("download",`${o}.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(e)}}catch(r){throw new Error("Failed to generate CSV file")}}static downloadJSON(e,t){try{const o=JSON.stringify(e,null,2),r=new Blob([o],{type:"application/json"}),a=document.createElement("a");if(void 0!==a.download){const e=URL.createObjectURL(r);a.setAttribute("href",e),a.setAttribute("download",`${t}.json`),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(e)}}catch(o){throw new Error("Failed to generate JSON file")}}static formatDate(e){if(!e)return"N/A";try{const t=new Date(e);return isNaN(t.getTime())?"Invalid Date":t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(t){return"Invalid Date"}}static formatCurrency(e,t="INR"){return`â‚¹${(e||0).toLocaleString("en-IN")}`}static sanitizeData(e){return e.map(e=>{const t={};return Object.entries(e).forEach(([e,o])=>{null==o?t[e]="N/A":"object"==typeof o&&null!==o?Array.isArray(o)?t[e]=o.length>0?o.join(", "):"None":t[e]=JSON.stringify(o):t[e]="boolean"==typeof o?o?"Yes":"No":String(o)}),t})}static generateSummary(e,t){const o={"Total Records":e.length};return t.countFields&&t.countFields.forEach(t=>{const r=new Set(e.map(e=>e[t]).filter(e=>null!=e));o[`Unique ${t}`]=r.size}),t.sumFields&&t.sumFields.forEach(t=>{const r=e.reduce((e,o)=>e+(parseFloat(o[t])||0),0);o[`Total ${t}`]=r}),t.avgFields&&t.avgFields.forEach(t=>{const r=e.map(e=>parseFloat(e[t])||0).filter(e=>e>0),a=r.length>0?r.reduce((e,t)=>e+t,0)/r.length:0;o[`Average ${t}`]=Math.round(100*a)/100}),o}static validateExportData(e,t=1){return Array.isArray(e)?e.length<t?(r({title:"Insufficient Data",description:`At least ${t} record(s) required for export`,variant:"destructive"}),!1):!(e.length>0&&0===Object.keys(e[0]).length)||(r({title:"Empty Records",description:"Export data contains empty records",variant:"destructive"}),!1):(r({title:"Invalid Data",description:"Export data must be an array",variant:"destructive"}),!1)}static getFileSizeEstimate(e,t){const o=JSON.stringify(e).length;let r=1;switch(t){case"excel":r=.7;break;case"csv":r=.6;break;case"json":r=1}const a=o*r;return a<1024?`${Math.round(a)} B`:a<1048576?`${Math.round(a/1024)} KB`:`${Math.round(a/1048576)} MB`}static async batchExport(e,t,o=1e3,a="excel"){try{if(e.length<=o)return void("excel"===a?this.generateExcelReport(t,[{name:"Data",data:e}]):this.downloadCSV(e,t.filename));const n=[];for(let t=0;t<e.length;t+=o)n.push(e.slice(t,t+o));for(let e=0;e<n.length;e++){const o={...t,filename:`${t.filename}_part${e+1}of${n.length}`};"excel"===a?this.generateExcelReport(o,[{name:"Data",data:n[e]}]):this.downloadCSV(n[e],o.filename),e<n.length-1&&await new Promise(e=>setTimeout(e,1e3))}r({title:"Batch Export Complete",description:`Data exported in ${n.length} files due to size`})}catch(n){throw new Error("Failed to export large dataset")}}}export{a as E};

import{j as e}from"./ui-DOY6021Z.js";import{r as l}from"./router-2SVJvIbS.js";import{n as f,C as N,E as u,o as b,H as B,I as F,q as P,r as V,s as _,v as $,w as c,M as L,y as z,p as O,J as y,t as o}from"./index-DJqidggL.js";import{D as U}from"./download-9RJzCPqg.js";import"./vendor-Dazix4UH.js";const X=()=>{const[g,w]=l.useState([]),[n,S]=l.useState(null),[A,j]=l.useState(!0),[t,E]=l.useState(null),[I,d]=l.useState(!1),[r,v]=l.useState({status:"pending",search:"",page:1,limit:10}),[m,x]=l.useState(null),p=async()=>{try{const s=new URLSearchParams({page:r.page.toString(),limit:r.limit.toString(),status:r.status,search:r.search,sortBy:"submittedAt",sortOrder:"desc"}),a=await fetch(`/api/admin/vendor-approvals?${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!a.ok)throw new Error("Failed to fetch applications");const i=await a.json();w(i.data.vendors)}catch(s){console.error("Error fetching applications:",s),o({title:"Error",description:"Failed to fetch vendor applications",variant:"destructive"})}},h=async()=>{try{const s=await fetch("/api/admin/vendor-approval-stats",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!s.ok)throw new Error("Failed to fetch stats");const a=await s.json();S(a.data)}catch(s){console.error("Error fetching stats:",s)}};l.useEffect(()=>{(async()=>{j(!0),await Promise.all([p(),h()]),j(!1)})()},[r.status,r.page,r.search]);const C=async s=>{const a=prompt("Enter approval notes (optional):");x("approve");try{if(!(await fetch(`/api/admin/vendor-approvals/${s}/approve`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({approvalNotes:a,verificationLevel:"basic"})})).ok)throw new Error("Failed to approve vendor");o({title:"Success",description:"Vendor application approved successfully",variant:"default"}),p(),h(),d(!1)}catch(i){console.error("Error approving vendor:",i),o({title:"Error",description:"Failed to approve vendor application",variant:"destructive"})}finally{x(null)}},k=async s=>{const a=prompt("Enter rejection reason (required):");if(a){x("reject");try{if(!(await fetch(`/api/admin/vendor-approvals/${s}/reject`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({rejectionReason:a,allowResubmission:!0})})).ok)throw new Error("Failed to reject vendor");o({title:"Success",description:"Vendor application rejected and vendor notified",variant:"default"}),p(),h(),d(!1)}catch(i){console.error("Error rejecting vendor:",i),o({title:"Error",description:"Failed to reject vendor application",variant:"destructive"})}finally{x(null)}}},R=({status:s})=>{const a={pending:{color:"bg-yellow-100 text-yellow-800",icon:f},approved:{color:"bg-green-100 text-green-800",icon:N},rejected:{color:"bg-red-100 text-red-800",icon:y},under_review:{color:"bg-blue-100 text-blue-800",icon:u}},i=a[s]||a.pending,T=i.icon;return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${i.color}`,children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),s.replace("_"," ")]})},D=s=>new Date(s).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return A?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900"})}):e.jsxs("div",{className:"p-6 space-y-6 mt-16",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Vendor Applications"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Review and manage vendor applications"})]})}),n&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(f,{className:"h-6 w-6 text-yellow-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:n.overview.pendingApplications})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(N,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Approved"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:n.overview.approvedApplications})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(u,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Under Review"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:n.overview.underReviewApplications})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(b,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Approval Rate"}),e.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[n.overview.approvalRate,"%"]})]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(B,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(F,{placeholder:"Search by company name, email, or license number...",value:r.search,onChange:s=>v({...r,search:s.target.value,page:1}),className:"pl-10"})]}),e.jsxs(P,{value:r.status,onValueChange:s=>v({...r,status:s,page:1}),children:[e.jsx(V,{className:"w-full sm:w-48",children:e.jsx(_,{placeholder:"Filter by status"})}),e.jsxs($,{children:[e.jsx(c,{value:"all",children:"All Status"}),e.jsx(c,{value:"pending",children:"Pending"}),e.jsx(c,{value:"under_review",children:"Under Review"}),e.jsx(c,{value:"approved",children:"Approved"}),e.jsx(c,{value:"rejected",children:"Rejected"})]})]})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:g.length===0?e.jsx("li",{className:"p-6 text-center text-gray-500",children:"No applications found matching your criteria"}):g.map(s=>e.jsx("li",{className:"p-6 hover:bg-gray-50",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:s.businessInfo.companyName}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.user.profile.firstName," ",s.user.profile.lastName]})]}),e.jsx(R,{status:s.approval.status})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right text-sm text-gray-500",children:[e.jsxs("p",{children:["Submitted: ",D(s.approval.submittedAt)]}),e.jsxs("p",{children:["Documents: ",s.approval.submittedDocuments.length]})]}),e.jsxs("button",{onClick:()=>{E(s),d(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center space-x-2",children:[e.jsx(u,{className:"h-4 w-4"}),e.jsx("span",{children:"Review"})]})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{children:s.user.email})]}),s.user.profile.phone&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx("span",{children:s.user.profile.phone})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx("span",{children:s.businessInfo.businessType})]})]})]})})},s._id))})}),I&&t&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Vendor Application Details"}),e.jsx("button",{onClick:()=>d(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(y,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Company Name:"})," ",t.businessInfo.companyName]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Business Type:"})," ",t.businessInfo.businessType]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Contact Person:"})," ",t.user.profile.firstName," ",t.user.profile.lastName]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",t.user.email]}),t.businessInfo.licenseNumber&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"License Number:"})," ",t.businessInfo.licenseNumber]}),t.businessInfo.gstNumber&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"GST Number:"})," ",t.businessInfo.gstNumber]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Submitted Documents"}),e.jsx("div",{className:"space-y-2",children:t.approval.submittedDocuments.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(b,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.documentName}),e.jsx("p",{className:"text-xs text-gray-500",children:s.documentType.replace("_"," ")})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s.verified?e.jsx("span",{className:"text-green-600 text-sm",children:"Verified"}):e.jsx("span",{className:"text-yellow-600 text-sm",children:"Pending"}),e.jsx("a",{href:s.documentUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800",children:e.jsx(U,{className:"h-4 w-4"})})]})]},a))})]}),t.approval.status==="pending"&&e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{onClick:()=>k(t._id),disabled:m==="reject",className:"bg-red-600 text-white px-6 py-2 rounded-md hover:bg-red-700 disabled:opacity-50",children:m==="reject"?"Rejecting...":"Reject"}),e.jsx("button",{onClick:()=>C(t._id),disabled:m==="approve",className:"bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 disabled:opacity-50",children:m==="approve"?"Approving...":"Approve"})]})]})]})})]})};export{X as default};

import{j as e}from"./ui-s1SEoZIF.js";import{d as s,r as t}from"./router-D8v2YSKU.js";import{bP as a,z as r,t as i,J as l,f as n,an as d,a as c,e as o,$ as m,I as x,q as h,r as u,s as p,v as j,w as g,B as f,Q as v,k as N,E as w,am as b,a4 as y,a5 as C,a6 as $,a7 as S,a8 as k,L as P,T as R,ae as I,y as T,M as E}from"./index-DvBXyKtT.js";import{C as F}from"./camera-Cmt7c2KC.js";import{C as L}from"./calendar-JKH5plE4.js";import{P as _}from"./pen-line-CVda6ZS6.js";import{C as z}from"./circle-alert-B6eCZAbs.js";import"./vendor-BxThA0WO.js";const B=()=>{const{isConnected:B}=a(),A=s(),[O,Y]=t.useState(""),[q,M]=t.useState("all"),[U,D]=t.useState(!0),[G,V]=t.useState(!1),[H,J]=t.useState([]),[W,K]=t.useState(null),[Q,X]=t.useState(!1),[Z,ee]=t.useState(!1),[se,te]=t.useState(!1),[ae,re]=t.useState(!1),[ie,le]=t.useState({propertyId:"",vendorId:"",rating:0,title:"",comment:"",tags:[],isPublic:!0}),ne="https://app.buildhomemartsquares.com/api",de=t.useCallback(async()=>{try{D(!0);const e=r.getToken(),s=await fetch(`${ne}/customer/owned-properties`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),t=await s.json();t.success?J(t.data.properties||[]):i({title:"Error",description:t.message||"Failed to load owned properties",variant:"destructive"})}catch(e){i({title:"Error",description:"Failed to load owned properties. Please try again.",variant:"destructive"})}finally{D(!1)}},[ne]),ce=t.useCallback(async()=>{V(!0),await de(),V(!1)},[de]);t.useEffect(()=>{de()},[de]);const oe=H.filter(e=>{const s=e.title.toLowerCase().includes(O.toLowerCase())||`${e.address.city}, ${e.address.district||""}, ${e.address.state}`.toLowerCase().includes(O.toLowerCase()),t="all"===q||e.status===q;return s&&t}),me=(e,s=!1)=>{K(e),ee(s),s&&e.review?le({propertyId:e._id,vendorId:e.owner?._id||e.assignedBy?._id||"",rating:e.review.rating,title:e.review.title,comment:e.review.comment,tags:[],isPublic:!0}):le({propertyId:e._id,vendorId:e.owner?._id||e.assignedBy?._id||"",rating:0,title:"",comment:"",tags:[],isPublic:!0}),X(!0)},xe=e=>new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"}),he=e=>{const s=e.images.find(e=>e.isPrimary);return s?.url||e.images[0]?.url||"/placeholder-property.jpg"};return e.jsxs("div",{className:"space-y-6 pt-16",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(l,{className:"w-8 h-8 text-primary"}),"Owned Properties"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Properties you have purchased or rented"})]}),e.jsxs(n,{variant:"outline",onClick:ce,disabled:G,children:[e.jsx(d,{className:"w-4 h-4 mr-2 "+(G?"animate-spin":"")}),G?"Refreshing...":"Refresh"]})]}),!U&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:H.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Owned"})]})})}),e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:H.filter(e=>"sold"===e.status).length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Purchased"})]})})}),e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:H.filter(e=>"rented"===e.status).length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rented"})]})})})]}),e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{type:"text",placeholder:"Search properties...",className:"pl-10",value:O,onChange:e=>Y(e.target.value)})]}),e.jsxs(h,{value:q,onValueChange:M,children:[e.jsx(u,{className:"w-full sm:w-40",children:e.jsx(p,{placeholder:"Status"})}),e.jsxs(j,{children:[e.jsx(g,{value:"all",children:"All Status"}),e.jsx(g,{value:"sold",children:"Purchased"}),e.jsx(g,{value:"rented",children:"Rented"})]})]})]})})}),!U&&e.jsx("div",{className:"space-y-4",children:oe.map(s=>{return e.jsx(c,{className:"overflow-hidden",children:e.jsx(o,{className:"p-0",children:e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[e.jsxs("div",{className:"lg:w-64 h-48 lg:h-auto bg-muted relative",children:[s.images.length>0?e.jsx("img",{src:he(s),alt:s.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(F,{className:"w-12 h-12 text-muted-foreground"})}),e.jsxs("div",{className:"absolute top-3 left-3 flex gap-2",children:[e.jsx(f,{className:"sold"===s.status?"bg-purple-600 text-white":"bg-blue-600 text-white",children:"sold"===s.status?"Purchased":"Rented"}),s.hasReviewed&&e.jsxs(f,{className:"bg-green-600 text-white",children:[e.jsx(v,{className:"w-3 h-3 mr-1 fill-white"}),"Reviewed"]})]})]}),e.jsxs("div",{className:"flex-1 p-6",children:[e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold mb-1",children:s.title}),e.jsxs("div",{className:"flex items-center gap-4 text-muted-foreground text-sm mb-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"w-4 h-4"}),s.address.district?`${s.address.city}, ${s.address.district}, ${s.address.state}`:`${s.address.city}, ${s.address.state}`]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"w-4 h-4"}),"sold"===s.status?"Purchased":"Rented"," on ",xe(s.assignedAt)]})]}),e.jsx("p",{className:"text-muted-foreground text-sm line-clamp-2 mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[e.jsx("span",{children:(r=s.area,r.builtUp?`${r.builtUp} ${r.unit}`:r.plot?`${r.plot} ${r.unit}`:r.carpet?`${r.carpet} ${r.unit}`:"Area not specified")}),e.jsxs("span",{children:[s.bedrooms," BHK"]}),e.jsx("span",{className:"capitalize",children:s.listingType})]}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:(t=s.price,a=s.listingType,"rent"===a?`₹${t.toLocaleString("en-IN")}/month`:"lease"===a?`₹${t.toLocaleString("en-IN")}/year`:t>=1e7?`₹${(t/1e7).toFixed(1)} Cr`:t>=1e5?`₹${(t/1e5).toFixed(1)} Lac`:`₹${t.toLocaleString("en-IN")}`)})]})}),s.owner&&e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg mb-4",children:[e.jsx("h4",{className:"font-semibold mb-2 text-sm",children:"Seller Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Name: "}),e.jsx("span",{className:"font-medium",children:s.owner.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Email: "}),e.jsx("span",{className:"font-medium",children:s.owner.email})]}),s.owner.phone&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Phone: "}),e.jsx("span",{className:"font-medium",children:s.owner.phone})]})]})]}),s.hasReviewed&&s.review?e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-950/20 rounded-lg mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-green-800 dark:text-green-200",children:"Your Review"}),e.jsxs(n,{size:"sm",variant:"ghost",onClick:()=>me(s,!0),children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Edit Review"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(t=>e.jsx(v,{className:"w-4 h-4 "+(t<=s.review.rating?"fill-yellow-400 text-yellow-400":"text-gray-300")},t))}),e.jsx("span",{className:"text-sm text-muted-foreground",children:xe(s.review.createdAt)})]}),e.jsx("h5",{className:"font-medium mb-1",children:s.review.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.review.comment})]}):e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-800 dark:text-blue-200 mb-1",children:"Share Your Experience"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Help others by reviewing this property"})]}),e.jsxs(n,{size:"sm",onClick:()=>me(s,!1),children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"Write Review"]})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>A(`/property/${s._id}`),children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"View Details"]}),e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>{K(s),re(!0)},children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Contact Seller"]})]})]})]})})},s._id);var t,a,r})}),U&&e.jsx(c,{children:e.jsx(o,{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Loading your properties..."})]})})}),!U&&0===oe.length&&e.jsx(c,{children:e.jsxs(o,{className:"p-12 text-center",children:[e.jsx(l,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:0===H.length?"No owned properties found":"No properties match your filters"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:0===H.length?"You haven't purchased or rented any properties yet.":"Try adjusting your search criteria or clear some filters."}),H.length>0&&e.jsx(n,{variant:"outline",onClick:()=>{Y(""),M("all")},children:"Clear Filters"})]})}),e.jsx(y,{open:Q,onOpenChange:X,children:e.jsxs(C,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs($,{children:[e.jsx(S,{children:Z?"Edit Your Review":"Write a Review"}),e.jsx(k,{children:"Share your experience with this property to help other buyers make informed decisions."})]}),W&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-1",children:W.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:W.address.district?`${W.address.city}, ${W.address.district}, ${W.address.state}`:`${W.address.city}, ${W.address.state}`})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Rating *"}),e.jsx("div",{className:"flex gap-2 mt-2",children:[1,2,3,4,5].map(s=>e.jsx("button",{type:"button",onClick:()=>le({...ie,rating:s}),className:"focus:outline-none",children:e.jsx(v,{className:"w-8 h-8 cursor-pointer transition-colors "+(s<=ie.rating?"fill-yellow-400 text-yellow-400":"text-gray-300 hover:text-yellow-200")})},s))}),ie.rating>0&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[1===ie.rating&&"Poor",2===ie.rating&&"Fair",3===ie.rating&&"Good",4===ie.rating&&"Very Good",5===ie.rating&&"Excellent"]})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"review-title",children:"Review Title *"}),e.jsx(x,{id:"review-title",placeholder:"Sum up your experience in one line",value:ie.title,onChange:e=>le({...ie,title:e.target.value}),className:"mt-2",maxLength:200})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"review-comment",children:"Your Review *"}),e.jsx(R,{id:"review-comment",placeholder:"Share your experience with this property...",value:ie.comment,onChange:e=>le({...ie,comment:e.target.value}),className:"mt-2",rows:6,maxLength:1e3}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[ie.comment.length,"/1000 characters"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"public-review",checked:ie.isPublic,onChange:e=>le({...ie,isPublic:e.target.checked}),className:"rounded"}),e.jsx(P,{htmlFor:"public-review",className:"cursor-pointer",children:"Make this review public"})]})]}),e.jsxs(I,{children:[e.jsx(n,{variant:"outline",onClick:()=>{X(!1),K(null),ee(!1)},disabled:se,children:"Cancel"}),e.jsx(n,{onClick:async()=>{if(W)if(0!==ie.rating)if(ie.title.trim()&&ie.comment.trim())try{te(!0);const e=r.getToken(),s=Z&&W.reviewId?`${ne}/customer/reviews/${W.reviewId}`:`${ne}/customer/reviews`,t=Z?"PUT":"POST",a=await fetch(s,{method:t,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({propertyId:W._id,vendorId:W.owner?._id||W.assignedBy?._id,rating:ie.rating,title:ie.title,comment:ie.comment,reviewType:"property",tags:ie.tags,isPublic:ie.isPublic})}),l=await a.json();l.success?(i({title:"Success",description:Z?"Review updated successfully":"Review submitted successfully"}),X(!1),K(null),le({propertyId:"",vendorId:"",rating:0,title:"",comment:"",tags:[],isPublic:!0}),ee(!1),await de()):i({title:"Error",description:l.message||"Failed to submit review",variant:"destructive"})}catch(e){i({title:"Error",description:"Failed to submit review. Please try again.",variant:"destructive"})}finally{te(!1)}else i({title:"Missing Information",description:"Please provide both a title and comment for your review",variant:"destructive"});else i({title:"Rating Required",description:"Please select a rating for the property",variant:"destructive"})},disabled:se,children:se?e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"w-4 h-4 mr-2 animate-spin"}),"Submitting..."]}):e.jsx(e.Fragment,{children:Z?"Update Review":"Submit Review"})})]})]})}),e.jsx(y,{open:ae,onOpenChange:re,children:e.jsxs(C,{className:"max-w-md",children:[e.jsxs($,{children:[e.jsx(S,{children:"Contact Seller"}),e.jsx(k,{children:"Choose your preferred method to get in touch with the property seller."})]}),W&&W.owner&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Seller Information"}),e.jsxs("p",{className:"text-sm mb-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Name: "}),e.jsx("span",{className:"font-medium",children:W.owner.name})]}),W.owner.email&&e.jsxs("p",{className:"text-sm mb-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Email: "}),e.jsx("span",{className:"font-medium",children:W.owner.email})]}),W.owner.phone&&e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Phone: "}),e.jsx("span",{className:"font-medium",children:W.owner.phone})]})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-1",children:W.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:W.address.district?`${W.address.city}, ${W.address.district}, ${W.address.state}`:`${W.address.city}, ${W.address.state}`})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[W.owner.phone&&e.jsxs(n,{className:"w-full",onClick:()=>{window.location.href=`tel:${W.owner.phone}`},children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Call Seller"]}),W.owner.email&&e.jsxs(n,{variant:"outline",className:"w-full",onClick:()=>{window.location.href=`mailto:${W.owner.email}?subject=Inquiry about ${W.title}`},children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Email Seller"]}),e.jsxs(n,{variant:"outline",className:"w-full",onClick:()=>{re(!1),A("/customer/messages")},children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Send Message"]})]})]}),W&&!W.owner&&e.jsxs("div",{className:"p-4 text-center text-muted-foreground",children:[e.jsx(z,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{children:"Seller contact information is not available."})]}),e.jsx(I,{children:e.jsx(n,{variant:"outline",onClick:()=>re(!1),children:"Close"})})]})})]})};export{B as default};

import{j as e}from"./ui-BNZSgpjP.js";import{h as s,r as i}from"./router-D8v2YSKU.js";import{u as a,aC as r,f as t,a as n,b as l,c as d,i as c,e as o,h as p,C as m,_ as x,$ as h,I as f,q as u,r as j,s as v,v as N,w as g,L as b,E as y,b0 as w,a$ as V,a4 as A,a5 as C,a6 as k,a7 as S,a8 as P,ae as D,S as B,y as I,B as T,T as F,aP as R,aQ as E,t as _}from"./index-BxQlwZ4N.js";import{C as $}from"./checkbox-BPcwrT0E.js";import{A as M,b as L,a as Y}from"./alert-rEX1VgGL.js";import{P as O,a as z,b as U,d as q}from"./pagination-Bluag2R6.js";import{T as W,a as G,b as J,c as H,d as K,e as Q}from"./table-DislQvtG.js";import{D as X}from"./download-CJjNKXXO.js";import{C as Z}from"./calendar-D1Xo3Yen.js";import"./vendor-BxThA0WO.js";import"./ellipsis-rLfR_Cmd.js";const ee=()=>{const{user:ee}=a(),[se]=s(),[ie,ae]=i.useState([]),[re,te]=i.useState(null),[ne,le]=i.useState(!0),[de,ce]=i.useState(!1),[oe,pe]=i.useState(null),[me,xe]=i.useState(!1),[he,fe]=i.useState({status:"all",search:"",businessType:"",experienceMin:"",experienceMax:"",startDate:"",endDate:"",page:1,limit:10}),ue=r(he.search,500),[je,ve]=i.useState({currentPage:1,totalPages:0,totalCount:0,hasNextPage:!1,hasPrevPage:!1,limit:10}),[Ne,ge]=i.useState(null),be=()=>ee?.profile?.firstName&&ee?.profile?.lastName?`${ee.profile.firstName} ${ee.profile.lastName}`:ee?.profile?.firstName?ee.profile.firstName:ee?.email?ee.email:"",[ye,we]=i.useState(!1),[Ve,Ae]=i.useState("approve"),[Ce,ke]=i.useState(be()),[Se,Pe]=i.useState({phoneVerified:!1,emailVerified:!1,identityProofVerified:!1,businessNameVerified:!1,businessTypeVerified:!1,businessDescriptionVerified:!1,experienceVerified:!1,addressVerified:!1,panNumberVerified:!1,gstNumberVerified:!1,licenseNumberVerified:!1,businessRegistrationVerified:!1}),[De,Be]=i.useState(""),[Ie,Te]=i.useState(""),[Fe,Re]=i.useState(!1),[Ee,_e]=i.useState(null),$e=async()=>{try{const e=new URLSearchParams({page:he.page.toString(),limit:he.limit.toString(),status:he.status,search:ue,businessType:he.businessType,experienceMin:he.experienceMin,experienceMax:he.experienceMax,startDate:he.startDate,endDate:he.endDate,sortBy:"submittedAt",sortOrder:"desc"}),s=await R(`/admin/vendor-approvals?${e}`),i=await E(s);ae(i.data.vendors||[]),i.data.pagination&&ve(i.data.pagination)}catch(e){_({title:"Error",description:e instanceof Error?e.message:"Failed to fetch vendor applications",variant:"destructive"}),ae([])}},Me=async()=>{try{const e=await R("/admin/vendor-approval-stats"),s=await E(e);te(s.data||null)}catch(e){_({title:"Error",description:e instanceof Error?e.message:"Failed to fetch statistics",variant:"destructive"}),te(null)}};i.useEffect(()=>{const e=be();e&&ke(e)},[ee]),i.useEffect(()=>{const e=se.get("vendorId");if(e&&ie.length>0){const s=ie.find(s=>s._id===e);s&&(pe(s),xe(!0))}},[se,ie]),i.useEffect(()=>{(async()=>{ne||ce(!0),await Promise.all([$e(),Me()]),le(!1),ce(!1)})()},[he.status,he.page,ue,he.businessType,he.experienceMin,he.experienceMax,he.limit,he.startDate,he.endDate]),i.useEffect(()=>{if(oe?.approval.phoneVerifiedAt){const e=()=>{const e=new Date(oe.approval.phoneVerifiedAt).getTime(),s=6e5-((new Date).getTime()-e);_e(s>0?s:0)};e();const s=setInterval(e,1e3);return()=>clearInterval(s)}_e(null)},[oe]);const Le=()=>{Pe({phoneVerified:!1,emailVerified:!1,identityProofVerified:!1,businessNameVerified:!1,businessTypeVerified:!1,businessDescriptionVerified:!1,experienceVerified:!1,addressVerified:!1,panNumberVerified:!1,gstNumberVerified:!1,licenseNumberVerified:!1,businessRegistrationVerified:!1}),Be(""),Te(""),ke(be())},Ye=(e,s)=>{pe(e),Ae(s),Le(),e.approval.verificationChecklist&&Pe(e.approval.verificationChecklist),ke(e.approval.approverName||be()),we(!0)},Oe=async()=>{if(!oe||!Ce.trim())return void _({title:"Error",description:"Approver name is required",variant:"destructive"});if(!Se.phoneVerified)return void _({title:"Error",description:"Phone verification must be completed first",variant:"destructive"});if(!De.trim())return void _({title:"Error",description:"Approval comments are required",variant:"destructive"});Object.values(Se).every(e=>!0===e)||_({title:"Warning",description:"Not all verification steps are completed. Are you sure you want to proceed?",variant:"destructive"}),ge("approve");try{const e={approvalNotes:De,approverName:Ce,verificationChecklist:Se,verificationLevel:"basic"},s=await R(`/admin/vendor-approvals/${oe._id}/approve`,{method:"POST",body:JSON.stringify(e)});await E(s),_({title:"Success",description:"Vendor application approved successfully",variant:"default"}),we(!1),await $e(),await Me()}catch(e){_({title:"Error",description:e instanceof Error?e.message:"Failed to approve vendor application",variant:"destructive"})}finally{ge(null)}},ze=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Ue=e=>`${Math.floor(e/6e4)}:${Math.floor(e%6e4/1e3).toString().padStart(2,"0")}`,qe=s=>{const i={pending:{variant:"secondary",icon:p,label:"Pending"},under_review:{variant:"default",icon:y,label:"Under Review"},approved:{variant:"default",icon:m,label:"Approved"},rejected:{variant:"destructive",icon:x,label:"Rejected"}},a=i[s]||i.pending,r=a.icon;return e.jsxs(T,{variant:a.variant,children:[e.jsx(r,{className:"w-3 h-3 mr-1"}),a.label]})},We=()=>{if(!oe)return!1;if(!Se.phoneVerified)return!1;if(!oe.approval.phoneVerifiedAt)return!1;const e=new Date(oe.approval.phoneVerifiedAt).getTime();return(new Date).getTime()-e>=6e5};return ne?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:justify-between md:items-start md:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Vendor Applications"}),e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"Review and manage vendor registration applications"})]}),e.jsxs(t,{onClick:async()=>{try{const e=await R("/admin/vendor-approvals/export"),s=await E(e),i=[["Application ID","Company Name","Applicant Name","Email","Phone","Business Type","Submitted Date","Status","Reviewed Date","Reviewed By","Approver Name","Phone Verified","Email Verified","Identity Proof Verified","Business Name Verified","Business Type Verified","Business Description Verified","Experience Verified","Address Verified","PAN Number Verified","GST Number Verified","License Number Verified","Business Registration Verified","Approval/Rejection Comments"].join(","),...s.data.map(e=>{const s=e.approval?.verificationChecklist||{},i=e.approval?.submittedAt?new Date(e.approval.submittedAt).toLocaleDateString():"N/A",a=e.approval?.reviewedAt?new Date(e.approval.reviewedAt).toLocaleDateString():"N/A",r=e.approval?.reviewedBy?`${e.approval.reviewedBy.profile?.firstName||""} ${e.approval.reviewedBy.profile?.lastName||""}`.trim():"N/A";return[e._id||"N/A",`"${e.businessInfo?.companyName||"N/A"}"`,`"${e.user?.profile?.firstName||""} ${e.user?.profile?.lastName||""}"`.trim()||"N/A",e.user?.email||"N/A",e.user?.profile?.phone||"N/A",e.businessInfo?.businessType||"N/A",i,e.approval?.status||"N/A",a,r,e.approval?.approverName||"N/A",s.phoneVerified?"Yes":"No",s.emailVerified?"Yes":"No",s.identityProofVerified?"Yes":"No",s.businessNameVerified?"Yes":"No",s.businessTypeVerified?"Yes":"No",s.businessDescriptionVerified?"Yes":"No",s.experienceVerified?"Yes":"No",s.addressVerified?"Yes":"No",s.panNumberVerified?"Yes":"No",s.gstNumberVerified?"Yes":"No",s.licenseNumberVerified?"Yes":"No",s.businessRegistrationVerified?"Yes":"No",`"${e.approval?.approvalNotes||e.approval?.rejectionReason||"N/A"}"`].join(",")})].join("\n"),a=new Blob([i],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),t=URL.createObjectURL(a);r.setAttribute("href",t),r.setAttribute("download",`vendor_approval_report_${(new Date).toISOString().split("T")[0]}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),_({title:"Success",description:"Approval report exported successfully",variant:"default"})}catch(e){_({title:"Error",description:"Failed to export approval report",variant:"destructive"})}},variant:"outline",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Export Report"]})]}),re&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-5",children:[e.jsxs(n,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Total Applications"}),e.jsx(c,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold",children:re.overview.totalApplications})})]}),e.jsxs(n,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Pending Review"}),e.jsx(p,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold",children:re.overview.pendingApplications})})]}),e.jsxs(n,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Approved"}),e.jsx(m,{className:"h-4 w-4 text-green-600"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold",children:re.overview.approvedApplications})})]}),e.jsxs(n,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Rejected"}),e.jsx(x,{className:"h-4 w-4 text-red-600"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold",children:re.overview.rejectedApplications})})]}),e.jsxs(n,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Approval Rate"}),e.jsx(m,{className:"h-4 w-4 text-green-600"})]}),e.jsx(o,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[re.overview.approvalRate.toFixed(1),"%"]})})]})]}),e.jsx(n,{children:e.jsxs(o,{className:"pt-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(f,{placeholder:"Search by name or email...",value:he.search,onChange:e=>fe({...he,search:e.target.value,page:1})})]}),e.jsxs(u,{value:he.status,onValueChange:e=>fe({...he,status:e,page:1}),children:[e.jsx(j,{children:e.jsx(v,{placeholder:"Filter by status"})}),e.jsxs(N,{children:[e.jsx(g,{value:"all",children:"All Statuses"}),e.jsx(g,{value:"pending",children:"Pending"}),e.jsx(g,{value:"under_review",children:"Under Review"}),e.jsx(g,{value:"approved",children:"Approved"}),e.jsx(g,{value:"rejected",children:"Rejected"})]})]}),e.jsxs(u,{value:he.businessType||"all",onValueChange:e=>fe({...he,businessType:"all"===e?"":e,page:1}),children:[e.jsx(j,{children:e.jsx(v,{placeholder:"Filter by business type"})}),e.jsxs(N,{children:[e.jsx(g,{value:"all",children:"All Types"}),e.jsx(g,{value:"real_estate_agent",children:"Real Estate Agent"}),e.jsx(g,{value:"property_management",children:"Property Management"}),e.jsx(g,{value:"developer",children:"Developer"}),e.jsx(g,{value:"individual",children:"Individual"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"number",placeholder:"Min experience",value:he.experienceMin,onChange:e=>fe({...he,experienceMin:e.target.value,page:1})}),e.jsx(f,{type:"number",placeholder:"Max experience",value:he.experienceMax,onChange:e=>fe({...he,experienceMax:e.target.value,page:1})})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4 mt-4",children:[e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(b,{className:"text-xs text-muted-foreground",children:"From"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(f,{type:"date",placeholder:"Start Date",value:he.startDate,onChange:e=>fe({...he,startDate:e.target.value,page:1})})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(b,{className:"text-xs text-muted-foreground",children:"To"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(f,{type:"date",placeholder:"End Date",value:he.endDate,onChange:e=>fe({...he,endDate:e.target.value,page:1})})]})]}),(he.startDate||he.endDate)&&e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>fe({...he,startDate:"",endDate:"",page:1}),className:"text-muted-foreground hover:text-foreground",children:"Clear Dates"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsx(b,{htmlFor:"pageSize",className:"text-sm text-muted-foreground whitespace-nowrap",children:"Items per page:"}),e.jsxs(u,{value:he.limit.toString(),onValueChange:e=>fe({...he,limit:parseInt(e),page:1}),children:[e.jsx(j,{id:"pageSize",className:"w-[100px]",children:e.jsx(v,{})}),e.jsxs(N,{children:[e.jsx(g,{value:"10",children:"10"}),e.jsx(g,{value:"25",children:"25"}),e.jsx(g,{value:"50",children:"50"}),e.jsx(g,{value:"100",children:"100"})]})]})]})]})}),e.jsxs(n,{children:[e.jsx(l,{children:e.jsx(d,{children:"Applications"})}),e.jsxs(o,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(W,{children:[e.jsx(G,{children:e.jsxs(J,{children:[e.jsx(H,{children:"S.no"}),e.jsx(H,{children:"Company Name"}),e.jsx(H,{children:"Applicant"}),e.jsx(H,{children:"Contact"}),e.jsx(H,{children:"Business Type"}),e.jsx(H,{children:"Submitted Date"}),e.jsx(H,{children:"Status"}),e.jsx(H,{className:"text-right",children:"Actions"})]})}),e.jsx(K,{children:0===ie.length?e.jsx(J,{children:e.jsx(Q,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No applications found"})}):ie.map((s,i)=>e.jsxs(J,{children:[e.jsx(Q,{children:(je.currentPage-1)*je.limit+i+1}),e.jsx(Q,{className:"font-medium",children:s.businessInfo.companyName}),e.jsx(Q,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{children:[s.user?.profile?.firstName," ",s.user?.profile?.lastName]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.user?.email})]})}),e.jsx(Q,{children:s.user?.profile?.phone||"N/A"}),e.jsx(Q,{children:s.businessInfo.businessType}),e.jsxs(Q,{children:[ze(s.approval.submittedAt),"approved"===s.approval.status&&"superadmin"===ee?.role&&s.approval.approverName&&e.jsxs("span",{className:"block text-xs text-green-600 mt-1",children:["Approved by: ",s.approval.approverName]})]}),e.jsx(Q,{children:qe(s.approval.status)}),e.jsx(Q,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>{pe(s),xe(!0)},children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Review"]}),"pending"===s.approval.status||"under_review"===s.approval.status?e.jsxs(e.Fragment,{children:[e.jsxs(t,{variant:"default",size:"sm",onClick:()=>Ye(s,"approve"),children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"under_review"===s.approval.status?"Update":"Approve"]}),e.jsxs(t,{variant:"destructive",size:"sm",onClick:()=>Ye(s,"reject"),children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"Reject"]})]}):null]})})]},s._id))})]})}),ie.length>0&&je.totalPages>1&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(je.currentPage-1)*je.limit+1," to"," ",Math.min(je.currentPage*je.limit,je.totalCount)," of"," ",je.totalCount," applications"]}),e.jsx(O,{children:e.jsxs(z,{children:[e.jsx(U,{children:e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>fe({...he,page:he.page-1}),disabled:!je.hasPrevPage,children:[e.jsx(w,{className:"h-4 w-4 mr-1"}),"Previous"]})}),Array.from({length:Math.min(5,je.totalPages)},(s,i)=>{let a;return a=je.totalPages<=5||je.currentPage<=3?i+1:je.currentPage>=je.totalPages-2?je.totalPages-4+i:je.currentPage-2+i,e.jsx(U,{children:e.jsx(q,{onClick:()=>fe({...he,page:a}),isActive:je.currentPage===a,className:"cursor-pointer",children:a})},a)}),e.jsx(U,{children:e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>fe({...he,page:he.page+1}),disabled:!je.hasNextPage,children:["Next",e.jsx(V,{className:"h-4 w-4 ml-1"})]})})]})})]})]})]}),e.jsx(A,{open:me,onOpenChange:xe,children:e.jsxs(C,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(k,{children:[e.jsx(S,{children:"Application Review"}),e.jsx(P,{children:"Detailed information about the vendor application"})]}),oe&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Status"}),e.jsx("div",{className:"mt-2",children:qe(oe.approval.status)})]})}),e.jsxs(n,{children:[e.jsx(l,{children:e.jsx(d,{className:"text-base",children:"Contact Person"})}),e.jsxs(o,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Name:"}),e.jsxs("span",{children:[oe.user.profile.firstName," ",oe.user.profile.lastName]})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Email:"}),e.jsx("span",{className:"break-all",children:oe.user.email})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Phone:"}),e.jsx("span",{children:oe.user.profile.phone||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Registered On:"}),e.jsx("span",{children:ze(oe.user.createdAt)})]})]})]}),e.jsxs(n,{children:[e.jsx(l,{children:e.jsx(d,{className:"text-base",children:"Business Information"})}),e.jsxs(o,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Company Name:"}),e.jsx("span",{children:oe.businessInfo.companyName})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Business Type:"}),e.jsx("span",{children:oe.businessInfo.businessType})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Experience:"}),e.jsx("span",{children:oe.professionalInfo?.experience?`${oe.professionalInfo.experience} years`:"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1 md:col-span-2",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Business Description:"}),e.jsx("span",{className:"break-words",children:oe.professionalInfo?.description||"N/A"})]})]})]}),e.jsxs(n,{children:[e.jsx(l,{children:e.jsx(d,{className:"text-base",children:"Address Information"})}),e.jsxs(o,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Address:"}),e.jsx("span",{className:"break-words",children:oe.professionalInfo?.officeAddress?.area||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"City:"}),e.jsx("span",{children:oe.professionalInfo?.officeAddress?.city||oe.professionalInfo?.serviceAreas?.[0]?.city||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"State:"}),e.jsx("span",{children:oe.professionalInfo?.officeAddress?.state||oe.professionalInfo?.serviceAreas?.[0]?.state||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Pincode:"}),e.jsx("span",{children:oe.professionalInfo?.officeAddress?.pincode||oe.professionalInfo?.serviceAreas?.[0]?.pincode||"N/A"})]})]})]}),e.jsxs(n,{children:[e.jsx(l,{children:e.jsx(d,{className:"text-base",children:"Legal Documents"})}),e.jsxs(o,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"PAN Number:"}),e.jsx("span",{children:oe.businessInfo.panNumber||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"GST Number:"}),e.jsx("span",{children:oe.businessInfo.gstNumber||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"License Number:"}),e.jsx("span",{children:oe.businessInfo.licenseNumber||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Website:"}),e.jsx("span",{children:oe.businessInfo.website||"N/A"})]})]})]}),oe.approval.submittedDocuments&&oe.approval.submittedDocuments.length>0&&e.jsxs(n,{children:[e.jsx(l,{children:e.jsx(d,{className:"text-base",children:"Submitted Documents"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-2",children:oe.approval.submittedDocuments.map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.documentName}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.documentType})]})]}),e.jsx(t,{variant:"outline",size:"sm",onClick:()=>window.open(s.documentUrl,"_blank"),children:"View"})]},i))})})]})]}),e.jsx(D,{children:e.jsx(t,{variant:"outline",onClick:()=>xe(!1),children:"Close"})})]})}),e.jsx(A,{open:ye,onOpenChange:we,children:e.jsxs(C,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(k,{children:[e.jsx(S,{children:"approve"===Ve?"under_review"===oe?.approval.status?"Complete Verification":"Approve Application":"Reject Application"}),e.jsx(P,{children:"approve"===Ve?"Complete the verification checklist and provide approval details":"Provide a reason for rejecting this application"})]}),oe&&e.jsxs("div",{className:"space-y-6",children:[oe.approval.lockedBy&&String(oe.approval.lockedBy._id)!==String(ee?.id)&&"superadmin"!==ee?.role&&e.jsxs(M,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(B,{className:"h-4 w-4 text-yellow-600"}),e.jsx(L,{children:"Application Locked"}),e.jsxs(Y,{children:["This vendor application is currently being handled by"," ",e.jsx("strong",{children:oe.approval.lockedBy.profile?.firstName?`${oe.approval.lockedBy.profile.firstName} ${oe.approval.lockedBy.profile.lastName||""}`:oe.approval.lockedBy.email}),". You cannot approve or reject this application."]})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:oe.businessInfo.companyName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[oe.user.profile.firstName," ",oe.user.profile.lastName," â€¢ ",oe.user.email]}),oe.approval.lockedBy&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("p",{className:"text-xs font-medium text-primary",children:"Currently Handling:"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[oe.approval.lockedBy.profile?.firstName?`${oe.approval.lockedBy.profile.firstName} ${oe.approval.lockedBy.profile.lastName||""}`:oe.approval.lockedBy.email,oe.approval.lockedBy._id===ee?.id&&" (You)"]}),oe.approval.lockedAt&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Since: ",new Date(oe.approval.lockedAt).toLocaleString()]})]}),oe.approval.phoneVerifiedBy&&oe.approval.phoneVerifiedBy._id!==oe.approval.lockedBy?._id&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("p",{className:"text-xs font-medium text-blue-600",children:"Phone Verified By:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:oe.approval.phoneVerifiedBy.profile?.firstName?`${oe.approval.phoneVerifiedBy.profile.firstName} ${oe.approval.phoneVerifiedBy.profile.lastName||""}`:oe.approval.phoneVerifiedBy.email})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{htmlFor:"approverName",children:["Approver Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(f,{id:"approverName",value:Ce,onChange:e=>ke(e.target.value),placeholder:"Enter your full name",disabled:Se.phoneVerified}),oe.approval.lockedBy&&oe.approval.lockedBy._id===ee?.id&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"You are currently handling this application. Your name is pre-filled from the initial action."})]}),"approve"===Ve&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{className:"border-2 border-primary/20",children:[e.jsx(l,{children:e.jsxs(d,{className:"text-base flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-primary"}),"Step 1: Phone Verification (Required)"]})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Phone: ",oe.user.profile.phone||"N/A"]})]}),Se.phoneVerified?e.jsxs(T,{variant:"default",className:"bg-green-600",children:[e.jsx(m,{className:"w-4 h-4 mr-1"}),"Verified"]}):e.jsx(t,{onClick:async()=>{if(oe&&Ce.trim()){Re(!0);try{const e=await R(`/admin/vendor-approvals/${oe._id}/verify-phone`,{method:"POST",body:JSON.stringify({approverName:Ce})});await E(e);Pe(e=>({...e,phoneVerified:!0})),pe(e=>e?{...e,approval:{...e.approval,status:"under_review",phoneVerifiedAt:(new Date).toISOString(),verificationChecklist:{...e.approval.verificationChecklist,phoneVerified:!0}}}:e),await $e(),_({title:"Phone Verified",description:"Phone verification successful. Status changed to under review.",variant:"default"})}catch(e){_({title:"Error",description:e instanceof Error?e.message:"Failed to verify phone",variant:"destructive"})}finally{Re(!1)}}else _({title:"Error",description:"Please enter approver name first",variant:"destructive"})},disabled:Fe||!Ce.trim(),size:"sm",children:Fe?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Verifying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"Verify Phone"]})})]}),oe.approval.phoneVerifiedAt&&null!==Ee&&e.jsxs(M,{children:[e.jsx(p,{className:"h-4 w-4"}),e.jsx(L,{children:"Verification Freeze Period"}),e.jsx(Y,{children:Ee>0?e.jsxs(e.Fragment,{children:["Time remaining until other verifications unlock: "," ",e.jsx("strong",{className:"text-primary",children:Ue(Ee)})]}):e.jsx("span",{className:"text-green-600 font-semibold",children:"Freeze period completed! You can now proceed with other verifications."})})]})]})]}),e.jsxs(n,{children:[e.jsx(l,{children:e.jsxs(d,{className:"text-base",children:["Step 2: Verification Checklist ",!We()&&"(Locked - Complete phone verification first)"]})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Personal Information"}),e.jsxs("div",{className:"space-y-2 pl-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"emailVerified",checked:Se.emailVerified,onCheckedChange:e=>Pe({...Se,emailVerified:e}),disabled:!We()}),e.jsx("label",{htmlFor:"emailVerified",className:"text-sm cursor-pointer",children:"Email verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"identityProofVerified",checked:Se.identityProofVerified,onCheckedChange:e=>Pe({...Se,identityProofVerified:e}),disabled:!We()}),e.jsx("label",{htmlFor:"identityProofVerified",className:"text-sm cursor-pointer",children:"Identity documents verified (Aadhar/Passport/DL)"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Business Information"}),e.jsxs("div",{className:"space-y-2 pl-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"businessNameVerified",checked:Se.businessNameVerified,onCheckedChange:e=>Pe({...Se,businessNameVerified:e}),disabled:!We()}),e.jsx("label",{htmlFor:"businessNameVerified",className:"text-sm cursor-pointer",children:"Business name verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"businessTypeVerified",checked:Se.businessTypeVerified,onCheckedChange:e=>Pe({...Se,businessTypeVerified:e}),disabled:!We()}),e.jsx("label",{htmlFor:"businessTypeVerified",className:"text-sm cursor-pointer",children:"Business type verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"businessDescriptionVerified",checked:Se.businessDescriptionVerified,onCheckedChange:e=>Pe({...Se,businessDescriptionVerified:e}),disabled:!We()}),e.jsx("label",{htmlFor:"businessDescriptionVerified",className:"text-sm cursor-pointer",children:"Business description verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"experienceVerified",checked:Se.experienceVerified,onCheckedChange:e=>Pe({...Se,experienceVerified:e}),disabled:!We()}),e.jsx("label",{htmlFor:"experienceVerified",className:"text-sm cursor-pointer",children:"Professional experience verified"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Address Information"}),e.jsx("div",{className:"space-y-2 pl-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"addressVerified",checked:Se.addressVerified,onCheckedChange:e=>Pe({...Se,addressVerified:e}),disabled:!We()}),e.jsx("label",{htmlFor:"addressVerified",className:"text-sm cursor-pointer",children:"Address verified and matches records"})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Legal Documents"}),e.jsxs("div",{className:"space-y-2 pl-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"panNumberVerified",checked:Se.panNumberVerified,onCheckedChange:e=>Pe({...Se,panNumberVerified:e}),disabled:!We()}),e.jsx("label",{htmlFor:"panNumberVerified",className:"text-sm cursor-pointer",children:"PAN card verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"gstNumberVerified",checked:Se.gstNumberVerified,onCheckedChange:e=>Pe({...Se,gstNumberVerified:e}),disabled:!We()}),e.jsx("label",{htmlFor:"gstNumberVerified",className:"text-sm cursor-pointer",children:"GST number verified (if applicable)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"licenseNumberVerified",checked:Se.licenseNumberVerified,onCheckedChange:e=>Pe({...Se,licenseNumberVerified:e}),disabled:!We()}),e.jsx("label",{htmlFor:"licenseNumberVerified",className:"text-sm cursor-pointer",children:"License/registration verified"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Documents"}),e.jsx("div",{className:"space-y-2 pl-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"businessRegistrationVerified",checked:Se.businessRegistrationVerified,onCheckedChange:e=>Pe({...Se,businessRegistrationVerified:e}),disabled:!We()}),e.jsx("label",{htmlFor:"businessRegistrationVerified",className:"text-sm cursor-pointer",children:"All required documents submitted and verified"})]})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{htmlFor:"approvalComments",children:["Approval Comments ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(F,{id:"approvalComments",value:De,onChange:e=>Be(e.target.value),placeholder:"Add any additional notes about this approval...",rows:4})]})]}),"reject"===Ve&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{htmlFor:"rejectionComments",children:["Rejection Reason ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(F,{id:"rejectionComments",value:Ie,onChange:e=>Te(e.target.value),placeholder:"Provide a detailed reason for rejection...",rows:6})]})]}),e.jsxs(D,{children:[e.jsx(t,{variant:"outline",onClick:()=>{we(!1),Le()},disabled:null!==Ne,children:"Cancel"}),"approve"===Ve?e.jsx(t,{onClick:async()=>{oe&&("under_review"===oe.approval.status&&null!==Ee&&Ee>0?_({title:"Freeze Period Active",description:`Please wait ${Ue(Ee)} before completing the verification.`,variant:"destructive"}):await Oe())},disabled:"approve"===Ne||!Se.phoneVerified||null!==Ee&&Ee>0||oe?.approval.lockedBy&&String(oe.approval.lockedBy._id)!==String(ee?.id)&&"superadmin"!==ee?.role,children:"approve"===Ne?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):null!==Ee&&Ee>0?e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"Wait ",Ue(Ee)]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"under_review"===oe?.approval.status?"Complete & Approve":"Approve"]})}):e.jsx(t,{variant:"destructive",onClick:async()=>{if(oe)if(Ie.trim()){ge("reject");try{const e=await R(`/admin/vendor-approvals/${oe._id}/reject`,{method:"POST",body:JSON.stringify({rejectionReason:Ie})});await E(e),_({title:"Success",description:"Vendor application rejected",variant:"default"}),we(!1),await $e(),await Me()}catch(e){_({title:"Error",description:e instanceof Error?e.message:"Failed to reject vendor application",variant:"destructive"})}finally{ge(null)}}else _({title:"Error",description:"Rejection reason is required",variant:"destructive"})},disabled:"reject"===Ne||oe?.approval.lockedBy&&String(oe.approval.lockedBy._id)!==String(ee?.id)&&"superadmin"!==ee?.role,children:"reject"===Ne?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"Reject Application"]})})]})]})})]})};export{ee as default};

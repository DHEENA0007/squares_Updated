import{j as e}from"./ui-CEt46o3G.js";import{r as l,L as M}from"./router-2SVJvIbS.js";import{C as i,d as n}from"./card-YvDMUmzt.js";import{O as W,t as w,Q as Y,R as S,K as A,a as c,a0 as C,P as z,B as b,S as J,I as X,M as Z,D as ee,l as se,m as te,n as p,o as _,z as ae}from"./index-CiYV0Sy0.js";import{S as $,a as B,b as H,c as O,d as r}from"./select-BHWxeluH.js";import{c as d}from"./customerPropertiesService-Dj-chyEI.js";import{R as Q}from"./refresh-cw-B8zbtsbT.js";import{C as re}from"./camera-2k-Wb9vt.js";import{C as le}from"./calendar-DWj9NFdt.js";import{E as ie}from"./ellipsis-vertical-CarBFatF.js";import{E as T}from"./eye-CDS1ofgA.js";import{P as G}from"./pen-line-hrB0mI2q.js";import{T as I}from"./trending-up-BLutZFyR.js";import{T as ne}from"./trash-2-Dj_If1Zn.js";import"./vendor-Dazix4UH.js";import"./index-BdQq_4o_.js";import"./index-DHzxUTm5.js";import"./chevron-down-DeDu0PPf.js";const Te=()=>{const{isConnected:k,lastEvent:E}=W(),[u,F]=l.useState(""),[m,R]=l.useState("all"),[x,V]=l.useState("all"),[j,L]=l.useState(!0),[y,q]=l.useState(!1),[g,f]=l.useState([]),[o,N]=l.useState({totalProperties:0,activeProperties:0,rentedProperties:0,soldProperties:0,draftProperties:0,pendingProperties:0,totalViews:0,totalInquiries:0,totalFavorites:0,totalRevenue:0,monthlyRevenue:0,averageViews:0,averageInquiries:0,conversionRate:0}),[ce,K]=l.useState({currentPage:1,totalPages:0,totalProperties:0,hasNextPage:!1,hasPrevPage:!1}),v=l.useCallback(async(s={})=>{try{L(!0);const t=await d.getCustomerProperties({search:u||void 0,status:m!=="all"?m:void 0,type:x!=="all"?x:void 0,...s});t.success?(f(t.data.properties||[]),t.data.stats&&N(t.data.stats),K(t.data.pagination||{currentPage:1,totalPages:0,totalProperties:0,hasNextPage:!1,hasPrevPage:!1})):w({title:"Error",description:"Failed to load properties",variant:"destructive"})}catch(t){console.error("Failed to load properties:",t),w({title:"Error",description:"Failed to load properties. Please try again.",variant:"destructive"})}finally{L(!1)}},[u,m,x]),P=l.useCallback(async()=>{q(!0),await v(),q(!1)},[v]);l.useEffect(()=>{v()},[v]),Y({refreshProperties:()=>{console.log("My properties updated via realtime"),P()},refreshStats:()=>{console.log("Property stats updated via realtime"),P()}}),S("property_viewed",s=>{s.propertyId&&(f(t=>t.map(a=>a._id===s.propertyId?{...a,views:a.views+1,analytics:{...a.analytics,weeklyViews:a.analytics.weeklyViews+1}}:a)),N(t=>({...t,totalViews:t.totalViews+1})))}),S("property_inquiry",s=>{s.propertyId&&(f(t=>t.map(a=>a._id===s.propertyId?{...a,inquiries:a.inquiries+1,analytics:{...a.analytics,weeklyInquiries:a.analytics.weeklyInquiries+1}}:a)),N(t=>({...t,totalInquiries:t.totalInquiries+1})))}),S("property_favorited",s=>{if(s.propertyId&&s.action){const t=s.action==="add"?1:-1;f(a=>a.map(h=>h._id===s.propertyId?{...h,favorites:Math.max(0,h.favorites+t)}:h)),N(a=>({...a,totalFavorites:Math.max(0,a.totalFavorites+t)}))}});const U=async s=>{try{await d.deleteProperty(s),f(t=>t.filter(a=>a._id!==s)),w({title:"Success",description:"Property deleted successfully"})}catch(t){console.error("Failed to delete property:",t),w({title:"Error",description:"Failed to delete property",variant:"destructive"})}},D=g.filter(s=>{const t=s.title.toLowerCase().includes(u.toLowerCase())||`${s.address.city}, ${s.address.state}`.toLowerCase().includes(u.toLowerCase()),a=m==="all"||s.status===m,h=x==="all"||s.type===x;return t&&a&&h});return e.jsxs("div",{className:"space-y-6 pt-16",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(A,{className:"w-8 h-8 text-primary"}),"My Properties"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your property listings and track performance"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Analytics"]}),e.jsx(c,{asChild:!0,children:e.jsxs(M,{to:"/customer/post-property",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Add Property"]})})]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${k?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-sm text-muted-foreground",children:k?"Real-time property updates active":"Offline mode"}),E&&e.jsxs(b,{variant:"secondary",className:"text-xs",children:["Last update: ",d.formatTimeAgo(E.timestamp)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"}),"Loading properties..."]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:P,disabled:y,children:[e.jsx(Q,{className:`w-4 h-4 mr-2 ${y?"animate-spin":""}`}),y?"Refreshing...":"Refresh"]})]})]}),!j&&o&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4",children:[e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:o.totalProperties||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Properties"})]})})}),e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:o.activeProperties||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active"})]})})}),e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:o.rentedProperties||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rented"})]})})}),e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:o.soldProperties||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sold"})]})})}),e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:(o.totalViews||0).toLocaleString()}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Views"})]})})}),e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:o.totalInquiries||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Inquiries"})]})})}),e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:o.totalFavorites||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Favorites"})]})})})]}),e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(J,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(X,{type:"text",placeholder:"Search properties...",className:"pl-10",value:u,onChange:s=>F(s.target.value)})]}),e.jsxs($,{value:m,onValueChange:R,children:[e.jsx(B,{className:"w-full sm:w-40",children:e.jsx(H,{placeholder:"Status"})}),e.jsxs(O,{children:[e.jsx(r,{value:"all",children:"All Status"}),e.jsx(r,{value:"active",children:"Active"}),e.jsx(r,{value:"rented",children:"Rented"}),e.jsx(r,{value:"sold",children:"Sold"}),e.jsx(r,{value:"pending",children:"Under Review"}),e.jsx(r,{value:"draft",children:"Draft"}),e.jsx(r,{value:"inactive",children:"Inactive"})]})]}),e.jsxs($,{value:x,onValueChange:V,children:[e.jsx(B,{className:"w-full sm:w-40",children:e.jsx(H,{placeholder:"Type"})}),e.jsxs(O,{children:[e.jsx(r,{value:"all",children:"All Types"}),e.jsx(r,{value:"apartment",children:"Apartment"}),e.jsx(r,{value:"villa",children:"Villa"}),e.jsx(r,{value:"house",children:"House"}),e.jsx(r,{value:"plot",children:"Plot"}),e.jsx(r,{value:"land",children:"Land"}),e.jsx(r,{value:"commercial",children:"Commercial"}),e.jsx(r,{value:"office",children:"Office"}),e.jsx(r,{value:"pg",children:"PG (Paying Guest)"})]})]})]})})}),!j&&e.jsx("div",{className:"space-y-4",children:D.map(s=>e.jsx(i,{className:"overflow-hidden",children:e.jsx(n,{className:"p-0",children:e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[e.jsxs("div",{className:"lg:w-64 h-48 lg:h-auto bg-muted relative",children:[s.images.length>0?e.jsx("img",{src:d.getPrimaryImage(s),alt:s.title,className:"w-full h-full object-cover",onError:t=>{t.currentTarget.style.display="none",t.currentTarget.nextElementSibling?.classList.remove("hidden")}}):null,e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/20 to-transparent flex items-center justify-center",children:e.jsx(re,{className:"w-12 h-12 text-muted-foreground"})}),e.jsxs("div",{className:"absolute top-3 left-3 flex gap-2",children:[e.jsx(b,{className:`${d.getStatusColor(s.status)} text-white`,children:d.getStatusText(s.status)}),s.featured&&e.jsx(b,{variant:"secondary",children:"Featured"}),s.verified&&e.jsx(b,{className:"bg-green-600 text-white",children:"Verified"})]}),e.jsxs("div",{className:"absolute bottom-3 left-3 bg-black/70 text-white px-2 py-1 rounded text-sm",children:[s.images.length," photos"]})]}),e.jsxs("div",{className:"flex-1 p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-1",children:s.title}),e.jsxs("div",{className:"flex items-center gap-4 text-muted-foreground text-sm mb-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"w-4 h-4"}),s.address.city,", ",s.address.state]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"w-4 h-4"}),"Posted ",d.formatTimeAgo(s.postedDate)]})]}),e.jsx("p",{className:"text-muted-foreground text-sm line-clamp-2 mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsx("span",{children:d.formatArea(s.area)}),e.jsxs("span",{children:[s.bedrooms," BHK"]}),e.jsx("span",{className:"capitalize",children:s.listingType})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-primary mb-2",children:d.formatPrice(s.price,s.listingType)}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsx(c,{variant:"ghost",size:"sm",children:e.jsx(ie,{className:"w-4 h-4"})})}),e.jsxs(te,{align:"end",children:[e.jsxs(p,{children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"View Property"]}),e.jsxs(p,{children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Edit Property"]}),e.jsxs(p,{children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Analytics"]}),e.jsxs(p,{children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Promote"]}),e.jsxs(p,{className:"text-red-600",onClick:()=>U(s._id),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4 p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx(T,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-semibold",children:s.views})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Views"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx(_,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-semibold",children:s.inquiries})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Inquiries"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx(ae,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-semibold",children:s.favorites})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Favorites"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx(I,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["+",s.analytics.weeklyViews]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This Week"})]})]}),s.status==="rented"&&s.rentedTo&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg mb-4",children:[e.jsx("h4",{className:"font-semibold text-blue-800 dark:text-blue-200 mb-2",children:"Rental Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Tenant: "}),e.jsx("span",{className:"font-medium",children:s.rentedTo.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Start Date: "}),e.jsx("span",{className:"font-medium",children:new Date(s.rentedTo.rentStart).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"End Date: "}),e.jsx("span",{className:"font-medium",children:new Date(s.rentedTo.rentEnd).toLocaleDateString()})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(c,{size:"sm",variant:"outline",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"View"]}),e.jsxs(c,{size:"sm",variant:"outline",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Edit"]}),e.jsxs(c,{size:"sm",variant:"outline",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Messages (",s.inquiries,")"]}),e.jsxs(c,{size:"sm",variant:"outline",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Analytics"]}),s.status==="active"&&e.jsxs(c,{size:"sm",className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Promote"]})]})]})]})})},s._id))}),j&&e.jsx(i,{children:e.jsx(n,{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Loading your properties..."})]})})}),!j&&D.length===0&&e.jsx(i,{children:e.jsxs(n,{className:"p-12 text-center",children:[e.jsx(A,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:g.length===0?"No properties found":"No properties match your filters"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:g.length===0?"Start by adding your first property to get started.":"Try adjusting your search criteria or clear some filters."}),e.jsx("div",{className:"flex gap-2 justify-center",children:g.length===0?e.jsx(c,{asChild:!0,children:e.jsxs(M,{to:"/customer/post-property",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Add Your First Property"]})}):e.jsx(c,{variant:"outline",onClick:()=>{F(""),R("all"),V("all")},children:"Clear Filters"})})]})})]})};export{Te as default};

import{j as e}from"./ui-BHyUY8Z8.js";import{r as l}from"./router-2SVJvIbS.js";import{W as _,f as u,V as G,a as x,b as j,c as p,e as m,U as T,E as D,Y as X,I as E,$ as Z,a0 as ee,a1 as B,am as se,an as R,B as v,d as te,J as A,K as O,O as k,Q as F,R as V,L as g,q as ae,s as I,v as L,w as U,x as M,y as r,ap as ie,r as le}from"./index-Bd1eLXM_.js";import{S as $}from"./send-DXGW9Fle.js";import"./vendor-Dazix4UH.js";const xe=()=>{const[n,z]=l.useState([]),[P,b]=l.useState(!0),[f,W]=l.useState(""),[o,q]=l.useState("sent"),[t,H]=l.useState(null),[J,y]=l.useState(!1),[K,h]=l.useState(!1),[Q,C]=l.useState(!1),{toast:c}=_(),[a,d]=l.useState({title:"",message:"",type:"info",recipients:"all"});l.useEffect(()=>{w()},[o,f]);const w=async()=>{try{b(!0);const s=await fetch(`/api/subadmin/notifications?status=${o}&search=${f}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(s.ok){const i=await s.json();z(i.data.notifications)}else c({title:"Error",description:"Failed to fetch notifications",variant:"destructive"})}catch{c({title:"Error",description:"Error fetching notifications",variant:"destructive"})}finally{b(!1)}},Y=async()=>{if(!a.title.trim()||!a.message.trim()){c({title:"Validation Error",description:"Please fill in all required fields",variant:"destructive"});return}try{C(!0),(await fetch("/api/subadmin/notifications/send",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify(a)})).ok?(c({title:"Success",description:"Notification sent successfully"}),h(!1),d({title:"",message:"",type:"info",recipients:"all"}),w()):c({title:"Error",description:"Failed to send notification",variant:"destructive"})}catch{c({title:"Error",description:"Failed to send notification",variant:"destructive"})}finally{C(!1)}},N=s=>{switch(s){case"info":return{label:"Info",class:"bg-blue-600"};case"warning":return{label:"Warning",class:"bg-yellow-600"};case"success":return{label:"Success",class:"bg-green-600"};case"error":return{label:"Error",class:"bg-red-600"};default:return{label:s,class:"bg-gray-600"}}},S=s=>{switch(s){case"vendors":return e.jsx(le,{className:"h-4 w-4"});case"customers":return e.jsx(T,{className:"h-4 w-4"});default:return e.jsx(R,{className:"h-4 w-4"})}};return P&&n.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Notifications"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage and send system notifications"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"},s))})]}):e.jsxs("div",{className:"p-6 space-y-6 mt-16",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Notifications"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage and send system notifications"})]}),e.jsxs(u,{onClick:()=>h(!0),children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Send Notification"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(x,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Total Sent"}),e.jsx($,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.filter(s=>s.status==="sent").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Notifications sent"})]})]}),e.jsxs(x,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Total Recipients"}),e.jsx(T,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold",children:n.reduce((s,i)=>s+i.recipientCount,0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Users notified"})]})]}),e.jsxs(x,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Read Rate"}),e.jsx(D,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[n.length>0?Math.round(n.reduce((s,i)=>s+i.readCount,0)/n.reduce((s,i)=>s+i.recipientCount,0)*100):0,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Average read rate"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(E,{placeholder:"Search notifications...",value:f,onChange:s=>W(s.target.value),className:"pl-10"})]}),e.jsxs(Z,{value:o,onValueChange:q,children:[e.jsxs(ee,{children:[e.jsx(B,{value:"sent",children:"Sent"}),e.jsx(B,{value:"draft",children:"Drafts"})]}),e.jsx(se,{value:o,className:"space-y-4 mt-6",children:n.length===0?e.jsx(x,{children:e.jsxs(m,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(R,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Notifications Found"}),e.jsx("p",{className:"text-muted-foreground text-center",children:o==="sent"?"No notifications have been sent yet":"No draft notifications available"})]})}):n.map(s=>{const i=N(s.type);return e.jsxs(x,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"text-lg",children:s.title}),e.jsx(v,{className:i.class,children:i.label})]}),e.jsx(te,{children:e.jsx("p",{className:"line-clamp-2",children:s.message})}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[S(s.recipients),"Recipients: ",s.recipients==="all"?"All Users":s.recipients.charAt(0).toUpperCase()+s.recipients.slice(1)]}),e.jsxs("span",{children:["• ",s.recipientCount," users"]}),s.status==="sent"&&e.jsxs("span",{children:["• ",s.readCount," read (",Math.round(s.readCount/s.recipientCount*100),"%)"]})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleDateString()}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["By: ",s.sentBy.name]})]})]})}),e.jsx(m,{children:e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>{H(s),y(!0)},children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"View Details"]})})]},s._id)})})]}),e.jsx(A,{open:J,onOpenChange:y,children:e.jsxs(O,{className:"max-w-2xl",children:[e.jsxs(k,{children:[e.jsx(F,{children:"Notification Details"}),e.jsx(V,{children:"Detailed information about the notification"})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Title"}),e.jsx("p",{children:t.title})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Message"}),e.jsx("div",{className:"bg-muted p-4 rounded-lg",children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.message})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Type"}),e.jsx(v,{className:N(t.type).class,children:N(t.type).label})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Status"}),e.jsx(v,{children:t.status})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Recipients"}),e.jsxs("p",{className:"text-sm flex items-center gap-2",children:[S(t.recipients),t.recipients==="all"?"All Users":t.recipients.charAt(0).toUpperCase()+t.recipients.slice(1)]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Recipient Count"}),e.jsxs("p",{className:"text-sm",children:[t.recipientCount," users"]})]})]}),t.status==="sent"&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Engagement"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950 p-4 rounded-lg text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:t.readCount}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Read"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-950 p-4 rounded-lg text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-gray-600",children:[Math.round(t.readCount/t.recipientCount*100),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Read Rate"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Sent By"}),e.jsx("p",{className:"text-sm",children:t.sentBy.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(t.createdAt).toLocaleString()})]})]})]})}),e.jsx(A,{open:K,onOpenChange:h,children:e.jsxs(O,{className:"max-w-2xl",children:[e.jsxs(k,{children:[e.jsx(F,{children:"Send New Notification"}),e.jsx(V,{children:"Create and send a notification to users"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"title",children:"Title *"}),e.jsx(E,{id:"title",placeholder:"Enter notification title",value:a.title,onChange:s=>d({...a,title:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"message",children:"Message *"}),e.jsx(ae,{id:"message",placeholder:"Enter notification message",value:a.message,onChange:s=>d({...a,message:s.target.value}),rows:4})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"type",children:"Type"}),e.jsxs(I,{value:a.type,onValueChange:s=>d({...a,type:s}),children:[e.jsx(L,{children:e.jsx(U,{})}),e.jsxs(M,{children:[e.jsx(r,{value:"info",children:"Info"}),e.jsx(r,{value:"success",children:"Success"}),e.jsx(r,{value:"warning",children:"Warning"}),e.jsx(r,{value:"error",children:"Error"})]})]})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"recipients",children:"Recipients"}),e.jsxs(I,{value:a.recipients,onValueChange:s=>d({...a,recipients:s}),children:[e.jsx(L,{children:e.jsx(U,{})}),e.jsxs(M,{children:[e.jsx(r,{value:"all",children:"All Users"}),e.jsx(r,{value:"vendors",children:"Vendors Only"}),e.jsx(r,{value:"customers",children:"Customers Only"})]})]})]})]})]}),e.jsxs(ie,{children:[e.jsx(u,{variant:"outline",onClick:()=>{h(!1),d({title:"",message:"",type:"info",recipients:"all"})},children:"Cancel"}),e.jsxs(u,{onClick:Y,disabled:Q,children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Send Notification"]})]})]})})]})};export{xe as default};

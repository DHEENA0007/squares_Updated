import{j as e}from"./ui-s1SEoZIF.js";import{r as s}from"./router-D8v2YSKU.js";import{a5 as t,a,b as d,c as r,z as l,e as n,_ as i,a2 as c,I as o,ah as m,ai as x,aj as u,ak as h,B as p,d as g,f as j,E as v,a7 as N,a8 as b,a9 as f,aa as y,ab as w,L as S,T as k,ag as D}from"./index-l5vY_naC.js";import{f as A,h as C}from"./apiUtils-B8LmEMCW.js";import{C as _}from"./calendar-Di9eH8o8.js";import"./vendor-BxThA0WO.js";const E=(e,s="INR")=>new Intl.NumberFormat("en-IN",{style:"currency",currency:s,minimumFractionDigits:0}).format(e),L=e=>{const s={photography:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",videography:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300",virtual_tour:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",drone_photography:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300",floor_plan:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",staging:"bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-300",inspection:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",other:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"};return s[e]||s.other},P=()=>{const[P,F]=s.useState([]),[R,I]=s.useState(!0),[T,O]=s.useState(""),[V,$]=s.useState("active"),[U,z]=s.useState(null),[M,B]=s.useState(!1),[q,H]=s.useState(!1),[J,W]=s.useState(!1),[G,K]=s.useState(null),[Q,X]=s.useState(""),[Y,Z]=s.useState(""),[ee,se]=s.useState(""),[te,ae]=s.useState({}),[de,re]=s.useState(null),[le,ne]=s.useState(""),[ie,ce]=s.useState(""),[oe,me]=s.useState(""),[xe,ue]=s.useState(""),[he,pe]=s.useState(""),[ge,je]=s.useState("medium"),{toast:ve}=t();s.useEffect(()=>{Ne()},[V,T]);const Ne=async()=>{try{I(!0);const e=await A(`/subadmin/addon-services?status=${V}&search=${T}`),s=await C(e);F(s.data.vendorAddons||[])}catch(e){ve({title:"Error",description:e.message||"Error fetching addon services",variant:"destructive"}),F([])}finally{I(!1)}},be=async e=>{K(e),je("medium"),se(""),X(`Schedule ${e.name} Service`),Z(`Dear Vendor,\n\nWe would like to schedule the ${e.name} service that you have purchased.\n\nPlease confirm the scheduled date and time for the service.\n\nService Details:\n- Name: ${e.name}\n- Description: ${e.description}\n- Category: ${e.category.charAt(0).toUpperCase()+e.category.slice(1)}\n\nThank you!\n\nBest regards,\nAdmin Team`),H(!0)},fe=e=>{re(e),ne(e.status),ce(e.scheduledDate?new Date(e.scheduledDate).toISOString().slice(0,16):""),me(e.vendorResponse||""),ue(e.cancellationReason||""),W(!0)},ye=e=>{switch(e){case"completed":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"in_progress":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"scheduled":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200";case"cancelled":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200"}},we=e=>{switch(e){case"urgent":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";case"high":return"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200";case"medium":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";default:return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"}};return R&&0===P.length?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Addon Services"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage vendor addon services and schedule appointments"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Addon Services"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"View vendors who have purchased addon services and schedule appointments"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs(a,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Active Vendors"}),e.jsx(l,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(n,{children:e.jsx("div",{className:"text-2xl font-bold",children:P.filter(e=>e.totalAddons>0).length})})]}),e.jsxs(a,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Total Addons"}),e.jsx(i,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(n,{children:e.jsx("div",{className:"text-2xl font-bold",children:P.reduce((e,s)=>e+s.totalAddons,0)})})]}),e.jsxs(a,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Scheduled"}),e.jsx(_,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:P.reduce((e,s)=>e+(s.schedules?.length||0),0)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[P.reduce((e,s)=>e+(s.schedules?.filter(e=>"completed"===e.status).length||0),0)," completed"]})]})]}),e.jsxs(a,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"In Progress"}),e.jsx(i,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:P.reduce((e,s)=>e+(s.schedules?.filter(e=>"in_progress"===e.status).length||0),0)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[P.reduce((e,s)=>e+(s.schedules?.filter(e=>"scheduled"===e.status).length||0),0)," scheduled"]})]})]}),e.jsxs(a,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Categories"}),e.jsx(i,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(n,{children:e.jsx("div",{className:"text-2xl font-bold",children:new Set(P.flatMap(e=>e.activeAddons.map(e=>e.category))).size})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(o,{placeholder:"Search vendors...",value:T,onChange:e=>O(e.target.value),className:"pl-10"})]}),e.jsxs(m,{value:V,onValueChange:$,children:[e.jsxs(x,{children:[e.jsx(u,{value:"active",children:"Active Subscriptions"}),e.jsx(u,{value:"expired",children:"Expired"}),e.jsx(u,{value:"all",children:"All Vendors"})]}),e.jsx(h,{value:V,className:"space-y-4 mt-6",children:0===P.length?e.jsx(a,{children:e.jsxs(n,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(i,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Addon Services Found"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"active"===V?"No vendors with active addon subscriptions":`No vendors with ${V} addon subscriptions`})]})}):P.map(s=>e.jsxs(a,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(r,{className:"text-lg",children:[s.user.profile.firstName," ",s.user.profile.lastName]}),e.jsxs(p,{variant:"outline",children:[s.totalAddons," Addon",1!==s.totalAddons?"s":""]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{className:"text-sm",children:s.user.email}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.activeAddons.slice(0,3).map(s=>e.jsx(p,{className:L(s.category),children:s.name},s._id)),s.activeAddons.length>3&&e.jsxs(p,{variant:"outline",children:["+",s.activeAddons.length-3," more"]})]})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Value"}),e.jsx("div",{className:"text-xl font-bold text-primary",children:E(s.activeAddons.reduce((e,s)=>e+s.price,0))})]})]})}),e.jsxs(n,{children:[s.schedules&&s.schedules.length>0&&e.jsxs("div",{className:"mb-4 space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold mb-2",children:["Scheduled Services (",s.schedules.length,")"]}),e.jsx("div",{className:"space-y-2",children:s.schedules.map(s=>e.jsxs("div",{className:"bg-muted/50 p-3 rounded-md border border-border hover:bg-muted transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm",children:s.addon.name}),e.jsx(p,{className:L(s.addon.category),variant:"outline",children:s.addon.category})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:ye(s.status),children:s.status.replace("_"," ")}),e.jsx(p,{className:we(s.priority),children:s.priority})]}),s.scheduledDate&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Scheduled: ",new Date(s.scheduledDate).toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Created: ",new Date(s.createdAt).toLocaleDateString()]})]}),e.jsx(j,{size:"sm",variant:"outline",onClick:()=>fe(s),children:"Update Status"})]}),s.notes&&s.notes.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-border/50",children:[e.jsx("p",{className:"text-xs font-medium mb-1",children:"Latest Note:"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.notes[s.notes.length-1].message}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["- ",s.notes[s.notes.length-1].author.profile.firstName," on ",new Date(s.notes[s.notes.length-1].createdAt).toLocaleDateString()]})]})]},s._id))})]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>{z(s),B(!0)},className:"w-full",children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"View All Details & Schedule"]})]})]},s._id))})]}),e.jsx(N,{open:M,onOpenChange:B,children:e.jsxs(b,{className:"max-w-3xl",children:[e.jsxs(f,{children:[e.jsx(y,{children:"Vendor Addon Services"}),e.jsx(w,{children:"Detailed information about vendor's purchased addon services"})]}),U&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Vendor Information"}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("p",{className:"font-medium",children:[U.user.profile.firstName," ",U.user.profile.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:U.user.email}),e.jsxs("p",{className:"text-sm mt-2",children:[e.jsx("strong",{children:"Total Addons:"})," ",U.totalAddons]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Active Addon Services"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:U.activeAddons.map(s=>{const t=U.schedules?.find(e=>e.addon._id===s._id&&["scheduled","in_progress"].includes(e.status)),l=!!t;return e.jsxs(a,{className:"hover:shadow-md transition-shadow",children:[e.jsx(d,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(r,{className:"text-sm",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(p,{className:L(s.category),children:s.category}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.billingType.replace("_"," ")}),l&&e.jsx(p,{className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:"Scheduled"})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"font-bold text-primary",children:E(s.price,s.currency)})})]})}),e.jsxs(n,{className:"pt-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:s.description}),l?e.jsxs(j,{size:"sm",className:"w-full bg-amber-500 hover:bg-amber-600 text-white",onClick:()=>{B(!1),be(s)},children:[e.jsx(_,{className:"h-3 w-3 mr-2"}),"Re-schedule Service"]}):e.jsxs(j,{size:"sm",className:"w-full",onClick:()=>{B(!1),be(s)},children:[e.jsx(_,{className:"h-3 w-3 mr-2"}),"Schedule This Service"]})]})]},s._id)})})]}),U.schedules&&U.schedules.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-4",children:["Service Schedules (",U.schedules.length,")"]}),e.jsx("div",{className:"space-y-3",children:U.schedules.map(s=>e.jsx(a,{className:"hover:shadow-md transition-shadow",children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.addon.name}),e.jsx(p,{className:ye(s.status),children:s.status.replace("_"," ")}),e.jsx(p,{className:we(s.priority),variant:"outline",children:s.priority})]}),s.scheduledDate&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["ðŸ“… ",new Date(s.scheduledDate).toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Created: ",new Date(s.createdAt).toLocaleDateString()]}),s.notes&&s.notes.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t",children:[e.jsx("p",{className:"text-xs font-medium",children:"Latest Note:"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.notes[s.notes.length-1].message.substring(0,100),s.notes[s.notes.length-1].message.length>100?"...":""]})]})]}),e.jsx(j,{size:"sm",variant:"outline",onClick:()=>{B(!1),fe(s)},children:"Manage"})]})})},s._id))})]}),U.subscriptions.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Subscription History"}),e.jsx("div",{className:"space-y-2",children:U.subscriptions.map(s=>e.jsx("div",{className:"bg-muted p-3 rounded-lg text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium",children:["Status: ",e.jsx(p,{variant:"active"===s.status?"default":"secondary",children:s.status})]}),e.jsxs("span",{className:"text-muted-foreground",children:[new Date(s.startDate).toLocaleDateString()," - ",new Date(s.endDate).toLocaleDateString()]})]})},s._id))})]})]})]})}),e.jsx(N,{open:q,onOpenChange:H,children:e.jsxs(b,{className:"max-w-2xl",children:[e.jsxs(f,{children:[e.jsx(y,{children:"Schedule Addon Service"}),e.jsx(w,{children:"Send a scheduling email to the vendor for their purchased addon service"})]}),U&&G&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("p",{className:"font-medium",children:["Vendor: ",U.user.profile.firstName," ",U.user.profile.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:U.user.email}),e.jsxs("p",{className:"text-sm mt-1",children:[e.jsx("strong",{children:"Service:"})," ",G.name]})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"subject",children:"Email Subject"}),e.jsx(o,{id:"subject",value:Q,onChange:e=>X(e.target.value),placeholder:"Enter email subject"})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"priority",children:"Priority"}),e.jsxs("select",{id:"priority",value:ge,onChange:e=>je(e.target.value),className:"w-full p-2 border rounded-md",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"scheduledDate",children:"Scheduled Service Date & Time *"}),e.jsx(o,{id:"scheduledDate",type:"datetime-local",value:ee,onChange:e=>se(e.target.value),min:(new Date).toISOString().slice(0,16),className:"w-full",required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Select when this service will be performed"})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"message",children:"Email Message"}),e.jsx(k,{id:"message",value:Y,onChange:e=>Z(e.target.value),placeholder:"Enter email message",rows:8})]})]}),e.jsxs(D,{children:[e.jsx(j,{variant:"outline",onClick:()=>H(!1),children:"Cancel"}),e.jsx(j,{onClick:async()=>{if(!U||!G)return;if(!ee)return void ve({title:"Error",description:"Please select a scheduled date for the service",variant:"destructive"});const e=U.subscriptions.find(e=>e.addons.some(e=>e._id===G._id));if(e)try{ae({...te,email:!0});const s=await A("/subadmin/addon-services/schedule",{method:"POST",body:JSON.stringify({vendorId:U.user._id,addonId:G._id,subscriptionId:e._id,subject:Q,message:Y,vendorEmail:U.user.email,priority:ge,scheduledDate:ee})});await C(s);ve({title:"Success",description:"Service scheduled successfully and email sent to vendor"}),H(!1),K(null),se(""),Ne()}catch(s){ve({title:"Error",description:s.message||"Failed to schedule service",variant:"destructive"})}finally{ae({...te,email:!1})}else ve({title:"Error",description:"No subscription found for this addon",variant:"destructive"})},disabled:te.email||!Q||!Y||!ee,children:te.email?"Scheduling...":"Schedule & Send Email"})]})]})}),e.jsx(N,{open:J,onOpenChange:W,children:e.jsxs(b,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(f,{children:[e.jsx(y,{children:"Manage Service Schedule"}),e.jsx(w,{children:"Update status, add notes, and track service progress"})]}),de&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-lg",children:de.addon.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:ye(de.status),children:de.status.replace("_"," ")}),e.jsx(p,{className:we(de.priority),children:de.priority})]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Scheduled by: ",de.scheduledBy.profile.firstName," ",de.scheduledBy.profile.lastName," (",de.scheduledBy.email,")"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Created: ",new Date(de.createdAt).toLocaleString()]}),de.scheduledDate&&e.jsxs("p",{className:"text-sm font-semibold text-green-600 dark:text-green-400",children:["ðŸ—“ï¸ Service Date: ",new Date(de.scheduledDate).toLocaleString()]}),de.inProgressAt&&e.jsxs("p",{className:"text-sm font-semibold text-blue-600 dark:text-blue-400",children:["ðŸ”„ Started: ",new Date(de.inProgressAt).toLocaleString()]}),de.completedAt&&e.jsxs("p",{className:"text-sm font-semibold text-green-700 dark:text-green-300",children:["âœ“ Completed: ",new Date(de.completedAt).toLocaleString()]}),de.cancelledAt&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-sm font-semibold text-red-600 dark:text-red-400",children:["âœ— Cancelled: ",new Date(de.cancelledAt).toLocaleString()]}),de.cancellationReason&&e.jsxs("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1 p-2 bg-red-50 dark:bg-red-950 rounded",children:["Reason: ",de.cancellationReason]})]}),e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-2 p-2 bg-amber-50 dark:bg-amber-950 rounded",children:"âš ï¸ Status updates will automatically send email notifications to the vendor"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Original Email"}),e.jsxs("div",{className:"bg-muted/50 p-3 rounded-md space-y-2 border",children:[e.jsx("p",{className:"font-medium text-sm",children:de.emailSubject}),e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:de.emailMessage})]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold",children:"Update Status"}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",value:le,onChange:e=>ne(e.target.value),className:"w-full p-2 border rounded-md",disabled:"completed"===de?.status||"cancelled"===de?.status,children:[e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}),("completed"===de?.status||"cancelled"===de?.status)&&e.jsxs("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-1",children:["âš ï¸ Cannot change status from ",de.status]}),de?.scheduledDate&&("in_progress"===le||"completed"===le)&&(new Date(de.scheduledDate)>new Date?e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1 p-2 bg-red-50 dark:bg-red-950 rounded",children:['âš ï¸ Cannot mark as "',le.replace("_"," "),'" before scheduled date (',new Date(de.scheduledDate).toLocaleString(),")"]}):e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:"âœ“ Service date has passed, can proceed"}))]}),"cancelled"===le&&e.jsxs("div",{children:[e.jsx(S,{htmlFor:"cancellationReason",children:"Cancellation Reason *"}),e.jsx(k,{id:"cancellationReason",value:xe,onChange:e=>ue(e.target.value),placeholder:"Please provide the reason for cancellation...",rows:3,required:!0,className:"border-red-300 focus:border-red-500"}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:"* Cancellation reason is required. Email will be sent to vendor."})]}),"in_progress"===le&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950 p-3 rounded-md border border-blue-200 dark:border-blue-800",children:[e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:'ðŸ”„ "In Progress" timestamp will be automatically recorded and vendor will be notified via email'}),de?.inProgressAt&&e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:["Started on: ",new Date(de.inProgressAt).toLocaleString()]})]}),"completed"===le&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-950 p-3 rounded-md border border-green-200 dark:border-green-800",children:[e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"âœ“ Completion date will be automatically set and vendor will receive completion email"}),de?.completedAt&&e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:["Completed on: ",new Date(de.completedAt).toLocaleString()]})]}),"completed"!==le&&"cancelled"!==le&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"scheduledDate",children:"in_progress"===le?"In Progress Since":"Scheduled Date & Time"}),e.jsx(o,{id:"scheduledDate",type:"datetime-local",value:ie,onChange:e=>ce(e.target.value),className:"w-full"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:de?.scheduledDate?`Current: ${new Date(de.scheduledDate).toLocaleString()}`:"Not set"}),ie&&ie!==new Date(de?.scheduledDate||"").toISOString().slice(0,16)&&e.jsx("p",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1 p-2 bg-orange-50 dark:bg-orange-950 rounded",children:"ðŸ“§ Re-scheduling email will be sent to vendor with new date"})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"vendorResponse",children:"Vendor Response/Notes"}),e.jsx(k,{id:"vendorResponse",value:oe,onChange:e=>me(e.target.value),placeholder:"Enter vendor response or status update notes...",rows:3})]})]}),e.jsx(j,{onClick:async()=>{if(de)if("cancelled"!==le||xe.trim())try{ae({...te,status:!0});const e=await A(`/subadmin/addon-services/schedule/${de._id}/status`,{method:"PATCH",body:JSON.stringify({status:le,scheduledDate:ie||void 0,vendorResponse:oe||void 0,cancellationReason:"cancelled"===le?xe:void 0})});await C(e),ve({title:"Success",description:"cancelled"===le?"Service cancelled successfully":"completed"===le?"Service marked as completed":"Schedule status updated successfully"}),W(!1),re(null),ue(""),Ne()}catch(e){ve({title:"Error",description:e.message||"Failed to update schedule status",variant:"destructive"})}finally{ae({...te,status:!1})}else ve({title:"Validation Error",description:"Please provide a cancellation reason",variant:"destructive"})},disabled:te.status||"completed"===de?.status||"cancelled"===de?.status||"cancelled"===le&&!xe.trim(),className:"w-full",children:te.status?"Updating...":"Update Status & Send Email"})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold",children:"Communication Notes"}),de.notes&&de.notes.length>0&&e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Previous notes:"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:de.notes.map((s,t)=>e.jsxs("div",{className:"bg-muted/50 p-3 rounded-md border text-sm",children:[e.jsx("p",{className:"whitespace-pre-wrap",children:s.message}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["- ",s.author.profile.firstName," ",s.author.profile.lastName," on ",new Date(s.createdAt).toLocaleString()]})]},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"newNote",children:"Add New Note"}),e.jsx(k,{id:"newNote",value:he,onChange:e=>pe(e.target.value),placeholder:"Add a communication note or update...",rows:3}),e.jsx(j,{onClick:async()=>{if(de&&he.trim())try{ae({...te,note:!0});const e=await A(`/subadmin/addon-services/schedule/${de._id}/notes`,{method:"POST",body:JSON.stringify({message:he})}),s=await C(e);ve({title:"Success",description:"Note added successfully"}),pe(""),s.data?.schedule&&re(s.data.schedule),Ne()}catch(e){ve({title:"Error",description:e.message||"Failed to add note",variant:"destructive"})}finally{ae({...te,note:!1})}},disabled:te.note||!he.trim(),variant:"outline",className:"w-full",children:te.note?"Adding...":"Add Note"})]})]})]}),e.jsx(D,{children:e.jsx(j,{variant:"outline",onClick:()=>W(!1),children:"Close"})})]})})]})};export{P as default};

import{j as e}from"./ui-DYmpZ3pJ.js";import{d as K,r as a}from"./router-2SVJvIbS.js";import{x as _,f as j,A as X,a as c,b as o,c as d,e as m,d as Y,B as x,S as Z,U as ee,Q as se,R as te,V as ae,a5 as le,a6 as T,W as S,t as F}from"./index-BbgqWuYN.js";import{D as ie,a as ne,b as re,c as ce,d as oe,e as de}from"./dialog-DsX3mE8Q.js";import{P as me,a as xe,b,c as he,d as ue,e as ge}from"./pagination-B81IIWK4.js";import{D as pe}from"./DataTable-Cs-k6Jh3.js";import{S as je}from"./SearchFilter-BrvzFCXm.js";import{r as C}from"./roleService-xLKxz4dp.js";import{L}from"./loader-circle-DtIJ61xE.js";import{E as fe}from"./ellipsis-hsdzzVqq.js";import{S as ve}from"./square-pen-uFfo4AcD.js";import{T as Ne}from"./trash-2-PyAegrM1.js";import"./vendor-Dazix4UH.js";import"./table-Cruer2y3.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=_("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=_("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),Ee=()=>{const D=K(),[f,M]=a.useState(""),[h,I]=a.useState("all"),[u,v]=a.useState([]),[E,w]=a.useState(!0),[l,n]=a.useState(1),[g,O]=a.useState(1),[N,P]=a.useState(0),[B,p]=a.useState(!1),[i,y]=a.useState(null),[R,A]=a.useState(!1),U=async()=>{try{w(!0);const s={page:l,limit:10,search:f||void 0,isActive:h==="all"?void 0:h==="active"},t=await C.getRoles(s);v(t.data.roles),O(t.data.pagination.totalPages),P(t.data.pagination.totalRoles)}catch(s){console.error("Failed to fetch roles:",s)}finally{w(!1)}};a.useEffect(()=>{U()},[l,f,h]);const H=s=>{M(s),n(1)},V=s=>{I(s),n(1)},W=s=>{n(s)},$=()=>{l<g&&n(l+1)},q=()=>{l>1&&n(l-1)},z=async s=>{try{const t=await C.toggleRoleStatus(s._id);v(r=>r.map(k=>k._id===t.data.role._id?t.data.role:k)),F({title:"Success",description:`Role ${t.data.role.isActive?"activated":"deactivated"} successfully!`})}catch(t){console.error("Failed to toggle role status:",t)}},Q=async()=>{if(i)try{A(!0),await C.deleteRole(i._id),p(!1);const s=i._id;y(null),v(t=>t.filter(r=>r._id!==s)),P(t=>t-1),F({title:"Success",description:"Role deleted successfully!"})}catch(s){console.error("Failed to delete role:",s)}finally{A(!1)}},G=s=>{y(s),p(!0)},J=[{key:"name",label:"Role Name",render:s=>e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[s.name,s.isSystemRole&&e.jsxs(x,{variant:"outline",className:"text-xs",children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"System"]})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description})]})},{key:"level",label:"Level",render:s=>e.jsxs(x,{variant:s.level>=8?"destructive":s.level>=5?"default":"secondary",children:["Level ",s.level]})},{key:"permissions",label:"Permissions",render:s=>e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.permissions.slice(0,2).map((t,r)=>e.jsx(x,{variant:"secondary",className:"text-xs",children:t.replace(/_/g," ")},r)),s.permissions.length>2&&e.jsxs(x,{variant:"secondary",className:"text-xs",children:["+",s.permissions.length-2]})]})},{key:"userCount",label:"Users",render:s=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:s.userCount||0})]})},{key:"isActive",label:"Status",render:s=>e.jsx(x,{variant:s.isActive?"default":"secondary",children:s.isActive?"Active":"Inactive"})},{key:"actions",label:"Actions",render:s=>e.jsxs(se,{children:[e.jsx(te,{asChild:!0,children:e.jsxs(j,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(fe,{className:"w-4 h-4"})]})}),e.jsxs(ae,{align:"end",className:"w-48",children:[e.jsx(le,{children:"Actions"}),e.jsx(T,{}),e.jsxs(S,{onClick:t=>{t.stopPropagation(),D(`/admin/roles/edit/${s._id}`)},disabled:s.isSystemRole,className:"cursor-pointer",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Edit Role"]}),e.jsxs(S,{onClick:t=>{t.stopPropagation(),z(s)},disabled:s.isSystemRole&&s.isActive,className:"cursor-pointer",children:[s.isActive?e.jsx(ye,{className:"w-4 h-4 mr-2"}):e.jsx(Re,{className:"w-4 h-4 mr-2"}),s.isActive?"Deactivate":"Activate"]}),e.jsx(T,{}),e.jsxs(S,{onClick:t=>{t.stopPropagation(),G(s)},disabled:s.isSystemRole,className:"text-destructive focus:text-destructive cursor-pointer",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Delete Role"]})]})]})}];return E?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(L,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading roles..."})]}):e.jsxs("div",{className:"space-y-6 relative top-[60px]",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Role Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage user roles and permissions"})]}),e.jsxs(j,{onClick:()=>D("/admin/roles/add"),className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Add New Role"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs(c,{children:[e.jsx(o,{className:"pb-1",children:e.jsx(d,{className:"text-xs font-medium text-gray-600",children:"Total Roles"})}),e.jsx(m,{className:"pt-1",children:e.jsx("div",{className:"text-lg sm:text-xl font-bold",children:N})})]}),e.jsxs(c,{children:[e.jsx(o,{className:"pb-1",children:e.jsx(d,{className:"text-xs font-medium text-gray-600",children:"Active Roles"})}),e.jsx(m,{className:"pt-1",children:e.jsx("div",{className:"text-lg sm:text-xl font-bold text-green-600",children:u.filter(s=>s.isActive).length})})]}),e.jsxs(c,{children:[e.jsx(o,{className:"pb-1",children:e.jsx(d,{className:"text-xs font-medium text-gray-600",children:"System Roles"})}),e.jsx(m,{className:"pt-1",children:e.jsx("div",{className:"text-lg sm:text-xl font-bold text-blue-600",children:u.filter(s=>s.isSystemRole).length})})]}),e.jsxs(c,{children:[e.jsx(o,{className:"pb-1",children:e.jsx(d,{className:"text-xs font-medium text-gray-600",children:"Custom Roles"})}),e.jsx(m,{className:"pt-1",children:e.jsx("div",{className:"text-lg sm:text-xl font-bold text-purple-600",children:u.filter(s=>!s.isSystemRole).length})})]})]}),e.jsxs(c,{children:[e.jsxs(o,{children:[e.jsx(d,{children:"All Roles"}),e.jsxs(Y,{children:[N," role",N!==1?"s":""," found"]})]}),e.jsxs(m,{children:[e.jsx(je,{searchTerm:f,onSearchChange:H,filterValue:h,onFilterChange:V,filterOptions:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}],filterPlaceholder:"Filter by status"}),e.jsx(pe,{columns:J,data:u.map(s=>({...s,id:s._id})),hideDefaultActions:!0}),g>1&&e.jsx("div",{className:"mt-6",children:e.jsx(me,{children:e.jsxs(xe,{children:[e.jsx(b,{children:e.jsx(he,{onClick:q,className:l===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:g},(s,t)=>t+1).map(s=>e.jsx(b,{children:e.jsx(ue,{onClick:()=>W(s),isActive:l===s,className:"cursor-pointer",children:s})},s)),e.jsx(b,{children:e.jsx(ge,{onClick:$,className:l===g?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]}),e.jsx(ie,{open:B,onOpenChange:p,children:e.jsxs(ne,{children:[e.jsxs(re,{children:[e.jsx(ce,{children:"Delete Role"}),e.jsxs(oe,{children:['Are you sure you want to delete the role "',i?.name,'"? This action cannot be undone.',i?.userCount&&i.userCount>0&&e.jsxs("p",{className:"text-destructive mt-2",children:["Warning: This role is currently assigned to ",i.userCount," user(s)."]})]})]}),e.jsxs(de,{children:[e.jsx(j,{variant:"outline",onClick:()=>{p(!1),y(null)},disabled:R,children:"Cancel"}),e.jsx(j,{variant:"destructive",onClick:Q,disabled:R,children:R?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete Role"})]})]})})]})};export{Ee as default};

import{j as e}from"./ui-s1SEoZIF.js";import{r as s,d as a}from"./router-D8v2YSKU.js";import{u as t,a5 as r,a6 as l,f as i,ac as n,ah as d,ai as c,aj as o,ak as u,a7 as p,a8 as h,a9 as x,aa as m,ab as j,L as v,s as y,v as f,w as g,x as _,y as N,I as C,ag as F,a0 as w,ad as b,k as T,ae as E,af as L,al as S,a as k,e as A}from"./index-l5vY_naC.js";import{T as I,a as R,b as V,c as D,d as O,e as M}from"./table-S99XbycI.js";import{P}from"./pencil-CLkP3exa.js";import{A as U,a as z}from"./alert-CHp9jSHV.js";import"./vendor-BxThA0WO.js";const q=()=>{const{user:a}=t(),{toast:S}=r(),k=a?.rolePermissions||[],A="admin"===a?.role||"superadmin"===a?.role,U=e=>k.includes(e),z=A||U(w.FILTER_CREATE_NTP),q=A||U(w.FILTER_CREATE_FTO),B=A||U(w.FILTER_EDIT),Y=A||U(w.FILTER_DELETE),$=A||U(w.FILTER_STATUS),K=A||U(w.FILTER_ORDER),[G,H]=s.useState([]),[J,Q]=s.useState([]),[W,X]=s.useState(!0),[Z,ee]=s.useState(!1),[se,ae]=s.useState(!1),[te,re]=s.useState(null),[le,ie]=s.useState(""),[ne,de]=s.useState(""),[ce,oe]=s.useState(""),[ue,pe]=s.useState({filter_type:"",name:"",value:"",min_value:void 0,max_value:void 0,display_label:"",display_order:0});s.useEffect(()=>{he()},[]);const he=async()=>{try{X(!0);const e=await l.getAllFilterConfigurations(!0);H(e);const s=Array.from(new Set(e.map(e=>e.filterType))).sort();Q(s),!le&&s.length>0&&ie(s[0])}catch(e){S({title:"Error",description:"Failed to fetch filters",variant:"destructive"})}finally{X(!1)}},xe=e=>G.filter(s=>s.filterType===e),me=()=>{if(!ne.trim())return void S({title:"Error",description:"Please enter a filter type name",variant:"destructive"});const e=ne.toLowerCase().replace(/\s+/g,"_");J.includes(e)?S({title:"Error",description:"This filter type already exists",variant:"destructive"}):(Q([...J,e].sort()),ie(e),de(""),ae(!1),S({title:"Success",description:`Filter type "${ne}" created. You can now add filter options for it.`}))},je=e=>{if(e)re(e),pe({filter_type:e.filterType,name:e.name,value:e.value,min_value:e.minValue,max_value:e.maxValue,display_label:e.displayLabel,display_order:e.displayOrder});else{re(null);const e=xe(le);pe({filter_type:le,name:"",value:"",min_value:void 0,max_value:void 0,display_label:"",display_order:e.length})}ee(!0)},ve=()=>{ee(!1),re(null),pe({filter_type:"bedroom",name:"",value:"",min_value:void 0,max_value:void 0,display_label:"",display_order:0})},ye=async(e,s,a)=>{const t=xe(a),r=t.findIndex(s=>s._id===e);if("up"===s&&0===r||"down"===s&&r===t.length-1)return;const i=[...t],n="up"===s?r-1:r+1;[i[r],i[n]]=[i[n],i[r]];try{await Promise.all(i.map((e,s)=>l.updateFilterConfiguration(e._id,{display_order:s}))),he(),S({title:"Success",description:"Filters reordered successfully"})}catch(d){S({title:"Error",description:"Failed to reorder filters",variant:"destructive"})}},fe=s=>{const a=xe(s),t=a.filter(e=>e.name.toLowerCase().includes(ce.toLowerCase())||e.displayLabel?.toLowerCase().includes(ce.toLowerCase())||e.value.toLowerCase().includes(ce.toLowerCase())),r=()=>s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase());return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Manage ",r()," filter options"]}),q&&e.jsxs(i,{onClick:()=>je(),children:[e.jsx(n,{className:"h-4 w-4 mr-2"}),"Add ",r()," Option"]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(C,{placeholder:"Search filter options...",value:ce,onChange:e=>oe(e.target.value),className:"max-w-sm"})}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(I,{children:[e.jsx(R,{children:e.jsxs(V,{children:[e.jsx(D,{children:"Order"}),e.jsx(D,{children:"Name"}),e.jsx(D,{children:"Display Label"}),e.jsx(D,{children:"Value"}),"budget"===s&&e.jsxs(e.Fragment,{children:[e.jsx(D,{children:"Min Value"}),e.jsx(D,{children:"Max Value"})]}),e.jsx(D,{children:"Status"}),e.jsx(D,{className:"text-right",children:"Actions"})]})}),e.jsx(O,{children:0===t.length?e.jsx(V,{children:e.jsx(M,{colSpan:"budget"===s?8:6,className:"text-center py-8 text-muted-foreground",children:ce?"No filter options match your search.":"No filter options found. Create your first filter option to get started."})}):t.map((t,r)=>{const n=a.findIndex(e=>e._id===t._id);return e.jsxs(V,{children:[e.jsx(M,{children:K&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>ye(t._id,"up",s),disabled:0===n,children:e.jsx(b,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>ye(t._id,"down",s),disabled:n===a.length-1,children:e.jsx(T,{className:"h-4 w-4"})})]})}),e.jsx(M,{className:"font-medium",children:t.name}),e.jsx(M,{children:t.displayLabel||"-"}),e.jsx(M,{children:e.jsx("code",{className:"text-sm bg-muted px-2 py-1 rounded",children:t.value})}),"budget"===s&&e.jsxs(e.Fragment,{children:[e.jsx(M,{children:t.minValue||"-"}),e.jsx(M,{children:t.maxValue||"-"})]}),e.jsx(M,{children:e.jsx(E,{checked:t.isActive,onCheckedChange:()=>(async(e,s)=>{try{await l.updateFilterConfiguration(e,{isActive:!s}),S({title:"Success",description:`Filter ${s?"deactivated":"activated"} successfully`}),he()}catch(a){S({title:"Error",description:"Failed to update filter status",variant:"destructive"})}})(t._id,t.isActive),disabled:!$})}),e.jsx(M,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[B&&e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>je(t),children:e.jsx(P,{className:"h-4 w-4"})}),Y&&e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this filter? This action cannot be undone."))try{await l.deleteFilterConfiguration(e),S({title:"Success",description:"Filter deleted successfully"}),he()}catch(s){S({title:"Error",description:"Failed to delete filter",variant:"destructive"})}})(t._id),children:e.jsx(L,{className:"h-4 w-4 text-destructive"})})]})})]},t._id)})})]})})]})};return W?e.jsx("div",{className:"text-center py-8",children:"Loading filters..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Filter Configurations"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage filter options for property search and filtering"})]}),z&&e.jsxs(i,{onClick:()=>ae(!0),children:[e.jsx(n,{className:"h-4 w-4 mr-2"}),"New Filter Type"]})]}),0===J.length?e.jsxs("div",{className:"border rounded-lg p-8 text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"No filter types found. Create your first filter type to get started."}),z&&e.jsxs(i,{onClick:()=>ae(!0),children:[e.jsx(n,{className:"h-4 w-4 mr-2"}),"Create First Filter Type"]})]}):e.jsxs(d,{value:le,onValueChange:ie,children:[e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto",children:e.jsx(c,{className:"inline-flex",children:J.map(s=>e.jsx(o,{value:s,children:s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())},s))})}),J.map(s=>e.jsx(u,{value:s,children:fe(s)},s))]}),e.jsx(p,{open:Z,onOpenChange:ee,children:e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(m,{children:te?"Edit Filter":"Add Filter"}),e.jsx(j,{children:te?"Update the filter details below":"Create a new filter option"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"filter_type",children:"Filter Type"}),e.jsxs(y,{value:ue.filter_type,onValueChange:e=>pe({...ue,filter_type:e}),disabled:!!te,children:[e.jsx(f,{children:e.jsx(g,{})}),e.jsx(_,{children:J.map(s=>e.jsx(N,{value:s,children:s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"name",children:"Name *"}),e.jsx(C,{id:"name",value:ue.name,onChange:e=>pe({...ue,name:e.target.value}),placeholder:"e.g., For Sale",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"value",children:"Value (Unique ID) *"}),e.jsx(C,{id:"value",value:ue.value,onChange:e=>pe({...ue,value:e.target.value}),placeholder:"e.g., sale",disabled:!!te,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"display_label",children:"Display Label (Optional)"}),e.jsx(C,{id:"display_label",value:ue.display_label,onChange:e=>pe({...ue,display_label:e.target.value}),placeholder:"Defaults to Name if not provided"})]}),"budget"===ue.filter_type&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"min_value",children:"Min Value (₹)"}),e.jsx(C,{id:"min_value",type:"number",value:ue.min_value||"",onChange:e=>pe({...ue,min_value:e.target.value?parseFloat(e.target.value):void 0}),placeholder:"e.g., 2000000"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"max_value",children:"Max Value (₹)"}),e.jsx(C,{id:"max_value",type:"number",value:ue.max_value||"",onChange:e=>pe({...ue,max_value:e.target.value?parseFloat(e.target.value):void 0}),placeholder:"e.g., 4000000"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"display_order",children:"Display Order"}),e.jsx(C,{id:"display_order",type:"number",value:ue.display_order,onChange:e=>pe({...ue,display_order:parseInt(e.target.value)||0})})]})]}),e.jsxs(F,{children:[e.jsx(i,{variant:"outline",onClick:ve,children:"Cancel"}),e.jsx(i,{onClick:async()=>{try{te?(await l.updateFilterConfiguration(te._id,ue),S({title:"Success",description:"Filter updated successfully"})):(await l.createFilterConfiguration(ue),S({title:"Success",description:"Filter created successfully"})),he(),ve()}catch(e){S({title:"Error",description:te?"Failed to update filter":"Failed to create filter",variant:"destructive"})}},children:te?"Update":"Create"})]})]})}),e.jsx(p,{open:se,onOpenChange:ae,children:e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(m,{children:"Create New Filter Type"}),e.jsx(j,{children:"Create a new filter category to organize your property search filters"})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"newFilterTypeName",children:"Filter Type Name *"}),e.jsx(C,{id:"newFilterTypeName",value:ne,onChange:e=>de(e.target.value),placeholder:"e.g., Property Status, Location Type, Price Range",onKeyDown:e=>{"Enter"===e.key&&me()}}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'This will be converted to lowercase with underscores (e.g., "property_status")'})]})}),e.jsxs(F,{children:[e.jsx(i,{variant:"outline",onClick:()=>{ae(!1),de("")},children:"Cancel"}),e.jsx(i,{onClick:me,children:"Create Filter Type"})]})]})})]})},B=()=>{const{user:l}=t(),i=a(),{toast:n}=r(),d=l?.rolePermissions||[],c="admin"===l?.role||"superadmin"===l?.role||(o=w.FILTER_READ,d.includes(o));var o;return s.useEffect(()=>{c||(n({title:"Access Denied",description:"You don't have permission to view filter management.",variant:"destructive"}),i("/rolebased"))},[c,i,n]),c?e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(S,{className:"h-8 w-8"}),"Filter Management"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Configure search filters for the property search page"})]})}),e.jsx(U,{children:e.jsxs(z,{children:[e.jsx("strong",{children:"Note:"})," These filters appear on the customer property search page. Create dynamic filter types like Bedrooms, Budget, Listing Type, Furnishing, etc."]})}),e.jsx(k,{children:e.jsx(A,{className:"pt-6",children:e.jsx(q,{})})})]}):null};export{B as default};

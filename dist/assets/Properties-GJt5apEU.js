import{j as e}from"./ui-DHQhougw.js";import{d as s,r as a}from"./router-Bi51YGN-.js";import{z as t,y as r,t as i,Q as l,R as n,V as d,W as c,Y as o,h as m,B as p,at as u,au as h,av as x,$ as j,K as v,f as g,Z as f,a as y,b,c as N,e as w,d as P,L as S,T as C,a0 as F,aw as k,aa as R,ab as T,ac as A,am as E,an as $,ad as O,E as _,aq as q}from"./index-CV77Hym3.js";import{u as L}from"./usePagination-B0D_bLcL.js";import{P as V,a as D,b as z,c as U,d as I,e as M}from"./pagination-DCxMDQIb.js";import{D as B}from"./DataTable-BsJZjy2t.js";import{S as H}from"./SearchFilter-Cop-FNYN.js";import{A as J,b as W,c as K,d as Q,e as X,f as Y,g as Z,h as G}from"./alert-dialog-BmGjqxP-.js";import{S as ee}from"./separator-C82i-PkN.js";import{g as se}from"./propertyUtils-41DuwCMc.js";import{V as ae}from"./VirtualTourViewer-5__BLs0v.js";import{I as te}from"./indian-rupee-B37FDsaA.js";import{E as re}from"./ellipsis-Db7Kl15T.js";import{S as ie}from"./square-pen-DMwh3cy6.js";import{T as le}from"./trash-2-Da1AQ7FG.js";import"./vendor-eVk5PToZ.js";import"./table-Cpfq0CO9.js";import"./external-link-BfBdMaJl.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=t("StarOff",[["path",{d:"M8.34 8.34 2 9.27l5 4.87L5.82 21 12 17.77 18.18 21l-.59-3.43",key:"16m0ql"}],["path",{d:"M18.42 12.76 22 9.27l-6.91-1L12 2l-1.44 2.91",key:"1vt8nq"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);const de=new class{async makeRequest(e,s={}){const a=r.getToken(),t={headers:{"Content-Type":"application/json",...a&&{Authorization:`Bearer ${a}`},...s.headers},...s},i=await fetch(`https://api.buildhomemartsquares.com/api/admin${e}`,t);if(!i.ok){const e=await i.json().catch(()=>({}));throw new Error(e.message||`HTTP error! status: ${i.status}`)}return i.json()}async getProperties(e={}){try{const s=new URLSearchParams;Object.entries(e).forEach(([e,a])=>{null!=a&&""!==a&&s.append(e,String(a))});const a="/properties"+(s.toString()?`?${s.toString()}`:"");return await this.makeRequest(a)}catch(s){const e=s instanceof Error?s.message:"Failed to fetch properties";throw i({title:"Error",description:e,variant:"destructive"}),s}}async approveProperty(e){try{await this.makeRequest(`/properties/${e}/approve`,{method:"POST"}),i({title:"Success",description:"Property approved successfully!"})}catch(s){const e=s instanceof Error?s.message:"Failed to approve property";throw i({title:"Error",description:e,variant:"destructive"}),s}}async rejectProperty(e,s){try{await this.makeRequest(`/properties/${e}/reject`,{method:"POST",body:JSON.stringify({reason:s})}),i({title:"Success",description:"Property rejected successfully!"})}catch(a){const e=a instanceof Error?a.message:"Failed to reject property";throw i({title:"Error",description:e,variant:"destructive"}),a}}async deleteProperty(e){try{await this.makeRequest(`/properties/${e}`,{method:"DELETE"}),i({title:"Success",description:"Property deleted successfully!"})}catch(s){const e=s instanceof Error?s.message:"Failed to delete property";throw i({title:"Error",description:e,variant:"destructive"}),s}}async togglePropertyFeatured(e,s){try{await this.makeRequest(`/properties/${e}/featured`,{method:"PATCH",body:JSON.stringify({featured:s})}),i({title:"Success",description:`Property ${s?"marked as featured":"removed from featured"}!`})}catch(a){const e=a.response?.data||a,s=e.message||a.message||"Failed to update property";throw e.upgradeRequired||e.limitReached?i({title:e.limitReached?"Featured Limit Reached":"Upgrade Required",description:`${s} Visit the Subscription Plans page to upgrade.`,variant:"destructive"}):i({title:"Error",description:s,variant:"destructive"}),a}}getStatusOptions(){return[{label:"Active",value:"active"},{label:"Available",value:"available"},{label:"Pending",value:"pending"},{label:"Sold",value:"sold"},{label:"Rented",value:"rented"},{label:"Rejected",value:"rejected"}]}getStatusColor(e){switch(e.toLowerCase()){case"active":case"available":return"bg-green-500";case"pending":return"bg-yellow-500";case"sold":return"bg-blue-500";case"rented":return"bg-purple-500";case"rejected":return"bg-red-500";default:return"bg-gray-500"}}getStatusText(e){return{available:"Available",pending:"Pending Review",sold:"Sold",rented:"Rented",rejected:"Rejected"}[e.toLowerCase()]||e.charAt(0).toUpperCase()+e.slice(1)}getPropertyTypeOptions(){return[{label:"Apartment",value:"apartment"},{label:"House",value:"house"},{label:"Villa",value:"villa"},{label:"Plot",value:"plot"},{label:"Commercial",value:"commercial"},{label:"Office",value:"office"}]}},ce=({property:s,open:a,onOpenChange:t})=>{if(!s)return null;return e.jsx(l,{open:a,onOpenChange:t,children:e.jsxs(n,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(d,{children:[e.jsx(c,{className:"text-2xl",children:s.title}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(m,{className:"w-4 h-4"}),s.address.street,", ",s.address.city,", ",s.address.state," - ",s.address.pincode]})})]}),e.jsxs("div",{className:"space-y-6 mt-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(p,{variant:"available"===s.status?"default":"pending"===s.status?"outline":"destructive",children:["Status: ",s.status]}),e.jsx(p,{variant:"secondary",className:"capitalize",children:s.type?s.type.replace("_"," "):"property"}),e.jsxs(p,{variant:"sale"===s.listingType?"default":"outline",children:["For ","sale"===s.listingType?"Sale":"Rent"]}),s.featured&&e.jsx(p,{variant:"default",children:"Featured"}),s.verified&&e.jsx(p,{variant:"default",children:"Verified"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Price"}),e.jsx("p",{className:"font-semibold",children:((e,s)=>{const a=new Intl.NumberFormat("en-IN",{maximumFractionDigits:0}).format(e);return"rent"===s?`₹${a}/month`:`₹${a}`})(s.price,s.listingType)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Area"}),e.jsx("p",{className:"font-semibold",children:(r=s.area,r?.builtUp?`${r.builtUp} ${r.unit||"sqft"}`:r?.carpet?`${r.carpet} ${r.unit||"sqft"}`:r?.plot?`${r.plot} ${r.unit||"sqft"}`:"N/A")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bedrooms"}),e.jsx("p",{className:"font-semibold",children:s.bedrooms||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bathrooms"}),e.jsx("p",{className:"font-semibold",children:s.bathrooms||"N/A"})]})]})]}),e.jsx(ee,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]}),s.amenities&&s.amenities.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Amenities"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.amenities.map((s,a)=>e.jsx(p,{variant:"outline",className:"capitalize",children:s.replace("_"," ")},a))})]})]}),e.jsx(ee,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Owner Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Name"}),e.jsx("p",{className:"font-medium",children:se(s.owner)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Email"}),e.jsx("p",{className:"font-medium",children:s.owner?.email})]}),s.owner?.profile?.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"font-medium",children:s.owner.profile.phone})]})]})]}),s.images&&s.images.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Images"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:s.images.map((s,a)=>e.jsxs("div",{className:"relative aspect-video rounded-lg overflow-hidden border",children:[e.jsx("img",{src:s.url,alt:s.caption||`Property ${a+1}`,className:"w-full h-full object-cover"}),s.isPrimary&&e.jsx(p,{className:"absolute top-2 left-2",variant:"default",children:"Primary"})]},a))})]})]}),s.videos&&s.videos.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Videos"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.videos.map((s,a)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"relative aspect-video rounded-lg overflow-hidden border bg-black",children:s.url.includes("youtube.com")||s.url.includes("youtu.be")?e.jsx("iframe",{src:s.url.replace("watch?v=","embed/").replace("youtu.be/","youtube.com/embed/"),className:"w-full h-full",allowFullScreen:!0,title:s.caption||`Video ${a+1}`}):e.jsx("video",{src:s.url,controls:!0,className:"w-full h-full object-contain",poster:s.thumbnail})}),s.caption&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.caption})]},a))})]})]}),s.virtualTour&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Virtual Tour"}),e.jsx(ae,{url:s.virtualTour})]})]}),"rejected"===s.status&&s.rejectionReason&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-red-700 mb-2",children:"Rejection Reason"}),e.jsx("p",{className:"text-sm text-red-600",children:s.rejectionReason})]})]})]})]})});var r},oe=()=>{const t=s(),{toast:i}=j(),[m,u]=a.useState(""),[h,x]=a.useState("all"),[ee,se]=a.useState("all"),[ae,te]=a.useState([]),[oe,me]=a.useState(!0),[pe,ue]=a.useState(!1),[he,xe]=a.useState(!1),[je,ve]=a.useState(!1),[ge,fe]=a.useState(null),[ye,be]=a.useState(""),[Ne,we]=a.useState(null);a.useEffect(()=>{const e=r.getCurrentUser();we(e),Pe()},[]);const Pe=async()=>{try{me(!0);const e=await de.getProperties({limit:1e3});e.success&&te(e.data.properties)}catch(e){i({title:"Error",description:"Failed to load properties",variant:"destructive"})}finally{me(!1)}},Se=a.useMemo(()=>ae.filter(e=>{const s=e.title.toLowerCase().includes(m.toLowerCase())||e.address.city.toLowerCase().includes(m.toLowerCase())||e.address.state.toLowerCase().includes(m.toLowerCase()),a="all"===h||e.type===h,t="all"===ee||e.status===ee;return s&&a&&t}),[ae,m,h,ee]),{paginatedItems:Ce,currentPage:Fe,totalPages:ke,goToPage:Re,nextPage:Te,previousPage:Ae}=L(Se,10),Ee=[{key:"title",label:"Property Title",render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.address.city,", ",s.address.state]})]})},{key:"type",label:"Type",render:s=>e.jsx(p,{variant:"secondary",className:"capitalize",children:s.type?s.type.replace("_"," "):"property"})},{key:"listingType",label:"Listing",render:s=>e.jsx(p,{variant:"sale"===s.listingType?"default":"outline",children:"sale"===s.listingType?"For Sale":"For Rent"})},{key:"price",label:"Price",render:s=>e.jsx("span",{className:"font-semibold",children:k.formatPrice(s.price,s.listingType)})},{key:"area",label:"Area",render:s=>e.jsx("span",{children:k.formatArea(s.area)})},{key:"status",label:"Status",render:s=>e.jsx(p,{variant:{available:"default",pending:"outline",rejected:"destructive",sold:"secondary",rented:"secondary"}[s.status]||"secondary",children:s.status})},{key:"featured",label:"Featured",render:s=>e.jsx(p,{variant:s.featured?"default":"secondary",children:s.featured?"Featured":"Regular"})},{key:"actions",label:"Actions",render:s=>{const a=(e=>!!e.owner&&(!(!Ne||e.owner._id!==Ne.id)||!e.vendor&&"available"===e.status))(s),r="pending"===s.status;return e.jsxs(R,{children:[e.jsx(T,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"sm",children:e.jsx(re,{className:"w-4 h-4"})})}),e.jsxs(A,{align:"end",children:[e.jsx(E,{children:"Actions"}),e.jsx($,{}),a&&e.jsxs(O,{onClick:()=>t(`/admin/properties/edit/${s._id}`),children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Edit Property"]}),!a&&e.jsxs(O,{onClick:()=>(e=>{fe(e),ve(!0)})(s),children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"View Details"]}),!a&&r&&e.jsxs(e.Fragment,{children:[e.jsx($,{}),e.jsxs(O,{onClick:()=>(async e=>{try{await de.approveProperty(e._id),te(ae.map(s=>s._id===e._id?{...s,status:"available",verified:!0}:s)),i({title:"Success",description:"Property approved and listed successfully!"})}catch(s){i({title:"Error",description:"Failed to approve property",variant:"destructive"})}})(s),className:"text-green-600",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Approve & Publish"]}),e.jsxs(O,{onClick:()=>(e=>{fe(e),xe(!0)})(s),className:"text-red-600",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Reject"]})]}),"available"===s.status&&e.jsxs(e.Fragment,{children:[e.jsx($,{}),e.jsx(O,{onClick:()=>(async e=>{try{await de.togglePropertyFeatured(e._id,!e.featured),te(ae.map(s=>s._id===e._id?{...s,featured:!s.featured}:s)),i({title:"Success",description:`Property ${e.featured?"removed from":"marked as"} featured`})}catch(s){i({title:"Error",description:"Failed to update featured status",variant:"destructive"})}})(s),children:s.featured?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Remove Featured"]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Mark Featured"]})})]}),e.jsx($,{}),e.jsxs(O,{onClick:()=>(e=>{fe(e),ue(!0)})(s),className:"text-red-600",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})}}];return oe?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(v,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading properties..."})]}):e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"dashboard-header-responsive",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"dashboard-title-responsive",children:"Property Management"}),e.jsx("p",{className:"text-muted-foreground mt-1 md:mt-2 text-sm md:text-base",children:"Manage property listings and details"})]}),e.jsxs(g,{onClick:()=>t("/admin/properties/add"),className:"w-full sm:w-auto",children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Add Property"}),e.jsx("span",{className:"sm:hidden",children:"Add"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4",children:[e.jsxs(y,{className:"stats-card-responsive",children:[e.jsx(b,{className:"pb-2",children:e.jsx(N,{className:"stats-label-responsive",children:"Total Properties"})}),e.jsx(w,{children:e.jsx("div",{className:"stats-value-responsive",children:ae.length})})]}),e.jsxs(y,{className:"stats-card-responsive",children:[e.jsx(b,{className:"pb-2",children:e.jsx(N,{className:"stats-label-responsive",children:"Pending Approval"})}),e.jsx(w,{children:e.jsx("div",{className:"stats-value-responsive text-yellow-600",children:ae.filter(e=>"pending"===e.status).length})})]}),e.jsxs(y,{className:"stats-card-responsive",children:[e.jsx(b,{className:"pb-2",children:e.jsx(N,{className:"stats-label-responsive",children:"Available Properties"})}),e.jsx(w,{children:e.jsx("div",{className:"stats-value-responsive text-green-600",children:ae.filter(e=>"available"===e.status).length})})]}),e.jsxs(y,{className:"stats-card-responsive",children:[e.jsx(b,{className:"pb-2",children:e.jsx(N,{className:"stats-label-responsive",children:"Featured"})}),e.jsx(w,{children:e.jsx("div",{className:"stats-value-responsive text-blue-600",children:ae.filter(e=>e.featured).length})})]})]}),e.jsxs(y,{children:[e.jsxs(b,{children:[e.jsx(N,{className:"text-lg md:text-xl",children:"All Properties"}),e.jsxs(P,{className:"text-sm md:text-base",children:[Se.length," propert",1!==Se.length?"ies":"y"," found"]})]}),e.jsxs(w,{children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"search-container-responsive",children:[e.jsx("div",{className:"flex-1",children:e.jsx(H,{searchTerm:m,onSearchChange:u,filterValue:h,onFilterChange:x,filterOptions:[{label:"Apartment",value:"apartment"},{label:"House",value:"house"},{label:"Villa",value:"villa"},{label:"Plot",value:"plot"},{label:"Commercial",value:"commercial"},{label:"Office",value:"office"}],filterPlaceholder:"Filter by type"})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsx(H,{searchTerm:"",onSearchChange:()=>{},filterValue:ee,onFilterChange:se,filterOptions:[{label:"Pending",value:"pending"},{label:"Active",value:"active"},{label:"Rejected",value:"rejected"},{label:"Sold",value:"sold"},{label:"Rented",value:"rented"}],filterPlaceholder:"Filter by status",hideSearch:!0})})]})}),e.jsx("div",{className:"table-responsive-wrapper",children:e.jsx(B,{columns:Ee,data:Ce.map(e=>({...e,id:e._id})),hideDefaultActions:!0})}),ke>1&&e.jsx("div",{className:"mt-4 md:mt-6",children:e.jsx(V,{children:e.jsxs(D,{className:"pagination-responsive",children:[e.jsx(z,{children:e.jsx(U,{onClick:Ae,className:"pagination-button-responsive "+(1===Fe?"pointer-events-none opacity-50":"cursor-pointer")})}),Array.from({length:ke},(e,s)=>s+1).map(s=>e.jsx(z,{children:e.jsx(I,{onClick:()=>Re(s),isActive:Fe===s,className:"pagination-button-responsive cursor-pointer",children:s})},s)),e.jsx(z,{children:e.jsx(M,{onClick:Te,className:"pagination-button-responsive "+(Fe===ke?"pointer-events-none opacity-50":"cursor-pointer")})})]})})})]})]}),e.jsx(J,{open:pe,onOpenChange:ue,children:e.jsxs(W,{children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Delete Property"}),e.jsxs(X,{children:['Are you sure you want to delete "',ge?.title,'"? This action cannot be undone.']})]}),e.jsxs(Y,{children:[e.jsx(Z,{children:"Cancel"}),e.jsx(G,{onClick:async()=>{if(ge)try{await de.deleteProperty(ge._id),te(ae.filter(e=>e._id!==ge._id)),ue(!1),fe(null),i({title:"Success",description:"Property deleted successfully"})}catch(e){i({title:"Error",description:"Failed to delete property",variant:"destructive"})}},className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})}),e.jsx(l,{open:he,onOpenChange:xe,children:e.jsxs(n,{children:[e.jsxs(d,{children:[e.jsx(c,{children:"Reject Property"}),e.jsxs(o,{children:['Please provide a reason for rejecting "',ge?.title,'". The vendor will be notified.']})]}),e.jsxs("div",{className:"py-4",children:[e.jsx(S,{htmlFor:"rejection-reason",children:"Rejection Reason"}),e.jsx(C,{id:"rejection-reason",placeholder:"Enter the reason for rejection...",value:ye,onChange:e=>be(e.target.value),className:"mt-2",rows:4})]}),e.jsxs(F,{children:[e.jsx(g,{variant:"outline",onClick:()=>xe(!1),children:"Cancel"}),e.jsx(g,{variant:"destructive",onClick:async()=>{if(ge&&ye.trim())try{await de.rejectProperty(ge._id,ye),te(ae.map(e=>e._id===ge._id?{...e,status:"rejected"}:e)),xe(!1),fe(null),be(""),i({title:"Property Rejected",description:"Property has been rejected and vendor has been notified."})}catch(e){i({title:"Error",description:"Failed to reject property",variant:"destructive"})}},disabled:!ye.trim(),children:"Reject Property"})]})]})}),e.jsx(ce,{property:ge,open:je,onOpenChange:ve})]})};export{oe as default};

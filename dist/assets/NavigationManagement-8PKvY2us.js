import{j as e}from"./ui-s1SEoZIF.js";import{r as a,d as s}from"./router-D8v2YSKU.js";import{a5 as t,a6 as i,ah as r,ai as l,aj as n,ak as d,a7 as c,a8 as o,a9 as p,aa as h,ab as m,L as u,I as x,s as y,v as j,w as g,x as v,y as N,ag as f,f as w,ac as b,ad as C,k as L,B as I,ae as S,af as P,u as F,am as O,a as q,e as k}from"./index-l5vY_naC.js";import{T as A,a as _,b as T,c as E,d as U,e as J}from"./table-S99XbycI.js";import{P as R}from"./pencil-CLkP3exa.js";import{A as V,a as z}from"./alert-CHp9jSHV.js";import"./vendor-BxThA0WO.js";const D=()=>{const[s,F]=a.useState([]),[O,q]=a.useState([]),[k,V]=a.useState(!0),[z,D]=a.useState(!1),[M,$]=a.useState(null),[B,H]=a.useState("all"),[Q,G]=a.useState(""),[K,W]=a.useState({name:"",value:"",displayLabel:"",category:"residential",parentId:"",queryParams:"",displayOrder:0}),{toast:X}=t();a.useEffect(()=>{Z(),Y()},[]);const Y=async()=>{try{const e=await i.getFilterConfigurationsByType("listing_type",!1);q(e)}catch(e){}},Z=async()=>{try{V(!0);const e=await i.getAllNavigationItems(!0);F(e)}catch(e){X({title:"Error",description:"Failed to fetch navigation items",variant:"destructive"})}finally{V(!1)}},ee=e=>{e?($(e),W({name:e.name,value:e.value,displayLabel:e.displayLabel||"",category:e.category,parentId:e.parentId||"",queryParams:e.queryParams?JSON.stringify(e.queryParams):"",displayOrder:e.displayOrder})):($(null),W({name:"",value:"",displayLabel:"",category:"residential",parentId:"all"===B?"":B,queryParams:"",displayOrder:s.length})),D(!0)},ae=()=>{D(!1),$(null),W({name:"",value:"",displayLabel:"",category:"residential",parentId:"",queryParams:"",displayOrder:0})},se=async(e,a,t)=>{const r=(e=>s.filter(a=>a.category===e))(t),l=r.findIndex(a=>a._id===e);if("up"===a&&0===l||"down"===a&&l===r.length-1)return;const n=[...r],d="up"===a?l-1:l+1;[n[l],n[d]]=[n[d],n[l]];try{await Promise.all(n.map((e,a)=>i.updateNavigationItem(e._id,{displayOrder:a}))),Z(),X({title:"Success",description:"Navigation items reordered successfully"})}catch(c){X({title:"Error",description:"Failed to reorder navigation items",variant:"destructive"})}},te=a=>{const t=null===a?s.filter(e=>!e.parentId):(e=>s.filter(a=>a.parentId===e))(a),r=t.filter(e=>e.name.toLowerCase().includes(Q.toLowerCase())||e.displayLabel?.toLowerCase().includes(Q.toLowerCase())||e.value.toLowerCase().includes(Q.toLowerCase())),l=a?O.find(e=>e.value===a):null,n=l?l.displayLabel||l.name:"Unassigned";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:l?`Property types shown under "${n}" in the navbar dropdown`:"Property types not yet assigned to any listing type"}),e.jsxs(w,{onClick:()=>ee(),children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),"Add Property Type"]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(x,{placeholder:"Search navigation items...",value:Q,onChange:e=>G(e.target.value),className:"max-w-sm"})}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(A,{children:[e.jsx(_,{children:e.jsxs(T,{children:[e.jsx(E,{className:"w-[100px]",children:"Order"}),e.jsx(E,{children:"Name"}),e.jsx(E,{children:"Display Label"}),e.jsx(E,{children:"Category"}),e.jsx(E,{children:"Value"}),e.jsx(E,{children:"Listing Type"}),e.jsx(E,{children:"Status"}),e.jsx(E,{className:"text-right w-[120px]",children:"Actions"})]})}),e.jsx(U,{children:0===r.length?e.jsx(T,{children:e.jsx(J,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:Q?"No navigation items match your search.":l?`No property types assigned to "${n}" yet. Create one to get started.`:"No unassigned property types. All items are assigned to listing types."})}):r.map((s,r)=>{const l=t.findIndex(e=>e._id===s._id);return e.jsxs(T,{children:[e.jsx(J,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>se(s._id,"up",a),disabled:0===l,children:e.jsx(C,{className:"h-4 w-4"})}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>se(s._id,"down",a),disabled:l===t.length-1,children:e.jsx(L,{className:"h-4 w-4"})})]})}),e.jsx(J,{className:"font-medium",children:s.name}),e.jsx(J,{children:s.displayLabel||"-"}),e.jsx(J,{children:e.jsx(I,{variant:"outline",children:s.category})}),e.jsx(J,{children:e.jsx("code",{className:"text-sm bg-muted px-2 py-1 rounded",children:s.value})}),e.jsx(J,{children:s.parentId?e.jsx(I,{variant:"secondary",children:O.find(e=>e.value===s.parentId)?.displayLabel||s.parentId}):e.jsx(I,{variant:"outline",children:"Unassigned"})}),e.jsx(J,{children:e.jsx(S,{checked:s.isActive,onCheckedChange:()=>(async(e,a)=>{try{await i.updateNavigationItem(e,{isActive:!a}),X({title:"Success",description:`Navigation item ${a?"deactivated":"activated"} successfully`}),Z()}catch(s){X({title:"Error",description:"Failed to update navigation item status",variant:"destructive"})}})(s._id,s.isActive)})}),e.jsx(J,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>ee(s),children:e.jsx(R,{className:"h-4 w-4"})}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this navigation item? This action cannot be undone."))try{await i.deleteNavigationItem(e),X({title:"Success",description:"Navigation item deleted successfully"}),Z()}catch(a){X({title:"Error",description:"Failed to delete navigation item",variant:"destructive"})}})(s._id),children:e.jsx(P,{className:"h-4 w-4 text-destructive"})})]})})]},s._id)})})]})})]})};return k?e.jsx("div",{className:"text-center py-8",children:"Loading navigation..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Navigation Property Types"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Create property types and assign them to listing types. They will appear as dropdown options in the navbar."})]}),0===O.length?e.jsx("div",{className:"border rounded-lg p-8 text-center",children:e.jsxs("p",{className:"text-muted-foreground",children:["No listing types found. Please create listing types in ",e.jsx("strong",{children:"Filter Management"})," first (e.g., For Sale, For Rent)."]})}):e.jsxs(r,{value:B,onValueChange:H,children:[e.jsxs(l,{className:"w-full justify-start overflow-x-auto flex-wrap h-auto",children:[e.jsx(n,{value:"all",className:"flex-shrink-0",children:"All / Unassigned"}),O.map(a=>e.jsx(n,{value:a.value,className:"flex-shrink-0",children:a.displayLabel||a.name},a._id))]}),e.jsx(d,{value:"all",children:te(null)}),O.map(a=>e.jsx(d,{value:a.value,children:te(a.value)},a._id))]}),e.jsx(c,{open:z,onOpenChange:e=>{e||ae()},children:e.jsxs(o,{className:"max-w-2xl",children:[e.jsxs(p,{children:[e.jsx(h,{children:M?"Edit Property Type":"Add Property Type"}),e.jsx(m,{children:"Configure property type with name, value, and assign it to a listing type"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"name",children:"Name *"}),e.jsx(x,{id:"name",value:K.name,onChange:e=>W({...K,name:e.target.value}),placeholder:"e.g., Flat / Apartment",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"value",children:"Value *"}),e.jsx(x,{id:"value",value:K.value,onChange:e=>W({...K,value:e.target.value}),placeholder:"e.g., apartment",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"displayLabel",children:"Display Label (Optional)"}),e.jsx(x,{id:"displayLabel",value:K.displayLabel,onChange:e=>W({...K,displayLabel:e.target.value}),placeholder:"Defaults to Name if not provided"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"category",children:"Category *"}),e.jsxs(y,{value:K.category,onValueChange:e=>W({...K,category:e}),children:[e.jsx(j,{children:e.jsx(g,{})}),e.jsxs(v,{children:[e.jsx(N,{value:"residential",children:"Residential"}),e.jsx(N,{value:"commercial",children:"Commercial"}),e.jsx(N,{value:"agricultural",children:"Agricultural"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"parentId",children:"Listing Type (Parent)"}),e.jsxs(y,{value:K.parentId||"none",onValueChange:e=>W({...K,parentId:"none"===e?"":e}),children:[e.jsx(j,{children:e.jsx(g,{placeholder:"Select listing type..."})}),e.jsxs(v,{children:[e.jsx(N,{value:"none",children:"No parent (top level)"}),O.map(a=>e.jsx(N,{value:a.value,children:a.displayLabel||a.name},a._id))]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select which listing type (For Sale, For Rent) this property appears under"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"displayOrder",children:"Display Order"}),e.jsx(x,{id:"displayOrder",type:"number",value:K.displayOrder,onChange:e=>W({...K,displayOrder:parseInt(e.target.value)||0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"queryParams",children:"Query Parameters (JSON)"}),e.jsx(x,{id:"queryParams",value:K.queryParams,onChange:e=>W({...K,queryParams:e.target.value}),placeholder:'{"listingType": "sale", "propertyType": "apartment"}'}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Optional: JSON object for URL query parameters"})]})]}),e.jsxs(f,{children:[e.jsx(w,{variant:"outline",onClick:ae,children:"Cancel"}),e.jsx(w,{onClick:async()=>{try{let a;if(K.queryParams&&K.queryParams.trim())try{a=JSON.parse(K.queryParams)}catch(e){return void X({title:"Error",description:"Invalid JSON format for query parameters",variant:"destructive"})}const s={name:K.name,value:K.value,displayLabel:K.displayLabel||void 0,category:K.category,parentId:K.parentId||void 0,queryParams:a,displayOrder:K.displayOrder};M?(await i.updateNavigationItem(M._id,s),X({title:"Success",description:"Navigation item updated successfully"})):(await i.createNavigationItem(s),X({title:"Success",description:"Navigation item created successfully"})),Z(),ae()}catch(a){X({title:"Error",description:M?"Failed to update navigation item":"Failed to create navigation item",variant:"destructive"})}},children:M?"Update":"Create"})]})]})})]})},M=()=>{const{isSuperAdmin:t}=F(),i=s();return a.useEffect(()=>{t||i("/admin/dashboard")},[t,i]),t?e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(O,{className:"h-8 w-8"}),"Navigation Management"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Configure hierarchical navigation structure for the home page navbar"})]})}),e.jsx(V,{children:e.jsx(z,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{children:e.jsx("strong",{children:"How it works:"})}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 ml-2",children:[e.jsxs("li",{children:["Navbar dropdowns are created from ",e.jsx("strong",{children:"listing types"})," in Filter Management (For Sale, For Rent, etc.)"]}),e.jsx("li",{children:"Create property types below and assign them to a listing type"}),e.jsx("li",{children:"Property types appear as options in their assigned listing type's dropdown"}),e.jsx("li",{children:"Use tabs to view property types grouped by listing type"})]})]})})}),e.jsx(q,{children:e.jsx(k,{className:"pt-6",children:e.jsx(D,{})})})]}):null};export{M as default};

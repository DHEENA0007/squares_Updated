import{j as e}from"./ui-BNZSgpjP.js";import{r as s}from"./router-D8v2YSKU.js";import{V as a}from"./ViewPropertyDialog-BsPWgMac.js";import{a2 as t,aP as r,aQ as l,aO as i,a as c,e as n,$ as d,I as o,f as m,aj as x,B as h,L as p,q as u,r as j,s as v,v as f,w as N,aM as g,bP as y,bQ as w,bu as b,E as C,a4 as k,a5 as S,a6 as R,a7 as P,a8 as T,T as F,ae as A,a3 as $}from"./index-CM8T-gRV.js";import{C as q}from"./checkbox-CHt0TJj6.js";import{T as V,a as _,b as L,c as z,d as E,e as I}from"./table-eRu5kCA2.js";import{C as U}from"./circle-alert-B-023vbF.js";import{R as O}from"./rotate-ccw-tuXYuXYj.js";import"./vendor-BxThA0WO.js";import"./propertyUtils-41DuwCMc.js";import"./external-link-C1MlFbdl.js";import"./indian-rupee-DSFNbeHa.js";const D=()=>{const[D,B]=s.useState([]),[M,J]=s.useState(!0),[Q,G]=s.useState(""),[H,K]=s.useState(1),[W,X]=s.useState(1),[Y,Z]=s.useState(null),[ee,se]=s.useState(!1),[ae,te]=s.useState(!1),[re,le]=s.useState({}),{toast:ie}=t(),[ce,ne]=s.useState("all"),[de,oe]=s.useState("all"),[me,xe]=s.useState(""),[he,pe]=s.useState(""),[ue,je]=s.useState(!1),[ve,fe]=s.useState([]),[Ne,ge]=s.useState([]);s.useEffect(()=>{(async()=>{try{const[e,s]=await Promise.all([$.getAllPropertyTypes(),$.getFilterConfigurationsByType("listing_type")]);fe(e),ge(s)}catch(e){}})()},[]);const[ye,we]=s.useState(""),[be,Ce]=s.useState({issuesResolved:!1,documentsUpdated:!1,complianceChecked:!1,qualityImproved:!1,accuracyVerified:!1,readyForReview:!1}),[ke,Se]=s.useState("");s.useEffect(()=>{Re()},[H,Q,ce,de,me,he]);const Re=async()=>{try{J(!0);const e=new URLSearchParams;e.append("page",H.toString()),Q&&e.append("search",Q),ce&&"all"!==ce&&e.append("type",ce),de&&"all"!==de&&e.append("listingType",de),me&&e.append("startDate",me),he&&e.append("endDate",he);const s=await r(`/subadmin/properties/rejected?${e.toString()}`),a=await l(s);B(a.data.properties||[]),X(a.data.totalPages||1)}catch(e){ie({title:"Error",description:e.message||"Error fetching rejected properties",variant:"destructive"}),B([])}finally{J(!1)}};i("property_rejected",e=>{ie({title:"Property Rejected",description:"A property has been rejected"}),Re()});const Pe=()=>{Ce({issuesResolved:!1,documentsUpdated:!1,complianceChecked:!1,qualityImproved:!1,accuracyVerified:!1,readyForReview:!1}),Se(""),we("")};if(M&&0===D.length)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Property Rejections"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"View and manage rejected property listings"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"},s))})]});const Te=Y?{...Y,type:Y.type,listingType:Y.listingType,status:Y.status,images:Y.images.map(e=>({url:"string"==typeof e?e:e.url,isPrimary:!1})),owner:{...Y.owner,role:"customer",profile:{firstName:Y.owner.name,lastName:"",phone:""}}}:null;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Property Rejections"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"View and manage rejected property listings"})]}),e.jsx(c,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(d,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(o,{placeholder:"Search rejected properties by title, city, state, email, or description...",value:Q,onChange:e=>G(e.target.value),className:"pl-10"})]}),e.jsxs(m,{variant:"outline",onClick:()=>je(!ue),className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-4 w-4"}),"Filters",("all"!==ce||"all"!==de||me||he)&&e.jsx(h,{variant:"secondary",className:"ml-1",children:["all"!==ce,"all"!==de,me,he].filter(Boolean).length})]})]}),ue&&e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap gap-3 pt-3 border-t",children:[e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(p,{className:"text-xs text-muted-foreground",children:"Property Type"}),e.jsxs(u,{value:ce,onValueChange:ne,children:[e.jsx(j,{className:"w-full sm:w-[150px]",children:e.jsx(v,{placeholder:"All Types"})}),e.jsxs(f,{children:[e.jsx(N,{value:"all",children:"All Types"}),ve.map(s=>e.jsx(N,{value:s.value,children:s.name},s._id))]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(p,{className:"text-xs text-muted-foreground",children:"Listing Type"}),e.jsxs(u,{value:de,onValueChange:oe,children:[e.jsx(j,{className:"w-full sm:w-[130px]",children:e.jsx(v,{placeholder:"All"})}),e.jsxs(f,{children:[e.jsx(N,{value:"all",children:"All"}),Ne.length>0?Ne.map(s=>e.jsx(N,{value:s.value,children:s.displayLabel||s.name},s._id)):e.jsxs(e.Fragment,{children:[e.jsx(N,{value:"sale",children:"Sale"}),e.jsx(N,{value:"rent",children:"Rent"}),e.jsx(N,{value:"lease",children:"Lease"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(p,{className:"text-xs text-muted-foreground",children:"From"}),e.jsx(o,{type:"date",value:me,onChange:e=>xe(e.target.value),className:"w-full sm:w-[150px]"})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(p,{className:"text-xs text-muted-foreground",children:"To"}),e.jsx(o,{type:"date",value:he,onChange:e=>pe(e.target.value),className:"w-full sm:w-[150px]"})]}),("all"!==ce||"all"!==de||me||he)&&e.jsx("div",{className:"flex items-end",children:e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>{ne("all"),oe("all"),xe(""),pe("")},className:"text-muted-foreground hover:text-foreground",children:[e.jsx(g,{className:"h-4 w-4 mr-1"}),"Clear Filters"]})})]})]})})}),e.jsx(c,{children:e.jsx(n,{className:"p-0",children:0===D.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(U,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Rejected Properties"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"There are no rejected properties at the moment"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(V,{children:[e.jsx(_,{children:e.jsxs(L,{className:"bg-muted/50",children:[e.jsx(z,{className:"w-[60px] text-center",children:"S.No."}),e.jsx(z,{children:"Property"}),e.jsx(z,{children:"Location"}),e.jsx(z,{className:"text-center",children:"Type"}),e.jsx(z,{className:"text-right",children:"Price"}),e.jsx(z,{className:"max-w-[200px]",children:"Rejection Reason"}),e.jsx(z,{children:"Owner"}),e.jsx(z,{className:"text-center",children:"Rejected On"}),e.jsx(z,{className:"text-center w-[150px]",children:"Actions"})]})}),e.jsx(E,{children:D.map((s,a)=>{return e.jsxs(L,{className:"hover:bg-muted/30",children:[e.jsx(I,{className:"text-center font-medium",children:10*(H-1)+a+1}),e.jsx(I,{children:e.jsxs("div",{className:"max-w-[180px]",children:[e.jsx("p",{className:"font-medium text-sm truncate",title:s.title,children:s.title}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[s.bedrooms>0&&e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-0.5",children:[e.jsx(y,{className:"h-3 w-3"})," ",s.bedrooms]}),s.bathrooms>0&&e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-0.5 ml-2",children:[e.jsx(w,{className:"h-3 w-3"})," ",s.bathrooms]}),(s.area.builtUp||s.area.plot||s.area.carpet)&&e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-0.5 ml-2",children:[e.jsx(b,{className:"h-3 w-3"})," ",(r=s.area,r.builtUp?`${r.builtUp} ${r.unit}`:r.plot?`${r.plot} ${r.unit}`:r.carpet?`${r.carpet} ${r.unit}`:"N/A")]})]})]})}),e.jsx(I,{children:e.jsxs("div",{className:"max-w-[130px]",children:[e.jsx("p",{className:"text-sm truncate",title:`${s.address.city}, ${s.address.state}`,children:s.address.city}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[s.address.district?`${s.address.district}, `:"",s.address.state]})]})}),e.jsx(I,{className:"text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx(h,{variant:"outline",className:"text-xs capitalize",children:s.type}),e.jsx(h,{variant:"sale"===s.listingType?"default":"secondary",className:"text-xs",children:"sale"===s.listingType?"Sale":"rent"===s.listingType?"Rent":"Lease"})]})}),e.jsx(I,{className:"text-right",children:e.jsx("p",{className:"font-bold text-primary text-sm",children:(t=s.price,`â‚¹${t.toLocaleString("en-IN")}`)})}),e.jsx(I,{children:e.jsx("div",{className:"max-w-[200px]",children:s.rejectionReason?e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(U,{className:"h-3 w-3 text-red-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 line-clamp-2",title:s.rejectionReason,children:s.rejectionReason}),s.rejectedBy&&e.jsxs("p",{className:"text-[10px] text-muted-foreground mt-0.5",children:["by ",s.rejectedBy.name]})]})]}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"N/A"})})}),e.jsx(I,{children:e.jsxs("div",{className:"max-w-[130px]",children:[e.jsx("p",{className:"text-sm font-medium truncate",title:s.owner.name,children:s.owner.name||"N/A"}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",title:s.owner.email,children:s.owner.email})]})}),e.jsx(I,{className:"text-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:s.rejectedAt?new Date(s.rejectedAt).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"2-digit"}):"N/A"})}),e.jsx(I,{children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>{Z(s),se(!0)},className:"h-8 px-2",title:"View Details",children:e.jsx(C,{className:"h-4 w-4"})}),e.jsx(m,{size:"sm",variant:"secondary",onClick:()=>(e=>{Z(e),Pe(),te(!0)})(s),disabled:re[s._id],className:"h-8 px-2",title:"Reactivate",children:e.jsx(O,{className:"h-4 w-4"})})]})})]},s._id);var t,r})})]})})})}),D.length>0&&e.jsx(c,{children:e.jsx(n,{className:"py-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",10*(H-1)+1," to ",Math.min(10*H,10*(H-1)+D.length)," of ",10*W," properties"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{variant:"outline",size:"sm",disabled:1===H,onClick:()=>K(1),children:"First"}),e.jsx(m,{variant:"outline",size:"sm",disabled:1===H,onClick:()=>K(H-1),children:"Previous"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,W)},(s,a)=>{let t;return t=W<=5||H<=3?a+1:H>=W-2?W-4+a:H-2+a,e.jsx(m,{variant:H===t?"default":"outline",size:"sm",onClick:()=>K(t),className:"w-8 h-8 p-0",children:t},t)})}),e.jsx(m,{variant:"outline",size:"sm",disabled:H===W,onClick:()=>K(H+1),children:"Next"}),e.jsx(m,{variant:"outline",size:"sm",disabled:H===W,onClick:()=>K(W),children:"Last"})]})]})})}),e.jsx(a,{property:Te,open:ee,onOpenChange:se}),e.jsx(k,{open:ae,onOpenChange:te,children:e.jsxs(S,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(R,{children:[e.jsx(P,{children:"Reactivate Property for Review"}),e.jsxs(T,{children:['Complete the verification checklist to reactivate "',Y?.title,'" for review. The property will move to pending status for approval.']})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"approver-name-reactivate",children:"Moderator Name *"}),e.jsx(o,{id:"approver-name-reactivate",placeholder:"Enter your full name",value:ye,onChange:e=>we(e.target.value),className:"mt-1"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(p,{className:"text-base font-semibold",children:"Reactivation Verification Checklist"}),e.jsxs("div",{className:"space-y-3 border rounded-lg p-4 bg-muted/30",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{id:"issues-resolved",checked:be.issuesResolved,onCheckedChange:e=>Ce({...be,issuesResolved:e})}),e.jsx("label",{htmlFor:"issues-resolved",className:"text-sm font-medium cursor-pointer",children:"Previous rejection issues have been resolved"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{id:"documents-updated",checked:be.documentsUpdated,onCheckedChange:e=>Ce({...be,documentsUpdated:e})}),e.jsx("label",{htmlFor:"documents-updated",className:"text-sm font-medium cursor-pointer",children:"Required documents are updated and complete"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{id:"compliance-checked",checked:be.complianceChecked,onCheckedChange:e=>Ce({...be,complianceChecked:e})}),e.jsx("label",{htmlFor:"compliance-checked",className:"text-sm font-medium cursor-pointer",children:"Property meets all compliance requirements"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{id:"quality-improved",checked:be.qualityImproved,onCheckedChange:e=>Ce({...be,qualityImproved:e})}),e.jsx("label",{htmlFor:"quality-improved",className:"text-sm font-medium cursor-pointer",children:"Content quality has been improved"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{id:"accuracy-verified",checked:be.accuracyVerified,onCheckedChange:e=>Ce({...be,accuracyVerified:e})}),e.jsx("label",{htmlFor:"accuracy-verified",className:"text-sm font-medium cursor-pointer",children:"Information accuracy has been verified"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{id:"ready-review",checked:be.readyForReview,onCheckedChange:e=>Ce({...be,readyForReview:e})}),e.jsx("label",{htmlFor:"ready-review",className:"text-sm font-medium cursor-pointer",children:"Property is ready for approval review"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"handwritten-comments-reactivate",children:"Reactivation Notes & Comments"}),e.jsx(F,{id:"handwritten-comments-reactivate",placeholder:"Type your handwritten comments or notes here...",value:ke,onChange:e=>Se(e.target.value),className:"mt-1 min-h-[120px] font-handwriting",rows:6}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Add any additional observations, changes made, or special notes about the reactivation"})]})]}),e.jsxs(A,{children:[e.jsx(m,{variant:"outline",onClick:()=>te(!1),children:"Cancel"}),e.jsx(m,{className:"bg-blue-600 hover:bg-blue-700",onClick:async()=>{if(Y&&ye.trim())try{le({...re,[Y._id]:!0});const e=await r(`/subadmin/properties/${Y._id}/reactivate`,{method:"POST",body:JSON.stringify({approver:ye,notes:ke})});await l(e),ie({title:"Success",description:"Property reactivated and moved to pending review"}),te(!1),Pe(),Z(null),Re()}catch(e){ie({title:"Error",description:"Failed to reactivate property",variant:"destructive"})}finally{le({...re,[Y._id]:!1})}else ie({title:"Error",description:"Moderator name is required",variant:"destructive"})},disabled:!ye.trim()||re[Y?._id||""],children:re[Y?._id||""]?"Reactivating...":"Reactivate Property"})]})]})})]})};export{D as default};

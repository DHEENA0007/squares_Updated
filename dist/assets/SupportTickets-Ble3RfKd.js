import{j as e}from"./ui-DYmpZ3pJ.js";import{r as n}from"./router-2SVJvIbS.js";import{B as f,a as v,e as N,J as O,I as z,p as i,q as c,ai as U,r as o,s as d,v as r,z as V,Y as b,f as w,C as k,m as L}from"./index-BbgqWuYN.js";import{T as M}from"./textarea-Cl1lQCIh.js";import{D as q,f as E,a as H,b as J,c as Y}from"./dialog-DsX3mE8Q.js";import{C as G}from"./calendar-BL1izdXI.js";import{C as K}from"./circle-alert-CzpJtozL.js";import"./vendor-Dazix4UH.js";const te=()=>{const[m,A]=n.useState([]),[_,y]=n.useState(!0),[l,S]=n.useState(null),[x,C]=n.useState(""),[h,D]=n.useState(""),[u,R]=n.useState("open"),[p,I]=n.useState(""),j=async()=>{y(!0);try{const s=new URLSearchParams({status:u,priority:p,search:h}),t=await fetch(`/api/admin/support/tickets?${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(t.ok){const a=await t.json();A(a.tickets)}}catch(s){console.error("Failed to fetch support tickets:",s)}finally{y(!1)}};n.useEffect(()=>{j()},[u,p,h]);const P=async s=>{if(x.trim())try{if((await fetch(`/api/admin/support/tickets/${s}/respond`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({message:x})})).ok&&(C(""),j(),l&&l._id===s)){const a=await fetch(`/api/admin/support/tickets/${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(a.ok){const g=await a.json();S(g.ticket)}}}catch(t){console.error("Failed to respond to ticket:",t)}},T=async(s,t)=>{try{(await fetch(`/api/admin/support/tickets/${s}/status`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({status:t})})).ok&&j()}catch(a){console.error("Failed to update ticket status:",a)}},$=s=>{const t={low:"bg-blue-100 text-blue-800",medium:"bg-yellow-100 text-yellow-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"};return t[s]||t.medium},B=s=>{const t={open:"bg-green-100 text-green-800",in_progress:"bg-blue-100 text-blue-800",resolved:"bg-purple-100 text-purple-800",closed:"bg-gray-100 text-gray-800"};return t[s]||t.open},F=s=>{switch(s){case"open":return K;case"in_progress":return L;case"resolved":case"closed":return k;default:return b}};return _?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Support Tickets"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Handle customer complaints and support requests"})]}),e.jsxs(f,{variant:"outline",className:"bg-blue-100 text-blue-800",children:[m.length," Total Tickets"]})]}),e.jsx(v,{children:e.jsx(N,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(z,{placeholder:"Search tickets...",value:h,onChange:s=>D(s.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsxs(i,{value:u,onValueChange:R,children:[e.jsxs(c,{children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),e.jsx(o,{})]}),e.jsxs(d,{children:[e.jsx(r,{value:"open",children:"Open"}),e.jsx(r,{value:"in_progress",children:"In Progress"}),e.jsx(r,{value:"resolved",children:"Resolved"}),e.jsx(r,{value:"closed",children:"Closed"}),e.jsx(r,{value:"",children:"All Status"})]})]})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsxs(i,{value:p,onValueChange:I,children:[e.jsx(c,{children:e.jsx(o,{placeholder:"All Priorities"})}),e.jsxs(d,{children:[e.jsx(r,{value:"urgent",children:"Urgent"}),e.jsx(r,{value:"high",children:"High"}),e.jsx(r,{value:"medium",children:"Medium"}),e.jsx(r,{value:"low",children:"Low"}),e.jsx(r,{value:"",children:"All Priorities"})]})]})})]})})}),e.jsx("div",{className:"space-y-4",children:m.map(s=>{const t=F(s.status);return e.jsx(v,{className:"hover:shadow-md transition-shadow",children:e.jsx(N,{className:"pt-6",children:e.jsx("div",{className:"flex flex-col lg:flex-row gap-6",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(t,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.subject}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Ticket #",s.ticketNumber]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{className:$(s.priority),children:s.priority.charAt(0).toUpperCase()+s.priority.slice(1)}),e.jsx(f,{className:B(s.status),children:s.status.replace("_"," ").charAt(0).toUpperCase()+s.status.replace("_"," ").slice(1)})]})]}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsx("span",{children:s.user.name})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:new Date(s.createdAt).toLocaleDateString()})]}),s.responses.length>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.responses.length," responses"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(q,{children:[e.jsx(E,{asChild:!0,children:e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>S(s),children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"View & Respond"]})}),e.jsxs(H,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(J,{children:e.jsxs(Y,{children:["Ticket #",s.ticketNumber," - ",s.subject]})}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Customer"}),e.jsx("p",{className:"text-sm",children:l.user.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.user.email})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Status"}),e.jsxs(i,{value:l.status,onValueChange:a=>T(l._id,a),children:[e.jsx(c,{className:"w-full",children:e.jsx(o,{})}),e.jsxs(d,{children:[e.jsx(r,{value:"open",children:"Open"}),e.jsx(r,{value:"in_progress",children:"In Progress"}),e.jsx(r,{value:"resolved",children:"Resolved"}),e.jsx(r,{value:"closed",children:"Closed"})]})]})]})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Original Message"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:l.description})]}),l.responses.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold",children:"Conversation"}),l.responses.map((a,g)=>e.jsxs("div",{className:`p-3 rounded-lg ${a.isAdmin?"bg-blue-50 border-l-4 border-blue-500 ml-4":"bg-gray-50 border-l-4 border-gray-500 mr-4"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-sm font-semibold",children:a.isAdmin?"Support Team":l.user.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(a.createdAt).toLocaleString()})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:a.message})]},g))]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold",children:"Add Response"}),e.jsx(M,{placeholder:"Type your response here...",value:x,onChange:a=>C(a.target.value),rows:4}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(w,{variant:"outline",children:"Save Draft"}),e.jsx(w,{onClick:()=>P(l._id),children:"Send Response"})]})]})]})]})]}),e.jsxs(i,{value:s.status,onValueChange:a=>T(s._id,a),children:[e.jsx(c,{className:"w-32",children:e.jsx(o,{})}),e.jsxs(d,{children:[e.jsx(r,{value:"open",children:"Open"}),e.jsx(r,{value:"in_progress",children:"In Progress"}),e.jsx(r,{value:"resolved",children:"Resolved"}),e.jsx(r,{value:"closed",children:"Closed"})]})]})]})]})]})})})},s._id)})}),m.length===0&&e.jsx(v,{children:e.jsx(N,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Support Tickets"}),e.jsx("p",{className:"text-muted-foreground",children:"No support tickets match your current filters."})]})})})]})};export{te as default};

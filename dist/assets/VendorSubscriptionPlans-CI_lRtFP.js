const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/paymentService-DG_ZS3CT.js","assets/index-XQ_rcKIR.js","assets/ui-BNZSgpjP.js","assets/router-D8v2YSKU.js","assets/vendor-BxThA0WO.js","assets/vendorService-dJLwfVSS.js","assets/reviewsService-C4w7aIB9.js"])))=>i.map(i=>d[i]);
import{a2 as e,bK as s,Q as t,S as a,f as r,A as l,G as n,B as i,a as c,b as d,c as o,e as m,C as x,U as u,W as h,$ as p,bN as j}from"./index-XQ_rcKIR.js";import{j as g}from"./ui-BNZSgpjP.js";import{r as b,d as f}from"./router-D8v2YSKU.js";import{a as N}from"./addonService-BLnNapMr.js";import{p as v}from"./planService-0_1WHZx0.js";import{Z as y}from"./zap-DkCrvaua.js";import{A as w}from"./arrow-right-XOaWFES0.js";import{S}from"./share-2-Bl_niqXF.js";import{V as C}from"./video-BUnoALXN.js";import{C as _}from"./camera-BZjIGS9C.js";import"./vendor-BxThA0WO.js";const P=()=>{const[P,L]=b.useState(1),[A,k]=b.useState(null),[$,E]=b.useState([]),[Y,M]=b.useState([]),[z,B]=b.useState(null),[O,T]=b.useState(!0),[F]=b.useState("monthly"),[R,I]=b.useState(!1),[U,D]=b.useState(!0),[V,Q]=b.useState([]),[Z,q]=b.useState(!0),{toast:G}=e(),H=f();b.useEffect(()=>{K(),te(),ee()},[]);const K=async()=>{try{q(!0);const e=await v.getPlans({isActive:!0});if(e.success&&e.data.plans){const s=e.data.plans.sort((e,s)=>e.sortOrder-s.sortOrder).map(e=>({id:e._id,name:e.name,price:e.price,description:e.description,icon:W(e.name),recommended:e.isPopular,billingPeriod:e.billingPeriod,billingCycleMonths:e.billingCycleMonths||1,features:Array.isArray(e.features)?e.features.map(e=>"string"==typeof e?e:e.name):[]}));Q(s)}}catch(e){G({title:"Error",description:"Failed to load subscription plans. Please try again.",variant:"destructive"})}finally{q(!1)}},W=e=>{const r=e.toLowerCase();return r.includes("free")?g.jsx(s,{className:"w-8 h-8 text-gray-600"}):r.includes("basic")?g.jsx(t,{className:"w-8 h-8 text-green-600"}):r.includes("standard")?g.jsx(y,{className:"w-8 h-8 text-blue-600"}):r.includes("premium")?g.jsx(a,{className:"w-8 h-8 text-purple-600"}):r.includes("enterprise")?g.jsx(a,{className:"w-8 h-8 text-gold-600"}):g.jsx(t,{className:"w-8 h-8 text-gray-600"})},J=e=>{const s=e.billingCycleMonths||1;return 1===s?"month":12===s?"year":`${s} months`},X=e=>{const s=e.billingCycleMonths||1;return 1===s?"Billed monthly":12===s?"Billed annually":`Billed every ${s} months`},ee=async()=>{try{T(!0);const e=await fetch("https://app.buildhomemartsquares.com/api/vendors/subscription-status",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok){const s=await e.json();s.success&&s.data.hasActiveSubscription&&B(s.data.subscription)}}catch(e){}finally{T(!1)}},se=(e,t)=>{const a={className:"w-6 h-6"};switch(e){case"photography":return"video"===t?g.jsx(C,{...a}):g.jsx(_,{...a});case"marketing":return"search"===t?g.jsx(p,{...a}):g.jsx(S,{...a});case"technology":return g.jsx(y,{...a});case"support":return g.jsx(h,{...a});case"crm":return g.jsx(u,{...a});default:return g.jsx(s,{...a})}},te=async()=>{try{D(!0);const e=await N.getAddons();M(e.filter(e=>e.isActive))}catch(e){G({title:"Failed to load addons",description:"Using default addon services",variant:"destructive"})}finally{D(!1)}},ae=e=>0===e.price?(e.id,"FREE"):`â‚¹${e.price.toLocaleString()}`,re=()=>A?A.price+$.reduce((e,s)=>e+s.price,0):0,le=async()=>{if(A){I(!0);try{const s={planId:A.id,addons:$.map(e=>e._id),billingCycle:"monthly",totalAmount:re()},{paymentService:t}=await j(async()=>{const{paymentService:e}=await import("./paymentService-DG_ZS3CT.js");return{paymentService:e}},__vite__mapDeps([0,1,2,3,4])),a=await t.processSubscriptionPayment(s);if(!a.success)throw new Error(a.message||"Payment failed");G({title:"Payment Successful!",description:`Successfully subscribed to ${A.name}${$.length>0?` with ${$.length} addon(s)`:""}`});try{const{vendorService:e}=await j(async()=>{const{vendorService:e}=await import("./vendorService-dJLwfVSS.js");return{vendorService:e}},__vite__mapDeps([5,1,2,3,4,6]));await e.refreshSubscriptionData()}catch(e){}H("/vendor/subscription-manager")}catch(s){G({title:"Payment Failed",description:s instanceof Error?s.message:"Failed to process payment",variant:"destructive"})}finally{I(!1)}}};return g.jsxs("div",{className:"space-y-8",children:[g.jsx("div",{className:"flex items-center justify-center mb-8",children:[{step:1,label:"Choose Plan"},{step:2,label:"Add Services"},{step:3,label:"Payment"}].map(({step:e,label:s},t)=>g.jsxs("div",{className:"flex items-center",children:[g.jsxs("div",{className:"flex flex-col items-center",children:[g.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium "+(e<=P?"bg-blue-600 text-white":"bg-muted text-muted-foreground"),children:e}),g.jsx("span",{className:"text-xs mt-2 "+(e<=P?"text-blue-600 font-medium":"text-muted-foreground"),children:s})]}),t<2&&g.jsx("div",{className:"w-16 h-0.5 mx-4 mt-2 "+(e<P?"bg-blue-600":"bg-border")})]},e))}),1===P&&(Z?g.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:g.jsx(n,{className:"h-8 w-8 animate-spin text-primary"})}):g.jsxs("div",{className:"space-y-8",children:[g.jsxs("div",{className:"text-center",children:[g.jsx("h1",{className:"text-3xl font-bold text-foreground mb-4",children:z?"Upgrade Your Subscription Plan":"Choose Your Subscription Plan"}),g.jsx("p",{className:"text-muted-foreground text-lg mb-8",children:z?`You currently have the ${z.planName}. Select a higher-priced plan to upgrade.`:"Select the plan that best fits your business needs"}),g.jsxs("div",{className:"text-center mb-8",children:[g.jsx(i,{variant:"outline",className:"px-4 py-2 text-sm",children:"Monthly Billing - No Long-term Commitments"}),z&&g.jsx("div",{className:"mt-2",children:g.jsxs(i,{variant:"secondary",className:"px-3 py-1 text-xs",children:[V.filter(e=>{if("free"===e.id)return!1;const s=V.find(e=>e.name.toLowerCase().includes(z.planName?.toLowerCase())||z.planName?.toLowerCase().includes(e.name.toLowerCase())),t=s?.price||0;return e.price>t}).length," Upgrade Options Available"]})})]})]}),g.jsxs("div",{className:"grid md:grid-cols-3 gap-8",children:[V.filter(e=>{if("free"===e.id)return!1;if(z){const s=V.find(e=>e.name.toLowerCase().includes(z.planName?.toLowerCase())||z.planName?.toLowerCase().includes(e.name.toLowerCase())),t=s?.price||0;return e.price>t}return!0}).map(e=>{const s=z&&z.planName?.toLowerCase().includes(e.name.toLowerCase());return g.jsxs(c,{className:`relative cursor-pointer transition-all duration-200 hover:shadow-lg border-2 ${A?.id===e.id?"border-blue-600 shadow-lg bg-blue-50/50":"border-border hover:border-blue-300"} ${e.recommended?"border-yellow-400":""} ${s?"opacity-50 cursor-not-allowed":""}`,onClick:()=>!s&&(e=>{k(e)})(e),children:[e.recommended&&g.jsx(i,{className:"absolute -top-3 left-1/2 transform -translate-x-1/2 bg-yellow-600 hover:bg-yellow-600",children:"Most Popular"}),s&&g.jsx(i,{className:"absolute -top-3 right-4 bg-green-600 hover:bg-green-600",children:"Current Plan"}),g.jsxs(d,{className:"text-center pb-6",children:[g.jsx("div",{className:"flex justify-center mb-4",children:e.icon}),g.jsx(o,{className:"text-2xl font-bold",children:e.name}),g.jsxs("div",{className:"text-4xl font-bold text-blue-600 mt-4",children:[ae(e),e.price>0&&g.jsxs("span",{className:"text-lg text-muted-foreground font-normal",children:["/",J(e)]})]}),g.jsx("p",{className:"text-muted-foreground mt-2",children:e.description})]}),g.jsx(m,{children:g.jsx("ul",{className:"space-y-4",children:e.features.map((e,s)=>{const t="string"==typeof e?e:e.name||"";return g.jsxs("li",{className:"flex items-center",children:[g.jsx(x,{className:"w-5 h-5 text-green-600 mr-3 flex-shrink-0"}),g.jsx("span",{className:"text-sm text-foreground",children:t})]},s)})})})]},e.id)}),z&&0===V.filter(e=>{if("free"===e.id)return!1;const s=z.amount||0;return e.price>s}).length&&g.jsxs("div",{className:"col-span-full text-center py-12",children:[g.jsx(a,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),g.jsx("h3",{className:"text-2xl font-bold mb-2",children:"You're on the best plan available!"}),g.jsxs("p",{className:"text-gray-600 mb-2",children:["You currently have the ",z.planName," (â‚¹",z.amount?.toLocaleString()||0,"/month)"]}),g.jsx("p",{className:"text-gray-600 mb-6",children:"There are no higher plans available to upgrade to at this time."}),g.jsx(r,{variant:"outline",onClick:()=>H("/vendor/subscription-manager"),children:"Manage Current Plan"})]})]})]})),2===P&&g.jsxs("div",{className:"space-y-8",children:[g.jsxs("div",{className:"text-center",children:[g.jsx("h1",{className:"text-3xl font-bold text-foreground mb-4",children:"Enhance Your Plan"}),g.jsx("p",{className:"text-muted-foreground text-lg mb-8",children:z?.addons?.length>0?`Add more services to boost your property marketing. You currently have ${z.addons.length} addon(s).`:"Add optional services to boost your property marketing"})]}),U?g.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3,4,5,6].map(e=>g.jsxs(c,{className:"h-48 animate-pulse",children:[g.jsxs(d,{children:[g.jsx("div",{className:"h-4 bg-muted rounded w-3/4"}),g.jsx("div",{className:"h-6 bg-muted rounded w-1/2"})]}),g.jsxs(m,{children:[g.jsx("div",{className:"h-3 bg-muted rounded w-full mb-2"}),g.jsx("div",{className:"h-3 bg-muted rounded w-2/3"})]})]},e))}):g.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:Y.filter(e=>!z?.addons||!z.addons.some(s=>s._id===e._id)).map(e=>{const t=$.some(s=>s._id===e._id),a=z?.addons?.some(s=>s._id===e._id);return g.jsxs(c,{className:`cursor-pointer transition-all duration-200 hover:shadow-md border-2 ${t?"border-blue-600 bg-blue-50/50 shadow-md":"border-border hover:border-blue-300"} ${a?"opacity-50 cursor-not-allowed":""}`,onClick:()=>!a&&(e=>{E(s=>s.find(s=>s._id===e._id)?s.filter(s=>s._id!==e._id):[...s,e])})(e),children:[g.jsxs(d,{className:"pb-3",children:[g.jsxs("div",{className:"flex items-start justify-between",children:[g.jsxs("div",{className:"flex items-center space-x-3",children:[g.jsx("div",{className:"p-2 rounded-lg bg-muted",children:se(e.category,e.icon)}),g.jsxs("div",{children:[g.jsx(o,{className:"text-lg font-semibold",children:e.name}),g.jsx(i,{variant:"outline",className:"mt-1 capitalize text-xs",children:e.category})]})]}),a?g.jsx(i,{className:"bg-green-600 hover:bg-green-600 text-white",children:"Purchased"}):t?g.jsx(x,{className:"w-6 h-6 text-blue-600 flex-shrink-0"}):g.jsx(s,{className:"w-6 h-6 text-muted-foreground flex-shrink-0"})]}),g.jsxs("div",{className:"text-2xl font-bold text-blue-600 mt-2",children:["â‚¹",e.price.toLocaleString(),g.jsxs("span",{className:"text-sm text-muted-foreground font-normal",children:["/",e.billingType.replace("_"," ").replace("per property","per listing")]})]})]}),g.jsx(m,{children:g.jsx("p",{className:"text-muted-foreground text-sm leading-relaxed",children:e.description})})]},e._id)})}),!U&&0===Y.length&&g.jsx("div",{className:"text-center py-12",children:g.jsxs("div",{className:"text-muted-foreground",children:[g.jsx(s,{className:"w-12 h-12 mx-auto mb-4"}),g.jsx("p",{className:"text-lg",children:"No addon services available at the moment."}),g.jsx("p",{className:"text-sm",children:"You can continue without addons or check back later."})]})})]}),3===P&&g.jsxs("div",{className:"space-y-8",children:[g.jsxs("div",{className:"text-center",children:[g.jsx("h1",{className:"text-3xl font-bold text-foreground mb-4",children:"Payment Summary"}),g.jsx("p",{className:"text-muted-foreground text-lg mb-8",children:"Review your selection and complete payment"})]}),g.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[g.jsxs(c,{children:[g.jsx(d,{children:g.jsx(o,{className:"text-xl",children:"Order Summary"})}),g.jsxs(m,{className:"space-y-6",children:[g.jsxs("div",{className:"flex items-center justify-between py-4 border-b",children:[g.jsxs("div",{className:"flex items-center space-x-4",children:[g.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:A?.icon}),g.jsxs("div",{children:[g.jsxs("h4",{className:"font-semibold text-lg",children:[A?.name," Plan"]}),g.jsx("p",{className:"text-sm text-muted-foreground",children:A&&X(A)})]})]}),g.jsx("div",{className:"text-right",children:g.jsxs("p",{className:"font-bold text-lg",children:["â‚¹",A?.price||0]})})]}),$.length>0&&g.jsxs("div",{className:"space-y-4",children:[g.jsx("h4",{className:"font-semibold text-lg",children:"Add-on Services"}),$.map(e=>g.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-dashed",children:[g.jsxs("div",{className:"flex items-center space-x-3",children:[g.jsx("div",{className:"p-1.5 rounded bg-muted",children:se(e.category,e.icon)}),g.jsxs("div",{children:[g.jsx("p",{className:"font-medium",children:e.name}),g.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:e.billingType.replace("_"," ")})]})]}),g.jsxs("p",{className:"font-semibold",children:["â‚¹",e.price.toLocaleString()]})]},e._id))]}),g.jsxs("div",{className:"flex items-center justify-between py-4 border-t-2 border-border",children:[g.jsx("span",{className:"text-xl font-bold",children:"Total Amount"}),g.jsxs("span",{className:"text-2xl font-bold text-blue-600",children:["â‚¹",re().toLocaleString()]})]})]})]}),g.jsxs("div",{className:"text-center space-y-4",children:[g.jsx(r,{size:"lg",onClick:le,disabled:R,className:"min-w-[250px] h-12 text-lg",children:R?"Processing...":`Pay â‚¹${re().toLocaleString()}`}),g.jsx("p",{className:"text-sm text-muted-foreground",children:"ðŸ”’ Secure payment powered by Razorpay"})]})]})]}),g.jsxs("div",{className:"flex justify-between pt-8",children:[g.jsxs(r,{variant:"outline",onClick:()=>{L(e=>Math.max(e-1,1))},disabled:1===P,className:"flex items-center space-x-2",size:"lg",children:[g.jsx(l,{className:"w-4 h-4"}),g.jsx("span",{children:"Previous"})]}),P<3&&g.jsxs(r,{onClick:()=>{1!==P||A?L(e=>Math.min(e+1,3)):G({title:"Please select a plan",description:"You must select a subscription plan to continue",variant:"destructive"})},className:"flex items-center space-x-2",size:"lg",children:[g.jsx("span",{children:"Next"}),g.jsx(w,{className:"w-4 h-4"})]})]})]})};export{P as default};

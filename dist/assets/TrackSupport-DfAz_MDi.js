import{j as e}from"./ui-s1SEoZIF.js";import{r as s,L as t}from"./router-D8v2YSKU.js";import{_ as a,v as r,b4 as i,f as l,a as n,b as c,c as d,d as o,e as m,L as x,I as u,X as h,ab as p,ac as j,ad as g,ae as b,aB as v,b5 as N,b6 as y,b7 as k,B as f,b8 as w,E as C,a0 as T,a1 as S,a2 as L,a3 as A,a4 as D,T as R,C as E,W as O,b9 as Y,h as P}from"./index-YrVmIx3a.js";import{L as B}from"./log-in-B9a9y0e3.js";import{C as F}from"./circle-alert-uA9gvtJK.js";import"./vendor-BxThA0WO.js";const I=()=>{const{toast:I}=a(),[U,V]=s.useState([]),[_,q]=s.useState(!1),[H,$]=s.useState("all"),[z,M]=s.useState(""),[K,W]=s.useState(""),[X,G]=s.useState(""),[J,Q]=s.useState(null),[Z,ee]=s.useState(!1),[se,te]=s.useState(!1),[ae,re]=s.useState(""),[ie,le]=s.useState(!1),[ne,ce]=s.useState(!1);s.useEffect(()=>{const e=r.getToken();ce(!!e),e&&de()},[H]);const de=async()=>{if(ne)try{q(!0);const e={};"all"!==H&&(e.status=H);const s=await i.getMyTickets(e);V(s.data.tickets)}catch(e){e.message?.includes("token")||e.message?.includes("401")||I({title:"Error",description:"Failed to fetch tickets",variant:"destructive"})}finally{q(!1)}else V([])},oe=e=>{const s={open:{icon:F,class:"bg-blue-600",label:"Open"},in_progress:{icon:P,class:"bg-yellow-600",label:"In Progress"},resolved:{icon:E,class:"bg-green-600",label:"Resolved"},closed:{icon:O,class:"bg-gray-600",label:"Closed"}};return s[e]||s.open},me=e=>{const s={low:"bg-gray-100 text-gray-800",normal:"bg-blue-100 text-blue-800",medium:"bg-blue-100 text-blue-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"};return s[e]||s.normal},xe=e=>{const s={open:"Your ticket has been received and is waiting to be reviewed",in_progress:"Our support team is currently working on your ticket",resolved:"Your issue has been resolved. You can reopen if needed",closed:"This ticket has been closed and is archived"};return s[e]||s.open},ue=e=>{const s={low:"Low priority - Response within 3-5 business days",normal:"Normal priority - Response within 1-2 business days",medium:"Normal priority - Response within 1-2 business days",high:"High priority - Response within 24 hours",urgent:"Urgent - Immediate attention required"};return s[e]||s.normal},he=U.filter(e=>e.subject.toLowerCase().includes(z.toLowerCase())||e.ticketNumber.toLowerCase().includes(z.toLowerCase()));return e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Support & Help Desk"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track your support requests and get help"})]}),e.jsx(l,{onClick:()=>te(!0),children:"Create Support Ticket"})]}),!ne&&e.jsxs(n,{children:[e.jsxs(c,{children:[e.jsx(d,{children:"Track Ticket by Number"}),e.jsx(o,{children:"Enter your ticket number and email to view its status"})]}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"ticketNumber",children:"Ticket Number"}),e.jsx(u,{id:"ticketNumber",placeholder:"TKT-123456",value:K,onChange:e=>W(e.target.value.toUpperCase())})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"trackingEmail",children:"Email Address"}),e.jsx(u,{id:"trackingEmail",type:"email",placeholder:"your@email.com",value:X,onChange:e=>G(e.target.value)})]})]}),e.jsxs(l,{onClick:async()=>{if(K.trim())if(X.trim())try{const e=await i.getTicketByNumber(K,X);Q(e.data.ticket),ee(!0)}catch(e){}else I({title:"Validation Error",description:"Please enter your email address",variant:"destructive"});else I({title:"Validation Error",description:"Please enter a ticket number",variant:"destructive"})},className:"w-full md:w-auto",children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"Track Ticket"]})]})})]}),e.jsxs(n,{children:[e.jsxs(c,{children:[e.jsx(d,{children:"My Support Tickets"}),e.jsx(o,{children:ne?"View and manage your support requests":"Login to view your support tickets"})]}),e.jsx(m,{children:ne?_?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading tickets..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(h,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(u,{placeholder:"Search by ticket title or ticket ID...",value:z,onChange:e=>M(e.target.value),className:"pl-10"})]}),e.jsxs(p,{value:H,onValueChange:$,children:[e.jsxs(j,{children:[e.jsx(g,{value:"all",children:"All"}),e.jsx(g,{value:"open",children:"Open"}),e.jsx(g,{value:"in_progress",children:"In Progress"}),e.jsx(g,{value:"resolved",children:"Resolved"}),e.jsx(g,{value:"closed",children:"Closed"})]}),e.jsx(b,{value:H,className:"space-y-4 mt-4",children:0===he.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(v,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Tickets Found"}),e.jsx("p",{className:"text-muted-foreground",children:"all"===H?"You haven't created any support tickets yet":`No ${H} tickets to display`})]}):he.map(s=>{const t=oe(s.status),a=t.icon;return e.jsxs(n,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(c,{children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"text-lg",children:s.subject}),e.jsx(N,{children:e.jsxs(y,{children:[e.jsx(k,{children:e.jsxs(f,{className:t.class,children:[e.jsx(a,{className:"w-3 h-3 mr-1"}),t.label]})}),e.jsx(w,{children:e.jsx("p",{children:xe(s.status)})})]})}),e.jsx(N,{children:e.jsxs(y,{children:[e.jsx(k,{children:e.jsx(f,{className:me(s.priority),children:(r=s.priority,{low:"Low",normal:"Normal",medium:"Normal",high:"High",urgent:"Urgent"}[r]||"Normal")})}),e.jsx(w,{children:e.jsx("p",{children:ue(s.priority)})})]})})]}),e.jsxs(o,{children:["Ticket #",s.ticketNumber," • Created: ",new Date(s.createdAt).toLocaleDateString()," • Updated: ",new Date(s.updatedAt).toLocaleDateString()]})]})})}),e.jsxs(m,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-2",children:s.description}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{Q(s),ee(!0)},children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"View Details"]})]})]},s._id);var r})})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(B,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Authentication Required"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Please login to view and manage your support tickets"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(l,{asChild:!0,children:e.jsx(t,{to:"/login",children:"Login"})}),e.jsx(l,{variant:"outline",asChild:!0,children:e.jsx(t,{to:"/signup",children:"Create Account"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-6",children:'Already have a ticket? Use the "Track by Number" section above to check your ticket status.'})]})})]}),e.jsx(T,{open:Z,onOpenChange:ee,children:e.jsxs(S,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(L,{children:[e.jsx(A,{children:"Ticket Details"}),e.jsxs(D,{children:["Ticket #",J?.ticketNumber]})]}),J&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Status"}),e.jsx("div",{className:"mt-1",children:e.jsx(f,{className:oe(J.status).class,children:oe(J.status).label})})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Priority"}),e.jsx("div",{className:"mt-1",children:e.jsx(f,{className:me(J.priority),children:J.priority.toUpperCase()})})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Category"}),e.jsx("p",{className:"text-sm mt-1 capitalize",children:J.category})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Created"}),e.jsx("p",{className:"text-sm mt-1",children:new Date(J.createdAt).toLocaleString()})]})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Subject"}),e.jsx("p",{className:"text-sm mt-1 font-semibold",children:J.subject})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Description"}),e.jsx("p",{className:"text-sm mt-1 whitespace-pre-wrap",children:J.description})]}),J.responses&&J.responses.length>0&&e.jsxs("div",{children:[e.jsx(x,{children:"Conversation"}),e.jsx("div",{className:"space-y-3 mt-2",children:J.responses.map((s,t)=>e.jsxs("div",{className:"p-4 rounded-lg "+(s.isAdmin?"bg-blue-50 dark:bg-blue-950":"bg-muted"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm",children:s.author}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.isAdmin?"Support Team":"You"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleString()})]}),e.jsx("p",{className:"text-sm",children:s.message})]},t))})]}),"closed"!==J.status&&"resolved"!==J.status&&e.jsxs("div",{children:[e.jsx(x,{children:"Add Response"}),e.jsx(R,{placeholder:"Type your message...",value:ae,onChange:e=>re(e.target.value),rows:4,className:"mt-2"}),e.jsx("div",{className:"flex gap-2 mt-2",children:e.jsxs(l,{onClick:async()=>{if(J&&ae.trim())try{if(le(!0),await i.addResponse(J.ticketNumber,ae),re(""),I({title:"Success",description:"Your reply has been sent. Our support team will respond soon."}),ne){const e=await i.getTicketByNumberAuth(J.ticketNumber);Q(e.data.ticket),de()}else{const e=await i.getTicketByNumber(J.ticketNumber,X||J.email);Q(e.data.ticket)}}catch(e){}finally{le(!1)}else I({title:"Validation Error",description:"Please enter a message",variant:"destructive"})},disabled:ie,children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),ie?"Sending...":"Send Reply"]})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Our support team will review and respond to your message. Only support staff can resolve tickets."})]}),"resolved"===J.status&&e.jsx("div",{className:"bg-green-50 dark:bg-green-950 border border-green-200 dark:border-green-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(E,{className:"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:"Ticket Resolved"}),e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300 mt-1",children:["This ticket has been marked as resolved by our support team.",J.resolvedAt&&` on ${new Date(J.resolvedAt).toLocaleDateString()}`]}),J.responses&&J.responses.length>0&&e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400 mt-2",children:"If you need further assistance, please create a new support ticket."})]})]})}),"closed"===J.status&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(O,{className:"h-5 w-5 text-gray-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:"Ticket Closed"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mt-1",children:"This ticket has been closed. For new issues, please create a new support ticket."})]})]})})]})]})}),e.jsx(Y,{open:se,onOpenChange:te,onSuccess:e=>{I({title:"Ticket Created",description:`Your ticket number is ${e}. You can track it anytime.`}),de()}})]})};export{I as default};

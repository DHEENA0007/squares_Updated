import{j as e}from"./ui-s1SEoZIF.js";import{r as s}from"./router-D8v2YSKU.js";import{a5 as t,a as r,b as a,c as i,aF as l,e as n,E as o,K as d,V as c,a2 as x,I as h,s as m,v as p,w as j,x as u,y as v,f,al as w,d as g,af as N,a7 as y,a8 as b,a9 as R,aa as S,ab as C,L as k,T as A,ag as E,B as F}from"./index-l5vY_naC.js";import{A as $,b as T,c as L,d as z,e as D,f as B,g as O,h as P}from"./alert-dialog-X5JFP3yd.js";import{F as I}from"./flag-C4CvuWmD.js";import"./vendor-BxThA0WO.js";const _="https://app.buildhomemartsquares.com/api",V=()=>{const{toast:V}=t(),[q,M]=s.useState(!0),[J,H]=s.useState([]),[K,W]=s.useState({total:0,active:0,reported:0,averageRating:0}),[G,Q]=s.useState(null),[U,X]=s.useState(!1),[Y,Z]=s.useState(!1),[ee,se]=s.useState(!1),[te,re]=s.useState(!1),[ae,ie]=s.useState(""),[le,ne]=s.useState(""),[oe,de]=s.useState(!1),[ce,xe]=s.useState({search:"",status:"all",rating:"all"});s.useEffect(()=>{he()},[]);const he=async()=>{try{M(!0);const e=localStorage.getItem("token"),[s,t]=await Promise.all([fetch(`${_}/admin/reviews`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),fetch(`${_}/admin/reviews/stats`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})]);if(s.ok){const e=await s.json();H(e.data.reviews||[])}if(t.ok){const e=await t.json();W(e.data.stats||K)}}catch(e){V({title:"Error",description:"Failed to load reviews",variant:"destructive"})}finally{M(!1)}},me=s=>s.isReported||"reported"===s.status?e.jsx(F,{variant:"destructive",children:"Reported"}):"hidden"===s.status?e.jsx(F,{variant:"secondary",children:"Hidden"}):e.jsx(F,{variant:"default",children:"Active"}),pe=J.filter(e=>{const s=e.comment.toLowerCase().includes(ce.search.toLowerCase())||e.property.title.toLowerCase().includes(ce.search.toLowerCase())||`${e.user.profile.firstName} ${e.user.profile.lastName}`.toLowerCase().includes(ce.search.toLowerCase()),t="all"===ce.status||"reported"===ce.status&&e.isReported||"active"===ce.status&&!e.isReported&&"active"===e.status,r="all"===ce.rating||e.rating.toString()===ce.rating;return s&&t&&r});return q?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Review Management"}),e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"Monitor and manage property reviews"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(r,{children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Total Reviews"}),e.jsx(l,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(n,{children:e.jsx("div",{className:"text-2xl font-bold",children:K.total})})]}),e.jsxs(r,{children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Active Reviews"}),e.jsx(o,{className:"h-4 w-4 text-green-600"})]}),e.jsx(n,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:K.active})})]}),e.jsxs(r,{children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Reported Reviews"}),e.jsx(d,{className:"h-4 w-4 text-red-600"})]}),e.jsx(n,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:K.reported})})]}),e.jsxs(r,{children:[e.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Average Rating"}),e.jsx(c,{className:"h-4 w-4 text-yellow-600"})]}),e.jsx(n,{children:e.jsx("div",{className:"text-2xl font-bold",children:K.averageRating.toFixed(1)})})]})]}),e.jsx(r,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(h,{placeholder:"Search reviews...",value:ce.search,onChange:e=>xe({...ce,search:e.target.value})})]}),e.jsxs(m,{value:ce.status,onValueChange:e=>xe({...ce,status:e}),children:[e.jsx(p,{children:e.jsx(j,{placeholder:"Filter by status"})}),e.jsxs(u,{children:[e.jsx(v,{value:"all",children:"All Reviews"}),e.jsx(v,{value:"active",children:"Active"}),e.jsx(v,{value:"reported",children:"Reported"})]})]}),e.jsxs(m,{value:ce.rating,onValueChange:e=>xe({...ce,rating:e}),children:[e.jsx(p,{children:e.jsx(j,{placeholder:"Filter by rating"})}),e.jsxs(u,{children:[e.jsx(v,{value:"all",children:"All Ratings"}),e.jsx(v,{value:"5",children:"5 Stars"}),e.jsx(v,{value:"4",children:"4 Stars"}),e.jsx(v,{value:"3",children:"3 Stars"}),e.jsx(v,{value:"2",children:"2 Stars"}),e.jsx(v,{value:"1",children:"1 Star"})]})]}),e.jsxs(f,{variant:"outline",onClick:he,children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Refresh"]})]})})}),e.jsxs(r,{children:[e.jsxs(a,{children:[e.jsxs(i,{children:["Reviews (",pe.length,")"]}),e.jsx(g,{children:"Manage and moderate property reviews"})]}),e.jsx(n,{children:0===pe.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(l,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"No Reviews Found"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"No reviews match your current filters"})]}):e.jsx("div",{className:"space-y-4",children:pe.map(s=>{return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("h3",{className:"font-semibold",children:[s.user.profile.firstName," ",s.user.profile.lastName]}),me(s)]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Property: ",s.property.title]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsx("div",{className:"flex items-center gap-1",children:(t=s.rating,Array.from({length:5},(s,r)=>e.jsx(c,{className:"w-4 h-4 "+(r<t?"fill-yellow-400 text-yellow-400":"text-gray-300")},r)))})]}),e.jsx("p",{className:"text-sm mb-3",children:s.comment}),s.response&&e.jsxs("div",{className:"bg-muted p-3 rounded-lg mb-3",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Admin Response:"}),e.jsx("p",{className:"text-sm",children:s.response.text}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["By ",s.response.respondedBy," â€¢ ",new Date(s.response.respondedAt).toLocaleDateString()]})]}),s.isReported&&s.reportReason&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-950 p-3 rounded-lg mb-3",children:[e.jsx("p",{className:"text-sm font-medium text-red-600 mb-1",children:"Reported:"}),e.jsx("p",{className:"text-sm text-red-600",children:s.reportReason})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>{Q(s),X(!0)},children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"View Details"]}),!s.response&&e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>{Q(s),se(!0)},children:[e.jsx(l,{className:"w-4 h-4 mr-2"}),"Respond"]}),!s.isReported&&e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>{Q(s),Z(!0)},children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Report"]}),e.jsxs(f,{variant:"destructive",size:"sm",onClick:()=>{Q(s),re(!0)},children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]},s._id);var t})})})]}),e.jsx(y,{open:Y,onOpenChange:Z,children:e.jsxs(b,{children:[e.jsxs(R,{children:[e.jsx(S,{children:"Report Review"}),e.jsx(C,{children:"Please provide a reason for reporting this review"})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"reportReason",children:"Report Reason *"}),e.jsx(A,{id:"reportReason",value:ae,onChange:e=>ie(e.target.value),placeholder:"Enter reason for reporting...",rows:4})]})}),e.jsxs(E,{children:[e.jsx(f,{variant:"outline",onClick:()=>Z(!1),children:"Cancel"}),e.jsx(f,{onClick:async()=>{if(G&&ae.trim())try{de(!0);const e=localStorage.getItem("token");if(!(await fetch(`${_}/admin/reviews/${G._id}/report`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({reason:ae})})).ok)throw new Error("Failed to report review");V({title:"Success",description:"Review reported successfully"}),Z(!1),ie(""),he()}catch(e){V({title:"Error",description:"Failed to report review",variant:"destructive"})}finally{de(!1)}else V({title:"Error",description:"Report reason is required",variant:"destructive"})},disabled:oe||!ae.trim(),children:"Submit Report"})]})]})}),e.jsx(y,{open:ee,onOpenChange:se,children:e.jsxs(b,{children:[e.jsxs(R,{children:[e.jsx(S,{children:"Respond to Review"}),e.jsx(C,{children:"Write your response to this review"})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"responseText",children:"Response *"}),e.jsx(A,{id:"responseText",value:le,onChange:e=>ne(e.target.value),placeholder:"Enter your response...",rows:4})]})}),e.jsxs(E,{children:[e.jsx(f,{variant:"outline",onClick:()=>se(!1),children:"Cancel"}),e.jsx(f,{onClick:async()=>{if(G&&le.trim())try{de(!0);const e=localStorage.getItem("token");if(!(await fetch(`${_}/admin/reviews/${G._id}/respond`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({responseText:le})})).ok)throw new Error("Failed to respond to review");V({title:"Success",description:"Response posted successfully"}),se(!1),ne(""),he()}catch(e){V({title:"Error",description:"Failed to respond to review",variant:"destructive"})}finally{de(!1)}else V({title:"Error",description:"Response text is required",variant:"destructive"})},disabled:oe||!le.trim(),children:"Post Response"})]})]})}),e.jsx($,{open:te,onOpenChange:re,children:e.jsxs(T,{children:[e.jsxs(L,{children:[e.jsx(z,{children:"Delete Review"}),e.jsx(D,{children:"Are you sure you want to delete this review? This action cannot be undone."})]}),e.jsxs(B,{children:[e.jsx(O,{children:"Cancel"}),e.jsx(P,{onClick:async()=>{if(G)try{de(!0);const e=localStorage.getItem("token");if(!(await fetch(`${_}/admin/reviews/${G._id}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})).ok)throw new Error("Failed to delete review");V({title:"Success",description:"Review deleted successfully"}),re(!1),he()}catch(e){V({title:"Error",description:"Failed to delete review",variant:"destructive"})}finally{de(!1)}},disabled:oe,children:"Delete Review"})]})]})})]})};export{V as default};

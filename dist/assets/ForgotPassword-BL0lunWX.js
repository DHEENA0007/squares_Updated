import{j as e}from"./ui-DHQhougw.js";import{d as s,r as t,L as a}from"./router-Bi51YGN-.js";import{z as r,N as i,a as n,e as o,L as l,M as d,I as c,f as m,A as u,E as p,F as x,t as h}from"./index-CV77Hym3.js";import{I as f,a as v,b as j}from"./input-otp-0XmdusGs.js";import{L as w}from"./lock-lqtm_Gd4.js";import{E as y}from"./eye-off-DR82pX0o.js";import"./vendor-eVk5PToZ.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g=r("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),P=()=>{const r=s(),[P,N]=t.useState("email"),[b,T]=t.useState(""),[S,O]=t.useState(""),[C,E]=t.useState(""),[k,R]=t.useState(""),[q,I]=t.useState(!1),[F,M]=t.useState(!1),[A,L]=t.useState(10),[D,Y]=t.useState(!1),[$,_]=t.useState(0);t.useEffect(()=>{if($>0){const e=setTimeout(()=>{_($-1)},1e3);return()=>clearTimeout(e)}Y(!0)},[$]);return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(i,{}),e.jsx("main",{className:"container mx-auto px-4 py-12",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold mb-2",children:["email"===P&&"Forgot Password","otp"===P&&"Reset Your Password","success"===P&&"Password Reset Successful"]}),e.jsxs("p",{className:"text-muted-foreground",children:["email"===P&&"Enter your email to receive a reset code","otp"===P&&"Enter the OTP sent to your email","success"===P&&"You can now login with your new password"]})]}),e.jsx(n,{children:e.jsxs(o,{className:"p-6",children:["email"===P&&e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!b)return void h({title:"Email Required",description:"Please enter your email address",variant:"destructive"});if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(b)){M(!0);try{const e=await fetch("https://api.buildhomemartsquares.com/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:b})}),s=await e.json();e.ok&&s.success?(N("otp"),s.expiryMinutes&&L(s.expiryMinutes),_(120),Y(!1),h({title:"OTP Sent!",description:"Check your email for the password reset code."})):429===e.status?h({title:"Too Many Requests",description:s.message||"Please wait before requesting another OTP",variant:"destructive"}):s.message&&!s.message.includes("exists")?h({title:"Error",description:s.message,variant:"destructive"}):(N("otp"),h({title:"Check Your Email",description:"If an account exists with this email, you will receive a password reset code."}))}catch(s){h({title:"Connection Error",description:"Failed to connect to the server. Please try again.",variant:"destructive"})}finally{M(!1)}}else h({title:"Invalid Email",description:"Please enter a valid email address",variant:"destructive"})},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"email",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(c,{id:"email",type:"email",placeholder:"you@example.com",value:b,onChange:e=>T(e.target.value),className:"pl-10",required:!0})]})]}),e.jsx(m,{type:"submit",className:"w-full",disabled:F,children:F?"Sending...":"Send Reset Code"}),e.jsx("div",{className:"text-center",children:e.jsxs(a,{to:"/login",className:"inline-flex items-center text-sm text-primary hover:underline",children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"Back to Login"]})})]}),"otp"===P&&e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!S||!C||!k)return void h({title:"All Fields Required",description:"Please fill in all fields",variant:"destructive"});if(6!==S.length)return void h({title:"Invalid OTP",description:"Please enter the complete 6-digit OTP",variant:"destructive"});if(C!==k)return void h({title:"Passwords Don't Match",description:"Please make sure your passwords match",variant:"destructive"});if(C.length<8)return void h({title:"Password Too Short",description:"Password must be at least 8 characters",variant:"destructive"});const s=/[A-Z]/.test(C),t=/[a-z]/.test(C),a=/[0-9]/.test(C),r=/[!@#$%^&*]/.test(C);if(s&&t&&a&&r){M(!0);try{const e=await fetch("https://api.buildhomemartsquares.com/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:b,otp:S,newPassword:C})}),s=await e.json();e.ok&&s.success?(N("success"),h({title:"Password Reset!",description:"Your password has been successfully reset."}),O(""),E(""),R("")):"OTP_EXPIRED"===s.error?(h({title:"OTP Expired",description:"Your OTP has expired. Please request a new one.",variant:"destructive"}),N("email")):"INVALID_OTP"===s.error?h({title:"Invalid OTP",description:s.attemptsLeft?`Invalid OTP. ${s.attemptsLeft} attempts remaining.`:"Invalid OTP. Please try again.",variant:"destructive"}):"MAX_ATTEMPTS_EXCEEDED"===s.error?(h({title:"Too Many Attempts",description:"Maximum attempts exceeded. Please request a new OTP.",variant:"destructive"}),N("email")):h({title:"Reset Failed",description:s.message||"Invalid OTP or password",variant:"destructive"})}catch(i){h({title:"Connection Error",description:"Failed to reset password. Please try again.",variant:"destructive"})}finally{M(!1)}}else h({title:"Weak Password",description:"Password must contain uppercase, lowercase, number, and special character (!@#$%^&*)",variant:"destructive"})},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(l,{className:"text-base",children:"Verification Code"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Enter the 6-digit code sent to ",b]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(f,{maxLength:6,value:S,onChange:e=>O(e),children:e.jsxs(v,{children:[e.jsx(j,{index:0}),e.jsx(j,{index:1}),e.jsx(j,{index:2}),e.jsx(j,{index:3}),e.jsx(j,{index:4}),e.jsx(j,{index:5})]})})}),e.jsxs("p",{className:"text-xs text-center text-muted-foreground",children:["Code expires in ",A," minutes"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"newPassword",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(c,{id:"newPassword",type:q?"text":"password",placeholder:"Enter new password",value:C,onChange:e=>E(e.target.value),className:"pl-10 pr-10",required:!0}),e.jsx("button",{type:"button",onClick:()=>I(!q),className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:q?e.jsx(y,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(p,{className:"h-5 w-5 text-muted-foreground"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Must be at least 8 characters with uppercase, lowercase, and numbers"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(c,{id:"confirmPassword",type:q?"text":"password",placeholder:"Confirm new password",value:k,onChange:e=>R(e.target.value),className:"pl-10",required:!0})]})]}),e.jsx(m,{type:"submit",className:"w-full",disabled:F,children:F?"Resetting...":"Reset Password"}),e.jsxs("div",{className:"text-center space-y-2",children:[D?e.jsx("button",{type:"button",onClick:async()=>{if(D){M(!0);try{const e=await fetch("https://api.buildhomemartsquares.com/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:b})}),s=await e.json();if(e.ok&&s.success)_(120),Y(!1),h({title:"OTP Resent!",description:"A new OTP has been sent to your email."});else if(429===e.status){const e=s.remainingSeconds||120;_(e),Y(!1),h({title:"Please Wait",description:`You can request a new OTP in ${e} seconds`,variant:"destructive"})}else h({title:"Error",description:s.message||"Failed to resend OTP",variant:"destructive"})}catch(e){h({title:"Connection Error",description:"Failed to resend OTP. Please try again.",variant:"destructive"})}finally{M(!1)}}},className:"text-sm text-primary hover:underline",disabled:F,children:"Didn't receive code? Resend OTP"}):e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Resend OTP in ",Math.floor($/60),":",($%60).toString().padStart(2,"0")]}),e.jsx("button",{type:"button",onClick:()=>{N("email"),O(""),E(""),R("")},className:"block w-full text-sm text-muted-foreground hover:text-primary",children:"Use a different email"})]})]}),"success"===P&&e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto",children:e.jsx(g,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Password Reset Successful!"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your password has been successfully changed. You can now sign in with your new password."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{onClick:()=>r("/login"),className:"w-full",children:"Go to Login"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["A confirmation email has been sent to ",b]})]})]})]})})]})}),e.jsx(x,{})]})};export{P as default};

import{j as e}from"./ui-CEFKCYQo.js";import{r as s}from"./router-Bi51YGN-.js";import{W as a,a as t,b as l,c as i,x as d,e as r,ap as n,Q as c,I as o,_ as m,$ as x,a0 as h,a1 as u,B as j,d as p,f as v,E as f,M as g,a2 as N,a3 as b,a4 as y,a5 as S,a6 as w,L as A,T as C,a7 as D}from"./index-Ds-LUfCl.js";import{f as E,h as V}from"./apiUtils-Bbv9G39a.js";import{C as $}from"./calendar-CC4c2MNn.js";import"./vendor-eVk5PToZ.js";const T=()=>{const[T,_]=s.useState([]),[k,I]=s.useState(!0),[z,M]=s.useState(""),[F,L]=s.useState("active"),[O,U]=s.useState(null),[B,H]=s.useState(!1),[P,W]=s.useState(!1),[q,J]=s.useState(null),[Q,R]=s.useState(""),[G,K]=s.useState(""),[X,Y]=s.useState({}),{toast:Z}=a();s.useEffect(()=>{ee()},[F,z]);const ee=async()=>{try{I(!0);const e=await E(`/subadmin/addon-services?status=${F}&search=${z}`),s=await V(e);_(s.data.vendorAddons||[])}catch(e){Z({title:"Error",description:e.message||"Error fetching addon services",variant:"destructive"}),_([])}finally{I(!1)}},se=async e=>{J(e),R(`Schedule ${e.name} Service`),K(`Dear Vendor,\n\nWe would like to schedule the ${e.name} service that you have purchased.\n\nPlease reply to this email with your preferred dates and times for the service.\n\nService Details:\n- Name: ${e.name}\n- Description: ${e.description}\n- Category: ${e.category.charAt(0).toUpperCase()+e.category.slice(1)}\n\nThank you!\n\nBest regards,\nAdmin Team`),W(!0)},ae=e=>{switch(e){case"photography":return"bg-blue-600";case"marketing":return"bg-green-600";case"technology":return"bg-purple-600";case"support":return"bg-orange-600";case"crm":return"bg-red-600";default:return"bg-gray-600"}},te=(e,s="INR")=>`â‚¹${e.toLocaleString("en-IN")}`;return k&&0===T.length?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Addon Services"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage vendor addon services and schedule appointments"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Addon Services"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"View vendors who have purchased addon services and schedule appointments"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(t,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Active Vendors"}),e.jsx(d,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(r,{children:e.jsx("div",{className:"text-2xl font-bold",children:T.filter(e=>e.totalAddons>0).length})})]}),e.jsxs(t,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Total Addons"}),e.jsx(n,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(r,{children:e.jsx("div",{className:"text-2xl font-bold",children:T.reduce((e,s)=>e+s.totalAddons,0)})})]}),e.jsxs(t,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Unique Services"}),e.jsx(n,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(r,{children:e.jsx("div",{className:"text-2xl font-bold",children:new Set(T.flatMap(e=>e.activeAddons.map(e=>e._id))).size})})]}),e.jsxs(t,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Categories"}),e.jsx(n,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(r,{children:e.jsx("div",{className:"text-2xl font-bold",children:new Set(T.flatMap(e=>e.activeAddons.map(e=>e.category))).size})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(o,{placeholder:"Search vendors...",value:z,onChange:e=>M(e.target.value),className:"pl-10"})]}),e.jsxs(m,{value:F,onValueChange:L,children:[e.jsxs(x,{children:[e.jsx(h,{value:"active",children:"Active Subscriptions"}),e.jsx(h,{value:"expired",children:"Expired"}),e.jsx(h,{value:"all",children:"All Vendors"})]}),e.jsx(u,{value:F,className:"space-y-4 mt-6",children:0===T.length?e.jsx(t,{children:e.jsxs(r,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(n,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Addon Services Found"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"active"===F?"No vendors with active addon subscriptions":`No vendors with ${F} addon subscriptions`})]})}):T.map(s=>e.jsxs(t,{children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(i,{className:"text-lg",children:[s.user.profile.firstName," ",s.user.profile.lastName]}),e.jsxs(j,{variant:"outline",children:[s.totalAddons," Addon",1!==s.totalAddons?"s":""]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"text-sm",children:s.user.email}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.activeAddons.slice(0,3).map(s=>e.jsx(j,{className:ae(s.category),children:s.name},s._id)),s.activeAddons.length>3&&e.jsxs(j,{variant:"outline",children:["+",s.activeAddons.length-3," more"]})]})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Value"}),e.jsx("div",{className:"text-xl font-bold text-primary",children:te(s.activeAddons.reduce((e,s)=>e+s.price,0))})]})]})}),e.jsx(r,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>{U(s),H(!0)},children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"View Details"]}),e.jsxs(v,{size:"sm",onClick:()=>{U(s),1===s.activeAddons.length?se(s.activeAddons[0]):H(!0)},children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"Schedule Service"]})]})})]},s._id))})]}),e.jsx(N,{open:B,onOpenChange:H,children:e.jsxs(b,{className:"max-w-3xl",children:[e.jsxs(y,{children:[e.jsx(S,{children:"Vendor Addon Services"}),e.jsx(w,{children:"Detailed information about vendor's purchased addon services"})]}),O&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Vendor Information"}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("p",{className:"font-medium",children:[O.user.profile.firstName," ",O.user.profile.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:O.user.email}),e.jsxs("p",{className:"text-sm mt-2",children:[e.jsx("strong",{children:"Total Addons:"})," ",O.totalAddons]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Active Addon Services"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:O.activeAddons.map(s=>e.jsxs(t,{className:"hover:shadow-md transition-shadow",children:[e.jsx(l,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{className:"text-sm",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(j,{className:ae(s.category),children:s.category}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.billingType.replace("_"," ")})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"font-bold text-primary",children:te(s.price,s.currency)})})]})}),e.jsxs(r,{className:"pt-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:s.description}),e.jsxs(v,{size:"sm",className:"w-full",onClick:()=>{H(!1),se(s)},children:[e.jsx($,{className:"h-3 w-3 mr-2"}),"Schedule This Service"]})]})]},s._id))})]}),O.subscriptions.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Subscription History"}),e.jsx("div",{className:"space-y-2",children:O.subscriptions.map(s=>e.jsx("div",{className:"bg-muted p-3 rounded-lg text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium",children:["Status: ",e.jsx(j,{variant:"active"===s.status?"default":"secondary",children:s.status})]}),e.jsxs("span",{className:"text-muted-foreground",children:[new Date(s.startDate).toLocaleDateString()," - ",new Date(s.endDate).toLocaleDateString()]})]})},s._id))})]})]})]})}),e.jsx(N,{open:P,onOpenChange:W,children:e.jsxs(b,{className:"max-w-2xl",children:[e.jsxs(y,{children:[e.jsx(S,{children:"Schedule Addon Service"}),e.jsx(w,{children:"Send a scheduling email to the vendor for their purchased addon service"})]}),O&&q&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("p",{className:"font-medium",children:["Vendor: ",O.user.profile.firstName," ",O.user.profile.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:O.user.email}),e.jsxs("p",{className:"text-sm mt-1",children:[e.jsx("strong",{children:"Service:"})," ",q.name]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"subject",children:"Email Subject"}),e.jsx(o,{id:"subject",value:Q,onChange:e=>R(e.target.value),placeholder:"Enter email subject"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"message",children:"Email Message"}),e.jsx(C,{id:"message",value:G,onChange:e=>K(e.target.value),placeholder:"Enter email message",rows:8})]})]}),e.jsxs(D,{children:[e.jsx(v,{variant:"outline",onClick:()=>W(!1),children:"Cancel"}),e.jsx(v,{onClick:async()=>{if(O&&q)try{Y({...X,email:!0});const e=await E("/subadmin/addon-services/schedule",{method:"POST",body:JSON.stringify({vendorId:O.user._id,addonId:q._id,subject:Q,message:G,vendorEmail:O.user.email})});await V(e);Z({title:"Success",description:"Scheduling email sent successfully"}),W(!1),J(null)}catch(e){Z({title:"Error",description:"Failed to send scheduling email",variant:"destructive"})}finally{Y({...X,email:!1})}},disabled:X.email||!Q||!G,children:X.email?"Sending...":"Send Email"})]})]})})]})};export{T as default};

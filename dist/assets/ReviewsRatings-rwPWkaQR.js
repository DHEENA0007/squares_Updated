import{j as e}from"./ui-DOY6021Z.js";import{d as J,r as a}from"./router-2SVJvIbS.js";import{av as K,z as B,t as m,ai as b,f as n,aq as I,a as c,e as o,H as W,I as X,q as V,r as z,s as O,v as H,w as i,B as R,h as Z,E as ee,ar as se}from"./index-SPvHGBGF.js";import{D as te,a as ae,b as re,c as le,d as ie,e as ne}from"./dialog-LNpiSwLW.js";import{R as C}from"./refresh-cw-BxN4QFjr.js";import{C as ce}from"./calendar-CTLer1S7.js";import{P as oe}from"./pen-line-CIxo0I2M.js";import{T as _}from"./trash-2-CPPkLMku.js";import"./vendor-Dazix4UH.js";const ve=()=>{const{isConnected:S}=K(),x=J(),[h,D]=a.useState(!0),[g,P]=a.useState(!1),[r,F]=a.useState([]),[u,T]=a.useState(""),[f,k]=a.useState("all"),[L,A]=a.useState("newest"),[q,p]=a.useState(!1),[d,v]=a.useState(null),[N,E]=a.useState(!1),w="https://squares-v2.onrender.com/api",j=a.useCallback(async()=>{try{D(!0);const s=B.getToken(),l=await(await fetch(`${w}/customer/reviews/given`,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}})).json();l.success?F(l.data?.reviews||[]):m({title:"Error",description:l.message||"Failed to load reviews",variant:"destructive"})}catch(s){console.error("Failed to load reviews:",s),m({title:"Error",description:"Failed to load reviews. Please try again.",variant:"destructive"})}finally{D(!1)}},[w]),M=a.useCallback(async()=>{P(!0),await j(),P(!1)},[j]);a.useEffect(()=>{j()},[j]);const Q=async()=>{if(d)try{E(!0);const s=B.getToken(),l=await(await fetch(`${w}/customer/reviews/${d._id}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}})).json();l.success?(m({title:"Success",description:"Review deleted successfully"}),F(Y=>Y.filter(G=>G._id!==d._id)),p(!1),v(null)):m({title:"Error",description:l.message||"Failed to delete review",variant:"destructive"})}catch(s){console.error("Failed to delete review:",s),m({title:"Error",description:"Failed to delete review. Please try again.",variant:"destructive"})}finally{E(!1)}},y=r.filter(s=>{const t=s.property?.title?.toLowerCase().includes(u.toLowerCase())||`${s.property?.address?.city||""}, ${s.property?.address?.state||""}`.toLowerCase().includes(u.toLowerCase())||s.title?.toLowerCase().includes(u.toLowerCase()),l=f==="all"||s.rating===parseInt(f);return t&&l}).sort((s,t)=>{switch(L){case"newest":return new Date(t.createdAt).getTime()-new Date(s.createdAt).getTime();case"oldest":return new Date(s.createdAt).getTime()-new Date(t.createdAt).getTime();case"rating-high":return t.rating-s.rating;case"rating-low":return s.rating-t.rating;default:return 0}}),$=s=>new Date(s).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"}),U=s=>!s||s.length===0?"/placeholder-property.jpg":s.find(l=>l.isPrimary)?.url||s[0]?.url||"/placeholder-property.jpg";return e.jsxs("div",{className:"space-y-6 pt-16",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(b,{className:"w-8 h-8 text-primary fill-primary"}),"Reviews & Ratings"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your reviews and see what you have shared"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{variant:"outline",onClick:M,disabled:g,children:[e.jsx(C,{className:`w-4 h-4 mr-2 ${g?"animate-spin":""}`}),g?"Refreshing...":"Refresh"]}),e.jsxs(n,{onClick:()=>x("/customer/owned-properties"),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"View Properties"]})]})]}),e.jsx("div",{className:"flex items-center justify-between bg-muted/50 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${S?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-sm text-muted-foreground",children:S?"Real-time updates active":"Offline mode"})]})}),!h&&r.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:r.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Reviews"})]})})}),e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:(r.reduce((s,t)=>s+t.rating,0)/r.length).toFixed(1)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Average Rating"})]})})}),e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:r.filter(s=>s.rating>=4).length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Positive Reviews"})]})})}),e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:r.filter(s=>s.isPublic).length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Public Reviews"})]})})})]}),e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(X,{type:"text",placeholder:"Search reviews or properties...",className:"pl-10",value:u,onChange:s=>T(s.target.value)})]}),e.jsxs(V,{value:f,onValueChange:k,children:[e.jsx(z,{className:"w-full sm:w-40",children:e.jsx(O,{placeholder:"Rating"})}),e.jsxs(H,{children:[e.jsx(i,{value:"all",children:"All Ratings"}),e.jsx(i,{value:"5",children:"5 Stars"}),e.jsx(i,{value:"4",children:"4 Stars"}),e.jsx(i,{value:"3",children:"3 Stars"}),e.jsx(i,{value:"2",children:"2 Stars"}),e.jsx(i,{value:"1",children:"1 Star"})]})]}),e.jsxs(V,{value:L,onValueChange:A,children:[e.jsx(z,{className:"w-full sm:w-40",children:e.jsx(O,{placeholder:"Sort By"})}),e.jsxs(H,{children:[e.jsx(i,{value:"newest",children:"Newest First"}),e.jsx(i,{value:"oldest",children:"Oldest First"}),e.jsx(i,{value:"rating-high",children:"Rating: High to Low"}),e.jsx(i,{value:"rating-low",children:"Rating: Low to High"})]})]})]})})}),!h&&y.length>0&&e.jsx("div",{className:"space-y-4",children:y.map(s=>e.jsx(c,{className:"overflow-hidden",children:e.jsx(o,{className:"p-0",children:e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[e.jsxs("div",{className:"lg:w-48 h-48 lg:h-auto bg-muted relative",children:[e.jsx("img",{src:U(s.property?.images),alt:s.property?.title||"Property",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute top-3 left-3 flex gap-2",children:e.jsx(R,{className:s.property?.status==="sold"?"bg-purple-600 text-white":"bg-blue-600 text-white",children:s.property?.status==="sold"?"Purchased":"Rented"})})]}),e.jsxs("div",{className:"flex-1 p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-1",children:s.property?.title||"Property"}),e.jsxs("div",{className:"flex items-center gap-4 text-muted-foreground text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"w-4 h-4"}),s.property?.address?.city||"",", ",s.property?.address?.state||""]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-4 h-4"}),"Reviewed on ",$(s.createdAt)]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(t=>e.jsx(b,{className:`w-5 h-5 ${t<=s.rating?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},t))}),e.jsxs("span",{className:"font-semibold text-lg",children:[s.rating,".0"]}),s.isPublic?e.jsx(R,{variant:"secondary",children:"Public"}):e.jsx(R,{variant:"outline",children:"Private"})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold text-lg mb-2",children:s.title}),e.jsx("p",{className:"text-muted-foreground",children:s.comment})]}),s.vendor&&e.jsx("div",{className:"p-3 bg-muted/50 rounded-lg mb-4",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Seller: "}),e.jsx("span",{className:"font-medium",children:s.vendor.name})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>x(`/customer/property/${s.property?._id}`),children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"View Property"]}),e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>x("/customer/owned-properties"),children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Edit Review"]}),e.jsxs(n,{size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",onClick:()=>{v(s),p(!0)},children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Delete"]})]}),s.updatedAt!==s.createdAt&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-3",children:["Last updated: ",$(s.updatedAt)]})]})]})})},s._id))}),h&&e.jsx(c,{children:e.jsx(o,{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Loading your reviews..."})]})})}),!h&&y.length===0&&e.jsx(c,{children:e.jsxs(o,{className:"p-12 text-center",children:[e.jsx(b,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:r.length===0?"No reviews yet":"No reviews match your filters"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:r.length===0?"You haven't written any reviews yet. Visit your owned properties to write your first review!":"Try adjusting your search criteria or clear some filters."}),e.jsx("div",{className:"flex gap-2 justify-center",children:r.length===0?e.jsxs(n,{onClick:()=>x("/customer/owned-properties"),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"View Owned Properties"]}):e.jsxs(n,{variant:"outline",onClick:()=>{T(""),k("all"),A("newest")},children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Clear Filters"]})})]})}),e.jsx(te,{open:q,onOpenChange:p,children:e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsx(le,{children:"Delete Review"}),e.jsx(ie,{children:"Are you sure you want to delete this review? This action cannot be undone."})]}),d&&e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"font-semibold mb-1",children:d.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:d.property?.title||"Property"})]}),e.jsxs(ne,{children:[e.jsx(n,{variant:"outline",onClick:()=>{p(!1),v(null)},disabled:N,children:"Cancel"}),e.jsx(n,{variant:"destructive",onClick:Q,disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 mr-2 animate-spin"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Delete Review"]})})]})]})})]})};export{ve as default};

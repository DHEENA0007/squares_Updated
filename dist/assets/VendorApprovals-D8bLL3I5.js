import{j as e}from"./ui-BNZSgpjP.js";import{r as s}from"./router-D8v2YSKU.js";import{u as i,aC as a,f as r,a as t,b as n,c as l,i as d,e as c,h as o,C as p,$ as m,I as x,q as h,r as f,s as u,v as j,w as v,E as N,_ as b,a4 as g,a5 as y,a6 as V,a7 as w,a8 as A,ae as C,S as k,L as S,y as D,B,T as P,aS as T,aT as R,t as I}from"./index-XQ_rcKIR.js";import{C as F}from"./checkbox-CNljS6SN.js";import{A as E,b as _,a as $}from"./alert-Bbcf9Ir0.js";import{T as L,a as M,b as Y,c as O,d as z,e as U}from"./table-BaUPikoR.js";import{D as q}from"./download-Bm7V-ThT.js";import{C as W}from"./calendar-NW2cLLEn.js";import"./vendor-BxThA0WO.js";const G=()=>{const{user:G}=i(),[J,H]=s.useState([]),[K,Q]=s.useState(null),[X,Z]=s.useState(!0),[ee,se]=s.useState(!1),[ie,ae]=s.useState(null),[re,te]=s.useState(!1),[ne,le]=s.useState({status:"pending",search:"",businessType:"",experienceMin:"",experienceMax:"",startDate:"",endDate:"",page:1,limit:10}),de=a(ne.search,500),[ce,oe]=s.useState(null),pe=()=>G?.profile?.firstName&&G?.profile?.lastName?`${G.profile.firstName} ${G.profile.lastName}`:G?.profile?.firstName?G.profile.firstName:G?.email?G.email:"",[me,xe]=s.useState(!1),[he,fe]=s.useState("approve"),[ue,je]=s.useState(pe()),[ve,Ne]=s.useState({phoneVerified:!1,emailVerified:!1,identityProofVerified:!1,businessNameVerified:!1,businessTypeVerified:!1,businessDescriptionVerified:!1,experienceVerified:!1,addressVerified:!1,panNumberVerified:!1,gstNumberVerified:!1,licenseNumberVerified:!1,businessRegistrationVerified:!1}),[be,ge]=s.useState(""),[ye,Ve]=s.useState(""),[we,Ae]=s.useState(!1),[Ce,ke]=s.useState(null),Se=async()=>{try{const e=new URLSearchParams({page:ne.page.toString(),limit:ne.limit.toString(),status:ne.status,search:de,businessType:ne.businessType,experienceMin:ne.experienceMin,experienceMax:ne.experienceMax,startDate:ne.startDate,endDate:ne.endDate,sortBy:"submittedAt",sortOrder:"desc"}),s=await T(`/admin/vendor-approvals?${e}`),i=await R(s);H(i.data.vendors||[])}catch(e){I({title:"Error",description:e instanceof Error?e.message:"Failed to fetch vendor applications",variant:"destructive"}),H([])}},De=async()=>{try{const e=await T("/admin/vendor-approval-stats"),s=await R(e);Q(s.data||null)}catch(e){I({title:"Error",description:e instanceof Error?e.message:"Failed to fetch statistics",variant:"destructive"}),Q(null)}};s.useEffect(()=>{const e=pe();e&&je(e)},[G]),s.useEffect(()=>{(async()=>{X||se(!0),await Promise.all([Se(),De()]),Z(!1),se(!1)})()},[ne.status,ne.page,de,ne.businessType,ne.experienceMin,ne.experienceMax,ne.limit,ne.startDate,ne.endDate]),s.useEffect(()=>{if(ie?.approval.phoneVerifiedAt){const e=()=>{const e=new Date(ie.approval.phoneVerifiedAt).getTime(),s=6e5-((new Date).getTime()-e);ke(s>0?s:0)};e();const s=setInterval(e,1e3);return()=>clearInterval(s)}ke(null)},[ie]);const Be=()=>{Ne({phoneVerified:!1,emailVerified:!1,identityProofVerified:!1,businessNameVerified:!1,businessTypeVerified:!1,businessDescriptionVerified:!1,experienceVerified:!1,addressVerified:!1,panNumberVerified:!1,gstNumberVerified:!1,licenseNumberVerified:!1,businessRegistrationVerified:!1}),ge(""),Ve(""),je(pe())},Pe=(e,s)=>{ae(e),fe(s),Be(),e.approval.verificationChecklist&&Ne(e.approval.verificationChecklist),je(e.approval.approverName||pe()),xe(!0)},Te=async()=>{if(!ie||!ue.trim())return void I({title:"Error",description:"Approver name is required",variant:"destructive"});if(!ve.phoneVerified)return void I({title:"Error",description:"Phone verification must be completed first",variant:"destructive"});if(!be.trim())return void I({title:"Error",description:"Approval comments are required",variant:"destructive"});Object.values(ve).every(e=>!0===e)||I({title:"Warning",description:"Not all verification steps are completed. Are you sure you want to proceed?",variant:"destructive"}),oe("approve");try{const e={approvalNotes:be,approverName:ue,verificationChecklist:ve,verificationLevel:"basic"},s=await T(`/admin/vendor-approvals/${ie._id}/approve`,{method:"POST",body:JSON.stringify(e)});await R(s),I({title:"Success",description:"Vendor application approved successfully",variant:"default"}),xe(!1),await Se(),await De()}catch(e){I({title:"Error",description:e instanceof Error?e.message:"Failed to approve vendor application",variant:"destructive"})}finally{oe(null)}},Re=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Ie=e=>`${Math.floor(e/6e4)}:${Math.floor(e%6e4/1e3).toString().padStart(2,"0")}`,Fe=s=>{const i={pending:{variant:"secondary",icon:o,label:"Pending"},under_review:{variant:"default",icon:N,label:"Under Review"},approved:{variant:"default",icon:p,label:"Approved"},rejected:{variant:"destructive",icon:b,label:"Rejected"}},a=i[s]||i.pending,r=a.icon;return e.jsxs(B,{variant:a.variant,children:[e.jsx(r,{className:"w-3 h-3 mr-1"}),a.label]})},Ee=()=>{if(!ie)return!1;if(!ve.phoneVerified)return!1;if(!ie.approval.phoneVerifiedAt)return!1;const e=new Date(ie.approval.phoneVerifiedAt).getTime();return(new Date).getTime()-e>=6e5};return X?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:justify-between md:items-start md:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Vendor Applications"}),e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"Review and manage vendor registration applications"})]}),e.jsxs(r,{onClick:async()=>{try{const e=await T("/admin/vendor-approvals/export"),s=await R(e),i=[["Application ID","Company Name","Applicant Name","Email","Phone","Business Type","Submitted Date","Status","Reviewed Date","Reviewed By","Approver Name","Phone Verified","Email Verified","Identity Proof Verified","Business Name Verified","Business Type Verified","Business Description Verified","Experience Verified","Address Verified","PAN Number Verified","GST Number Verified","License Number Verified","Business Registration Verified","Approval/Rejection Comments"].join(","),...s.data.map(e=>{const s=e.approval?.verificationChecklist||{},i=e.approval?.submittedAt?new Date(e.approval.submittedAt).toLocaleDateString():"N/A",a=e.approval?.reviewedAt?new Date(e.approval.reviewedAt).toLocaleDateString():"N/A",r=e.approval?.reviewedBy?`${e.approval.reviewedBy.profile?.firstName||""} ${e.approval.reviewedBy.profile?.lastName||""}`.trim():"N/A";return[e._id||"N/A",`"${e.businessInfo?.companyName||"N/A"}"`,`"${e.user?.profile?.firstName||""} ${e.user?.profile?.lastName||""}"`.trim()||"N/A",e.user?.email||"N/A",e.user?.profile?.phone||"N/A",e.businessInfo?.businessType||"N/A",i,e.approval?.status||"N/A",a,r,e.approval?.approverName||"N/A",s.phoneVerified?"Yes":"No",s.emailVerified?"Yes":"No",s.identityProofVerified?"Yes":"No",s.businessNameVerified?"Yes":"No",s.businessTypeVerified?"Yes":"No",s.businessDescriptionVerified?"Yes":"No",s.experienceVerified?"Yes":"No",s.addressVerified?"Yes":"No",s.panNumberVerified?"Yes":"No",s.gstNumberVerified?"Yes":"No",s.licenseNumberVerified?"Yes":"No",s.businessRegistrationVerified?"Yes":"No",`"${e.approval?.approvalNotes||e.approval?.rejectionReason||"N/A"}"`].join(",")})].join("\n"),a=new Blob([i],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),t=URL.createObjectURL(a);r.setAttribute("href",t),r.setAttribute("download",`vendor_approval_report_${(new Date).toISOString().split("T")[0]}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),I({title:"Success",description:"Approval report exported successfully",variant:"default"})}catch(e){I({title:"Error",description:"Failed to export approval report",variant:"destructive"})}},variant:"outline",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Export Report"]})]}),K&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(t,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Total Applications"}),e.jsx(d,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold",children:K.overview.totalApplications})})]}),e.jsxs(t,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Pending Review"}),e.jsx(o,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold",children:K.overview.pendingApplications})})]}),e.jsxs(t,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Approved"}),e.jsx(p,{className:"h-4 w-4 text-green-600"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold",children:K.overview.approvedApplications})})]}),e.jsxs(t,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Approval Rate"}),e.jsx(p,{className:"h-4 w-4 text-green-600"})]}),e.jsx(c,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[K.overview.approvalRate.toFixed(1),"%"]})})]})]}),e.jsx(t,{children:e.jsxs(c,{className:"pt-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Search by name or email...",value:ne.search,onChange:e=>le({...ne,search:e.target.value})})]}),e.jsxs(h,{value:ne.status,onValueChange:e=>le({...ne,status:e}),children:[e.jsx(f,{children:e.jsx(u,{placeholder:"Filter by status"})}),e.jsxs(j,{children:[e.jsx(v,{value:"all",children:"All Statuses"}),e.jsx(v,{value:"pending",children:"Pending"}),e.jsx(v,{value:"under_review",children:"Under Review"}),e.jsx(v,{value:"approved",children:"Approved"}),e.jsx(v,{value:"rejected",children:"Rejected"})]})]}),e.jsxs(h,{value:ne.businessType||"all",onValueChange:e=>le({...ne,businessType:"all"===e?"":e}),children:[e.jsx(f,{children:e.jsx(u,{placeholder:"Filter by business type"})}),e.jsxs(j,{children:[e.jsx(v,{value:"all",children:"All Types"}),e.jsx(v,{value:"real_estate_agent",children:"Real Estate Agent"}),e.jsx(v,{value:"property_management",children:"Property Management"}),e.jsx(v,{value:"developer",children:"Developer"}),e.jsx(v,{value:"individual",children:"Individual"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{type:"number",placeholder:"Min experience",value:ne.experienceMin,onChange:e=>le({...ne,experienceMin:e.target.value})}),e.jsx(x,{type:"number",placeholder:"Max experience",value:ne.experienceMax,onChange:e=>le({...ne,experienceMax:e.target.value})})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4 mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(x,{type:"date",placeholder:"Start Date",value:ne.startDate,onChange:e=>le({...ne,startDate:e.target.value,page:1})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(x,{type:"date",placeholder:"End Date",value:ne.endDate,onChange:e=>le({...ne,endDate:e.target.value,page:1})})]}),(ne.startDate||ne.endDate)&&e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>le({...ne,startDate:"",endDate:"",page:1}),className:"text-muted-foreground hover:text-foreground",children:"Clear Dates"})]})]})}),e.jsxs(t,{children:[e.jsx(n,{children:e.jsx(l,{children:"Applications"})}),e.jsx(c,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(L,{children:[e.jsx(M,{children:e.jsxs(Y,{children:[e.jsx(O,{children:"Company Name"}),e.jsx(O,{children:"Applicant"}),e.jsx(O,{children:"Contact"}),e.jsx(O,{children:"Business Type"}),e.jsx(O,{children:"Submitted Date"}),e.jsx(O,{children:"Status"}),e.jsx(O,{className:"text-right",children:"Actions"})]})}),e.jsx(z,{children:0===J.length?e.jsx(Y,{children:e.jsx(U,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No applications found"})}):J.map(s=>e.jsxs(Y,{children:[e.jsx(U,{className:"font-medium",children:s.businessInfo.companyName}),e.jsx(U,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{children:[s.user?.profile?.firstName||"N/A"," ",s.user?.profile?.lastName||""]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.user?.email||"N/A"})]})}),e.jsx(U,{children:s.user?.profile?.phone||"N/A"}),e.jsx(U,{children:s.businessInfo.businessType}),e.jsx(U,{children:Re(s.approval.submittedAt)}),e.jsx(U,{children:Fe(s.approval.status)}),e.jsx(U,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>{ae(s),te(!0)},children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Review"]}),"pending"===s.approval.status||"under_review"===s.approval.status?e.jsxs(e.Fragment,{children:[e.jsxs(r,{variant:"default",size:"sm",onClick:()=>Pe(s,"approve"),children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"under_review"===s.approval.status?"Update":"Approve"]}),e.jsxs(r,{variant:"destructive",size:"sm",onClick:()=>Pe(s,"reject"),children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Reject"]})]}):null]})})]},s._id))})]})})})]}),e.jsx(g,{open:re,onOpenChange:te,children:e.jsxs(y,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(V,{children:[e.jsx(w,{children:"Application Review"}),e.jsx(A,{children:"Detailed information about the vendor application"})]}),ie&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Status"}),e.jsx("div",{className:"mt-2",children:Fe(ie.approval.status)})]})}),e.jsxs(t,{children:[e.jsx(n,{children:e.jsx(l,{className:"text-base",children:"Contact Person"})}),e.jsxs(c,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Name:"}),e.jsxs("span",{children:[ie.user?.profile?.firstName||"N/A"," ",ie.user?.profile?.lastName||""]})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Email:"}),e.jsx("span",{className:"break-all",children:ie.user?.email||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Phone:"}),e.jsx("span",{children:ie.user?.profile?.phone||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Registered On:"}),e.jsx("span",{children:ie.user?.createdAt?Re(ie.user.createdAt):"N/A"})]})]})]}),e.jsxs(t,{children:[e.jsx(n,{children:e.jsx(l,{className:"text-base",children:"Business Information"})}),e.jsxs(c,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Company Name:"}),e.jsx("span",{children:ie.businessInfo.companyName})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Business Type:"}),e.jsx("span",{children:ie.businessInfo.businessType})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Experience:"}),e.jsx("span",{children:ie.professionalInfo?.experience?`${ie.professionalInfo.experience} years`:"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1 md:col-span-2",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Business Description:"}),e.jsx("span",{className:"break-words",children:ie.professionalInfo?.description||"N/A"})]})]})]}),e.jsxs(t,{children:[e.jsx(n,{children:e.jsx(l,{className:"text-base",children:"Address Information"})}),e.jsxs(c,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Address:"}),e.jsx("span",{className:"break-words",children:ie.professionalInfo?.officeAddress?.area||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"City:"}),e.jsx("span",{children:ie.professionalInfo?.officeAddress?.city||ie.professionalInfo?.serviceAreas?.[0]?.city||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"State:"}),e.jsx("span",{children:ie.professionalInfo?.officeAddress?.state||ie.professionalInfo?.serviceAreas?.[0]?.state||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Pincode:"}),e.jsx("span",{children:ie.professionalInfo?.officeAddress?.pincode||ie.professionalInfo?.serviceAreas?.[0]?.pincode||"N/A"})]})]})]}),e.jsxs(t,{children:[e.jsx(n,{children:e.jsx(l,{className:"text-base",children:"Legal Documents"})}),e.jsxs(c,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"PAN Number:"}),e.jsx("span",{children:ie.businessInfo.panNumber||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"GST Number:"}),e.jsx("span",{children:ie.businessInfo.gstNumber||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"License Number:"}),e.jsx("span",{children:ie.businessInfo.licenseNumber||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Website:"}),e.jsx("span",{children:ie.businessInfo.website||"N/A"})]})]})]}),ie.approval.submittedDocuments&&ie.approval.submittedDocuments.length>0&&e.jsxs(t,{children:[e.jsx(n,{children:e.jsx(l,{className:"text-base",children:"Submitted Documents"})}),e.jsx(c,{children:e.jsx("div",{className:"space-y-2",children:ie.approval.submittedDocuments.map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.documentName}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.documentType})]})]}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>window.open(s.documentUrl,"_blank"),children:"View"})]},i))})})]})]}),e.jsx(C,{children:e.jsx(r,{variant:"outline",onClick:()=>te(!1),children:"Close"})})]})}),e.jsx(g,{open:me,onOpenChange:xe,children:e.jsxs(y,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(V,{children:[e.jsx(w,{children:"approve"===he?"under_review"===ie?.approval.status?"Complete Verification":"Approve Application":"Reject Application"}),e.jsx(A,{children:"approve"===he?"Complete the verification checklist and provide approval details":"Provide a reason for rejecting this application"})]}),ie&&e.jsxs("div",{className:"space-y-6",children:[ie.approval.lockedBy&&String(ie.approval.lockedBy._id)!==String(G?.id)&&"superadmin"!==G?.role&&e.jsxs(E,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(k,{className:"h-4 w-4 text-yellow-600"}),e.jsx(_,{children:"Application Locked"}),e.jsxs($,{children:["This vendor application is currently being handled by"," ",e.jsx("strong",{children:ie.approval.lockedBy.profile?.firstName?`${ie.approval.lockedBy.profile.firstName} ${ie.approval.lockedBy.profile.lastName||""}`:ie.approval.lockedBy.email}),". You cannot approve or reject this application."]})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:ie.businessInfo.companyName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[ie.user?.profile?.firstName||"N/A"," ",ie.user?.profile?.lastName||""," â€¢ ",ie.user?.email||"N/A"]}),ie.approval.lockedBy&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("p",{className:"text-xs font-medium text-primary",children:"Currently Handling:"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[ie.approval.lockedBy.profile?.firstName?`${ie.approval.lockedBy.profile.firstName} ${ie.approval.lockedBy.profile.lastName||""}`:ie.approval.lockedBy.email,ie.approval.lockedBy._id===G?.id&&" (You)"]}),ie.approval.lockedAt&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Since: ",new Date(ie.approval.lockedAt).toLocaleString()]})]}),ie.approval.phoneVerifiedBy&&ie.approval.phoneVerifiedBy._id!==ie.approval.lockedBy?._id&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("p",{className:"text-xs font-medium text-blue-600",children:"Phone Verified By:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:ie.approval.phoneVerifiedBy.profile?.firstName?`${ie.approval.phoneVerifiedBy.profile.firstName} ${ie.approval.phoneVerifiedBy.profile.lastName||""}`:ie.approval.phoneVerifiedBy.email})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{children:"Approver Name"}),e.jsx("div",{className:"p-3 rounded-md bg-muted border border-border",children:e.jsx("p",{className:"font-medium text-sm",children:ue||"Loading..."})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:ie.approval.lockedBy&&ie.approval.lockedBy._id===G?.id?"You are currently handling this application. Your name is pre-filled from the initial action.":"Automatically set from your logged-in account"})]}),"approve"===he&&e.jsxs(e.Fragment,{children:[e.jsxs(t,{className:"border-2 border-primary/20",children:[e.jsx(n,{children:e.jsxs(l,{className:"text-base flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-primary"}),"Step 1: Phone Verification (Required)"]})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Phone: ",ie.user?.profile?.phone||"N/A"]})]}),ve.phoneVerified?e.jsxs(B,{variant:"default",className:"bg-green-600",children:[e.jsx(p,{className:"w-4 h-4 mr-1"}),"Verified"]}):e.jsx(r,{onClick:async()=>{if(ie&&ue.trim()){Ae(!0);try{const e=await T(`/admin/vendor-approvals/${ie._id}/verify-phone`,{method:"POST",body:JSON.stringify({approverName:ue})});await R(e);Ne(e=>({...e,phoneVerified:!0})),ae(e=>e?{...e,approval:{...e.approval,status:"under_review",phoneVerifiedAt:(new Date).toISOString(),verificationChecklist:{...e.approval.verificationChecklist,phoneVerified:!0}}}:e),await Se(),I({title:"Phone Verified",description:"Phone verification successful. Status changed to under review.",variant:"default"})}catch(e){I({title:"Error",description:e instanceof Error?e.message:"Failed to verify phone",variant:"destructive"})}finally{Ae(!1)}}else I({title:"Error",description:"Please enter approver name first",variant:"destructive"})},disabled:we||!ue.trim(),size:"sm",children:we?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Verifying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"Verify Phone"]})})]}),ie.approval.phoneVerifiedAt&&null!==Ce&&e.jsxs(E,{children:[e.jsx(o,{className:"h-4 w-4"}),e.jsx(_,{children:"Verification Freeze Period"}),e.jsx($,{children:Ce>0?e.jsxs(e.Fragment,{children:["Time remaining until other verifications unlock: "," ",e.jsx("strong",{className:"text-primary",children:Ie(Ce)})]}):e.jsx("span",{className:"text-green-600 font-semibold",children:"Freeze period completed! You can now proceed with other verifications."})})]})]})]}),e.jsxs(t,{children:[e.jsx(n,{children:e.jsxs(l,{className:"text-base",children:["Step 2: Verification Checklist ",!Ee()&&"(Locked - Complete phone verification first)"]})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Personal Information"}),e.jsxs("div",{className:"space-y-2 pl-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"emailVerified",checked:ve.emailVerified,onCheckedChange:e=>Ne({...ve,emailVerified:e}),disabled:!Ee()}),e.jsx("label",{htmlFor:"emailVerified",className:"text-sm cursor-pointer",children:"Email verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"identityProofVerified",checked:ve.identityProofVerified,onCheckedChange:e=>Ne({...ve,identityProofVerified:e}),disabled:!Ee()}),e.jsx("label",{htmlFor:"identityProofVerified",className:"text-sm cursor-pointer",children:"Identity documents verified (Aadhar/Passport/DL)"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Business Information"}),e.jsxs("div",{className:"space-y-2 pl-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"businessNameVerified",checked:ve.businessNameVerified,onCheckedChange:e=>Ne({...ve,businessNameVerified:e}),disabled:!Ee()}),e.jsx("label",{htmlFor:"businessNameVerified",className:"text-sm cursor-pointer",children:"Business name verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"businessTypeVerified",checked:ve.businessTypeVerified,onCheckedChange:e=>Ne({...ve,businessTypeVerified:e}),disabled:!Ee()}),e.jsx("label",{htmlFor:"businessTypeVerified",className:"text-sm cursor-pointer",children:"Business type verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"businessDescriptionVerified",checked:ve.businessDescriptionVerified,onCheckedChange:e=>Ne({...ve,businessDescriptionVerified:e}),disabled:!Ee()}),e.jsx("label",{htmlFor:"businessDescriptionVerified",className:"text-sm cursor-pointer",children:"Business description verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"experienceVerified",checked:ve.experienceVerified,onCheckedChange:e=>Ne({...ve,experienceVerified:e}),disabled:!Ee()}),e.jsx("label",{htmlFor:"experienceVerified",className:"text-sm cursor-pointer",children:"Professional experience verified"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Address Information"}),e.jsx("div",{className:"space-y-2 pl-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"addressVerified",checked:ve.addressVerified,onCheckedChange:e=>Ne({...ve,addressVerified:e}),disabled:!Ee()}),e.jsx("label",{htmlFor:"addressVerified",className:"text-sm cursor-pointer",children:"Address verified and matches records"})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Legal Documents"}),e.jsxs("div",{className:"space-y-2 pl-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"panNumberVerified",checked:ve.panNumberVerified,onCheckedChange:e=>Ne({...ve,panNumberVerified:e}),disabled:!Ee()}),e.jsx("label",{htmlFor:"panNumberVerified",className:"text-sm cursor-pointer",children:"PAN card verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"gstNumberVerified",checked:ve.gstNumberVerified,onCheckedChange:e=>Ne({...ve,gstNumberVerified:e}),disabled:!Ee()}),e.jsx("label",{htmlFor:"gstNumberVerified",className:"text-sm cursor-pointer",children:"GST number verified (if applicable)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"licenseNumberVerified",checked:ve.licenseNumberVerified,onCheckedChange:e=>Ne({...ve,licenseNumberVerified:e}),disabled:!Ee()}),e.jsx("label",{htmlFor:"licenseNumberVerified",className:"text-sm cursor-pointer",children:"License/registration verified"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Documents"}),e.jsx("div",{className:"space-y-2 pl-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"businessRegistrationVerified",checked:ve.businessRegistrationVerified,onCheckedChange:e=>Ne({...ve,businessRegistrationVerified:e}),disabled:!Ee()}),e.jsx("label",{htmlFor:"businessRegistrationVerified",className:"text-sm cursor-pointer",children:"All required documents submitted and verified"})]})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(S,{htmlFor:"approvalComments",children:["Approval Comments ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(P,{id:"approvalComments",value:be,onChange:e=>ge(e.target.value),placeholder:"Add any additional notes about this approval...",rows:4})]})]}),"reject"===he&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(S,{htmlFor:"rejectionComments",children:["Rejection Reason ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(P,{id:"rejectionComments",value:ye,onChange:e=>Ve(e.target.value),placeholder:"Provide a detailed reason for rejection...",rows:6})]})]}),e.jsxs(C,{children:[e.jsx(r,{variant:"outline",onClick:()=>{xe(!1),Be()},disabled:null!==ce,children:"Cancel"}),"approve"===he?e.jsx(r,{onClick:async()=>{ie&&("under_review"===ie.approval.status&&null!==Ce&&Ce>0?I({title:"Freeze Period Active",description:`Please wait ${Ie(Ce)} before completing the verification.`,variant:"destructive"}):await Te())},disabled:"approve"===ce||!ve.phoneVerified||null!==Ce&&Ce>0||ie?.approval.lockedBy&&String(ie.approval.lockedBy._id)!==String(G?.id)&&"superadmin"!==G?.role,children:"approve"===ce?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):null!==Ce&&Ce>0?e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"Wait ",Ie(Ce)]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"under_review"===ie?.approval.status?"Complete & Approve":"Approve"]})}):e.jsx(r,{variant:"destructive",onClick:async()=>{if(ie)if(ye.trim()){oe("reject");try{const e=await T(`/admin/vendor-approvals/${ie._id}/reject`,{method:"POST",body:JSON.stringify({rejectionReason:ye})});await R(e),I({title:"Success",description:"Vendor application rejected",variant:"default"}),xe(!1),await Se(),await De()}catch(e){I({title:"Error",description:e instanceof Error?e.message:"Failed to reject vendor application",variant:"destructive"})}finally{oe(null)}}else I({title:"Error",description:"Rejection reason is required",variant:"destructive"})},disabled:"reject"===ce||ie?.approval.lockedBy&&String(ie.approval.lockedBy._id)!==String(G?.id)&&"superadmin"!==G?.role,children:"reject"===ce?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Reject Application"]})})]})]})})]})};export{G as default};

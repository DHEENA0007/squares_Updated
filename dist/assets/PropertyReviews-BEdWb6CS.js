import{j as e}from"./ui-s1SEoZIF.js";import{r as s}from"./router-D8v2YSKU.js";import{u as a,_ as r,aA as i,X as t,I as l,a as c,e as n,C as d,b as o,b0 as m,c as p,d as x,k as h,s as j,B as u,f,E as v,W as g,a0 as N,a1 as b,a2 as y,a3 as w,a4 as C,L as k,T as F,aa as S,au as P,av as A,aw as $,g as V}from"./index-YrVmIx3a.js";import{C as R}from"./checkbox-OYdlbG4C.js";import{f as _,h as E}from"./apiUtils-B8LmEMCW.js";import{V as T}from"./VirtualTourViewer-CQmpeFvH.js";import{C as O}from"./calendar-BA5iLWFv.js";import{I as D}from"./indian-rupee-EkOzOuU4.js";import"./vendor-BxThA0WO.js";import"./external-link-D82MRhUC.js";const I=e=>{if(!e)return m;const s="object"==typeof e?e.url:e;if(!s||"string"!=typeof s)return m;if(s.startsWith("http://")||s.startsWith("https://"))return s;const a=s.startsWith("/api")?s.substring(4):s;return`${"https://app.buildhomemartsquares.com/api".replace("/api","")}${a}`},q=()=>{const{user:q}=a(),[z,Q]=s.useState([]),[L,W]=s.useState(!0),[B,U]=s.useState(""),[J,G]=s.useState(1),[X,H]=s.useState(1),[K,M]=s.useState(null),[Y,Z]=s.useState(!1),[ee,se]=s.useState(!1),[ae,re]=s.useState(!1),[ie,te]=s.useState(""),[le,ce]=s.useState({}),{toast:ne}=r(),de=()=>q?.profile?.firstName&&q?.profile?.lastName?`${q.profile.firstName} ${q.profile.lastName}`:q?.profile?.firstName?q.profile.firstName:q?.email?q.email:"",[oe,me]=s.useState(de()),[pe,xe]=s.useState({documentsVerified:!1,locationVerified:!1,priceReasonable:!1,imagesQuality:!1,descriptionComplete:!1,ownershipConfirmed:!1}),[he,je]=s.useState("");s.useEffect(()=>{const e=de();e&&me(e)},[q]),s.useEffect(()=>{ue()},[J,B]);const ue=async()=>{try{W(!0);const e=await _(`/subadmin/properties/pending?page=${J}&search=${B}`),s=await E(e);Q(s.data.properties||[]),H(s.data.totalPages||1)}catch(e){ne({title:"Error",description:e.message||"Error fetching properties",variant:"destructive"}),Q([])}finally{W(!1)}};i("property_created",e=>{ne({title:"New Property",description:"A new property has been submitted for review"}),ue()}),i("property_updated",e=>{ue()});const fe=()=>{xe({documentsVerified:!1,locationVerified:!1,priceReasonable:!1,imagesQuality:!1,descriptionComplete:!1,ownershipConfirmed:!1}),je(""),me(de()),te("")},ve=e=>`₹${e.toLocaleString("en-IN")}`;return L&&0===z.length?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Property Reviews"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Review and approve property listings"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Property Reviews"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Review and approve property listings"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(t,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(l,{placeholder:"Search properties by title or city...",value:B,onChange:e=>U(e.target.value),className:"pl-10"})]}),e.jsx("div",{className:"space-y-4",children:0===z.length?e.jsx(c,{children:e.jsxs(n,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(d,{className:"h-12 w-12 text-green-500 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Pending Properties"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"All properties have been reviewed. Great job!"})]})}):z.map(s=>e.jsxs(c,{className:"overflow-hidden",children:[e.jsx(o,{className:"pb-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[s.images&&s.images.length>0&&e.jsx("div",{className:"flex-shrink-0 mx-auto sm:mx-0",children:e.jsx("img",{src:I(s.images[0]),alt:s.title,className:"w-20 h-20 sm:w-24 sm:h-24 object-cover rounded-lg shadow-sm",onError:e=>{e.target.src=m}})}),e.jsxs("div",{className:"flex-1 space-y-2 text-center sm:text-left",children:[e.jsx(p,{className:"text-lg sm:text-xl leading-tight",children:s.title}),e.jsx(x,{className:"space-y-1",children:e.jsxs("div",{className:"flex flex-wrap justify-center sm:justify-start items-center gap-2 sm:gap-4 text-xs sm:text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(h,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.address.district?`${s.address.city}, ${s.address.district}, ${s.address.state}`:`${s.address.city}, ${s.address.state}`})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"h-3 w-3 flex-shrink-0"}),new Date(s.createdAt).toLocaleDateString()]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.owner.email})]})]})})]}),e.jsxs("div",{className:"text-center sm:text-right flex-shrink-0",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-primary",children:ve(s.price)}),e.jsxs(u,{variant:"outline",className:"mt-1 text-xs",children:[s.type," • ",s.listingType]})]})]})}),e.jsx(n,{className:"pt-0",children:e.jsxs("div",{className:"flex flex-wrap justify-center sm:justify-start gap-2",children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>{M(s),re(!0)},className:"flex-1 min-w-[120px] touch-manipulation",children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"View Details"]}),e.jsxs(f,{size:"sm",onClick:()=>(e=>{M(e),fe(),Z(!0)})(s),disabled:le[s._id],className:"flex-1 min-w-[120px] bg-green-600 hover:bg-green-700 touch-manipulation",children:[e.jsx(d,{className:"h-4 w-4 mr-2"}),"Approve"]}),e.jsxs(f,{variant:"destructive",size:"sm",onClick:()=>(e=>{M(e),fe(),se(!0)})(s),disabled:le[s._id],className:"flex-1 min-w-[120px] touch-manipulation",children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"Reject"]})]})})]},s._id))}),X>1&&e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(f,{variant:"outline",disabled:1===J,onClick:()=>G(J-1),children:"Previous"}),e.jsxs("span",{className:"px-3 py-2 text-sm",children:["Page ",J," of ",X]}),e.jsx(f,{variant:"outline",disabled:J===X,onClick:()=>G(J+1),children:"Next"})]}),e.jsx(N,{open:Y,onOpenChange:Z,children:e.jsxs(b,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(y,{children:[e.jsx(w,{children:"Approve Property"}),e.jsxs(C,{children:['Complete the verification checklist and provide your approval for "',K?.title,'".']})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Approver Name"}),e.jsx("div",{className:"p-3 rounded-md bg-muted border border-border mt-1",children:e.jsx("p",{className:"font-medium text-sm",children:oe||"Loading..."})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Automatically set from your logged-in account"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(k,{className:"text-base font-semibold",children:"Verification Checklist"}),e.jsxs("div",{className:"space-y-3 border rounded-lg p-4 bg-muted/30",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(R,{id:"documents-approve",checked:pe.documentsVerified,onCheckedChange:e=>xe({...pe,documentsVerified:e})}),e.jsx("label",{htmlFor:"documents-approve",className:"text-sm font-medium cursor-pointer",children:"All required documents are verified"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(R,{id:"location-approve",checked:pe.locationVerified,onCheckedChange:e=>xe({...pe,locationVerified:e})}),e.jsx("label",{htmlFor:"location-approve",className:"text-sm font-medium cursor-pointer",children:"Property location is verified and accurate"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(R,{id:"price-approve",checked:pe.priceReasonable,onCheckedChange:e=>xe({...pe,priceReasonable:e})}),e.jsx("label",{htmlFor:"price-approve",className:"text-sm font-medium cursor-pointer",children:"Price is reasonable and competitive"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(R,{id:"images-approve",checked:pe.imagesQuality,onCheckedChange:e=>xe({...pe,imagesQuality:e})}),e.jsx("label",{htmlFor:"images-approve",className:"text-sm font-medium cursor-pointer",children:"Images are of good quality and relevant"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(R,{id:"description-approve",checked:pe.descriptionComplete,onCheckedChange:e=>xe({...pe,descriptionComplete:e})}),e.jsx("label",{htmlFor:"description-approve",className:"text-sm font-medium cursor-pointer",children:"Description is complete and accurate"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(R,{id:"ownership-approve",checked:pe.ownershipConfirmed,onCheckedChange:e=>xe({...pe,ownershipConfirmed:e})}),e.jsx("label",{htmlFor:"ownership-approve",className:"text-sm font-medium cursor-pointer",children:"Ownership is confirmed and legitimate"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"handwritten-comments-approve",children:"Approval Notes & Comments"}),e.jsx(F,{id:"handwritten-comments-approve",placeholder:"Type your handwritten comments or notes here...",value:he,onChange:e=>je(e.target.value),className:"mt-1 min-h-[120px] font-handwriting",rows:6}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Add any additional observations, recommendations, or special notes"})]})]}),e.jsxs(S,{children:[e.jsx(f,{variant:"outline",onClick:()=>Z(!1),children:"Cancel"}),e.jsx(f,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{if(K&&oe.trim())try{ce({...le,[K._id]:!0});const e=await _(`/subadmin/properties/${K._id}/approve`,{method:"POST",body:JSON.stringify({approver:oe,notes:he})});await E(e),ne({title:"Success",description:"Property approved successfully"}),Z(!1),fe(),M(null),ue()}catch(e){ne({title:"Error",description:e.message||"Failed to approve property",variant:"destructive"})}finally{ce({...le,[K._id]:!1})}else ne({title:"Error",description:"Approver name is required",variant:"destructive"})},disabled:!oe.trim()||le[K?._id||""],children:le[K?._id||""]?"Approving...":"Approve Property"})]})]})}),e.jsx(N,{open:ee,onOpenChange:se,children:e.jsxs(b,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(y,{children:[e.jsx(w,{children:"Reject Property"}),e.jsxs(C,{children:['Complete the form and provide a reason for rejecting "',K?.title,'". The vendor will be notified.']})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Approver Name"}),e.jsx("div",{className:"p-3 rounded-md bg-muted border border-border mt-1",children:e.jsx("p",{className:"font-medium text-sm",children:oe||"Loading..."})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Automatically set from your logged-in account"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(k,{className:"text-base font-semibold",children:"Issues Found (Check applicable items)"}),e.jsxs("div",{className:"space-y-3 border rounded-lg p-4 bg-muted/30",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(R,{id:"documents-reject",checked:pe.documentsVerified,onCheckedChange:e=>xe({...pe,documentsVerified:e})}),e.jsx("label",{htmlFor:"documents-reject",className:"text-sm font-medium cursor-pointer",children:"Documents are incomplete or invalid"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(R,{id:"location-reject",checked:pe.locationVerified,onCheckedChange:e=>xe({...pe,locationVerified:e})}),e.jsx("label",{htmlFor:"location-reject",className:"text-sm font-medium cursor-pointer",children:"Property location is incorrect or unclear"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(R,{id:"price-reject",checked:pe.priceReasonable,onCheckedChange:e=>xe({...pe,priceReasonable:e})}),e.jsx("label",{htmlFor:"price-reject",className:"text-sm font-medium cursor-pointer",children:"Price is unreasonable or suspicious"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(R,{id:"images-reject",checked:pe.imagesQuality,onCheckedChange:e=>xe({...pe,imagesQuality:e})}),e.jsx("label",{htmlFor:"images-reject",className:"text-sm font-medium cursor-pointer",children:"Images are poor quality or irrelevant"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(R,{id:"description-reject",checked:pe.descriptionComplete,onCheckedChange:e=>xe({...pe,descriptionComplete:e})}),e.jsx("label",{htmlFor:"description-reject",className:"text-sm font-medium cursor-pointer",children:"Description is incomplete or misleading"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(R,{id:"ownership-reject",checked:pe.ownershipConfirmed,onCheckedChange:e=>xe({...pe,ownershipConfirmed:e})}),e.jsx("label",{htmlFor:"ownership-reject",className:"text-sm font-medium cursor-pointer",children:"Ownership cannot be confirmed"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"rejection-reason",children:"Rejection Reason *"}),e.jsx(F,{id:"rejection-reason",placeholder:"Enter the detailed reason for rejection...",value:ie,onChange:e=>te(e.target.value),className:"mt-1",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"handwritten-comments-reject",children:"Additional Comments"}),e.jsx(F,{id:"handwritten-comments-reject",placeholder:"Type your handwritten comments or notes here...",value:he,onChange:e=>je(e.target.value),className:"mt-1 min-h-[120px] font-handwriting",rows:6}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Add any additional feedback or suggestions for the vendor"})]})]}),e.jsxs(S,{children:[e.jsx(f,{variant:"outline",onClick:()=>se(!1),children:"Cancel"}),e.jsx(f,{variant:"destructive",onClick:async()=>{if(K&&ie.trim()&&oe.trim())try{ce({...le,[K._id]:!0});const e=await _(`/subadmin/properties/${K._id}/reject`,{method:"POST",body:JSON.stringify({reason:ie,approver:oe,notes:he})});await E(e),ne({title:"Success",description:"Property rejected successfully"}),se(!1),fe(),M(null),ue()}catch(e){ne({title:"Error",description:"Failed to reject property",variant:"destructive"})}finally{ce({...le,[K._id]:!1})}else ne({title:"Error",description:"Approver name and rejection reason are required",variant:"destructive"})},disabled:!ie.trim()||!oe.trim()||le[K?._id||""],children:le[K?._id||""]?"Rejecting...":"Reject Property"})]})]})}),e.jsx(N,{open:ae,onOpenChange:re,children:e.jsxs(b,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(y,{children:[e.jsx(w,{className:"text-2xl",children:K?.title}),e.jsx(C,{children:e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(h,{className:"w-4 h-4"}),K?.address.street,", ",K?.address.city,", ",K?.address.state," - ",K?.address.pincode||K?.address.zipCode]})})]}),K&&e.jsxs("div",{className:"space-y-6 mt-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(u,{variant:"available"===K.status?"default":"pending"===K.status?"outline":"destructive",children:["Status: ",K.status]}),e.jsx(u,{variant:"secondary",className:"capitalize",children:K.type?K.type.replace("_"," "):"property"}),e.jsxs(u,{variant:"sale"===K.listingType?"default":"outline",children:["For ","sale"===K.listingType?"Sale":"Rent"]}),K.featured&&e.jsx(u,{variant:"default",children:"Featured"}),K.verified&&e.jsx(u,{variant:"default",children:"Verified"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Price"}),e.jsx("p",{className:"font-semibold",children:ve(K.price)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Area"}),e.jsx("p",{className:"font-semibold",children:(ge=K.area,ge.builtUp?`${ge.builtUp} ${ge.unit}`:ge.plot?`${ge.plot} ${ge.unit}`:ge.carpet?`${ge.carpet} ${ge.unit}`:"N/A")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bedrooms"}),e.jsx("p",{className:"font-semibold",children:K.bedrooms||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bathrooms"}),e.jsx("p",{className:"font-semibold",children:K.bathrooms||"N/A"})]})]})]}),e.jsx(V,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:K.description})]}),K.amenities&&K.amenities.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(V,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Amenities"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:K.amenities.map((s,a)=>e.jsx(u,{variant:"outline",className:"capitalize",children:s.replace("_"," ")},a))})]})]}),e.jsx(V,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Owner Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Name"}),e.jsx("p",{className:"font-medium",children:K.owner?.profile?.firstName&&K.owner?.profile?.lastName?`${K.owner.profile.firstName} ${K.owner.profile.lastName}`:K.owner.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Email"}),e.jsx("p",{className:"font-medium",children:K.owner?.email})]}),K.owner?.profile?.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"font-medium",children:K.owner.profile.phone})]})]})]}),K.images&&K.images.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(V,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Images"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:K.images.map((s,a)=>{const r="object"==typeof s?s:{};return e.jsxs("div",{className:"relative aspect-video rounded-lg overflow-hidden border",children:[e.jsx("img",{src:I(s),alt:r.caption||`Property ${a+1}`,className:"w-full h-full object-cover",onError:e=>{e.target.src=m}}),r.isPrimary&&e.jsx(u,{className:"absolute top-2 left-2",variant:"default",children:"Primary"})]},a)})})]})]}),K.videos&&K.videos.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(V,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Videos"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:K.videos.map((s,a)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"relative aspect-video rounded-lg overflow-hidden border bg-black",children:s.url&&(s.url.includes("youtube.com")||s.url.includes("youtu.be"))?e.jsx("iframe",{src:s.url.replace("watch?v=","embed/").replace("youtu.be/","youtube.com/embed/"),className:"w-full h-full",allowFullScreen:!0,title:s.caption||`Video ${a+1}`}):e.jsx("video",{src:s.url,controls:!0,className:"w-full h-full object-contain",poster:s.thumbnail})}),s.caption&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.caption})]},a))})]})]}),K.virtualTour&&e.jsxs(e.Fragment,{children:[e.jsx(V,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Virtual Tour"}),e.jsx(T,{url:K.virtualTour})]})]}),"rejected"===K.status&&K.rejectionReason&&e.jsxs(e.Fragment,{children:[e.jsx(V,{}),e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-red-700 mb-2",children:"Rejection Reason"}),e.jsx("p",{className:"text-sm text-red-600",children:K.rejectionReason})]})]})]})]})})]});var ge};export{q as default};

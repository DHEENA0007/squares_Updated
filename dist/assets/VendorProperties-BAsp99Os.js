import{j as e}from"./ui-s1SEoZIF.js";import{r as s,R as a,h as t,L as l}from"./router-D8v2YSKU.js";import{a2 as r,K as i,a4 as d,a5 as n,a6 as c,a7 as o,a8 as m,B as x,L as h,C as u,f as p,$ as j,I as g,q as f,r as v,s as N,v as y,w as b,T as w,ae as S,a3 as C,aO as P,a9 as k,a as T,e as A,bE as R,E as L,Q as $,k as F,aE as M,aF as V,aG as E,aJ as U,U as _,ad as z,t as O}from"./index-xsqbJ4m0.js";import{A as B,a as D}from"./alert-Dux5JL-p.js";import{C as G}from"./circle-alert-CvY5yZof.js";import{C as Y}from"./camera-BB6KJ8JW.js";import{E as q}from"./ellipsis-vertical-CzebuAxp.js";import{P as H}from"./pen-line-BB8b5nxt.js";import{T as I}from"./trending-up-pGp2EKGV.js";import{C as J}from"./calendar-Bl36fNYg.js";import"./vendor-BxThA0WO.js";const K=({property:t,open:l,onOpenChange:C,onUpdateStatus:P})=>{const{toast:k}=r(),[T,A]=s.useState(""),[R,L]=s.useState(""),[$,F]=s.useState(!1),[M,V]=s.useState(""),[E,U]=s.useState([]),[_,z]=s.useState(!1),[O,Y]=s.useState(""),q="available"===t?.status,H=t?.status&&["rented","leased"].includes(t.status),I=(()=>{if(!t)return null;const e=t.listingType||"sale",s=t.status;return"rented"===s&&"rent"===e||"leased"===s&&"lease"===e?{value:"available",label:"Mark as Available",color:"bg-green-500",isRevert:!0}:"sale"===e?{value:"sold",label:"Mark as Sold",color:"bg-blue-500",isRevert:!1}:"rent"===e?{value:"rented",label:"Mark as Rented",color:"bg-purple-500",isRevert:!1}:"lease"===e?{value:"leased",label:"Mark as Leased",color:"bg-indigo-500",isRevert:!1}:null})();s.useEffect(()=>{l&&q&&I&&!I.isRevert&&J()},[l,I]);const J=async()=>{try{z(!0);const e=await i.getUsers({role:"customer",limit:100,status:"available"});e.success&&e.data?.users?U(e.data.users):k({title:"Warning",description:"Failed to load customers properly.",variant:"default"})}catch(e){k({title:"Error",description:"Failed to load customers.",variant:"destructive"})}finally{z(!1)}},K=E.filter(e=>{const s=O.toLowerCase(),a=`${e.profile?.firstName||""} ${e.profile?.lastName||""}`.toLowerCase(),t=e.email?.toLowerCase()||"";return a.includes(s)||t.includes(s)});a.useEffect(()=>{t&&l&&(A(""),L(""),V(""),Y(""))},[t,l]);const Q=e=>{switch(e){case"active":return"bg-green-500";case"pending":return"bg-yellow-500";case"sold":return"bg-blue-500";case"rented":return"bg-purple-500";case"leased":return"bg-indigo-500";case"rejected":return"bg-red-500";default:return"bg-gray-500"}},W=e=>{switch(e){case"active":return"Active";case"pending":return"Pending Approval";case"sold":return"Sold";case"rented":return"Rented";case"leased":return"Leased";case"rejected":return"Rejected";default:return e.charAt(0).toUpperCase()+e.slice(1)}};return e.jsx(d,{open:l,onOpenChange:C,children:e.jsxs(n,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(c,{children:[e.jsx(o,{children:"Update Property Status"}),e.jsx(m,{children:t?.title}),t?.listingType&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Listing Type: ",e.jsx(x,{variant:"outline",className:"ml-1",children:t.listingType})]})]}),"        ",e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Current Status"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(x,{className:`${Q(t?.status||"")} text-white`,children:W(t?.status||"")})})]}),!q&&!H&&e.jsxs(B,{children:[e.jsx(G,{className:"h-4 w-4"}),e.jsxs(D,{children:["This property is not yet approved by admin. You can only update the status to ",I?.label.toLowerCase()," after admin approval."]})]}),"sold"===t?.status?e.jsxs(B,{children:[e.jsx(u,{className:"h-4 w-4"}),e.jsx(D,{children:"This property has been sold and cannot be made available again."})]}):"rented"!==t?.status&&"leased"!==t?.status||H?""===T?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Action"}),e.jsx(p,{onClick:()=>{I&&A(I.value)},disabled:!q&&!H||!I,className:`w-full ${I?.color||"bg-primary"} hover:opacity-90 text-white`,size:"lg",children:I?.label||"Update Status"}),!q&&!H&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Button will be enabled once admin approves your property"}),I?.isRevert&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["This will make the property available for ",t?.listingType," again"]})]})}):e.jsxs(e.Fragment,{children:[!I?.isRevert&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"customer-search",children:"Search Customer"}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(g,{id:"customer-search",placeholder:"Search by name or email...",value:O,onChange:e=>Y(e.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"customer-select",children:"Assign To Customer *"}),_?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading customers..."}):e.jsxs(f,{value:M,onValueChange:V,children:[e.jsx(v,{children:e.jsx(N,{placeholder:"Select customer who bought/rented this property"})}),e.jsx(y,{children:0===K.length?e.jsx("div",{className:"p-2 text-sm text-muted-foreground text-center",children:O?"No customers found":"No customers available"}):K.map(s=>e.jsx(b,{value:s._id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-medium",children:[s.profile?.firstName," ",s.profile?.lastName]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:(e=>{const[s,a]=e.split("@");return`${s.length>3?s.substring(0,2)+"*".repeat(s.length-3)+s.slice(-1):s.substring(0,1)+"*".repeat(s.length-1)}@${a}`})(s.email)})]})},s._id))})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This property will be added to the selected customer's portfolio"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"reason",children:"Additional Notes (Optional)"}),e.jsx(w,{id:"reason",placeholder:"Add any notes about this transaction...",value:R,onChange:e=>L(e.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Status Change Preview"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:`${Q(t?.status||"")} text-white`,children:W(t?.status||"")}),e.jsx("span",{className:"text-muted-foreground",children:"â†’"}),e.jsx(x,{className:`${I?.color||"bg-gray-500"} text-white`,children:W(T)})]})]})]}):e.jsxs(B,{children:[e.jsx(u,{className:"h-4 w-4"}),e.jsxs(D,{children:["This property has already been marked as ",W(t.status).toLowerCase(),"."]})]})]}),e.jsxs(S,{children:[e.jsx(p,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),T&&e.jsx(p,{onClick:async()=>{if(t&&T)if(I?.isRevert||M){F(!0);try{await P(t._id,T,I?.isRevert?void 0:M,R.trim()||void 0),C(!1)}catch(e){}finally{F(!1)}}else k({title:"Customer Required",description:`Please select a customer to assign this ${T} property to.`,variant:"destructive"})},disabled:$||!I?.isRevert&&!M,className:`${I?.color||"bg-primary"} hover:opacity-90 text-white`,children:$?"Updating...":`Confirm ${I?.label}`})]})]})})},Q=()=>{const[a]=t(),[r,i]=s.useState(a.get("search")||""),[d,n]=s.useState("all"),[c,o]=s.useState("all"),[m,h]=s.useState(!0),[u,w]=s.useState([]),[S,B]=s.useState(!1),[D,G]=s.useState(null),[Q,W]=s.useState([]),[X,Z]=s.useState(!0),[ee,se]=s.useState({totalProperties:0,totalViews:0,totalFavorites:0,averageRating:0}),[ae,te]=s.useState({currentPage:1,totalPages:1,totalProperties:0,hasNextPage:!1,hasPrevPage:!1});s.useEffect(()=>{re(),ie(),le()},[]);const le=async()=>{try{Z(!0);const e=(await C.getAllPropertyTypes(!1)).sort((e,s)=>(e.displayOrder||0)-(s.displayOrder||0)).map(e=>({value:e.value,label:e.name}));W(e)}catch(e){W([{value:"apartment",label:"Apartment"},{value:"house",label:"House"},{value:"villa",label:"Villa"},{value:"plot",label:"Plot"},{value:"land",label:"Land"},{value:"commercial",label:"Commercial"},{value:"office",label:"Office"},{value:"pg",label:"PG (Paying Guest)"}])}finally{Z(!1)}};s.useEffect(()=>{const e=a.get("search");e&&i(e)},[a]),s.useEffect(()=>{re()},[r,d,c]);const re=async()=>{try{h(!0);const e={page:1,limit:10,...r&&{search:r},..."all"!==d&&{status:d},..."all"!==c&&{propertyType:c}},s=await P.getVendorProperties(e);w(s.data.properties),te(s.data.pagination)}catch(e){}finally{h(!1)}},ie=async()=>{try{const e=await P.getVendorPropertyStats();se(e)}catch(e){}},de=async(e,s)=>{try{await P.togglePropertyFeatured(e,!s),re(),ie()}catch(a){}},ne=e=>{G(e),B(!0)},ce=e=>{const s=[];return e.address.locationName&&s.push(e.address.locationName),e.address.city&&s.push(e.address.city),e.address.state&&s.push(e.address.state),s.join(", ")||"Location not specified"};return m?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading properties..."})]})}):e.jsxs("div",{className:"space-y-4 md:space-y-6 mt-6 px-4 md:px-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"My Properties"}),e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"Manage and track your property listings"})]}),e.jsx(l,{to:"/vendor/properties/add",className:"w-full sm:w-auto",children:e.jsxs(p,{className:"w-full",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Add Property"]})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 md:gap-4",children:[e.jsx(T,{children:e.jsx(A,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs md:text-sm font-medium text-muted-foreground",children:"Total Properties"}),e.jsx("p",{className:"text-xl md:text-2xl font-bold",children:ee.totalProperties})]}),e.jsx(R,{className:"h-6 w-6 md:h-8 md:w-8 text-blue-600"})]})})}),e.jsx(T,{children:e.jsx(A,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs md:text-sm font-medium text-muted-foreground",children:"Total Views"}),e.jsx("p",{className:"text-xl md:text-2xl font-bold",children:ee.totalViews.toLocaleString()})]}),e.jsx(L,{className:"h-6 w-6 md:h-8 md:w-8 text-green-600"})]})})}),e.jsx(T,{className:"col-span-2 md:col-span-1",children:e.jsx(A,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs md:text-sm font-medium text-muted-foreground",children:"Avg. Rating"}),e.jsx("p",{className:"text-xl md:text-2xl font-bold",children:ee.averageRating.toFixed(1)})]}),e.jsx($,{className:"h-6 w-6 md:h-8 md:w-8 text-orange-600"})]})})})]}),e.jsx(T,{children:e.jsx(A,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(g,{placeholder:"Search properties...",value:r,onChange:e=>i(e.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(f,{value:d,onValueChange:n,children:[e.jsx(v,{className:"w-full sm:w-40",children:e.jsx(N,{placeholder:"Status"})}),e.jsxs(y,{children:[e.jsx(b,{value:"all",children:"All Status"}),e.jsx(b,{value:"available",children:"Available"}),e.jsx(b,{value:"pending",children:"Pending"}),e.jsx(b,{value:"sold",children:"Sold"}),e.jsx(b,{value:"rented",children:"Rented"}),e.jsx(b,{value:"leased",children:"Leased"})]})]}),e.jsxs(f,{value:c,onValueChange:o,disabled:X,children:[e.jsx(v,{className:"w-full sm:w-40",children:e.jsx(N,{placeholder:X?"Loading...":"Type"})}),e.jsxs(y,{children:[e.jsx(b,{value:"all",children:"All Types"}),Q.map(s=>e.jsx(b,{value:s.value,children:s.label},s.value))]})]})]})]})})}),e.jsx("div",{className:"space-y-4",children:u.map(s=>{return e.jsx(T,{className:"overflow-hidden",children:e.jsx(A,{className:"p-0",children:e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[e.jsxs("div",{className:"lg:w-64 h-48 lg:h-auto bg-muted relative",children:[s.images&&s.images.length>0?e.jsx("img",{src:P.getPrimaryImage(s),alt:s.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/20 to-transparent flex items-center justify-center",children:e.jsx(Y,{className:"w-12 h-12 text-muted-foreground"})}),e.jsxs("div",{className:"absolute top-2 left-2 md:top-3 md:left-3 flex gap-1 md:gap-2",children:[e.jsx(x,{className:`${P.getStatusColor(s.status)} text-white text-xs`,children:P.getStatusText(s.status)}),s.featured&&e.jsx(x,{variant:"secondary",className:"text-xs",children:"Featured"}),s.verified&&e.jsx(x,{className:"bg-green-600 text-white text-xs",children:"Verified"})]}),s.images&&s.images.length>0&&e.jsxs("div",{className:"absolute bottom-2 left-2 md:bottom-3 md:left-3 bg-black/70 text-white px-2 py-1 rounded text-xs md:text-sm",children:[s.images.length," ",1===s.images.length?"photo":"photos"]})]}),e.jsxs("div",{className:"flex-1 p-4 md:p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3 md:mb-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg md:text-xl font-semibold mb-1 truncate",children:s.title}),e.jsxs("p",{className:"text-muted-foreground flex items-center mb-2 text-sm",children:[e.jsx(F,{className:"w-4 h-4 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:ce(s)})]}),e.jsx("p",{className:"text-xl md:text-2xl font-bold text-primary",children:P.formatPrice(s.price,s.listingType)})]}),e.jsxs(M,{children:[e.jsx(V,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"flex-shrink-0",children:e.jsx(q,{className:"w-4 h-4"})})}),e.jsxs(E,{align:"end",children:[e.jsx(U,{asChild:!0,children:e.jsxs(l,{to:`/vendor/properties/details/${s._id}`,children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"View Details"]})}),e.jsx(U,{asChild:!0,children:e.jsxs(l,{to:`/vendor/properties/edit/${s._id}`,children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Edit Property"]})}),e.jsxs(U,{onClick:()=>de(s._id,s.featured),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),s.featured?"Unfeature":"Promote"]}),("available"===s.status||"rented"===s.status||"leased"===s.status)&&e.jsxs(U,{onClick:()=>ne(s),children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"available"===s.status?"sale"===s.listingType?"Mark as Sold":"rent"===s.listingType?"Mark as Rented":"Mark as Leased":"Mark as Available"]}),e.jsxs(U,{className:"text-red-600",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this property?"))try{await P.deleteProperty(e),re(),ie()}catch(s){}})(s._id),children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 mb-3 md:mb-4",children:[s.bedrooms>0&&e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Bedrooms"}),e.jsx("p",{className:"font-semibold text-sm md:text-base",children:s.bedrooms})]}),s.bathrooms>0&&e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Bathrooms"}),e.jsx("p",{className:"font-semibold text-sm md:text-base",children:s.bathrooms})]}),P.hasValidArea(s.area)&&e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Area"}),e.jsx("p",{className:"font-semibold text-sm md:text-base",children:P.formatArea(s.area)})]}),s.type&&e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Type"}),e.jsx("p",{className:"font-semibold text-sm md:text-base capitalize",children:s.type})]})]}),e.jsxs("div",{className:"flex flex-wrap justify-between items-center text-xs md:text-sm text-muted-foreground mb-3 md:mb-4 gap-2",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(L,{className:"w-3 h-3 md:w-4 md:h-4 mr-1"}),s.views," views"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx($,{className:"w-3 h-3 md:w-4 md:h-4 mr-1"}),s.favorites||0," favorites"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx($,{className:"w-3 h-3 md:w-4 md:h-4 mr-1 fill-current text-yellow-500"}),s.averageRating?.toFixed(1)||"0.0"," rating"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(J,{className:"w-3 h-3 md:w-4 md:h-4 mr-1"}),"Listed ",(a=s.createdAt,new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-2",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{to:`/vendor/properties/details/${s._id}`,className:"flex-1",children:e.jsxs(p,{size:"sm",variant:"outline",className:"w-full text-xs md:text-sm",children:[e.jsx(L,{className:"w-3 h-3 md:w-4 md:h-4 mr-1 md:mr-2"}),"View Details"]})}),e.jsx(l,{to:`/vendor/properties/edit/${s._id}`,className:"flex-1",children:e.jsxs(p,{size:"sm",variant:"outline",className:"w-full text-xs md:text-sm",children:[e.jsx(H,{className:"w-3 h-3 md:w-4 md:h-4 mr-1 md:mr-2"}),"Edit"]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{size:"sm",onClick:()=>de(s._id,s.featured),className:"flex-1 text-xs md:text-sm",children:[e.jsx(I,{className:"w-3 h-3 md:w-4 md:h-4 mr-1 md:mr-2"}),s.featured?"Unfeature":"Promote"]}),("available"===s.status||"rented"===s.status||"leased"===s.status)&&e.jsx(p,{size:"sm",variant:"outline",onClick:()=>ne(s),className:"flex-1 text-xs md:text-sm",children:"available"===s.status?"sale"===s.listingType?"Mark as Sold":"rent"===s.listingType?"Mark as Rented":"Mark as Leased":"Mark as Available"})]})]})})]})]})})},s._id);var a})}),0===u.length&&!m&&e.jsx(T,{children:e.jsxs(A,{className:"p-8 md:p-12 text-center",children:[e.jsx(R,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No properties found"}),e.jsx("p",{className:"text-muted-foreground mb-4 text-sm md:text-base",children:r||"all"!==d||"all"!==c?"No properties match your search criteria":"You haven't added any properties yet"}),e.jsx(l,{to:"/vendor/properties/add",className:"w-full sm:w-auto",children:e.jsxs(p,{className:"w-full sm:w-auto",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Add Your First Property"]})})]})}),e.jsx(K,{property:D,open:S,onOpenChange:B,onUpdateStatus:async(e,s,a,t)=>{try{w(a=>a.map(a=>a._id===e?{...a,status:s}:a)),!a||"sold"!==s&&"rented"!==s&&"leased"!==s?(await P.togglePropertyStatus(e,s),O({title:"Success",description:`Property status updated to ${s}!`})):(await P.assignPropertyToCustomer(e,a,s,t),O({title:"Success",description:`Property ${s} and assigned to customer successfully!`})),ie()}catch(l){re(),O({title:"Error",description:"Failed to update property status",variant:"destructive"})}}})]})};export{Q as default};

import{j as e}from"./ui-s1SEoZIF.js";import{w as s,u as t,t as a,a as l,b as r,c as i,G as n,e as d,y as c,d as o,X as x,I as m,m as h,n as u,o as p,p as v,q as j,B as g,f,a9 as y,a0 as w,a1 as N,a2 as R,a3 as b,a4 as E,T as S,aa as A,V as k}from"./index-YrVmIx3a.js";import{d as V,r as C}from"./router-D8v2YSKU.js";import{r as I}from"./reviewsService-E1EyDdEs.js";import"./vendor-BxThA0WO.js";const F=s("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]),D=s("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),M=s("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]),P=s("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]),W=()=>{const{user:s}=t(),W=V(),T=s?.rolePermissions||[],[_,L]=C.useState([]),[O,z]=C.useState({total:0,approved:0,pending:0,flagged:0,avgRating:0}),[B,Y]=C.useState(!0),[q,H]=C.useState(""),[U,Z]=C.useState("all"),[G,X]=C.useState("all"),[J,K]=C.useState(1),[Q,$]=C.useState(1),[ee,se]=C.useState(!1),[te,ae]=C.useState(null),[le,re]=C.useState(""),ie=e=>T.includes(e);C.useEffect(()=>{ie(k.REVIEWS_VIEW)||W("/rolebased")},[T]),C.useEffect(()=>{ne(),de()},[q,U,G,J]);const ne=async()=>{try{const e=await I.getAdminReviewStats();z(e)}catch(e){}},de=async()=>{Y(!0);try{const e={page:J,limit:10};q&&(e.search=q),"all"!==U&&(e.status=U),"all"!==G&&(e.rating=parseInt(G));const s=await I.getAdminReviews(e);L(s.reviews||[]),$(s.pagination?.pages||1)}catch(e){a({title:"Error",description:"Failed to fetch reviews",variant:"destructive"})}finally{Y(!1)}};return ie(k.REVIEWS_VIEW)?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Review Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage property reviews and ratings"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Total Reviews"}),e.jsx(n,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:O.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All published reviews"})]})]}),e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Average Rating"}),e.jsx(P,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:(O.avgRating||0).toFixed(1)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Out of 5 stars"})]})]}),e.jsxs(l,{children:[e.jsxs(r,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Flagged"}),e.jsx(c,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:O.flagged}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Inappropriate reviews"})]})]})]}),e.jsxs(l,{children:[e.jsxs(r,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(i,{children:"All Reviews"}),e.jsx(o,{children:"Moderate and manage property reviews"})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mt-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(x,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(m,{placeholder:"Search reviews...",value:q,onChange:e=>H(e.target.value),className:"pl-8"})]})}),e.jsxs(h,{value:U,onValueChange:Z,children:[e.jsx(u,{className:"w-[180px]",children:e.jsx(p,{placeholder:"Status"})}),e.jsxs(v,{children:[e.jsx(j,{value:"all",children:"All Reviews"}),e.jsx(j,{value:"flagged",children:"Flagged Only"})]})]}),e.jsxs(h,{value:G,onValueChange:X,children:[e.jsx(u,{className:"w-[180px]",children:e.jsx(p,{placeholder:"Rating"})}),e.jsxs(v,{children:[e.jsx(j,{value:"all",children:"All Ratings"}),e.jsx(j,{value:"5",children:"5 Stars"}),e.jsx(j,{value:"4",children:"4 Stars"}),e.jsx(j,{value:"3",children:"3 Stars"}),e.jsx(j,{value:"2",children:"2 Stars"}),e.jsx(j,{value:"1",children:"1 Star"})]})]})]})]}),e.jsxs(d,{children:[B?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading reviews..."})}):0===_.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(n,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"No Reviews Found"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"No reviews match your current filters"})]}):e.jsx("div",{className:"space-y-4",children:_.map(s=>e.jsx("div",{className:"p-4 border rounded-lg space-y-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"flex",children:[...Array(5)].map((t,a)=>e.jsx(n,{className:"h-4 w-4 "+(a<s.rating?"fill-yellow-400 text-yellow-400":"text-gray-300")},a))}),e.jsx(g,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Published"}),s.isFlagged&&e.jsx(g,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200",children:"Flagged"})]}),e.jsx("h4",{className:"font-semibold",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.comment}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["By: ",s.user?.name||"Unknown"]}),s.property&&e.jsxs("span",{children:["Property: ",s.property.name]}),s.vendor&&e.jsxs("span",{children:["Vendor: ",s.vendor.name]}),e.jsx("span",{children:new Date(s.createdAt).toLocaleDateString()})]}),s.vendorResponse&&e.jsxs("div",{className:"mt-4 pl-4 border-l-2 border-blue-200 bg-blue-50 p-3 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(D,{className:"h-3 w-3 text-blue-600"}),e.jsxs("span",{className:"text-xs font-semibold text-blue-700",children:[s.vendorResponse.respondedBy||"Admin",s.vendorResponse.respondedByRole&&e.jsxs("span",{className:"text-blue-600",children:[" (",s.vendorResponse.respondedByRole,")"]})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(s.vendorResponse.respondedAt).toLocaleDateString()})]}),e.jsx("p",{className:"text-sm text-gray-700",children:s.vendorResponse.message})]})]}),e.jsxs("div",{className:"flex gap-2",children:[ie(k.REVIEWS_RESPOND)&&e.jsx(f,{size:"sm",variant:"outline",onClick:()=>(async e=>{ie(k.REVIEWS_RESPOND)?(ae(e),se(!0)):a({title:"Access Denied",description:"You don't have permission to reply to reviews",variant:"destructive"})})(s.id),className:"text-blue-600 hover:text-blue-700",title:"Reply to review",children:e.jsx(M,{className:"h-4 w-4"})}),ie(k.REVIEWS_REPORT)&&!s.isFlagged&&e.jsx(f,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(ie(k.REVIEWS_REPORT))try{await I.flagReview(e),a({title:"Success",description:"Review flagged successfully"}),de(),ne()}catch(s){a({title:"Error",description:"Failed to flag review",variant:"destructive"})}else a({title:"Access Denied",description:"You don't have permission to flag reviews",variant:"destructive"})})(s.id),className:"text-orange-600 hover:text-orange-700",title:"Flag as inappropriate",children:e.jsx(F,{className:"h-4 w-4"})}),ie(k.REVIEWS_DELETE)&&e.jsx(f,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(ie(k.REVIEWS_DELETE)){if(confirm("Are you sure you want to delete this review?"))try{await I.deleteReview(e),a({title:"Success",description:"Review deleted successfully"}),de(),ne()}catch(s){a({title:"Error",description:"Failed to delete review",variant:"destructive"})}}else a({title:"Access Denied",description:"You don't have permission to delete reviews",variant:"destructive"})})(s.id),className:"text-red-600 hover:text-red-700",title:"Delete review",children:e.jsx(y,{className:"h-4 w-4"})})]})]})},s.id))}),!B&&_.length>0&&Q>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>K(e=>Math.max(1,e-1)),disabled:1===J,children:"Previous"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",J," of ",Q]}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>K(e=>Math.min(Q,e+1)),disabled:J===Q,children:"Next"})]})]})]}),e.jsx(w,{open:ee,onOpenChange:se,children:e.jsxs(N,{children:[e.jsxs(R,{children:[e.jsx(b,{children:"Reply to Review"}),e.jsx(E,{children:"Write a response to this customer review"})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(S,{placeholder:"Enter your reply...",value:le,onChange:e=>re(e.target.value),rows:5})}),e.jsxs(A,{children:[e.jsx(f,{variant:"outline",onClick:()=>{se(!1),re(""),ae(null)},children:"Cancel"}),e.jsx(f,{onClick:async()=>{if(le.trim()){if(te)try{await I.replyToReview(te,le),a({title:"Success",description:"Reply posted successfully"}),se(!1),re(""),ae(null),de()}catch(e){a({title:"Error",description:"Failed to post reply",variant:"destructive"})}}else a({title:"Error",description:"Please enter a reply message",variant:"destructive"})},children:"Post Reply"})]})]})})]}):null};export{W as default};

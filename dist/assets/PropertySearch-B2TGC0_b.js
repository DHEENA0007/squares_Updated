import{j as e}from"./ui-s1SEoZIF.js";import{r as s,d as a,h as t}from"./router-D8v2YSKU.js";import{_ as l,ax as r,a as i,e as c,X as n,I as d,m,n as o,o as x,p as h,q as p,f as u,x as j,H as f,Z as v,B as N,k as g,av as y,aw as b,$ as w}from"./index-YrVmIx3a.js";import{S}from"./slider-D_-wbR6w.js";import{C as k}from"./checkbox-OYdlbG4C.js";import{f as C}from"./favoriteService-DwzATwTP.js";import{S as P}from"./square-Cto-ijCZ.js";import"./vendor-BxThA0WO.js";const _=()=>{const[_,A]=s.useState([]),[T,F]=s.useState([]),[$,E]=s.useState([]),q=a(),{toast:L}=l(),[M]=t(),[V,z]=s.useState([]),[O,R]=s.useState(!0),[B,U]=s.useState(""),[D,H]=s.useState("all"),[I,X]=s.useState("all"),[Z,G]=s.useState([0,2e7]),[J,K]=s.useState([0,1e4]),[Q,W]=s.useState([]),[Y,ee]=s.useState({}),[se,ae]=s.useState(1),[te,le]=s.useState(1),[re,ie]=s.useState(new Set),ce=e=>T.filter(s=>s.filterType===e&&s.isActive).sort((e,s)=>e.displayOrder-s.displayOrder),ne=s.useMemo(()=>Array.from(new Set(T.map(e=>e.filterType))),[T]);s.useEffect(()=>{(async()=>{try{const[e,s]=await Promise.all([w.getAllPropertyTypes(!1),w.getAllFilterConfigurations(!1)]);A(e),F(s)}catch(e){}})()},[]),s.useEffect(()=>{_.length>0&&(async()=>{try{if("all"===I){const e=await w.getAllAmenities(!1);E(e)}else{const e=_.find(e=>e.value===I);if(e){const s=await w.getPropertyTypeAmenities(e._id);E(s)}else E([])}}catch(e){E([])}})()},[I,_]),s.useEffect(()=>{const e=M.get("q"),s=M.get("listingType"),a=M.get("propertyType");e&&U(e),s&&"all"!==s&&H(s),a&&"all"!==a&&X(a),ae(1)},[M]),s.useEffect(()=>{de()},[B,D,I,Z,J,Q,Y,se]);const de=async()=>{R(!0);try{const e={page:se,limit:12};B.trim()&&(e.search=B),"all"!==D&&(e.listingType=D),"all"!==I&&(e.propertyType=I),Object.entries(Y).forEach(([s,a])=>{a&&"any"!==a&&(e[s]=a)}),Z[0]>0&&(e.minPrice=Z[0]),Z[1]<2e7&&(e.maxPrice=Z[1]),J[0]>0&&(e.minArea=J[0]),J[1]<1e4&&(e.maxArea=J[1]),Q.length>0&&(e.amenities=Q);const s=await r.getProperties(e);s.success&&(z(s.data.properties),le(s.data.pagination.totalPages))}catch(e){L({title:"Error",description:"Failed to load properties",variant:"destructive"})}finally{R(!1)}};s.useEffect(()=>{me()},[]);const me=async()=>{try{const e=await C.getFavorites();if(e.success){const s=new Set(e.data.favorites.map(e=>e.property?._id).filter(Boolean));ie(s)}}catch(e){}},oe=()=>{U(""),H("all"),X("all"),G([0,2e7]),K([0,1e4]),W([]),ee({}),ae(1)},xe=e=>e>=1e7?`₹${(e/1e7).toFixed(2)} Cr`:e>=1e5?`₹${(e/1e5).toFixed(2)} L`:`₹${e.toLocaleString()}`;return e.jsxs("div",{className:"min-h-screen",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary/10 to-primary/5 border-b",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Search Properties"}),e.jsx("p",{className:"text-muted-foreground",children:"Find your dream property from our verified listings"})]})}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("aside",{className:"lg:w-80 flex-shrink-0",children:e.jsx(i,{className:"sticky top-20 max-h-[calc(100vh-6rem)] overflow-y-auto",children:e.jsxs(c,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Filters"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(n,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(d,{placeholder:"Location, property name...",value:B,onChange:e=>U(e.target.value),className:"pl-10"})]})]}),ce("listing_type").length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Listing Type"}),e.jsxs(m,{value:D,onValueChange:H,children:[e.jsx(o,{children:e.jsx(x,{placeholder:"Type"})}),e.jsxs(h,{className:"max-h-[300px] overflow-y-auto",children:[e.jsx(p,{value:"all",children:"All Types"}),ce("listing_type").map(s=>e.jsx(p,{value:s.value,children:s.displayLabel?.trim()||s.name},s._id))]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Property Type"}),e.jsxs(m,{value:I,onValueChange:e=>{X(e),ee({}),W([])},children:[e.jsx(o,{children:e.jsx(x,{placeholder:"Property"})}),e.jsxs(h,{className:"max-h-[300px] overflow-y-auto",children:[e.jsx(p,{value:"all",children:"All Properties"}),_.map(s=>e.jsx(p,{value:s.value,children:s.name},s.value))]})]})]}),ne.filter(e=>"listing_type"!==e).map(s=>{const a=ce(s);return 0===a.length?null:e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block capitalize",children:s.replace(/_/g," ")}),e.jsxs(m,{value:Y[s]||"any",onValueChange:e=>{ee(a=>({...a,[s]:e}))},children:[e.jsx(o,{children:e.jsx(x,{placeholder:`Select ${s.replace(/_/g," ")}`})}),e.jsxs(h,{className:"max-h-[300px] overflow-y-auto",children:[e.jsx(p,{value:"any",children:"Any"}),a.map(s=>e.jsx(p,{value:s.value,children:s.displayLabel?.trim()||s.name},s._id))]})]})]},s)}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Price Range"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{value:Z,onValueChange:G,min:0,max:2e7,step:1e5,className:"w-full"}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Min Price"}),e.jsx("span",{className:"font-semibold text-primary",children:xe(Z[0])})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Max Price"}),e.jsx("span",{className:"font-semibold text-primary",children:xe(Z[1])})]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Area (sq ft)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{value:J,onValueChange:K,min:0,max:1e4,step:100,className:"w-full"}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Min"}),e.jsxs("span",{className:"font-semibold text-primary",children:[J[0]," sqft"]})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Max"}),e.jsxs("span",{className:"font-semibold text-primary",children:[J[1]," sqft"]})]})]})]})]}),$.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Amenities"}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2 border rounded-md p-3",children:$.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{id:s._id,checked:Q.includes(s.name),onCheckedChange:e=>{W(e?[...Q,s.name]:Q.filter(e=>e!==s.name))}}),e.jsx("label",{htmlFor:s._id,className:"text-sm font-normal cursor-pointer leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:s.name})]},s._id))}),Q.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:[Q.length," selected"]})]}),e.jsx(u,{variant:"outline",onClick:oe,className:"w-full",children:"Reset Filters"})]})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Available Properties"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:O?"Loading...":`${V.length} properties found`})]}),O?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(j,{className:"h-8 w-8 animate-spin text-primary"})}):0===V.length?e.jsx(i,{children:e.jsxs(c,{className:"p-12 text-center",children:[e.jsx(f,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No properties found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Try adjusting your filters or search criteria"}),e.jsx(u,{onClick:oe,children:"Clear Filters"})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:V.map(s=>e.jsxs(i,{className:"overflow-hidden hover:shadow-lg transition-shadow cursor-pointer",children:[e.jsxs("div",{className:"relative h-48 bg-muted",onClick:()=>q(`/property/${s._id}`),children:[s.images&&s.images.length>0?e.jsx("img",{src:"string"==typeof s.images[0]?s.images[0]:s.images[0]?.url,alt:s.title,className:"w-full h-full object-cover",onError:e=>{e.target.src="/placeholder-property.jpg"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(f,{className:"h-12 w-12 text-muted-foreground"})}),e.jsx(u,{size:"icon",variant:"secondary",className:"absolute top-2 right-2",onClick:e=>{e.stopPropagation(),(async e=>{try{re.has(e)?(await C.removeFromFavorites(e),ie(s=>{const a=new Set(s);return a.delete(e),a}),L({title:"Removed from favorites",description:"Property removed from your favorites"})):(await C.addToFavorites(e),ie(s=>new Set(s).add(e)),L({title:"Added to favorites",description:"Property added to your favorites"}))}catch(s){L({title:"Error",description:"Failed to update favorite",variant:"destructive"})}})(s._id)},children:e.jsx(v,{className:"h-4 w-4 "+(re.has(s._id)?"fill-red-500 text-red-500":"")})}),e.jsx(N,{className:"absolute top-2 left-2 capitalize",children:s.listingType})]}),e.jsxs(c,{className:"p-4",onClick:()=>q(`/customer/property/${s._id}`),children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg line-clamp-1",children:s.title}),e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground mt-1",children:[e.jsx(g,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"line-clamp-1",children:s.address.district?`${s.address.city}, ${s.address.district}, ${s.address.state}`:`${s.address.city}, ${s.address.state}`})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:xe(s.price)}),"rent"===s.listingType&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"/month"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[s.bedrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx("span",{children:s.bedrooms})]}),s.bathrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx("span",{children:s.bathrooms})]}),s.area?.builtUp&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.area.builtUp," sqft"]})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t",children:e.jsx(N,{variant:"outline",className:"capitalize",children:s.type})})]})]},s._id))}),te>1&&e.jsxs("div",{className:"flex justify-center gap-2 mt-8",children:[e.jsx(u,{variant:"outline",disabled:1===se,onClick:()=>ae(e=>e-1),children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:Array.from({length:te},(e,s)=>s+1).map(s=>e.jsx(u,{variant:se===s?"default":"outline",onClick:()=>ae(s),className:"w-10",children:s},s))}),e.jsx(u,{variant:"outline",disabled:se===te,onClick:()=>ae(e=>e+1),children:"Next"})]})]})]})]})})]})};export{_ as default};

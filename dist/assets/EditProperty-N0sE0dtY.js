import{j as e}from"./ui-DOY6021Z.js";import{g as X,d as K,r as x}from"./router-2SVJvIbS.js";import{G as Q,ao as V,f as m,a as g,b as j,c as y,e as v,I as d,q as Z,r as ee,s as re,v as ae,w as se,D as te,X as q}from"./index-SPvHGBGF.js";import{L as i}from"./label-BbghIvjf.js";import{T as ie}from"./textarea-CVqyUzcD.js";import{C as le}from"./checkbox-BLKtZrMn.js";import{R as oe,a as T}from"./radio-group-KVKgiz_q.js";import{A as L}from"./arrow-left-KXNCpd3b.js";import{C as de}from"./camera-B2l7RznL.js";import{U as E}from"./upload-M5vGeLw_.js";import{V as R}from"./video-030_60Lj.js";import{L as ce}from"./loader-circle-B83afoI3.js";import{S as ne}from"./save-D5MdAwIN.js";import"./vendor-Dazix4UH.js";const B=async(f,h)=>{const u=new FormData;u.append("file",f),u.append("folder",h);try{const p=await fetch("https://squares-v2.onrender.com/api/upload/single",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:u});if(!p.ok)throw new Error("Failed to upload file");const b=await p.json();if(!b.success)throw new Error(b.message||"Upload failed");return b.data.url}catch(p){throw console.error("File upload error:",p),new Error("Failed to upload file")}},Fe=()=>{const{id:f}=X(),h=K(),{toast:u}=Q(),[p,b]=x.useState(null),[D,U]=x.useState(!0),[A,k]=x.useState(!1),[C,N]=x.useState([]),[F,P]=x.useState([]),[a,S]=x.useState({title:"",description:"",type:"",listingType:"",price:"",bedrooms:"",bathrooms:"",builtUpArea:"",carpetArea:"",plotArea:"",street:"",city:"",state:"",pincode:"",amenities:[],virtualTour:""}),M=[{value:"apartment",label:"Apartment"},{value:"villa",label:"Villa"},{value:"house",label:"House"},{value:"commercial",label:"Commercial"},{value:"plot",label:"Plot"},{value:"land",label:"Land"},{value:"office",label:"Office Space"},{value:"pg",label:"PG (Paying Guest)"}],O=["Swimming Pool","Gym/Fitness Center","Parking","Security","Garden/Park","Playground","Clubhouse","Power Backup","Elevator","WiFi","CCTV Surveillance","Intercom","Water Supply","Waste Management","Fire Safety","Visitor Parking","Shopping Complex","Restaurant","Spa","Jogging Track"];x.useEffect(()=>{f&&$(f)},[f]);const $=async r=>{try{U(!0);const s=(await V.getProperty(r)).data.property;b(s),S({title:s.title,description:s.description,type:s.type,listingType:s.listingType,price:s.price.toString(),bedrooms:s.bedrooms.toString(),bathrooms:s.bathrooms.toString(),builtUpArea:s.area.builtUp?.toString()||"",carpetArea:s.area.carpet?.toString()||"",plotArea:s.area.plot?.toString()||"",street:s.address.street,city:s.address.city,state:s.address.state,pincode:s.address.pincode,amenities:s.amenities||[],virtualTour:s.virtualTour||""}),s.videos&&P(s.videos.map((t,c)=>({id:`existing-video-${c}`,name:t.caption||`Video ${c+1}`,url:t.url}))),s.images&&N(s.images.map((t,c)=>({id:`existing-${c}`,name:t.caption||`Image ${c+1}`,url:t.url,isPrimary:t.isPrimary})))}catch(l){console.error("Failed to load property:",l),u({title:"Error",description:"Failed to load property details",variant:"destructive"}),h("/vendor/properties")}finally{U(!1)}},o=(r,l)=>{S(s=>({...s,[r]:l}))},G=r=>{S(l=>({...l,amenities:l.amenities.includes(r)?l.amenities.filter(s=>s!==r):[...l.amenities,r]}))},z=r=>{if(r.target.files){const l=Array.from(r.target.files);N(s=>[...s,...l.map(t=>({id:Date.now()+Math.random(),name:t.name,url:URL.createObjectURL(t),file:t,isPrimary:s.length===0}))])}},W=r=>{N(l=>{const s=l.filter(t=>t.id!==r);return s.length>0&&!s.some(t=>t.isPrimary)&&(s[0].isPrimary=!0),s})},_=r=>{if(r.target.files){const l=Array.from(r.target.files);P(s=>[...s,...l.map(t=>({id:Date.now()+Math.random(),name:t.name,url:URL.createObjectURL(t),file:t}))])}},H=r=>{P(l=>l.filter(s=>s.id!==r))},Y=r=>{N(l=>l.map(s=>({...s,isPrimary:s.id===r})))},J=async r=>{if(r.preventDefault(),!p||A)return;const l={title:a.title?.trim(),description:a.description?.trim(),type:a.type,listingType:a.listingType,price:a.price,city:a.city?.trim(),pincode:a.pincode?.trim()},s=Object.entries(l).filter(([t,c])=>!c).map(([t])=>t);if(s.length>0){u({title:"Missing Required Fields",description:`Please fill in: ${s.join(", ")}`,variant:"destructive"});return}k(!0);try{const t=[];for(const n of C)if(n.file){const w=await B(n.file,"property_images");t.push({url:w,caption:n.name,isPrimary:n.isPrimary})}else t.push({url:n.url,caption:n.name,isPrimary:n.isPrimary});const c=[];for(const n of F)if(n.file){const w=await B(n.file,"property_videos");c.push({url:w,caption:n.name})}else c.push({url:n.url,caption:n.name});const I={title:a.title.trim(),description:a.description.trim(),type:a.type,listingType:a.listingType,price:parseFloat(a.price),bedrooms:parseInt(a.bedrooms)||0,bathrooms:parseInt(a.bathrooms)||0,area:{builtUp:a.builtUpArea?parseFloat(a.builtUpArea):void 0,carpet:a.carpetArea?parseFloat(a.carpetArea):void 0,plot:a.plotArea?parseFloat(a.plotArea):void 0,unit:"sqft"},address:{street:a.street.trim()||"",locality:"",city:a.city.trim(),state:a.state.trim(),pincode:a.pincode.trim()},amenities:a.amenities,images:t,videos:c};a.virtualTour?.trim()&&(I.virtualTour=a.virtualTour.trim()),await V.updateProperty(p._id,I),u({title:"Success!",description:"Property updated successfully."}),h(`/vendor/properties/details/${p._id}`)}catch(t){console.error("Error updating property:",t);let c="Failed to update property. Please try again.";t instanceof Error&&(c=t.message),u({title:"Error",description:c,variant:"destructive"})}finally{k(!1)}};return D?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading property..."})]})}):p?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>h("/vendor/properties"),children:e.jsx(L,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Edit Property"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Update your property details"})]})]})}),e.jsx("form",{onSubmit:J,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(j,{children:e.jsx(y,{children:"Basic Details"})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"title",children:"Property Title *"}),e.jsx(d,{id:"title",value:a.title,onChange:r=>o("title",r.target.value),placeholder:"Enter property title",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"type",children:"Property Type *"}),e.jsxs(Z,{value:a.type,onValueChange:r=>o("type",r),children:[e.jsx(ee,{children:e.jsx(re,{placeholder:"Select property type"})}),e.jsx(ae,{children:M.map(r=>e.jsx(se,{value:r.value,children:r.label},r.value))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Listing Type *"}),e.jsxs(oe,{value:a.listingType,onValueChange:r=>o("listingType",r),className:"flex flex-row space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{value:"sale",id:"sale"}),e.jsx(i,{htmlFor:"sale",children:"For Sale"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{value:"rent",id:"rent"}),e.jsx(i,{htmlFor:"rent",children:"For Rent"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{value:"lease",id:"lease"}),e.jsx(i,{htmlFor:"lease",children:"For Lease"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"description",children:"Description"}),e.jsx(ie,{id:"description",value:a.description,onChange:r=>o("description",r.target.value),placeholder:"Describe your property...",rows:4})]})]})]}),e.jsxs(g,{children:[e.jsx(j,{children:e.jsx(y,{children:"Property Details"})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"price",children:"Price *"}),e.jsx(d,{id:"price",type:"number",value:a.price,onChange:r=>o("price",r.target.value),placeholder:"Enter price",required:!0})]}),["apartment","villa","house","pg"].includes(a.type)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"bedrooms",children:a.type==="pg"?"Room Sharing":"Bedrooms"}),e.jsx(d,{id:"bedrooms",type:"number",value:a.bedrooms,onChange:r=>o("bedrooms",r.target.value),placeholder:a.type==="pg"?"Number of people per room":"Number of bedrooms",min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"bathrooms",children:a.type==="pg"?"Bathroom Type":"Bathrooms"}),e.jsx(d,{id:"bathrooms",type:"number",value:a.bathrooms,onChange:r=>o("bathrooms",r.target.value),placeholder:a.type==="pg"?"0 for Common, 1 for Attached":"Number of bathrooms",min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"builtUpArea",children:a.type==="pg"?"Room Area (sq ft)":"Built-up Area (sq ft)"}),e.jsx(d,{id:"builtUpArea",type:"number",value:a.builtUpArea,onChange:r=>o("builtUpArea",r.target.value),placeholder:a.type==="pg"?"Room area":"Built-up area"})]})]}),a.type!=="pg"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"carpetArea",children:"Carpet Area (sq ft)"}),e.jsx(d,{id:"carpetArea",type:"number",value:a.carpetArea,onChange:r=>o("carpetArea",r.target.value),placeholder:"Carpet area"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"plotArea",children:"Plot Area (sq ft)"}),e.jsx(d,{id:"plotArea",type:"number",value:a.plotArea,onChange:r=>o("plotArea",r.target.value),placeholder:"Plot area (for villa/house)"})]})]})]}),["commercial","office"].includes(a.type)&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"builtUpArea",children:"Built-up Area (sq ft) *"}),e.jsx(d,{id:"builtUpArea",type:"number",value:a.builtUpArea,onChange:r=>o("builtUpArea",r.target.value),placeholder:"Total built-up area"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"carpetArea",children:"Carpet Area (sq ft)"}),e.jsx(d,{id:"carpetArea",type:"number",value:a.carpetArea,onChange:r=>o("carpetArea",r.target.value),placeholder:"Usable carpet area"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"bathrooms",children:"Washrooms"}),e.jsx(d,{id:"bathrooms",type:"number",value:a.bathrooms,onChange:r=>o("bathrooms",r.target.value),placeholder:"Number of washrooms",min:"0"})]})]})}),["plot","land"].includes(a.type)&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"plotArea",children:"Plot Area (sq ft) *"}),e.jsx(d,{id:"plotArea",type:"number",value:a.plotArea,onChange:r=>o("plotArea",r.target.value),placeholder:"Total plot area"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"builtUpArea",children:"Total Area (sq ft) *"}),e.jsx(d,{id:"builtUpArea",type:"number",value:a.builtUpArea,onChange:r=>o("builtUpArea",r.target.value),placeholder:"Same as plot area"})]})]})})]})]}),e.jsxs(g,{children:[e.jsx(j,{children:e.jsx(y,{children:"Location"})}),e.jsxs(v,{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"street",children:"Street Address"}),e.jsx(d,{id:"street",value:a.street,onChange:r=>o("street",r.target.value),placeholder:"Street address"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"city",children:"City *"}),e.jsx(d,{id:"city",value:a.city,onChange:r=>o("city",r.target.value),placeholder:"City",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"state",children:"State *"}),e.jsx(d,{id:"state",value:a.state,onChange:r=>o("state",r.target.value),placeholder:"State",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"pincode",children:"PIN Code *"}),e.jsx(d,{id:"pincode",value:a.pincode,onChange:r=>o("pincode",r.target.value),placeholder:"PIN Code",maxLength:6,pattern:"[0-9]{6}",required:!0})]})]})]})]}),e.jsxs(g,{children:[e.jsx(j,{children:e.jsx(y,{children:"Amenities"})}),e.jsx(v,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:O.map(r=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{id:r,checked:a.amenities.includes(r),onCheckedChange:()=>G(r)}),e.jsx(i,{htmlFor:r,className:"text-sm",children:r})]},r))})})]}),e.jsxs(g,{children:[e.jsx(j,{children:e.jsx(y,{children:"Property Images"})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-8 text-center",children:[e.jsx(de,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{type:"button",variant:"outline",onClick:()=>document.getElementById("image-upload")?.click(),children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Add Images"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload high-quality images of your property"})]}),e.jsx("input",{id:"image-upload",type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:z})]}),C.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:C.map(r=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:r.url,alt:r.name,className:"w-full h-24 object-cover rounded-lg"}),r.isPrimary&&e.jsx("div",{className:"absolute top-1 left-1 bg-primary text-primary-foreground text-xs px-2 py-1 rounded",children:"Primary"}),e.jsxs("div",{className:"absolute top-1 right-1 flex gap-1",children:[!r.isPrimary&&e.jsx(m,{type:"button",size:"icon",variant:"secondary",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>Y(r.id),title:"Set as primary image",children:e.jsx(te,{className:"h-3 w-3"})}),e.jsx(m,{type:"button",size:"icon",variant:"destructive",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>W(r.id),children:e.jsx(q,{className:"h-3 w-3"})})]})]},r.id))})]})]}),e.jsxs(g,{children:[e.jsx(j,{children:e.jsx(y,{children:"Property Videos (Optional)"})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-8 text-center",children:[e.jsx(R,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{type:"button",variant:"outline",onClick:()=>document.getElementById("video-upload")?.click(),children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Upload Video"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"MP4, MOV, AVI (max 100MB)"})]}),e.jsx("input",{id:"video-upload",type:"file",multiple:!0,accept:"video/*",className:"hidden",onChange:_})]}),F.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:F.map(r=>e.jsx("div",{className:"relative border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(R,{className:"w-8 h-8 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:r.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Video file"})]}),e.jsx(m,{type:"button",size:"icon",variant:"destructive",className:"h-6 w-6",onClick:()=>H(r.id),children:e.jsx(q,{className:"h-3 w-3"})})]})},r.id))})]})]}),e.jsxs(g,{children:[e.jsx(j,{children:e.jsx(y,{children:"Virtual Tour (Optional)"})}),e.jsx(v,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"virtualTour",children:"Virtual Tour URL"}),e.jsx(d,{id:"virtualTour",placeholder:"e.g., https://your-virtual-tour-link.com or YouTube link",value:a.virtualTour,onChange:r=>o("virtualTour",r.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Add a virtual tour link, YouTube video, or 360Â° tour to showcase your property"})]})})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>h("/vendor/properties"),children:"Cancel"}),e.jsx(m,{type:"submit",disabled:A,children:A?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]})]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Property Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The property you're trying to edit doesn't exist."}),e.jsxs(m,{onClick:()=>h("/vendor/properties"),children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Back to Properties"]})]})};export{Fe as default};

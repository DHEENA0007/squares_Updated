import{j as e}from"./ui-CEFKCYQo.js";import{r as s}from"./router-Bi51YGN-.js";import{t as a,aq as t,f as l,ad as r,a as i,e as n,Q as c,I as d,S as o,r as x,s as m,v as h,w as p,B as j,af as u,ag as g,ah as f,J as v,h as N,aH as w}from"./index-Ds-LUfCl.js";import{T as y}from"./trending-up-BpoKmfKs.js";import"./vendor-eVk5PToZ.js";const b=()=>{const[b,S]=s.useState(!0),[R,C]=s.useState(!1),[A,T]=s.useState([]),[$,k]=s.useState(null),[P,D]=s.useState(""),[F,B]=s.useState("all"),[L,I]=s.useState("all"),[z,E]=s.useState("newest"),H="http://localhost:3001/api",U=s.useCallback(async()=>{try{S(!0);const e=localStorage.getItem("token"),s=new URLSearchParams;"all"!==F&&s.append("rating",F),"all"!==L&&s.append("reviewType",L),P&&s.append("search",P),s.append("sortBy","newest"===z||"oldest"===z?"createdAt":"rating"),s.append("sortOrder","oldest"===z||"rating-low"===z?"asc":"desc");const t=await fetch(`${H}/vendors/reviews?${s.toString()}`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),l=await t.json();l.success?T(l.data.reviews||[]):a({title:"Error",description:l.message||"Failed to load reviews",variant:"destructive"})}catch(e){a({title:"Error",description:"Failed to load reviews. Please try again.",variant:"destructive"})}finally{S(!1)}},[H,F,L,P,z]),V=s.useCallback(async()=>{try{const e=localStorage.getItem("token"),s=await fetch(`${H}/vendors/reviews/stats`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),a=await s.json();a.success&&k(a.data)}catch(e){}},[H]),O=s.useCallback(async()=>{C(!0),await Promise.all([U(),V()]),C(!1)},[U,V]);s.useEffect(()=>{U(),V()},[U,V]);const q=e=>{if(!e)return"N/A";const s=new Date(e);return isNaN(s.getTime())?"N/A":s.toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"})},G=e=>{if(!e||0===e.length)return"/placeholder-property.jpg";const s=e.find(e=>e.isPrimary);return s?.url||e[0]?.url||"/placeholder-property.jpg"},J=A;return e.jsxs("div",{className:"space-y-6 pt-16",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(t,{className:"w-8 h-8 text-primary fill-primary"}),"Reviews & Ratings"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage customer feedback and maintain your reputation"})]}),e.jsxs(l,{variant:"outline",onClick:O,disabled:R,children:[e.jsx(r,{className:"w-4 h-4 mr-2 "+(R?"animate-spin":"")}),R?"Refreshing...":"Refresh"]})]}),$&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:$.totalReviews}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Reviews"})]})})}),e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(t,{className:"w-5 h-5 text-yellow-400 fill-yellow-400"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:$.averageRating.toFixed(1)})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Average Rating"})]})})}),e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:$.ratingDistribution[5]+$.ratingDistribution[4]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Positive Reviews"})]})})}),e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:A.filter(e=>e.isPublic).length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Public Reviews"})]})})})]}),$&&$.totalReviews>0&&e.jsx(i,{children:e.jsxs(n,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5"}),"Rating Distribution"]}),e.jsx("div",{className:"space-y-3",children:[5,4,3,2,1].map(s=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1 w-16",children:[e.jsx("span",{className:"text-sm font-medium",children:s}),e.jsx(t,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"})]}),e.jsx("div",{className:"flex-1 bg-muted rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"bg-yellow-400 h-full transition-all",style:{width:($.totalReviews>0?$.ratingDistribution[s]/$.totalReviews*100:0)+"%"}})}),e.jsx("span",{className:"text-sm text-muted-foreground w-12 text-right",children:$.ratingDistribution[s]})]},s))})]})}),e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(d,{type:"text",placeholder:"Search reviews...",className:"pl-10",value:P,onChange:e=>D(e.target.value)})]}),e.jsxs(o,{value:F,onValueChange:B,children:[e.jsx(x,{className:"w-full sm:w-40",children:e.jsx(m,{placeholder:"Rating"})}),e.jsxs(h,{children:[e.jsx(p,{value:"all",children:"All Ratings"}),e.jsx(p,{value:"5",children:"5 Stars"}),e.jsx(p,{value:"4",children:"4 Stars"}),e.jsx(p,{value:"3",children:"3 Stars"}),e.jsx(p,{value:"2",children:"2 Stars"}),e.jsx(p,{value:"1",children:"1 Star"})]})]}),e.jsxs(o,{value:L,onValueChange:I,children:[e.jsx(x,{className:"w-full sm:w-40",children:e.jsx(m,{placeholder:"Type"})}),e.jsxs(h,{children:[e.jsx(p,{value:"all",children:"All Types"}),e.jsx(p,{value:"property",children:"Property"}),e.jsx(p,{value:"service",children:"Service"}),e.jsx(p,{value:"general",children:"General"})]})]}),e.jsxs(o,{value:z,onValueChange:E,children:[e.jsx(x,{className:"w-full sm:w-40",children:e.jsx(m,{placeholder:"Sort By"})}),e.jsxs(h,{children:[e.jsx(p,{value:"newest",children:"Newest First"}),e.jsx(p,{value:"oldest",children:"Oldest First"}),e.jsx(p,{value:"rating-high",children:"Rating: High to Low"}),e.jsx(p,{value:"rating-low",children:"Rating: Low to High"})]})]})]})})}),!b&&J.length>0&&e.jsx("div",{className:"space-y-4",children:J.map(s=>{return e.jsx(i,{className:"overflow-hidden",children:e.jsx(n,{className:"p-0",children:e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[s.property&&e.jsxs("div",{className:"lg:w-48 h-48 lg:h-auto bg-muted relative",children:[e.jsx("img",{src:G(s.property.images),alt:s.property.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute top-3 left-3 flex gap-2",children:e.jsx(j,{className:"sold"===s.property.status?"bg-purple-600 text-white":"rented"===s.property.status?"bg-blue-600 text-white":"bg-green-600 text-white",children:s.property.status})})]}),e.jsxs("div",{className:"flex-1 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(u,{className:"w-10 h-10",children:[e.jsx(g,{src:s.client?.avatar}),e.jsx(f,{children:s.client?(a=s.client.name,a.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2)):"U"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.client?.name||"Anonymous"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:q(s.createdAt)})]})]}),e.jsx(j,{variant:"secondary",className:"capitalize",children:s.reviewType})]}),s.property&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(v,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:s.property.title})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground mt-1",children:[e.jsx(N,{className:"w-4 h-4"}),s.property.address.district?`${s.property.address.city}, ${s.property.address.district}, ${s.property.address.state}`:`${s.property.address.city}, ${s.property.address.state}`]})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(a=>e.jsx(t,{className:"w-5 h-5 "+(a<=s.rating?"fill-yellow-400 text-yellow-400":"text-gray-300")},a))}),e.jsxs("span",{className:"font-semibold text-lg",children:[s.rating,".0"]})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold mb-1",children:s.title}),e.jsx("p",{className:"text-muted-foreground",children:s.comment})]})]})]})})},s._id);var a})}),b&&e.jsx(i,{children:e.jsx(n,{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Loading reviews..."})]})})}),!b&&0===J.length&&e.jsx(i,{children:e.jsxs(n,{className:"p-12 text-center",children:[e.jsx(t,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:0===A.length?"No reviews yet":"No reviews match your filters"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:0===A.length?"Reviews from customers will appear here once they submit feedback on your properties.":"Try adjusting your search criteria or clear some filters."}),A.length>0&&e.jsxs(l,{variant:"outline",onClick:()=>{D(""),B("all"),I("all"),E("newest")},children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Clear Filters"]})]})})]})};export{b as default};

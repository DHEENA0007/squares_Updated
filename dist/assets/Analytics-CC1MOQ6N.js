import{j as e}from"./ui-s1SEoZIF.js";import{r as s,d as a}from"./router-D8v2YSKU.js";import{a2 as t,a as r,b as i,c as l,e as c,d as n,E as d,x as o,h as x,I as m,q as h,r as j,s as u,v as p,w as v,f as g,aa as N,ab as f,y as w,M as y,B as b,k as S,u as A,U as C,R as V,af as D,ag as P,ah as k,ai as T,V as I,Z as L}from"./index-xsqbJ4m0.js";import{a as R}from"./analyticsService-DkEdQI_d.js";import{T as M,a as E,b as U,c as F,d as _,e as q}from"./table-B_mPL_j-.js";import{M as B,C as O}from"./mouse-pointer-CiPYvCEL.js";import{C as Y}from"./calendar-Bl36fNYg.js";import{f as $}from"./format-CgGqNHlq.js";import{T as G}from"./trending-up-pGp2EKGV.js";import{D as W}from"./dollar-sign-DuulR4Y_.js";import{R as z,B as H,X as K,Y as J,E as X,F as Z,I as Q}from"./generateCategoricalChart-Bpovzh7W.js";import{L as ee}from"./LineChart-CkFgS6HS.js";import{G as se}from"./globe-LWXbKABs.js";import"./vendor-BxThA0WO.js";import"./reviewsService-ChCklHGM.js";const ae=({propertyId:a,dateRange:A})=>{const{toast:C}=t(),[V,D]=s.useState(!0),[P,k]=s.useState(null),[T,I]=s.useState(new Set),[L,O]=s.useState(""),[G,W]=s.useState("all");s.useEffect(()=>{a&&z()},[a,A]);const z=async()=>{if(a){D(!0);try{const e=await R.getPropertyViewDetails(a,A);k(e.data)}catch(e){C({title:"Error",description:"Failed to fetch property view details",variant:"destructive"})}finally{D(!1)}}},H=P?.views?.filter(e=>{const s=""===L||e.viewer?.email?.toLowerCase().includes(L.toLowerCase())||e.viewer?.profile?.firstName?.toLowerCase().includes(L.toLowerCase())||e.viewer?.profile?.lastName?.toLowerCase().includes(L.toLowerCase()),a="all"===G||"registered"===G&&e.viewer||"guest"===G&&!e.viewer||"interacted"===G&&(e.interactions?.clickedPhone||e.interactions?.clickedMessage);return s&&a})||[];return V?e.jsxs(r,{children:[e.jsx(i,{children:e.jsx(l,{children:"Loading..."})}),e.jsx(c,{children:e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-16 bg-gray-200 rounded"},s))})})]}):a&&P?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(r,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(d,{className:"h-8 w-8 mx-auto mb-2 text-blue-600"}),e.jsx("p",{className:"text-2xl font-bold",children:P.aggregateData?.totalViews?.[0]?.count||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Views"})]})})}),e.jsx(r,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(o,{className:"h-8 w-8 mx-auto mb-2 text-green-600"}),e.jsx("p",{className:"text-2xl font-bold",children:P.aggregateData?.uniqueViewers?.[0]?.count||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Unique Visitors"})]})})}),e.jsx(r,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(x,{className:"h-8 w-8 mx-auto mb-2 text-purple-600"}),e.jsxs("p",{className:"text-2xl font-bold",children:[Math.round(P.aggregateData?.avgDuration?.[0]?.avg||0),"s"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg. Duration"})]})})}),e.jsx(r,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(B,{className:"h-8 w-8 mx-auto mb-2 text-orange-600"}),e.jsx("p",{className:"text-2xl font-bold",children:(P.aggregateData?.interactions?.[0]?.phoneClicks||0)+(P.aggregateData?.interactions?.[0]?.messageClicks||0)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Interactions"})]})})})]}),e.jsxs(r,{children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Visitor Details"}),e.jsx(n,{children:"Complete list of customers who viewed this property"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{placeholder:"Search visitors...",value:L,onChange:e=>O(e.target.value),className:"w-64"}),e.jsxs(h,{value:G,onValueChange:W,children:[e.jsx(j,{className:"w-40",children:e.jsx(u,{})}),e.jsxs(p,{children:[e.jsx(v,{value:"all",children:"All Visitors"}),e.jsx(v,{value:"registered",children:"Registered"}),e.jsx(v,{value:"guest",children:"Guests"}),e.jsx(v,{value:"interacted",children:"Interacted"})]})]})]})]})}),e.jsxs(c,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(M,{children:[e.jsx(E,{children:e.jsxs(U,{children:[e.jsx(F,{className:"w-12"}),e.jsx(F,{children:"Visitor"}),e.jsx(F,{children:"Contact"}),e.jsx(F,{children:"View Time"}),e.jsx(F,{children:"Duration"}),e.jsx(F,{children:"Interactions"}),e.jsx(F,{children:"Status"})]})}),e.jsx(_,{children:0===H.length?e.jsx(U,{children:e.jsx(q,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No visitors found"})}):H.map(s=>e.jsxs(e.Fragment,{children:[e.jsxs(U,{className:"cursor-pointer hover:bg-muted/50",children:[e.jsx(q,{children:e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>(e=>{const s=new Set(T);s.has(e)?s.delete(e):s.add(e),I(s)})(s._id),children:T.has(s._id)?e.jsx(N,{className:"h-4 w-4"}):e.jsx(f,{className:"h-4 w-4"})})}),e.jsx(q,{children:e.jsx("div",{className:"flex items-center gap-2",children:s.viewer?e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"h-4 w-4 text-green-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.viewer.profile?.firstName," ",s.viewer.profile?.lastName]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.viewer.email})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:"Guest Visitor"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.ipAddress||"Unknown IP"})]})]})})}),e.jsx(q,{children:s.viewer?e.jsxs("div",{className:"space-y-1",children:[s.viewer.profile?.phone&&e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(w,{className:"h-3 w-3"}),s.viewer.profile.phone]}),s.viewer.email&&e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(y,{className:"h-3 w-3"}),s.viewer.email]})]}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"N/A"})}),e.jsx(q,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Y,{className:"h-3 w-3"}),$(new Date(s.viewedAt),"MMM dd, yyyy HH:mm")]})}),e.jsx(q,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(x,{className:"h-3 w-3"}),s.viewDuration>0?`${s.viewDuration}s`:"N/A"]})}),e.jsx(q,{children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.interactions?.clickedPhone&&e.jsxs(b,{variant:"outline",className:"text-xs",children:[e.jsx(w,{className:"h-3 w-3 mr-1"})," Phone"]}),s.interactions?.clickedMessage&&e.jsxs(b,{variant:"outline",className:"text-xs",children:[e.jsx(y,{className:"h-3 w-3 mr-1"})," Message"]}),s.interactions?.sharedProperty&&e.jsx(b,{variant:"outline",className:"text-xs",children:"Shared"})]})}),e.jsx(q,{children:s.viewer?e.jsx(b,{variant:"default",className:"bg-green-600",children:"Registered"}):e.jsx(b,{variant:"secondary",children:"Guest"})})]},s._id),T.has(s._id)&&e.jsx(U,{children:e.jsx(q,{colSpan:7,className:"bg-muted/30",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.viewer&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"User Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Role:"})," ",s.viewer.role]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",s.viewer.status]}),s.viewer.profile?.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"h-3 w-3"}),e.jsx("span",{children:s.viewer.profile.location})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Session Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"IP Address:"})," ",s.ipAddress||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"User Agent:"})," ",s.userAgent?.substring(0,50)||"N/A","..."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Referrer:"})," ",s.referrer||"Direct"]})]})]})]}),Object.values(s.interactions||{}).some(e=>e)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Actions Taken"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.interactions?.clickedPhone&&e.jsx(b,{variant:"default",children:"Clicked Phone Number"}),s.interactions?.clickedMessage&&e.jsx(b,{variant:"default",children:"Sent Message"}),s.interactions?.sharedProperty&&e.jsx(b,{variant:"default",children:"Shared Property"})]})]})]})})})]}))})]})}),H.length>0&&e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground text-center",children:["Showing ",H.length," of ",P.views?.length||0," visitors"]})]})]})]}):e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsx(l,{children:"Property View Details"}),e.jsx(n,{children:"Select a property to view detailed visitor information"})]}),e.jsx(c,{children:e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(d,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No property selected"})]})})]})},te=()=>{const{user:o}=A(),{toast:x}=t(),m=a(),[g,N]=s.useState("30"),[f,w]=s.useState(!0),[y,b]=s.useState(null),[S,M]=s.useState(null),[E,U]=s.useState(null),[F,_]=s.useState(null),[q,B]=s.useState(null),[Y,$]=s.useState(""),te=e=>"superadmin"===o?.role||(o?.rolePermissions?.includes(e)||!1);s.useEffect(()=>{if(!te(L.ANALYTICS_VIEW))return x({title:"Access Denied",description:"You don't have permission to view analytics.",variant:"destructive"}),void m("/rolebased");re()},[g]);const re=async()=>{w(!0);try{const[e,s,a,t,r]=await Promise.all([R.getOverview(g),R.getPropertyViews(g),R.getUserConversion(g),R.getTrafficAnalytics(g),R.getEngagementAnalytics(g)]);b(e.data),M(s.data),U(a.data),_(t.data),B(r.data)}catch(e){x({title:"Error",description:"Failed to fetch analytics data",variant:"destructive"})}finally{w(!1)}};if(!te(L.ANALYTICS_VIEW))return null;if(f)return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-3xl font-bold",children:"Analytics Dashboard"})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(s=>e.jsxs(r,{className:"animate-pulse",children:[e.jsx(i,{className:"pb-2",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})}),e.jsx(c,{children:e.jsx("div",{className:"h-8 bg-gray-200 rounded w-16"})})]},s))})]});const ie=({title:s,value:a,icon:t,change:n,color:d})=>e.jsxs(r,{children:[e.jsx(i,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{className:"text-sm font-medium text-muted-foreground",children:s}),e.jsx(t,{className:`h-4 w-4 ${d}`})]})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a}),n&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.jsxs("span",{className:n>=0?"text-green-600":"text-red-600",children:[n>=0?"+":"",n,"%"]})," from previous period"]})]})]});return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Comprehensive insights and metrics"})]}),e.jsxs(h,{value:g,onValueChange:N,children:[e.jsx(j,{className:"w-[180px]",children:e.jsx(u,{placeholder:"Select range"})}),e.jsxs(p,{children:[e.jsx(v,{value:"7",children:"Last 7 days"}),e.jsx(v,{value:"30",children:"Last 30 days"}),e.jsx(v,{value:"90",children:"Last 90 days"}),e.jsx(v,{value:"365",children:"Last year"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(ie,{title:"Total Users",value:y?.overview?.totalUsers||0,icon:C,color:"text-blue-600"}),e.jsx(ie,{title:"Total Properties",value:y?.overview?.totalProperties||0,icon:d,color:"text-green-600"}),e.jsx(ie,{title:"Total Views",value:y?.overview?.totalViews||0,icon:V,color:"text-purple-600"}),e.jsx(ie,{title:"New Registrations",value:y?.overview?.totalRegistrations||0,icon:G,color:"text-orange-600"}),e.jsx(ie,{title:"Revenue",value:`$${(y?.overview?.totalRevenue||0).toFixed(2)}`,icon:W,color:"text-emerald-600"})]}),e.jsxs(D,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(P,{className:"grid w-full grid-cols-5",children:[e.jsx(k,{value:"overview",children:"Overview"}),e.jsx(k,{value:"properties",children:"Properties"}),e.jsx(k,{value:"users",children:"Users"}),e.jsx(k,{value:"traffic",children:"Traffic"}),e.jsx(k,{value:"engagement",children:"Engagement"})]}),e.jsx(T,{value:"overview",className:"space-y-4",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(I,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"Analytics Dashboard - Full Implementation"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Comprehensive analytics for property views, user behavior, traffic sources, and engagement metrics"})]})}),e.jsx(T,{value:"properties",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs(r,{children:[e.jsx(i,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),"Property Views Over Time"]})}),e.jsx(c,{children:e.jsx(z,{width:"100%",height:300,children:e.jsxs(ee,{data:S?.viewsByDate||[],children:[e.jsx(H,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"_id"}),e.jsx(J,{}),e.jsx(X,{}),e.jsx(Z,{}),e.jsx(Q,{type:"monotone",dataKey:"views",stroke:"#8884d8",strokeWidth:2})]})})})]}),e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(d,{className:"h-5 w-5"}),"Top Viewed Properties"]}),e.jsx(n,{children:"Click on a property to see detailed visitor information"})]}),e.jsx(c,{children:e.jsx("div",{className:"space-y-3",children:(S?.viewsByProperty||[]).slice(0,10).map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg cursor-pointer hover:bg-muted transition-colors",onClick:()=>$(s.propertyId),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-primary text-primary-foreground font-bold",children:a+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.propertyTitle}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.uniqueViewers," unique viewers"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold",children:s.totalViews}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"views"})]})]},s.propertyId))})})]}),Y&&e.jsx(ae,{propertyId:Y,dateRange:g})]})}),e.jsx(T,{value:"users",className:"space-y-4",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(C,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"User Analytics"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Monitor user registrations, conversions, and engagement patterns"})]})}),e.jsx(T,{value:"traffic",className:"space-y-4",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(se,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"Traffic Analytics"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Analyze traffic sources, devices, locations, and peak usage hours"})]})}),e.jsx(T,{value:"engagement",className:"space-y-4",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(V,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"Engagement Analytics"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Track active users, messages, reviews, and top contributors"})]})})]})]})};export{te as default};

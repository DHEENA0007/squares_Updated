import{j as e}from"./ui-DHQhougw.js";import{e as s,d as a,r as l}from"./router-Bi51YGN-.js";import{r as i,R as t,u as n,s as r,f as c,A as d,a as o,b as m,c as x,d as h,e as u,L as p,I as j,T as g,a4 as f,a5 as v,a6 as N,ap as b,ak as y,B as S}from"./index-B494FSRu.js";import{C as k}from"./checkbox-D9PsUFMn.js";import{r as w}from"./roleService-jo1XJdLv.js";import"./vendor-eVk5PToZ.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=i("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),R=()=>{const{id:i}=s(),R=a(),{toast:A}=t(),{isSuperAdmin:F}=n(),[L,z]=l.useState(null),[E,I]=l.useState(!0),[q,D]=l.useState(!1);l.useEffect(()=>{(async()=>{if(i)try{I(!0);const e=(await w.getRole(i)).data.role;z({...e,pages:e.pages||[]})}catch(e){A({title:"Error",description:"Failed to load role data.",variant:"destructive"}),R("/admin/roles")}finally{I(!1)}})()},[i,R,A]);const P=({pages:s})=>{if(!L)return null;const a=L.pages||[];return e.jsx("div",{className:"space-y-2",children:s.map(s=>e.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg hover:bg-accent/50 transition-colors",children:[e.jsx(k,{id:s.id,checked:a.includes(s.id),onCheckedChange:()=>(e=>{if(!L)return;if(L.isSystemRole&&!F)return;const s=L.pages||[],a=s.includes(e)?s.filter(s=>s!==e):[...s,e];z({...L,pages:a})})(s.id),disabled:L.isSystemRole&&!F}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs(p,{htmlFor:s.id,className:"flex items-center gap-2 cursor-pointer font-medium",children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label,s.subLabel&&e.jsx(S,{variant:"outline",className:"text-xs",children:s.subLabel})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),e.jsx("p",{className:"text-xs text-muted-foreground font-mono",children:s.path})]})]},s.id))})};return E?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(r,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading role..."})]}):L?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>R("/admin/roles"),children:e.jsx(d,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold",children:["Edit Role: ",L.name]}),e.jsx("p",{className:"text-muted-foreground",children:"Update role details and page access"})]})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),L&&i)if(L.pages&&0!==L.pages.length)try{D(!0),await w.updateRole(i,{name:L.name,description:L.description,pages:L.pages,isActive:L.isActive,level:L.level}),R("/admin/roles")}catch(s){}finally{D(!1)}else A({title:"Validation Error",description:"Please select at least one page",variant:"destructive"})},className:"space-y-6",children:[e.jsxs(o,{children:[e.jsxs(m,{children:[e.jsx(x,{children:"Basic Information"}),e.jsx(h,{children:"Core details about this role"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:"name",children:["Role Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(j,{id:"name",value:L.name,onChange:e=>z({...L,name:e.target.value}),disabled:L.isSystemRole&&!F,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"level",children:"Access Level (1-10)"}),e.jsx(j,{id:"level",type:"number",min:"1",max:"10",value:L.level,onChange:e=>z({...L,level:parseInt(e.target.value)||1}),disabled:L.isSystemRole&&!F})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"description",children:"Description"}),e.jsx(g,{id:"description",value:L.description,onChange:e=>z({...L,description:e.target.value}),rows:3})]})]})]}),e.jsxs(o,{children:[e.jsxs(m,{children:[e.jsx(x,{children:"Page Access"}),e.jsx(h,{children:"Select which pages this role can access"})]}),e.jsxs(u,{children:[e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg flex gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-900 dark:text-blue-100",children:[e.jsxs("p",{className:"font-medium mb-1",children:["Selected: ",L.pages?.length||0," pages"]}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300",children:"Choose pages from different portal categories. Users with this role will only see and access the selected pages."})]})]}),e.jsxs(f,{defaultValue:"admin",className:"w-full",children:[e.jsxs(v,{className:"grid w-full grid-cols-4",children:[e.jsx(N,{value:"admin",children:"Super Admin"}),e.jsx(N,{value:"subadmin",children:"Sub Admin"}),e.jsx(N,{value:"vendor",children:"Vendor"}),e.jsx(N,{value:"customer",children:"Customer"})]}),["admin","subadmin","vendor","customer"].map(s=>{const a=b(s),l=L.pages||[],i=a.filter(e=>l.includes(e.id)).length;return e.jsxs(y,{value:s,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-accent/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium capitalize",children:[s," Pages"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[i," of ",a.length," selected"]})]}),e.jsx(c,{type:"button",variant:"outline",size:"sm",onClick:()=>(e=>{if(!L)return;if(L.isSystemRole&&!F)return;const s=b(e),a=L.pages||[];if(s.every(e=>a.includes(e.id)))z({...L,pages:a.filter(e=>!s.some(s=>s.id===e))});else{const e=s.map(e=>e.id);z({...L,pages:[...new Set([...a,...e])]})}})(s),disabled:L.isSystemRole&&!F,children:i===a.length?"Deselect All":"Select All"})]}),e.jsx(P,{pages:a})]},s)})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(c,{type:"submit",disabled:q,children:q?"Saving...":"Save Changes"}),e.jsx(c,{type:"button",variant:"outline",onClick:()=>R("/admin/roles"),disabled:q,children:"Cancel"})]})]})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>R("/admin/roles"),children:e.jsx(d,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Role Not Found"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"The requested role could not be found."})]})]})})};export{R as default};

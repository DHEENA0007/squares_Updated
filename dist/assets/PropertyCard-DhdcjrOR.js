import{j as e}from"./ui-BNZSgpjP.js";import{r as s,d as t}from"./router-D8v2YSKU.js";import{G as a,aj as r,q as i,r as l,s as n,v as o,w as c,f as d,a3 as p,l as m,$ as u,I as x,u as h,aL as f,a as g,bN as y,a1 as j,e as v,B as b,k as N,bP as w,bQ as _,bT as C,am as T,y as S}from"./index-CbYcfsaZ.js";import{a as F}from"./propertyUtils-41DuwCMc.js";import{P,a as L}from"./PropertyContactDialog-iDDunTk_.js";import{E as k}from"./EnterprisePropertyContactDialog-ClO7gEJN.js";import{vendorService as E}from"./vendorService-CE9s25SL.js";import{f as $}from"./favoriteService-4VCo7auW.js";import{S as A}from"./square-Bu_vBmzr.js";import{T as V}from"./thumbs-up-D1cc77Ao.js";const z=({value:t,onChange:r})=>{const[i,l]=s.useState(t||""),[n,o]=s.useState([]),[c,d]=s.useState(!1),[p,h]=s.useState(!1),[f,g]=s.useState(m.isReady()),y=s.useRef(null);s.useEffect(()=>{m.initialize().then(()=>g(!0))},[]),s.useEffect(()=>{void 0!==t&&l(t)},[t]),s.useEffect(()=>{const e=e=>{y.current&&!y.current.contains(e.target)&&d(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);return e.jsxs("div",{ref:y,className:"relative w-[200px]",children:[e.jsxs("div",{className:"relative",children:[e.jsx(u,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(x,{placeholder:f?"Search Location...":"Loading...",value:i,onChange:e=>{const s=e.target.value;if(l(s),s.length<2)return o([]),void d(!1);h(!0),setTimeout(()=>{const e=m.searchLocations(s);o(e),h(!1),d(!0)},100)},className:"pl-8 bg-background",disabled:!f,onFocus:()=>{i.length>=2&&d(!0)},onKeyDown:e=>{"Enter"===e.key&&(r(i),d(!1))}}),p&&e.jsx("div",{className:"absolute right-2 top-2.5",children:e.jsx(a,{className:"h-4 w-4 animate-spin text-muted-foreground"})})]}),c&&e.jsx("div",{className:"absolute z-[100] w-full mt-1 bg-popover border rounded-md shadow-md max-h-[200px] overflow-y-auto",children:n.length>0?n.map((s,t)=>e.jsxs("div",{className:"px-3 py-2 text-sm cursor-pointer hover:bg-accent hover:text-accent-foreground border-b last:border-0",onClick:()=>(e=>{l(e.city),r(e.city),d(!1)})(s),children:[e.jsx("div",{className:"font-medium",children:s.city}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.district,", ",s.state]})]},`${s.pincode}-${t}`)):e.jsx("div",{className:"px-3 py-2 text-sm text-muted-foreground text-center",children:"No locations found"})})]})},D=({onFilterChange:t,initialFilters:m})=>{const[u,x]=s.useState({}),[h,f]=s.useState([]),[g,y]=s.useState([]),[j,v]=s.useState([]),[b,N]=s.useState(!0);s.useEffect(()=>{(async()=>{try{N(!0);const[e,s,t]=await Promise.all([p.getAllPropertyTypes(!1),p.getAllFilterConfigurations(!1),p.getFilterDependencies()]);f(e),y(s),v(t)}catch(e){}finally{N(!1)}})()},[]),s.useEffect(()=>{m&&x(m)},[m]);const w=(e,s)=>{let a={...u,[e]:"all"===s||"any"===s||"any-budget"===s?void 0:s};if("budget"===e){if("any-budget"===s)a.minPrice=void 0,a.maxPrice=void 0;else{const e=g.find(e=>(e.id||e._id)===s);e&&(a.minPrice=e.minValue,a.maxPrice=e.maxValue)}delete a.budget}const r=(e,s)=>{const t=j.find(s=>s.targetFilterType===e);if(!t)return!0;let a;return a="property_type"===t.sourceFilterType?s.propertyType:s[t.sourceFilterType],!(!a||"all"===a||"any"===a||"any-budget"===a)&&t.sourceFilterValues.includes(a)},i=_();for(const t of i)t===e||"property_type"===t&&"propertyType"===e||void 0===a[t]||r(t,a)||(a[t]=void 0,"budget"===t&&(a.minPrice=void 0,a.maxPrice=void 0));x(a),t(a)},_=()=>{const e=new Set(g.map(e=>e.filterType));return Array.from(e).sort()},C=e=>g.filter(s=>s.filterType===e).sort((e,s)=>e.displayOrder-s.displayOrder),T=e=>{const s=j.find(s=>s.targetFilterType===e);if(!s)return!0;let t;return t="property_type"===s.sourceFilterType?u.propertyType:u[s.sourceFilterType],!(!t||"all"===t||"any"===t||"any-budget"===t)&&s.sourceFilterValues.includes(t)};if(b)return e.jsx("div",{className:"bg-card border border-border rounded-xl p-4 shadow-[var(--shadow-soft)]",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 py-2",children:[e.jsx(a,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{className:"text-muted-foreground",children:"Loading filters..."})]})});const S=_();return e.jsx("div",{className:"bg-card border border-border rounded-xl p-4 shadow-[var(--shadow-soft)]",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(r,{className:"h-5 w-5"}),e.jsx("span",{children:"Filters:"})]}),e.jsx(z,{value:u.location,onChange:e=>w("location",e)}),C("listing_type").length>0&&T("listing_type")&&e.jsxs(i,{value:u.listingType||"all",onValueChange:e=>w("listingType",e),children:[e.jsx(l,{className:"w-[150px]",children:e.jsx(n,{placeholder:"Listing Type"})}),e.jsxs(o,{children:[e.jsx(c,{value:"all",children:"All Types"}),C("listing_type").map(s=>e.jsx(c,{value:s.value,children:s.displayLabel||s.name},s.id||s._id))]})]}),h.length>0&&T("property_type")&&e.jsxs(i,{value:u.propertyType&&(h.find(e=>e.value.toLowerCase()===u.propertyType?.toLowerCase())?.id||h.find(e=>e.value.toLowerCase()===u.propertyType?.toLowerCase())?._id)||"all",onValueChange:e=>{if("all"===e)w("propertyType","all");else{const s=h.find(s=>(s.id||s._id)===e);s&&w("propertyType",s.value)}},children:[e.jsx(l,{className:"w-[180px]",children:e.jsx(n,{placeholder:"Property Type"})}),e.jsxs(o,{children:[e.jsx(c,{value:"all",children:"All Properties"}),h.map(s=>e.jsx(c,{value:s.id||s._id,children:s.name},s.id||s._id))]})]}),S.filter(e=>"listing_type"!==e&&"property_type"!==e&&"location"!==e).filter(e=>T(e)).map(s=>{const t=C(s);if(0===t.length)return null;const a=s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),r=u[s]||("budget"===s?"any-budget":"any");return e.jsxs(i,{value:r,onValueChange:e=>w(s,e),children:[e.jsx(l,{className:"w-[150px]",children:e.jsx(n,{placeholder:a})}),e.jsxs(o,{children:[e.jsxs(c,{value:"budget"===s?"any-budget":"any",children:["Any ",a]}),t.map(t=>e.jsx(c,{value:"budget"===s?t.id||t._id:t.value,children:t.displayLabel||t.name},t.id||t._id))]})]},s)}),e.jsx(d,{variant:"secondary",className:"ml-auto",onClick:()=>{x({}),t({})},children:"Reset Filters"})]})})},I=({property:a})=>{const r=t(),{isAuthenticated:i,user:l,isVendor:n,isCustomer:o}=h(),[c,m]=s.useState(!1),[u,x]=s.useState(!1),[z,D]=s.useState(!1),[I,O]=s.useState(!1),[R,U]=s.useState(null),[B,M]=s.useState(!0),[W,q]=s.useState(!1),[K,Q]=s.useState(!1),[G,H]=s.useState([]),J=f.getPrimaryImage(a),X=f.formatPrice(a.price,a.listingType),Y=f.formatArea(a.area),Z=a.address.district?`${a.address.city}, ${a.address.district}, ${a.address.state}`:`${a.address.city}, ${a.address.state}`;s.useEffect(()=>{(async()=>{try{const e=await p.getAllFilterConfigurations();H(e)}catch(e){}})()},[]),s.useEffect(()=>{(async()=>{if(a.vendor?._id||a.owner?._id)try{M(!0);const e=a.vendor?._id||a.owner?._id,s=await E.checkVendorWhatsAppSupport(e);O(s.whatsappEnabled),U(s.whatsappNumber)}catch(e){O(!1),U(null)}finally{M(!1)}else M(!1)})()},[a.vendor?._id,a.owner?._id]),s.useEffect(()=>{(async()=>{if(i&&o)try{const e=await $.isFavorite(a._id);q(e)}catch(e){}})()},[i,o,a._id]);const ee=e=>{const s=G.find(s=>s.value===e&&("listing_type"===s.filterType||"listingType"===s.filterType));return s?s.displayLabel||s.name:e.charAt(0).toUpperCase()+e.slice(1)};return e.jsxs(g,{className:"group overflow-hidden hover:shadow-[var(--shadow-large)] transition-all duration-300 flex flex-col h-full",children:[e.jsxs("div",{className:"relative h-44 md:h-48 overflow-hidden",children:[e.jsx("img",{src:J,alt:a.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",onError:e=>{e.target.src=y}}),i&&o&&e.jsx(d,{size:"icon",variant:"ghost",className:"absolute top-3 right-3 bg-background/80 backdrop-blur hover:bg-background "+(W?"text-red-500":""),onClick:async e=>{if(e.stopPropagation(),i){if(!K)try{Q(!0),W?(await $.removeFromFavorites(a._id),q(!1)):(await $.addToFavorites(a._id),q(!0))}catch(s){}finally{Q(!1)}}else r("/login",{state:{from:`/property/${a._id}`,action:"favorite"}})},disabled:K,children:e.jsx(j,{className:"h-5 w-5 "+(W?"fill-current":"")})})]}),e.jsxs(v,{className:"p-3 flex-1",children:[e.jsxs("div",{className:"flex flex-col gap-2 mb-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(b,{className:("available"===a.status?"bg-green-500":"sold"===a.status?"bg-red-500":"rented"===a.status?"bg-blue-500":"bg-yellow-500")+" text-white border-0",children:a.status.charAt(0).toUpperCase()+a.status.slice(1)}),e.jsx(b,{className:"bg-blue-50 text-blue-700 border-blue-100 capitalize",children:ee(a.listingType).toLowerCase().startsWith("for ")?ee(a.listingType):`For ${ee(a.listingType)}`}),a.featured&&e.jsx(b,{className:"bg-accent text-accent-foreground border-0",children:"Featured"}),a.verified&&e.jsx(b,{className:"bg-green-600 text-white border-0",children:"Verified"})]}),e.jsx("h3",{className:"font-semibold text-base md:text-lg line-clamp-2",children:a.title})]}),e.jsxs("div",{className:"flex items-center text-muted-foreground mb-2",children:[e.jsx(N,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-sm line-clamp-1",children:Z})]}),e.jsx("div",{className:"text-sm text-muted-foreground mb-2 capitalize",children:a.type?a.type.replace("_"," "):"property"}),e.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:F(a)}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[a.bedrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsxs("span",{children:[a.bedrooms," BHK"]})]}),a.bathrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsxs("span",{children:[a.bathrooms," Bath"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{children:Y})]})]}),e.jsx("div",{className:"text-xl md:text-2xl font-bold text-primary",children:X}),a.amenities.length>0&&e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[a.amenities.slice(0,3).map((s,t)=>e.jsx(b,{variant:"outline",className:"text-xs",children:s},t)),a.amenities.length>3&&e.jsxs(b,{variant:"outline",className:"text-xs",children:["+",a.amenities.length-3," more"]})]})]}),e.jsxs(C,{className:"p-2 pt-0 flex gap-1 text-xs",children:[!B&&!I&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{variant:"outline",className:"flex-1 h-8 px-1",onClick:()=>{i?I?D(!0):m(!0):r("/login",{state:{from:`/property/${a._id}`,action:"message"}})},title:"Message",children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"truncate",children:"Message"})]}),e.jsxs(d,{variant:"outline",className:"flex-1 h-8 px-1",onClick:()=>{i?I?D(!0):x(!0):r("/login",{state:{from:`/property/${a._id}`,action:"contact"}})},title:"Contact",children:[e.jsx(S,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"truncate",children:"Contact"})]}),i&&o&&e.jsxs(d,{variant:"outline",className:"flex-1 h-8 px-1",onClick:async e=>{if(e.stopPropagation(),i)try{await f.registerInterest(a._id)}catch(s){}else r("/login",{state:{from:`/property/${a._id}`,action:"interest"}})},title:"Interest",children:[e.jsx(V,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"truncate",children:"Interest"})]})]}),!B&&I&&e.jsxs(d,{variant:"outline",className:"flex-1 bg-green-50 hover:bg-green-100 text-green-700 border-green-200 py-2",onClick:()=>D(!0),children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"WhatsApp Contact"]}),e.jsx(d,{className:"flex-1 py-2",onClick:()=>{i&&n&&(a.owner?._id===l?.id||a.vendor?._id===l?.id)?r(`/vendor/properties/details/${a._id}`):r(`/property/${a._id}`)},children:"View Details"})]}),e.jsx(P,{open:c,onOpenChange:m,property:a,onMessageSent:()=>{}}),e.jsx(L,{open:u,onOpenChange:x,property:a}),e.jsx(k,{open:z,onOpenChange:D,property:a,whatsappNumber:R})]})};export{D as P,I as a};

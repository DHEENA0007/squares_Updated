import{j as e}from"./ui-BHyUY8Z8.js";import{r as i}from"./router-2SVJvIbS.js";import{W as K,a as r,b as d,c as o,z as Q,e as c,as as f,Y,I as $,$ as G,a0 as X,a1 as y,am as Z,B as x,d as ee,f as h,E as se,M as ae,J as I,K as F,O,Q as z,R as L,L as M,q as te,ap as ie}from"./index-Bd1eLXM_.js";import{C as le}from"./calendar-5Rt0tQ5m.js";import"./vendor-Dazix4UH.js";const me=()=>{const[l,_]=i.useState([]),[B,S]=i.useState(!0),[v,P]=i.useState(""),[n,H]=i.useState("active"),[a,w]=i.useState(null),[R,u]=i.useState(!1),[U,j]=i.useState(!1),[p,A]=i.useState(null),[N,C]=i.useState(""),[b,D]=i.useState(""),[g,T]=i.useState({}),{toast:m}=K();i.useEffect(()=>{q()},[n,v]);const q=async()=>{try{S(!0);const s=await fetch(`/api/subadmin/addon-services?status=${n}&search=${v}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(s.ok){const t=await s.json();_(t.data.vendorAddons)}else m({title:"Error",description:"Failed to fetch addon services",variant:"destructive"})}catch{m({title:"Error",description:"Error fetching addon services",variant:"destructive"})}finally{S(!1)}},E=async s=>{A(s),C(`Schedule ${s.name} Service`),D(`Dear Vendor,

We would like to schedule the ${s.name} service that you have purchased.

Please reply to this email with your preferred dates and times for the service.

Service Details:
- Name: ${s.name}
- Description: ${s.description}
- Category: ${s.category.charAt(0).toUpperCase()+s.category.slice(1)}

Thank you!

Best regards,
Admin Team`),j(!0)},J=async()=>{if(!(!a||!p))try{T({...g,email:!0}),(await fetch("/api/subadmin/addon-services/schedule",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({vendorId:a.user._id,addonId:p._id,subject:N,message:b,vendorEmail:a.user.email})})).ok?(m({title:"Success",description:"Scheduling email sent successfully"}),j(!1),A(null)):m({title:"Error",description:"Failed to send scheduling email",variant:"destructive"})}catch{m({title:"Error",description:"Failed to send scheduling email",variant:"destructive"})}finally{T({...g,email:!1})}},V=s=>{switch(s){case"photography":return"bg-blue-600";case"marketing":return"bg-green-600";case"technology":return"bg-purple-600";case"support":return"bg-orange-600";case"crm":return"bg-red-600";default:return"bg-gray-600"}},k=(s,t="INR")=>new Intl.NumberFormat("en-IN",{style:"currency",currency:t,maximumFractionDigits:0}).format(s);return B&&l.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Addon Services"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage vendor addon services and schedule appointments"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"},s))})]}):e.jsxs("div",{className:"p-6 space-y-6 mt-16",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Addon Services"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"View vendors who have purchased addon services and schedule appointments"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(r,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Active Vendors"}),e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold",children:l.filter(s=>s.totalAddons>0).length})})]}),e.jsxs(r,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Total Addons"}),e.jsx(f,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold",children:l.reduce((s,t)=>s+t.totalAddons,0)})})]}),e.jsxs(r,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Unique Services"}),e.jsx(f,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold",children:new Set(l.flatMap(s=>s.activeAddons.map(t=>t._id))).size})})]}),e.jsxs(r,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Categories"}),e.jsx(f,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold",children:new Set(l.flatMap(s=>s.activeAddons.map(t=>t.category))).size})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx($,{placeholder:"Search vendors...",value:v,onChange:s=>P(s.target.value),className:"pl-10"})]}),e.jsxs(G,{value:n,onValueChange:H,children:[e.jsxs(X,{children:[e.jsx(y,{value:"active",children:"Active Subscriptions"}),e.jsx(y,{value:"expired",children:"Expired"}),e.jsx(y,{value:"all",children:"All Vendors"})]}),e.jsx(Z,{value:n,className:"space-y-4 mt-6",children:l.length===0?e.jsx(r,{children:e.jsxs(c,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(f,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Addon Services Found"}),e.jsx("p",{className:"text-muted-foreground text-center",children:n==="active"?"No vendors with active addon subscriptions":`No vendors with ${n} addon subscriptions`})]})}):l.map(s=>e.jsxs(r,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(o,{className:"text-lg",children:[s.user.profile.firstName," ",s.user.profile.lastName]}),e.jsxs(x,{variant:"outline",children:[s.totalAddons," Addon",s.totalAddons!==1?"s":""]})]}),e.jsxs(ee,{className:"space-y-1",children:[e.jsx("div",{className:"flex items-center gap-4 text-sm",children:e.jsx("span",{children:s.user.email})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.activeAddons.slice(0,3).map(t=>e.jsx(x,{className:V(t.category),children:t.name},t._id)),s.activeAddons.length>3&&e.jsxs(x,{variant:"outline",children:["+",s.activeAddons.length-3," more"]})]})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Value"}),e.jsx("div",{className:"text-xl font-bold text-primary",children:k(s.activeAddons.reduce((t,W)=>t+W.price,0))})]})]})}),e.jsx(c,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>{w(s),u(!0)},children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"View Details"]}),e.jsxs(h,{size:"sm",onClick:()=>{w(s),s.activeAddons.length===1?E(s.activeAddons[0]):u(!0)},children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Schedule Service"]})]})})]},s._id))})]}),e.jsx(I,{open:R,onOpenChange:u,children:e.jsxs(F,{className:"max-w-3xl",children:[e.jsxs(O,{children:[e.jsx(z,{children:"Vendor Addon Services"}),e.jsx(L,{children:"Detailed information about vendor's purchased addon services"})]}),a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Vendor Information"}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("p",{className:"font-medium",children:[a.user.profile.firstName," ",a.user.profile.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.user.email}),e.jsxs("p",{className:"text-sm mt-2",children:[e.jsx("strong",{children:"Total Addons:"})," ",a.totalAddons]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Active Addon Services"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:a.activeAddons.map(s=>e.jsxs(r,{className:"hover:shadow-md transition-shadow",children:[e.jsx(d,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(o,{className:"text-sm",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(x,{className:V(s.category),children:s.category}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.billingType.replace("_"," ")})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"font-bold text-primary",children:k(s.price,s.currency)})})]})}),e.jsxs(c,{className:"pt-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:s.description}),e.jsxs(h,{size:"sm",className:"w-full",onClick:()=>{u(!1),E(s)},children:[e.jsx(le,{className:"h-3 w-3 mr-2"}),"Schedule This Service"]})]})]},s._id))})]}),a.subscriptions.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Subscription History"}),e.jsx("div",{className:"space-y-2",children:a.subscriptions.map(s=>e.jsx("div",{className:"bg-muted p-3 rounded-lg text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium",children:["Status: ",e.jsx(x,{variant:s.status==="active"?"default":"secondary",children:s.status})]}),e.jsxs("span",{className:"text-muted-foreground",children:[new Date(s.startDate).toLocaleDateString()," - ",new Date(s.endDate).toLocaleDateString()]})]})},s._id))})]})]})]})}),e.jsx(I,{open:U,onOpenChange:j,children:e.jsxs(F,{className:"max-w-2xl",children:[e.jsxs(O,{children:[e.jsx(z,{children:"Schedule Addon Service"}),e.jsx(L,{children:"Send a scheduling email to the vendor for their purchased addon service"})]}),a&&p&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("p",{className:"font-medium",children:["Vendor: ",a.user.profile.firstName," ",a.user.profile.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.user.email}),e.jsxs("p",{className:"text-sm mt-1",children:[e.jsx("strong",{children:"Service:"})," ",p.name]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"subject",children:"Email Subject"}),e.jsx($,{id:"subject",value:N,onChange:s=>C(s.target.value),placeholder:"Enter email subject"})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"message",children:"Email Message"}),e.jsx(te,{id:"message",value:b,onChange:s=>D(s.target.value),placeholder:"Enter email message",rows:8})]})]}),e.jsxs(ie,{children:[e.jsx(h,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsx(h,{onClick:J,disabled:g.email||!N||!b,children:g.email?"Sending...":"Send Email"})]})]})})]})};export{me as default};

import{j as e}from"./ui-BNZSgpjP.js";import{e as s,d as a,r as i}from"./router-D8v2YSKU.js";import{a2 as l,u as r,G as t,f as n,A as d,a as c,b as o,S as m,c as x,d as p,e as h,L as u,I as j,T as g,B as f,aJ as b,_ as N,g as v}from"./index-FHRTVVMJ.js";import{C as y}from"./checkbox-Jsxxe2yY.js";import{r as w}from"./roleService-3ejt2z73.js";import{A as S,a as k,b as R,c as C}from"./accordion-DKVOIZbP.js";import{I as A}from"./info-CAKsuDov.js";import{K as F}from"./key-C2NjcwOt.js";import{C as I}from"./circle-check-BJNKib8i.js";import"./vendor-BxThA0WO.js";const E=()=>{const{id:E}=s(),P=a(),{toast:L}=l(),{isSuperAdmin:B}=r(),[D,T]=i.useState(null),[U,q]=i.useState(!0),[z,_]=i.useState(!1);i.useEffect(()=>{(async()=>{if(E)try{q(!0);const e=(await w.getRole(E)).data.role;T({...e,pages:e.pages||[],permissions:e.permissions||[]})}catch(e){L({title:"Error",description:"Failed to load role data.",variant:"destructive"}),P("/admin/roles")}finally{q(!1)}})()},[E,P,L]);return U?e.jsx("div",{className:"flex justify-center items-center py-12 h-[50vh]",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(t,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"text-lg font-medium text-muted-foreground",children:"Loading role data..."})]})}):D?e.jsxs("div",{className:"space-y-8 pb-20",children:[e.jsxs("div",{className:"flex items-center gap-4 border-b pb-6",children:[e.jsx(n,{variant:"outline",size:"icon",onClick:()=>P("/admin/roles"),className:"h-10 w-10 rounded-full",children:e.jsx(d,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight",children:["Edit Role: ",D.name]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Update role details and manage permissions"})]})]}),e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),D&&E)try{_(!0),await w.updateRole(E,{name:D.name,description:D.description,pages:D.pages,permissions:D.permissions,isActive:D.isActive,level:D.level}),L({title:"Role Updated",description:"Role permissions have been updated successfully. Users with this role will need to refresh their page or re-login to see the changes."}),P("/admin/roles")}catch(s){L({title:"Error",description:"Failed to update role permissions",variant:"destructive"})}finally{_(!1)}},className:"space-y-8",children:e.jsxs("div",{className:"grid gap-8 md:grid-cols-[1fr_300px]",children:[e.jsxs("div",{className:"space-y-8",children:[e.jsxs(c,{className:"border-l-4 border-l-primary shadow-sm",children:[e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(m,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx(x,{children:"Basic Information"}),e.jsx(p,{children:"Core details about this role"})]})]})}),e.jsxs(h,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{htmlFor:"name",className:"text-base",children:["Role Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(j,{id:"name",value:D.name,onChange:e=>T({...D,name:e.target.value}),disabled:D.isSystemRole&&!B,className:"h-11",required:!0}),D.isSystemRole&&e.jsxs("p",{className:"text-xs text-amber-600 flex items-center gap-1",children:[e.jsx(A,{className:"w-3 h-3"})," System role names cannot be changed"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"level",className:"text-base",children:"Access Level (1-10)"}),e.jsx(j,{id:"level",type:"number",min:"1",max:"10",value:D.level,onChange:e=>T({...D,level:parseInt(e.target.value)||1}),disabled:D.isSystemRole&&!B,className:"h-11"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"description",className:"text-base",children:"Description"}),e.jsx(g,{id:"description",value:D.description,onChange:e=>T({...D,description:e.target.value}),className:"min-h-[100px] resize-none",rows:3})]})]})]}),e.jsxs(c,{className:"border-l-4 border-l-blue-500 shadow-sm",children:[e.jsx(o,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-blue-500/10 rounded-lg",children:e.jsx(F,{className:"h-5 w-5 text-blue-500"})}),e.jsxs("div",{children:[e.jsx(x,{children:"Permissions"}),e.jsx(p,{children:"Select which permissions this role has"})]})]}),e.jsxs(f,{variant:"secondary",className:"text-sm px-3 py-1",children:[D.permissions?.length||0," Selected"]})]})}),e.jsxs(h,{children:[e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-100 dark:border-blue-900/50 flex gap-3",children:[e.jsx(A,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-900 dark:text-blue-100",children:[e.jsx("p",{className:"font-medium mb-1",children:"Permission Control"}),e.jsxs("p",{className:"text-blue-700 dark:text-blue-300 leading-relaxed",children:["Permissions are grouped by module. Expand a group to see available actions.",D.isSystemRole&&!B&&" Note: Some permissions for system roles cannot be modified."]})]})]}),e.jsx(S,{type:"multiple",className:"w-full space-y-4",children:b.map(s=>{const a=s.permissions.map(e=>e.id),i=D.permissions||[],l=a.filter(e=>i.includes(e)).length,r=l===a.length;return e.jsxs(k,{value:s.id,className:"border rounded-lg px-4 bg-card",children:[e.jsx(R,{className:"hover:no-underline py-4",children:e.jsxs("div",{className:"flex items-center justify-between w-full pr-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold text-lg",children:s.label}),l>0&&e.jsxs(f,{variant:r?"default":"secondary",className:"text-xs",children:[l,"/",s.permissions.length]})]}),e.jsx("div",{onClick:e=>{e.stopPropagation(),(e=>{if(!D)return;if(D.isSystemRole&&!B)return;const s=b.find(s=>s.id===e);if(!s)return;const a=s.permissions.map(e=>e.id),i=D.permissions||[],l=a.every(e=>i.includes(e));T(l?{...D,permissions:i.filter(e=>!a.includes(e))}:{...D,permissions:[...new Set([...i,...a])]})})(s.id)},className:"flex items-center gap-1.5 text-sm font-medium transition-colors px-3 py-1.5 rounded-md\n                                "+(D.isSystemRole&&!B?"text-muted-foreground cursor-not-allowed opacity-50":"text-primary hover:text-primary/80 hover:bg-primary/10 cursor-pointer"),children:r?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-4 h-4"}),"Deselect All"]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4"}),"Select All"]})})]})}),e.jsxs(C,{className:"pb-4 pt-2",children:[e.jsx(v,{className:"mb-4"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.permissions.map(s=>e.jsxs("div",{className:`\n                                  flex items-start space-x-3 p-3 rounded-lg border transition-all duration-200\n                                  ${i.includes(s.id)?"bg-primary/5 border-primary/20 shadow-sm":"hover:bg-accent/50 border-transparent hover:border-border"}\n                                `,children:[e.jsx(y,{id:s.id,checked:i.includes(s.id),onCheckedChange:()=>(e=>{if(!D)return;if(D.isSystemRole&&!B)return;const s=D.permissions||[],a=s.includes(e)?s.filter(s=>s!==e):[...s,e];T({...D,permissions:a})})(s.id),disabled:D.isSystemRole&&!B,className:"mt-1"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{htmlFor:s.id,className:"text-sm font-medium leading-none block "+(D.isSystemRole&&!B?"cursor-not-allowed opacity-70":"cursor-pointer"),children:s.label}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.id})]})]},s.id))})]})]},s.id)})})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(c,{className:"sticky top-24",children:[e.jsxs(o,{children:[e.jsx(x,{className:"text-lg",children:"Save Changes"}),e.jsx(p,{children:"Review and update role"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status"}),e.jsx(f,{variant:D.isActive?"default":"secondary",children:D.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Permissions"}),e.jsx("span",{className:"font-bold",children:D.permissions?.length||0})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Type"}),e.jsx(f,{variant:D.isSystemRole?"destructive":"outline",children:D.isSystemRole?"System":"Custom"})]}),e.jsx(v,{}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(n,{type:"submit",disabled:z,className:"w-full h-11 text-base",children:z?"Saving Changes...":"Save Changes"}),e.jsx(n,{type:"button",variant:"outline",onClick:()=>P("/admin/roles"),disabled:z,className:"w-full",children:"Cancel"})]})]})]})})]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Role Not Found"}),e.jsx("p",{className:"text-muted-foreground",children:"The requested role could not be found."}),e.jsxs(n,{onClick:()=>P("/admin/roles"),children:[e.jsx(d,{className:"w-4 h-4 mr-2"}),"Back to Roles"]})]})};export{E as default};

import{j as e}from"./ui-s1SEoZIF.js";import{r as s}from"./router-D8v2YSKU.js";import{u as i,f as a,a as r,b as t,c as n,i as l,e as d,h as c,C as o,X as p,I as m,m as x,n as f,o as h,p as u,q as v,s as j,M as N,P as b,r as g,E as y,W as w,a0 as V,a1 as A,a2 as k,a3 as C,a4 as S,aa as B,S as P,L as D,B as R,T,t as F}from"./index-YrVmIx3a.js";import{C as I}from"./checkbox-OYdlbG4C.js";import{f as E,h as _}from"./apiUtils-B8LmEMCW.js";import{A as $,b as L,a as M}from"./alert-DvMw1BgD.js";import{D as Y}from"./download-CcUNkb54.js";import{C as O}from"./calendar-BA5iLWFv.js";import"./vendor-BxThA0WO.js";const U=()=>{const{user:U}=i(),[z,q]=s.useState([]),[G,J]=s.useState(null),[W,H]=s.useState(!0),[X,K]=s.useState(null),[Q,Z]=s.useState(!1),[ee,se]=s.useState({status:"pending",search:"",businessType:"",experienceMin:"",experienceMax:"",page:1,limit:10}),[ie,ae]=s.useState(null),re=()=>U?.profile?.firstName&&U?.profile?.lastName?`${U.profile.firstName} ${U.profile.lastName}`:U?.profile?.firstName?U.profile.firstName:U?.email?U.email:"",[te,ne]=s.useState(!1),[le,de]=s.useState("approve"),[ce,oe]=s.useState(re()),[pe,me]=s.useState({phoneVerified:!1,emailVerified:!1,identityProofVerified:!1,businessNameVerified:!1,businessTypeVerified:!1,businessDescriptionVerified:!1,experienceVerified:!1,addressVerified:!1,panNumberVerified:!1,gstNumberVerified:!1,licenseNumberVerified:!1,businessRegistrationVerified:!1}),[xe,fe]=s.useState(""),[he,ue]=s.useState(""),[ve,je]=s.useState(!1),[Ne,be]=s.useState(null),ge=async()=>{try{const e=new URLSearchParams({page:ee.page.toString(),limit:ee.limit.toString(),status:ee.status,search:ee.search,businessType:ee.businessType,experienceMin:ee.experienceMin,experienceMax:ee.experienceMax,sortBy:"submittedAt",sortOrder:"desc"}),s=await E(`/admin/vendor-approvals?${e}`),i=await _(s);q(i.data.vendors||[])}catch(e){F({title:"Error",description:e instanceof Error?e.message:"Failed to fetch vendor applications",variant:"destructive"}),q([])}},ye=async()=>{try{const e=await E("/admin/vendor-approval-stats"),s=await _(e);J(s.data||null)}catch(e){F({title:"Error",description:e instanceof Error?e.message:"Failed to fetch statistics",variant:"destructive"}),J(null)}};s.useEffect(()=>{const e=re();e&&oe(e)},[U]),s.useEffect(()=>{(async()=>{H(!0),await Promise.all([ge(),ye()]),H(!1)})()},[ee.status,ee.page,ee.search,ee.businessType,ee.experienceMin,ee.experienceMax,ee.limit]),s.useEffect(()=>{if(X?.approval.phoneVerifiedAt){const e=()=>{const e=new Date(X.approval.phoneVerifiedAt).getTime(),s=6e5-((new Date).getTime()-e);be(s>0?s:0)};e();const s=setInterval(e,1e3);return()=>clearInterval(s)}be(null)},[X]);const we=()=>{me({phoneVerified:!1,emailVerified:!1,identityProofVerified:!1,businessNameVerified:!1,businessTypeVerified:!1,businessDescriptionVerified:!1,experienceVerified:!1,addressVerified:!1,panNumberVerified:!1,gstNumberVerified:!1,licenseNumberVerified:!1,businessRegistrationVerified:!1}),fe(""),ue(""),oe(re())},Ve=(e,s)=>{K(e),de(s),we(),e.approval.verificationChecklist&&me(e.approval.verificationChecklist),oe(e.approval.approverName||re()),ne(!0)},Ae=async()=>{if(!X||!ce.trim())return void F({title:"Error",description:"Approver name is required",variant:"destructive"});if(!pe.phoneVerified)return void F({title:"Error",description:"Phone verification must be completed first",variant:"destructive"});if(!xe.trim())return void F({title:"Error",description:"Approval comments are required",variant:"destructive"});Object.values(pe).every(e=>!0===e)||F({title:"Warning",description:"Not all verification steps are completed. Are you sure you want to proceed?",variant:"destructive"}),ae("approve");try{const e={approvalNotes:xe,approverName:ce,verificationChecklist:pe,verificationLevel:"basic"},s=await E(`/admin/vendor-approvals/${X._id}/approve`,{method:"POST",body:JSON.stringify(e)});await _(s),F({title:"Success",description:"Vendor application approved successfully",variant:"default"}),ne(!1),await ge(),await ye()}catch(e){F({title:"Error",description:e instanceof Error?e.message:"Failed to approve vendor application",variant:"destructive"})}finally{ae(null)}},ke=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Ce=e=>`${Math.floor(e/6e4)}:${Math.floor(e%6e4/1e3).toString().padStart(2,"0")}`,Se=s=>{const i={pending:{variant:"secondary",icon:c,label:"Pending"},under_review:{variant:"default",icon:y,label:"Under Review"},approved:{variant:"default",icon:o,label:"Approved"},rejected:{variant:"destructive",icon:w,label:"Rejected"}},a=i[s]||i.pending,r=a.icon;return e.jsxs(R,{variant:a.variant,children:[e.jsx(r,{className:"w-3 h-3 mr-1"}),a.label]})},Be=()=>{if(!X)return!1;if(!pe.phoneVerified)return!1;if(!X.approval.phoneVerifiedAt)return!1;const e=new Date(X.approval.phoneVerifiedAt).getTime();return(new Date).getTime()-e>=6e5};return W?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:justify-between md:items-start md:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Vendor Applications"}),e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"Review and manage vendor registration applications"})]}),e.jsxs(a,{onClick:async()=>{try{const e=await E("/admin/vendor-approvals/export"),s=await _(e),i=[["Application ID","Company Name","Applicant Name","Email","Phone","Business Type","Submitted Date","Status","Reviewed Date","Reviewed By","Approver Name","Phone Verified","Email Verified","Identity Proof Verified","Business Name Verified","Business Type Verified","Business Description Verified","Experience Verified","Address Verified","PAN Number Verified","GST Number Verified","License Number Verified","Business Registration Verified","Approval/Rejection Comments"].join(","),...s.data.map(e=>{const s=e.approval?.verificationChecklist||{},i=e.approval?.submittedAt?new Date(e.approval.submittedAt).toLocaleDateString():"N/A",a=e.approval?.reviewedAt?new Date(e.approval.reviewedAt).toLocaleDateString():"N/A",r=e.approval?.reviewedBy?`${e.approval.reviewedBy.profile?.firstName||""} ${e.approval.reviewedBy.profile?.lastName||""}`.trim():"N/A";return[e._id||"N/A",`"${e.businessInfo?.companyName||"N/A"}"`,`"${e.user?.profile?.firstName||""} ${e.user?.profile?.lastName||""}"`.trim()||"N/A",e.user?.email||"N/A",e.user?.profile?.phone||"N/A",e.businessInfo?.businessType||"N/A",i,e.approval?.status||"N/A",a,r,e.approval?.approverName||"N/A",s.phoneVerified?"Yes":"No",s.emailVerified?"Yes":"No",s.identityProofVerified?"Yes":"No",s.businessNameVerified?"Yes":"No",s.businessTypeVerified?"Yes":"No",s.businessDescriptionVerified?"Yes":"No",s.experienceVerified?"Yes":"No",s.addressVerified?"Yes":"No",s.panNumberVerified?"Yes":"No",s.gstNumberVerified?"Yes":"No",s.licenseNumberVerified?"Yes":"No",s.businessRegistrationVerified?"Yes":"No",`"${e.approval?.approvalNotes||e.approval?.rejectionReason||"N/A"}"`].join(",")})].join("\n"),a=new Blob([i],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),t=URL.createObjectURL(a);r.setAttribute("href",t),r.setAttribute("download",`vendor_approval_report_${(new Date).toISOString().split("T")[0]}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),F({title:"Success",description:"Approval report exported successfully",variant:"default"})}catch(e){F({title:"Error",description:"Failed to export approval report",variant:"destructive"})}},variant:"outline",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Export Report"]})]}),G&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(r,{children:[e.jsxs(t,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Total Applications"}),e.jsx(l,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:G.overview.totalApplications})})]}),e.jsxs(r,{children:[e.jsxs(t,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Pending Review"}),e.jsx(c,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:G.overview.pendingApplications})})]}),e.jsxs(r,{children:[e.jsxs(t,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Approved"}),e.jsx(o,{className:"h-4 w-4 text-green-600"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:G.overview.approvedApplications})})]}),e.jsxs(r,{children:[e.jsxs(t,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Approval Rate"}),e.jsx(o,{className:"h-4 w-4 text-green-600"})]}),e.jsx(d,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[G.overview.approvalRate.toFixed(1),"%"]})})]})]}),e.jsx(r,{children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(m,{placeholder:"Search by name or email...",value:ee.search,onChange:e=>se({...ee,search:e.target.value})})]}),e.jsxs(x,{value:ee.status,onValueChange:e=>se({...ee,status:e}),children:[e.jsx(f,{children:e.jsx(h,{placeholder:"Filter by status"})}),e.jsxs(u,{children:[e.jsx(v,{value:"all",children:"All Statuses"}),e.jsx(v,{value:"pending",children:"Pending"}),e.jsx(v,{value:"under_review",children:"Under Review"}),e.jsx(v,{value:"approved",children:"Approved"}),e.jsx(v,{value:"rejected",children:"Rejected"})]})]}),e.jsxs(x,{value:ee.businessType||"all",onValueChange:e=>se({...ee,businessType:"all"===e?"":e}),children:[e.jsx(f,{children:e.jsx(h,{placeholder:"Filter by business type"})}),e.jsxs(u,{children:[e.jsx(v,{value:"all",children:"All Types"}),e.jsx(v,{value:"real_estate_agent",children:"Real Estate Agent"}),e.jsx(v,{value:"property_management",children:"Property Management"}),e.jsx(v,{value:"developer",children:"Developer"}),e.jsx(v,{value:"individual",children:"Individual"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{type:"number",placeholder:"Min experience",value:ee.experienceMin,onChange:e=>se({...ee,experienceMin:e.target.value})}),e.jsx(m,{type:"number",placeholder:"Max experience",value:ee.experienceMax,onChange:e=>se({...ee,experienceMax:e.target.value})})]})]})})}),e.jsxs(r,{children:[e.jsx(t,{children:e.jsx(n,{children:"Applications"})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-4",children:0===z.length?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No applications found"}):z.map(s=>e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between p-4 border rounded-lg hover:bg-accent/50 transition-colors gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.businessInfo.companyName}),Se(s.approval.status)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"w-3 h-3"}),s.user?.profile?.firstName||"N/A"," ",s.user?.profile?.lastName||""]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"w-3 h-3"}),s.user?.email||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3"}),s.user?.profile?.phone||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{className:"w-3 h-3"}),s.businessInfo.businessType]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"w-3 h-3"}),ke(s.approval.submittedAt)]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>{K(s),Z(!0)},children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Review"]}),"pending"===s.approval.status||"under_review"===s.approval.status?e.jsxs(e.Fragment,{children:[e.jsxs(a,{variant:"default",size:"sm",onClick:()=>Ve(s,"approve"),children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"under_review"===s.approval.status?"Update":"Approve"]}),e.jsxs(a,{variant:"destructive",size:"sm",onClick:()=>Ve(s,"reject"),children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Reject"]})]}):null]})]},s._id))})})]}),e.jsx(V,{open:Q,onOpenChange:Z,children:e.jsxs(A,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(k,{children:[e.jsx(C,{children:"Application Review"}),e.jsx(S,{children:"Detailed information about the vendor application"})]}),X&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Status"}),e.jsx("div",{className:"mt-2",children:Se(X.approval.status)})]})}),e.jsxs(r,{children:[e.jsx(t,{children:e.jsx(n,{className:"text-base",children:"Contact Person"})}),e.jsxs(d,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Name:"}),e.jsxs("span",{children:[X.user?.profile?.firstName||"N/A"," ",X.user?.profile?.lastName||""]})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Email:"}),e.jsx("span",{className:"break-all",children:X.user?.email||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Phone:"}),e.jsx("span",{children:X.user?.profile?.phone||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Registered On:"}),e.jsx("span",{children:X.user?.createdAt?ke(X.user.createdAt):"N/A"})]})]})]}),e.jsxs(r,{children:[e.jsx(t,{children:e.jsx(n,{className:"text-base",children:"Business Information"})}),e.jsxs(d,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Company Name:"}),e.jsx("span",{children:X.businessInfo.companyName})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Business Type:"}),e.jsx("span",{children:X.businessInfo.businessType})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Experience:"}),e.jsx("span",{children:X.professionalInfo?.experience?`${X.professionalInfo.experience} years`:"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1 md:col-span-2",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Business Description:"}),e.jsx("span",{className:"break-words",children:X.professionalInfo?.description||"N/A"})]})]})]}),e.jsxs(r,{children:[e.jsx(t,{children:e.jsx(n,{className:"text-base",children:"Address Information"})}),e.jsxs(d,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Address:"}),e.jsx("span",{className:"break-words",children:X.professionalInfo?.officeAddress?.area||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"City:"}),e.jsx("span",{children:X.professionalInfo?.officeAddress?.city||X.professionalInfo?.serviceAreas?.[0]?.city||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"State:"}),e.jsx("span",{children:X.professionalInfo?.officeAddress?.state||X.professionalInfo?.serviceAreas?.[0]?.state||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Pincode:"}),e.jsx("span",{children:X.professionalInfo?.officeAddress?.pincode||X.professionalInfo?.serviceAreas?.[0]?.pincode||"N/A"})]})]})]}),e.jsxs(r,{children:[e.jsx(t,{children:e.jsx(n,{className:"text-base",children:"Legal Documents"})}),e.jsxs(d,{className:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"PAN Number:"}),e.jsx("span",{children:X.businessInfo.panNumber||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"GST Number:"}),e.jsx("span",{children:X.businessInfo.gstNumber||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"License Number:"}),e.jsx("span",{children:X.businessInfo.licenseNumber||"N/A"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Website:"}),e.jsx("span",{children:X.businessInfo.website||"N/A"})]})]})]}),X.approval.submittedDocuments&&X.approval.submittedDocuments.length>0&&e.jsxs(r,{children:[e.jsx(t,{children:e.jsx(n,{className:"text-base",children:"Submitted Documents"})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-2",children:X.approval.submittedDocuments.map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.documentName}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.documentType})]})]}),e.jsx(a,{variant:"outline",size:"sm",onClick:()=>window.open(s.documentUrl,"_blank"),children:"View"})]},i))})})]})]}),e.jsx(B,{children:e.jsx(a,{variant:"outline",onClick:()=>Z(!1),children:"Close"})})]})}),e.jsx(V,{open:te,onOpenChange:ne,children:e.jsxs(A,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(k,{children:[e.jsx(C,{children:"approve"===le?"under_review"===X?.approval.status?"Complete Verification":"Approve Application":"Reject Application"}),e.jsx(S,{children:"approve"===le?"Complete the verification checklist and provide approval details":"Provide a reason for rejecting this application"})]}),X&&e.jsxs("div",{className:"space-y-6",children:[X.approval.lockedBy&&String(X.approval.lockedBy._id)!==String(U?.id)&&"superadmin"!==U?.role&&e.jsxs($,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(P,{className:"h-4 w-4 text-yellow-600"}),e.jsx(L,{children:"Application Locked"}),e.jsxs(M,{children:["This vendor application is currently being handled by"," ",e.jsx("strong",{children:X.approval.lockedBy.profile?.firstName?`${X.approval.lockedBy.profile.firstName} ${X.approval.lockedBy.profile.lastName||""}`:X.approval.lockedBy.email}),". You cannot approve or reject this application."]})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:X.businessInfo.companyName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[X.user?.profile?.firstName||"N/A"," ",X.user?.profile?.lastName||""," â€¢ ",X.user?.email||"N/A"]}),X.approval.lockedBy&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("p",{className:"text-xs font-medium text-primary",children:"Currently Handling:"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[X.approval.lockedBy.profile?.firstName?`${X.approval.lockedBy.profile.firstName} ${X.approval.lockedBy.profile.lastName||""}`:X.approval.lockedBy.email,X.approval.lockedBy._id===U?.id&&" (You)"]}),X.approval.lockedAt&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Since: ",new Date(X.approval.lockedAt).toLocaleString()]})]}),X.approval.phoneVerifiedBy&&X.approval.phoneVerifiedBy._id!==X.approval.lockedBy?._id&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("p",{className:"text-xs font-medium text-blue-600",children:"Phone Verified By:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:X.approval.phoneVerifiedBy.profile?.firstName?`${X.approval.phoneVerifiedBy.profile.firstName} ${X.approval.phoneVerifiedBy.profile.lastName||""}`:X.approval.phoneVerifiedBy.email})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{children:"Approver Name"}),e.jsx("div",{className:"p-3 rounded-md bg-muted border border-border",children:e.jsx("p",{className:"font-medium text-sm",children:ce||"Loading..."})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:X.approval.lockedBy&&X.approval.lockedBy._id===U?.id?"You are currently handling this application. Your name is pre-filled from the initial action.":"Automatically set from your logged-in account"})]}),"approve"===le&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{className:"border-2 border-primary/20",children:[e.jsx(t,{children:e.jsxs(n,{className:"text-base flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-primary"}),"Step 1: Phone Verification (Required)"]})}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Phone: ",X.user?.profile?.phone||"N/A"]})]}),pe.phoneVerified?e.jsxs(R,{variant:"default",className:"bg-green-600",children:[e.jsx(o,{className:"w-4 h-4 mr-1"}),"Verified"]}):e.jsx(a,{onClick:async()=>{if(X&&ce.trim()){je(!0);try{const e=await E(`/admin/vendor-approvals/${X._id}/verify-phone`,{method:"POST",body:JSON.stringify({approverName:ce})});await _(e);me(e=>({...e,phoneVerified:!0})),K(e=>e?{...e,approval:{...e.approval,status:"under_review",phoneVerifiedAt:(new Date).toISOString(),verificationChecklist:{...e.approval.verificationChecklist,phoneVerified:!0}}}:e),await ge(),F({title:"Phone Verified",description:"Phone verification successful. Status changed to under review.",variant:"default"})}catch(e){F({title:"Error",description:e instanceof Error?e.message:"Failed to verify phone",variant:"destructive"})}finally{je(!1)}}else F({title:"Error",description:"Please enter approver name first",variant:"destructive"})},disabled:ve||!ce.trim(),size:"sm",children:ve?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Verifying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"Verify Phone"]})})]}),X.approval.phoneVerifiedAt&&null!==Ne&&e.jsxs($,{children:[e.jsx(c,{className:"h-4 w-4"}),e.jsx(L,{children:"Verification Freeze Period"}),e.jsx(M,{children:Ne>0?e.jsxs(e.Fragment,{children:["Time remaining until other verifications unlock: "," ",e.jsx("strong",{className:"text-primary",children:Ce(Ne)})]}):e.jsx("span",{className:"text-green-600 font-semibold",children:"Freeze period completed! You can now proceed with other verifications."})})]})]})]}),e.jsxs(r,{children:[e.jsx(t,{children:e.jsxs(n,{className:"text-base",children:["Step 2: Verification Checklist ",!Be()&&"(Locked - Complete phone verification first)"]})}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Personal Information"}),e.jsxs("div",{className:"space-y-2 pl-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{id:"emailVerified",checked:pe.emailVerified,onCheckedChange:e=>me({...pe,emailVerified:e}),disabled:!Be()}),e.jsx("label",{htmlFor:"emailVerified",className:"text-sm cursor-pointer",children:"Email verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{id:"identityProofVerified",checked:pe.identityProofVerified,onCheckedChange:e=>me({...pe,identityProofVerified:e}),disabled:!Be()}),e.jsx("label",{htmlFor:"identityProofVerified",className:"text-sm cursor-pointer",children:"Identity documents verified (Aadhar/Passport/DL)"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Business Information"}),e.jsxs("div",{className:"space-y-2 pl-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{id:"businessNameVerified",checked:pe.businessNameVerified,onCheckedChange:e=>me({...pe,businessNameVerified:e}),disabled:!Be()}),e.jsx("label",{htmlFor:"businessNameVerified",className:"text-sm cursor-pointer",children:"Business name verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{id:"businessTypeVerified",checked:pe.businessTypeVerified,onCheckedChange:e=>me({...pe,businessTypeVerified:e}),disabled:!Be()}),e.jsx("label",{htmlFor:"businessTypeVerified",className:"text-sm cursor-pointer",children:"Business type verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{id:"businessDescriptionVerified",checked:pe.businessDescriptionVerified,onCheckedChange:e=>me({...pe,businessDescriptionVerified:e}),disabled:!Be()}),e.jsx("label",{htmlFor:"businessDescriptionVerified",className:"text-sm cursor-pointer",children:"Business description verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{id:"experienceVerified",checked:pe.experienceVerified,onCheckedChange:e=>me({...pe,experienceVerified:e}),disabled:!Be()}),e.jsx("label",{htmlFor:"experienceVerified",className:"text-sm cursor-pointer",children:"Professional experience verified"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Address Information"}),e.jsx("div",{className:"space-y-2 pl-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{id:"addressVerified",checked:pe.addressVerified,onCheckedChange:e=>me({...pe,addressVerified:e}),disabled:!Be()}),e.jsx("label",{htmlFor:"addressVerified",className:"text-sm cursor-pointer",children:"Address verified and matches records"})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Legal Documents"}),e.jsxs("div",{className:"space-y-2 pl-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{id:"panNumberVerified",checked:pe.panNumberVerified,onCheckedChange:e=>me({...pe,panNumberVerified:e}),disabled:!Be()}),e.jsx("label",{htmlFor:"panNumberVerified",className:"text-sm cursor-pointer",children:"PAN card verified"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{id:"gstNumberVerified",checked:pe.gstNumberVerified,onCheckedChange:e=>me({...pe,gstNumberVerified:e}),disabled:!Be()}),e.jsx("label",{htmlFor:"gstNumberVerified",className:"text-sm cursor-pointer",children:"GST number verified (if applicable)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{id:"licenseNumberVerified",checked:pe.licenseNumberVerified,onCheckedChange:e=>me({...pe,licenseNumberVerified:e}),disabled:!Be()}),e.jsx("label",{htmlFor:"licenseNumberVerified",className:"text-sm cursor-pointer",children:"License/registration verified"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Documents"}),e.jsx("div",{className:"space-y-2 pl-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{id:"businessRegistrationVerified",checked:pe.businessRegistrationVerified,onCheckedChange:e=>me({...pe,businessRegistrationVerified:e}),disabled:!Be()}),e.jsx("label",{htmlFor:"businessRegistrationVerified",className:"text-sm cursor-pointer",children:"All required documents submitted and verified"})]})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(D,{htmlFor:"approvalComments",children:["Approval Comments ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(T,{id:"approvalComments",value:xe,onChange:e=>fe(e.target.value),placeholder:"Add any additional notes about this approval...",rows:4})]})]}),"reject"===le&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(D,{htmlFor:"rejectionComments",children:["Rejection Reason ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(T,{id:"rejectionComments",value:he,onChange:e=>ue(e.target.value),placeholder:"Provide a detailed reason for rejection...",rows:6})]})]}),e.jsxs(B,{children:[e.jsx(a,{variant:"outline",onClick:()=>{ne(!1),we()},disabled:null!==ie,children:"Cancel"}),"approve"===le?e.jsx(a,{onClick:async()=>{X&&("under_review"===X.approval.status&&null!==Ne&&Ne>0?F({title:"Freeze Period Active",description:`Please wait ${Ce(Ne)} before completing the verification.`,variant:"destructive"}):await Ae())},disabled:"approve"===ie||!pe.phoneVerified||null!==Ne&&Ne>0||X?.approval.lockedBy&&String(X.approval.lockedBy._id)!==String(U?.id)&&"superadmin"!==U?.role,children:"approve"===ie?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):null!==Ne&&Ne>0?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),"Wait ",Ce(Ne)]}):e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"under_review"===X?.approval.status?"Complete & Approve":"Approve"]})}):e.jsx(a,{variant:"destructive",onClick:async()=>{if(X)if(he.trim()){ae("reject");try{const e=await E(`/admin/vendor-approvals/${X._id}/reject`,{method:"POST",body:JSON.stringify({rejectionReason:he})});await _(e),F({title:"Success",description:"Vendor application rejected",variant:"default"}),ne(!1),await ge(),await ye()}catch(e){F({title:"Error",description:e instanceof Error?e.message:"Failed to reject vendor application",variant:"destructive"})}finally{ae(null)}}else F({title:"Error",description:"Rejection reason is required",variant:"destructive"})},disabled:"reject"===ie||X?.approval.lockedBy&&String(X.approval.lockedBy._id)!==String(U?.id)&&"superadmin"!==U?.role,children:"reject"===ie?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Reject Application"]})})]})]})})]})};export{U as default};

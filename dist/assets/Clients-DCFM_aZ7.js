import{j as e}from"./ui-DHQhougw.js";import{r as t}from"./router-Bi51YGN-.js";import{R as s,s as a,f as n,a as i,b as r,c as l,d as c,e as d,B as o,E as m,D as u,G as p,J as x,K as h,O as j,p as v,aq as g,ar as f,as as b,w as y,U as N,at as w}from"./index-B494FSRu.js";import{F as A,E as S}from"./exportUtils-BSBNdRyp.js";import{P as R,a as D,b as P,c as C,d as T,e as E}from"./pagination-C8Uahksb.js";import{s as M}from"./subscriptionService-CbMCF0n1.js";import{S as _}from"./SearchFilter-BsNHdyv2.js";import{T as k,a as H,b as $,c as V,d as I,e as F}from"./table-tOF9XqYs.js";import{C as L}from"./calendar-DEtUwBTO.js";import{R as z}from"./refresh-cw-CG5q2i5F.js";import{L as U,M as O}from"./megaphone-BUolA_5T.js";import{C as Y}from"./camera-BqmuXAO9.js";import"./vendor-eVk5PToZ.js";import"./ellipsis-BgKSN2yL.js";const G=e=>`Rs. ${(e||0).toLocaleString("en-IN")}`,q=()=>{const[q,B]=t.useState(""),[K,W]=t.useState("all"),[J,Q]=t.useState([]),[X,Z]=t.useState(!0),[ee,te]=t.useState(1),[se,ae]=t.useState(1),[ne,ie]=t.useState(null),[re,le]=t.useState(!1),{toast:ce}=s(),de=t=>{const s={className:"w-4 h-4"};switch(t?.toLowerCase()){case"photography":return e.jsx(Y,{...s});case"marketing":return e.jsx(O,{...s});case"technology":return e.jsx(U,{...s});case"support":return e.jsx(w,{...s});case"crm":return e.jsx(N,{...s});default:return e.jsx(g,{...s})}},oe=async()=>{try{Z(!0);const e={page:ee,limit:10,search:q||void 0,status:"all"===K?void 0:K},t=await M.getSubscriptions(e),s=t.data.subscriptions.filter(e=>e&&e.user&&(e.user.name||e.user.email));s.forEach((e,t)=>{e.paymentHistory&&e.paymentHistory.length}),Q(s),ae(t.data.pagination.totalPages)}catch(e){e instanceof Error&&(e.message.includes("Admin access required")?ce({title:"Access Denied",description:"Admin privileges required to view subscriptions.",variant:"destructive"}):e.message.includes("Authentication required")?ce({title:"Authentication Required",description:"Please log in to continue.",variant:"destructive"}):ce({title:"Error",description:"Failed to load subscriptions. Please try again.",variant:"destructive"}))}finally{Z(!1)}};t.useEffect(()=>{oe()},[ee,q,K]);const me=e=>{ie(e),le(!0)};return X?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(a,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading clients..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Subscribed Clients"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage client subscriptions and details"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(n,{variant:"outline",onClick:()=>{if(J&&0!==J.length?0!==J.filter(e=>e&&e._id&&e.user&&e.status).length||(ce({title:"Invalid Data",description:"No valid subscription data found for export. Please contact support if this issue persists.",variant:"destructive"}),0):(ce({title:"No Data",description:"No subscription data available for export. Please check if there are any subscriptions in the system.",variant:"destructive"}),0))try{const e=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),t=(()=>{const e=J.filter(e=>e&&e._id&&e.user&&e.status);if(0===e.length)throw new Error("No valid subscription data found");const t=e.filter(e=>"active"===e.status),s=e.filter(e=>"expired"===e.status),a=e.filter(e=>"cancelled"===e.status),n=e=>{const t=e.paymentDetails&&(e.paymentDetails.razorpayPaymentId||e.transactionId);let s=[];if(e.paymentHistory&&e.paymentHistory.length>0&&(s=e.paymentHistory.filter(e=>e&&e.amount&&e.amount>0&&("subscription_purchase"===e.type||"renewal"===e.type||"upgrade"===e.type))),0===s.length&&t&&e.lastPaymentDate){if("cancelled"===e.status&&e.updatedAt){const t=new Date(e.lastPaymentDate);if((new Date(e.updatedAt).getTime()-t.getTime())/864e5<=1)return 0}return e.amount||0}if(0===s.length)return 0;const a=s.sort((e,t)=>new Date(e.date||"").getTime()-new Date(t.date||"").getTime());let n=0,i=0;if(a.forEach((e,t)=>{if("subscription_purchase"===e.type)n+=e.amount||0,i=e.amount||0;else if("renewal"===e.type)n+=e.amount||0;else if("upgrade"===e.type){const t=e.amount||0,s=t-i;s>0&&(n+=s),i=t}}),"cancelled"===e.status&&a.length>0){const t=a[a.length-1],s=new Date(e.updatedAt||""),i=new Date(t.date||"");(s.getTime()-i.getTime())/864e5<=1&&(n*=.5)}return Math.max(0,n)},i=t.reduce((e,t)=>e+n(t),0),r=e.reduce((e,t)=>e+n(t),0),l=a.reduce((e,t)=>t.paymentHistory&&t.paymentHistory.length>0?e+n(t):e,0),c=s.reduce((e,t)=>t.paymentHistory&&t.paymentHistory.length>0?e+n(t):e,0),d=e.reduce((e,t)=>{if(!t.addons||!Array.isArray(t.addons)||0===t.addons.length)return e;let s=0;if(t.paymentHistory&&t.paymentHistory.length>0){const a=t.paymentHistory.filter(e=>e&&"addon_purchase"===e.type&&e.amount&&e.amount>0);if(a.length>0)return s=a.reduce((e,t)=>e+(t.amount||0),0),e+s}if((t.paymentDetails&&t.paymentDetails.razorpayPaymentId||t.lastPaymentDate||t.transactionId)&&"active"===t.status){const e="object"==typeof t.plan&&null!==t.plan&&t.plan.price||0,a=(t.amount||0)-e;if(a>0&&(s=a,"cancelled"===t.status&&t.lastPaymentDate&&t.updatedAt)){const e=new Date(t.lastPaymentDate);(new Date(t.updatedAt).getTime()-e.getTime())/864e5<=1&&(s*=.5)}}return e+s},0);return{validSubscriptions:e,activeSubscriptions:t,expiredSubscriptions:s,cancelledSubscriptions:a,totalActiveRevenue:i,totalRevenueAll:r,cancelledRevenue:l,expiredRevenue:c,addonRevenue:d,grandTotalRevenue:i+d,calculateRevenue:n}})(),s=[{Metric:"Total Clients","Count / Amount":t.validSubscriptions.length},{Metric:"Active Subscriptions","Count / Amount":t.activeSubscriptions.length},{Metric:"Cancelled Subscriptions","Count / Amount":t.cancelledSubscriptions.length},{Metric:"Expired Subscriptions","Count / Amount":t.expiredSubscriptions.length},{Metric:"Total Subscriptions","Count / Amount":t.validSubscriptions.length},{Metric:"Total Active Revenue (Verified Paid)","Count / Amount":G(t.totalActiveRevenue)},{Metric:"Total Revenue from All Paid Subscriptions","Count / Amount":G(t.totalRevenueAll)},{Metric:"Revenue from Cancelled Subscriptions (Paid)","Count / Amount":G(t.cancelledRevenue)},{Metric:"Revenue from Expired Subscriptions (Paid)","Count / Amount":G(t.expiredRevenue)},{Metric:"Add-on Revenue (Verified Paid)","Count / Amount":G(t.addonRevenue)},{Metric:"Grand Total Revenue (All Verified Payments)","Count / Amount":G(t.grandTotalRevenue)}],a=t.totalActiveRevenue+t.cancelledRevenue+t.expiredRevenue,n=[{Status:"Active (Verified Paid)",Count:t.activeSubscriptions.length,"Total Amount":G(t.totalActiveRevenue),"% of Total Amount":a>0?`${(t.totalActiveRevenue/a*100).toFixed(1)}%`:"0%"},{Status:"Cancelled (Previously Paid)",Count:t.cancelledSubscriptions.length,"Total Amount":G(t.cancelledRevenue),"% of Total Amount":a>0?`${(t.cancelledRevenue/a*100).toFixed(1)}%`:"0%"},{Status:"Expired (Previously Paid)",Count:t.expiredSubscriptions.length,"Total Amount":G(t.expiredRevenue),"% of Total Amount":a>0?`${(t.expiredRevenue/a*100).toFixed(1)}%`:"0%"}],i=(e=>{const{validSubscriptions:t,calculateRevenue:s}=e;return t.map((e,t)=>{const a="object"==typeof e.user&&null!==e.user&&(e.user.name||e.user.email)||`Client ${t+1}`,n="object"==typeof e.user&&null!==e.user&&e.user.email||"N/A",i="object"==typeof e.plan&&null!==e.plan&&e.plan.name||"Unknown Plan",r="object"==typeof e.plan&&null!==e.plan&&e.plan.price||0,l=s(e),c=Array.isArray(e.addons)?e.addons.length:0;let d=0;if(Array.isArray(e.addons)&&e.addons.length>0)if(Array.isArray(e.paymentHistory)){const t=e.paymentHistory.filter(e=>e&&"addon_purchase"===e.type&&e.amount&&e.amount>0).reduce((e,t)=>e+(t?.amount||0),0);if(t>0)d=t;else if("active"===e.status){const t=(e.amount||0)-r;d=t>0?t:0}}else if("active"===e.status){const t=(e.amount||0)-r;d=t>0?t:0}return{"#":t+1,"Client Name":a,Email:n,Plan:i,"Plan Price":G(r),"Paid Amount":G(l),Status:M.formatSubscriptionStatus(e.status||"unknown").label,"Start Date":S.formatDate(e.startDate),"End Date":S.formatDate(e.endDate),"Auto Renew":e.autoRenew?"Yes":"No","Add-ons":c,"Add-on Amount":G(d),"Payment Status":l>0?"Paid":"Unpaid"}})})(t),r=i.map(e=>({"#":e["#"],"Client Name":e["Client Name"],Email:e.Email,Plan:e.Plan,"Plan Price":e["Plan Price"],"Paid Amount":e["Paid Amount"],Status:e.Status,"Start Date":e["Start Date"],"End Date":e["End Date"],"Auto Renew":e["Auto Renew"],"Add-ons":e["Add-ons"],"Add-on Amount":e["Add-on Amount"],"Payment Status":e["Payment Status"]})),l=(e=>{const{validSubscriptions:t}=e,s=[];return t.forEach(e=>{const t="object"==typeof e.user&&null!==e.user&&(e.user.name||e.user.email)||"Unknown Client";Array.isArray(e.addons)&&e.addons.length>0&&e.addons.forEach(a=>{if("object"==typeof a&&null!==a&&a.name){const n=Array.isArray(e.paymentHistory)?e.paymentHistory.filter(e=>e&&"addon_purchase"===e.type&&Array.isArray(e.addons)&&e.addons.includes(a._id)).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())[0]:null;s.push({"#":s.length+1,"Client Name":t,"Add-on Name":a.name,Category:a.category||"N/A",Price:G(a.price),"Billing Type":a.billingType?.replace("_"," ")||"N/A","Last Payment Date":n?S.formatDate(n.date):"N/A"})}})}),s})(t),c=t.activeSubscriptions.length,d=c>0?Math.round(t.totalActiveRevenue/c):0,o={};t.activeSubscriptions.forEach(e=>{const s=e.plan?.name||"Unknown",a=t.calculateRevenue(e);o[s]=(o[s]||0)+a});const m=Object.entries(o).sort(([,e],[,t])=>t-e)[0]?.[0]||"N/A",u={};t.validSubscriptions.forEach(e=>{e.addons?.forEach(e=>{e?.name&&(u[e.name]=(u[e.name]||0)+1)})});const p=Object.entries(u).sort(([,e],[,t])=>t-e)[0]?.[0]||"N/A",x=[{Insight:"Total Active Clients",Value:c},{Insight:"Average Revenue per Active Client (ARPC)",Value:G(d)},{Insight:"Total Paid Revenue (All Time)",Value:G(t.totalRevenueAll)},{Insight:"Active Subscriptions Revenue",Value:G(t.totalActiveRevenue)},{Insight:"Addon Revenue (Active)",Value:G(t.addonRevenue)},{Insight:"Highest-Grossing Plan",Value:m},{Insight:"Most Purchased Add-on",Value:p}],h=(()=>{const e={};return t.validSubscriptions.forEach(s=>{if(s.createdAt||s.startDate){const a=new Date(s.createdAt||s.startDate),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`;e[n]||(e[n]={subscriptionRevenue:0,addonRevenue:0,newSubscriptions:0,cancelledSubscriptions:0,upgrades:0,totalRevenue:0}),e[n].newSubscriptions+=1;const i=t.calculateRevenue(s);i>0&&(e[n].subscriptionRevenue+=i)}if("cancelled"===s.status&&s.updatedAt){const t=new Date(s.updatedAt),a=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`;e[a]||(e[a]={subscriptionRevenue:0,addonRevenue:0,newSubscriptions:0,cancelledSubscriptions:0,upgrades:0,totalRevenue:0}),e[a].cancelledSubscriptions+=1}s.paymentHistory&&s.paymentHistory.length>0&&s.paymentHistory.forEach(t=>{if(t.date&&t.amount&&t.amount>0){const a=new Date(t.date),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`;if(e[n]||(e[n]={subscriptionRevenue:0,addonRevenue:0,newSubscriptions:0,cancelledSubscriptions:0,upgrades:0,totalRevenue:0}),"addon_purchase"===t.type)e[n].addonRevenue+=t.amount;else if("upgrade"===t.type){e[n].upgrades+=1;const i=s.paymentHistory?.filter(e=>e.date&&new Date(e.date)<a&&("subscription_purchase"===e.type||"upgrade"===e.type)).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),r=i&&i.length>0&&i[0].amount||0,l=t.amount-r;l>0&&(e[n].subscriptionRevenue+=l)}else"subscription_purchase"!==t.type&&"renewal"!==t.type||(e[n].subscriptionRevenue+=t.amount)}})}),Object.keys(e).forEach(t=>{e[t].totalRevenue=e[t].subscriptionRevenue+e[t].addonRevenue}),Object.keys(e).sort().map(t=>({Month:t,"New Subscriptions":e[t].newSubscriptions,"Cancelled Subscriptions":e[t].cancelledSubscriptions,Upgrades:e[t].upgrades,"Subscription Revenue":G(e[t].subscriptionRevenue),"Addon Revenue":G(e[t].addonRevenue),"Total Revenue":G(e[t].totalRevenue)}))})(),j=(()=>{const e=new Date,s=(e.getMonth(),e.getFullYear()),a=t.validSubscriptions.filter(e=>new Date(e.createdAt||e.startDate).getFullYear()===s).reduce((e,s)=>e+t.calculateRevenue(s),0),n=t.validSubscriptions.filter(e=>new Date(e.createdAt||e.startDate).getFullYear()===s-1).reduce((e,s)=>e+t.calculateRevenue(s),0),i=n>0?((a-n)/n*100).toFixed(1):"N/A",r=t.cancelledSubscriptions.length,l=t.validSubscriptions.length,o=l>0?(r/l*100).toFixed(1):"0",u={};t.activeSubscriptions.forEach(e=>{const t=e.plan?.name||"Unknown";u[t]=(u[t]||0)+1});return[{Metric:"Total Revenue (All Time)",Value:G(t.totalRevenueAll)},{Metric:"Active Subscriptions Revenue",Value:G(t.totalActiveRevenue)},{Metric:"Addon Revenue",Value:G(t.addonRevenue)},{Metric:"This Year Revenue",Value:G(a)},{Metric:"Last Year Revenue",Value:G(n)},{Metric:"Year-over-Year Growth",Value:`${i}%`},{Metric:"Churn Rate",Value:`${o}%`},{Metric:"Average Revenue per Client (ARPC)",Value:G(d)},{Metric:"Total Active Clients",Value:c},{Metric:"Total Clients (All Time)",Value:t.validSubscriptions.length},{Metric:"Conversion Rate (Active/Total)",Value:`${l>0?(c/l*100).toFixed(1):0}%`},{Metric:"Most Popular Plan",Value:m},{Metric:"Plan Distribution",Value:Object.entries(u).map(([e,t])=>`${e}: ${t}`).join(", ")}]})(),v={filename:"subscribed_clients_revenue_report",title:"Subscribed Clients Revenue Report",metadata:{"Generated on":e,"Report Period":"All Time","Prepared by":"Admin System"}},g=[{name:"Summary Statistics",data:s,columns:[{wch:30},{wch:20}]},{name:"Status Breakdown",data:n,columns:[{wch:15},{wch:10},{wch:20},{wch:20}]},{name:"Monthly Report",data:h,columns:[{wch:12},{wch:15},{wch:18},{wch:12},{wch:18},{wch:15},{wch:15}]},{name:"Overall Analysis",data:j,columns:[{wch:35},{wch:25}]},{name:"Subscription Details",data:r,columns:[{wch:5},{wch:25},{wch:30},{wch:20},{wch:15},{wch:15},{wch:12},{wch:15},{wch:12},{wch:10},{wch:8},{wch:15},{wch:12}]},{name:"Add-on Details",data:l,columns:[{wch:5},{wch:25},{wch:25},{wch:15},{wch:12},{wch:20},{wch:15}]},{name:"Key Insights",data:x,columns:[{wch:35},{wch:25}]}];S.generateExcelReport(v,g),ce({title:"Export Successful",description:"Comprehensive revenue report with monthly analysis and corrected calculations has been generated successfully"})}catch(e){ce({title:"Export Failed",description:"Failed to export data to Excel. Please try again.",variant:"destructive"})}},children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:"Export Excel"})]})})]}),e.jsxs(i,{children:[e.jsxs(r,{children:[e.jsx(l,{children:"All Clients"}),e.jsxs(c,{children:[J.length," client",1!==J.length?"s":""," found"]})]}),e.jsxs(d,{children:[e.jsx(_,{searchTerm:q,onSearchChange:e=>{B(e),te(1)},filterValue:K,onFilterChange:e=>{W(e),te(1)},filterOptions:[{label:"Active",value:"active"},{label:"Expired",value:"expired"},{label:"Cancelled",value:"cancelled"}],filterPlaceholder:"Filter by status"}),e.jsx("div",{className:"block sm:hidden space-y-4",children:0===J.length?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No subscriptions found"}):J.map(t=>e.jsx(i,{className:"hover:shadow-md transition-shadow",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-base truncate",children:t.user.name}),e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:t.user.email})]}),e.jsx(o,{variant:"active"===t.status?"default":"expired"===t.status?"destructive":"secondary",className:"ml-2 flex-shrink-0",children:M.formatSubscriptionStatus(t.status).label})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Plan:"}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium",children:t.plan?.name||"N/A"}),e.jsx("div",{className:"text-muted-foreground capitalize",children:t.plan?.billingPeriod||"N/A"})]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount:"}),e.jsx("span",{className:"font-semibold",children:M.formatAmount(t)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Start:"}),e.jsx("div",{className:"font-medium",children:new Date(t.startDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"End:"}),e.jsx("div",{className:"font-medium",children:new Date(t.endDate).toLocaleDateString()})]})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>me(t),className:"w-full",children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"View Details"]})})]})})},t._id))}),e.jsx("div",{className:"hidden sm:block rounded-lg border border-border bg-card overflow-x-auto",children:e.jsxs(k,{children:[e.jsx(H,{children:e.jsxs($,{className:"bg-muted/50",children:[e.jsx(V,{className:"font-semibold w-[250px] min-w-[200px]",children:"Client"}),e.jsx(V,{className:"font-semibold w-[200px] min-w-[150px]",children:"Plan"}),e.jsx(V,{className:"font-semibold w-[120px] min-w-[100px]",children:"Amount"}),e.jsx(V,{className:"font-semibold w-[130px] min-w-[110px]",children:"Start Date"}),e.jsx(V,{className:"font-semibold w-[130px] min-w-[110px]",children:"End Date"}),e.jsx(V,{className:"font-semibold w-[120px] min-w-[100px]",children:"Status"}),e.jsx(V,{className:"font-semibold text-center w-[120px] min-w-[100px]",children:"Actions"})]})}),e.jsx(I,{children:0===J.length?e.jsx($,{children:e.jsx(F,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No subscriptions found"})}):J.map(t=>e.jsxs($,{className:"hover:bg-muted/30 transition-colors",children:[e.jsx(F,{className:"w-[250px] min-w-[200px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",children:t.user.name}),e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:t.user.email})]})}),e.jsx(F,{className:"w-[200px] min-w-[150px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",children:t.plan?.name||"N/A"}),e.jsx("div",{className:"text-sm text-muted-foreground capitalize truncate",children:t.plan?.billingPeriod||"N/A"})]})}),e.jsx(F,{className:"w-[120px] min-w-[100px]",children:e.jsx("span",{className:"font-semibold whitespace-nowrap",children:M.formatAmount(t)})}),e.jsx(F,{className:"w-[130px] min-w-[110px]",children:e.jsx("span",{className:"whitespace-nowrap",children:new Date(t.startDate).toLocaleDateString()})}),e.jsx(F,{className:"w-[130px] min-w-[110px]",children:e.jsx("span",{className:"whitespace-nowrap",children:new Date(t.endDate).toLocaleDateString()})}),e.jsx(F,{className:"w-[120px] min-w-[100px]",children:e.jsx(o,{variant:"active"===t.status?"default":"expired"===t.status?"destructive":"secondary",className:"whitespace-nowrap",children:M.formatSubscriptionStatus(t.status).label})}),e.jsx(F,{className:"text-center w-[120px] min-w-[100px]",children:e.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>me(t),className:"whitespace-nowrap",children:[e.jsx(m,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:"View"})]})})]},t._id))})]})}),se>1&&e.jsx("div",{className:"mt-6",children:e.jsx(R,{children:e.jsxs(D,{children:[e.jsx(P,{children:e.jsx(C,{onClick:()=>{ee>1&&te(ee-1)},className:1===ee?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:se},(e,t)=>t+1).map(t=>e.jsx(P,{children:e.jsx(T,{onClick:()=>(e=>{te(e)})(t),isActive:ee===t,className:"cursor-pointer",children:t})},t)),e.jsx(P,{children:e.jsx(E,{onClick:()=>{ee<se&&te(ee+1)},className:ee===se?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]}),e.jsx(u,{open:re,onOpenChange:le,children:e.jsxs(p,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(x,{children:[e.jsx(h,{children:"Subscription Details"}),e.jsxs(j,{children:["Complete information about ",ne?.user.name,"'s subscription"]})]}),ne&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5"}),"Client Information"]})}),e.jsx(d,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Name"}),e.jsx("p",{className:"text-base",children:ne.user.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Email"}),e.jsx("p",{className:"text-base",children:ne.user.email})]}),ne.user.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"text-base",children:ne.user.phone})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"User ID"}),e.jsx("p",{className:"text-sm font-mono",children:ne.user._id})]})]})})]}),e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-5 h-5"}),"Plan Information"]})}),e.jsx(d,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Plan Name"}),e.jsx("p",{className:"text-base font-semibold",children:ne.plan?.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Description"}),e.jsx("p",{className:"text-base",children:ne.plan?.description||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Plan Price"}),e.jsx("p",{className:"text-base font-semibold",children:ne.plan?.price?M.formatAmount({...ne,amount:ne.plan.price}):"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Billing Period"}),e.jsx("p",{className:"text-base",children:ne.plan?.billingPeriod||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Plan ID"}),e.jsx("p",{className:"text-sm font-mono",children:ne.plan?._id||"N/A"})]})]})})]}),ne.addons&&ne.addons.length>0&&e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5"}),"Purchased Addons (",ne.addons.length,")"]})}),e.jsxs(d,{className:"space-y-3",children:[e.jsx("div",{className:"grid gap-4",children:ne.addons.map((t,s)=>e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-border rounded-lg bg-muted/30",children:[e.jsx("div",{className:"p-2 rounded-lg bg-background border",children:de(t.category)}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:"font-semibold text-base text-foreground",children:t.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 overflow-hidden",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:t.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx(o,{variant:"outline",className:"capitalize text-xs",children:t.category}),e.jsx(o,{variant:"secondary",className:"text-xs",children:t.billingType?.replace("_"," ")||"N/A"})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:"font-semibold text-lg text-foreground",children:t.price?`${"INR"===t.currency?"₹":"$"}${t.price}`:"Free"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"monthly"===t.billingType?"/month":"yearly"===t.billingType?"/year":"per_property"===t.billingType?"/property":"one_time"===t.billingType?"one-time":""})]})]})})]},t._id||s))}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50/50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Total Addons"}),e.jsxs("p",{className:"text-sm text-blue-700",children:[ne.addons.length," addon",1!==ne.addons.length?"s":""," purchased"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-blue-900",children:ne.addons.reduce((e,t)=>e+(t.price||0),0)>0?`${"INR"===ne.currency?"₹":"$"}${ne.addons.reduce((e,t)=>e+(t.price||0),0)}`:"Free"}),e.jsx("p",{className:"text-xs text-blue-700",children:"addons value"})]})]})})]})]}),e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5"}),"Subscription Details"]})}),e.jsx(d,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx(o,{variant:"active"===ne.status?"default":"expired"===ne.status?"destructive":"secondary",className:"mt-1",children:M.formatSubscriptionStatus(ne.status).label})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Auto Renew"}),e.jsx(o,{variant:ne.autoRenew?"default":"secondary",className:"mt-1",children:ne.autoRenew?"Enabled":"Disabled"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Start Date"}),e.jsx("p",{className:"text-base",children:new Date(ne.startDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"End Date"}),e.jsx("p",{className:"text-base",children:new Date(ne.endDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Days Remaining"}),e.jsx("p",{className:"text-base",children:"active"===ne.status?`${M.getDaysUntilExpiry(ne)} days`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Created At"}),e.jsx("p",{className:"text-base",children:new Date(ne.createdAt).toLocaleDateString()})]})]})})]}),e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5"}),"Payment Information"]})}),e.jsx(d,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Amount Paid"}),e.jsx("p",{className:"text-base font-semibold",children:M.formatAmount(ne)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Currency"}),e.jsx("p",{className:"text-base",children:ne.currency})]}),ne.paymentMethod&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Payment Method"}),e.jsx("p",{className:"text-base capitalize",children:ne.paymentMethod.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Subscription ID"}),e.jsx("p",{className:"text-sm font-mono",children:ne._id})]})]})})]}),ne.paymentHistory&&ne.paymentHistory.length>0&&e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5"}),"Payment History (",ne.paymentHistory.length,")"]})}),e.jsxs(d,{className:"space-y-3",children:[e.jsx("div",{className:"space-y-4",children:ne.paymentHistory.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()).map((t,s)=>e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-border rounded-lg bg-muted/20",children:[e.jsx("div",{className:"p-2 rounded-lg bg-background border",children:"addon_purchase"===t.type?e.jsx(f,{className:"w-4 h-4 text-orange-600"}):"subscription_purchase"===t.type?e.jsx(g,{className:"w-4 h-4 text-blue-600"}):"renewal"===t.type?e.jsx(z,{className:"w-4 h-4 text-green-600"}):e.jsx(b,{className:"w-4 h-4 text-purple-600"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:"font-semibold text-base text-foreground",children:"addon_purchase"===t.type?`Addon Purchase (${t.addons?.length||0} addon${1!==(t.addons?.length||0)?"s":""})`:"subscription_purchase"===t.type?"Subscription Purchase":"renewal"===t.type?"Subscription Renewal":"Subscription Upgrade"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:new Date(t.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}),"addon_purchase"===t.type&&t.addons&&t.addons.length>0&&e.jsxs("div",{className:"mt-2 p-2 bg-orange-50 border border-orange-200 rounded-md",children:[e.jsx("p",{className:"text-xs font-medium text-orange-800 mb-1",children:"Purchased Addons:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.addons.map((t,s)=>{const a=ne.addons?.find(e=>e._id===t||e._id===t.toString());return e.jsx(o,{variant:"outline",className:"text-xs text-orange-700",children:a?.name||`Addon ${s+1}`},s)})})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx(o,{variant:"addon_purchase"===t.type?"default":"secondary",className:"capitalize text-xs",children:t.type.replace("_"," ")}),t.transactionId&&e.jsxs("p",{className:"text-xs text-muted-foreground font-mono",children:["ID: ",t.transactionId]})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("p",{className:"font-semibold text-lg text-foreground",children:["INR"===ne.currency?"₹":"$",t.amount]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.paymentMethod?.replace("_"," ")||"razorpay"})]})]})})]},t._id||s))}),e.jsx("div",{className:"mt-4 p-4 bg-green-50/50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900",children:"Total Payments"}),e.jsxs("p",{className:"text-sm text-green-700",children:[ne.paymentHistory.length," transaction",1!==ne.paymentHistory.length?"s":""]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-green-900",children:["INR"===ne.currency?"₹":"$",ne.paymentHistory.reduce((e,t)=>e+(t.amount||0),0)]}),e.jsx("p",{className:"text-xs text-green-700",children:"total paid"})]})]})})]})]}),e.jsxs(i,{children:[e.jsx(r,{children:e.jsx(l,{children:"Quick Actions"})}),e.jsx(d,{children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:["active"===ne.status&&e.jsxs(n,{variant:"destructive",size:"sm",onClick:()=>{(async e=>{if("active"===e.status)try{await M.cancelSubscription(e._id),ce({title:"Subscription Cancelled",description:`${e.user.name}'s subscription has been cancelled.`}),oe()}catch(t){ce({title:"Error",description:"Failed to cancel subscription. Please try again.",variant:"destructive"})}else ce({title:"Cannot Cancel",description:"Only active subscriptions can be cancelled.",variant:"destructive"})})(ne),le(!1)},children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Cancel Subscription"]}),("expired"===ne.status||"cancelled"===ne.status)&&e.jsxs(n,{variant:"default",size:"sm",onClick:()=>{(async e=>{if("active"!==e.status)try{await M.renewSubscription(e._id),ce({title:"Subscription Renewed",description:`${e.user.name}'s subscription has been renewed.`}),oe()}catch(t){ce({title:"Error",description:"Failed to renew subscription. Please try again.",variant:"destructive"})}else ce({title:"Cannot Renew",description:"Subscription is already active.",variant:"destructive"})})(ne),le(!1)},children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Renew Subscription"]}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>le(!1),children:"Close"})]})})]})]})]})})]})};export{q as default};

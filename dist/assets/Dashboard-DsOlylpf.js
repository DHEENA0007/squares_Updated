import{j as e}from"./ui-DHQhougw.js";import{a1 as s,u as a,E as t,J as r,ae as i,ax as n,aK as l,ay as c,f as o,G as d,Z as m,a as x,e as h,b as u,c as p,d as j,B as v,h as g,aq as f}from"./index-BElMMwCt.js";import{r as N,L as w}from"./router-Bi51YGN-.js";import{c as y}from"./customerDashboardService-DkCmAwNd.js";import{R as b}from"./refresh-cw-lzcy9aSi.js";import{T as C}from"./trending-up-DvP101hW.js";import{C as S}from"./calendar-D4cuQQQ1.js";import"./vendor-eVk5PToZ.js";const k=()=>{const{isConnected:k,lastEvent:P}=s(),{user:q}=a(),[F,M]=N.useState(!0),[A,V]=N.useState(!1),[I,L]=N.useState({propertiesViewed:0,propertiesViewedChange:"Loading...",savedFavorites:0,savedFavoritesChange:"Loading...",activeInquiries:0,activeInquiriesChange:"Loading...",myProperties:0,myPropertiesChange:"Loading..."}),[R,_]=N.useState([]),[E,H]=N.useState([]),[B,T]=N.useState({favoritesCount:0,messagesCount:0,propertiesCount:0,unreadMessages:0}),z=[{title:"Properties Viewed",value:I.propertiesViewed.toString(),change:I.propertiesViewedChange,icon:t,color:"text-blue-500",bgColor:"bg-blue-500/10"},{title:"Saved Favorites",value:I.savedFavorites.toString(),change:I.savedFavoritesChange,icon:r,color:"text-red-500",bgColor:"bg-red-500/10"},{title:"Active Inquiries",value:I.activeInquiries.toString(),change:I.activeInquiriesChange,icon:i,color:"text-green-500",bgColor:"bg-green-500/10"},{title:"My Properties",value:I.myProperties.toString(),change:I.myPropertiesChange,icon:n,color:"text-orange-500",bgColor:"bg-orange-500/10"}],D=N.useCallback(async()=>{try{M(!0);const[e,s,a,t]=await Promise.all([y.getCustomerDashboardData(),y.getRecentActivities(),y.getRecommendedProperties(6),y.getQuickStats()]);if(e.success)e.data.stats&&L(e.data.stats),e.data.recentActivities&&_(e.data.recentActivities),e.data.recommendedProperties&&H(e.data.recommendedProperties),e.data.quickStats&&T(e.data.quickStats);else{_(s),H(a),T(t);const e=await y.getCustomerStats();e&&L(e)}}catch(e){}finally{M(!1)}},[]),$=N.useCallback(async()=>{V(!0),await D(),V(!1)},[D]);N.useEffect(()=>{D()},[D]);const K=N.useCallback(()=>{$()},[$]),Q=N.useCallback(()=>{$()},[$]);l({refreshStats:K,refreshProperties:Q}),c("property_viewed",N.useCallback(e=>{L(e=>({...e,propertiesViewed:e.propertiesViewed+1,propertiesViewedChange:"+1 new view"}))},[])),c("favorite_added",N.useCallback(e=>{L(e=>({...e,savedFavorites:e.savedFavorites+1,savedFavoritesChange:"+1 new favorite"})),T(e=>({...e,favoritesCount:e.favoritesCount+1}))},[])),c("favorite_removed",N.useCallback(e=>{L(e=>({...e,savedFavorites:Math.max(0,e.savedFavorites-1),savedFavoritesChange:"-1 favorite removed"})),T(e=>({...e,favoritesCount:Math.max(0,e.favoritesCount-1)}))},[])),c("property_inquiry",N.useCallback(e=>{L(e=>({...e,activeInquiries:e.activeInquiries+1,activeInquiriesChange:"+1 new inquiry"}))},[])),c("new_message",e=>{T(e=>({...e,messagesCount:e.messagesCount+1,unreadMessages:e.unreadMessages+1}))});return e.jsxs("div",{className:"space-y-6 animate-fade-in-responsive mt-16",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(o,{variant:"outline",size:"sm",onClick:$,disabled:A,className:"btn-responsive touch-friendly",children:[e.jsx(b,{className:"w-4 h-4 mr-2 "+(A?"animate-spin":"")}),e.jsx("span",{className:"hidden sm:inline",children:A?"Refreshing...":"Refresh"}),e.jsx("span",{className:"sm:hidden",children:"â†»"})]})}),e.jsxs("div",{className:"dashboard-header-responsive",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"dashboard-title-responsive",children:["Welcome back",q?.profile?.firstName?`, ${q.profile.firstName}`:"","!"]}),e.jsx("p",{className:"text-body-responsive text-muted-foreground mt-1",children:"Here's what's happening with your property journey"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(w,{to:"/customer/search",children:e.jsxs(o,{className:"btn-responsive w-full sm:w-auto touch-friendly",children:[e.jsx(d,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-responsive-sm",children:"Search Properties"})]})}),e.jsx(w,{to:"/customer/post-property",children:e.jsxs(o,{variant:"outline",className:"btn-responsive w-full sm:w-auto touch-friendly",children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-responsive-sm",children:"Post Property"})]})})]})]}),F&&e.jsx(x,{children:e.jsx(h,{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Loading dashboard data..."})]})})}),!F&&e.jsx("div",{className:"grid-dashboard animate-slide-up-responsive",children:z.map(s=>{const a=s.icon;return e.jsxs(x,{className:"stats-card-responsive hover:shadow-lg transition-shadow reduce-motion",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between pb-2 space-y-0",children:[e.jsx(p,{className:"text-responsive-sm font-medium",children:s.title}),e.jsx("div",{className:`p-2 rounded-lg ${s.bgColor}`,children:e.jsx(a,{className:`w-4 h-4 ${s.color}`})})]}),e.jsxs(h,{children:[e.jsx("div",{className:"stats-value-responsive",children:s.value}),e.jsx("p",{className:"stats-label-responsive mt-1",children:s.change})]})]},s.title)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(x,{className:"lg:col-span-2",children:[e.jsxs(u,{children:[e.jsx(p,{children:"Recent Activity"}),e.jsx(j,{children:"Your latest interactions and searches"})]}),e.jsxs(h,{children:[!F&&R.length>0?e.jsx("div",{className:"space-y-4",children:R.map(s=>{const a=(t=s.icon,{Heart:r,MessageSquare:i,Search:d,Home:n,Edit:C}[t]||C);var t;return e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(a,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.message}),s.property&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.property}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:y.formatTimeAgo(s.time)})]})]},s._id)})}):F?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading activities..."})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(C,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"No recent activity"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start browsing properties to see your activity here"})]}),e.jsx("div",{className:"mt-4",children:e.jsx(o,{variant:"outline",className:"w-full",children:"View All Activity"})})]})]}),e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Quick Actions"}),e.jsx(j,{children:"Frequently used features"})]}),e.jsxs(h,{className:"space-y-3",children:[e.jsx(w,{to:"/customer/favorites",children:e.jsxs(o,{variant:"outline",className:"w-full justify-start",children:[e.jsx(r,{className:"w-4 h-4 mr-2"}),"My Favorites (",B.favoritesCount,")"]})}),e.jsx(w,{to:"/customer/messages",children:e.jsxs(o,{variant:"outline",className:"w-full justify-start",children:[e.jsx(i,{className:"w-4 h-4 mr-2"}),"Messages (",B.messagesCount,")",B.unreadMessages>0&&e.jsx(v,{className:"ml-auto bg-red-500 text-white text-xs px-2 py-1",children:B.unreadMessages})]})}),e.jsx(w,{to:"/customer/my-properties",children:e.jsxs(o,{variant:"outline",className:"w-full justify-start",children:[e.jsx(n,{className:"w-4 h-4 mr-2"}),"My Properties (",B.propertiesCount,")"]})}),e.jsx(w,{to:"/customer/services",children:e.jsxs(o,{variant:"outline",className:"w-full justify-start",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Book Services"]})})]})]})]}),!F&&e.jsxs(x,{children:[e.jsx(u,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Recommended for You"}),e.jsx(j,{children:"Properties matching your preferences"})]}),e.jsx(w,{to:"/customer/search",children:e.jsx(o,{variant:"outline",children:"View All"})})]})}),e.jsx(h,{children:E.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:E.map(s=>e.jsxs("div",{className:"border rounded-lg overflow-hidden hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"aspect-video bg-muted flex items-center justify-center relative",children:[e.jsx(n,{className:"w-12 h-12 text-muted-foreground"}),s.image&&e.jsx("img",{src:s.image,alt:s.title,className:"absolute top-0 left-0 w-full h-full object-fill",onError:e=>{e.currentTarget.style.display="none"}})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-sm line-clamp-1",children:s.title}),e.jsx(o,{size:"sm",variant:"ghost",className:"p-1",children:e.jsx(r,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground mb-2",children:[e.jsx(g,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"line-clamp-1",children:s.location})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-bold text-primary",children:s.price}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(f,{className:"w-3 h-3 text-yellow-400 mr-1"}),e.jsx("span",{className:"text-xs",children:s.rating})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(v,{variant:"outline",className:"text-xs",children:s.propertyType}),e.jsxs("span",{children:[s.bedrooms," BHK"]}),e.jsxs("span",{children:[s.area," sq ft"]})]})]})]},s._id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(n,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"No recommendations available"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Start browsing and marking favorites to get personalized recommendations"}),e.jsx(w,{to:"/customer/search",children:e.jsxs(o,{children:[e.jsx(d,{className:"w-4 h-4 mr-2"}),"Browse Properties"]})})]})})]})]})};export{k as default};

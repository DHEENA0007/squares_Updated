import{j as e}from"./ui-BNZSgpjP.js";import{r as t,L as s}from"./router-D8v2YSKU.js";import{D as a,t as r,bY as n,bw as i,u as o,G as c,f as l,al as d,a as m,e as h,b as u,c as x,q as p,r as f,s as g,v,w as j,ap as y,aq as w,ar as b,B as N,k as R}from"./index-FHRTVVMJ.js";import{r as C}from"./reviewsService-Cl7gaE6b.js";import{R as k,C as S,X as L,Y as P,T as D}from"./generateCategoricalChart-CJE2KGE8.js";import{A,a as q}from"./AreaChart-BAE0B9HY.js";import"./vendor-BxThA0WO.js";const E=a("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);const $=new class{async makeRequest(e,t={}){const s=`https://app.buildhomemartsquares.com/api${e}`,a={headers:{"Content-Type":"application/json",...t.headers},...t},r=localStorage.getItem("token");r&&(a.headers={...a.headers,Authorization:`Bearer ${r}`});try{const e=await fetch(s,a);if(!e.ok){const t=await e.json().catch(()=>({success:!1,message:`HTTP ${e.status}: ${e.statusText}`}));throw new Error(t.message||"An error occurred")}return await e.json()}catch(n){throw n}}async getDashboardData(e={}){try{const t=new URLSearchParams;Object.entries(e).forEach(([e,s])=>{null!=s&&""!==s&&t.append(e,s.toString())});const s="/vendors/dashboard"+(t.toString()?`?${t.toString()}`:""),a=await this.makeRequest(s);return a.success&&a.data?a.data:this.getEmptyDashboardData()}catch(t){return this.getEmptyDashboardData()}}async getVendorStats(e="7d"){try{const s=await this.makeRequest(`/vendors/stats?dateRange=${e}`);if(s.success&&s.data){try{const e=await C.getReviewStats();s.data.averageRating=e.averageRating}catch(t){}return s.data}throw new Error("Failed to fetch vendor stats")}catch(s){let e=0;try{e=(await C.getReviewStats()).averageRating}catch(t){}return{totalProperties:0,totalPropertiesChange:"+0",propertyViews:0,propertyViewsChange:"+0%",unreadMessages:0,totalMessages:0,messagesChange:"0 unread",totalRevenue:0,revenueChange:"+0%",conversionRate:0,conversionChange:"+0%",averageRating:e,phoneCalls:0,phoneCallsChange:"+0%"}}}async getRecentProperties(e=6){try{const t=await this.makeRequest(`/vendors/properties/recent?limit=${e}`);if(t.success&&t.data)return t.data.properties;throw new Error("Failed to fetch recent properties")}catch(t){return[]}}async getRecentLeads(e=10){try{const t=await this.makeRequest(`/vendors/leads/recent?limit=${e}`);if(t.success&&t.data)return t.data.leads;throw new Error("Failed to fetch recent leads")}catch(t){return[]}}async getPerformanceData(e="7d"){try{const t=await this.makeRequest(`/vendors/performance?dateRange=${e}`);if(t.success&&t.data)return t.data.performance;throw new Error("Failed to fetch performance data")}catch(t){return[]}}async getVendorAnalytics(e="30d"){try{const t=await this.makeRequest(`/vendors/analytics?dateRange=${e}`);if(t.success&&t.data)return t.data;throw new Error("Failed to fetch vendor analytics")}catch(t){return{monthlyPerformance:[],leadsBySource:[],propertyPerformance:[],topPerformingAreas:[]}}}async getNotifications(){try{const e=await this.makeRequest("/vendors/notifications");return e.success&&e.data?e.data.notifications:[]}catch(e){return[]}}async getRecentActivities(e=20){try{const t=await this.makeRequest(`/vendors/activities/recent?limit=${e}`);return t.success&&t.data?t.data.activities:[]}catch(t){return[]}}async markNotificationAsRead(e){try{return(await this.makeRequest(`/vendors/notifications/${e}/read`,{method:"PATCH"})).success}catch(t){return!1}}async updateLeadStatus(e,t){try{return!!(await this.makeRequest(`/vendors/leads/${e}/status`,{method:"PATCH",body:JSON.stringify({status:t})})).success&&(r({title:"Success",description:"Lead status updated successfully!"}),!0)}catch(s){const e=s instanceof Error?s.message:"Failed to update lead status";return r({title:"Error",description:e,variant:"destructive"}),!1}}getImageUrl(e){return e?"string"==typeof e?e:e.url||"https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=400&h=300&fit=crop&auto=format":"https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=400&h=300&fit=crop&auto=format"}formatPrice(e,t="₹"){return e>=1e7?`₹${(e/1e7).toFixed(1)} Cr`:e>=1e5?`₹${(e/1e5).toFixed(1)} Lac`:`₹${e.toLocaleString("en-IN")}`}formatPercentageChange(e){const t=e.startsWith("+");return{value:e,isPositive:t}}getStatusColor(e){return{active:"bg-green-500",pending:"bg-yellow-500",sold:"bg-blue-500",rented:"bg-purple-500",inactive:"bg-gray-500",new:"bg-blue-500",contacted:"bg-yellow-500",qualified:"bg-orange-500",converted:"bg-green-500",lost:"bg-red-500"}[e]||"bg-gray-500"}getInterestColor(e){return{high:"text-green-600 bg-green-100 dark:text-green-400 dark:bg-green-900",medium:"text-yellow-600 bg-yellow-100 dark:text-yellow-400 dark:bg-yellow-900",low:"text-red-600 bg-red-100 dark:text-red-400 dark:bg-red-900"}[e]||"text-gray-600 bg-gray-100"}async getEmptyDashboardData(){let e=0;try{e=(await C.getReviewStats()).averageRating}catch(t){}return{stats:{totalProperties:0,totalPropertiesChange:"+0",propertyViews:0,propertyViewsChange:"+0%",unreadMessages:0,totalMessages:0,messagesChange:"0 unread",totalRevenue:0,revenueChange:"+0%",conversionRate:0,conversionChange:"+0%",averageRating:e,phoneCalls:0,phoneCallsChange:"+0%"},recentProperties:[],recentLeads:[],performanceData:[],analytics:{monthlyPerformance:[],leadsBySource:[],propertyPerformance:[],topPerformingAreas:[]},notifications:[]}}},I=()=>{const{user:a}=o(),[C,I]=t.useState("7d"),[V,F]=((e={})=>{const{autoRefresh:s=!0,refreshInterval:a=3e4,enableRealtime:o=!0}=e,{isConnected:c}=n(),l=t.useRef(null),d=t.useRef({}),[m,h]=t.useState({stats:null,recentProperties:[],recentLeads:[],recentActivities:[],performanceData:[],notifications:[],isLoading:!0,error:null,lastUpdated:null}),u=t.useCallback(e=>{h(t=>({...t,...e,lastUpdated:new Date}))},[]),x=t.useCallback(async()=>{try{const e=await $.getVendorStats(d.current.dateRange||"7d");u({stats:e})}catch(Y){u({error:Y instanceof Error?Y.message:"Failed to load stats"})}},[u]),p=t.useCallback(async()=>{try{const e=await $.getRecentProperties(6);u({recentProperties:e})}catch(Y){}},[u]),f=t.useCallback(async()=>{try{const e=await $.getRecentLeads(10);u({recentLeads:e})}catch(Y){}},[u]),g=t.useCallback(async()=>{try{const e=await $.getPerformanceData(d.current.dateRange||"7d");u({performanceData:e})}catch(Y){}},[u]),v=t.useCallback(async()=>{try{const e=await $.getNotifications();u({notifications:e})}catch(Y){}},[u]),j=t.useCallback(async()=>{try{const e=await $.getRecentActivities(20);u({recentActivities:e})}catch(Y){}},[u]),y=t.useCallback(async()=>{u({isLoading:!0,error:null});try{const e=await $.getDashboardData(d.current);u({stats:e.stats,recentProperties:e.recentProperties,recentLeads:e.recentLeads,recentActivities:e.recentActivities||[],performanceData:e.performanceData,notifications:e.notifications,isLoading:!1,error:null})}catch(Y){u({isLoading:!1,error:Y instanceof Error?Y.message:"Failed to load dashboard data"})}},[u]),w=t.useCallback(e=>{d.current={...d.current,...e},y()},[y]),b=t.useCallback(async e=>{try{await $.markNotificationAsRead(e)&&u({notifications:m.notifications.map(t=>t.id===e?{...t,isRead:!0}:t)})}catch(Y){r({title:"Error",description:"Failed to mark notification as read",variant:"destructive"})}},[m.notifications,u]),N=t.useCallback(async(e,t)=>{try{await $.updateLeadStatus(e,t)&&(u({recentLeads:m.recentLeads.map(s=>s._id===e?{...s,status:t,updatedAt:(new Date).toISOString()}:s)}),x())}catch(Y){}},[m.recentLeads,u,x]);return t.useEffect(()=>{if(!o||!c)return;const e=i.on("vendor:activities_updated",e=>{e.activities&&u({recentActivities:e.activities,lastUpdated:new Date})}),t=i.on("vendor:leads_updated",e=>{e.leads&&u({recentLeads:e.leads,lastUpdated:new Date})}),s=i.on("vendor:property_updated",e=>{p(),x()}),a=i.on("vendor:new_inquiry",e=>{f(),j(),r({title:"New Inquiry",description:`New inquiry from ${e.customerName||"a customer"}`})});return()=>{e(),t(),s(),a()}},[o,c,u,p,x,f,j]),t.useEffect(()=>{if(s&&a>0)return l.current=setInterval(()=>{h(e=>(e.isLoading||y(),e))},a),()=>{l.current&&clearInterval(l.current)}},[s,a,y]),t.useEffect(()=>{y()},[y]),t.useEffect(()=>()=>{l.current&&clearInterval(l.current)},[]),[m,{refreshData:y,refreshStats:x,refreshProperties:p,refreshLeads:f,refreshActivities:j,refreshPerformance:g,refreshNotifications:v,updateFilters:w,markNotificationAsRead:b,updateLeadStatus:N}]})({autoRefresh:!0,refreshInterval:3e4,enableRealtime:!0}),{stats:U,recentProperties:T,recentLeads:_,performanceData:z,notifications:M,isLoading:O,error:Y}=V,[B,H]=t.useState(0),W=T.filter(e=>e.images&&e.images.length>0);t.useEffect(()=>{if(W.length>1){const e=setInterval(()=>{H(e=>(e+1)%W.length)},4e3);return()=>clearInterval(e)}},[W.length]);const{refreshData:G,updateFilters:K}=F;t.useEffect(()=>{K({dateRange:C})},[C,K]);const J=()=>{G(),r({title:"Dashboard Refreshed",description:"Latest data loaded successfully."})};if(O&&!U)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(c,{className:"h-8 w-8 animate-spin text-primary"})});if(Y&&!U)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen gap-4",children:[e.jsx("p",{className:"text-destructive",children:Y}),e.jsxs(l,{onClick:J,children:[e.jsx(d,{className:"mr-2 h-4 w-4"})," Try Again"]})]});const X=z;return e.jsx("div",{className:"p-6 space-y-8 max-w-[1600px] mx-auto",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-3xl bg-gradient-to-r from-[#1a1f3c] to-[#2d325a] text-white p-8 md:p-12 shadow-lg",children:[e.jsx("div",{className:"relative z-10 max-w-lg",children:e.jsxs("h2",{className:"text-3xl md:text-4xl font-bold mb-4 leading-tight",children:["Your Real Estate Success",e.jsx("br",{}),"is All Yours."]})}),e.jsx("div",{className:"absolute right-0 bottom-0 w-1/2 h-full hidden md:block",children:W.length>0?e.jsx("div",{className:"absolute right-[-50px] bottom-[-50px] w-[400px] h-[400px] rounded-full border-8 border-white/10 shadow-2xl transform rotate-[-10deg] overflow-hidden bg-background",children:W.map((t,a)=>e.jsx(s,{to:`/vendor/properties/edit/${t._id}`,className:"absolute inset-0 transition-opacity duration-1000 "+(a===B?"opacity-100 z-10":"opacity-0 z-0"),title:`View ${t.title}`,children:e.jsx("img",{src:$.getImageUrl(t.images[0]),alt:t.title,className:"w-full h-full object-cover cursor-pointer hover:scale-110 transition-transform duration-700"})},t._id))}):e.jsx("img",{src:"https://images.unsplash.com/photo-1568605114967-8130f3a36994?auto=format&fit=crop&w=800&q=80",alt:"House",className:"absolute right-[-50px] bottom-[-50px] w-[400px] h-[400px] object-cover rounded-full border-8 border-white/10 shadow-2xl transform rotate-[-10deg]"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(m,{className:"bg-card border-none shadow-sm rounded-2xl",children:e.jsxs(h,{className:"p-6",children:[e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsx("div",{className:"p-2 bg-primary/10 rounded-full",children:e.jsx("div",{className:"text-xs font-semibold text-primary",children:"Total Revenue"})})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-3xl font-bold",children:$.formatPrice(U?.totalRevenue||0)}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsxs("span",{className:"font-medium flex items-center "+(U?.revenueChange?.startsWith("+")?"text-green-500":"text-red-500"),children:[U?.revenueChange||"0%"," ",e.jsx(E,{className:"h-4 w-4 ml-1"})]}),e.jsx("span",{className:"text-muted-foreground ml-2",children:"From last period"})]})]})]})}),e.jsx(m,{className:"bg-card border-none shadow-sm rounded-2xl",children:e.jsxs(h,{className:"p-6",children:[e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsx("div",{className:"p-2 bg-orange-500/10 rounded-full",children:e.jsx("div",{className:"text-xs font-semibold text-orange-600",children:"Total Views"})})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-3xl font-bold",children:U?.propertyViews||0}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsxs("span",{className:"font-medium flex items-center "+(U?.propertyViewsChange?.startsWith("+")?"text-green-500":"text-red-500"),children:[U?.propertyViewsChange||"0%"," ",e.jsx(E,{className:"h-4 w-4 ml-1"})]}),e.jsx("span",{className:"text-muted-foreground ml-2",children:"From last period"})]})]})]})})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs(m,{className:"h-full border-none shadow-sm rounded-2xl",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs("div",{children:[e.jsx(x,{className:"text-lg font-bold",children:"Performance Overview"}),e.jsx("div",{className:"flex items-center gap-4 mt-2 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"}),e.jsx("span",{className:"text-muted-foreground",children:"Views"})]})})]}),e.jsxs(p,{value:C,onValueChange:I,children:[e.jsx(f,{className:"w-[120px] rounded-full h-8 text-xs",children:e.jsx(g,{placeholder:"Select range"})}),e.jsxs(v,{children:[e.jsx(j,{value:"7d",children:"Last 7 Days"}),e.jsx(j,{value:"30d",children:"Last 30 Days"}),e.jsx(j,{value:"90d",children:"Last 90 Days"})]})]})]}),e.jsx(h,{children:e.jsx("div",{className:"h-[250px] w-full",children:X.length>0?e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(A,{data:X,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorViews",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"hsl(var(--primary))",stopOpacity:.1}),e.jsx("stop",{offset:"95%",stopColor:"hsl(var(--primary))",stopOpacity:0})]})}),e.jsx(S,{strokeDasharray:"3 3",vertical:!1,stroke:"hsl(var(--border))"}),e.jsx(L,{dataKey:"date",axisLine:!1,tickLine:!1,tick:{fill:"hsl(var(--muted-foreground))",fontSize:12},dy:10}),e.jsx(P,{axisLine:!1,tickLine:!1,tick:{fill:"hsl(var(--muted-foreground))",fontSize:12}}),e.jsx(D,{contentStyle:{borderRadius:"12px",border:"none",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"}}),e.jsx(q,{type:"monotone",dataKey:"views",stroke:"hsl(var(--primary))",strokeWidth:3,fillOpacity:1,fill:"url(#colorViews)"})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"No performance data available"})})})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Recent Inquiries"}),e.jsx(l,{variant:"ghost",className:"text-sm text-muted-foreground",asChild:!0,children:e.jsx(s,{to:"/vendor/messages",children:"View All"})})]}),e.jsx("div",{className:"bg-card rounded-2xl shadow-sm overflow-hidden border border-border/50",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border/50 bg-muted/30",children:[e.jsx("th",{className:"text-left p-4 text-sm font-medium text-muted-foreground",children:"Customer"}),e.jsx("th",{className:"text-left p-4 text-sm font-medium text-muted-foreground",children:"Contact"}),e.jsx("th",{className:"text-left p-4 text-sm font-medium text-muted-foreground",children:"Property"}),e.jsx("th",{className:"text-left p-4 text-sm font-medium text-muted-foreground",children:"Date"}),e.jsx("th",{className:"text-left p-4 text-sm font-medium text-muted-foreground",children:"Status"})]})}),e.jsx("tbody",{children:_.length>0?_.map((t,s)=>e.jsxs("tr",{className:"group hover:bg-muted/50 transition-colors border-b border-border/50 last:border-0",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(y,{className:"h-8 w-8",children:[e.jsx(w,{src:`https://api.dicebear.com/7.x/avataaars/svg?seed=${t.email||s}`}),e.jsx(b,{children:t.name?.[0]||"U"})]}),e.jsx("span",{className:"font-medium",children:t.name||"Unknown User"})]})}),e.jsx("td",{className:"p-4 text-sm text-muted-foreground",children:t.email||t.phone||"No contact info"}),e.jsx("td",{className:"p-4 text-sm truncate max-w-[150px]",children:t.propertyTitle||"General Inquiry"}),e.jsx("td",{className:"p-4 text-sm font-medium",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"p-4",children:e.jsx(N,{variant:"secondary",className:"border-none "+("new"===t.status?"bg-blue-100 text-blue-700":"contacted"===t.status?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"),children:t.status||"new"})})]},t._id||s)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-8 text-center text-muted-foreground",children:"No recent inquiries found."})})})]})})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Your Properties"}),e.jsx(s,{to:"/vendor/properties",className:"text-sm text-primary hover:underline",children:"See All"})]}),e.jsx("div",{className:"space-y-4",children:T.length>0?T.slice(0,3).map((t,s)=>e.jsxs(m,{className:"overflow-hidden border-none shadow-sm rounded-2xl group cursor-pointer hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"relative h-48",children:e.jsx("img",{src:$.getImageUrl(t.images?.[0]),alt:t.title,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105",onError:e=>{e.target.src="https://images.unsplash.com/photo-1600596542815-e32cb141d3ad?auto=format&fit=crop&w=600&q=80"}})}),e.jsxs(h,{className:"p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(N,{className:`border-none shadow-sm font-medium ${$.getStatusColor(t.status)} text-white`,children:t.status})}),e.jsx("h4",{className:"font-bold text-lg mb-1 truncate",title:t.title,children:t.title}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-3 truncate",title:t.location,children:[e.jsx(R,{className:"inline h-3 w-3 mr-1"}),t.location]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xl font-bold text-primary",children:$.formatPrice(t.price)}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.views||0," views"]})]})]})]},t._id||s)):e.jsxs("div",{className:"text-center py-8 text-muted-foreground bg-muted/30 rounded-2xl",children:[e.jsx("p",{children:"No properties listed yet."}),e.jsx(l,{variant:"link",asChild:!0,children:e.jsx(s,{to:"/vendor/properties/add",children:"Add your first property"})})]})})]})]})})};export{I as default};

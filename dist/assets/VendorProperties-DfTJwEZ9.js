import{j as e}from"./ui-BHyUY8Z8.js";import{r as l,R as ie,h as ne,L as v}from"./router-2SVJvIbS.js";import{W as ce,J as de,K as oe,O as me,Q as ue,R as xe,B as g,L as w,C as he,f as m,Y as ae,I as le,s as q,v as G,w as H,x as W,y as r,q as je,ap as ge,az as d,V as J,a as h,e as j,aM as K,E as U,U as Y,at as X,h as fe,a5 as pe,a6 as Ne,a7 as ve,a8 as L,T as Z,t as Q}from"./index-Bd1eLXM_.js";import{A as ee,a as se}from"./alert-DQvV8n_v.js";import{u as we}from"./userService-CKE-Zb2D.js";import{C as be}from"./circle-alert--1esrBFY.js";import{C as Se}from"./camera-B-Udk_6_.js";import{E as ye}from"./ellipsis-vertical-DFQbPQww.js";import{P as te}from"./pen-line-D_6gHzXx.js";import{T as Ce}from"./trash-2-DTVLnEp9.js";import{C as Pe}from"./calendar-5Rt0tQ5m.js";import"./vendor-Dazix4UH.js";const Te=({property:a,open:c,onOpenChange:f,onUpdateStatus:x})=>{const{toast:b}=ce(),[i,D]=l.useState(""),[S,y]=l.useState(""),[C,F]=l.useState(!1),[p,P]=l.useState(""),[_,B]=l.useState([]),[N,k]=l.useState(!1),[A,M]=l.useState(""),o=a?.status==="active",n=(()=>{if(!a)return null;const t=a.listingType||"sale";return t==="sale"?{value:"sold",label:"Mark as Sold",color:"bg-blue-500"}:t==="rent"?{value:"rented",label:"Mark as Rented",color:"bg-purple-500"}:t==="lease"?{value:"leased",label:"Mark as Leased",color:"bg-indigo-500"}:null})();l.useEffect(()=>{c&&o&&n&&$()},[c]);const $=async()=>{try{k(!0),console.log("[PropertyStatusDialog] Loading customers with role: customer");const t=await we.getUsers({role:"customer",limit:100,status:"active"});console.log("[PropertyStatusDialog] Customer response:",t),t.success&&t.data?.users?(console.log(`[PropertyStatusDialog] Loaded ${t.data.users.length} customers`),B(t.data.users)):(console.error("[PropertyStatusDialog] Invalid response structure:",t),b({title:"Warning",description:"Failed to load customers properly.",variant:"default"}))}catch(t){console.error("[PropertyStatusDialog] Failed to load customers:",t),b({title:"Error",description:"Failed to load customers.",variant:"destructive"})}finally{k(!1)}},V=_.filter(t=>{const u=A.toLowerCase(),I=`${t.profile?.firstName||""} ${t.profile?.lastName||""}`.toLowerCase(),O=t.email?.toLowerCase()||"",re=t.profile?.phone||"";return I.includes(u)||O.includes(u)||re.includes(u)});ie.useEffect(()=>{a&&c&&(D(""),y(""),P(""),M(""))},[a,c]);const E=()=>{n&&D(n.value)},z=async()=>{if(!(!a||!i)){if(!p){b({title:"Customer Required",description:`Please select a customer to assign this ${i} property to.`,variant:"destructive"});return}F(!0);try{await x(a._id,i,p,S.trim()||void 0),f(!1)}catch(t){console.error("Failed to update status:",t)}finally{F(!1)}}},R=t=>{switch(t){case"active":return"bg-green-500";case"pending":return"bg-yellow-500";case"sold":return"bg-blue-500";case"rented":return"bg-purple-500";case"leased":return"bg-indigo-500";case"rejected":return"bg-red-500";default:return"bg-gray-500"}},s=t=>{switch(t){case"active":return"Active";case"pending":return"Pending Approval";case"sold":return"Sold";case"rented":return"Rented";case"leased":return"Leased";case"rejected":return"Rejected";default:return t.charAt(0).toUpperCase()+t.slice(1)}};return e.jsx(de,{open:c,onOpenChange:f,children:e.jsxs(oe,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(me,{children:[e.jsx(ue,{children:"Update Property Status"}),e.jsx(xe,{children:a?.title}),a?.listingType&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Listing Type: ",e.jsx(g,{variant:"outline",className:"ml-1",children:a.listingType})]})]}),"        ",e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Current Status"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(g,{className:`${R(a?.status||"")} text-white`,children:s(a?.status||"")})})]}),!o&&e.jsxs(ee,{children:[e.jsx(be,{className:"h-4 w-4"}),e.jsxs(se,{children:["This property is not yet approved by admin. You can only update the status to ",n?.label.toLowerCase()," after admin approval."]})]}),a?.status==="sold"||a?.status==="rented"||a?.status==="leased"?e.jsxs(ee,{children:[e.jsx(he,{className:"h-4 w-4"}),e.jsxs(se,{children:["This property has already been marked as ",s(a.status).toLowerCase(),"."]})]}):i===""?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Action"}),e.jsx(m,{onClick:E,disabled:!o||!n,className:`w-full ${n?.color||"bg-primary"} hover:opacity-90 text-white`,size:"lg",children:n?.label||"Update Status"}),!o&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Button will be enabled once admin approves your property"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"customer-search",children:"Search Customer"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(le,{id:"customer-search",placeholder:"Search by name, email, or phone...",value:A,onChange:t=>M(t.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"customer-select",children:"Assign To Customer *"}),N?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading customers..."}):e.jsxs(q,{value:p,onValueChange:P,children:[e.jsx(G,{children:e.jsx(H,{placeholder:"Select customer who bought/rented this property"})}),e.jsx(W,{children:V.length===0?e.jsx("div",{className:"p-2 text-sm text-muted-foreground text-center",children:A?"No customers found":"No customers available"}):V.map(t=>e.jsx(r,{value:t._id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-medium",children:[t.profile?.firstName," ",t.profile?.lastName]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.email," ",t.profile?.phone&&`• ${t.profile.phone}`]})]})},t._id))})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This property will be added to the selected customer's portfolio"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"reason",children:"Additional Notes (Optional)"}),e.jsx(je,{id:"reason",placeholder:"Add any notes about this transaction...",value:S,onChange:t=>y(t.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Status Change Preview"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:`${R(a?.status||"")} text-white`,children:s(a?.status||"")}),e.jsx("span",{className:"text-muted-foreground",children:"→"}),e.jsx(g,{className:`${n?.color||"bg-gray-500"} text-white`,children:s(i)})]})]})]})]}),e.jsxs(ge,{children:[e.jsx(m,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),i&&e.jsx(m,{onClick:z,disabled:C||!p,className:`${n?.color||"bg-primary"} hover:opacity-90 text-white`,children:C?"Updating...":`Confirm ${n?.label}`})]})]})})},Be=()=>{const[a]=ne(),[c,f]=l.useState(a.get("search")||""),[x,b]=l.useState("all"),[i,D]=l.useState("all"),[S,y]=l.useState(!0),[C,F]=l.useState([]),[p,P]=l.useState(!1),[_,B]=l.useState(null),[N,k]=l.useState({totalProperties:0,totalViews:0,totalLeads:0,averageRating:0}),[A,M]=l.useState({currentPage:1,totalPages:1,totalProperties:0,hasNextPage:!1,hasPrevPage:!1});l.useEffect(()=>{o(),T()},[]),l.useEffect(()=>{const s=a.get("search");s&&f(s)},[a]),l.useEffect(()=>{o()},[c,x,i]);const o=async()=>{try{y(!0);const s={page:1,limit:10,...c&&{search:c},...x!=="all"&&{status:x},...i!=="all"&&{propertyType:i}},t=await d.getVendorProperties(s);F(t.data.properties),M(t.data.pagination)}catch(s){console.error("Failed to load properties:",s)}finally{y(!1)}},T=async()=>{try{const s=await d.getVendorPropertyStats();k(s)}catch(s){console.error("Failed to load stats:",s)}},n=async s=>{if(window.confirm("Are you sure you want to delete this property?"))try{await d.deleteProperty(s),o(),T()}catch(t){console.error("Failed to delete property:",t)}},$=async(s,t)=>{try{await d.togglePropertyFeatured(s,!t),o(),T()}catch(u){console.error("Failed to toggle featured status:",u)}},V=async(s,t,u,I)=>{try{u&&(t==="sold"||t==="rented"||t==="leased")?(await d.assignPropertyToCustomer(s,u,t,I),Q({title:"Success",description:`Property ${t} and assigned to customer successfully!`})):(await d.togglePropertyStatus(s,t),Q({title:"Success",description:`Property status updated to ${t}!`})),o(),T()}catch(O){console.error("Failed to update property status:",O),Q({title:"Error",description:"Failed to update property status",variant:"destructive"})}},E=s=>{B(s),P(!0)},z=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),R=s=>{const t=[];return s.address.locationName&&t.push(s.address.locationName),s.address.city&&t.push(s.address.city),s.address.state&&t.push(s.address.state),t.join(", ")||"Location not specified"};return S?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading properties..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"My Properties"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage and track your property listings"})]}),e.jsx(v,{to:"/vendor/properties/add",children:e.jsxs(m,{children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Add Property"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(h,{children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Properties"}),e.jsx("p",{className:"text-2xl font-bold",children:N.totalProperties})]}),e.jsx(K,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(h,{children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Views"}),e.jsx("p",{className:"text-2xl font-bold",children:N.totalViews.toLocaleString()})]}),e.jsx(U,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(h,{children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Leads"}),e.jsx("p",{className:"text-2xl font-bold",children:N.totalLeads})]}),e.jsx(Y,{className:"h-8 w-8 text-purple-600"})]})})}),e.jsx(h,{children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Avg. Rating"}),e.jsx("p",{className:"text-2xl font-bold",children:N.averageRating.toFixed(1)})]}),e.jsx(X,{className:"h-8 w-8 text-orange-600"})]})})})]}),e.jsx(h,{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(le,{placeholder:"Search properties...",value:c,onChange:s=>f(s.target.value),className:"pl-10"})]}),e.jsxs(q,{value:x,onValueChange:b,children:[e.jsx(G,{className:"w-full sm:w-40",children:e.jsx(H,{placeholder:"Status"})}),e.jsxs(W,{children:[e.jsx(r,{value:"all",children:"All Status"}),e.jsx(r,{value:"available",children:"Available"}),e.jsx(r,{value:"pending",children:"Pending"}),e.jsx(r,{value:"sold",children:"Sold"}),e.jsx(r,{value:"rented",children:"Rented"})]})]}),e.jsxs(q,{value:i,onValueChange:D,children:[e.jsx(G,{className:"w-full sm:w-40",children:e.jsx(H,{placeholder:"Type"})}),e.jsxs(W,{children:[e.jsx(r,{value:"all",children:"All Types"}),e.jsx(r,{value:"apartment",children:"Apartment"}),e.jsx(r,{value:"house",children:"House"}),e.jsx(r,{value:"villa",children:"Villa"}),e.jsx(r,{value:"plot",children:"Plot"}),e.jsx(r,{value:"land",children:"Land"}),e.jsx(r,{value:"commercial",children:"Commercial"}),e.jsx(r,{value:"office",children:"Office"}),e.jsx(r,{value:"pg",children:"PG (Paying Guest)"})]})]})]})})}),e.jsx("div",{className:"space-y-4",children:C.map(s=>e.jsx(h,{className:"overflow-hidden",children:e.jsx(j,{className:"p-0",children:e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[e.jsxs("div",{className:"lg:w-64 h-48 lg:h-auto bg-muted relative",children:[s.images&&s.images.length>0?e.jsx("img",{src:d.getPrimaryImage(s),alt:s.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/20 to-transparent flex items-center justify-center",children:e.jsx(Se,{className:"w-12 h-12 text-muted-foreground"})}),e.jsxs("div",{className:"absolute top-3 left-3 flex gap-2",children:[e.jsx(g,{className:`${d.getStatusColor(s.status)} text-white`,children:d.getStatusText(s.status)}),s.featured&&e.jsx(g,{variant:"secondary",children:"Featured"}),s.verified&&e.jsx(g,{className:"bg-green-600 text-white",children:"Verified"})]}),s.images&&s.images.length>0&&e.jsxs("div",{className:"absolute bottom-3 left-3 bg-black/70 text-white px-2 py-1 rounded text-sm",children:[s.images.length," ",s.images.length===1?"photo":"photos"]})]}),e.jsxs("div",{className:"flex-1 p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-1",children:s.title}),e.jsxs("p",{className:"text-muted-foreground flex items-center mb-2",children:[e.jsx(fe,{className:"w-4 h-4 mr-1"}),R(s)]}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:d.formatPrice(s.price,s.listingType)})]}),e.jsxs(pe,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",children:e.jsx(ye,{className:"w-4 h-4"})})}),e.jsxs(ve,{align:"end",children:[e.jsx(L,{asChild:!0,children:e.jsxs(v,{to:`/vendor/properties/details/${s._id}`,children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"View Details"]})}),e.jsx(L,{asChild:!0,children:e.jsxs(v,{to:`/vendor/properties/edit/${s._id}`,children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Edit Property"]})}),e.jsxs(L,{onClick:()=>$(s._id,s.featured),children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),s.featured?"Unfeature":"Promote"]}),s.status==="active"&&e.jsxs(L,{onClick:()=>E(s),children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),s.listingType==="sale"?"Mark as Sold":s.listingType==="rent"?"Mark as Rented":"Mark as Leased"]}),e.jsxs(L,{className:"text-red-600",onClick:()=>n(s._id),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[s.bedrooms>0&&e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Bedrooms"}),e.jsx("p",{className:"font-semibold",children:s.bedrooms})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Bathrooms"}),e.jsx("p",{className:"font-semibold",children:s.bathrooms})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Area"}),e.jsx("p",{className:"font-semibold",children:d.formatArea(s.area)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Type"}),e.jsx("p",{className:"font-semibold capitalize",children:s.type})]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground mb-4",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(U,{className:"w-4 h-4 mr-1"}),s.views," views"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(Y,{className:"w-4 h-4 mr-1"}),"0 leads"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(X,{className:"w-4 h-4 mr-1"}),"0 favorites"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(Pe,{className:"w-4 h-4 mr-1"}),"Listed ",z(s.createdAt)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{to:`/vendor/properties/details/${s._id}`,children:e.jsxs(m,{size:"sm",variant:"outline",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"View Details"]})}),e.jsx(v,{to:`/vendor/properties/edit/${s._id}`,children:e.jsxs(m,{size:"sm",variant:"outline",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Edit"]})}),e.jsxs(m,{size:"sm",onClick:()=>$(s._id,s.featured),children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),s.featured?"Unfeature":"Promote"]}),s.status==="active"&&e.jsx(m,{size:"sm",variant:"outline",onClick:()=>E(s),children:s.listingType==="sale"?"Mark as Sold":s.listingType==="rent"?"Mark as Rented":"Mark as Leased"})]})]})]})})},s._id))}),C.length===0&&!S&&e.jsx(h,{children:e.jsxs(j,{className:"p-12 text-center",children:[e.jsx(K,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No properties found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:c||x!=="all"||i!=="all"?"No properties match your search criteria":"You haven't added any properties yet"}),e.jsx(v,{to:"/vendor/properties/add",children:e.jsxs(m,{children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Add Your First Property"]})})]})}),e.jsx(Te,{property:_,open:p,onOpenChange:P,onUpdateStatus:V})]})};export{Be as default};

import{j as e}from"./ui-BNZSgpjP.js";import{r as s,d as a,h as t}from"./router-D8v2YSKU.js";import{a2 as l,aO as r,a as i,e as n,$ as c,I as d,q as m,r as o,s as x,v as p,w as h,L as u,f,G as j,J as g,a1 as y,B as v,k as N,aM as b,aN as w,a3 as S}from"./index-R8qjqeWQ.js";import{C as T}from"./checkbox-Byyu4Js_.js";import{f as C}from"./favoriteService-B0u2ffej.js";import{S as F}from"./square-6ycUdNaZ.js";import"./vendor-BxThA0WO.js";const k=()=>{const[k,A]=s.useState([]),[P,_]=s.useState([]),[$,L]=s.useState([]),M=a(),{toast:E}=l(),[V]=t(),[q,O]=s.useState([]),[z,R]=s.useState(!0),[U,B]=s.useState(""),[I,D]=s.useState("all"),[G,J]=s.useState("all"),[W,H]=s.useState([0,2e7]),[K,Q]=s.useState([0,1e4]),[X,Y]=s.useState([]),[Z,ee]=s.useState({}),[se,ae]=s.useState(1),[te,le]=s.useState(1),[re,ie]=s.useState(new Set),ne=e=>P.filter(s=>s.filterType===e&&s.isActive).sort((e,s)=>e.displayOrder-s.displayOrder),ce=s.useMemo(()=>Array.from(new Set(P.map(e=>e.filterType))),[P]),[de,me]=s.useState({min:0,max:5e7}),[oe,xe]=s.useState({min:0,max:1e4}),[pe,he]=s.useState([]);s.useEffect(()=>{(async()=>{try{const[e,s,a]=await Promise.all([S.getAllPropertyTypes(!1),S.getAllFilterConfigurations(!1),S.getFilterDependencies()]);A(e),_(s),he(a);const t=s.filter(e=>"budget"===e.filterType);if(t.length>0){const e=Math.min(...t.map(e=>e.minValue||0)),s=Math.max(...t.map(e=>e.maxValue||0));s>0&&(me({min:e,max:s}),H([e,s]))}const l=s.filter(e=>"area"===e.filterType);if(l.length>0){const e=Math.min(...l.map(e=>e.minValue||0)),s=Math.max(...l.map(e=>e.maxValue||0));s>0&&(xe({min:e,max:s}),Q([e,s]))}}catch(e){}})()},[]);s.useEffect(()=>{k.length>0&&(async()=>{try{if("all"===G){const e=await S.getAllAmenities(!1);L(e)}else{const e=k.find(e=>e.value===G);if(e){const s=await S.getPropertyTypeAmenities(e._id);L(s)}else L([])}}catch(e){L([])}})()},[G,k]),s.useEffect(()=>{const e=V.get("q"),s=V.get("listingType"),a=V.get("propertyType");e&&B(e),s&&"all"!==s&&D(s),a&&"all"!==a&&J(a),ae(1)},[V]),s.useEffect(()=>{ue()},[U,I,G,W,K,X,Z,se]);const ue=async()=>{R(!0);try{const e={page:se,limit:12};U.trim()&&(e.search=U),"all"!==I&&(e.listingType=I),"all"!==G&&(e.propertyType=G),Object.entries(Z).forEach(([s,a])=>{a&&"any"!==a&&(e[s]=a)}),W[0]>de.min&&(e.minPrice=W[0]),W[1]<de.max&&(e.maxPrice=W[1]),K[0]>oe.min&&(e.minArea=K[0]),K[1]<oe.max&&(e.maxArea=K[1]),X.length>0&&(e.amenities=X);const s=await r.getProperties(e);s.success&&(O(s.data.properties),le(s.data.pagination.totalPages))}catch(e){E({title:"Error",description:"Failed to load properties",variant:"destructive"})}finally{R(!1)}};s.useEffect(()=>{fe()},[]);const fe=async()=>{try{const e=await C.getFavorites();if(e.success){const s=new Set(e.data.favorites.map(e=>e.property?._id).filter(Boolean));ie(s)}}catch(e){}},je=()=>{B(""),D("all"),J("all"),H([de.min,de.max]),Q([oe.min,oe.max]),Y([]),ee({}),ae(1)},ge=e=>{const s=P.find(s=>s.value===e&&("listing_type"===s.filterType||"listingType"===s.filterType));return s?s.displayLabel||s.name:e.charAt(0).toUpperCase()+e.slice(1)},ye=e=>e>=1e7?`₹${(e/1e7).toFixed(2)} Cr`:e>=1e5?`₹${(e/1e5).toFixed(2)} L`:`₹${e.toLocaleString()}`;return e.jsxs("div",{className:"min-h-screen",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary/10 to-primary/5 border-b",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Search Properties"}),e.jsx("p",{className:"text-muted-foreground",children:"Find your dream property from our verified listings"})]})}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("aside",{className:"lg:w-80 flex-shrink-0",children:e.jsx(i,{className:"sticky top-20 max-h-[calc(100vh-6rem)] overflow-y-auto",children:e.jsxs(n,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Filters"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(d,{placeholder:"Location, property name...",value:U,onChange:e=>B(e.target.value),className:"pl-10"})]})]}),ne("listing_type").length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Listing Type"}),e.jsxs(m,{value:I,onValueChange:D,children:[e.jsx(o,{children:e.jsx(x,{placeholder:"Type"})}),e.jsxs(p,{className:"max-h-[300px] overflow-y-auto",children:[e.jsx(h,{value:"all",children:"All Types"}),ne("listing_type").map(s=>e.jsx(h,{value:s.value,children:s.displayLabel?.trim()||s.name},s._id))]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Property Type"}),e.jsxs(m,{value:G,onValueChange:e=>{J(e),ee({}),Y([])},children:[e.jsx(o,{children:e.jsx(x,{placeholder:"Property"})}),e.jsxs(p,{className:"max-h-[300px] overflow-y-auto",children:[e.jsx(h,{value:"all",children:"All Properties"}),k.map(s=>e.jsx(h,{value:s.value,children:s.name},s.value))]})]})]}),ce.filter(e=>!["listing_type","budget","area"].includes(e)).filter(e=>(e=>{const s=pe.find(s=>s.targetFilterType===e);if(!s)return!0;let a;return a="property_type"===s.sourceFilterType?G:"listing_type"===s.sourceFilterType?I:Z[s.sourceFilterType],!(!a||"all"===a||"any"===a)&&s.sourceFilterValues.includes(a)})(e)).map(s=>{const a=P.filter(e=>e.filterType===s).sort((e,s)=>e.displayOrder-s.displayOrder);if(0===a.length)return null;const t=s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase());return e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:t}),e.jsxs(m,{value:Z[s]||"any",onValueChange:e=>{ee(a=>({...a,[s]:e}))},children:[e.jsx(o,{children:e.jsx(x,{placeholder:`Select ${t}`})}),e.jsxs(p,{children:[e.jsxs(h,{value:"any",children:["Any ",t]}),a.map(s=>e.jsx(h,{value:s.value,children:s.displayLabel||s.name},s.id||s._id))]})]})]},s)}),de.max>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Price Range"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Min Price"}),e.jsx(d,{type:"number",value:W[0],onChange:e=>H([Number(e.target.value),W[1]]),min:de.min,max:de.max,className:"w-full"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:ye(W[0])})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Max Price"}),e.jsx(d,{type:"number",value:W[1],onChange:e=>H([W[0],Number(e.target.value)]),min:de.min,max:de.max,className:"w-full"}),e.jsx("div",{className:"text-xs text-muted-foreground text-right",children:ye(W[1])})]})]})]}),oe.max>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Area (sq ft)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Min Area"}),e.jsx(d,{type:"number",value:K[0],onChange:e=>Q([Number(e.target.value),K[1]]),min:oe.min,max:oe.max,className:"w-full"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[K[0]," sqft"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Max Area"}),e.jsx(d,{type:"number",value:K[1],onChange:e=>Q([K[0],Number(e.target.value)]),min:oe.min,max:oe.max,className:"w-full"}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[K[1]," sqft"]})]})]})]}),$.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Amenities"}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2 border rounded-md p-3",children:$.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:s._id,checked:X.includes(s.name),onCheckedChange:e=>{Y(e?[...X,s.name]:X.filter(e=>e!==s.name))}}),e.jsx("label",{htmlFor:s._id,className:"text-sm font-normal cursor-pointer leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:s.name})]},s._id))}),X.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:[X.length," selected"]})]}),e.jsx(f,{variant:"outline",onClick:je,className:"w-full",children:"Reset Filters"})]})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Available Properties"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:z?"Loading...":`${q.length} properties found`})]}),z?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(j,{className:"h-8 w-8 animate-spin text-primary"})}):0===q.length?e.jsx(i,{children:e.jsxs(n,{className:"p-12 text-center",children:[e.jsx(g,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No properties found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Try adjusting your filters or search criteria"}),e.jsx(f,{onClick:je,children:"Clear Filters"})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:q.map(s=>e.jsxs(i,{className:"overflow-hidden hover:shadow-lg transition-shadow cursor-pointer",children:[e.jsxs("div",{className:"relative h-48 bg-muted",onClick:()=>M(`/property/${s._id}`),children:[s.images&&s.images.length>0?e.jsx("img",{src:"string"==typeof s.images[0]?s.images[0]:s.images[0]?.url,alt:s.title,className:"w-full h-full object-cover",onError:e=>{e.target.src="/placeholder-property.jpg"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(g,{className:"h-12 w-12 text-muted-foreground"})}),e.jsx(f,{size:"icon",variant:"secondary",className:"absolute top-2 right-2",onClick:e=>{e.stopPropagation(),(async e=>{try{re.has(e)?(await C.removeFromFavorites(e),ie(s=>{const a=new Set(s);return a.delete(e),a}),E({title:"Removed from favorites",description:"Property removed from your favorites"})):(await C.addToFavorites(e),ie(s=>new Set(s).add(e)),E({title:"Added to favorites",description:"Property added to your favorites"}))}catch(s){E({title:"Error",description:"Failed to update favorite",variant:"destructive"})}})(s._id)},children:e.jsx(y,{className:"h-4 w-4 "+(re.has(s._id)?"fill-red-500 text-red-500":"")})})]}),e.jsxs(n,{className:"p-4",onClick:()=>M(`/customer/property/${s._id}`),children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx(v,{className:"bg-blue-50 text-blue-700 border-blue-100 capitalize",children:ge(s.listingType).toLowerCase().startsWith("for ")?ge(s.listingType):`For ${ge(s.listingType)}`}),e.jsx(v,{variant:"outline",className:"border-gray-200 text-gray-600 capitalize",children:s.type})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg line-clamp-1",children:s.title}),e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground mt-1",children:[e.jsx(N,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"line-clamp-1",children:s.address.district?`${s.address.city}, ${s.address.district}, ${s.address.state}`:`${s.address.city}, ${s.address.state}`})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:ye(s.price)}),"rent"===s.listingType&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"/month"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[s.bedrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx("span",{children:s.bedrooms})]}),s.bathrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsx("span",{children:s.bathrooms})]}),s.area?.builtUp&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.area.builtUp," sqft"]})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t",children:e.jsx(v,{variant:"outline",className:"capitalize",children:s.type})})]})]},s._id))}),te>1&&e.jsxs("div",{className:"flex justify-center gap-2 mt-8",children:[e.jsx(f,{variant:"outline",disabled:1===se,onClick:()=>ae(e=>e-1),children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:Array.from({length:te},(e,s)=>s+1).map(s=>e.jsx(f,{variant:se===s?"default":"outline",onClick:()=>ae(s),className:"w-10",children:s},s))}),e.jsx(f,{variant:"outline",disabled:se===te,onClick:()=>ae(e=>e+1),children:"Next"})]})]})]})]})})]})};export{k as default};

import{j as e}from"./ui-BNZSgpjP.js";import{d as s,r as t,L as a}from"./router-D8v2YSKU.js";import{N as r,B as i,a as o,e as l,L as n,M as d,I as c,f as m,A as u,E as p,F as h,t as x}from"./index-Z2ZeqOLK.js";import{S as f}from"./store-cS9uhCG4.js";import{L as j}from"./lock-BoCJXzj5.js";import{E as v}from"./eye-off-DJXgWKWD.js";import"./vendor-BxThA0WO.js";const w=()=>{const w=s(),[y,g]=t.useState("email"),[N,b]=t.useState(""),[P,S]=t.useState(""),[E,C]=t.useState(""),[T,R]=t.useState(""),[F,k]=t.useState(!1),[q,O]=t.useState(!1),[D,L]=t.useState(10);t.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"smooth"})},[y]);return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(r,{}),e.jsx("main",{className:"container mx-auto px-4 py-12",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs(i,{className:"mb-4 bg-primary/10 text-primary border-primary/20",children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"Vendor Portal"]}),e.jsxs("h1",{className:"text-3xl font-bold mb-2",children:["email"===y&&"Forgot Password","otp"===y&&"Reset Your Password","success"===y&&"Password Reset Successful"]}),e.jsxs("p",{className:"text-muted-foreground",children:["email"===y&&"Enter your email to receive a reset code","otp"===y&&"Enter the OTP sent to your email","success"===y&&"You can now login with your new password"]})]}),e.jsx(o,{children:e.jsxs(l,{className:"p-6",children:["email"===y&&e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),N){O(!0);try{const e=await fetch("https://app.buildhomemartsquares.com/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:N})}),s=await e.json();e.ok&&s.success?(g("otp"),s.expiryMinutes&&L(s.expiryMinutes),x({title:"OTP Sent!",description:"Check your email for the password reset code."})):404===e.status&&"EMAIL_NOT_REGISTERED"===s.error?x({title:"Email Not Registered",description:s.message||"This email is not registered. Please check your email or sign up for a new account.",variant:"destructive"}):429===e.status?x({title:"Too Many Requests",description:s.message||"Please wait before requesting another OTP",variant:"destructive"}):x({title:"Error",description:s.message||"Failed to send password reset code. Please try again.",variant:"destructive"})}catch(s){x({title:"Error",description:"Failed to send OTP. Please try again.",variant:"destructive"})}finally{O(!1)}}else x({title:"Email Required",description:"Please enter your email address",variant:"destructive"})},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"email",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(c,{id:"email",type:"email",placeholder:"vendor@example.com",value:N,onChange:e=>b(e.target.value),className:"pl-10",required:!0})]})]}),e.jsx(m,{type:"submit",className:"w-full",disabled:q,children:q?"Sending...":"Send Reset Code"}),e.jsx("div",{className:"text-center",children:e.jsxs(a,{to:"/vendor/login",className:"inline-flex items-center text-sm text-primary hover:underline",children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"Back to Login"]})})]}),"otp"===y&&e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),P&&E&&T)if(E===T)if(E.length<8)x({title:"Password Too Short",description:"Password must be at least 8 characters",variant:"destructive"});else{O(!0);try{const e=await fetch("https://app.buildhomemartsquares.com/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:N,otp:P,newPassword:E})}),s=await e.json();s.success?(g("success"),x({title:"Password Reset!",description:"Your password has been successfully reset."})):x({title:"Reset Failed",description:s.message||"Invalid OTP or password",variant:"destructive"})}catch(s){x({title:"Error",description:"Failed to reset password. Please try again.",variant:"destructive"})}finally{O(!1)}}else x({title:"Passwords Don't Match",description:"Please make sure your passwords match",variant:"destructive"});else x({title:"All Fields Required",description:"Please fill in all fields",variant:"destructive"})},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"otp",children:"Verification Code"}),e.jsx(c,{id:"otp",type:"text",placeholder:"Enter 6-digit code",value:P,onChange:e=>S(e.target.value.replace(/\D/g,"").slice(0,6)),maxLength:6,autoComplete:"off",required:!0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Code sent to ",N," â€¢ Expires in ",D," minutes"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"newPassword",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(c,{id:"newPassword",type:F?"text":"password",placeholder:"Enter new password",value:E,onChange:e=>C(e.target.value),className:"pl-10 pr-10",required:!0}),e.jsx("button",{type:"button",onClick:()=>k(!F),className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:F?e.jsx(v,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(p,{className:"h-5 w-5 text-muted-foreground"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(c,{id:"confirmPassword",type:F?"text":"password",placeholder:"Confirm new password",value:T,onChange:e=>R(e.target.value),className:"pl-10",required:!0})]})]}),e.jsx(m,{type:"submit",className:"w-full",disabled:q,children:q?"Resetting...":"Reset Password"}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:()=>g("email"),className:"text-sm text-primary hover:underline",children:"Didn't receive code? Try again"})})]}),"success"===y&&e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(j,{className:"w-8 h-8 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"All Set!"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your password has been successfully reset."})]}),e.jsx(m,{onClick:()=>w("/vendor/login"),className:"w-full",children:"Go to Vendor Login"})]})]})}),e.jsx("div",{className:"mt-6 text-center text-sm text-muted-foreground",children:e.jsxs("p",{children:["Don't have a vendor account?"," ",e.jsx(a,{to:"/vendor/register",className:"text-primary hover:underline",children:"Register here"})]})})]})}),e.jsx(h,{})]})};export{w as default};

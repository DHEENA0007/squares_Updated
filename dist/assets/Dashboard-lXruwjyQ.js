import{j as e}from"./ui-DOY6021Z.js";import{r as m}from"./router-2SVJvIbS.js";import{z as g,U as x,a as h,b as u,c as p,e as f,d as b}from"./index-DJqidggL.js";import{L as w}from"./loader-circle-C0zUPQir.js";import{D as j}from"./dollar-sign-BoYqDhPx.js";import{T as y}from"./trending-up-BhzOTv6v.js";import{A as v}from"./activity-D9p9sAWx.js";import"./vendor-Dazix4UH.js";class N{baseUrl="https://squares-v2.onrender.com/api";async makeRequest(t,a={}){const c=`${this.baseUrl}${t}`,l={headers:{"Content-Type":"application/json",...a.headers},...a},i=g.getToken();i&&(l.headers={...l.headers,Authorization:`Bearer ${i}`});try{const s=await fetch(c,l);if(!s.ok){let o;try{o=await s.json()}catch{o={success:!1,message:`HTTP ${s.status}: ${s.statusText}`}}throw new Error(o&&o.message||"An error occurred")}const r=await s.json();if(r==null)throw new Error("Received null or undefined response from server");return r}catch(s){throw console.error("API request failed:",s),s}}async getDashboardData(){try{const t=await this.makeRequest("/dashboard");if(!t||typeof t!="object")throw new Error("Invalid response format");return t}catch(t){return console.error("Failed to fetch dashboard data:",t),{success:!0,data:{stats:{totalUsers:0,totalProperties:0,totalRevenue:0,activeListings:0,newUsersThisMonth:0,newPropertiesThisMonth:0,revenueThisMonth:0,engagementRate:0},recentActivities:[]}}}}formatRevenue(t){return t>=1e7?`₹${(t/1e7).toFixed(1)} Cr`:t>=1e5?`₹${(t/1e5).toFixed(1)} Lac`:`₹${t.toLocaleString("en-IN")}`}formatPercentageChange(t,a){if(a===0)return"+0%";const c=(t-a)/a*100;return`${c>=0?"+":""}${c.toFixed(1)}%`}formatActivityDescription(t){switch(t.type){case"user_registered":return`New user registered: ${t.metadata?.email||"Unknown"}`;case"property_listed":return`New property listed: ${t.metadata?.title||"Unknown"}`;case"property_sold":return`Property sold: ${t.metadata?.title||"Unknown"}`;case"property_rented":return`Property rented: ${t.metadata?.title||"Unknown"}`;case"inquiry_received":return`New inquiry received for: ${t.metadata?.propertyTitle||"Unknown"}`;case"subscription_purchased":return`Subscription purchased: ${t.metadata?.planName||"Unknown"} - ₹${t.metadata?.amount||0}`;default:return t.description}}formatTimestamp(t){const a=new Date,c=new Date(t),l=a.getTime()-c.getTime(),i=Math.floor(l/(1e3*60*60)),s=Math.floor(i/24);return i<1?"Just now":i<24?`${i} hour${i>1?"s":""} ago`:s<7?`${s} day${s>1?"s":""} ago`:c.toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})}}const d=new N,A=()=>{const[n,t]=m.useState(null),[a,c]=m.useState([]),[l,i]=m.useState(!0);if(m.useEffect(()=>{(async()=>{try{const o=await d.getDashboardData();o.success&&(t(o.data.stats),c(o.data.recentActivities))}catch(o){console.error("Failed to fetch dashboard data:",o)}finally{i(!1)}})()},[]),l)return e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(w,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading dashboard..."})]});if(!n)return e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-lg text-muted-foreground",children:"Failed to load dashboard data."})});const s=[{title:"Total Revenue",value:d.formatRevenue(n.totalRevenue),change:`${n.revenueThisMonth>0?"+":""}${d.formatRevenue(n.revenueThisMonth)} this month`,icon:j,color:"text-emerald-500 dark:text-emerald-400",bgColor:"bg-emerald-500/10"},{title:"Total Users",value:n.totalUsers.toLocaleString(),change:`+${n.newUsersThisMonth} this month`,icon:x,color:"text-blue-500 dark:text-blue-400",bgColor:"bg-blue-500/10"},{title:"Total Properties",value:n.totalProperties.toLocaleString(),change:`+${n.newPropertiesThisMonth} this month`,icon:y,color:"text-accent",bgColor:"bg-accent/10"},{title:"Engagement Rate",value:`${n.engagementRate}%`,change:"Favorites per property",icon:v,color:"text-primary",bgColor:"bg-primary/10"}];return e.jsxs("div",{className:"space-y-6 animate-fade-in relative top-[60px]",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Welcome back! Here's an overview of your metrics."})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:s.map(r=>{const o=r.icon;return e.jsxs(h,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between pb-2 space-y-0",children:[e.jsx(p,{className:"text-sm font-medium",children:r.title}),e.jsx("div",{className:`p-2 rounded-lg ${r.bgColor}`,children:e.jsx(o,{className:`h-4 w-4 ${r.color}`})})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.value}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r.change})]})]},r.title)})}),e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Recent Activity"}),e.jsx(b,{children:"Latest platform activities"})]}),e.jsx(f,{children:e.jsx("div",{className:"space-y-4",children:a.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No recent activities"}):a.map(r=>e.jsxs("div",{className:"flex items-center gap-4 pb-4 border-b last:border-0 last:pb-0",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${r.type==="user_registered"?"bg-blue-500":r.type==="property_listed"?"bg-green-500":r.type==="property_sold"?"bg-emerald-500":r.type==="property_rented"?"bg-purple-500":r.type==="subscription_purchased"?"bg-yellow-500":"bg-primary"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:d.formatActivityDescription(r)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d.formatTimestamp(r.timestamp)})]})]},r._id))})})]})]})};export{A as default};

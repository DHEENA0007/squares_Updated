import{j as e}from"./ui-s1SEoZIF.js";import{r as s,d as a}from"./router-D8v2YSKU.js";import{G as r,aj as t,q as i,r as l,s as n,v as o,w as c,f as d,a3 as m,u as x,aN as p,a as h,bD as u,B as j,a1 as v,e as g,k as y,aL as f,aM as b,bH as N,am as w,y as L}from"./index-DvBXyKtT.js";import{a as P}from"./propertyUtils-41DuwCMc.js";import{P as C,a as S}from"./PropertyContactDialog-Droa4NNB.js";import{E as _}from"./EnterprisePropertyContactDialog-yHtEGUM9.js";import{vendorService as V}from"./vendorService--N0j1E2K.js";import{f as T}from"./favoriteService-BpBBvlp_.js";import{S as k}from"./square-CjbTmS86.js";const F=({onFilterChange:a,initialFilters:x})=>{const[p,h]=s.useState({propertyType:void 0,bedrooms:void 0,minPrice:void 0,maxPrice:void 0,listingType:void 0}),[u,j]=s.useState([]),[v,g]=s.useState([]),[y,f]=s.useState([]),[b,N]=s.useState(!0);s.useEffect(()=>{(async()=>{try{N(!0);const[e,s]=await Promise.all([m.getAllPropertyTypes(!1),m.getFilterConfigurationsByType("listing_type",!1)]);j(e),f(s),g([{id:"20-40",name:"20-40L",displayLabel:"₹20L - ₹40L",minValue:2e6,maxValue:4e6},{id:"40-60",name:"40-60L",displayLabel:"₹40L - ₹60L",minValue:4e6,maxValue:6e6},{id:"60-80",name:"60-80L",displayLabel:"₹60L - ₹80L",minValue:6e6,maxValue:8e6},{id:"80-1cr",name:"80L-1Cr",displayLabel:"₹80L - ₹1Cr",minValue:8e6,maxValue:1e7},{id:"1cr+",name:"1Cr+",displayLabel:"₹1Cr+",minValue:1e7,maxValue:null}])}catch(e){}finally{N(!1)}})()},[]),s.useEffect(()=>{x&&h(x)},[x]);const w=(e,s)=>{const r={...p,[e]:"all"===s||"any"===s||"any-budget"===s?void 0:s};h(r),a(r)};return b?e.jsx("div",{className:"bg-card border border-border rounded-xl p-4 shadow-[var(--shadow-soft)]",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 py-2",children:[e.jsx(r,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{className:"text-muted-foreground",children:"Loading filters..."})]})}):e.jsx("div",{className:"bg-card border border-border rounded-xl p-4 shadow-[var(--shadow-soft)]",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(t,{className:"h-5 w-5"}),e.jsx("span",{children:"Filters:"})]}),e.jsxs(i,{value:p.listingType||"all",onValueChange:e=>w("listingType",e),disabled:b,children:[e.jsx(l,{className:"w-[150px]",children:e.jsx(n,{placeholder:b?"Loading...":"Listing Type"})}),e.jsxs(o,{children:[e.jsx(c,{value:"all",children:"All Types"}),y.map(s=>e.jsx(c,{value:s.value,children:s.displayLabel||s.name},s.id))]})]}),e.jsxs(i,{value:p.propertyType||"all",onValueChange:e=>w("propertyType",e),children:[e.jsx(l,{className:"w-[180px]",children:e.jsx(n,{placeholder:"Property Type"})}),e.jsxs(o,{children:[e.jsx(c,{value:"all",children:"All Properties"}),u.map(s=>e.jsx(c,{value:s.value,children:s.name},s.id))]})]}),e.jsxs(i,{value:p.bedrooms?.toString()||"any",onValueChange:e=>{const s="any"===e?void 0:parseInt(e);w("bedrooms",s&&!isNaN(s)?s:void 0)},children:[e.jsx(l,{className:"w-[150px]",children:e.jsx(n,{placeholder:"BHK"})}),e.jsxs(o,{children:[e.jsx(c,{value:"any",children:"Any BHK"}),e.jsx(c,{value:"1",children:"1 BHK"}),e.jsx(c,{value:"2",children:"2 BHK"}),e.jsx(c,{value:"3",children:"3 BHK"}),e.jsx(c,{value:"4",children:"4+ BHK"})]})]}),e.jsxs(i,{value:2e6===p.minPrice&&4e6===p.maxPrice?"20-40":4e6===p.minPrice&&6e6===p.maxPrice?"40-60":6e6===p.minPrice&&8e6===p.maxPrice?"60-80":8e6===p.minPrice&&1e7===p.maxPrice?"80-1cr":1e7!==p.minPrice||p.maxPrice?"any-budget":"1cr+",onValueChange:e=>{let s,r;switch(e){case"20-40":s=2e6,r=4e6;break;case"40-60":s=4e6,r=6e6;break;case"60-80":s=6e6,r=8e6;break;case"80-1cr":s=8e6,r=1e7;break;case"1cr+":s=1e7,r=void 0;break;default:s=void 0,r=void 0}const t={...p,minPrice:s,maxPrice:r};h(t),a(t)},children:[e.jsx(l,{className:"w-[180px]",children:e.jsx(n,{placeholder:"Budget"})}),e.jsxs(o,{children:[e.jsx(c,{value:"any-budget",children:"Any Budget"}),e.jsx(c,{value:"20-40",children:"₹20L - ₹40L"}),e.jsx(c,{value:"40-60",children:"₹40L - ₹60L"}),e.jsx(c,{value:"60-80",children:"₹60L - ₹80L"}),e.jsx(c,{value:"80-1cr",children:"₹80L - ₹1Cr"}),e.jsx(c,{value:"1cr+",children:"₹1Cr+"})]})]}),e.jsx(d,{variant:"secondary",className:"ml-auto",onClick:()=>{const e={propertyType:void 0,bedrooms:void 0,minPrice:void 0,maxPrice:void 0,listingType:void 0};h(e),a(e)},children:"Reset Filters"})]})})},B=({property:r})=>{const t=a(),{isAuthenticated:i,user:l,isVendor:n,isCustomer:o}=x(),[c,m]=s.useState(!1),[F,B]=s.useState(!1),[$,A]=s.useState(!1),[E,H]=s.useState(!1),[K,D]=s.useState(null),[M,O]=s.useState(!0),[q,z]=s.useState(!1),[I,R]=s.useState(!1),U=p.getPrimaryImage(r),G=p.formatPrice(r.price,r.listingType),J=p.formatArea(r.area),W=r.address.district?`${r.address.city}, ${r.address.district}, ${r.address.state}`:`${r.address.city}, ${r.address.state}`;s.useEffect(()=>{(async()=>{if(r.vendor?._id||r.owner?._id)try{O(!0);const e=r.vendor?._id||r.owner?._id,s=await V.isVendorEnterpriseProperty(e);H(s.isEnterprise),D(s.whatsappNumber)}catch(e){H(!1),D(null)}finally{O(!1)}else O(!1)})()},[r.vendor?._id,r.owner?._id]),s.useEffect(()=>{(async()=>{if(i&&o)try{const e=await T.isFavorite(r._id);z(e)}catch(e){}})()},[i,o,r._id]);return e.jsxs(h,{className:"group overflow-hidden hover:shadow-[var(--shadow-large)] transition-all duration-300 flex flex-col h-full",children:[e.jsxs("div",{className:"relative h-44 md:h-48 overflow-hidden",children:[e.jsx("img",{src:U,alt:r.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",onError:e=>{e.target.src=u}}),r.featured&&e.jsx(j,{className:"absolute top-3 left-3 bg-accent text-accent-foreground text-xs py-1 px-2",children:"Featured"}),r.verified&&e.jsx(j,{className:"absolute top-12 left-3 bg-green-500 text-white text-xs py-1 px-2",children:"Verified"}),e.jsx(j,{className:`absolute top-3 ${i&&o?"right-12":"right-3"} text-xs py-1 px-2 ${"available"===r.status?"bg-green-500":"sold"===r.status?"bg-red-500":"rented"===r.status?"bg-blue-500":"bg-yellow-500"} text-white`,children:r.status.charAt(0).toUpperCase()+r.status.slice(1)}),i&&o&&e.jsx(d,{size:"icon",variant:"ghost",className:"absolute top-3 right-3 bg-background/80 backdrop-blur hover:bg-background "+(q?"text-red-500":""),onClick:async e=>{if(e.stopPropagation(),i){if(!I)try{R(!0),q?(await T.removeFromFavorites(r._id),z(!1)):(await T.addToFavorites(r._id),z(!0))}catch(s){}finally{R(!1)}}else t("/login",{state:{from:`/property/${r._id}`,action:"favorite"}})},disabled:I,children:e.jsx(v,{className:"h-5 w-5 "+(q?"fill-current":"")})})]}),e.jsxs(g,{className:"p-3 flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-base md:text-lg line-clamp-2",children:r.title}),e.jsx(j,{variant:"secondary",className:"text-sm",children:"sale"===r.listingType?"For Sale":"rent"===r.listingType?"For Rent":"For Lease"})]}),e.jsxs("div",{className:"flex items-center text-muted-foreground mb-2",children:[e.jsx(y,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-sm line-clamp-1",children:W})]}),e.jsx("div",{className:"text-sm text-muted-foreground mb-2 capitalize",children:r.type?r.type.replace("_"," "):"property"}),e.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:P(r)}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[r.bedrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{className:"h-4 w-4"}),e.jsxs("span",{children:[r.bedrooms," BHK"]})]}),r.bathrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsxs("span",{children:[r.bathrooms," Bath"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx("span",{children:J})]})]}),e.jsx("div",{className:"text-xl md:text-2xl font-bold text-primary",children:G}),r.amenities.length>0&&e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[r.amenities.slice(0,3).map((s,a)=>e.jsx(j,{variant:"outline",className:"text-xs",children:s},a)),r.amenities.length>3&&e.jsxs(j,{variant:"outline",className:"text-xs",children:["+",r.amenities.length-3," more"]})]})]}),e.jsxs(N,{className:"p-3 pt-0 flex gap-2 text-sm",children:[!M&&!E&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{variant:"outline",className:"flex-1 py-2",onClick:()=>{i?E?A(!0):m(!0):t("/login",{state:{from:`/property/${r._id}`,action:"message"}})},children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Message"]}),e.jsxs(d,{variant:"outline",className:"flex-1 py-2",onClick:()=>{i?E?A(!0):B(!0):t("/login",{state:{from:`/property/${r._id}`,action:"contact"}})},children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Contact"]})]}),!M&&E&&e.jsxs(d,{variant:"outline",className:"flex-1 bg-green-50 hover:bg-green-100 text-green-700 border-green-200 py-2",onClick:()=>A(!0),children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"WhatsApp Contact"]}),e.jsx(d,{className:"flex-1 py-2",onClick:()=>{i&&n&&(r.owner?._id===l?.id||r.vendor?._id===l?.id)?t(`/vendor/properties/details/${r._id}`):t(`/property/${r._id}`)},children:"View Details"})]}),e.jsx(C,{open:c,onOpenChange:m,property:r,onMessageSent:()=>{}}),e.jsx(S,{open:F,onOpenChange:B,property:r}),e.jsx(_,{open:$,onOpenChange:A,property:r,whatsappNumber:K})]})};export{F as P,B as a};

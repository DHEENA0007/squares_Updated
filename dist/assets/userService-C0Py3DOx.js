import{z as n,t}from"./index-SPvHGBGF.js";class d{baseUrl="https://squares-v2.onrender.com/api";async makeRequest(s,e={}){const r=`${this.baseUrl}${s}`,o={headers:{"Content-Type":"application/json",...e.headers},...e},a=n.getToken();a&&(o.headers={...o.headers,Authorization:`Bearer ${a}`});try{const i=await fetch(r,o);if(!i.ok){const c=await i.json().catch(()=>({success:!1,message:`HTTP ${i.status}: ${i.statusText}`}));throw new Error(c.message||"An error occurred")}return await i.json()}catch(i){throw console.error("API request failed:",i),i}}async getUsers(s={}){try{const e=new URLSearchParams;Object.entries(s).forEach(([a,i])=>{i!=null&&i!==""&&e.append(a,String(i))});const r=`/users${e.toString()?`?${e.toString()}`:""}`;return await this.makeRequest(r)}catch(e){const r=e instanceof Error?e.message:"Failed to fetch users";throw t({title:"Error",description:r,variant:"destructive"}),e}}async getUser(s){try{return await this.makeRequest(`/users/${s}`)}catch(e){const r=e instanceof Error?e.message:"Failed to fetch user";throw t({title:"Error",description:r,variant:"destructive"}),e}}async createUser(s){try{const e=await this.makeRequest("/users",{method:"POST",body:JSON.stringify(s)});return t({title:"Success",description:"User created successfully!"}),e}catch(e){const r=e instanceof Error?e.message:"Failed to create user";throw t({title:"Error",description:r,variant:"destructive"}),e}}async updateUser(s,e){try{const r=await this.makeRequest(`/users/${s}`,{method:"PUT",body:JSON.stringify(e)});return t({title:"Success",description:"User updated successfully!"}),r}catch(r){const o=r instanceof Error?r.message:"Failed to update user";throw t({title:"Error",description:o,variant:"destructive"}),r}}async deleteUser(s){try{await this.makeRequest(`/users/${s}`,{method:"DELETE"}),t({title:"Success",description:"User deleted successfully!"})}catch(e){const r=e instanceof Error?e.message:"Failed to delete user";throw t({title:"Error",description:r,variant:"destructive"}),e}}async updateUserStatus(s,e){try{const r=await this.makeRequest(`/users/${s}/status`,{method:"PATCH",body:JSON.stringify({status:e})});return t({title:"Success",description:`User status updated to ${e}!`}),r}catch(r){const o=r instanceof Error?r.message:"Failed to update user status";throw t({title:"Error",description:o,variant:"destructive"}),r}}async getCurrentUser(){try{return await this.makeRequest("/auth/me")}catch(s){const e=s instanceof Error?s.message:"Failed to fetch current user";throw t({title:"Error",description:e,variant:"destructive"}),s}}async updateCurrentUser(s){try{console.log("Update data being sent:",s),s.profile&&(s.profile.preferences===void 0?s.profile.preferences={notifications:{email:!0,sms:!1,push:!0},privacy:{showEmail:!1,showPhone:!1}}:s.profile.preferences&&(s.profile.preferences.notifications||(s.profile.preferences.notifications={email:!0,sms:!1,push:!0}),s.profile.preferences.privacy||(s.profile.preferences.privacy={showEmail:!1,showPhone:!1}))),console.log("Cleaned update data:",s);let e=null;const r=n.getStoredUser();if(console.log("Stored user data:",r),r&&(r.id||r._id)&&(e=r.id||r._id),!e){console.log("No stored user ID, getting from API...");const a=await this.getCurrentUser();console.log("API response:",a),e=a.data?.user?._id}if(!e)throw console.error("No user ID available"),new Error("Unable to get user ID. Please log in again.");console.log("Updating user with ID:",e);const o=await this.makeRequest(`/users/${e}`,{method:"PUT",body:JSON.stringify(s)});return t({title:"Success",description:"Profile updated successfully!"}),o}catch(e){const r=e instanceof Error?e.message:"Failed to update profile";throw console.error("Update profile error:",e),t({title:"Error",description:r,variant:"destructive"}),e}}async updateUserPreferences(s){try{let e=null;const r=n.getStoredUser();if(r&&r.id&&(e=r.id),e||(e=(await this.getCurrentUser()).data.user._id),!e)throw new Error("Unable to get user ID. Please log in again.");return await this.makeRequest(`/users/${e}`,{method:"PUT",body:JSON.stringify(s)})}catch(e){const r=e instanceof Error?e.message:"Failed to update preferences";throw t({title:"Error",description:r,variant:"destructive"}),e}}async updatePassword(s){try{const e=await this.makeRequest("/auth/change-password",{method:"POST",body:JSON.stringify({password:s})});return t({title:"Success",description:"Password updated successfully!"}),e}catch(e){const r=e instanceof Error?e.message:"Failed to update password";throw t({title:"Error",description:r,variant:"destructive"}),e}}async requestPasswordChangeOTP(s){try{const e=await this.makeRequest("/auth/request-password-change-otp",{method:"POST",body:JSON.stringify({currentPassword:s})});return t({title:"OTP Sent",description:"Please check your email for the verification code"}),e}catch(e){const r=e instanceof Error?e.message:"Failed to send OTP";throw t({title:"Error",description:r,variant:"destructive"}),e}}async changePasswordWithOTP(s,e){try{const r=await this.makeRequest("/auth/change-password-with-otp",{method:"POST",body:JSON.stringify({otp:s,newPassword:e})});return t({title:"Success",description:"Password changed successfully!"}),r}catch(r){const o=r instanceof Error?r.message:"Failed to change password";throw t({title:"Error",description:o,variant:"destructive"}),r}}async changePassword(s,e){try{const r=await this.makeRequest("/auth/change-password",{method:"POST",body:JSON.stringify({currentPassword:s,newPassword:e})});return r.requiresOTP?(t({title:"Enhanced Security",description:r.message,variant:"default"}),r):(t({title:"Success",description:"Password changed successfully!"}),r)}catch(r){const o=r instanceof Error?r.message:"Failed to change password";throw t({title:"Error",description:o,variant:"destructive"}),r}}async sendOTP(s,e){try{const r=await this.makeRequest("/auth/send-otp",{method:"POST",body:JSON.stringify({email:s,firstName:e})});return t({title:"OTP Sent",description:`Verification code sent to ${s}. Valid for ${r.expiryMinutes} minutes.`}),r}catch(r){const o=r instanceof Error?r.message:"Failed to send OTP";throw t({title:"Error",description:o,variant:"destructive"}),new Error(o)}}async verifyOTP(s,e){try{const r=await this.makeRequest("/auth/verify-otp",{method:"POST",body:JSON.stringify({email:s,otp:e})});return r.success&&t({title:"Email Verified",description:"Your email has been verified successfully!"}),r}catch(r){const o=r instanceof Error?r.message:"Failed to verify OTP";throw t({title:"Verification Failed",description:o,variant:"destructive"}),new Error(o)}}getFullName(s){return`${s.profile.firstName} ${s.profile.lastName}`.trim()}formatCreationDate(s){return new Date(s).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})}}const p=new d;export{p as u};

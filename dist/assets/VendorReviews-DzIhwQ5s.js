import{j as e}from"./ui-BHyUY8Z8.js";import{r as l}from"./router-2SVJvIbS.js";import{t as P,at as x,f as B,a as i,e as n,T as M,Y as O,I as Q,s as w,v as b,w as S,x as R,y as a,B as D,a2 as q,a3 as G,a4 as Y,aB as _,h as J,aI as K}from"./index-Bd1eLXM_.js";import{R as $}from"./refresh-cw-D2lAUAYb.js";import"./vendor-Dazix4UH.js";const te=()=>{const[g,C]=l.useState(!0),[N,A]=l.useState(!1),[o,L]=l.useState([]),[r,E]=l.useState(null),[m,F]=l.useState(""),[h,k]=l.useState("all"),[p,T]=l.useState("all"),[c,I]=l.useState("newest"),u="https://api.akodefy.com/api",j=l.useCallback(async()=>{try{C(!0);const s=localStorage.getItem("token"),t=new URLSearchParams;h!=="all"&&t.append("rating",h),p!=="all"&&t.append("reviewType",p),m&&t.append("search",m),t.append("sortBy",c==="newest"||c==="oldest"?"createdAt":"rating"),t.append("sortOrder",c==="oldest"||c==="rating-low"?"asc":"desc");const y=await(await fetch(`${u}/vendors/reviews?${t.toString()}`,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}})).json();y.success?L(y.data.reviews||[]):P({title:"Error",description:y.message||"Failed to load reviews",variant:"destructive"})}catch(s){console.error("Failed to load reviews:",s),P({title:"Error",description:"Failed to load reviews. Please try again.",variant:"destructive"})}finally{C(!1)}},[u,h,p,m,c]),f=l.useCallback(async()=>{try{const s=localStorage.getItem("token"),d=await(await fetch(`${u}/vendors/reviews/stats`,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}})).json();d.success&&E(d.data)}catch(s){console.error("Failed to load stats:",s)}},[u]),U=l.useCallback(async()=>{A(!0),await Promise.all([j(),f()]),A(!1)},[j,f]);l.useEffect(()=>{j(),f()},[j,f]);const V=s=>{if(!s)return"N/A";const t=new Date(s);return isNaN(t.getTime())?"N/A":t.toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"})},z=s=>!s||s.length===0?"/placeholder-property.jpg":s.find(d=>d.isPrimary)?.url||s[0]?.url||"/placeholder-property.jpg",H=s=>s.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2),v=o;return e.jsxs("div",{className:"space-y-6 pt-16",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(x,{className:"w-8 h-8 text-primary fill-primary"}),"Reviews & Ratings"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage customer feedback and maintain your reputation"})]}),e.jsxs(B,{variant:"outline",onClick:U,disabled:N,children:[e.jsx($,{className:`w-4 h-4 mr-2 ${N?"animate-spin":""}`}),N?"Refreshing...":"Refresh"]})]}),r&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:r.totalReviews}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Reviews"})]})})}),e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(x,{className:"w-5 h-5 text-yellow-400 fill-yellow-400"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:r.averageRating.toFixed(1)})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Average Rating"})]})})}),e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:r.ratingDistribution[5]+r.ratingDistribution[4]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Positive Reviews"})]})})}),e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:o.filter(s=>s.isPublic).length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Public Reviews"})]})})})]}),r&&r.totalReviews>0&&e.jsx(i,{children:e.jsxs(n,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),"Rating Distribution"]}),e.jsx("div",{className:"space-y-3",children:[5,4,3,2,1].map(s=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1 w-16",children:[e.jsx("span",{className:"text-sm font-medium",children:s}),e.jsx(x,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"})]}),e.jsx("div",{className:"flex-1 bg-muted rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"bg-yellow-400 h-full transition-all",style:{width:`${r.totalReviews>0?r.ratingDistribution[s]/r.totalReviews*100:0}%`}})}),e.jsx("span",{className:"text-sm text-muted-foreground w-12 text-right",children:r.ratingDistribution[s]})]},s))})]})}),e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Q,{type:"text",placeholder:"Search reviews...",className:"pl-10",value:m,onChange:s=>F(s.target.value)})]}),e.jsxs(w,{value:h,onValueChange:k,children:[e.jsx(b,{className:"w-full sm:w-40",children:e.jsx(S,{placeholder:"Rating"})}),e.jsxs(R,{children:[e.jsx(a,{value:"all",children:"All Ratings"}),e.jsx(a,{value:"5",children:"5 Stars"}),e.jsx(a,{value:"4",children:"4 Stars"}),e.jsx(a,{value:"3",children:"3 Stars"}),e.jsx(a,{value:"2",children:"2 Stars"}),e.jsx(a,{value:"1",children:"1 Star"})]})]}),e.jsxs(w,{value:p,onValueChange:T,children:[e.jsx(b,{className:"w-full sm:w-40",children:e.jsx(S,{placeholder:"Type"})}),e.jsxs(R,{children:[e.jsx(a,{value:"all",children:"All Types"}),e.jsx(a,{value:"property",children:"Property"}),e.jsx(a,{value:"service",children:"Service"}),e.jsx(a,{value:"general",children:"General"})]})]}),e.jsxs(w,{value:c,onValueChange:I,children:[e.jsx(b,{className:"w-full sm:w-40",children:e.jsx(S,{placeholder:"Sort By"})}),e.jsxs(R,{children:[e.jsx(a,{value:"newest",children:"Newest First"}),e.jsx(a,{value:"oldest",children:"Oldest First"}),e.jsx(a,{value:"rating-high",children:"Rating: High to Low"}),e.jsx(a,{value:"rating-low",children:"Rating: Low to High"})]})]})]})})}),!g&&v.length>0&&e.jsx("div",{className:"space-y-4",children:v.map(s=>e.jsx(i,{className:"overflow-hidden",children:e.jsx(n,{className:"p-0",children:e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[s.property&&e.jsxs("div",{className:"lg:w-48 h-48 lg:h-auto bg-muted relative",children:[e.jsx("img",{src:z(s.property.images),alt:s.property.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute top-3 left-3 flex gap-2",children:e.jsx(D,{className:s.property.status==="sold"?"bg-purple-600 text-white":s.property.status==="rented"?"bg-blue-600 text-white":"bg-green-600 text-white",children:s.property.status})})]}),e.jsxs("div",{className:"flex-1 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(q,{className:"w-10 h-10",children:[e.jsx(G,{src:s.client?.avatar}),e.jsx(Y,{children:s.client?H(s.client.name):"U"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.client?.name||"Anonymous"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:V(s.createdAt)})]})]}),e.jsx(D,{variant:"secondary",className:"capitalize",children:s.reviewType})]}),s.property&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(_,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:s.property.title})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground mt-1",children:[e.jsx(J,{className:"w-4 h-4"}),s.property.address.city,", ",s.property.address.state]})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(t=>e.jsx(x,{className:`w-5 h-5 ${t<=s.rating?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},t))}),e.jsxs("span",{className:"font-semibold text-lg",children:[s.rating,".0"]})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-semibold mb-1",children:s.title}),e.jsx("p",{className:"text-muted-foreground",children:s.comment})]})]})]})})},s._id))}),g&&e.jsx(i,{children:e.jsx(n,{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Loading reviews..."})]})})}),!g&&v.length===0&&e.jsx(i,{children:e.jsxs(n,{className:"p-12 text-center",children:[e.jsx(x,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:o.length===0?"No reviews yet":"No reviews match your filters"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:o.length===0?"Reviews from customers will appear here once they submit feedback on your properties.":"Try adjusting your search criteria or clear some filters."}),o.length>0&&e.jsxs(B,{variant:"outline",onClick:()=>{F(""),k("all"),T("all"),I("newest")},children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Clear Filters"]})]})})]})};export{te as default};

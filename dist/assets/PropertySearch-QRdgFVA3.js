import{j as e}from"./ui-BNZSgpjP.js";import{r as s,d as a,h as t}from"./router-D8v2YSKU.js";import{a2 as l,aL as r,a as i,e as n,$ as c,I as d,q as o,r as m,s as x,v as u,w as h,L as p,f,G as j,J as g,a1 as v,B as y,k as N,bP as b,bQ as w,a3 as S,l as T}from"./index-rSy6wPVC.js";import{C as k}from"./checkbox-BxVKdK5L.js";import{f as C}from"./favoriteService-DO9dMC0j.js";import{S as F}from"./square-zD9PqIsn.js";import"./vendor-BxThA0WO.js";const P=({value:a,onChange:t})=>{const[l,r]=s.useState(a||""),[i,n]=s.useState([]),[o,m]=s.useState(!1),[x,u]=s.useState(!1),[h,p]=s.useState(T.isReady()),f=s.useRef(null);s.useEffect(()=>{T.initialize().then(()=>p(!0))},[]),s.useEffect(()=>{void 0!==a&&r(a)},[a]),s.useEffect(()=>{const e=e=>{f.current&&!f.current.contains(e.target)&&m(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);return e.jsxs("div",{ref:f,className:"relative w-full",children:[e.jsxs("div",{className:"relative",children:[e.jsx(c,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(d,{placeholder:h?"Search Location...":"Loading...",value:l,onChange:e=>{const s=e.target.value;if(r(s),s.length<2)return n([]),void m(!1);u(!0),setTimeout(()=>{const e=T.searchLocations(s);n(e),u(!1),m(!0)},100)},className:"pl-10",disabled:!h,onFocus:()=>{l.length>=2&&m(!0)},onKeyDown:e=>{"Enter"===e.key&&(t(l),m(!1))}}),x&&e.jsx("div",{className:"absolute right-3 top-3",children:e.jsx(j,{className:"h-4 w-4 animate-spin text-muted-foreground"})})]}),o&&e.jsx("div",{className:"absolute z-[100] w-full mt-1 bg-popover border rounded-md shadow-md max-h-[200px] overflow-y-auto bg-white dark:bg-slate-950",children:i.length>0?i.map((s,a)=>e.jsxs("div",{className:"px-3 py-2 text-sm cursor-pointer hover:bg-accent hover:text-accent-foreground border-b last:border-0",onClick:()=>(e=>{r(e.city),t(e.city),m(!1)})(s),children:[e.jsx("div",{className:"font-medium",children:s.city}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.district,", ",s.state]})]},`${s.pincode}-${a}`)):e.jsx("div",{className:"px-3 py-2 text-sm text-muted-foreground text-center",children:"No locations found"})})]})},_=()=>{const[T,_]=s.useState([]),[A,E]=s.useState([]),[L,$]=s.useState([]),V=a(),{toast:M}=l(),[z]=t(),[D,O]=s.useState([]),[R,q]=s.useState(!0),[B,K]=s.useState(""),[U,I]=s.useState(""),[G,J]=s.useState("all"),[Q,W]=s.useState("all"),[H,X]=s.useState([0,2e7]),[Y,Z]=s.useState([0,1e4]),[ee,se]=s.useState([]),[ae,te]=s.useState({}),[le,re]=s.useState(1),[ie,ne]=s.useState(1),[ce,de]=s.useState(new Set),oe=e=>A.filter(s=>s.filterType===e&&s.isActive).sort((e,s)=>e.displayOrder-s.displayOrder),me=s.useMemo(()=>Array.from(new Set(A.map(e=>e.filterType))),[A]),[xe,ue]=s.useState({min:0,max:5e7}),[he,pe]=s.useState({min:0,max:1e4}),[fe,je]=s.useState([]);s.useEffect(()=>{(async()=>{try{const[e,s,a]=await Promise.all([S.getAllPropertyTypes(!1),S.getAllFilterConfigurations(!1),S.getFilterDependencies()]);_(e),E(s),je(a);const t=s.filter(e=>"budget"===e.filterType);if(t.length>0){const e=Math.min(...t.map(e=>e.minValue||0)),s=Math.max(...t.map(e=>e.maxValue||0));s>0&&(ue({min:e,max:s}),X([e,s]))}const l=s.filter(e=>"area"===e.filterType);if(l.length>0){const e=Math.min(...l.map(e=>e.minValue||0)),s=Math.max(...l.map(e=>e.maxValue||0));s>0&&(pe({min:e,max:s}),Z([e,s]))}}catch(e){}})()},[]);s.useEffect(()=>{T.length>0&&(async()=>{try{if("all"===Q){const e=await S.getAllAmenities(!1);$(e)}else{const e=T.find(e=>e.value===Q);if(e){const s=await S.getPropertyTypeAmenities(e._id);$(s)}else $([])}}catch(e){$([])}})()},[Q,T]),s.useEffect(()=>{const e=z.get("q"),s=z.get("listingType"),a=z.get("propertyType");e&&K(e),s&&"all"!==s&&J(s),a&&"all"!==a&&W(a),re(1)},[z]),s.useEffect(()=>{ge()},[B,U,G,Q,H,Y,ee,ae,le]);const ge=async()=>{q(!0);try{const e={page:le,limit:12};B.trim()&&(e.search=B),U.trim()&&(e.location=U),"all"!==G&&(e.listingType=G),"all"!==Q&&(e.propertyType=Q),Object.entries(ae).forEach(([s,a])=>{a&&"any"!==a&&(e[s]=a)}),H[0]>xe.min&&(e.minPrice=H[0]),H[1]<xe.max&&(e.maxPrice=H[1]),Y[0]>he.min&&(e.minArea=Y[0]),Y[1]<he.max&&(e.maxArea=Y[1]),ee.length>0&&(e.amenities=ee);const s=await r.getProperties(e);s.success&&(O(s.data.properties),ne(s.data.pagination.totalPages))}catch(e){M({title:"Error",description:"Failed to load properties",variant:"destructive"})}finally{q(!1)}};s.useEffect(()=>{ve()},[]);const ve=async()=>{try{const e=await C.getFavorites();if(e.success){const s=new Set(e.data.favorites.map(e=>e.property?._id).filter(Boolean));de(s)}}catch(e){}},ye=()=>{K(""),I(""),J("all"),W("all"),X([xe.min,xe.max]),Z([he.min,he.max]),se([]),te({}),re(1)},Ne=e=>{const s=A.find(s=>s.value===e&&("listing_type"===s.filterType||"listingType"===s.filterType));return s?s.displayLabel||s.name:e.charAt(0).toUpperCase()+e.slice(1)},be=e=>e>=1e7?`₹${(e/1e7).toFixed(2)} Cr`:e>=1e5?`₹${(e/1e5).toFixed(2)} L`:`₹${e.toLocaleString()}`;return e.jsxs("div",{className:"min-h-screen",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary/10 to-primary/5 border-b",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Search Properties"}),e.jsx("p",{className:"text-muted-foreground",children:"Find your dream property from our verified listings"})]})}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("aside",{className:"lg:w-80 flex-shrink-0",children:e.jsx(i,{className:"sticky top-20 max-h-[calc(100vh-6rem)] overflow-y-auto",children:e.jsxs(n,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Filters"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Location"}),e.jsx(P,{value:U,onChange:I})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Keyword Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(d,{placeholder:"Property name, ID...",value:B,onChange:e=>K(e.target.value),className:"pl-10"})]})]}),oe("listing_type").length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Listing Type"}),e.jsxs(o,{value:G,onValueChange:J,children:[e.jsx(m,{children:e.jsx(x,{placeholder:"Type"})}),e.jsxs(u,{className:"max-h-[300px] overflow-y-auto",children:[e.jsx(h,{value:"all",children:"All Types"}),oe("listing_type").map(s=>e.jsx(h,{value:s.value,children:s.displayLabel?.trim()||s.name},s._id))]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Property Type"}),e.jsxs(o,{value:Q,onValueChange:e=>{W(e),te({}),se([])},children:[e.jsx(m,{children:e.jsx(x,{placeholder:"Property"})}),e.jsxs(u,{className:"max-h-[300px] overflow-y-auto",children:[e.jsx(h,{value:"all",children:"All Properties"}),T.map(s=>e.jsx(h,{value:s.value,children:s.name},s.value))]})]})]}),me.filter(e=>!["listing_type","budget","area","property_type"].includes(e)).filter(e=>(e=>{const s=fe.find(s=>s.targetFilterType===e);if(!s)return!0;let a;return a="property_type"===s.sourceFilterType?Q:"listing_type"===s.sourceFilterType?G:ae[s.sourceFilterType],!(!a||"all"===a||"any"===a)&&s.sourceFilterValues.includes(a)})(e)).map(s=>{const a=A.filter(e=>e.filterType===s).sort((e,s)=>e.displayOrder-s.displayOrder);if(0===a.length)return null;const t=s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase());return e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:t}),e.jsxs(o,{value:ae[s]||"any",onValueChange:e=>{te(a=>({...a,[s]:e}))},children:[e.jsx(m,{children:e.jsx(x,{placeholder:`Select ${t}`})}),e.jsxs(u,{children:[e.jsxs(h,{value:"any",children:["Any ",t]}),a.map(s=>e.jsx(h,{value:s.value,children:s.displayLabel||s.name},s.id||s._id))]})]})]},s)}),xe.max>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Price Range"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Min Price"}),e.jsx(d,{type:"number",defaultValue:H[0],onBlur:e=>X([Number(e.target.value),H[1]]),onKeyDown:e=>{"Enter"===e.key&&X([Number(e.currentTarget.value),H[1]])},min:xe.min,max:xe.max,className:"w-full"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:be(H[0])})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Max Price"}),e.jsx(d,{type:"number",defaultValue:H[1],onBlur:e=>X([H[0],Number(e.target.value)]),onKeyDown:e=>{"Enter"===e.key&&X([H[0],Number(e.currentTarget.value)])},min:xe.min,max:xe.max,className:"w-full"}),e.jsx("div",{className:"text-xs text-muted-foreground text-right",children:be(H[1])})]})]})]}),L.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Amenities"}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2 border rounded-md p-3",children:L.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{id:s._id,checked:ee.includes(s.name),onCheckedChange:e=>{se(e?[...ee,s.name]:ee.filter(e=>e!==s.name))}}),e.jsx("label",{htmlFor:s._id,className:"text-sm font-normal cursor-pointer leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:s.name})]},s._id))}),ee.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:[ee.length," selected"]})]}),e.jsx(f,{variant:"outline",onClick:ye,className:"w-full",children:"Reset Filters"})]})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Available Properties"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:R?"Loading...":`${D.length} properties found`})]}),R?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(j,{className:"h-8 w-8 animate-spin text-primary"})}):0===D.length?e.jsx(i,{children:e.jsxs(n,{className:"p-12 text-center",children:[e.jsx(g,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No properties found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Try adjusting your filters or search criteria"}),e.jsx(f,{onClick:ye,children:"Clear Filters"})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:D.map(s=>e.jsxs(i,{className:"overflow-hidden hover:shadow-lg transition-shadow cursor-pointer",children:[e.jsxs("div",{className:"relative h-48 bg-muted",onClick:()=>V(`/property/${s._id}`),children:[s.images&&s.images.length>0?e.jsx("img",{src:"string"==typeof s.images[0]?s.images[0]:s.images[0]?.url,alt:s.title,className:"w-full h-full object-cover",onError:e=>{e.target.src="/placeholder-property.jpg"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(g,{className:"h-12 w-12 text-muted-foreground"})}),e.jsx(f,{size:"icon",variant:"secondary",className:"absolute top-2 right-2",onClick:e=>{e.stopPropagation(),(async e=>{try{ce.has(e)?(await C.removeFromFavorites(e),de(s=>{const a=new Set(s);return a.delete(e),a}),M({title:"Removed from favorites",description:"Property removed from your favorites"})):(await C.addToFavorites(e),de(s=>new Set(s).add(e)),M({title:"Added to favorites",description:"Property added to your favorites"}))}catch(s){M({title:"Error",description:"Failed to update favorite",variant:"destructive"})}})(s._id)},children:e.jsx(v,{className:"h-4 w-4 "+(ce.has(s._id)?"fill-red-500 text-red-500":"")})})]}),e.jsxs(n,{className:"p-4",onClick:()=>V(`/customer/property/${s._id}`),children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx(y,{className:"bg-blue-50 text-blue-700 border-blue-100 capitalize",children:Ne(s.listingType).toLowerCase().startsWith("for ")?Ne(s.listingType):`For ${Ne(s.listingType)}`}),e.jsx(y,{variant:"outline",className:"border-gray-200 text-gray-600 capitalize",children:s.type})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg line-clamp-1",children:s.title}),e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground mt-1",children:[e.jsx(N,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"line-clamp-1",children:s.address.district?`${s.address.city}, ${s.address.district}, ${s.address.state}`:`${s.address.city}, ${s.address.state}`})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:be(s.price)}),"rent"===s.listingType&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"/month"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[s.bedrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx("span",{children:s.bedrooms})]}),s.bathrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsx("span",{children:s.bathrooms})]}),s.area?.builtUp&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.area.builtUp," sqft"]})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t",children:e.jsx(y,{variant:"outline",className:"capitalize",children:s.type})})]})]},s._id))}),ie>1&&e.jsxs("div",{className:"flex justify-center gap-2 mt-8",children:[e.jsx(f,{variant:"outline",disabled:1===le,onClick:()=>re(e=>e-1),children:"Previous"}),e.jsx("div",{className:"flex items-center gap-2",children:Array.from({length:ie},(e,s)=>s+1).map(s=>e.jsx(f,{variant:le===s?"default":"outline",onClick:()=>re(s),className:"w-10",children:s},s))}),e.jsx(f,{variant:"outline",disabled:le===ie,onClick:()=>re(e=>e+1),children:"Next"})]})]})]})]})})]})};export{_ as default};

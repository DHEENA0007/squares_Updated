import{j as e}from"./ui-BNZSgpjP.js";import{r as s}from"./router-D8v2YSKU.js";import{a2 as t,aP as a,aQ as d,a as r,b as l,c as n,x as i,e as c,X as o,$ as m,I as x,af as u,ag as h,ah as p,ai as g,B as j,f as v,E as b,a4 as N,a5 as f,a6 as w,a7 as y,a8 as S,L as k,T as D,ae as A}from"./index-CWpkTP43.js";import{T as C,a as _,b as E,c as P,d as L,e as R}from"./table-myWg3CMl.js";import{C as F}from"./calendar-BZCh6MUV.js";import"./vendor-BxThA0WO.js";const I=(e,s="INR")=>new Intl.NumberFormat("en-IN",{style:"currency",currency:s,minimumFractionDigits:0}).format(e),T=e=>{const s={photography:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",videography:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300",virtual_tour:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",drone_photography:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300",floor_plan:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",staging:"bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-300",inspection:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",other:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"};return s[e]||s.other},O=()=>{const[O,V]=s.useState([]),[$,M]=s.useState(!0),[U,z]=s.useState(""),[B,q]=s.useState("active"),[H,J]=s.useState(null),[W,Q]=s.useState(!1),[X,G]=s.useState(!1),[K,Y]=s.useState(!1),[Z,ee]=s.useState(null),[se,te]=s.useState(""),[ae,de]=s.useState(""),[re,le]=s.useState(""),[ne,ie]=s.useState({}),[ce,oe]=s.useState(null),[me,xe]=s.useState(""),[ue,he]=s.useState(""),[pe,ge]=s.useState(""),[je,ve]=s.useState(""),[be,Ne]=s.useState(""),[fe,we]=s.useState("medium"),{toast:ye}=t();s.useEffect(()=>{Se()},[B,U]);const Se=async()=>{try{M(!0);const e=await a(`/subadmin/addon-services?status=${B}&search=${U}`),s=await d(e);V(s.data.vendorAddons||[])}catch(e){ye({title:"Error",description:e.message||"Error fetching addon services",variant:"destructive"}),V([])}finally{M(!1)}},ke=async e=>{ee(e),we("medium"),le(""),te(`Schedule ${e.name} Service`),de(`Dear Vendor,\n\nWe would like to schedule the ${e.name} service that you have purchased.\n\nPlease confirm the scheduled date and time for the service.\n\nService Details:\n- Name: ${e.name}\n- Description: ${e.description}\n- Category: ${e.category.charAt(0).toUpperCase()+e.category.slice(1)}\n\nThank you!\n\nBest regards,\nAdmin Team`),G(!0)},De=e=>{switch(e){case"completed":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"in_progress":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"scheduled":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200";case"cancelled":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200"}},Ae=e=>{switch(e){case"urgent":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";case"high":return"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200";case"medium":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";default:return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"}};return $&&0===O.length?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Addon Services"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage vendor addon services and schedule appointments"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Addon Services"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"View vendors who have purchased addon services and schedule appointments"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs(r,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Active Vendors"}),e.jsx(i,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold",children:O.filter(e=>e.totalAddons>0).length})})]}),e.jsxs(r,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Total Addons"}),e.jsx(o,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold",children:O.reduce((e,s)=>e+s.totalAddons,0)})})]}),e.jsxs(r,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Scheduled"}),e.jsx(F,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:O.reduce((e,s)=>e+(s.schedules?.length||0),0)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[O.reduce((e,s)=>e+(s.schedules?.filter(e=>"completed"===e.status).length||0),0)," completed"]})]})]}),e.jsxs(r,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"In Progress"}),e.jsx(o,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:O.reduce((e,s)=>e+(s.schedules?.filter(e=>"in_progress"===e.status).length||0),0)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[O.reduce((e,s)=>e+(s.schedules?.filter(e=>"scheduled"===e.status).length||0),0)," scheduled"]})]})]}),e.jsxs(r,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Categories"}),e.jsx(o,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold",children:new Set(O.flatMap(e=>e.activeAddons.map(e=>e.category))).size})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Search vendors...",value:U,onChange:e=>z(e.target.value),className:"pl-10"})]}),e.jsxs(u,{value:B,onValueChange:q,children:[e.jsxs(h,{children:[e.jsx(p,{value:"active",children:"Active Subscriptions"}),e.jsx(p,{value:"expired",children:"Expired"}),e.jsx(p,{value:"all",children:"All Vendors"})]}),e.jsx(g,{value:B,className:"space-y-4 mt-6",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(C,{children:[e.jsx(_,{children:e.jsxs(E,{children:[e.jsx(P,{children:"Vendor"}),e.jsx(P,{children:"Contact"}),e.jsx(P,{children:"Active Addons"}),e.jsx(P,{children:"Total Value"}),e.jsx(P,{children:"Scheduled"}),e.jsx(P,{className:"text-right",children:"Actions"})]})}),e.jsx(L,{children:0===O.length?e.jsx(E,{children:e.jsx(R,{colSpan:6,className:"h-24 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(o,{className:"h-8 w-8 text-muted-foreground mb-2"}),e.jsx("p",{children:"No addon services found"})]})})}):O.map(s=>e.jsxs(E,{children:[e.jsx(R,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-medium",children:[s.user.profile.firstName," ",s.user.profile.lastName]}),e.jsxs(j,{variant:"outline",className:"w-fit mt-1",children:[s.totalAddons," Addon",1!==s.totalAddons?"s":""]})]})}),e.jsx(R,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:s.user.email})}),e.jsx(R,{children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.activeAddons.slice(0,2).map(s=>e.jsx(j,{className:T(s.category),variant:"secondary",children:s.name},s._id)),s.activeAddons.length>2&&e.jsxs(j,{variant:"outline",children:["+",s.activeAddons.length-2," more"]})]})}),e.jsx(R,{children:e.jsx("div",{className:"font-bold text-primary",children:I(s.activeAddons.reduce((e,s)=>e+s.price,0))})}),e.jsx(R,{children:s.schedules&&s.schedules.length>0?e.jsxs("div",{className:"flex flex-col gap-1",children:[s.schedules.slice(0,1).map(s=>e.jsx(j,{className:De(s.status),variant:"outline",children:s.status.replace("_"," ")},s._id)),s.schedules.length>1&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",s.schedules.length-1," more"]})]}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})}),e.jsx(R,{className:"text-right",children:e.jsxs(v,{variant:"ghost",size:"sm",onClick:()=>{J(s),Q(!0)},children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),"Details"]})})]},s._id))})]})})})]}),e.jsx(N,{open:W,onOpenChange:Q,children:e.jsxs(f,{className:"max-w-3xl max-h-[85vh] overflow-y-auto",children:[e.jsxs(w,{children:[e.jsx(y,{children:"Vendor Addon Services"}),e.jsx(S,{children:"Detailed information about vendor's purchased addon services"})]}),H&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Vendor Information"}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("p",{className:"font-medium",children:[H.user.profile.firstName," ",H.user.profile.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:H.user.email}),e.jsxs("p",{className:"text-sm mt-2",children:[e.jsx("strong",{children:"Total Addons:"})," ",H.totalAddons]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Active Addon Services"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:H.activeAddons.map(s=>{const t=H.schedules?.find(e=>e.addon._id===s._id&&["scheduled","in_progress"].includes(e.status)),a=!!t,d=H.subscriptions.some(e=>e.addons.some(e=>e._id===s._id)&&"active"===e.status&&new Date(e.endDate)>new Date);return e.jsxs(r,{className:"hover:shadow-md transition-shadow",children:[e.jsx(l,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(n,{className:"text-sm",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(j,{className:T(s.category),children:s.category}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.billingType.replace("_"," ")}),a&&e.jsx(j,{className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:"Scheduled"}),!d&&e.jsx(j,{variant:"destructive",className:"text-[10px] h-5",children:"Expired"})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"font-bold text-primary",children:I(s.price,s.currency)})})]})}),e.jsxs(c,{className:"pt-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:s.description}),a?d?e.jsxs(v,{size:"sm",className:"w-full bg-amber-500 hover:bg-amber-600 text-white",onClick:()=>{Q(!1),ke(s)},children:[e.jsx(F,{className:"h-3 w-3 mr-2"}),"Re-schedule Service"]}):e.jsx("div",{className:"w-full py-2 text-center text-sm text-muted-foreground bg-muted rounded-md border border-border",children:"Service Scheduled (Expired)"}):d?e.jsxs(v,{size:"sm",className:"w-full",onClick:()=>{Q(!1),ke(s)},children:[e.jsx(F,{className:"h-3 w-3 mr-2"}),"Schedule This Service"]}):e.jsx("div",{className:"w-full py-2 text-center text-sm text-muted-foreground bg-muted rounded-md border border-border",children:"Subscription Expired"})]})]},s._id)})})]}),H.schedules&&H.schedules.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-4",children:["Service Schedules (",H.schedules.length,")"]}),e.jsx("div",{className:"space-y-3",children:H.schedules.map(s=>e.jsx(r,{className:"hover:shadow-md transition-shadow",children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.addon.name}),e.jsx(j,{className:De(s.status),children:s.status.replace("_"," ")}),e.jsx(j,{className:Ae(s.priority),variant:"outline",children:s.priority})]}),s.scheduledDate&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["ðŸ“… ",new Date(s.scheduledDate).toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Created: ",new Date(s.createdAt).toLocaleDateString()]}),s.notes&&s.notes.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t",children:[e.jsx("p",{className:"text-xs font-medium",children:"Latest Note:"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.notes[s.notes.length-1].message.substring(0,100),s.notes[s.notes.length-1].message.length>100?"...":""]})]})]}),e.jsx(v,{size:"sm",variant:"outline",onClick:()=>{Q(!1),(e=>{oe(e),xe(e.status),he(e.scheduledDate?new Date(e.scheduledDate).toISOString().slice(0,16):""),ge(e.vendorResponse||""),ve(e.cancellationReason||""),Y(!0)})(s)},children:"Manage"})]})})},s._id))})]}),H.subscriptions.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Subscription History"}),e.jsx("div",{className:"space-y-2",children:H.subscriptions.map(s=>e.jsx("div",{className:"bg-muted p-3 rounded-lg text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium",children:["Status: ",e.jsx(j,{variant:"active"===s.status?"default":"secondary",children:s.status})]}),e.jsxs("span",{className:"text-muted-foreground",children:[new Date(s.startDate).toLocaleDateString()," - ",new Date(s.endDate).toLocaleDateString()]})]})},s._id))})]})]})]})}),e.jsx(N,{open:X,onOpenChange:G,children:e.jsxs(f,{className:"max-w-2xl",children:[e.jsxs(w,{children:[e.jsx(y,{children:"Schedule Addon Service"}),e.jsx(S,{children:"Send a scheduling email to the vendor for their purchased addon service"})]}),H&&Z&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("p",{className:"font-medium",children:["Vendor: ",H.user.profile.firstName," ",H.user.profile.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:H.user.email}),e.jsxs("p",{className:"text-sm mt-1",children:[e.jsx("strong",{children:"Service:"})," ",Z.name]})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"subject",children:"Email Subject"}),e.jsx(x,{id:"subject",value:se,onChange:e=>te(e.target.value),placeholder:"Enter email subject"})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"priority",children:"Priority"}),e.jsxs("select",{id:"priority",value:fe,onChange:e=>we(e.target.value),className:"w-full p-2 border rounded-md",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"scheduledDate",children:"Scheduled Service Date & Time *"}),e.jsx(x,{id:"scheduledDate",type:"datetime-local",value:re,onChange:e=>le(e.target.value),min:(new Date).toISOString().slice(0,16),className:"w-full",required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Select when this service will be performed"})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"message",children:"Email Message"}),e.jsx(D,{id:"message",value:ae,onChange:e=>de(e.target.value),placeholder:"Enter email message",rows:8})]})]}),e.jsxs(A,{children:[e.jsx(v,{variant:"outline",onClick:()=>G(!1),children:"Cancel"}),e.jsx(v,{onClick:async()=>{if(!H||!Z)return;if(!re)return void ye({title:"Error",description:"Please select a scheduled date for the service",variant:"destructive"});const e=H.subscriptions.find(e=>e.addons.some(e=>e._id===Z._id));if(e)try{ie({...ne,email:!0});const s=await a("/subadmin/addon-services/schedule",{method:"POST",body:JSON.stringify({vendorId:H.user._id,addonId:Z._id,subscriptionId:e._id,subject:se,message:ae,vendorEmail:H.user.email,priority:fe,scheduledDate:re})});await d(s);ye({title:"Success",description:"Service scheduled successfully and email sent to vendor"}),G(!1),ee(null),le(""),Se()}catch(s){ye({title:"Error",description:s.message||"Failed to schedule service",variant:"destructive"})}finally{ie({...ne,email:!1})}else ye({title:"Error",description:"No subscription found for this addon",variant:"destructive"})},disabled:ne.email||!se||!ae||!re,children:ne.email?"Scheduling...":"Schedule & Send Email"})]})]})}),e.jsx(N,{open:K,onOpenChange:Y,children:e.jsxs(f,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(w,{children:[e.jsx(y,{children:"Manage Service Schedule"}),e.jsx(S,{children:"Update status, add notes, and track service progress"})]}),ce&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-lg",children:ce.addon.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:De(ce.status),children:ce.status.replace("_"," ")}),e.jsx(j,{className:Ae(ce.priority),children:ce.priority})]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Scheduled by: ",ce.scheduledBy.profile.firstName," ",ce.scheduledBy.profile.lastName," (",ce.scheduledBy.email,")"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Created: ",new Date(ce.createdAt).toLocaleString()]}),ce.scheduledDate&&e.jsxs("p",{className:"text-sm font-semibold text-green-600 dark:text-green-400",children:["ðŸ—“ï¸ Service Date: ",new Date(ce.scheduledDate).toLocaleString()]}),ce.inProgressAt&&e.jsxs("p",{className:"text-sm font-semibold text-blue-600 dark:text-blue-400",children:["ðŸ”„ Started: ",new Date(ce.inProgressAt).toLocaleString()]}),ce.completedAt&&e.jsxs("p",{className:"text-sm font-semibold text-green-700 dark:text-green-300",children:["âœ“ Completed: ",new Date(ce.completedAt).toLocaleString()]}),ce.cancelledAt&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-sm font-semibold text-red-600 dark:text-red-400",children:["âœ— Cancelled: ",new Date(ce.cancelledAt).toLocaleString()]}),ce.cancellationReason&&e.jsxs("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1 p-2 bg-red-50 dark:bg-red-950 rounded",children:["Reason: ",ce.cancellationReason]})]}),e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-2 p-2 bg-amber-50 dark:bg-amber-950 rounded",children:"âš ï¸ Status updates will automatically send email notifications to the vendor"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Original Email"}),e.jsxs("div",{className:"bg-muted/50 p-3 rounded-md space-y-2 border",children:[e.jsx("p",{className:"font-medium text-sm",children:ce.emailSubject}),e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:ce.emailMessage})]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold",children:"Update Status"}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",value:me,onChange:e=>xe(e.target.value),className:"w-full p-2 border rounded-md",disabled:"completed"===ce?.status||"cancelled"===ce?.status,children:[e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}),("completed"===ce?.status||"cancelled"===ce?.status)&&e.jsxs("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-1",children:["âš ï¸ Cannot change status from ",ce.status]}),ce?.scheduledDate&&("in_progress"===me||"completed"===me)&&(new Date(ce.scheduledDate)>new Date?e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1 p-2 bg-red-50 dark:bg-red-950 rounded",children:['âš ï¸ Cannot mark as "',me.replace("_"," "),'" before scheduled date (',new Date(ce.scheduledDate).toLocaleString(),")"]}):e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:"âœ“ Service date has passed, can proceed"}))]}),"cancelled"===me&&e.jsxs("div",{children:[e.jsx(k,{htmlFor:"cancellationReason",children:"Cancellation Reason *"}),e.jsx(D,{id:"cancellationReason",value:je,onChange:e=>ve(e.target.value),placeholder:"Please provide the reason for cancellation...",rows:3,required:!0,className:"border-red-300 focus:border-red-500"}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:"* Cancellation reason is required. Email will be sent to vendor."})]}),"in_progress"===me&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950 p-3 rounded-md border border-blue-200 dark:border-blue-800",children:[e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:'ðŸ”„ "In Progress" timestamp will be automatically recorded and vendor will be notified via email'}),ce?.inProgressAt&&e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:["Started on: ",new Date(ce.inProgressAt).toLocaleString()]})]}),"completed"===me&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-950 p-3 rounded-md border border-green-200 dark:border-green-800",children:[e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"âœ“ Completion date will be automatically set and vendor will receive completion email"}),ce?.completedAt&&e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:["Completed on: ",new Date(ce.completedAt).toLocaleString()]})]}),"completed"!==me&&"cancelled"!==me&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(k,{htmlFor:"scheduledDate",children:"in_progress"===me?"In Progress Since":"Scheduled Date & Time"}),e.jsx(x,{id:"scheduledDate",type:"datetime-local",value:ue,onChange:e=>he(e.target.value),className:"w-full"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:ce?.scheduledDate?`Current: ${new Date(ce.scheduledDate).toLocaleString()}`:"Not set"}),ue&&ue!==new Date(ce?.scheduledDate||"").toISOString().slice(0,16)&&e.jsx("p",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1 p-2 bg-orange-50 dark:bg-orange-950 rounded",children:"ðŸ“§ Re-scheduling email will be sent to vendor with new date"})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"vendorResponse",children:"Vendor Response/Notes"}),e.jsx(D,{id:"vendorResponse",value:pe,onChange:e=>ge(e.target.value),placeholder:"Enter vendor response or status update notes...",rows:3})]})]}),e.jsx(v,{onClick:async()=>{if(ce)if("cancelled"!==me||je.trim())try{ie({...ne,status:!0});const e=await a(`/subadmin/addon-services/schedule/${ce._id}/status`,{method:"PATCH",body:JSON.stringify({status:me,scheduledDate:ue||void 0,vendorResponse:pe||void 0,cancellationReason:"cancelled"===me?je:void 0})});await d(e),ye({title:"Success",description:"cancelled"===me?"Service cancelled successfully":"completed"===me?"Service marked as completed":"Schedule status updated successfully"}),Y(!1),oe(null),ve(""),Se()}catch(e){ye({title:"Error",description:e.message||"Failed to update schedule status",variant:"destructive"})}finally{ie({...ne,status:!1})}else ye({title:"Validation Error",description:"Please provide a cancellation reason",variant:"destructive"})},disabled:ne.status||"completed"===ce?.status||"cancelled"===ce?.status||"cancelled"===me&&!je.trim(),className:"w-full",children:ne.status?"Updating...":"Update Status & Send Email"})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold",children:"Communication Notes"}),ce.notes&&ce.notes.length>0&&e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Previous notes:"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:ce.notes.map((s,t)=>e.jsxs("div",{className:"bg-muted/50 p-3 rounded-md border text-sm",children:[e.jsx("p",{className:"whitespace-pre-wrap",children:s.message}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["- ",s.author.profile.firstName," ",s.author.profile.lastName," on ",new Date(s.createdAt).toLocaleString()]})]},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"newNote",children:"Add New Note"}),e.jsx(D,{id:"newNote",value:be,onChange:e=>Ne(e.target.value),placeholder:"Add a communication note or update...",rows:3}),e.jsx(v,{onClick:async()=>{if(ce&&be.trim())try{ie({...ne,note:!0});const e=await a(`/subadmin/addon-services/schedule/${ce._id}/notes`,{method:"POST",body:JSON.stringify({message:be})}),s=await d(e);ye({title:"Success",description:"Note added successfully"}),Ne(""),s.data?.schedule&&oe(s.data.schedule),Se()}catch(e){ye({title:"Error",description:e.message||"Failed to add note",variant:"destructive"})}finally{ie({...ne,note:!1})}},disabled:ne.note||!be.trim(),variant:"outline",className:"w-full",children:ne.note?"Adding...":"Add Note"})]})]})]}),e.jsx(A,{children:e.jsx(v,{variant:"outline",onClick:()=>Y(!1),children:"Close"})})]})})]})};export{O as default};

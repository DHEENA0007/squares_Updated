import{j as e}from"./ui-s1SEoZIF.js";import{e as s,d as t,r as i}from"./router-D8v2YSKU.js";import{a2 as a,G as r,f as n,A as l,B as c,a as d,e as o,U as p,h as m,g as h,b as x,c as u,d as g,L as j,I as f,T as b,q as v,r as y,s as N,v as w,w as k,a9 as C,aO as S}from"./index-DvBXyKtT.js";import{C as P}from"./checkbox-XS8tCCHA.js";import{A,a as F}from"./alert-Cbv3ShML.js";import{p as E}from"./planService-BDwsJXuj.js";import{T as I}from"./trending-up-D3HFnEB_.js";import{I as L}from"./info-BKFYLDRV.js";import{C as H}from"./circle-alert-B6eCZAbs.js";import"./vendor-BxThA0WO.js";const M=()=>{const{id:M}=s(),B=t(),{toast:D}=a(),[O,R]=i.useState(null),[U,z]=i.useState(!0),[T,W]=i.useState(!1),[q,K]=i.useState({name:"",description:""}),[V,$]=i.useState({name:"",description:"",icon:""}),[G,J]=i.useState(null);i.useEffect(()=>{(async()=>{if(M)try{z(!0);const e=(await E.getPlan(M)).data.plan,s=e.features.map(e=>"string"==typeof e?{name:e,description:"",enabled:!0}:e);let t=[];if(Array.isArray(e.benefits))t=e.benefits;else if(e.benefits&&"object"==typeof e.benefits){const s={topRated:{name:"Top Rated Badge",description:"Vendor gets a top-rated badge",icon:"star"},verifiedBadge:{name:"Verified Owner Badge",description:"Shows verified status",icon:"shield-check"},marketingManager:{name:"Marketing Manager",description:"Access to marketing tools",icon:"trending-up"},commissionBased:{name:"Commission Based Revenue",description:"Earn from commission-based model",icon:"dollar-sign"}};t=Object.entries(e.benefits).filter(([e,t])=>"boolean"==typeof t&&s[e]).map(([e,t])=>({key:e,name:s[e].name,description:s[e].description,enabled:t,icon:s[e].icon}))}R({...e,features:s,benefits:t,limits:{properties:e.limits?.properties||0,featuredListings:e.limits?.featuredListings||0,photos:e.limits?.photos||10,videoTours:e.limits?.videoTours||0,leads:e.limits?.leads||0,videos:e.limits?.videos||0,posters:e.limits?.posters||0,messages:e.limits?.messages||0,leadManagement:e.limits?.leadManagement||"basic"},whatsappSupport:{enabled:e.whatsappSupport?.enabled||!1,number:e.whatsappSupport?.number||""}}),J({activeSubscriptions:e.subscriberCount||0,note:"Existing subscribers will keep their current plan features (snapshot). Only new subscriptions will get updated features."})}catch(e){D({title:"Error",description:"Failed to load plan data.",variant:"destructive"}),B("/admin/plans")}finally{z(!1)}})()},[M,B,D]);const Q=()=>{O&&q.name.trim()&&(R({...O,features:[...O.features,{...q,enabled:!0}]}),K({name:"",description:""}))},X=()=>{if(!O||!V.name.trim())return;const e=V.name.toLowerCase().replace(/\s+/g,"").replace(/[^a-z0-9]/g,"");R({...O,benefits:[...O.benefits,{key:e,name:V.name,description:V.description,enabled:!0,icon:V.icon||"star"}]}),$({name:"",description:"",icon:""})};return U?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(r,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading plan..."})]}):O?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>B("/admin/plans"),children:e.jsx(l,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight",children:["Edit Plan: ",O.name]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Update plan details and pricing"})]}),O.isActive&&e.jsx(c,{variant:"default",className:"ml-auto",children:"Active"}),!O.isActive&&e.jsx(c,{variant:"secondary",className:"ml-auto",children:"Inactive"})]}),e.jsx(d,{className:"border-blue-200 bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-950/30 dark:to-blue-900/20",children:e.jsxs(o,{className:"pt-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-white dark:bg-gray-800 rounded-lg",children:e.jsx(p,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Active Subscribers"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:G?.activeSubscriptions||0})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-white dark:bg-gray-800 rounded-lg",children:e.jsx(I,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Current Price"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["₹",O.price]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-white dark:bg-gray-800 rounded-lg",children:e.jsx(m,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Billing"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white capitalize",children:O.billingPeriod})]})]})]}),O.priceHistory&&O.priceHistory.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"my-4"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(L,{className:"h-4 w-4 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("strong",{children:"Price History:"})," Last updated from ₹",O.priceHistory[O.priceHistory.length-2]?.price||"N/A"," to ₹",O.price,O.priceHistory[O.priceHistory.length-1]?.changedAt&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",new Date(O.priceHistory[O.priceHistory.length-1].changedAt).toLocaleDateString(),")"]})]})]})]})]})}),e.jsxs(A,{className:"border-amber-200 bg-amber-50 dark:bg-amber-950/20",children:[e.jsx(H,{className:"h-4 w-4 text-amber-600"}),e.jsxs(F,{className:"text-amber-900 dark:text-amber-100",children:[e.jsx("strong",{children:"Important:"})," ",G?.note||"Changes to this plan will only affect new subscriptions. Existing subscribers will keep their current plan features and pricing."]})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),O&&M)try{W(!0),await E.updatePlan(M,O),B("/admin/plans")}catch(s){}finally{W(!1)}},className:"space-y-6",children:[e.jsxs(d,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Basic Information"}),e.jsx(g,{children:"Core plan details visible to all users"})]}),e.jsxs(o,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"name",children:"Plan Name *"}),e.jsx(f,{id:"name",value:O.name,onChange:e=>R({...O,name:e.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(j,{htmlFor:"description",children:"Description *"}),e.jsx(b,{id:"description",value:O.description,onChange:e=>R({...O,description:e.target.value}),required:!0,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"price",children:"Price *"}),e.jsx(f,{id:"price",type:"number",step:"0.01",min:"0",value:O.price,onChange:e=>R({...O,price:parseFloat(e.target.value)||0}),required:!0}),O.priceHistory&&O.priceHistory.length>1&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Previous: ₹",O.priceHistory[O.priceHistory.length-2]?.price||"N/A"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"currency",children:"Currency"}),e.jsxs(v,{value:O.currency,onValueChange:e=>R({...O,currency:e}),children:[e.jsx(y,{children:e.jsx(N,{})}),e.jsxs(w,{children:[e.jsx(k,{value:"INR",children:"INR (₹)"}),e.jsx(k,{value:"USD",children:"USD ($)"}),e.jsx(k,{value:"EUR",children:"EUR (€)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"billingCycleMonths",children:"Billing Period (Months) *"}),e.jsx(f,{id:"billingCycleMonths",type:"number",min:"1",max:"120",value:O.billingCycleMonths||1,onChange:e=>{const s=parseInt(e.target.value)||1;let t="custom";1===s?t="monthly":12===s&&(t="yearly"),R({...O,billingPeriod:t,billingCycleMonths:s})},placeholder:"Enter number of months (1-120)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Enter the billing cycle in months. Common values: 1 (monthly), 12 (yearly)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"sortOrder",children:"Sort Order"}),e.jsx(f,{id:"sortOrder",type:"number",min:"0",value:O.sortOrder,onChange:e=>R({...O,sortOrder:parseInt(e.target.value)||0})})]})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{id:"isActive",checked:O.isActive,onCheckedChange:e=>R({...O,isActive:e})}),e.jsx(j,{htmlFor:"isActive",className:"cursor-pointer",children:"Active"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{id:"isPopular",checked:O.isPopular,onCheckedChange:e=>R({...O,isPopular:e})}),e.jsx(j,{htmlFor:"isPopular",className:"cursor-pointer",children:"Mark as Popular"})]})]})]})]}),e.jsxs(d,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Usage Limits"}),e.jsx(g,{children:"Define usage quotas for this plan"})]}),e.jsx(o,{className:"space-y-6",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"properties",children:"Property Listings"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{id:"properties",type:"number",min:"1",value:null===O.limits.properties||-1===O.limits.properties?"":O.limits.properties,onChange:e=>R({...O,limits:{...O.limits,properties:parseInt(e.target.value)||1}}),placeholder:null===O.limits.properties||-1===O.limits.properties?"∞ Unlimited":"Enter number",disabled:null===O.limits.properties||-1===O.limits.properties}),e.jsx(n,{type:"button",variant:null===O.limits.properties||-1===O.limits.properties?"default":"outline",size:"icon",onClick:()=>R({...O,limits:{...O.limits,properties:null===O.limits.properties||-1===O.limits.properties?5:null}}),title:null===O.limits.properties||-1===O.limits.properties?"Set limited":"Set unlimited (infinity)",children:"∞"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:null===O.limits.properties||-1===O.limits.properties?"Unlimited properties (∞)":`Limited to ${O.limits.properties} properties`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"featuredListings",children:"Featured Listings"}),e.jsx(f,{id:"featuredListings",type:"number",min:"0",value:O.limits.featuredListings,onChange:e=>R({...O,limits:{...O.limits,featuredListings:parseInt(e.target.value)||0}})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Highlighted in search"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"leads",children:"Monthly Leads"}),e.jsx(f,{id:"leads",type:"number",min:"0",value:O.limits.leads,onChange:e=>R({...O,limits:{...O.limits,leads:parseInt(e.target.value)||0}})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"0 = unlimited"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"photos",children:"Photos per Property"}),e.jsx(f,{id:"photos",type:"number",min:"1",max:"100",value:O.limits.photos,onChange:e=>R({...O,limits:{...O.limits,photos:parseInt(e.target.value)||10}})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Max photos per property"})]})]})})]}),e.jsxs(d,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Plan Badges"}),e.jsx(g,{children:"Badges displayed on vendor profiles and home page for users who purchase this plan"})]}),e.jsxs(o,{className:"space-y-6",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{placeholder:"Badge name (e.g., Top Rated, Verified)...",value:V.name,onChange:e=>$({...V,name:e.target.value}),onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),X()),className:"flex-1"}),e.jsx(f,{placeholder:"Description (e.g., Highly rated professional)...",value:V.description,onChange:e=>$({...V,description:e.target.value}),onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),X()),className:"flex-1"}),e.jsx(f,{placeholder:"Icon (star, shield, etc)...",value:V.icon,onChange:e=>$({...V,icon:e.target.value}),onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),X()),className:"w-32"}),e.jsx(n,{type:"button",onClick:X,size:"icon",children:e.jsx(C,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[O.benefits.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg hover:bg-muted/80 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx(P,{id:`benefit-${t}`,checked:s.enabled,onCheckedChange:()=>(e=>{if(!O)return;const s=[...O.benefits];s[e]={...s[e],enabled:!s[e].enabled},R({...O,benefits:s})})(t)}),e.jsxs("div",{className:"flex-1",children:[e.jsx(j,{htmlFor:`benefit-${t}`,className:"cursor-pointer text-sm font-medium",children:s.name}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description}),s.icon&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Icon: ",s.icon]})]})]}),e.jsx(n,{type:"button",variant:"ghost",size:"icon",onClick:()=>(e=>{O&&R({...O,benefits:O.benefits.filter((s,t)=>t!==e)})})(t),children:e.jsx(S,{className:"w-4 h-4"})})]},t)),0===O.benefits.length&&e.jsxs(A,{children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx(F,{children:'No badges added yet. Add badges to highlight this plan on vendor profiles and the home page. Example badges: "Top Rated", "Verified", "Marketing Pro"'})]})]})]})]}),e.jsxs(d,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"WhatsApp Support"}),e.jsx(g,{children:"Configure WhatsApp contact for properties under this plan"})]}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{id:"whatsappEnabled",checked:O.whatsappSupport?.enabled||!1,onCheckedChange:e=>R({...O,whatsappSupport:{...O.whatsappSupport,enabled:e}})}),e.jsx(j,{htmlFor:"whatsappEnabled",className:"cursor-pointer",children:"Enable WhatsApp Contact Button for Properties"})]}),O.whatsappSupport?.enabled&&e.jsxs("div",{className:"space-y-2 pl-6",children:[e.jsx(j,{htmlFor:"whatsappNumber",children:"WhatsApp Number *"}),e.jsx(f,{id:"whatsappNumber",type:"text",placeholder:"+91 90807 20215",value:O.whatsappSupport?.number||"",onChange:e=>R({...O,whatsappSupport:{...O.whatsappSupport,enabled:!0,number:e.target.value}})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Include country code (e.g., +91 for India). This number will be shown to customers for properties under this plan."})]}),!O.whatsappSupport?.enabled&&e.jsxs(A,{children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx(F,{children:"When enabled, customers will see a WhatsApp contact button instead of regular phone/message buttons for properties under this plan."})]})]})]}),e.jsxs(d,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Features"}),e.jsx(g,{children:"List all features included in this plan"})]}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{placeholder:"Feature name...",value:q.name,onChange:e=>K({...q,name:e.target.value}),onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),Q()),className:"flex-1"}),e.jsx(f,{placeholder:"Description (optional)",value:q.description,onChange:e=>K({...q,description:e.target.value}),onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),Q()),className:"flex-1"}),e.jsx(n,{type:"button",onClick:Q,size:"icon",children:e.jsx(C,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[O.features.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg hover:bg-muted/80 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium",children:s.name}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description})]}),e.jsx(n,{type:"button",variant:"ghost",size:"icon",onClick:()=>(e=>{O&&R({...O,features:O.features.filter((s,t)=>t!==e)})})(t),children:e.jsx(S,{className:"w-4 h-4"})})]},t)),0===O.features.length&&e.jsxs(A,{children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx(F,{children:"No features added yet. Add features to help users understand what's included in this plan."})]})]})]})]}),e.jsx(d,{className:"border-green-200 bg-green-50 dark:bg-green-950/20",children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(L,{className:"h-5 w-5 text-green-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-green-900 dark:text-green-100 mb-2",children:"Subscription Management"}),e.jsxs("ul",{className:"space-y-1 text-sm text-green-800 dark:text-green-200",children:[e.jsx("li",{children:"✓ All changes are tracked in plan history"}),e.jsxs("li",{children:["✓ Existing ",G?.activeSubscriptions||0," subscriber(s) keep their current plan details"]}),e.jsx("li",{children:"✓ New subscriptions will use the updated plan configuration"}),e.jsx("li",{children:"✓ Price changes won't affect active subscribers until renewal"})]})]})]})})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(n,{type:"submit",disabled:T,children:[T&&e.jsx(r,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Changes"]}),e.jsx(n,{type:"button",variant:"outline",onClick:()=>B("/admin/plans"),children:"Cancel"})]})]})]}):e.jsx("div",{children:"Plan not found"})};export{M as default};

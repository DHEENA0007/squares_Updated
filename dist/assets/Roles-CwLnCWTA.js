import{j as e}from"./ui-BHyUY8Z8.js";import{d as re,r as a}from"./router-2SVJvIbS.js";import{G as $,u as ce,H as U,f as j,V as de,a as c,b as d,c as o,e as m,S as u,d as k,B as n,U as T,J as oe,K as me,O as xe,Q as he,R as ue,ap as je,a5 as ge,a6 as pe,a7 as fe,aq as ve,ar as V,a8 as L,t as B}from"./index-Bd1eLXM_.js";import{P as Ne,a as be,b as _,c as ye,d as we,e as Se}from"./pagination-Rt-SIkt9.js";import{D as Re}from"./DataTable-CTGqJfvj.js";import{S as Ae}from"./SearchFilter-CUuDsF9n.js";import{r as F}from"./roleService-aAI-qze7.js";import{S as I}from"./square-pen-B2xeg6m_.js";import{E as Ce}from"./ellipsis-CXpaKV_5.js";import{T as De}from"./trash-2-DTVLnEp9.js";import"./vendor-Dazix4UH.js";import"./table-DaOINtos.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=$("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=$("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),ze=()=>{const p=re(),{isSuperAdmin:w}=ce(),[S,z]=a.useState(""),[f,H]=a.useState("all"),[v,R]=a.useState([]),[q,M]=a.useState(!0),[r,g]=a.useState(1),[N,G]=a.useState(1),[A,E]=a.useState(0),[l,J]=a.useState(null),[i,K]=a.useState(null),[Q,b]=a.useState(!1),[x,C]=a.useState(null),[D,O]=a.useState(!1),W=async()=>{try{M(!0);const s={page:r,limit:10,search:S||void 0,isActive:f==="all"?void 0:f==="active"},t=await F.getRoles(s);R(t.data.roles),G(t.data.pagination.totalPages),E(t.data.pagination.totalRoles);const h=t.data.roles.find(P=>P.name.toLowerCase()==="superadmin"),y=t.data.roles.find(P=>P.name.toLowerCase()==="subadmin");J(h||null),K(y||null)}catch(s){console.error("Failed to fetch roles:",s)}finally{M(!1)}};a.useEffect(()=>{W()},[r,S,f]);const X=s=>{z(s),g(1)},Y=s=>{H(s),g(1)},Z=s=>{g(s)},ee=()=>{r<N&&g(r+1)},se=()=>{r>1&&g(r-1)},te=async s=>{try{const t=await F.toggleRoleStatus(s._id);R(h=>h.map(y=>y._id===t.data.role._id?t.data.role:y)),B({title:"Success",description:`Role ${t.data.role.isActive?"activated":"deactivated"} successfully!`})}catch(t){console.error("Failed to toggle role status:",t)}},ae=async()=>{if(x)try{O(!0),await F.deleteRole(x._id),b(!1);const s=x._id;C(null),R(t=>t.filter(h=>h._id!==s)),E(t=>t-1),B({title:"Success",description:"Role deleted successfully!"})}catch(s){console.error("Failed to delete role:",s)}finally{O(!1)}},le=s=>{C(s),b(!0)},ie=s=>{const t=s.name.toLowerCase();return t==="superadmin"?e.jsxs(n,{variant:"destructive",className:"text-xs bg-red-600",children:[e.jsx(u,{className:"w-3 h-3 mr-1"}),"Super Admin"]}):t==="subadmin"?e.jsxs(n,{variant:"default",className:"text-xs bg-orange-600",children:[e.jsx(u,{className:"w-3 h-3 mr-1"}),"Sub Admin"]}):s.isSystemRole?e.jsxs(n,{variant:"outline",className:"text-xs",children:[e.jsx(u,{className:"w-3 h-3 mr-1"}),"System"]}):null},ne=[{key:"name",label:"Role Name",render:s=>e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[s.name,ie(s)]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description})]})},{key:"level",label:"Level",render:s=>e.jsxs(n,{variant:s.level>=8?"destructive":s.level>=5?"default":"secondary",children:["Level ",s.level]})},{key:"permissions",label:"Permissions",render:s=>e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.permissions.slice(0,2).map((t,h)=>e.jsx(n,{variant:"secondary",className:"text-xs",children:t.replace(/_/g," ")},h)),s.permissions.length>2&&e.jsxs(n,{variant:"secondary",className:"text-xs",children:["+",s.permissions.length-2]})]})},{key:"userCount",label:"Users",render:s=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:s.userCount||0})]})},{key:"isActive",label:"Status",render:s=>e.jsx(n,{variant:s.isActive?"default":"secondary",children:s.isActive?"Active":"Inactive"})},{key:"actions",label:"Actions",render:s=>e.jsxs(ge,{children:[e.jsx(pe,{asChild:!0,children:e.jsxs(j,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Ce,{className:"w-4 h-4"})]})}),e.jsxs(fe,{align:"end",className:"w-48",children:[e.jsx(ve,{children:"Actions"}),e.jsx(V,{}),e.jsxs(L,{onClick:t=>{t.stopPropagation(),p(`/admin/roles/edit/${s._id}`)},className:"cursor-pointer",children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),s.isSystemRole&&!w?"View Role":"Edit Role"]}),e.jsxs(L,{onClick:t=>{t.stopPropagation(),te(s)},disabled:s.isSystemRole&&s.isActive&&!w,className:"cursor-pointer",children:[s.isActive?e.jsx(Pe,{className:"w-4 h-4 mr-2"}):e.jsx(ke,{className:"w-4 h-4 mr-2"}),s.isActive?"Deactivate":"Activate"]}),e.jsx(V,{}),e.jsxs(L,{onClick:t=>{t.stopPropagation(),le(s)},disabled:s.isSystemRole&&!w,className:"text-destructive focus:text-destructive cursor-pointer",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Delete Role"]})]})]})}];return q?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(U,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading roles..."})]}):e.jsxs("div",{className:"space-y-6 relative top-[60px]",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Role Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage user roles and permissions"})]}),e.jsxs(j,{onClick:()=>p("/admin/roles/add"),className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Add New Role"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-3",children:[e.jsxs(c,{children:[e.jsx(d,{className:"pb-1",children:e.jsx(o,{className:"text-xs font-medium text-gray-600",children:"Total Roles"})}),e.jsx(m,{className:"pt-1",children:e.jsx("div",{className:"text-lg sm:text-xl font-bold",children:A})})]}),e.jsxs(c,{children:[e.jsx(d,{className:"pb-1",children:e.jsx(o,{className:"text-xs font-medium text-gray-600",children:"Active Roles"})}),e.jsx(m,{className:"pt-1",children:e.jsx("div",{className:"text-lg sm:text-xl font-bold text-green-600",children:v.filter(s=>s.isActive).length})})]}),e.jsxs(c,{children:[e.jsx(d,{className:"pb-1",children:e.jsx(o,{className:"text-xs font-medium text-gray-600",children:"System Roles"})}),e.jsx(m,{className:"pt-1",children:e.jsx("div",{className:"text-lg sm:text-xl font-bold text-blue-600",children:v.filter(s=>s.isSystemRole).length})})]}),e.jsxs(c,{children:[e.jsx(d,{className:"pb-1",children:e.jsx(o,{className:"text-xs font-medium text-gray-600",children:"Custom Roles"})}),e.jsx(m,{className:"pt-1",children:e.jsx("div",{className:"text-lg sm:text-xl font-bold text-purple-600",children:v.filter(s=>!s.isSystemRole).length})})]}),e.jsxs(c,{className:"border-red-200 bg-red-50",children:[e.jsx(d,{className:"pb-1",children:e.jsxs(o,{className:"text-xs font-medium text-red-700 flex items-center gap-1",children:[e.jsx(u,{className:"w-3 h-3"}),"Super Admin"]})}),e.jsxs(m,{className:"pt-1",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold text-red-600",children:l?.userCount||0}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Level ",l?.level||10]})]})]}),e.jsxs(c,{className:"border-orange-200 bg-orange-50",children:[e.jsx(d,{className:"pb-1",children:e.jsxs(o,{className:"text-xs font-medium text-orange-700 flex items-center gap-1",children:[e.jsx(u,{className:"w-3 h-3"}),"Sub Admin"]})}),e.jsxs(m,{className:"pt-1",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold text-orange-600",children:i?.userCount||0}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Level ",i?.level||7]})]})]})]}),(l||i)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l&&e.jsxs(c,{className:"border-red-200 bg-gradient-to-br from-red-50 to-white",children:[e.jsxs(d,{children:[e.jsxs(o,{className:"flex items-center gap-2 text-red-700",children:[e.jsx(u,{className:"w-5 h-5"}),"Super Admin Role"]}),e.jsx(k,{children:l.description})]}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsx(n,{variant:l.isActive?"default":"secondary",children:l.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Access Level:"}),e.jsxs(n,{variant:"destructive",children:["Level ",l.level]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Users:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-bold",children:l.userCount||0})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Permissions:"}),e.jsx("span",{className:"font-bold text-red-600",children:l.permissions.length})]}),e.jsx("div",{className:"pt-2",children:e.jsxs(j,{variant:"outline",size:"sm",className:"w-full",onClick:()=>p(`/admin/roles/edit/${l._id}`),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"View Details"]})})]})]}),i&&e.jsxs(c,{className:"border-orange-200 bg-gradient-to-br from-orange-50 to-white",children:[e.jsxs(d,{children:[e.jsxs(o,{className:"flex items-center gap-2 text-orange-700",children:[e.jsx(u,{className:"w-5 h-5"}),"Sub Admin Role"]}),e.jsx(k,{children:i.description})]}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsx(n,{variant:i.isActive?"default":"secondary",children:i.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Access Level:"}),e.jsxs(n,{variant:"default",className:"bg-orange-600",children:["Level ",i.level]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Users:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-bold",children:i.userCount||0})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Permissions:"}),e.jsx("span",{className:"font-bold text-orange-600",children:i.permissions.length})]}),e.jsx("div",{className:"pt-2",children:e.jsxs(j,{variant:"outline",size:"sm",className:"w-full",onClick:()=>p(`/admin/roles/edit/${i._id}`),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"View Details"]})})]})]})]}),e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsx(o,{children:"All Roles"}),e.jsxs(k,{children:[A," role",A!==1?"s":""," found"]})]}),e.jsxs(m,{children:[e.jsx(Ae,{searchTerm:S,onSearchChange:X,filterValue:f,onFilterChange:Y,filterOptions:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}],filterPlaceholder:"Filter by status"}),e.jsx(Re,{columns:ne,data:v.map(s=>({...s,id:s._id})),hideDefaultActions:!0}),N>1&&e.jsx("div",{className:"mt-6",children:e.jsx(Ne,{children:e.jsxs(be,{children:[e.jsx(_,{children:e.jsx(ye,{onClick:se,className:r===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:N},(s,t)=>t+1).map(s=>e.jsx(_,{children:e.jsx(we,{onClick:()=>Z(s),isActive:r===s,className:"cursor-pointer",children:s})},s)),e.jsx(_,{children:e.jsx(Se,{onClick:ee,className:r===N?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]}),e.jsx(oe,{open:Q,onOpenChange:b,children:e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(he,{children:"Delete Role"}),e.jsxs(ue,{children:['Are you sure you want to delete the role "',x?.name,'"? This action cannot be undone.',x?.userCount&&x.userCount>0&&e.jsxs("p",{className:"text-destructive mt-2",children:["Warning: This role is currently assigned to ",x.userCount," user(s)."]})]})]}),e.jsxs(je,{children:[e.jsx(j,{variant:"outline",onClick:()=>{b(!1),C(null)},disabled:D,children:"Cancel"}),e.jsx(j,{variant:"destructive",onClick:ae,disabled:D,children:D?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete Role"})]})]})})]})};export{ze as default};

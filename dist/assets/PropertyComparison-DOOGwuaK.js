import{j as e}from"./ui-DYmpZ3pJ.js";import{h as H,r as d,L as f}from"./router-2SVJvIbS.js";import{x as V,am as U,af as q,t as k,ao as E,B as l,f as n,av as F,ak as R,a as c,e as o,X as O,ah as W,h as K,A as G,b,c as w,l as X,w as J}from"./index-BbgqWuYN.js";import{i as j,c as Q,g as Y}from"./propertyUtils-B_5yebUt.js";import{R as M}from"./refresh-cw-C8a82uL8.js";import{S as Z}from"./share-DIBMeBfH.js";import"./vendor-Dazix4UH.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=V("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),ce=()=>{const{isConnected:P,lastEvent:C}=U(),[S]=H(),[m,y]=d.useState([]),[r,x]=d.useState([]),[g,N]=d.useState(!0),[p,_]=d.useState(!1),h=d.useCallback(async s=>{if(s.length===0){x([]),N(!1);return}try{N(!0);const a=s.map(i=>q.getProperty(i).catch(I=>(console.error(`Failed to load property ${i}:`,I),null))),u=(await Promise.all(a)).filter(i=>i!==null&&i.success).map(i=>i.data.property);x(u)}catch(a){console.error("Error loading properties:",a),k({title:"Error",description:"Failed to load properties for comparison",variant:"destructive"})}finally{N(!1)}},[]),$=d.useCallback(async()=>{_(!0),await h(m),_(!1)},[h,m]);d.useEffect(()=>{const s=S.get("properties")?.split(",").filter(Boolean)||[];y(s),h(s)},[S,h]),E("property_updated",s=>{s.propertyId&&m.includes(s.propertyId)&&(console.log("Property updated via realtime, refreshing comparison"),$())}),E("property_favorited",s=>{s.propertyId&&m.includes(s.propertyId)&&x(a=>a.map(t=>t._id===s.propertyId?{...t,isFavorited:s.action==="add"}:t))});const L=(s,a)=>a==="rent"?`₹${s.toLocaleString("en-IN")}/month`:a==="lease"?`₹${s.toLocaleString("en-IN")}/year`:s>=1e7?`₹${(s/1e7).toFixed(1)} Cr`:s>=1e5?`₹${(s/1e5).toFixed(1)} Lac`:`₹${s.toLocaleString("en-IN")}`,B=s=>s.builtUp?`${s.builtUp} ${s.unit}`:s.plot?`${s.plot} ${s.unit}`:s.carpet?`${s.carpet} ${s.unit}`:"N/A",A=s=>{const a=s.area.builtUp||s.area.carpet||s.area.plot||0;return a===0?0:Math.round(s.price/a)},T=s=>s.images.find(t=>t.isPrimary)?.url||s.images[0]?.url||"/placeholder-property.jpg",z=s=>{y(a=>a.filter(t=>t!==s)),x(a=>a.filter(t=>t._id!==s))},D=()=>{k({title:"Feature Coming Soon",description:"Property selection modal will be available soon"})},v=(s,a=!1)=>{if(!s)return{display:"-",color:"text-muted-foreground"};if(a&&r.length>1){const t=r.map(I=>typeof s=="number"?s:0),u=Math.max(...t),i=Math.min(...t);if(s===u&&s!==i)return{display:s,color:"text-green-600",isBest:!0};if(s===i&&s!==u)return{display:s,color:"text-red-600",isWorst:!0}}return{display:s,color:"text-foreground"}};return e.jsxs("div",{className:"space-y-6 pt-16",children:[e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${P?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-sm text-muted-foreground",children:P?"Real-time property updates active":"Offline mode"}),C&&e.jsxs(l,{variant:"secondary",className:"text-xs",children:["Last update: ",new Date(C.timestamp).toLocaleTimeString()]})]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:$,disabled:p,children:[e.jsx(M,{className:`w-4 h-4 mr-2 ${p?"animate-spin":""}`}),p?"Refreshing...":"Refresh"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(F,{className:"w-8 h-8 text-primary"}),"Compare Properties"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Side-by-side comparison of your selected properties"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{to:"/customer/favorites",children:e.jsxs(n,{variant:"outline",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Back to Favorites"]})}),e.jsxs(n,{variant:"outline",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Share Comparison"]})]})]}),g&&e.jsx(c,{children:e.jsx(o,{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Loading properties for comparison..."})]})})}),!g&&r.length===0?e.jsx(c,{children:e.jsxs(o,{className:"p-12 text-center",children:[e.jsx(F,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No properties to compare"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Add properties from your favorites or search results to start comparing"}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(f,{to:"/customer/favorites",children:e.jsxs(n,{children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"View Favorites"]})}),e.jsx(f,{to:"/customer/search",children:e.jsx(n,{variant:"outline",children:"Search Properties"})})]})]})}):!g&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:`grid gap-4 ${r.length===1?"grid-cols-1 max-w-md mx-auto":r.length===2?"grid-cols-1 lg:grid-cols-2":r.length===3?"grid-cols-1 lg:grid-cols-3":r.length===4?"grid-cols-1 md:grid-cols-2 lg:grid-cols-4":"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"}`,children:[r.map(s=>e.jsxs(c,{className:"relative",children:[e.jsx("button",{onClick:()=>z(s._id),className:"absolute top-2 right-2 z-10 p-1 bg-destructive text-destructive-foreground rounded-full hover:bg-destructive/90",children:e.jsx(O,{className:"w-4 h-4"})}),e.jsxs(o,{className:"p-4",children:[e.jsxs("div",{className:"aspect-video bg-muted flex items-center justify-center mb-4 rounded-lg overflow-hidden",children:[e.jsx("img",{src:T(s),alt:s.title,className:"w-full h-full object-cover",onError:a=>{a.currentTarget.style.display="none",a.currentTarget.nextElementSibling?.classList.remove("hidden")}}),e.jsx(W,{className:"w-8 h-8 text-muted-foreground hidden"})]}),e.jsx("h3",{className:"font-semibold text-sm mb-2 line-clamp-2",children:s.title}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground mb-2",children:[e.jsx(K,{className:"w-3 h-3 mr-1"}),e.jsxs("span",{className:"line-clamp-1",children:[s.address.city,", ",s.address.state]})]}),e.jsx("div",{className:"text-lg font-bold text-primary mb-2",children:L(s.price,s.listingType)}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:[s.bedrooms," BHK"]}),e.jsx("span",{children:B(s.area)}),e.jsxs("span",{children:["₹",A(s),"/sq.ft"]})]})]})]},s._id)),e.jsx(c,{className:"border-dashed border-2",children:e.jsx(o,{className:"p-4 h-full flex items-center justify-center",children:e.jsxs(n,{variant:"ghost",className:"h-full w-full flex flex-col gap-2",onClick:D,children:[e.jsx(G,{className:"w-8 h-8 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Add Property"})]})})})]}),e.jsxs(c,{children:[e.jsx(b,{children:e.jsx(w,{children:"Detailed Comparison"})}),e.jsx(o,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-4 w-48",children:"Feature"}),r.map(s=>e.jsx("th",{className:"text-left p-4 min-w-64",children:e.jsx("div",{className:"truncate",children:s.title})},s._id))]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-4 font-medium",children:"Price"}),r.map(s=>{const a=v(s.price,!0);return e.jsx("td",{className:`p-4 ${a.color}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[L(s.price,s.listingType),a.isBest&&e.jsx(l,{variant:"default",className:"text-xs",children:"Expensive"}),a.isWorst&&e.jsx(l,{variant:"secondary",className:"text-xs",children:"Affordable"})]})},s._id)})]}),e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-4 font-medium",children:"Price per sq.ft"}),r.map(s=>{const a=A(s),t=v(a,!0);return e.jsx("td",{className:`p-4 ${t.color}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:["₹",a,t.isBest&&e.jsx(l,{variant:"default",className:"text-xs",children:"Highest"}),t.isWorst&&e.jsx(l,{variant:"secondary",className:"text-xs",children:"Best Value"})]})},s._id)})]}),e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-4 font-medium",children:"Area"}),r.map(s=>{const a=s.area.builtUp||s.area.carpet||s.area.plot||0,t=v(a,!0);return e.jsx("td",{className:`p-4 ${t.color}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[B(s.area),t.isBest&&e.jsx(l,{variant:"default",className:"text-xs",children:"Largest"}),t.isWorst&&e.jsx(l,{variant:"secondary",className:"text-xs",children:"Smallest"})]})},s._id)})]}),e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-4 font-medium",children:"Bedrooms"}),r.map(s=>e.jsxs("td",{className:"p-4",children:[s.bedrooms," BHK"]},s._id))]}),e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-4 font-medium",children:"Bathrooms"}),r.map(s=>e.jsx("td",{className:"p-4",children:s.bathrooms},s._id))]}),e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-4 font-medium",children:"Property Type"}),r.map(s=>e.jsx("td",{className:"p-4",children:e.jsx(l,{variant:"outline",className:"capitalize",children:s.type})},s._id))]}),e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-4 font-medium",children:"Listing Type"}),r.map(s=>e.jsx("td",{className:"p-4",children:e.jsx(l,{variant:"outline",className:"capitalize",children:s.listingType})},s._id))]}),e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-4 font-medium",children:"Status"}),r.map(s=>e.jsx("td",{className:"p-4",children:e.jsx(l,{variant:s.status==="available"?"default":"secondary",className:s.status==="available"?"bg-green-500":"",children:s.status==="available"?"Available":s.status})},s._id))]}),e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-4 font-medium",children:"Location"}),r.map(s=>e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:s.address.city}),e.jsx("div",{className:"text-muted-foreground",children:s.address.state})]})},s._id))]})]})]})})})]}),e.jsxs(c,{children:[e.jsx(b,{children:e.jsx(w,{children:"Amenities Comparison"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-4",children:Array.from(new Set(r.flatMap(s=>s.amenities))).map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"font-medium",children:String(s)}),e.jsx("div",{className:"flex gap-4",children:r.map(t=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-muted-foreground w-16 truncate",children:[t.title.slice(0,15),"..."]}),t.amenities.includes(String(s))?e.jsx(X,{className:"w-4 h-4 text-green-500"}):e.jsx(ee,{className:"w-4 h-4 text-muted-foreground"})]},t._id))})]},a))})})]}),e.jsxs(c,{children:[e.jsx(b,{children:e.jsx(w,{children:"Contact Information"})}),e.jsx(o,{children:e.jsx("div",{className:"grid gap-4",children:r.map(s=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:s.title}),e.jsxs("div",{className:"space-y-2",children:[s.owner&&s.owner.profile&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:j(s.owner)?"Listed by":"Owner"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:Q(s)}),s.owner.profile.phone&&!j(s.owner)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.owner.profile.phone})]}),s.agent&&s.agent.profile&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:j(s.agent)?"Listed by":"Agent"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:Y(s.agent)}),s.agent.profile.phone&&!j(s.agent)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.agent.profile.phone})]}),!s.owner?.profile&&!s.agent?.profile&&e.jsx("div",{className:"text-sm text-muted-foreground",children:"Contact information not available"})]})]},s._id))})})]}),e.jsx("div",{className:"flex justify-center gap-4",children:r.map(s=>e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("h4",{className:"font-medium text-sm",children:[s.title.slice(0,25),"..."]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{size:"sm",variant:"outline",children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),"Call"]}),e.jsx(f,{to:`/property/${s._id}`,children:e.jsx(n,{size:"sm",children:"View Details"})})]})]})},s._id))})]})]})};export{ce as default};

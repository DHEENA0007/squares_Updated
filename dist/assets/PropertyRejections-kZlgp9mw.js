import{j as e}from"./ui-BNZSgpjP.js";import{r as s}from"./router-D8v2YSKU.js";import{a2 as a,aS as t,aT as r,aR as l,a as i,e as c,$ as d,I as n,f as o,aj as x,B as m,L as h,q as j,r as p,s as u,v,w as N,aP as g,aM as f,aN as y,aL as b,E as w,a4 as C,a5 as k,a6 as R,a7 as S,a8 as T,ae as P,T as F,a3 as A}from"./index-XQ_rcKIR.js";import{C as V}from"./checkbox-CNljS6SN.js";import{T as $,a as L,b as q,c as _,d as z,e as B}from"./table-BaUPikoR.js";import{V as E}from"./VirtualTourViewer-C0JmyHO5.js";import{C as I}from"./circle-alert-B1nvTszq.js";import{R as D}from"./rotate-ccw-CdxI-plt.js";import"./vendor-BxThA0WO.js";import"./external-link-CIlWapk1.js";const U=()=>{const[U,O]=s.useState([]),[M,J]=s.useState(!0),[Z,G]=s.useState(""),[H,K]=s.useState(1),[Q,W]=s.useState(1),[X,Y]=s.useState(null),[ee,se]=s.useState(!1),[ae,te]=s.useState(!1),[re,le]=s.useState({}),{toast:ie}=a(),[ce,de]=s.useState("all"),[ne,oe]=s.useState("all"),[xe,me]=s.useState(""),[he,je]=s.useState(""),[pe,ue]=s.useState(!1),[ve,Ne]=s.useState([]),[ge,fe]=s.useState([]);s.useEffect(()=>{(async()=>{try{const[e,s]=await Promise.all([A.getAllPropertyTypes(),A.getFilterConfigurationsByType("listing_type")]);Ne(e),fe(s)}catch(e){}})()},[]);const[ye,be]=s.useState(""),[we,Ce]=s.useState({issuesResolved:!1,documentsUpdated:!1,complianceChecked:!1,qualityImproved:!1,accuracyVerified:!1,readyForReview:!1}),[ke,Re]=s.useState("");s.useEffect(()=>{Se()},[H,Z,ce,ne,xe,he]);const Se=async()=>{try{J(!0);const e=new URLSearchParams;e.append("page",H.toString()),Z&&e.append("search",Z),ce&&"all"!==ce&&e.append("type",ce),ne&&"all"!==ne&&e.append("listingType",ne),xe&&e.append("startDate",xe),he&&e.append("endDate",he);const s=await t(`/subadmin/properties/rejected?${e.toString()}`),a=await r(s);O(a.data.properties||[]),W(a.data.totalPages||1)}catch(e){ie({title:"Error",description:e.message||"Error fetching rejected properties",variant:"destructive"}),O([])}finally{J(!1)}};l("property_rejected",e=>{ie({title:"Property Rejected",description:"A property has been rejected"}),Se()});const Te=()=>{Ce({issuesResolved:!1,documentsUpdated:!1,complianceChecked:!1,qualityImproved:!1,accuracyVerified:!1,readyForReview:!1}),Re(""),be("")},Pe=e=>{Y(e),Te(),te(!0)},Fe=e=>`â‚¹${e.toLocaleString("en-IN")}`,Ae=e=>e.builtUp?`${e.builtUp} ${e.unit}`:e.plot?`${e.plot} ${e.unit}`:e.carpet?`${e.carpet} ${e.unit}`:"N/A";return M&&0===U.length?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Property Rejections"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"View and manage rejected property listings"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Property Rejections"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"View and manage rejected property listings"})]}),e.jsx(i,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(d,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(n,{placeholder:"Search rejected properties by title, city, state, email, or description...",value:Z,onChange:e=>G(e.target.value),className:"pl-10"})]}),e.jsxs(o,{variant:"outline",onClick:()=>ue(!pe),className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-4 w-4"}),"Filters",("all"!==ce||"all"!==ne||xe||he)&&e.jsx(m,{variant:"secondary",className:"ml-1",children:["all"!==ce,"all"!==ne,xe,he].filter(Boolean).length})]})]}),pe&&e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap gap-3 pt-3 border-t",children:[e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(h,{className:"text-xs text-muted-foreground",children:"Property Type"}),e.jsxs(j,{value:ce,onValueChange:de,children:[e.jsx(p,{className:"w-full sm:w-[150px]",children:e.jsx(u,{placeholder:"All Types"})}),e.jsxs(v,{children:[e.jsx(N,{value:"all",children:"All Types"}),ve.map(s=>e.jsx(N,{value:s.value,children:s.name},s._id))]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(h,{className:"text-xs text-muted-foreground",children:"Listing Type"}),e.jsxs(j,{value:ne,onValueChange:oe,children:[e.jsx(p,{className:"w-full sm:w-[130px]",children:e.jsx(u,{placeholder:"All"})}),e.jsxs(v,{children:[e.jsx(N,{value:"all",children:"All"}),ge.length>0?ge.map(s=>e.jsx(N,{value:s.value,children:s.displayLabel||s.name},s._id)):e.jsxs(e.Fragment,{children:[e.jsx(N,{value:"sale",children:"Sale"}),e.jsx(N,{value:"rent",children:"Rent"}),e.jsx(N,{value:"lease",children:"Lease"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(h,{className:"text-xs text-muted-foreground",children:"From Date"}),e.jsx(n,{type:"date",value:xe,onChange:e=>me(e.target.value),className:"w-full sm:w-[150px]"})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(h,{className:"text-xs text-muted-foreground",children:"To Date"}),e.jsx(n,{type:"date",value:he,onChange:e=>je(e.target.value),className:"w-full sm:w-[150px]"})]}),("all"!==ce||"all"!==ne||xe||he)&&e.jsx("div",{className:"flex items-end",children:e.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>{de("all"),oe("all"),me(""),je("")},className:"text-muted-foreground hover:text-foreground",children:[e.jsx(g,{className:"h-4 w-4 mr-1"}),"Clear Filters"]})})]})]})})}),e.jsx(i,{children:e.jsx(c,{className:"p-0",children:0===U.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(I,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Rejected Properties"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"There are no rejected properties at the moment"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs($,{children:[e.jsx(L,{children:e.jsxs(q,{className:"bg-muted/50",children:[e.jsx(_,{className:"w-[60px] text-center",children:"S.No."}),e.jsx(_,{children:"Property"}),e.jsx(_,{children:"Location"}),e.jsx(_,{className:"text-center",children:"Type"}),e.jsx(_,{className:"text-right",children:"Price"}),e.jsx(_,{className:"max-w-[200px]",children:"Rejection Reason"}),e.jsx(_,{children:"Owner"}),e.jsx(_,{className:"text-center",children:"Rejected On"}),e.jsx(_,{className:"text-center w-[150px]",children:"Actions"})]})}),e.jsx(z,{children:U.map((s,a)=>e.jsxs(q,{className:"hover:bg-muted/30",children:[e.jsx(B,{className:"text-center font-medium",children:10*(H-1)+a+1}),e.jsx(B,{children:e.jsxs("div",{className:"max-w-[180px]",children:[e.jsx("p",{className:"font-medium text-sm truncate",title:s.title,children:s.title}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[s.bedrooms>0&&e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-0.5",children:[e.jsx(f,{className:"h-3 w-3"})," ",s.bedrooms]}),s.bathrooms>0&&e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-0.5 ml-2",children:[e.jsx(y,{className:"h-3 w-3"})," ",s.bathrooms]}),(s.area.builtUp||s.area.plot||s.area.carpet)&&e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-0.5 ml-2",children:[e.jsx(b,{className:"h-3 w-3"})," ",Ae(s.area)]})]})]})}),e.jsx(B,{children:e.jsxs("div",{className:"max-w-[130px]",children:[e.jsx("p",{className:"text-sm truncate",title:`${s.address.city}, ${s.address.state}`,children:s.address.city}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[s.address.district?`${s.address.district}, `:"",s.address.state]})]})}),e.jsx(B,{className:"text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx(m,{variant:"outline",className:"text-xs capitalize",children:s.type}),e.jsx(m,{variant:"sale"===s.listingType?"default":"secondary",className:"text-xs",children:"sale"===s.listingType?"Sale":"rent"===s.listingType?"Rent":"Lease"})]})}),e.jsx(B,{className:"text-right",children:e.jsx("p",{className:"font-bold text-primary text-sm",children:Fe(s.price)})}),e.jsx(B,{children:e.jsx("div",{className:"max-w-[200px]",children:s.rejectionReason?e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(I,{className:"h-3 w-3 text-red-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 line-clamp-2",title:s.rejectionReason,children:s.rejectionReason}),s.rejectedBy&&e.jsxs("p",{className:"text-[10px] text-muted-foreground mt-0.5",children:["by ",s.rejectedBy.name]})]})]}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"N/A"})})}),e.jsx(B,{children:e.jsxs("div",{className:"max-w-[130px]",children:[e.jsx("p",{className:"text-sm font-medium truncate",title:s.owner.name,children:s.owner.name||"N/A"}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",title:s.owner.email,children:s.owner.email})]})}),e.jsx(B,{className:"text-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:s.rejectedAt?new Date(s.rejectedAt).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"2-digit"}):"N/A"})}),e.jsx(B,{children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{Y(s),se(!0)},className:"h-8 px-2",title:"View Details",children:e.jsx(w,{className:"h-4 w-4"})}),e.jsx(o,{size:"sm",variant:"secondary",onClick:()=>Pe(s),disabled:re[s._id],className:"h-8 px-2",title:"Reactivate",children:e.jsx(D,{className:"h-4 w-4"})})]})})]},s._id))})]})})})}),U.length>0&&e.jsx(i,{children:e.jsx(c,{className:"py-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",10*(H-1)+1," to ",Math.min(10*H,10*(H-1)+U.length)," of ",10*Q," properties"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",disabled:1===H,onClick:()=>K(1),children:"First"}),e.jsx(o,{variant:"outline",size:"sm",disabled:1===H,onClick:()=>K(H-1),children:"Previous"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,Q)},(s,a)=>{let t;return t=Q<=5||H<=3?a+1:H>=Q-2?Q-4+a:H-2+a,e.jsx(o,{variant:H===t?"default":"outline",size:"sm",onClick:()=>K(t),className:"w-8 h-8 p-0",children:t},t)})}),e.jsx(o,{variant:"outline",size:"sm",disabled:H===Q,onClick:()=>K(H+1),children:"Next"}),e.jsx(o,{variant:"outline",size:"sm",disabled:H===Q,onClick:()=>K(Q),children:"Last"})]})]})})}),e.jsx(C,{open:ee,onOpenChange:se,children:e.jsxs(k,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(R,{children:[e.jsx(S,{children:X?.title}),e.jsx(T,{children:"Rejected property details and information"})]}),X&&e.jsxs("div",{className:"space-y-4",children:[X.rejectionReason&&e.jsx("div",{className:"bg-red-50 dark:bg-red-950 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(I,{className:"h-5 w-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-900 dark:text-red-100",children:"Rejection Reason:"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:X.rejectionReason}),X.rejectedBy&&e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400 mt-2",children:["Rejected by: ",X.rejectedBy.name," (",X.rejectedBy.email,")"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Property Details"}),e.jsxs("ul",{className:"text-sm space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Type:"})," ",X.type]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Listing Type:"})," ",X.listingType]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Price:"})," ",Fe(X.price)]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Area:"})," ",Ae(X.area)]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bedrooms:"})," ",X.bedrooms]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bathrooms:"})," ",X.bathrooms]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Location & Contact"}),e.jsxs("ul",{className:"text-sm space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Address:"})," ",X.address.street]}),e.jsxs("li",{children:[e.jsx("strong",{children:"City:"})," ",X.address.city]}),e.jsxs("li",{children:[e.jsx("strong",{children:"State:"})," ",X.address.state]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Zip Code:"})," ",X.address.zipCode]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Owner:"})," ",X.owner.name]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Email:"})," ",X.owner.email]})]})]})]}),X.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Description"}),e.jsx("p",{className:"text-sm",children:X.description})]}),X.images&&X.images.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Images"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:X.images.map((s,a)=>e.jsx("img",{src:s,alt:`Property ${a+1}`,className:"w-full h-32 object-cover rounded"},a))})]}),X.videos&&X.videos.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Videos"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:X.videos.map((s,a)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"relative aspect-video rounded-lg overflow-hidden border bg-black",children:s.url&&(s.url.includes("youtube.com")||s.url.includes("youtu.be"))?e.jsx("iframe",{src:s.url.replace("watch?v=","embed/").replace("youtu.be/","youtube.com/embed/"),className:"w-full h-full",allowFullScreen:!0,title:s.caption||`Video ${a+1}`}):e.jsx("video",{src:s.url,controls:!0,className:"w-full h-full object-contain",poster:s.thumbnail})}),s.caption&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.caption})]},a))})]}),X.virtualTour&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Virtual Tour"}),e.jsx(E,{url:X.virtualTour})]})]}),e.jsxs(P,{children:[e.jsx(o,{variant:"outline",onClick:()=>se(!1),children:"Close"}),X&&e.jsxs(o,{variant:"secondary",onClick:()=>{se(!1),Pe(X)},children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Reactivate for Review"]})]})]})}),e.jsx(C,{open:ae,onOpenChange:te,children:e.jsxs(k,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(R,{children:[e.jsx(S,{children:"Reactivate Property for Review"}),e.jsxs(T,{children:['Complete the verification checklist to reactivate "',X?.title,'" for review. The property will move to pending status for approval.']})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"approver-name-reactivate",children:"Moderator Name *"}),e.jsx(n,{id:"approver-name-reactivate",placeholder:"Enter your full name",value:ye,onChange:e=>be(e.target.value),className:"mt-1"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(h,{className:"text-base font-semibold",children:"Reactivation Verification Checklist"}),e.jsxs("div",{className:"space-y-3 border rounded-lg p-4 bg-muted/30",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(V,{id:"issues-resolved",checked:we.issuesResolved,onCheckedChange:e=>Ce({...we,issuesResolved:e})}),e.jsx("label",{htmlFor:"issues-resolved",className:"text-sm font-medium cursor-pointer",children:"Previous rejection issues have been resolved"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(V,{id:"documents-updated",checked:we.documentsUpdated,onCheckedChange:e=>Ce({...we,documentsUpdated:e})}),e.jsx("label",{htmlFor:"documents-updated",className:"text-sm font-medium cursor-pointer",children:"Required documents are updated and complete"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(V,{id:"compliance-checked",checked:we.complianceChecked,onCheckedChange:e=>Ce({...we,complianceChecked:e})}),e.jsx("label",{htmlFor:"compliance-checked",className:"text-sm font-medium cursor-pointer",children:"Property meets all compliance requirements"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(V,{id:"quality-improved",checked:we.qualityImproved,onCheckedChange:e=>Ce({...we,qualityImproved:e})}),e.jsx("label",{htmlFor:"quality-improved",className:"text-sm font-medium cursor-pointer",children:"Content quality has been improved"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(V,{id:"accuracy-verified",checked:we.accuracyVerified,onCheckedChange:e=>Ce({...we,accuracyVerified:e})}),e.jsx("label",{htmlFor:"accuracy-verified",className:"text-sm font-medium cursor-pointer",children:"Information accuracy has been verified"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(V,{id:"ready-review",checked:we.readyForReview,onCheckedChange:e=>Ce({...we,readyForReview:e})}),e.jsx("label",{htmlFor:"ready-review",className:"text-sm font-medium cursor-pointer",children:"Property is ready for approval review"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"handwritten-comments-reactivate",children:"Reactivation Notes & Comments"}),e.jsx(F,{id:"handwritten-comments-reactivate",placeholder:"Type your handwritten comments or notes here...",value:ke,onChange:e=>Re(e.target.value),className:"mt-1 min-h-[120px] font-handwriting",rows:6}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Add any additional observations, changes made, or special notes about the reactivation"})]})]}),e.jsxs(P,{children:[e.jsx(o,{variant:"outline",onClick:()=>te(!1),children:"Cancel"}),e.jsx(o,{className:"bg-blue-600 hover:bg-blue-700",onClick:async()=>{if(X&&ye.trim())try{le({...re,[X._id]:!0});const e=await t(`/subadmin/properties/${X._id}/reactivate`,{method:"POST",body:JSON.stringify({approver:ye,notes:ke})});await r(e),ie({title:"Success",description:"Property reactivated and moved to pending review"}),te(!1),Te(),Y(null),Se()}catch(e){ie({title:"Error",description:"Failed to reactivate property",variant:"destructive"})}finally{le({...re,[X._id]:!1})}else ie({title:"Error",description:"Moderator name is required",variant:"destructive"})},disabled:!ye.trim()||re[X?._id||""],children:re[X?._id||""]?"Reactivating...":"Reactivate Property"})]})]})})]})};export{U as default};

import{t as e}from"./index-DvBXyKtT.js";import{r as t}from"./reviewsService-C63_b63b.js";const a="https://app.buildhomemartsquares.com/api";const r=new class{async makeRequest(e,t={}){const r=`${a}${e}`,n={headers:{"Content-Type":"application/json",...t.headers},...t},s=localStorage.getItem("token");s&&(n.headers={...n.headers,Authorization:`Bearer ${s}`});try{const e=await fetch(r,n);if(!e.ok){const t=await e.json().catch(()=>({success:!1,message:`HTTP ${e.status}: ${e.statusText}`}));throw new Error(t.message||"An error occurred")}return await e.json()}catch(o){throw o}}async getOverviewStats(e){try{const r=new URLSearchParams;r.append("timeframe",e.timeframe),e.propertyId&&r.append("propertyId",e.propertyId),e.dateFrom&&r.append("dateFrom",e.dateFrom),e.dateTo&&r.append("dateTo",e.dateTo);const n=`/vendors/analytics/overview?${r.toString()}`,s=await this.makeRequest(n);if(s.success&&s.data){try{const e=await t.getReviewStats();s.data.averageRating=e.averageRating}catch(a){}return s.data}let o=0;try{o=(await t.getReviewStats()).averageRating}catch(a){}return{totalViews:0,totalLeads:0,totalCalls:0,totalMessages:0,totalRevenue:0,soldPropertyRevenue:0,leasedPropertyRevenue:0,rentedPropertyRevenue:0,totalProperties:0,averageRating:o,responseTime:"Not calculated",conversionRate:0}}catch(r){let e=0;try{e=(await t.getReviewStats()).averageRating}catch(a){}return{totalViews:0,totalLeads:0,totalCalls:0,totalMessages:0,totalRevenue:0,soldPropertyRevenue:0,leasedPropertyRevenue:0,rentedPropertyRevenue:0,totalProperties:0,averageRating:e,responseTime:"Not calculated",conversionRate:0}}}async getPerformanceMetrics(e){try{const t=new URLSearchParams;t.append("timeframe",e.timeframe),e.propertyId&&t.append("propertyId",e.propertyId),e.dateFrom&&t.append("dateFrom",e.dateFrom),e.dateTo&&t.append("dateTo",e.dateTo);const a=`/vendors/analytics/performance?${t.toString()}`,r=await this.makeRequest(a);return r.success&&r.data?r.data:{viewsData:[],leadsData:[],conversionData:[],revenueData:[],propertyPerformance:[],leadSources:[],demographicsData:[]}}catch(t){return{viewsData:[],leadsData:[],conversionData:[],revenueData:[],propertyPerformance:[],leadSources:[],demographicsData:[]}}}async exportAnalyticsData(t,r="csv"){try{const n=new URLSearchParams;n.append("timeframe",t.timeframe),n.append("format",r),t.propertyId&&n.append("propertyId",t.propertyId),t.dateFrom&&n.append("dateFrom",t.dateFrom),t.dateTo&&n.append("dateTo",t.dateTo);const s=`/vendors/analytics/export?${n.toString()}`,o=await fetch(`${a}${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!o.ok)throw new Error("Failed to export analytics data");const c=await o.blob();return e({title:"Success",description:`Analytics data exported as ${r.toUpperCase()}!`}),c}catch(n){const t=n instanceof Error?n.message:"Failed to export analytics data";throw e({title:"Error",description:t,variant:"destructive"}),n}}formatCurrency(e){return null==e||isNaN(e)?"₹0":`₹${e.toLocaleString("en-IN")}`}formatNumber(e){return null==e||isNaN(e)?"0":e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toString()}formatPercentage(e){return null==e||isNaN(e)?"0%":`${e.toFixed(1)}%`}calculateChangePercentage(e,t){return 0===t?e>0?100:0:(e-t)/t*100}getChangeType(e){return e>0?"increase":e<0?"decrease":"neutral"}getChangeColor(e){switch(e){case"increase":return"text-green-600";case"decrease":return"text-red-600";case"neutral":return"text-gray-600"}}generateDateRange(e){const t=new Date,a=[];switch(e){case"7days":for(let e=6;e>=0;e--){const r=new Date(t);r.setDate(r.getDate()-e),a.push({name:r.toLocaleDateString("en-US",{weekday:"short"}),value:0})}break;case"30days":for(let e=29;e>=0;e--){const r=new Date(t);r.setDate(r.getDate()-e),a.push({name:r.getDate().toString(),value:0})}break;case"90days":for(let e=11;e>=0;e--){const r=new Date(t);r.setMonth(r.getMonth()-e),a.push({name:r.toLocaleDateString("en-US",{month:"short"}),value:0})}break;case"1year":for(let e=11;e>=0;e--){const r=new Date(t);r.setMonth(r.getMonth()-e),a.push({name:r.toLocaleDateString("en-US",{month:"short"}),value:0})}}return a}downloadBlob(e,t){const a=window.URL.createObjectURL(e),r=document.createElement("a");r.href=a,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a)}async getConsolidatedAdminAnalytics(e="30"){return this.makeRequest(`/analytics/v3/admin?dateRange=${e}`)}async getOverview(e="30"){return this.makeRequest(`/analytics/overview?dateRange=${e}`)}async getPropertyViews(e="30",t){const a=new URLSearchParams({dateRange:e});return t&&a.append("propertyId",t),this.makeRequest(`/analytics/property-views?${a.toString()}`)}async getUserConversion(e="30"){return this.makeRequest(`/analytics/user-conversion?dateRange=${e}`)}async getTrafficAnalytics(e="30"){return this.makeRequest(`/analytics/traffic?dateRange=${e}`)}async getEngagementAnalytics(e="30"){return this.makeRequest(`/analytics/engagement?dateRange=${e}`)}async getPropertyViewDetails(e,t="30"){return this.makeRequest(`/analytics/property-views/${e}?dateRange=${t}`)}async getAllPropertyViewers(e="30",t){const a=t?`/analytics/all-property-viewers?dateRange=${e}&propertyId=${t}`:`/analytics/all-property-viewers?dateRange=${e}`;return this.makeRequest(a)}async getTrafficAnalytics(e="30"){return this.makeRequest(`/traffic/analytics?dateRange=${e}`)}async getRealtimeTraffic(){return this.makeRequest("/traffic/realtime")}};export{r as a};

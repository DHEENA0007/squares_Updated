import{j as e}from"./ui-DOY6021Z.js";import{r as n}from"./router-2SVJvIbS.js";import{A as Z,G as K,f as j,o as ee,a as c,b as d,c as o,d as se,e as m,B as h,E as te,x as ae,ah as D,ai as T,aj as C,J as ie,U as re,ak as ne}from"./index-SPvHGBGF.js";import{D as le,a as ce,b as de,c as oe,d as me}from"./dialog-LNpiSwLW.js";import{P as xe,a as he,b as P,c as pe,d as ue,e as je}from"./pagination-DVWgAhgx.js";import{s as l}from"./subscriptionService-D09-RI2P.js";import{S as ge}from"./SearchFilter-Dz2xJqwu.js";import{T as Ne,a as fe,b as A,c as p,d as be,e as x}from"./table-CBFsTTPd.js";import{L as ve}from"./loader-circle-B83afoI3.js";import{C as we}from"./calendar-CTLer1S7.js";import{R as _}from"./refresh-cw-BxN4QFjr.js";import{L as ye,M as Se}from"./megaphone-DOHZtLdy.js";import{C as De}from"./camera-B2l7RznL.js";import"./vendor-Dazix4UH.js";import"./ellipsis-Na0dZh58.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=Z("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]),qe=()=>{const[y,F]=n.useState(""),[f,R]=n.useState("all"),[b,H]=n.useState([]),[I,k]=n.useState(!0),[r,g]=n.useState(1),[v,L]=n.useState(1),[t,$]=n.useState(null),[M,N]=n.useState(!1),{toast:i}=K(),z=s=>{const a={className:"w-4 h-4"};switch(s?.toLowerCase()){case"photography":return e.jsx(De,{...a});case"marketing":return e.jsx(Se,{...a});case"technology":return e.jsx(ye,{...a});case"support":return e.jsx(ne,{...a});case"crm":return e.jsx(re,{...a});default:return e.jsx(D,{...a})}},S=async()=>{try{k(!0);const s={page:r,limit:10,search:y||void 0,status:f==="all"?void 0:f},a=await l.getSubscriptions(s);console.log("Admin Clients - API Response:",a.data.subscriptions),a.data.subscriptions.forEach((u,w)=>{u.paymentHistory&&u.paymentHistory.length>0&&console.log(`Subscription ${w} Payment History:`,u.paymentHistory)}),H(a.data.subscriptions),L(a.data.pagination.totalPages)}catch(s){console.error("Failed to fetch subscriptions:",s),s instanceof Error&&(s.message.includes("Admin access required")?i({title:"Access Denied",description:"Admin privileges required to view subscriptions.",variant:"destructive"}):s.message.includes("Authentication required")?i({title:"Authentication Required",description:"Please log in to continue.",variant:"destructive"}):i({title:"Error",description:"Failed to load subscriptions. Please try again.",variant:"destructive"}))}finally{k(!1)}};n.useEffect(()=>{S()},[r,y,f]);const U=s=>{F(s),g(1)},q=s=>{R(s),g(1)},B=s=>{g(s)},O=()=>{r<v&&g(r+1)},V=()=>{r>1&&g(r-1)},W=()=>{i({title:"Exporting to Excel",description:"Your data is being exported to Excel format."})},Y=()=>{i({title:"Exporting to PDF",description:"Your data is being exported to PDF format."})},G=s=>{$(s),N(!0)},J=async s=>{if(s.status!=="active"){i({title:"Cannot Cancel",description:"Only active subscriptions can be cancelled.",variant:"destructive"});return}try{await l.cancelSubscription(s._id),i({title:"Subscription Cancelled",description:`${s.user.name}'s subscription has been cancelled.`}),S()}catch{i({title:"Error",description:"Failed to cancel subscription. Please try again.",variant:"destructive"})}},Q=async s=>{if(s.status==="active"){i({title:"Cannot Renew",description:"Subscription is already active.",variant:"destructive"});return}try{await l.renewSubscription(s._id),i({title:"Subscription Renewed",description:`${s.user.name}'s subscription has been renewed.`}),S()}catch{i({title:"Error",description:"Failed to renew subscription. Please try again.",variant:"destructive"})}};return I?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(ve,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading clients..."})]}):e.jsxs("div",{className:"space-y-6 relative top-[60px]",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Subscribed Clients"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage client subscriptions and details"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{variant:"outline",onClick:W,children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:"Export Excel"})]}),e.jsxs(j,{variant:"outline",onClick:Y,children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:"Export PDF"})]})]})]}),e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsx(o,{children:"All Clients"}),e.jsxs(se,{children:[b.length," client",b.length!==1?"s":""," found"]})]}),e.jsxs(m,{children:[e.jsx(ge,{searchTerm:y,onSearchChange:U,filterValue:f,onFilterChange:q,filterOptions:[{label:"Active",value:"active"},{label:"Expired",value:"expired"},{label:"Cancelled",value:"cancelled"}],filterPlaceholder:"Filter by status"}),e.jsx("div",{className:"rounded-lg border border-border bg-card overflow-x-auto",children:e.jsxs(Ne,{children:[e.jsx(fe,{children:e.jsxs(A,{className:"bg-muted/50",children:[e.jsx(p,{className:"font-semibold w-[250px] min-w-[200px]",children:"Client"}),e.jsx(p,{className:"font-semibold w-[200px] min-w-[150px]",children:"Plan"}),e.jsx(p,{className:"font-semibold w-[120px] min-w-[100px]",children:"Amount"}),e.jsx(p,{className:"font-semibold w-[130px] min-w-[110px]",children:"Start Date"}),e.jsx(p,{className:"font-semibold w-[130px] min-w-[110px]",children:"End Date"}),e.jsx(p,{className:"font-semibold w-[120px] min-w-[100px]",children:"Status"}),e.jsx(p,{className:"font-semibold text-center w-[120px] min-w-[100px]",children:"Actions"})]})}),e.jsx(be,{children:b.length===0?e.jsx(A,{children:e.jsx(x,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No subscriptions found"})}):b.map(s=>e.jsxs(A,{className:"hover:bg-muted/30 transition-colors",children:[e.jsx(x,{className:"w-[250px] min-w-[200px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",children:s.user.name}),e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:s.user.email})]})}),e.jsx(x,{className:"w-[200px] min-w-[150px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",children:s.plan?.name||"N/A"}),e.jsx("div",{className:"text-sm text-muted-foreground capitalize truncate",children:s.plan?.billingPeriod||"N/A"})]})}),e.jsx(x,{className:"w-[120px] min-w-[100px]",children:e.jsx("span",{className:"font-semibold whitespace-nowrap",children:l.formatAmount(s)})}),e.jsx(x,{className:"w-[130px] min-w-[110px]",children:e.jsx("span",{className:"whitespace-nowrap",children:new Date(s.startDate).toLocaleDateString()})}),e.jsx(x,{className:"w-[130px] min-w-[110px]",children:e.jsx("span",{className:"whitespace-nowrap",children:new Date(s.endDate).toLocaleDateString()})}),e.jsx(x,{className:"w-[120px] min-w-[100px]",children:e.jsx(h,{variant:s.status==="active"?"default":s.status==="expired"?"destructive":"secondary",className:"whitespace-nowrap",children:l.formatSubscriptionStatus(s.status).label})}),e.jsx(x,{className:"text-center w-[120px] min-w-[100px]",children:e.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>G(s),className:"whitespace-nowrap",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:"View"})]})})]},s._id))})]})}),v>1&&e.jsx("div",{className:"mt-6",children:e.jsx(xe,{children:e.jsxs(he,{children:[e.jsx(P,{children:e.jsx(pe,{onClick:V,className:r===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:v},(s,a)=>a+1).map(s=>e.jsx(P,{children:e.jsx(ue,{onClick:()=>B(s),isActive:r===s,className:"cursor-pointer",children:s})},s)),e.jsx(P,{children:e.jsx(je,{onClick:O,className:r===v?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]}),e.jsx(le,{open:M,onOpenChange:N,children:e.jsxs(ce,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(de,{children:[e.jsx(oe,{children:"Subscription Details"}),e.jsxs(me,{children:["Complete information about ",t?.user.name,"'s subscription"]})]}),t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Client Information"]})}),e.jsx(m,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Name"}),e.jsx("p",{className:"text-base",children:t.user.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Email"}),e.jsx("p",{className:"text-base",children:t.user.email})]}),t.user.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"text-base",children:t.user.phone})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"User ID"}),e.jsx("p",{className:"text-sm font-mono",children:t.user._id})]})]})})]}),e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"Plan Information"]})}),e.jsx(m,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Plan Name"}),e.jsx("p",{className:"text-base font-semibold",children:t.plan?.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Description"}),e.jsx("p",{className:"text-base",children:t.plan?.description||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Plan Price"}),e.jsx("p",{className:"text-base font-semibold",children:t.plan?.price?l.formatAmount({...t,amount:t.plan.price}):"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Billing Period"}),e.jsx("p",{className:"text-base",children:t.plan?.billingPeriod||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Plan ID"}),e.jsx("p",{className:"text-sm font-mono",children:t.plan?._id||"N/A"})]})]})})]}),t.addons&&t.addons.length>0&&e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"Purchased Addons (",t.addons.length,")"]})}),e.jsxs(m,{className:"space-y-3",children:[e.jsx("div",{className:"grid gap-4",children:t.addons.map((s,a)=>e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-border rounded-lg bg-muted/30",children:[e.jsx("div",{className:"p-2 rounded-lg bg-background border",children:z(s.category)}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:"font-semibold text-base text-foreground",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 overflow-hidden",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:s.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx(h,{variant:"outline",className:"capitalize text-xs",children:s.category}),e.jsx(h,{variant:"secondary",className:"text-xs",children:s.billingType?.replace("_"," ")||"N/A"})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:"font-semibold text-lg text-foreground",children:s.price?`${s.currency==="INR"?"₹":"$"}${s.price}`:"Free"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.billingType==="monthly"?"/month":s.billingType==="yearly"?"/year":s.billingType==="per_property"?"/property":s.billingType==="one_time"?"one-time":""})]})]})})]},s._id||a))}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50/50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Total Addons"}),e.jsxs("p",{className:"text-sm text-blue-700",children:[t.addons.length," addon",t.addons.length!==1?"s":""," purchased"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-blue-900",children:t.addons.reduce((s,a)=>s+(a.price||0),0)>0?`${t.currency==="INR"?"₹":"$"}${t.addons.reduce((s,a)=>s+(a.price||0),0)}`:"Free"}),e.jsx("p",{className:"text-xs text-blue-700",children:"addons value"})]})]})})]})]}),e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5"}),"Subscription Details"]})}),e.jsx(m,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx(h,{variant:t.status==="active"?"default":t.status==="expired"?"destructive":"secondary",className:"mt-1",children:l.formatSubscriptionStatus(t.status).label})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Auto Renew"}),e.jsx(h,{variant:t.autoRenew?"default":"secondary",className:"mt-1",children:t.autoRenew?"Enabled":"Disabled"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Start Date"}),e.jsx("p",{className:"text-base",children:new Date(t.startDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"End Date"}),e.jsx("p",{className:"text-base",children:new Date(t.endDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Days Remaining"}),e.jsx("p",{className:"text-base",children:t.status==="active"?`${l.getDaysUntilExpiry(t)} days`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Created At"}),e.jsx("p",{className:"text-base",children:new Date(t.createdAt).toLocaleDateString()})]})]})})]}),e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"Payment Information"]})}),e.jsx(m,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Amount Paid"}),e.jsx("p",{className:"text-base font-semibold",children:l.formatAmount(t)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Currency"}),e.jsx("p",{className:"text-base",children:t.currency})]}),t.paymentMethod&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Payment Method"}),e.jsx("p",{className:"text-base capitalize",children:t.paymentMethod.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Subscription ID"}),e.jsx("p",{className:"text-sm font-mono",children:t._id})]})]})})]}),t.paymentHistory&&t.paymentHistory.length>0&&e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"Payment History (",t.paymentHistory.length,")"]})}),e.jsxs(m,{className:"space-y-3",children:[e.jsx("div",{className:"space-y-4",children:t.paymentHistory.sort((s,a)=>new Date(a.date).getTime()-new Date(s.date).getTime()).map((s,a)=>e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-border rounded-lg bg-muted/20",children:[e.jsx("div",{className:"p-2 rounded-lg bg-background border",children:s.type==="addon_purchase"?e.jsx(T,{className:"w-4 h-4 text-orange-600"}):s.type==="subscription_purchase"?e.jsx(D,{className:"w-4 h-4 text-blue-600"}):s.type==="renewal"?e.jsx(_,{className:"w-4 h-4 text-green-600"}):e.jsx(C,{className:"w-4 h-4 text-purple-600"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:"font-semibold text-base text-foreground",children:s.type==="addon_purchase"?`Addon Purchase (${s.addons?.length||0} addon${(s.addons?.length||0)!==1?"s":""})`:s.type==="subscription_purchase"?"Subscription Purchase":s.type==="renewal"?"Subscription Renewal":"Subscription Upgrade"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:new Date(s.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}),s.type==="addon_purchase"&&s.addons&&s.addons.length>0&&e.jsxs("div",{className:"mt-2 p-2 bg-orange-50 border border-orange-200 rounded-md",children:[e.jsx("p",{className:"text-xs font-medium text-orange-800 mb-1",children:"Purchased Addons:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.addons.map((u,w)=>{const X=t.addons?.find(E=>E._id===u||E._id===u.toString());return e.jsx(h,{variant:"outline",className:"text-xs text-orange-700",children:X?.name||`Addon ${w+1}`},w)})})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx(h,{variant:s.type==="addon_purchase"?"default":"secondary",className:"capitalize text-xs",children:s.type.replace("_"," ")}),s.transactionId&&e.jsxs("p",{className:"text-xs text-muted-foreground font-mono",children:["ID: ",s.transactionId]})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("p",{className:"font-semibold text-lg text-foreground",children:[t.currency==="INR"?"₹":"$",s.amount]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.paymentMethod?.replace("_"," ")||"razorpay"})]})]})})]},s._id||a))}),e.jsx("div",{className:"mt-4 p-4 bg-green-50/50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900",children:"Total Payments"}),e.jsxs("p",{className:"text-sm text-green-700",children:[t.paymentHistory.length," transaction",t.paymentHistory.length!==1?"s":""]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-green-900",children:[t.currency==="INR"?"₹":"$",t.paymentHistory.reduce((s,a)=>s+(a.amount||0),0)]}),e.jsx("p",{className:"text-xs text-green-700",children:"total paid"})]})]})})]})]}),e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(o,{children:"Quick Actions"})}),e.jsx(m,{children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[t.status==="active"&&e.jsxs(j,{variant:"destructive",size:"sm",onClick:()=>{J(t),N(!1)},children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Cancel Subscription"]}),(t.status==="expired"||t.status==="cancelled")&&e.jsxs(j,{variant:"default",size:"sm",onClick:()=>{Q(t),N(!1)},children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Renew Subscription"]}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>N(!1),children:"Close"})]})})]})]})]})})]})};export{qe as default};

import{j as e}from"./ui-DHQhougw.js";import{r as s}from"./router-Bi51YGN-.js";import{$ as t,K as a,f as n,a as i,b as r,c as l,d as c,e as d,B as o,E as m,Q as u,R as x,V as p,W as h,Y as j,w as f,ap as g,aq as N,ar as v,D as b,U as y,as as w}from"./index-BXXWUbfo.js";import{F as A,E as S}from"./exportUtils-D6asGwWf.js";import{P as D,a as R,b as C,c as P,d as E,e as T}from"./pagination-4Yeq-L1v.js";import{s as _}from"./subscriptionService-DHCa5BVj.js";import{S as k}from"./SearchFilter-DjyuAt_G.js";import{T as I,a as $,b as M,c as H,d as L,e as F}from"./table-BBRox6go.js";import{C as z}from"./calendar-DvgVTGqB.js";import{R as U}from"./refresh-cw-DUgeGhzb.js";import{L as V,M as B}from"./megaphone-s3mEId0y.js";import{C as O}from"./camera-BbDp-BSr.js";import"./vendor-eVk5PToZ.js";import"./ellipsis-Cwu7I5jj.js";const q=e=>`Rs. ${(e||0).toLocaleString("en-IN")}`,G=()=>{const[G,Q]=s.useState(""),[W,K]=s.useState("all"),[Y,X]=s.useState([]),[Z,J]=s.useState(!0),[ee,se]=s.useState(1),[te,ae]=s.useState(1),[ne,ie]=s.useState(null),[re,le]=s.useState(!1),{toast:ce}=t(),de=s=>{const t={className:"w-4 h-4"};switch(s?.toLowerCase()){case"photography":return e.jsx(O,{...t});case"marketing":return e.jsx(B,{...t});case"technology":return e.jsx(V,{...t});case"support":return e.jsx(w,{...t});case"crm":return e.jsx(y,{...t});default:return e.jsx(g,{...t})}},oe=async()=>{try{J(!0);const e={page:ee,limit:10,search:G||void 0,status:"all"===W?void 0:W},s=await _.getSubscriptions(e),t=s.data.subscriptions.filter(e=>e&&e.user&&(e.user.name||e.user.email));t.forEach((e,s)=>{e.paymentHistory&&e.paymentHistory.length}),X(t),ae(s.data.pagination.totalPages)}catch(e){e instanceof Error&&(e.message.includes("Admin access required")?ce({title:"Access Denied",description:"Admin privileges required to view subscriptions.",variant:"destructive"}):e.message.includes("Authentication required")?ce({title:"Authentication Required",description:"Please log in to continue.",variant:"destructive"}):ce({title:"Error",description:"Failed to load subscriptions. Please try again.",variant:"destructive"}))}finally{J(!1)}};s.useEffect(()=>{oe()},[ee,G,W]);const me=e=>{ie(e),le(!0)};return Z?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(a,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading clients..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Subscribed Clients"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage client subscriptions and details"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(n,{variant:"outline",onClick:()=>{if(Y&&0!==Y.length?0!==Y.filter(e=>e&&e._id&&e.user&&e.status).length||(ce({title:"Invalid Data",description:"No valid subscription data found for export. Please contact support if this issue persists.",variant:"destructive"}),0):(ce({title:"No Data",description:"No subscription data available for export. Please check if there are any subscriptions in the system.",variant:"destructive"}),0))try{const e=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),s=(()=>{const e=Y.filter(e=>e&&e._id&&e.user&&e.status);if(0===e.length)throw new Error("No valid subscription data found");const s=e.filter(e=>"active"===e.status),t=e.filter(e=>"expired"===e.status),a=e.filter(e=>"cancelled"===e.status),n=e=>e.amount||0,i=s.reduce((e,s)=>e+n(s),0),r=e.reduce((e,s)=>e+n(s),0),l=a.reduce((e,s)=>e+n(s),0),c=t.reduce((e,s)=>e+n(s),0),d=s.reduce((e,s)=>s.addons&&Array.isArray(s.addons)?e+s.addons.reduce((e,s)=>e+(s?.price||0),0):e,0);return{validSubscriptions:e,activeSubscriptions:s,expiredSubscriptions:t,cancelledSubscriptions:a,totalActiveRevenue:i,totalRevenueAll:r,cancelledRevenue:l,expiredRevenue:c,addonRevenue:d,grandTotalRevenue:i+d,calculateRevenue:n}})(),t=[{Metric:"Total Clients","Count / Amount":s.validSubscriptions.length},{Metric:"Active Subscriptions","Count / Amount":s.activeSubscriptions.length},{Metric:"Cancelled Subscriptions","Count / Amount":s.cancelledSubscriptions.length},{Metric:"Expired Subscriptions","Count / Amount":s.expiredSubscriptions.length},{Metric:"Total Subscriptions","Count / Amount":s.validSubscriptions.length},{Metric:"Total Active Revenue","Count / Amount":q(s.totalActiveRevenue)},{Metric:"Total Revenue (All)","Count / Amount":q(s.totalRevenueAll)},{Metric:"Add-on Revenue","Count / Amount":q(s.addonRevenue)},{Metric:"Grand Total Revenue","Count / Amount":q(s.grandTotalRevenue)}],a=s.totalActiveRevenue+s.cancelledRevenue+s.expiredRevenue,n=[{Status:"Active",Count:s.activeSubscriptions.length,"Total Amount":q(s.totalActiveRevenue),"% of Total Amount":a>0?`${(s.totalActiveRevenue/a*100).toFixed(1)}%`:"0%"},{Status:"Cancelled",Count:s.cancelledSubscriptions.length,"Total Amount":q(s.cancelledRevenue),"% of Total Amount":a>0?`${(s.cancelledRevenue/a*100).toFixed(1)}%`:"0%"},{Status:"Expired",Count:s.expiredSubscriptions.length,"Total Amount":q(s.expiredRevenue),"% of Total Amount":a>0?`${(s.expiredRevenue/a*100).toFixed(1)}%`:"0%"}],i=(e=>{const{activeSubscriptions:s,calculateRevenue:t}=e;return s.map((e,s)=>{const a="object"==typeof e.user&&null!==e.user&&(e.user.name||e.user.email)||`Client ${s+1}`,n="object"==typeof e.user&&null!==e.user&&e.user.email||"N/A",i="object"==typeof e.plan&&null!==e.plan&&e.plan.name||"Unknown Plan",r="object"==typeof e.plan&&null!==e.plan&&e.plan.price||0,l=t(e),c=Array.isArray(e.addons)?e.addons.length:0;let d=0;return Array.isArray(e.addons)&&e.addons.length>0&&(d=e.addons.reduce((e,s)=>"object"==typeof s&&null!==s?e+(s.price||0):e,0)),0===d&&Array.isArray(e.paymentHistory)&&(d=e.paymentHistory.filter(e=>"addon_purchase"===e?.type).reduce((e,s)=>e+(s?.amount||0),0)),{"#":s+1,"Client Name":a,Email:n,Plan:i,"Plan Price":q(r),"Total Amount":q(l),Status:_.formatSubscriptionStatus(e.status||"unknown").label,"Start Date":S.formatDate(e.startDate),"End Date":S.formatDate(e.endDate),"Auto Renew":e.autoRenew?"Yes":"No","Add-ons":c,"Add-on Amount":q(d)}})})(s),r=i.map(e=>({"#":e["#"],"Client Name":e["Client Name"],Email:e.Email,Plan:e.Plan,"Plan Price":e["Plan Price"],"Total Amount":e["Total Amount"],Status:e.Status,"Start Date":e["Start Date"],"End Date":e["End Date"],"Auto Renew":e["Auto Renew"],"Add-ons":e["Add-ons"],"Add-on Amount":e["Add-on Amount"]})),l=(e=>{const{validSubscriptions:s}=e,t=[];return s.forEach(e=>{const s="object"==typeof e.user&&null!==e.user&&(e.user.name||e.user.email)||"Unknown Client";Array.isArray(e.addons)&&e.addons.length>0&&e.addons.forEach(a=>{if("object"==typeof a&&null!==a&&a.name){const n=Array.isArray(e.paymentHistory)?e.paymentHistory.filter(e=>e&&"addon_purchase"===e.type&&Array.isArray(e.addons)&&e.addons.includes(a._id)).sort((e,s)=>new Date(s.date).getTime()-new Date(e.date).getTime())[0]:null;t.push({"#":t.length+1,"Client Name":s,"Add-on Name":a.name,Category:a.category||"N/A",Price:q(a.price),"Billing Type":a.billingType?.replace("_"," ")||"N/A","Last Payment Date":n?S.formatDate(n.date):"N/A"})}})}),t})(s),c=s.activeSubscriptions.length,d=c>0?Math.round(s.totalActiveRevenue/c):0,o={};s.activeSubscriptions.forEach(e=>{const t=e.plan?.name||"Unknown",a=s.calculateRevenue(e);o[t]=(o[t]||0)+a});const m=Object.entries(o).sort(([,e],[,s])=>s-e)[0]?.[0]||"N/A",u={};s.validSubscriptions.forEach(e=>{e.addons?.forEach(e=>{e?.name&&(u[e.name]=(u[e.name]||0)+1)})});const x=Object.entries(u).sort(([,e],[,s])=>s-e)[0]?.[0]||"N/A",p=[{Insight:"Total Active Clients",Value:c},{Insight:"Average Revenue per Active Client (ARPC)",Value:q(d)},{Insight:"Highest-Grossing Plan",Value:m},{Insight:"Most Purchased Add-on",Value:x},{Insight:"Total Monthly Recurring Revenue (MRR)",Value:q(s.totalActiveRevenue)}],h={filename:"subscribed_clients_revenue_report",title:"Subscribed Clients Revenue Report",metadata:{"Generated on":e,"Report Period":"All Time","Prepared by":"Admin System"}},j=[{name:"Summary Statistics",data:t,columns:[{wch:30},{wch:20}]},{name:"Status Breakdown",data:n,columns:[{wch:15},{wch:10},{wch:20},{wch:20}]},{name:"Subscription Details",data:r,columns:[{wch:5},{wch:25},{wch:30},{wch:20},{wch:15},{wch:15},{wch:12},{wch:15},{wch:12},{wch:10},{wch:15}]},{name:"Add-on Details",data:l,columns:[{wch:5},{wch:25},{wch:25},{wch:15},{wch:12},{wch:20},{wch:15}]},{name:"Key Insights",data:p,columns:[{wch:35},{wch:25}]}];S.generateExcelReport(h,j),ce({title:"Export Successful",description:"Comprehensive revenue report has been generated successfully"})}catch(e){ce({title:"Export Failed",description:"Failed to export data to Excel. Please try again.",variant:"destructive"})}},children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:"Export Excel"})]})})]}),e.jsxs(i,{children:[e.jsxs(r,{children:[e.jsx(l,{children:"All Clients"}),e.jsxs(c,{children:[Y.length," client",1!==Y.length?"s":""," found"]})]}),e.jsxs(d,{children:[e.jsx(k,{searchTerm:G,onSearchChange:e=>{Q(e),se(1)},filterValue:W,onFilterChange:e=>{K(e),se(1)},filterOptions:[{label:"Active",value:"active"},{label:"Expired",value:"expired"},{label:"Cancelled",value:"cancelled"}],filterPlaceholder:"Filter by status"}),e.jsx("div",{className:"block sm:hidden space-y-4",children:0===Y.length?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No subscriptions found"}):Y.map(s=>e.jsx(i,{className:"hover:shadow-md transition-shadow",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-base truncate",children:s.user.name}),e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:s.user.email})]}),e.jsx(o,{variant:"active"===s.status?"default":"expired"===s.status?"destructive":"secondary",className:"ml-2 flex-shrink-0",children:_.formatSubscriptionStatus(s.status).label})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Plan:"}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium",children:s.plan?.name||"N/A"}),e.jsx("div",{className:"text-muted-foreground capitalize",children:s.plan?.billingPeriod||"N/A"})]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount:"}),e.jsx("span",{className:"font-semibold",children:_.formatAmount(s)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Start:"}),e.jsx("div",{className:"font-medium",children:new Date(s.startDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"End:"}),e.jsx("div",{className:"font-medium",children:new Date(s.endDate).toLocaleDateString()})]})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>me(s),className:"w-full",children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"View Details"]})})]})})},s._id))}),e.jsx("div",{className:"hidden sm:block rounded-lg border border-border bg-card overflow-x-auto",children:e.jsxs(I,{children:[e.jsx($,{children:e.jsxs(M,{className:"bg-muted/50",children:[e.jsx(H,{className:"font-semibold w-[250px] min-w-[200px]",children:"Client"}),e.jsx(H,{className:"font-semibold w-[200px] min-w-[150px]",children:"Plan"}),e.jsx(H,{className:"font-semibold w-[120px] min-w-[100px]",children:"Amount"}),e.jsx(H,{className:"font-semibold w-[130px] min-w-[110px]",children:"Start Date"}),e.jsx(H,{className:"font-semibold w-[130px] min-w-[110px]",children:"End Date"}),e.jsx(H,{className:"font-semibold w-[120px] min-w-[100px]",children:"Status"}),e.jsx(H,{className:"font-semibold text-center w-[120px] min-w-[100px]",children:"Actions"})]})}),e.jsx(L,{children:0===Y.length?e.jsx(M,{children:e.jsx(F,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No subscriptions found"})}):Y.map(s=>e.jsxs(M,{className:"hover:bg-muted/30 transition-colors",children:[e.jsx(F,{className:"w-[250px] min-w-[200px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",children:s.user.name}),e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:s.user.email})]})}),e.jsx(F,{className:"w-[200px] min-w-[150px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",children:s.plan?.name||"N/A"}),e.jsx("div",{className:"text-sm text-muted-foreground capitalize truncate",children:s.plan?.billingPeriod||"N/A"})]})}),e.jsx(F,{className:"w-[120px] min-w-[100px]",children:e.jsx("span",{className:"font-semibold whitespace-nowrap",children:_.formatAmount(s)})}),e.jsx(F,{className:"w-[130px] min-w-[110px]",children:e.jsx("span",{className:"whitespace-nowrap",children:new Date(s.startDate).toLocaleDateString()})}),e.jsx(F,{className:"w-[130px] min-w-[110px]",children:e.jsx("span",{className:"whitespace-nowrap",children:new Date(s.endDate).toLocaleDateString()})}),e.jsx(F,{className:"w-[120px] min-w-[100px]",children:e.jsx(o,{variant:"active"===s.status?"default":"expired"===s.status?"destructive":"secondary",className:"whitespace-nowrap",children:_.formatSubscriptionStatus(s.status).label})}),e.jsx(F,{className:"text-center w-[120px] min-w-[100px]",children:e.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>me(s),className:"whitespace-nowrap",children:[e.jsx(m,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:"View"})]})})]},s._id))})]})}),te>1&&e.jsx("div",{className:"mt-6",children:e.jsx(D,{children:e.jsxs(R,{children:[e.jsx(C,{children:e.jsx(P,{onClick:()=>{ee>1&&se(ee-1)},className:1===ee?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:te},(e,s)=>s+1).map(s=>e.jsx(C,{children:e.jsx(E,{onClick:()=>(e=>{se(e)})(s),isActive:ee===s,className:"cursor-pointer",children:s})},s)),e.jsx(C,{children:e.jsx(T,{onClick:()=>{ee<te&&se(ee+1)},className:ee===te?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]}),e.jsx(u,{open:re,onOpenChange:le,children:e.jsxs(x,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(p,{children:[e.jsx(h,{children:"Subscription Details"}),e.jsxs(j,{children:["Complete information about ",ne?.user.name,"'s subscription"]})]}),ne&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5"}),"Client Information"]})}),e.jsx(d,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Name"}),e.jsx("p",{className:"text-base",children:ne.user.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Email"}),e.jsx("p",{className:"text-base",children:ne.user.email})]}),ne.user.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"text-base",children:ne.user.phone})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"User ID"}),e.jsx("p",{className:"text-sm font-mono",children:ne.user._id})]})]})})]}),e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-5 h-5"}),"Plan Information"]})}),e.jsx(d,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Plan Name"}),e.jsx("p",{className:"text-base font-semibold",children:ne.plan?.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Description"}),e.jsx("p",{className:"text-base",children:ne.plan?.description||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Plan Price"}),e.jsx("p",{className:"text-base font-semibold",children:ne.plan?.price?_.formatAmount({...ne,amount:ne.plan.price}):"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Billing Period"}),e.jsx("p",{className:"text-base",children:ne.plan?.billingPeriod||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Plan ID"}),e.jsx("p",{className:"text-sm font-mono",children:ne.plan?._id||"N/A"})]})]})})]}),ne.addons&&ne.addons.length>0&&e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5"}),"Purchased Addons (",ne.addons.length,")"]})}),e.jsxs(d,{className:"space-y-3",children:[e.jsx("div",{className:"grid gap-4",children:ne.addons.map((s,t)=>e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-border rounded-lg bg-muted/30",children:[e.jsx("div",{className:"p-2 rounded-lg bg-background border",children:de(s.category)}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:"font-semibold text-base text-foreground",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 overflow-hidden",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:s.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx(o,{variant:"outline",className:"capitalize text-xs",children:s.category}),e.jsx(o,{variant:"secondary",className:"text-xs",children:s.billingType?.replace("_"," ")||"N/A"})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:"font-semibold text-lg text-foreground",children:s.price?`${"INR"===s.currency?"₹":"$"}${s.price}`:"Free"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"monthly"===s.billingType?"/month":"yearly"===s.billingType?"/year":"per_property"===s.billingType?"/property":"one_time"===s.billingType?"one-time":""})]})]})})]},s._id||t))}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50/50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Total Addons"}),e.jsxs("p",{className:"text-sm text-blue-700",children:[ne.addons.length," addon",1!==ne.addons.length?"s":""," purchased"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-blue-900",children:ne.addons.reduce((e,s)=>e+(s.price||0),0)>0?`${"INR"===ne.currency?"₹":"$"}${ne.addons.reduce((e,s)=>e+(s.price||0),0)}`:"Free"}),e.jsx("p",{className:"text-xs text-blue-700",children:"addons value"})]})]})})]})]}),e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Subscription Details"]})}),e.jsx(d,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx(o,{variant:"active"===ne.status?"default":"expired"===ne.status?"destructive":"secondary",className:"mt-1",children:_.formatSubscriptionStatus(ne.status).label})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Auto Renew"}),e.jsx(o,{variant:ne.autoRenew?"default":"secondary",className:"mt-1",children:ne.autoRenew?"Enabled":"Disabled"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Start Date"}),e.jsx("p",{className:"text-base",children:new Date(ne.startDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"End Date"}),e.jsx("p",{className:"text-base",children:new Date(ne.endDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Days Remaining"}),e.jsx("p",{className:"text-base",children:"active"===ne.status?`${_.getDaysUntilExpiry(ne)} days`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Created At"}),e.jsx("p",{className:"text-base",children:new Date(ne.createdAt).toLocaleDateString()})]})]})})]}),e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5"}),"Payment Information"]})}),e.jsx(d,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Amount Paid"}),e.jsx("p",{className:"text-base font-semibold",children:_.formatAmount(ne)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Currency"}),e.jsx("p",{className:"text-base",children:ne.currency})]}),ne.paymentMethod&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Payment Method"}),e.jsx("p",{className:"text-base capitalize",children:ne.paymentMethod.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Subscription ID"}),e.jsx("p",{className:"text-sm font-mono",children:ne._id})]})]})})]}),ne.paymentHistory&&ne.paymentHistory.length>0&&e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5"}),"Payment History (",ne.paymentHistory.length,")"]})}),e.jsxs(d,{className:"space-y-3",children:[e.jsx("div",{className:"space-y-4",children:ne.paymentHistory.sort((e,s)=>new Date(s.date).getTime()-new Date(e.date).getTime()).map((s,t)=>e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-border rounded-lg bg-muted/20",children:[e.jsx("div",{className:"p-2 rounded-lg bg-background border",children:"addon_purchase"===s.type?e.jsx(N,{className:"w-4 h-4 text-orange-600"}):"subscription_purchase"===s.type?e.jsx(g,{className:"w-4 h-4 text-blue-600"}):"renewal"===s.type?e.jsx(U,{className:"w-4 h-4 text-green-600"}):e.jsx(v,{className:"w-4 h-4 text-purple-600"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:"font-semibold text-base text-foreground",children:"addon_purchase"===s.type?`Addon Purchase (${s.addons?.length||0} addon${1!==(s.addons?.length||0)?"s":""})`:"subscription_purchase"===s.type?"Subscription Purchase":"renewal"===s.type?"Subscription Renewal":"Subscription Upgrade"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:new Date(s.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}),"addon_purchase"===s.type&&s.addons&&s.addons.length>0&&e.jsxs("div",{className:"mt-2 p-2 bg-orange-50 border border-orange-200 rounded-md",children:[e.jsx("p",{className:"text-xs font-medium text-orange-800 mb-1",children:"Purchased Addons:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.addons.map((s,t)=>{const a=ne.addons?.find(e=>e._id===s||e._id===s.toString());return e.jsx(o,{variant:"outline",className:"text-xs text-orange-700",children:a?.name||`Addon ${t+1}`},t)})})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx(o,{variant:"addon_purchase"===s.type?"default":"secondary",className:"capitalize text-xs",children:s.type.replace("_"," ")}),s.transactionId&&e.jsxs("p",{className:"text-xs text-muted-foreground font-mono",children:["ID: ",s.transactionId]})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("p",{className:"font-semibold text-lg text-foreground",children:["INR"===ne.currency?"₹":"$",s.amount]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.paymentMethod?.replace("_"," ")||"razorpay"})]})]})})]},s._id||t))}),e.jsx("div",{className:"mt-4 p-4 bg-green-50/50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900",children:"Total Payments"}),e.jsxs("p",{className:"text-sm text-green-700",children:[ne.paymentHistory.length," transaction",1!==ne.paymentHistory.length?"s":""]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-green-900",children:["INR"===ne.currency?"₹":"$",ne.paymentHistory.reduce((e,s)=>e+(s.amount||0),0)]}),e.jsx("p",{className:"text-xs text-green-700",children:"total paid"})]})]})})]})]}),e.jsxs(i,{children:[e.jsx(r,{children:e.jsx(l,{children:"Quick Actions"})}),e.jsx(d,{children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:["active"===ne.status&&e.jsxs(n,{variant:"destructive",size:"sm",onClick:()=>{(async e=>{if("active"===e.status)try{await _.cancelSubscription(e._id),ce({title:"Subscription Cancelled",description:`${e.user.name}'s subscription has been cancelled.`}),oe()}catch(s){ce({title:"Error",description:"Failed to cancel subscription. Please try again.",variant:"destructive"})}else ce({title:"Cannot Cancel",description:"Only active subscriptions can be cancelled.",variant:"destructive"})})(ne),le(!1)},children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Cancel Subscription"]}),("expired"===ne.status||"cancelled"===ne.status)&&e.jsxs(n,{variant:"default",size:"sm",onClick:()=>{(async e=>{if("active"!==e.status)try{await _.renewSubscription(e._id),ce({title:"Subscription Renewed",description:`${e.user.name}'s subscription has been renewed.`}),oe()}catch(s){ce({title:"Error",description:"Failed to renew subscription. Please try again.",variant:"destructive"})}else ce({title:"Cannot Renew",description:"Subscription is already active.",variant:"destructive"})})(ne),le(!1)},children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Renew Subscription"]}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>le(!1),children:"Close"})]})})]})]})]})})]})};export{G as default};

import{j as e}from"./ui-BNZSgpjP.js";import{r as s,d as l}from"./router-D8v2YSKU.js";import{u as a,a2 as i,l as t,a3 as r,f as n,a9 as c,af as d,ag as o,ah as p,B as u,ai as h,a4 as x,a5 as m,a6 as j,a7 as y,a8 as f,L as v,q as g,r as N,s as F,v as b,w,ad as T,I as C,G as _,ae as S,Z as V,ac as O,aj as E,a as L,e as A}from"./index-CM8T-gRV.js";import{T as k,a as R,b as D,c as P,d as z,e as M}from"./table-eRu5kCA2.js";import{P as I}from"./pencil-GtOH3KQn.js";import{A as U,a as q}from"./alert-Cpy5Aw5p.js";import"./vendor-BxThA0WO.js";const $=()=>{const{user:l}=a(),{toast:E}=i(),L=l?.rolePermissions||[],A="admin"===l?.role||"superadmin"===l?.role,U=e=>L.includes(e),q=A||U(V.FILTER_CREATE_NTP),$=A||U(V.FILTER_CREATE_FTO),B=A||U(V.FILTER_EDIT),Q=A||U(V.FILTER_DELETE),W=A||U(V.FILTER_STATUS);A||U(V.FILTER_ORDER);const[Y,G]=s.useState([]),[H,K]=s.useState([]),[Z,J]=s.useState(!0),[X,ee]=s.useState(!1),[se,le]=s.useState(!1),[ae,ie]=s.useState(null),[te,re]=s.useState(""),[ne,ce]=s.useState(""),[de,oe]=s.useState([]),[pe,ue]=s.useState([]),[he,xe]=s.useState(!1),[me,je]=s.useState(null),[ye,fe]=s.useState(""),[ve,ge]=s.useState({filter_type:"",name:"",value:"",min_value:void 0,max_value:void 0,display_label:"",display_order:0}),[Ne,Fe]=s.useState([]),[be,we]=s.useState([]),[Te,Ce]=s.useState(!1),[_e,Se]=s.useState(!1),[Ve,Oe]=s.useState({targetFilterType:"",sourceFilterType:"",sourceFilterValues:[]}),[Ee,Le]=s.useState({filterType:"",optionValue:"",sourceFilterType:"",sourceFilterValues:[]}),[Ae,ke]=s.useState([]),[Re,De]=s.useState([]),[Pe,ze]=s.useState(""),[Me,Ie]=s.useState([]),[Ue,qe]=s.useState(!1),[$e,Be]=s.useState(t.isReady());s.useEffect(()=>{He(),We(),Qe(),Je(),t.initialize().then(()=>{Be(!0)}).catch(console.error)},[]);const Qe=async()=>{try{const e=await r.getFilterOptionVisibility();we(e)}catch(e){}},We=async()=>{try{const e=await r.getFilterDependencies();Fe(e)}catch(e){}};s.useEffect(()=>{(()=>{if(!Ve.sourceFilterType)return void ke([]);const e=Ke(Ve.sourceFilterType);e.length>0?ke(e.filter(e=>e.isActive).map(e=>({label:e.displayLabel||e.name,value:e.value}))):ke([])})()},[Ve.sourceFilterType,Y]),s.useEffect(()=>{if(!Ee.filterType)return void De([]);const e=Ke(Ee.filterType);De(e.map(e=>({label:e.displayLabel||e.name,value:e.value})))},[Ee.filterType,Y]);const[Ye,Ge]=s.useState([]);s.useEffect(()=>{if(!Ee.sourceFilterType)return void Ge([]);const e=Ke(Ee.sourceFilterType);Ge(e.filter(e=>e.isActive).map(e=>({label:e.displayLabel||e.name,value:e.value})))},[Ee.sourceFilterType,Y]);const He=async()=>{try{J(!0);const[e,s]=await Promise.all([r.getAllFilterConfigurations(!0),r.getAllPropertyTypes(!1)]);G(e),ue(s);const l=Array.from(new Set(e.map(e=>e.filterType)));K(l.sort()),l.length>0&&!te&&re(l[0])}catch(e){E({title:"Error",description:"Failed to fetch filter configurations",variant:"destructive"})}finally{J(!1)}},Ke=e=>Y.filter(s=>s.filterType===e).sort((e,s)=>e.displayOrder-s.displayOrder),Ze=e=>"property_type"===e?"Property Management":"listing_type"===e||"location"===e?"System Filter":de.some(s=>s.fieldName===e)?"Property Field":"Custom Filter",Je=async()=>{try{xe(!0);const e=await r.getAllPropertyTypes(!1),s=[],l=new Set;for(const a of e){const e=await r.getPropertyTypeFields(a._id,!1);for(const i of e)l.has(i.fieldName)||(l.add(i.fieldName),s.push({fieldName:i.fieldName,fieldLabel:i.fieldLabel,fieldType:i.fieldType,fieldOptions:i.fieldOptions||[],propertyTypeName:a.name}))}oe(s)}catch(e){}finally{xe(!1)}},Xe=e=>{e?(ie(e),ge({filter_type:e.filterType,name:e.name,value:e.value,min_value:e.minValue,max_value:e.maxValue,display_label:e.displayLabel,display_order:e.displayOrder}),"location"===e.filterType&&ze(e.name)):(ie(null),ge({filter_type:te,name:"",value:"",min_value:void 0,max_value:void 0,display_label:"",display_order:0}),ze("")),ee(!0)},es=()=>{ee(!1),ie(null),ge({filter_type:"",name:"",value:"",min_value:void 0,max_value:void 0,display_label:"",display_order:0}),ze(""),Ie([])},ss=s=>{const l=Ke(s);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground",children:[l.length," options configured"]})}),$&&e.jsxs(n,{size:"sm",onClick:()=>Xe(),children:[e.jsx(c,{className:"h-4 w-4 mr-2"}),"Add Option"]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(k,{children:[e.jsx(R,{children:e.jsxs(D,{children:[e.jsx(P,{children:"Display Order"}),e.jsx(P,{children:"Name"}),e.jsx(P,{children:"Value"}),e.jsx(P,{children:"Display Label"}),e.jsx(P,{children:"Status"}),e.jsx(P,{className:"text-right",children:"Actions"})]})}),e.jsx(z,{children:0===l.length?e.jsx(D,{children:e.jsx(M,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No options found for this filter type."})}):l.map(s=>e.jsxs(D,{children:[e.jsx(M,{children:s.displayOrder}),e.jsx(M,{className:"font-medium",children:s.name}),e.jsx(M,{children:e.jsx(u,{variant:"outline",children:s.value})}),e.jsx(M,{children:s.displayLabel||"-"}),e.jsx(M,{children:e.jsx(O,{checked:s.isActive,onCheckedChange:()=>W&&(async e=>{try{await r.updateFilterConfiguration(e.id,{isActive:!e.isActive}),E({title:"Success",description:`Filter ${e.isActive?"deactivated":"activated"} successfully`}),He()}catch(s){E({title:"Error",description:"Failed to update filter status",variant:"destructive"})}})(s),disabled:!W})}),e.jsx(M,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[B&&e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>Xe(s),children:e.jsx(I,{className:"h-4 w-4"})}),Q&&e.jsx(n,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this filter option?"))try{await r.deleteFilterConfiguration(e),E({title:"Success",description:"Filter deleted successfully"}),He()}catch(s){E({title:"Error",description:"Failed to delete filter",variant:"destructive"})}})(s.id),children:e.jsx(T,{className:"h-4 w-4"})})]})})]},s.id))})]})})]})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Filter Configurations"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage filter options for property search and filtering"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"outline",onClick:()=>Ce(!0),children:"Manage Dependencies"}),e.jsx(n,{variant:"outline",onClick:()=>Se(!0),children:"Manage Option Visibility"}),q&&e.jsxs(n,{onClick:()=>le(!0),children:[e.jsx(c,{className:"h-4 w-4 mr-2"}),"New Filter Type"]})]})]}),0===H.length?e.jsxs("div",{className:"border rounded-lg p-8 text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"No filter types found. Create your first filter type to get started."}),q&&e.jsxs(n,{onClick:()=>le(!0),children:[e.jsx(c,{className:"h-4 w-4 mr-2"}),"Create First Filter Type"]})]}):e.jsxs(d,{value:te,onValueChange:re,children:[e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto",children:e.jsx(o,{className:"inline-flex",children:H.map(s=>e.jsxs(p,{value:s,className:"flex items-center gap-2",children:[e.jsx("span",{children:s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}),e.jsx(u,{variant:"outline",className:"text-[10px] px-1 py-0 h-4 font-normal opacity-70",children:Ze(s)})]},s))})}),H.map(s=>e.jsx(h,{value:s,children:ss(s)},s))]}),e.jsx(x,{open:Te,onOpenChange:Ce,children:e.jsxs(m,{className:"max-w-3xl",children:[e.jsxs(j,{children:[e.jsx(y,{children:"Manage Filter Dependencies"}),e.jsx(f,{children:"Configure which filters should appear based on other filter selections."})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-end border p-4 rounded-lg bg-muted/20",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Target Filter (Show this...)"}),e.jsxs(g,{value:Ve.targetFilterType,onValueChange:e=>Oe({...Ve,targetFilterType:e}),children:[e.jsx(N,{children:e.jsx(F,{placeholder:"Select filter"})}),e.jsx(b,{children:H.map(s=>e.jsx(w,{value:s,children:e.jsxs("div",{className:"flex items-center justify-between w-full gap-2",children:[e.jsx("span",{children:s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}),e.jsx(u,{variant:"secondary",className:"text-[10px] px-1 py-0 h-4 whitespace-nowrap",children:Ze(s)})]})},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Source Filter (...when this is selected)"}),e.jsxs(g,{value:Ve.sourceFilterType,onValueChange:e=>Oe({...Ve,sourceFilterType:e,sourceFilterValues:[]}),children:[e.jsx(N,{children:e.jsx(F,{placeholder:"Select parent filter"})}),e.jsx(b,{children:H.filter(e=>e!==Ve.targetFilterType).map(s=>e.jsx(w,{value:s,children:e.jsxs("div",{className:"flex items-center justify-between w-full gap-2",children:[e.jsx("span",{children:s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}),e.jsx(u,{variant:"secondary",className:"text-[10px] px-1 py-0 h-4 whitespace-nowrap",children:Ze(s)})]})},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Trigger Values (Matches any)"}),e.jsxs(g,{disabled:!Ve.sourceFilterType,onValueChange:e=>{Ve.sourceFilterValues.includes(e)||Oe({...Ve,sourceFilterValues:[...Ve.sourceFilterValues,e]})},children:[e.jsx(N,{children:e.jsx(F,{placeholder:"Add value..."})}),e.jsx(b,{children:Ae.map(s=>{const l="property_type"===Ve.sourceFilterType?pe.find(e=>e.value===s.value):null,a=l?.categories?.[0];return e.jsx(w,{value:s.value,children:e.jsxs("div",{className:"flex items-center justify-between w-full gap-2",children:[e.jsx("span",{children:s.label}),a&&e.jsx(u,{variant:"outline",className:"text-[10px] px-1 py-0 h-4 whitespace-nowrap",children:a})]})},s.value)})})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:Ve.sourceFilterValues.map(s=>e.jsxs(u,{variant:"secondary",className:"cursor-pointer",onClick:()=>{Oe({...Ve,sourceFilterValues:Ve.sourceFilterValues.filter(e=>e!==s)})},children:[Ae.find(e=>e.value===s)?.label||s," ×"]},s))})]})]}),e.jsx(n,{onClick:async()=>{if(!Ve.targetFilterType||!Ve.sourceFilterType||0===Ve.sourceFilterValues.length)return void E({title:"Error",description:"Please fill all fields",variant:"destructive"});const e=[...Ne,Ve];try{await r.saveFilterDependencies(e),Fe(e),Ce(!1),Oe({targetFilterType:"",sourceFilterType:"",sourceFilterValues:[]}),E({title:"Success",description:"Dependency saved successfully"})}catch(s){E({title:"Error",description:"Failed to save dependency",variant:"destructive"})}},className:"w-full",children:"Add Rule"}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(k,{children:[e.jsx(R,{children:e.jsxs(D,{children:[e.jsx(P,{children:"Target Filter"}),e.jsx(P,{children:"Depends On"}),e.jsx(P,{children:"Values"}),e.jsx(P,{className:"text-right",children:"Action"})]})}),e.jsx(z,{children:0===Ne.length?e.jsx(D,{children:e.jsx(M,{colSpan:4,className:"text-center text-muted-foreground",children:"No dependencies configured"})}):Ne.map((s,l)=>e.jsxs(D,{children:[e.jsx(M,{className:"font-medium",children:s.targetFilterType}),e.jsx(M,{children:s.sourceFilterType}),e.jsx(M,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.sourceFilterValues.map(s=>e.jsx(u,{variant:"outline",className:"text-xs",children:s},s))})}),e.jsx(M,{className:"text-right",children:e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>(async e=>{const s=Ne.filter((s,l)=>l!==e);try{await r.saveFilterDependencies(s),Fe(s),E({title:"Success",description:"Dependency deleted successfully"})}catch(l){E({title:"Error",description:"Failed to delete dependency",variant:"destructive"})}})(l),children:e.jsx(T,{className:"h-4 w-4 text-destructive"})})})]},l))})]})})]})]})}),e.jsx(x,{open:_e,onOpenChange:Se,children:e.jsxs(m,{className:"max-w-4xl",children:[e.jsxs(j,{children:[e.jsx(y,{children:"Manage Filter Option Visibility"}),e.jsx(f,{children:"Configure which specific options should appear based on other filter selections."})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4 items-end border p-4 rounded-lg bg-muted/20",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Filter Type"}),e.jsxs(g,{value:Ee.filterType,onValueChange:e=>Le({...Ee,filterType:e,optionValue:""}),children:[e.jsx(N,{children:e.jsx(F,{placeholder:"Select filter"})}),e.jsx(b,{children:H.map(s=>e.jsx(w,{value:s,children:e.jsxs("div",{className:"flex items-center justify-between w-full gap-2",children:[e.jsx("span",{children:s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}),e.jsx(u,{variant:"secondary",className:"text-[10px] px-1 py-0 h-4 whitespace-nowrap",children:Ze(s)})]})},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Specific Option"}),e.jsxs(g,{disabled:!Ee.filterType,value:Ee.optionValue,onValueChange:e=>Le({...Ee,optionValue:e}),children:[e.jsx(N,{children:e.jsx(F,{placeholder:"Select option"})}),e.jsx(b,{children:Re.map(s=>{const l="property_type"===Ee.filterType?pe.find(e=>e.value===s.value):null,a=l?.categories?.[0];return e.jsx(w,{value:s.value,children:e.jsxs("div",{className:"flex items-center justify-between w-full gap-2",children:[e.jsx("span",{children:s.label}),a&&e.jsx(u,{variant:"outline",className:"text-[10px] px-1 py-0 h-4 whitespace-nowrap",children:a})]})},s.value)})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Source Filter"}),e.jsxs(g,{value:Ee.sourceFilterType,onValueChange:e=>Le({...Ee,sourceFilterType:e,sourceFilterValues:[]}),children:[e.jsx(N,{children:e.jsx(F,{placeholder:"Select parent"})}),e.jsx(b,{children:H.filter(e=>e!==Ee.filterType).map(s=>e.jsx(w,{value:s,children:e.jsxs("div",{className:"flex items-center justify-between w-full gap-2",children:[e.jsx("span",{children:s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}),e.jsx(u,{variant:"secondary",className:"text-[10px] px-1 py-0 h-4 whitespace-nowrap",children:Ze(s)})]})},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Trigger Values"}),e.jsxs(g,{disabled:!Ee.sourceFilterType,onValueChange:e=>{Ee.sourceFilterValues.includes(e)||Le({...Ee,sourceFilterValues:[...Ee.sourceFilterValues,e]})},children:[e.jsx(N,{children:e.jsx(F,{placeholder:"Add value..."})}),e.jsx(b,{children:Ye.map(s=>{const l="property_type"===Ee.sourceFilterType?pe.find(e=>e.value===s.value):null,a=l?.categories?.[0];return e.jsx(w,{value:s.value,children:e.jsxs("div",{className:"flex items-center justify-between w-full gap-2",children:[e.jsx("span",{children:s.label}),a&&e.jsx(u,{variant:"outline",className:"text-[10px] px-1 py-0 h-4 whitespace-nowrap",children:a})]})},s.value)})})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:Ee.sourceFilterValues.map(s=>e.jsxs(u,{variant:"secondary",className:"cursor-pointer",onClick:()=>{Le({...Ee,sourceFilterValues:Ee.sourceFilterValues.filter(e=>e!==s)})},children:[Ye.find(e=>e.value===s)?.label||s," ×"]},s))})]})]}),e.jsx(n,{onClick:async()=>{if(!Ee.filterType||!Ee.optionValue||!Ee.sourceFilterType||0===Ee.sourceFilterValues.length)return void E({title:"Error",description:"Please fill all fields",variant:"destructive"});const e=[...be,Ee];try{await r.saveFilterOptionVisibility(e),we(e),Se(!1),Le({filterType:"",optionValue:"",sourceFilterType:"",sourceFilterValues:[]}),E({title:"Success",description:"Option visibility rule saved successfully"})}catch(s){E({title:"Error",description:"Failed to save option visibility rule",variant:"destructive"})}},className:"w-full",children:"Add Visibility Rule"}),e.jsx("div",{className:"border rounded-lg max-h-[400px] overflow-y-auto",children:e.jsxs(k,{children:[e.jsx(R,{children:e.jsxs(D,{children:[e.jsx(P,{children:"Target Filter"}),e.jsx(P,{children:"Option"}),e.jsx(P,{children:"Depends On"}),e.jsx(P,{children:"Source Values"}),e.jsx(P,{className:"text-right",children:"Action"})]})}),e.jsx(z,{children:0===be.length?e.jsx(D,{children:e.jsx(M,{colSpan:5,className:"text-center text-muted-foreground",children:"No option visibility rules configured"})}):be.map((s,l)=>e.jsxs(D,{children:[e.jsx(M,{className:"font-medium",children:s.filterType}),e.jsx(M,{children:e.jsx(u,{variant:"secondary",children:s.optionValue})}),e.jsx(M,{children:s.sourceFilterType}),e.jsx(M,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.sourceFilterValues.map(s=>e.jsx(u,{variant:"outline",className:"text-xs",children:s},s))})}),e.jsx(M,{className:"text-right",children:e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>(async e=>{const s=be.filter((s,l)=>l!==e);try{await r.saveFilterOptionVisibility(s),we(s),E({title:"Success",description:"Option visibility rule deleted successfully"})}catch(l){E({title:"Error",description:"Failed to delete option visibility rule",variant:"destructive"})}})(l),children:e.jsx(T,{className:"h-4 w-4 text-destructive"})})})]},l))})]})})]})]})}),e.jsx(x,{open:X,onOpenChange:ee,children:e.jsxs(m,{children:[e.jsxs(j,{children:[e.jsx(y,{children:ae?"Edit Filter":"Add Filter"}),e.jsx(f,{children:ae?"Update the filter details below":"Create a new filter option"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"filter_type",children:"Filter Type"}),e.jsxs(g,{value:ve.filter_type,onValueChange:e=>{ge({...ve,filter_type:e}),"location"!==e&&(ze(""),Ie([]))},disabled:!!ae,children:[e.jsx(N,{children:e.jsx(F,{})}),e.jsx(b,{children:H.map(s=>e.jsx(w,{value:s,children:e.jsxs("div",{className:"flex items-center justify-between w-full gap-2",children:[e.jsx("span",{children:s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}),e.jsx(u,{variant:"secondary",className:"text-[10px] px-1 py-0 h-4 whitespace-nowrap",children:Ze(s)})]})},s))})]})]}),"property_type"===ve.filter_type&&e.jsxs("div",{className:"space-y-2 p-3 border rounded-md bg-muted/20",children:[e.jsx(v,{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Quick Fill from Property Management"}),e.jsxs(g,{onValueChange:e=>{const s=pe.find(s=>s.value===e);s&&ge({...ve,name:s.name,value:s.value,display_label:s.name})},children:[e.jsx(N,{children:e.jsx(F,{placeholder:"Select existing property type..."})}),e.jsx(b,{children:pe.map(s=>e.jsx(w,{value:s.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.name}),s.categories?.map(s=>e.jsx(u,{variant:"secondary",className:"text-[10px] px-1 py-0 h-4",children:s},s))]})},s._id))})]})]}),(()=>{const s=e=>e.toLowerCase().replace(/[^a-z0-9]/g,""),l=s(ve.filter_type),a=de.find(e=>s(e.fieldName)===l&&e.fieldOptions&&e.fieldOptions.length>0),i={listingtype:["Sale","Rent","Lease","PG"],furnishing:["Fully Furnished","Semi Furnished","Unfurnished"],possessionstatus:["Ready to Move","Under Construction"],facing:["North","South","East","West","North-East","North-West","South-East","South-West"],gender:["Male","Female","Any"],parking:["Covered","Open","None"],wateravailability:["24 Hours","12 Hours","Rare"]}[l],t=a?a.fieldOptions:i,r=a?`Quick Fill from ${a.fieldLabel} Options`:"Quick Fill Standard Suggestions";return t&&t.length>0?e.jsxs("div",{className:"space-y-2 p-3 border rounded-md bg-muted/20",children:[e.jsx(v,{className:"text-xs font-semibold uppercase text-muted-foreground",children:r}),e.jsxs(g,{onValueChange:e=>{const s=e.toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_+]/g,"");ge({...ve,name:e,value:s,display_label:e})},children:[e.jsx(N,{children:e.jsx(F,{placeholder:"Select an option to auto-fill..."})}),e.jsx(b,{children:t.map(s=>e.jsx(w,{value:s,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(u,{variant:"outline",className:"text-[10px] px-1 py-0 h-4",children:a?"Field Option":"Suggestion"})]})},s))})]})]}):null})(),"location"===ve.filter_type?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"location_search",children:"Search Location"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{id:"location_search",value:Pe,onChange:e=>{const s=e.target.value;ze(s),s.length>2?(qe(!0),setTimeout(()=>{const e=t.searchLocations(s);Ie(e),qe(!1)},100)):Ie([])},placeholder:t.isReady()?"Search city, district, or pincode...":"Initializing location database...",className:"pr-10",disabled:!t.isReady()}),(!t.isReady()||Ue)&&e.jsx("div",{className:"absolute right-3 top-2.5",children:e.jsx(_,{className:"h-4 w-4 animate-spin text-muted-foreground"})}),Pe.length>2&&0===Me.length&&!Ue&&t.isReady()&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-popover border rounded-md shadow-md p-4 text-sm text-center text-muted-foreground",children:['No locations found matching "',Pe,'"']}),Me.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-popover border rounded-md shadow-md max-h-60 overflow-y-auto",children:Me.map((s,l)=>e.jsxs("div",{className:"px-4 py-2 hover:bg-accent hover:text-accent-foreground cursor-pointer text-sm border-b last:border-0",onClick:()=>{const e=s.city,l=s.city.toLowerCase().replace(/\s+/g,"-");ge({...ve,name:e,value:l,display_label:e}),ze(e),Ie([])},children:[e.jsx("div",{className:"font-medium text-foreground",children:s.city}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.district,", ",s.state," - ",s.pincode]})]},`${s.pincode}-${l}`))})]}),!t.isReady()&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Please wait while we load the location database (approx. 20MB)..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"name",children:"Selected Name"}),e.jsx(C,{id:"name",value:ve.name,onChange:e=>ge({...ve,name:e.target.value}),readOnly:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"value",children:"Selected Value"}),e.jsx(C,{id:"value",value:ve.value,onChange:e=>ge({...ve,value:e.target.value}),readOnly:!0,className:"bg-muted"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"name",children:"Name *"}),e.jsx(C,{id:"name",value:ve.name,onChange:e=>ge({...ve,name:e.target.value}),placeholder:"e.g., For Sale",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"value",children:"Value (Unique ID) *"}),e.jsx(C,{id:"value",value:ve.value,onChange:e=>ge({...ve,value:e.target.value}),placeholder:"e.g., sale",disabled:!!ae,required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"display_label",children:"Display Label (Optional)"}),e.jsx(C,{id:"display_label",value:ve.display_label,onChange:e=>ge({...ve,display_label:e.target.value}),placeholder:"Defaults to Name if not provided"})]}),["budget","area"].includes(ve.filter_type)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"min_value",children:["Min Value ","budget"===ve.filter_type?"(₹)":"(sq ft)"]}),e.jsx(C,{id:"min_value",type:"number",value:ve.min_value||"",onChange:e=>ge({...ve,min_value:e.target.value?parseFloat(e.target.value):void 0}),placeholder:"budget"===ve.filter_type?"e.g., 2000000":"e.g., 1000"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"max_value",children:["Max Value ","budget"===ve.filter_type?"(₹)":"(sq ft)"]}),e.jsx(C,{id:"max_value",type:"number",value:ve.max_value||"",onChange:e=>ge({...ve,max_value:e.target.value?parseFloat(e.target.value):void 0}),placeholder:"budget"===ve.filter_type?"e.g., 4000000":"e.g., 2000"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"display_order",children:"Display Order"}),e.jsx(C,{id:"display_order",type:"number",value:ve.display_order,onChange:e=>ge({...ve,display_order:parseInt(e.target.value)||0})})]})]}),e.jsxs(S,{children:[e.jsx(n,{variant:"outline",onClick:es,children:"Cancel"}),e.jsx(n,{onClick:async()=>{try{if(!ve.filter_type||!ve.name||!ve.value)return void E({title:"Error",description:"Please fill in all required fields",variant:"destructive"});if(Y.some(e=>e.filterType===ve.filter_type&&e.value===ve.value&&(!ae||e.id!==ae.id)))return void E({title:"Error",description:"A filter with this value already exists for this type.",variant:"destructive"});ae?(await r.updateFilterConfiguration(ae.id,ve),E({title:"Success",description:"Filter updated successfully"})):(await r.createFilterConfiguration(ve),E({title:"Success",description:"Filter created successfully"})),He(),es()}catch(e){E({title:"Error",description:"Failed to save filter configuration",variant:"destructive"})}},children:ae?"Update":"Create"})]})]})}),e.jsx(x,{open:se,onOpenChange:e=>{le(e),e&&0===de.length&&Je()},children:e.jsxs(m,{children:[e.jsxs(j,{children:[e.jsx(y,{children:"Create New Filter Type"}),e.jsx(f,{children:"Create a new filter category. You can type a custom name or select from existing property fields."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2 relative",children:[e.jsx(v,{htmlFor:"newFilterTypeName",children:"Filter Type Name *"}),e.jsx(C,{id:"newFilterTypeName",value:ne,onChange:e=>{ce(e.target.value),je(null)},placeholder:"Type to search or enter custom name...",autoComplete:"off"}),ne.length>=1&&(()=>{if(he)return e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-popover border rounded-md shadow-md p-3 text-sm text-muted-foreground",children:"Loading fields..."});if(0===de.length)return null;const s=de.filter(e=>e.fieldLabel.toLowerCase().includes(ne.toLowerCase())||e.fieldName.toLowerCase().includes(ne.toLowerCase()));return 0===s.length||1===s.length&&s[0].fieldLabel===ne?null:e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-popover border rounded-md shadow-md max-h-48 overflow-y-auto",children:s.map(s=>e.jsxs("div",{className:"px-3 py-2 text-sm cursor-pointer hover:bg-accent hover:text-accent-foreground border-b last:border-0",onClick:()=>{ce(s.fieldLabel),je(s)},children:[e.jsxs("div",{className:"font-medium",children:[s.fieldLabel,e.jsxs("span",{className:"text-muted-foreground font-normal ml-1",children:["(",s.propertyTypeName,")"]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Type: ",s.fieldType,s.fieldOptions&&s.fieldOptions.length>0&&e.jsxs("span",{className:"ml-2 text-green-600",children:["• ",s.fieldOptions.length," options will be auto-created"]})]})]},s.fieldName))})})(),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Type to search existing fields or enter a custom filter name.",me&&me.fieldOptions?.length>0&&e.jsxs("span",{className:"block mt-1 text-green-600 font-medium",children:["✓ Selected field has ",me.fieldOptions.length," options that will be auto-populated"]})]})]})}),e.jsxs(S,{children:[e.jsx(n,{variant:"outline",onClick:()=>{le(!1),ce("")},children:"Cancel"}),e.jsx(n,{onClick:async()=>{if(!ne.trim())return;const e=ne.toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"");if(H.includes(e))E({title:"Error",description:"Filter type already exists",variant:"destructive"});else try{J(!0),me&&me.fieldOptions&&me.fieldOptions.length>0?(await Promise.all(me.fieldOptions.map((s,l)=>r.createFilterConfiguration({filter_type:e,name:s,value:s.toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_+]/g,""),display_label:s,display_order:l+1}))),E({title:"Success",description:`Filter type "${e}" created with ${me.fieldOptions.length} options auto-populated from field configuration.`}),He()):E({title:"Success",description:`Filter type "${e}" created. You can now add options to it.`}),K([...H,e].sort()),re(e),le(!1),ce(""),je(null)}catch(s){E({title:"Error",description:"Failed to create filter type",variant:"destructive"})}finally{J(!1)}},children:"Create Filter Type"})]})]})})]})},B=()=>{const{user:t}=a(),r=l(),{toast:n}=i(),c=t?.rolePermissions||[],d="admin"===t?.role||"superadmin"===t?.role||(o=V.FILTER_READ,c.includes(o));var o;return s.useEffect(()=>{d||(n({title:"Access Denied",description:"You don't have permission to view filter management.",variant:"destructive"}),r("/rolebased"))},[d,r,n]),d?e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(E,{className:"h-8 w-8"}),"Filter Management"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Configure search filters for the property search page"})]})}),e.jsx(U,{children:e.jsxs(q,{children:[e.jsx("strong",{children:"Note:"})," These filters appear on the customer property search page. Create dynamic filter types like Bedrooms, Budget, Listing Type, Furnishing, etc."]})}),e.jsx(L,{children:e.jsx(A,{className:"pt-6",children:e.jsx($,{})})})]}):null};export{B as default};

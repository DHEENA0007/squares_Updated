import{j as e}from"./ui-DHQhougw.js";import{r as t}from"./router-Bi51YGN-.js";import{t as s,O as a,R as i,V as r,W as n,Y as l,Z as c,B as o,f as d,S as m,r as x,s as u,v as h,w as p,a as g,e as j,a4 as f,a5 as v,a6 as y,ak as N,b,c as w,as as S,$ as D,E as F,o as P,aF as I,G as $,n as C,C as R}from"./index-D7KzNfIb.js";import{u as z}from"./use-mobile-WsBtvUz6.js";import{E,a as A}from"./jspdf.plugin.autotable-DwG0JZ7q.js";import{D as T}from"./download-DFE6Pq99.js";import{T as k}from"./trending-up-jUvE4dj9.js";import{D as B}from"./dollar-sign-DGVqv-Gg.js";import{C as _}from"./circle-alert-CnFPhnT_.js";import"./vendor-eVk5PToZ.js";const O="https://api.akodefy.com/api";const U=new class{async makeRequest(e,t={}){const s=`${O}${e}`,a={headers:{"Content-Type":"application/json",...t.headers},...t},i=localStorage.getItem("token");i&&(a.headers={...a.headers,Authorization:`Bearer ${i}`});try{const e=await fetch(s,a);if(!e.ok){const t=await e.json().catch(()=>({success:!1,message:`HTTP ${e.status}: ${e.statusText}`}));throw new Error(t.message||"An error occurred")}return await e.json()}catch(r){throw r}}async getSubscriptionPlans(){try{const e=await this.makeRequest("/billing/plans");return e.success?e.data:[]}catch(e){return[]}}async getCurrentSubscription(){try{const e=await this.makeRequest("/vendors/subscription/current");return e.success?e.data:null}catch(e){return null}}async upgradeSubscription(e,t){try{const a=await this.makeRequest("/vendors/subscription/upgrade",{method:"POST",body:JSON.stringify({planId:e,billingCycle:t})});return a.success&&s({title:"Success",description:a.message||"Subscription upgrade initiated!"}),{success:a.success,paymentUrl:a.data?.paymentUrl,message:a.message}}catch(a){const e=a instanceof Error?a.message:"Failed to upgrade subscription";return s({title:"Error",description:e,variant:"destructive"}),{success:!1,message:e}}}async cancelSubscription(e){try{const t=await this.makeRequest("/vendors/subscription/cancel",{method:"POST",body:JSON.stringify({reason:e})});if(t.success)return s({title:"Success",description:t.message||"Subscription cancelled successfully!"}),!0;throw new Error(t.message||"Failed to cancel subscription")}catch(t){const e=t instanceof Error?t.message:"Failed to cancel subscription";return s({title:"Error",description:e,variant:"destructive"}),!1}}async reactivateSubscription(){try{const e=await this.makeRequest("/vendors/subscription/reactivate",{method:"POST"});if(e.success)return s({title:"Success",description:e.message||"Subscription reactivated successfully!"}),!0;throw new Error(e.message||"Failed to reactivate subscription")}catch(e){const t=e instanceof Error?e.message:"Failed to reactivate subscription";return s({title:"Error",description:t,variant:"destructive"}),!1}}async getPayments(e={}){try{const t=new URLSearchParams;Object.entries(e).forEach(([e,s])=>{null!=s&&""!==s&&t.append(e,s.toString())});const s="/vendors/payments"+(t.toString()?`?${t.toString()}`:""),a=await this.makeRequest(s);return a.success&&a.data?a.data:{payments:[],totalCount:0,totalPages:0,currentPage:1}}catch(t){return{payments:[],totalCount:0,totalPages:0,currentPage:1}}}async getInvoices(e={}){try{const t=new URLSearchParams;Object.entries(e).forEach(([e,s])=>{null!=s&&""!==s&&t.append(e,s.toString())});const s="/vendors/invoices"+(t.toString()?`?${t.toString()}`:""),a=await this.makeRequest(s);return a.success&&a.data?a.data:{invoices:[],totalCount:0,totalPages:0,currentPage:1}}catch(t){return{invoices:[],totalCount:0,totalPages:0,currentPage:1}}}async downloadInvoice(e){try{const t=await this.getInvoiceDetails(e);if(t)return this.generateInvoicePDF(t);const a=await fetch(`${O}/vendors/invoices/${e}/download`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!a.ok){const e=await a.text();let t="Failed to download invoice";try{t=JSON.parse(e).message||t}catch{t=e||t}throw new Error(t)}const i=a.headers.get("content-type");if(!i||!i.includes("application/pdf"))throw new Error("Invalid invoice format received from server");const r=await a.blob();if(0===r.size)throw new Error("Invoice file is empty");return s({title:"Success",description:"Invoice downloaded successfully!"}),r}catch(t){const e=t instanceof Error?t.message:"Failed to download invoice";return s({title:"Error",description:e,variant:"destructive"}),null}}generateInvoicePDF(e){const t=new E({orientation:"portrait",unit:"mm",format:"a4"});try{const s=20,a=t.internal.pageSize.getWidth(),i=t.internal.pageSize.getHeight();let r=25;t.setFontSize(18),t.setFont("courier","bold");const n="=====================================";t.text(n,a/2,r,{align:"center"}),r+=10,t.setFontSize(14),t.text("         INVOICE",a/2,r,{align:"center"}),r+=10,t.setFontSize(18),t.text(n,a/2,r,{align:"center"}),r+=20,t.setFontSize(10),t.setFont("courier","normal"),t.text(`Invoice #: ${e.invoiceNumber}`,s,r),r+=7,t.text(`Issue Date: ${this.formatDate(e.issueDate)}`,s,r),r+=7,t.text(`Due Date: ${this.formatDate(e.dueDate)}`,s,r),r+=7,t.text(`Status: ${e.status.toUpperCase()}`,s,r),r+=15,t.setFontSize(11),t.setFont("courier","bold"),t.text("Bill To:",s,r),r+=8,t.setFontSize(9),t.setFont("courier","normal"),t.text(e.vendorDetails.name,s,r),r+=6,t.text(e.vendorDetails.email,s,r),r+=6,t.text(e.vendorDetails.phone,s,r),r+=6,e.vendorDetails.address&&(t.text(e.vendorDetails.address,s,r),r+=6),e.vendorDetails.gst&&(t.text(`GST: ${e.vendorDetails.gst}`,s,r),r+=6),r+=8,t.setFontSize(11),t.setFont("courier","bold"),t.text("Items:",s,r),r+=7,t.setFontSize(9),t.setFont("courier","normal");const l="-------------------------------------";return t.text(l,s,r),r+=7,e.items.forEach(e=>{t.text(`Description: ${e.description}`,s,r),r+=5,t.text(`Quantity: ${e.quantity}`,s,r),r+=5,t.text(`Unit Price: ₹${this.formatCurrency(e.unitPrice)}`,s,r),r+=5,t.text(`Total: ₹${this.formatCurrency(e.total)}`,s,r),r+=8}),t.text(l,s,r),r+=8,t.setFontSize(10),t.setFont("courier","normal"),t.text(`Subtotal: ₹${this.formatCurrency(e.amount)}`,s,r),r+=6,t.text(`Tax (${e.tax>0?Math.round(e.tax/e.amount*100):18}% GST): ₹${this.formatCurrency(e.tax)}`,s,r),r+=10,t.setFontSize(12),t.setFont("courier","bold"),t.text("=====================================",a/2,r,{align:"center"}),r+=7,t.text(`TOTAL: ₹${this.formatCurrency(e.total)}`,a/2,r,{align:"center"}),r+=7,t.text("=====================================",a/2,r,{align:"center"}),r+=15,e.paidDate&&(t.setFontSize(10),t.setFont("courier","normal"),t.text("Payment Method: "+("paid"===e.status?"Razorpay":"Pending"),s,r),r+=6,t.text(`Paid Date: ${this.formatDate(e.paidDate)}`,s,r),r+=15),t.setFontSize(9),t.setFont("courier","normal"),t.text("Thank you for your business!",a/2,i-20,{align:"center"}),t.setFontSize(11),t.setFont("courier","bold"),t.text("BuildHomeMartSquares",a/2,i-12,{align:"center"}),t.setFontSize(8),t.setFont("courier","normal"),t.text("www.buildhomemartsquares.com",a/2,i-6,{align:"center"}),t.output("blob")}catch(s){throw new Error("Failed to generate invoice PDF")}}async getBillingStats(){try{const e=await this.makeRequest("/vendors/billing/stats");return e.success&&e.data?e.data:{totalRevenue:0,monthlyRevenue:0,activeSubscriptions:0,totalInvoices:0,paidInvoices:0,overdueInvoices:0,nextBillingAmount:0,nextBillingDate:(new Date).toISOString(),subscriptionStatus:"inactive",usageStats:{properties:{used:0,limit:0},leads:{used:0,limit:0},messages:{used:0,limit:0}}}}catch(e){return{totalRevenue:0,monthlyRevenue:0,activeSubscriptions:0,totalInvoices:0,paidInvoices:0,overdueInvoices:0,nextBillingAmount:0,nextBillingDate:(new Date).toISOString(),subscriptionStatus:"inactive",usageStats:{properties:{used:0,limit:0},leads:{used:0,limit:0},messages:{used:0,limit:0}}}}}formatCurrency(e){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}formatDate(e){return new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})}getStatusColor(e){return{active:"text-green-600 bg-green-100",cancelled:"text-red-600 bg-red-100",expired:"text-orange-600 bg-orange-100",pending:"text-yellow-600 bg-yellow-100",trial:"text-blue-600 bg-blue-100",completed:"text-green-600 bg-green-100",failed:"text-red-600 bg-red-100",refunded:"text-purple-600 bg-purple-100",paid:"text-green-600 bg-green-100",overdue:"text-red-600 bg-red-100",sent:"text-blue-600 bg-blue-100",draft:"text-gray-600 bg-gray-100"}[e]||"text-gray-600 bg-gray-100"}getUsagePercentage(e,t){return 0===t?0:Math.min(e/t*100,100)}downloadBlob(e,t){const s=window.URL.createObjectURL(e),a=document.createElement("a");a.href=s,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(s)}async getPaymentDetails(e){try{const t=await this.makeRequest(`/vendors/payments/${e}`);return t.success?t.data:null}catch(t){return s({title:"Error",description:"Failed to load payment details",variant:"destructive"}),null}}async getInvoiceDetails(e){try{const t=await this.makeRequest(`/vendors/invoices/${e}`);return t.success?t.data:null}catch(t){return s({title:"Error",description:"Failed to load invoice details",variant:"destructive"}),null}}async downloadReceipt(e){try{const t=await this.getPaymentDetails(e);if(t)return this.generateReceiptPDF(t);const a=await fetch(`${O}/vendors/payments/${e}/receipt`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!a.ok){const e=await a.text();let t="Failed to download receipt";try{t=JSON.parse(e).message||t}catch{t=e||t}throw new Error(t)}const i=a.headers.get("content-type");if(!i||!i.includes("application/pdf"))throw new Error("Invalid receipt format received from server");const r=await a.blob();if(0===r.size)throw new Error("Receipt file is empty");return s({title:"Success",description:"Receipt downloaded successfully!"}),r}catch(t){const e=t instanceof Error?t.message:"Failed to download receipt";return s({title:"Error",description:e,variant:"destructive"}),null}}generateReceiptPDF(e){const t=new E({orientation:"portrait",unit:"mm",format:"a4"});try{const s=20,a=t.internal.pageSize.getWidth(),i=t.internal.pageSize.getHeight();let r=25;t.setFontSize(18),t.setFont("courier","bold");const n="=====================================";t.text(n,a/2,r,{align:"center"}),r+=10,t.setFontSize(14),t.text("       PAYMENT RECEIPT",a/2,r,{align:"center"}),r+=10,t.setFontSize(18),t.text(n,a/2,r,{align:"center"}),r+=20,t.setFontSize(10),t.setFont("courier","normal"),t.text(`Receipt #: ${e._id.slice(-8).toUpperCase()}`,s,r),r+=7,t.text(`Date: ${this.formatDate(e.paidAt||e.createdAt)}`,s,r),r+=7,t.text(`Status: ${e.status.toUpperCase()}`,s,r),r+=15,t.setFontSize(11),t.setFont("courier","bold"),t.text("Payment Details:",s,r),r+=8,t.setFontSize(9),t.setFont("courier","normal");const l="-------------------------------------";return t.text(l,s,r),r+=7,t.text(`Description: ${e.description||"Payment"}`,s,r),r+=5,t.text(`Amount: ₹${this.formatCurrency(e.amount)}`,s,r),r+=8,t.text(l,s,r),r+=8,t.setFontSize(11),t.setFont("courier","bold"),t.text("Transaction Details:",s,r),r+=8,t.setFontSize(9),t.setFont("courier","normal"),t.text(l,s,r),r+=7,t.text(`Payment Method: ${e.paymentMethod.replace("_"," ").toUpperCase()}`,s,r),r+=5,e.transactionId&&(t.text(`Transaction ID: ${e.transactionId}`,s,r),r+=5),e.gatewayOrderId&&(t.text(`Gateway Order ID: ${e.gatewayOrderId}`,s,r),r+=5),t.text(`Payment Gateway: ${e.paymentGateway.toUpperCase()}`,s,r),r+=5,e.subscriptionId&&(t.text(`Subscription ID: ${e.subscriptionId.slice(-8).toUpperCase()}`,s,r),r+=5),t.text(l,s,r),r+=15,t.setFontSize(9),t.setFont("courier","normal"),t.text("Thank you for your business!",a/2,i-20,{align:"center"}),t.setFontSize(11),t.setFont("courier","bold"),t.text("BuildHomeMartSquares",a/2,i-12,{align:"center"}),t.setFontSize(8),t.setFont("courier","normal"),t.text("www.buildhomemartsquares.com",a/2,i-6,{align:"center"}),t.output("blob")}catch(s){throw new Error("Failed to generate receipt PDF")}}async exportBillingData(e,t={}){try{if("pdf"===e)return this.generateBillingReportPDF(t);const a=new URLSearchParams;a.append("format",e),Object.entries(t).forEach(([e,t])=>{null!=t&&""!==t&&a.append(e,t.toString())});const i=await fetch(`${O}/vendors/billing/export?${a.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!i.ok)throw new Error("Failed to export billing data");const r=await i.blob();return s({title:"Success",description:"Billing data exported successfully!"}),r}catch(a){const e=a instanceof Error?a.message:"Failed to export billing data";return s({title:"Error",description:e,variant:"destructive"}),null}}async generateBillingReportPDF(e={}){const t=new E({orientation:"portrait",unit:"mm",format:"a4"});try{const s=20,a=20,i=t.internal.pageSize.getWidth(),r=t.internal.pageSize.getHeight(),n=i-s-a;let l=25;t.setFontSize(18),t.setFont("helvetica","bold"),t.text("BILLING REPORT",i/2,l,{align:"center"}),t.setFontSize(11),t.setFont("helvetica","normal"),l+=15;const c=e.dateFrom&&e.dateTo?`${this.formatDate(e.dateFrom)} - ${this.formatDate(e.dateTo)}`:"All Time";t.text(`Report Period: ${c}`,s,l),l+=8,t.text(`Generated: ${this.formatDate((new Date).toISOString())}`,s,l),l+=20;const o=await this.getBillingStats();t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Summary",s,l),l+=10;const d=[["Metric","Value"],["Total Revenue",`₹${this.formatCurrency(o.totalRevenue)}`],["Monthly Revenue",`₹${this.formatCurrency(o.monthlyRevenue)}`],["Active Subscriptions",o.activeSubscriptions.toString()],["Total Invoices",o.totalInvoices.toString()],["Paid Invoices",o.paidInvoices.toString()],["Overdue Invoices",o.overdueInvoices.toString()]];A(t,{body:d,startY:l,theme:"grid",styles:{fontSize:9,cellPadding:3},headStyles:{fillColor:[41,128,185],fontSize:10},columnStyles:{0:{cellWidth:.6*n},1:{cellWidth:.4*n,halign:"right"}},margin:{left:s,right:a}}),l=t.lastAutoTable.finalY+15;const m=await this.getPayments(e);if(m.payments.length>0){l>r-80&&(t.addPage(),l=25),t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Recent Payments",s,l),l+=10;const e=[["Date","Description","Amount","Status","Method"]];m.payments.slice(0,10).forEach(t=>{e.push([this.formatDate(t.paidAt||t.createdAt),t.description,`₹${this.formatCurrency(t.amount)}`,t.status.toUpperCase(),t.paymentMethod.replace("_"," ").toUpperCase()])}),A(t,{body:e,startY:l,theme:"grid",styles:{fontSize:7,cellPadding:2},headStyles:{fillColor:[52,152,219],fontSize:8},columnStyles:{0:{cellWidth:.2*n},1:{cellWidth:.35*n},2:{cellWidth:.2*n,halign:"right"},3:{cellWidth:.15*n,halign:"center"},4:{cellWidth:.1*n}},margin:{left:s,right:a}})}const x=await this.getInvoices(e);if(x.invoices.length>0){l=t.lastAutoTable.finalY+15,l>r-80&&(t.addPage(),l=25),t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Recent Invoices",s,l),l+=10;const e=[["Invoice #","Date","Amount","Status"]];x.invoices.slice(0,10).forEach(t=>{e.push([t.invoiceNumber,this.formatDate(t.issueDate),`₹${this.formatCurrency(t.total)}`,t.status.toUpperCase()])}),A(t,{body:e,startY:l,theme:"grid",styles:{fontSize:8,cellPadding:2},headStyles:{fillColor:[155,89,182],fontSize:9},columnStyles:{0:{cellWidth:.3*n},1:{cellWidth:.25*n},2:{cellWidth:.25*n,halign:"right"},3:{cellWidth:.2*n,halign:"center"}},margin:{left:s,right:a}})}return t.setFontSize(8),t.setFont("helvetica","italic"),t.text("Generated by Squares Billing System",i/2,r-10,{align:"center"}),t.output("blob")}catch(s){const e=new E({orientation:"portrait",unit:"mm",format:"a4"}),t=e.internal.pageSize.getWidth();return e.internal.pageSize.getHeight(),e.setFontSize(16),e.setFont("helvetica","bold"),e.text("BILLING REPORT",t/2,40,{align:"center"}),e.setFontSize(12),e.setFont("helvetica","normal"),e.text("Error generating detailed report.",20,60),e.text("Please try again later.",20,70),e.output("blob")}}},M=()=>{const E=z(),[A,O]=t.useState(!0),[M,L]=t.useState(null),[q,W]=t.useState([]),[G,H]=t.useState([]),[Y,V]=t.useState(null),[J,Q]=t.useState("last_30_days"),[X,Z]=t.useState("overview"),[K,ee]=t.useState(null),[te,se]=t.useState(null),[ae,ie]=t.useState(!1),[re,ne]=t.useState(!1),[le,ce]=t.useState(!1);t.useEffect(()=>{de()},[J]);const oe=e=>{const t={last_7_days:7,last_30_days:30,last_90_days:90,last_year:365}[e]||30;return new Date((new Date).getTime()-24*t*60*60*1e3).toISOString().split("T")[0]},de=async()=>{try{O(!0);const[e,t,s,a]=await Promise.all([U.getCurrentSubscription(),U.getPayments({page:1,limit:20,dateFrom:oe(J)}),U.getInvoices({page:1,limit:10}),U.getBillingStats()]);L(e),W(t.payments||[]),H(s.invoices||[]),V(a)}catch(e){s({title:"Error",description:"Failed to load billing information. Please try again.",variant:"destructive"})}finally{O(!1)}},me=t=>{switch(t){case"completed":case"active":case"paid":return e.jsx(R,{className:"w-4 h-4 text-green-600"});case"pending":case"sent":return e.jsx(C,{className:"w-4 h-4 text-yellow-600"});case"failed":return e.jsx(_,{className:"w-4 h-4 text-red-600"});case"cancelled":case"expired":case"overdue":return e.jsx($,{className:"w-4 h-4 text-red-600"});default:return e.jsx(_,{className:"w-4 h-4 text-gray-600"})}},xe=e=>{switch(e){case"completed":case"active":case"paid":return"bg-green-100 text-green-800";case"pending":case"sent":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},ue=(e,t="INR")=>new Intl.NumberFormat("en-IN",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:0}).format(e),he=e=>new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),pe=async e=>{try{const t=await U.downloadReceipt(e._id);t?(U.downloadBlob(t,`receipt-${e._id.slice(-8)}.pdf`),s({title:"Success",description:"Payment receipt downloaded successfully."})):s({title:"Error",description:"Failed to generate receipt. No data received.",variant:"destructive"})}catch(t){s({title:"Error",description:"Failed to download receipt. Please try again.",variant:"destructive"})}},ge=async e=>{try{const t=await U.downloadInvoice(e._id);t?(U.downloadBlob(t,`invoice-${e.invoiceNumber}.pdf`),s({title:"Success",description:`Invoice ${e.invoiceNumber} downloaded successfully.`})):s({title:"Error",description:`Failed to generate invoice ${e.invoiceNumber}. No data received.`,variant:"destructive"})}catch(t){s({title:"Error",description:`Failed to download invoice ${e.invoiceNumber}. Please try again.`,variant:"destructive"})}};return A?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{children:"Loading billing information..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(i,{open:ae,onOpenChange:ie,children:e.jsxs(r,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(n,{children:[e.jsx(l,{children:"Payment Details"}),e.jsx(c,{children:"Complete information about this payment transaction"})]}),le?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(a,{className:"h-6 w-6 animate-spin"})}):K?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Payment ID"}),e.jsx("p",{className:"font-medium",children:K._id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Transaction ID"}),e.jsx("p",{className:"font-medium",children:K.transactionId||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Amount"}),e.jsx("p",{className:"font-medium text-lg",children:ue(K.amount,K.currency)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(o,{className:xe(K.status),children:K.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Payment Method"}),e.jsx("p",{className:"font-medium capitalize",children:K.paymentMethod.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Payment Gateway"}),e.jsx("p",{className:"font-medium capitalize",children:K.paymentGateway})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Created At"}),e.jsx("p",{className:"font-medium",children:he(K.createdAt)})]}),K.paidAt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Paid At"}),e.jsx("p",{className:"font-medium",children:he(K.paidAt)})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Description"}),e.jsx("p",{className:"font-medium",children:K.description})]}),K.failureReason&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Failure Reason"}),e.jsx("p",{className:"text-sm text-red-800",children:K.failureReason})]}),e.jsx("div",{className:"flex gap-2 pt-4",children:e.jsxs(d,{onClick:()=>pe(K),className:"w-full",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Download Receipt"]})})]}):e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"No payment details available"})]})}),e.jsx(i,{open:re,onOpenChange:ne,children:e.jsxs(r,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(n,{children:[e.jsx(l,{children:"Invoice Details"}),e.jsx(c,{children:"Complete information about this invoice"})]}),le?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(a,{className:"h-6 w-6 animate-spin"})}):te?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Invoice Number"}),e.jsx("p",{className:"font-medium text-lg",children:te.invoiceNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(o,{className:xe(te.status),children:te.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Issue Date"}),e.jsx("p",{className:"font-medium",children:he(te.issueDate)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Due Date"}),e.jsx("p",{className:"font-medium",children:he(te.dueDate)})]}),te.paidDate&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Paid Date"}),e.jsx("p",{className:"font-medium",children:he(te.paidDate)})]})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Vendor Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Name:"})," ",te.vendorDetails.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Email:"})," ",te.vendorDetails.email]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Phone:"})," ",te.vendorDetails.phone]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Address:"})," ",te.vendorDetails.address]}),te.vendorDetails.gst&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"GST:"})," ",te.vendorDetails.gst]})]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Description"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Qty"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Unit Price"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Total"})]})}),e.jsx("tbody",{children:te.items.map((t,s)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-3 text-sm",children:t.description}),e.jsx("td",{className:"p-3 text-sm text-right",children:t.quantity}),e.jsx("td",{className:"p-3 text-sm text-right",children:ue(t.unitPrice,te.currency)}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:ue(t.total,te.currency)})]},s))}),e.jsxs("tfoot",{className:"border-t-2",children:[e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{colSpan:3,className:"p-3 text-sm text-right font-medium",children:"Subtotal"}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:ue(te.amount,te.currency)})]}),e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{colSpan:3,className:"p-3 text-sm text-right font-medium",children:"Tax"}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:ue(te.tax,te.currency)})]}),e.jsxs("tr",{className:"border-t bg-muted",children:[e.jsx("td",{colSpan:3,className:"p-3 text-base text-right font-bold",children:"Total"}),e.jsx("td",{className:"p-3 text-base text-right font-bold",children:ue(te.total,te.currency)})]})]})]})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(d,{onClick:()=>ge(te),className:"w-full",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Download PDF"]})})]}):e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"No invoice details available"})]})}),e.jsxs("div",{className:"flex "+(E?"flex-col space-y-4":"justify-between items-center"),children:[e.jsxs("div",{children:[e.jsx("h1",{className:(E?"text-2xl":"text-3xl")+" font-bold tracking-tight",children:"Billing & Payments"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your subscription and payment history"})]}),e.jsxs("div",{className:"flex "+(E?"flex-col space-y-2":"gap-2"),children:[e.jsxs(m,{value:J,onValueChange:Q,children:[e.jsx(x,{className:""+(E?"w-full":"w-40"),children:e.jsx(u,{placeholder:"Select period"})}),e.jsxs(h,{children:[e.jsx(p,{value:"last_7_days",children:"Last 7 days"}),e.jsx(p,{value:"last_30_days",children:"Last 30 days"}),e.jsx(p,{value:"last_90_days",children:"Last 90 days"}),e.jsx(p,{value:"last_year",children:"Last year"})]})]}),e.jsxs(d,{variant:"outline",onClick:async()=>{try{const e=J.replace(/_/g,"-"),t=await U.exportBillingData("pdf",{dateFrom:oe(J)});t?(U.downloadBlob(t,`billing-report-${e}-${(new Date).toISOString().split("T")[0]}.pdf`),s({title:"Success",description:"Billing report downloaded successfully."})):s({title:"Error",description:"Failed to generate billing report. No data received.",variant:"destructive"})}catch(e){s({title:"Error",description:"Failed to download billing report. Please try again.",variant:"destructive"})}},className:""+(E?"w-full h-11":"h-9"),children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Export"]})]})]}),Y&&e.jsxs("div",{className:"grid gap-4 "+(E?"grid-cols-2":"grid-cols-1 md:grid-cols-4"),children:[e.jsx(g,{children:e.jsxs(j,{className:(E?"p-3":"p-4")+" text-center",children:[e.jsx("div",{className:(E?"text-lg":"text-2xl")+" font-bold text-blue-600",children:ue(Y.totalRevenue)}),e.jsx("div",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:"Total Revenue"})]})}),e.jsx(g,{children:e.jsxs(j,{className:(E?"p-3":"p-4")+" text-center",children:[e.jsx("div",{className:(E?"text-lg":"text-2xl")+" font-bold text-green-600",children:ue(Y.nextBillingAmount)}),e.jsx("div",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:"Next Payment"})]})}),e.jsx(g,{children:e.jsxs(j,{className:(E?"p-3":"p-4")+" text-center",children:[e.jsx("div",{className:(E?"text-lg":"text-2xl")+" font-bold text-purple-600",children:Y.totalInvoices}),e.jsx("div",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:"Total Invoices"})]})}),e.jsx(g,{children:e.jsxs(j,{className:(E?"p-3":"p-4")+" text-center",children:[e.jsx("div",{className:(E?"text-lg":"text-2xl")+" font-bold text-orange-600",children:M?ue(M.amount):"₹0"}),e.jsx("div",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:"Monthly Cost"})]})})]}),e.jsxs(f,{value:X,onValueChange:Z,className:"space-y-6",children:[e.jsxs(v,{children:[e.jsx(y,{value:"overview",children:"Overview"}),e.jsx(y,{value:"payments",children:"Payment History"}),e.jsx(y,{value:"invoices",children:"Invoices"}),e.jsx(y,{value:"usage",children:"Usage Stats"})]}),e.jsxs(N,{value:"overview",className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(b,{children:e.jsxs(w,{className:"flex items-center",children:[e.jsx(S,{className:"w-5 h-5 mr-2"}),"Current Subscription"]})}),e.jsx(j,{children:M?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:M.plan?.name||"N/A"}),e.jsxs("p",{className:"text-muted-foreground",children:["monthly"===M.billingCycle?"Monthly":"Yearly"," Plan"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[me(M.status),e.jsx(o,{className:xe(M.status),children:M.status.charAt(0).toUpperCase()+M.status.slice(1)})]})]}),e.jsxs("div",{className:"grid gap-4 "+(E?"grid-cols-1":"grid-cols-1 md:grid-cols-3"),children:[e.jsxs("div",{children:[e.jsx("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:"Monthly Cost"}),e.jsx("p",{className:(E?"text-base":"text-lg")+" font-semibold",children:ue(M.amount,M.currency)})]}),e.jsxs("div",{children:[e.jsx("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:"Next Billing Date"}),e.jsx("p",{className:(E?"text-base":"text-lg")+" font-semibold",children:he(M.nextBillingDate)})]}),e.jsxs("div",{children:[e.jsx("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:"Auto Renewal"}),e.jsx("p",{className:(E?"text-base":"text-lg")+" font-semibold",children:M.autoRenew?"Enabled":"Disabled"})]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("div",{className:"flex "+(E?"flex-col space-y-2":"gap-2"),children:[e.jsx(d,{variant:"outline",onClick:()=>window.location.href="/vendor/subscription-plans",className:""+(E?"w-full h-11":""),children:"Change Plan"}),e.jsx(d,{variant:"outline",onClick:()=>window.location.href="/vendor/subscription-manager",className:""+(E?"w-full h-11":""),children:"Manage Subscription"})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(S,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Active Subscription"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Choose a plan to get started with our services"}),e.jsxs(d,{onClick:()=>window.location.href="/vendor/subscription-plans",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Choose Plan"]})]})})]}),e.jsxs(g,{children:[e.jsx(b,{children:e.jsxs(w,{className:"flex items-center",children:[e.jsx(k,{className:"w-5 h-5 mr-2"}),"Recent Transactions"]})}),e.jsx(j,{children:q&&q.length>0?e.jsx("div",{className:"space-y-4",children:q.slice(0,5).map((t,s)=>e.jsxs("div",{className:`flex ${E?"flex-col space-y-3":"items-center justify-between"} p-4 border rounded-lg`,children:[e.jsxs("div",{className:"flex "+(E?"flex-col space-y-2":"items-center space-x-4"),children:[e.jsx("div",{className:"p-2 bg-muted rounded-full",children:e.jsx(B,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:""+(E?"text-sm":"font-medium"),children:t?.description||"Subscription Payment"}),e.jsxs("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:[t?.paymentMethod||"Credit Card"," • ",t?.createdAt?he(t.createdAt):"N/A"]})]})]}),e.jsxs("div",{className:""+(E?"text-left":"text-right"),children:[e.jsxs("div",{className:"flex "+(E?"justify-between items-center":"items-center space-x-2"),children:[me(t?.status||"pending"),e.jsx("span",{className:""+(E?"text-sm":"font-semibold"),children:ue(t?.amount||0,t?.currency||"INR")})]}),e.jsx(o,{className:`text-xs ${xe(t?.status||"pending")}`,children:t?.status||"pending"})]})]},t?._id||`payment-${s}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(B,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No transactions found"})]})})]})]}),e.jsx(N,{value:"payments",className:"space-y-4",children:e.jsxs(g,{children:[e.jsx(b,{children:e.jsx(w,{children:"Payment History"})}),e.jsx(j,{children:q&&q.length>0?e.jsx("div",{className:"space-y-4",children:q.map((t,s)=>e.jsxs("div",{className:`flex ${E?"flex-col space-y-3":"items-center justify-between"} p-4 border rounded-lg hover:shadow-sm transition-shadow`,children:[e.jsxs("div",{className:"flex "+(E?"flex-col space-y-2":"items-center space-x-4"),children:[e.jsx("div",{className:"p-2 bg-muted rounded-full",children:e.jsx(B,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:""+(E?"text-sm":"font-medium"),children:t?.description||"Subscription Payment"}),e.jsxs("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:["Payment ID: ",t?._id?.slice(-8)||"N/A"]}),e.jsx("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:t?.createdAt?he(t.createdAt):"N/A"}),("failed"===t.status||"refunded"===t.status)&&t.failureReason&&e.jsx("p",{className:"text-xs text-red-600 mt-1 max-w-md",children:t.failureReason.includes("timeout")||t.failureReason.includes("exceeded")?"⏱️ Payment expired - exceeded 15-minute time limit":`❌ ${t.failureReason}`})]})]}),e.jsxs("div",{className:""+(E?"text-left":"text-right"),children:[e.jsxs("div",{className:`flex ${E?"justify-between items-center":"items-center space-x-2"} mb-1`,children:[me(t.status),e.jsx("span",{className:""+(E?"text-sm":"font-semibold"),children:ue(t.amount,t.currency)})]}),e.jsx(o,{className:`text-xs ${xe(t.status)}`,children:t.status}),e.jsxs("div",{className:`flex ${E?"flex-col space-y-2":"space-x-2"} mt-2`,children:[e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>(async e=>{ce(!0),ie(!0);try{const t=await U.getPaymentDetails(e);t&&ee(t)}catch(t){ie(!1)}finally{ce(!1)}})(t._id),className:""+(E?"w-full h-9":""),children:[e.jsx(F,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>pe(t),className:""+(E?"w-full h-9":""),children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"Receipt"]})]})]})]},t?._id||`payment-full-${s}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(B,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Payment History"}),e.jsx("p",{className:"text-muted-foreground",children:"Your payment history will appear here"})]})})]})}),e.jsx(N,{value:"invoices",className:"space-y-4",children:e.jsxs(g,{children:[e.jsx(b,{children:e.jsxs(w,{className:"flex "+(E?"flex-col space-y-2":"items-center justify-between"),children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(P,{className:"w-5 h-5 mr-2"}),"Invoices"]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:async()=>{try{for(const e of G)await ge(e),await new Promise(e=>setTimeout(e,500));s({title:"Success",description:`Downloaded ${G.length} invoices`})}catch(e){}},className:""+(E?"w-full h-9":""),children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Download All"]})]})}),e.jsx(j,{children:G&&G.length>0?e.jsx("div",{className:"space-y-4",children:G.map((t,s)=>e.jsxs("div",{className:`flex ${E?"flex-col space-y-3":"items-center justify-between"} p-4 border rounded-lg hover:shadow-sm transition-shadow`,children:[e.jsxs("div",{className:"flex "+(E?"flex-col space-y-2":"items-center space-x-4"),children:[e.jsx("div",{className:"p-2 bg-muted rounded-full",children:e.jsx(P,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsxs("p",{className:""+(E?"text-sm":"font-medium"),children:["Invoice #",t?.invoiceNumber||"N/A"]}),e.jsxs("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:["Issued: ",t?.issueDate?he(t.issueDate):"N/A"]}),e.jsxs("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:["Due: ",he(t.dueDate)]})]})]}),e.jsxs("div",{className:""+(E?"text-left":"text-right"),children:[e.jsxs("div",{className:`flex ${E?"justify-between items-center":"items-center space-x-2"} mb-1`,children:[me(t.status),e.jsx("span",{className:""+(E?"text-sm":"font-semibold"),children:ue(t.total,t.currency)})]}),e.jsx(o,{className:`text-xs ${xe(t.status)}`,children:t.status}),e.jsxs("div",{className:`flex ${E?"flex-col space-y-2":"space-x-2"} mt-2`,children:[e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>(async e=>{ce(!0),ne(!0);try{const t=await U.getInvoiceDetails(e);t&&se(t)}catch(t){ne(!1)}finally{ce(!1)}})(t._id),className:""+(E?"w-full h-9":""),children:[e.jsx(F,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>ge(t),className:""+(E?"w-full h-9":""),children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"Download"]})]})]})]},t?._id||`invoice-${s}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(P,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Invoices"}),e.jsx("p",{className:"text-muted-foreground",children:"Your invoices will appear here"})]})})]})}),e.jsx(N,{value:"usage",className:"space-y-4",children:e.jsxs(g,{children:[e.jsx(b,{children:e.jsxs(w,{className:"flex items-center",children:[e.jsx(I,{className:"w-5 h-5 mr-2"}),"Usage Statistics"]})}),e.jsx(j,{children:Y?.usageStats?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 "+(E?"grid-cols-1":"grid-cols-1 md:grid-cols-3"),children:[e.jsxs("div",{className:(E?"p-3":"p-4")+" border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:(E?"text-xs":"text-sm")+" font-medium",children:"Properties"}),e.jsxs("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:[Y?.usageStats?.properties?.used||0," / ",Y?.usageStats?.properties?.limit||0]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${Math.min((Y?.usageStats?.properties?.used||0)/(Y?.usageStats?.properties?.limit||1)*100,100)}%`}})})]}),e.jsxs("div",{className:(E?"p-3":"p-4")+" border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:(E?"text-xs":"text-sm")+" font-medium",children:"Leads"}),e.jsxs("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:[Y?.usageStats?.leads?.used||0," / ",Y?.usageStats?.leads?.limit||0]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${Math.min((Y?.usageStats?.leads?.used||0)/(Y?.usageStats?.leads?.limit||1)*100,100)}%`}})})]}),e.jsxs("div",{className:(E?"p-3":"p-4")+" border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:(E?"text-xs":"text-sm")+" font-medium",children:"Messages"}),e.jsxs("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground",children:[Y?.usageStats?.messages?.used||0," / ",Y?.usageStats?.messages?.limit||0]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${Math.min((Y?.usageStats?.messages?.used||0)/(Y?.usageStats?.messages?.limit||1)*100,100)}%`}})})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("p",{className:(E?"text-xs":"text-sm")+" text-muted-foreground mb-4",children:["Usage resets on your billing cycle date: ",Y.nextBillingDate]}),e.jsx(d,{variant:"outline",onClick:()=>window.location.href="/vendor/subscription-manager",className:""+(E?"w-full h-11":""),children:"Upgrade Plan"})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(I,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Usage Data"}),e.jsx("p",{className:"text-muted-foreground",children:"Usage statistics will appear here"})]})})]})})]})]})};export{M as default};

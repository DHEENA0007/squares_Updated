import{j as e}from"./ui-DYmpZ3pJ.js";import{r as l}from"./router-2SVJvIbS.js";import{B as n,a as N,e as b,a9 as w,ah as R,h as T,f as a,E as q,C as k,a7 as B,aa as $}from"./index-BbgqWuYN.js";import{T as S}from"./textarea-Cl1lQCIh.js";import{D as d,f as o,a as x,b as h,c as m}from"./dialog-DsX3mE8Q.js";import"./vendor-Dazix4UH.js";const J=()=>{const[c,P]=l.useState([]),[C,j]=l.useState(!0),[z,E]=l.useState(null),[p,g]=l.useState(""),[u,f]=l.useState(""),y=async()=>{j(!0);try{const s=await fetch("/api/admin/promotions/requests",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(s.ok){const t=await s.json();P(t.promotions)}}catch(s){console.error("Failed to fetch promotion requests:",s)}finally{j(!1)}};l.useEffect(()=>{y()},[]);const v=async(s,t)=>{const r=t==="approve"?p:u;if(t==="reject"&&!r.trim()){alert("Please provide a reason for rejection");return}try{(await fetch(`/api/admin/promotions/${s}/${t}`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify({notes:r,reason:t==="reject"?r:void 0})})).ok&&(g(""),f(""),y())}catch(i){console.error(`Failed to ${t} promotion:`,i)}},D=s=>{const t={featured:{label:"Featured Listing",color:"bg-blue-100 text-blue-800",description:"Highlighted in search results"},premium:{label:"Premium Listing",color:"bg-purple-100 text-purple-800",description:"Top of search results with badge"},spotlight:{label:"Spotlight",color:"bg-yellow-100 text-yellow-800",description:"Homepage banner placement"},top_listing:{label:"Top Listing",color:"bg-green-100 text-green-800",description:"Always appears in top positions"}};return t[s]||t.featured},A=s=>{const t={pending:"bg-orange-100 text-orange-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",expired:"bg-gray-100 text-gray-800"};return t[s]||t.pending},L=s=>{const t={pending:"bg-yellow-100 text-yellow-800",paid:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800"};return t[s]||t.pending};return C?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Promotion Approval"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Review and approve featured and paid promotion requests"})]}),e.jsxs(n,{variant:"outline",className:"bg-yellow-100 text-yellow-800",children:[c.filter(s=>s.status==="pending").length," Pending Approval"]})]}),c.length===0?e.jsx(N,{children:e.jsx(b,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(w,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Promotion Requests"}),e.jsx("p",{className:"text-muted-foreground",children:"No promotion requests are currently pending approval."})]})})}):e.jsx("div",{className:"space-y-4",children:c.map(s=>{const t=D(s.promotionType);return e.jsx(N,{className:"hover:shadow-lg transition-shadow",children:e.jsx(b,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("div",{className:"w-full lg:w-64 h-48 bg-gray-200 rounded-lg overflow-hidden flex-shrink-0",children:s.property.images&&s.property.images.length>0?e.jsx("img",{src:s.property.images[0],alt:s.property.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-100",children:e.jsx(R,{className:"w-12 h-12 text-gray-400"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-1",children:s.property.title}),e.jsxs("div",{className:"flex items-center text-muted-foreground text-sm mb-2",children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:[s.property.location.city,", ",s.property.location.state]})]}),e.jsxs("div",{className:"text-lg font-bold text-primary mb-2",children:["₹",s.property.price.toLocaleString()]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(n,{className:A(s.status),children:s.status.charAt(0).toUpperCase()+s.status.slice(1)}),e.jsxs(n,{className:L(s.paymentStatus),children:["Payment: ",s.paymentStatus]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs(n,{className:t.color,variant:"outline",children:[e.jsx(w,{className:"w-3 h-3 mr-1"}),t.label]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t.description})]}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Duration:"}),e.jsxs("span",{className:"font-medium",children:[s.duration," days"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Cost:"}),e.jsxs("span",{className:"font-medium",children:["₹",s.cost.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Start Date:"}),e.jsx("span",{className:"font-medium",children:new Date(s.requestedStartDate).toLocaleDateString()})]})]})]}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg mb-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Vendor Information"}),e.jsx("p",{className:"text-sm",children:s.vendor.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.vendor.company})]}),e.jsxs("div",{className:"text-right text-sm text-muted-foreground",children:[e.jsx("p",{children:s.vendor.email}),e.jsxs("p",{children:["Requested: ",new Date(s.createdAt).toLocaleDateString()]})]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{children:[e.jsx(o,{asChild:!0,children:e.jsxs(a,{variant:"outline",size:"sm",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"View Details"]})}),e.jsxs(x,{className:"max-w-4xl",children:[e.jsx(h,{children:e.jsx(m,{children:"Promotion Request Details"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.property.images&&s.property.images.map((r,i)=>e.jsx("img",{src:r,alt:`Property ${i+1}`,className:"w-full h-48 object-cover rounded-lg"},i))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Property Details"}),e.jsxs("ul",{className:"space-y-1 text-sm",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Type:"})," ",s.property.propertyType]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Price:"})," ₹",s.property.price.toLocaleString()]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Location:"})," ",s.property.location.city,", ",s.property.location.state]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Promotion Details"}),e.jsxs("ul",{className:"space-y-1 text-sm",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Type:"})," ",t.label]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Duration:"})," ",s.duration," days"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Cost:"})," ₹",s.cost.toLocaleString()]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Payment:"})," ",s.paymentStatus]})]})]})]})]})]})]}),s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{children:[e.jsx(o,{asChild:!0,children:e.jsxs(a,{size:"sm",className:"bg-green-600 hover:bg-green-700",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Approve"]})}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(m,{children:"Approve Promotion"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{children:["Are you sure you want to approve this ",t.label.toLowerCase(),'promotion for "',s.property.title,'"?']}),e.jsx("div",{className:"p-3 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Duration:"})," ",s.duration," days"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Cost:"})," ₹",s.cost.toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Start Date:"})," ",new Date(s.requestedStartDate).toLocaleDateString()]})]})}),e.jsx(S,{placeholder:"Add approval notes (optional)...",value:p,onChange:r=>g(r.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(a,{variant:"outline",children:"Cancel"}),e.jsx(a,{className:"bg-green-600 hover:bg-green-700",onClick:()=>v(s._id,"approve"),children:"Approve Promotion"})]})]})]})]}),e.jsxs(d,{children:[e.jsx(o,{asChild:!0,children:e.jsxs(a,{variant:"destructive",size:"sm",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Reject"]})}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(m,{children:"Reject Promotion"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{children:"Please provide a reason for rejecting this promotion request:"}),e.jsx(S,{placeholder:"Reason for rejection (required)...",value:u,onChange:r=>f(r.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(a,{variant:"outline",children:"Cancel"}),e.jsx(a,{variant:"destructive",onClick:()=>v(s._id,"reject"),children:"Reject Promotion"})]})]})]})]})]}),s.paymentStatus!=="paid"&&s.status==="approved"&&e.jsxs(n,{className:"bg-orange-100 text-orange-800",children:[e.jsx($,{className:"w-3 h-3 mr-1"}),"Awaiting Payment"]})]})]})]})})},s._id)})})]})};export{J as default};

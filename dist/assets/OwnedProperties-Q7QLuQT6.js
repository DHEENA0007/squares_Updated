import{j as e}from"./ui-BNZSgpjP.js";import{d as s,r as t}from"./router-D8v2YSKU.js";import{t as r,u as a,aL as i,a3 as l,f as n,al as o,a as c,e as d,J as u,C as m,$ as h,I as x,q as p,r as g,s as w,v,w as f,B as j,Q as y,k as b,am as N,a4 as R,a5 as k,a6 as S,a7 as C,a8 as P,L as T,T as E,ae as F,y as $,M as O}from"./index-RW7CCy7D.js";import{T as L}from"./trending-up-BMvAL35N.js";import{C as q}from"./camera-BUH2MCDL.js";import{P as D}from"./pen-line-B6ZAnNxK.js";import"./vendor-BxThA0WO.js";const A=new class{async makeRequest(e,s={}){const t=`https://app.buildhomemartsquares.com/api${e}`,r={headers:{"Content-Type":"application/json",...s.headers},...s},a=localStorage.getItem("token");a&&(r.headers={...r.headers,Authorization:`Bearer ${a}`});try{const e=await fetch(t,r);if(!e.ok){const s=await e.json().catch(()=>({success:!1,message:`HTTP ${e.status}: ${e.statusText}`}));throw new Error(s.message||"An error occurred")}return await e.json()}catch(i){throw i}}async getMyReviews(e={}){try{const s=new URLSearchParams;Object.entries(e).forEach(([e,t])=>{null!=t&&""!==t&&s.append(e,t.toString())});const t="/customer/reviews/given"+(s.toString()?`?${s.toString()}`:""),r=await this.makeRequest(t);return r.success&&r.data?r.data:{reviews:[],totalCount:0,totalPages:0,currentPage:1}}catch(s){return{reviews:[],totalCount:0,totalPages:0,currentPage:1}}}async getReceivedReviews(e={}){try{const s=new URLSearchParams;Object.entries(e).forEach(([e,t])=>{null!=t&&""!==t&&s.append(e,t.toString())});const t="/customer/reviews/received"+(s.toString()?`?${s.toString()}`:""),r=await this.makeRequest(t);return r.success&&r.data?r.data:{reviews:[],totalCount:0,totalPages:0,currentPage:1}}catch(s){return{reviews:[],totalCount:0,totalPages:0,currentPage:1}}}async getMyReviewStats(){try{const e=await this.makeRequest("/customer/reviews/my-stats");return e.success&&e.data?e.data:{totalReviews:0,averageRating:0,ratingDistribution:{5:0,4:0,3:0,2:0,1:0},recentReviews:0,responseRate:0,averageResponseTime:0,verifiedReviews:0,publicReviews:0,helpfulVotes:0}}catch(e){return{totalReviews:0,averageRating:0,ratingDistribution:{5:0,4:0,3:0,2:0,1:0},recentReviews:0,responseRate:0,averageResponseTime:0,verifiedReviews:0,publicReviews:0,helpfulVotes:0}}}async createReview(e){try{const s=await this.makeRequest("/customer/reviews",{method:"POST",body:JSON.stringify(e)});if(s.success)return r({title:"Success",description:s.message||"Review submitted successfully!"}),s.data;throw new Error(s.message||"Failed to submit review")}catch(s){const e=s instanceof Error?s.message:"Failed to submit review";return r({title:"Error",description:e,variant:"destructive"}),null}}async updateReview(e,s){try{const t=await this.makeRequest(`/customer/reviews/${e}`,{method:"PUT",body:JSON.stringify(s)});if(t.success)return r({title:"Success",description:t.message||"Review updated successfully!"}),t.data;throw new Error(t.message||"Failed to update review")}catch(t){const e=t instanceof Error?t.message:"Failed to update review";return r({title:"Error",description:e,variant:"destructive"}),null}}async deleteReview(e){try{const s=await this.makeRequest(`/customer/reviews/${e}`,{method:"DELETE"});if(s.success)return r({title:"Success",description:s.message||"Review deleted successfully!"}),!0;throw new Error(s.message||"Failed to delete review")}catch(s){const e=s instanceof Error?s.message:"Failed to delete review";return r({title:"Error",description:e,variant:"destructive"}),!1}}async markReviewHelpful(e,s){try{const t=await this.makeRequest(`/customer/reviews/${e}/helpful`,{method:"POST",body:JSON.stringify({isHelpful:s})});if(t.success)return!0;throw new Error(t.message||"Failed to mark review as helpful")}catch(t){return!1}}async replyToReview(e,s){try{const t=await this.makeRequest(`/customer/reviews/${e}/reply`,{method:"POST",body:JSON.stringify({message:s})});if(t.success)return r({title:"Success",description:t.message||"Reply posted successfully!"}),!0;throw new Error(t.message||"Failed to post reply")}catch(t){const e=t instanceof Error?t.message:"Failed to post reply";return r({title:"Error",description:e,variant:"destructive"}),!1}}async reportReview(e,s){try{const t=await this.makeRequest(`/customer/reviews/${e}/report`,{method:"POST",body:JSON.stringify({reason:s})});if(t.success)return r({title:"Success",description:t.message||"Review reported successfully!"}),!0;throw new Error(t.message||"Failed to report review")}catch(t){const e=t instanceof Error?t.message:"Failed to report review";return r({title:"Error",description:e,variant:"destructive"}),!1}}async getReviewableItems(){try{const e=await this.makeRequest("/customer/reviews/reviewable-items");return e.success&&e.data?e.data:{properties:[],services:[],vendors:[]}}catch(e){return{properties:[],services:[],vendors:[]}}}formatRating(e){return e.toFixed(1)}formatDate(e){return new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})}getRelativeTime(e){const s=new Date(e),t=new Date,r=Math.floor((t.getTime()-s.getTime())/1e3);return r<60?"Just now":r<3600?`${Math.floor(r/60)} minutes ago`:r<86400?`${Math.floor(r/3600)} hours ago`:r<2592e3?`${Math.floor(r/86400)} days ago`:r<31536e3?`${Math.floor(r/2592e3)} months ago`:`${Math.floor(r/31536e3)} years ago`}getRatingColor(e){return e>=4.5?"text-green-600":e>=3.5?"text-yellow-600":e>=2.5?"text-orange-600":"text-red-600"}getReviewTypeLabel(e){return{property:"Property Review",service:"Service Review",vendor:"Vendor Review"}[e]||e}getReviewTypeColor(e){return{property:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",service:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",vendor:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200"}[e]||"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}getRatingPercentage(e,s){return 0===s?0:Math.round(e/s*100)}},M=()=>{const M=s(),{user:I}=a(),[z,J]=t.useState([]),[U,_]=t.useState(!0),[V,B]=t.useState(!1),[H,Y]=t.useState(""),[W,Q]=t.useState("all"),[G,K]=t.useState([]),[X,Z]=t.useState(!1),[ee,se]=t.useState(null),[te,re]=t.useState(0),[ae,ie]=t.useState(""),[le,ne]=t.useState(""),[oe,ce]=t.useState(!1),[de,ue]=t.useState(!1),[me,he]=t.useState(!1),xe=t.useCallback(async()=>{try{const e=await i.getOwnedProperties();J(e.data.properties)}catch(e){r({title:"Error",description:"Failed to load your properties",variant:"destructive"})}finally{_(!1),B(!1)}},[]),pe=t.useCallback(async()=>{try{const e=await l.getAllFilterConfigurations();K(e)}catch(e){}},[]);t.useEffect(()=>{xe(),pe()},[xe,pe]);const ge=e=>{const s=G.find(s=>s.value===e);return s?s.displayLabel||s.name:e.charAt(0).toUpperCase()+e.slice(1)},we=(e,s)=>{se(e),ue(s),s&&e.review?(re(e.review.rating),ie(e.review.title),ne(e.review.comment)):(re(0),ie(""),ne("")),Z(!0)},ve=G.filter(e=>"listing_type"===e.filterType||"listingType"===e.filterType).sort((e,s)=>e.displayOrder-s.displayOrder),fe=z.filter(e=>{const s=e.title.toLowerCase().includes(H.toLowerCase())||e.address.city.toLowerCase().includes(H.toLowerCase())||e.address.district&&e.address.district.toLowerCase().includes(H.toLowerCase()),t="all"===W||e.status===W||e.listingType===W;return s&&t}),je=e=>{if(e.images&&e.images.length>0){const s=e.images.find(e=>e.isPrimary);return s?s.url:e.images[0].url}return"/placeholder-image.jpg"};return e.jsx("div",{className:"min-h-screen bg-background pb-12 pt-20",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Owned Properties"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your purchased and rented properties"})]}),e.jsxs(n,{variant:"outline",onClick:()=>{B(!0),xe()},disabled:V,className:"w-full md:w-auto",children:[e.jsx(o,{className:"w-4 h-4 mr-2 "+(V?"animate-spin":"")}),V?"Refreshing...":"Refresh"]})]}),!U&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(c,{className:"border-none shadow-sm bg-card",children:e.jsxs(d,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-full",children:e.jsx(u,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:"Total Owned"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:z.length})]})]})}),e.jsx(c,{className:"border-none shadow-sm bg-card",children:e.jsxs(d,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 dark:bg-purple-900/20 rounded-full",children:e.jsx(m,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:"Purchased"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:z.filter(e=>"sold"===e.status).length})]})]})}),e.jsx(c,{className:"border-none shadow-sm bg-card",children:e.jsxs(d,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/20 rounded-full",children:e.jsx(L,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:"Rented"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:z.filter(e=>"rented"===e.status).length})]})]})})]}),e.jsxs("div",{className:"bg-card p-4 rounded-xl shadow-sm border border-border flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(h,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Search by location, title...",value:H,onChange:e=>Y(e.target.value),className:"pl-9 border-input bg-background"})]}),e.jsxs(p,{value:W,onValueChange:Q,children:[e.jsx(g,{className:"w-full md:w-[180px]",children:e.jsx(w,{placeholder:"Filter by status"})}),e.jsxs(v,{children:[e.jsx(f,{value:"all",children:"All Status"}),ve.length>0?ve.map(s=>e.jsx(f,{value:s.value,children:s.displayLabel||s.name},s.value)):e.jsxs(e.Fragment,{children:[e.jsx(f,{value:"sold",children:"Purchased"}),e.jsx(f,{value:"rented",children:"Rented"})]})]})]})]}),!U&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:fe.map(s=>{return e.jsxs(c,{className:"group overflow-hidden border-none shadow-sm hover:shadow-md transition-all duration-300 bg-card",children:[e.jsxs("div",{className:"relative aspect-[4/3] bg-muted overflow-hidden",children:[s.images.length>0?e.jsx("img",{src:je(s),alt:s.title,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:e.jsx(q,{className:"w-12 h-12 opacity-20"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-60"}),e.jsxs("div",{className:"absolute bottom-3 left-3 text-white",children:[e.jsx("p",{className:"text-xl font-bold",children:(r=s.price,s.listingType,new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(r)+"")}),e.jsx("p",{className:"text-xs text-white/80",children:"sold"===s.status?"Purchase Price":"Rent Amount"})]})]}),e.jsxs(d,{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[e.jsx(j,{className:("sold"===s.status?"bg-purple-600 dark:bg-purple-900/50":"bg-blue-600 dark:bg-blue-900/50")+" border-0",children:"sold"===s.status?"Purchased":ge(s.listingType)}),e.jsx(j,{variant:"outline",className:"border-border text-muted-foreground capitalize",children:s.type}),s.hasReviewed&&e.jsxs(j,{className:"bg-green-600 dark:bg-green-900/50 border-0",children:[e.jsx(y,{className:"w-3 h-3 mr-1 fill-white"}),"Reviewed"]})]}),e.jsx("h3",{className:"font-semibold text-lg text-foreground line-clamp-1 mb-1",children:s.title}),e.jsxs("div",{className:"flex items-center text-muted-foreground text-sm",children:[e.jsx(b,{className:"w-3.5 h-3.5 mr-1 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:s.address.district?`${s.address.city}, ${s.address.district}`:s.address.city})]})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 border-t border-b border-border",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Bed"}),e.jsx("p",{className:"font-semibold text-foreground",children:s.bedrooms||"-"})]}),e.jsx("div",{className:"w-px h-8 bg-border"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Bath"}),e.jsx("p",{className:"font-semibold text-foreground",children:s.bathrooms||"-"})]}),e.jsx("div",{className:"w-px h-8 bg-border"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Area"}),e.jsx("p",{className:"font-semibold text-foreground",children:s.area&&"object"==typeof s.area&&(s.area.builtUp||s.area.plot)||"-"})]})]}),s.hasReviewed&&s.review?e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/10 rounded-lg p-3 border border-green-100 dark:border-green-900/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"flex gap-0.5",children:[1,2,3,4,5].map(t=>e.jsx(y,{className:"w-3 h-3 "+(t<=s.review.rating?"fill-yellow-400 text-yellow-400":"text-gray-300 dark:text-gray-600")},t))}),e.jsx(n,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>we(s,!0),children:e.jsx(D,{className:"w-3 h-3"})})]}),e.jsx("p",{className:"text-xs text-green-800 dark:text-green-300 line-clamp-1 font-medium",children:s.review.title})]}):e.jsxs(n,{variant:"outline",size:"sm",className:"w-full border-dashed text-muted-foreground hover:text-primary hover:border-primary",onClick:()=>we(s,!1),children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Write a Review"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(n,{variant:"outline",size:"sm",className:"w-full",onClick:()=>{se(s),he(!0)},children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Contact"]}),e.jsx(n,{size:"sm",className:"w-full",onClick:()=>M(`/property/${s._id}`),children:"View Details"})]}),e.jsxs("div",{className:"text-xs text-center text-muted-foreground pt-1",children:["sold"===s.status?"Purchased":"Rented"," on ",(t=s.assignedAt,t?new Date(t).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}):"N/A")]})]})]},s._id);var t,r})}),U&&e.jsx(c,{children:e.jsx(d,{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Loading your properties..."})]})})}),!U&&0===fe.length&&e.jsx(c,{children:e.jsxs(d,{className:"p-12 text-center",children:[e.jsx(u,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:0===z.length?"No owned properties found":"No properties match your filters"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:0===z.length?"You haven't purchased or rented any properties yet.":"Try adjusting your search criteria or clear some filters."}),z.length>0&&e.jsx(n,{variant:"outline",onClick:()=>{Y(""),Q("all")},children:"Clear Filters"})]})}),e.jsx(R,{open:X,onOpenChange:Z,children:e.jsxs(k,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(S,{children:[e.jsx(C,{children:de?"Edit Your Review":"Write a Review"}),e.jsx(P,{children:"Share your experience with this property to help other buyers make informed decisions."})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(T,{children:"Your Rating"}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(s=>e.jsx("button",{type:"button",onClick:()=>re(s),className:"focus:outline-none transition-transform hover:scale-110",children:e.jsx(y,{className:"w-8 h-8 "+(s<=te?"fill-yellow-400 text-yellow-400":"text-gray-300 hover:text-yellow-200")})},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"title",children:"Review Title"}),e.jsx(x,{id:"title",placeholder:"Summarize your experience",value:ae,onChange:e=>ie(e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"comment",children:"Detailed Review"}),e.jsx(E,{id:"comment",placeholder:"What did you like or dislike? How was the neighborhood?",className:"min-h-[150px]",value:le,onChange:e=>ne(e.target.value)})]})]}),e.jsxs(F,{className:"flex flex-col sm:flex-row gap-2",children:[de&&e.jsx(n,{variant:"destructive",onClick:async()=>{if(ee?.review&&confirm("Are you sure you want to delete this review?"))try{await A.deleteReview(ee.review._id),r({title:"Success",description:"Review deleted successfully"}),Z(!1),xe()}catch(e){r({title:"Error",description:"Failed to delete review",variant:"destructive"})}},className:"sm:mr-auto",children:"Delete Review"}),e.jsx(n,{variant:"outline",onClick:()=>Z(!1),children:"Cancel"}),e.jsx(n,{onClick:async()=>{if(ee)if(0!==te)if(ae.trim()&&le.trim()){ce(!0);try{const e={propertyId:ee._id,rating:te,title:ae,comment:le,reviewType:"property"};de&&ee.review?(await A.updateReview(ee.review._id,e),r({title:"Success",description:"Review updated successfully"})):(await A.createReview(e),r({title:"Success",description:"Review submitted successfully"})),Z(!1),xe()}catch(e){r({title:"Error",description:"Failed to submit review",variant:"destructive"})}finally{ce(!1)}}else r({title:"Fields Required",description:"Please fill in both title and comment",variant:"destructive"});else r({title:"Rating Required",description:"Please select a star rating",variant:"destructive"})},disabled:oe,children:oe?"Submitting...":de?"Update Review":"Submit Review"})]})]})}),e.jsx(R,{open:me,onOpenChange:he,children:e.jsxs(k,{className:"max-w-md",children:[e.jsxs(S,{children:[e.jsx(C,{children:"Contact Seller"}),e.jsx(P,{children:"Choose your preferred method to get in touch with the property seller."})]}),ee&&ee.owner&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx("span",{className:"text-primary font-semibold text-lg",children:ee.owner.profile.firstName.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[ee.owner.profile.firstName," ",ee.owner.profile.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Property Owner"})]})]}),e.jsxs("div",{className:"grid gap-3",children:[ee.owner.profile.phone&&e.jsxs(n,{variant:"outline",className:"w-full justify-start",onClick:()=>window.location.href=`tel:${ee.owner.profile.phone}`,children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Call ",ee.owner.profile.phone]}),e.jsxs(n,{variant:"outline",className:"w-full justify-start",onClick:()=>window.location.href=`mailto:${ee.owner?.email}`,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Email ",ee.owner.email]})]})]})]})})]})})};export{M as default};

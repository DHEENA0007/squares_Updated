import{j as e}from"./ui-CEFKCYQo.js";import{d as s,r as t}from"./router-Bi51YGN-.js";import{z as a,aR as i,m as r,K as l,t as c,aE as n,f as o,ad as d,x as m,a9 as p,_ as h,$ as u,a0 as x,a1 as f,a as g,e as j,af as v,ag as y,ah as N,B as w,M as b,y as S,h as C,b as P,c as $,L as k,I as D,C as E,S as F,r as R,s as T,v as q,w as I,T as A,ae as V,X as L,E as U,aB as O,aq as M,a2 as z,a3 as J,a4 as _,a5 as B,a6 as Y,a7 as H}from"./index-Ds-LUfCl.js";import{I as G,a as K,b as Q}from"./input-otp-2iy1Rqq9.js";import{P as W}from"./PincodeAutocomplete-WNE9b_1P.js";import{u as X}from"./use-mobile-WsBtvUz6.js";import{c as Z}from"./customerDashboardService-lK6OwhUp.js";import{u as ee}from"./uploadService-CgQM9V6q.js";import{P as se}from"./pen-line-DuzL7VDT.js";import{C as te}from"./camera-C8A2fCF8.js";import{S as ae}from"./shield-TyKi0w-x.js";import{C as ie}from"./calendar-CC4c2MNn.js";import{T as re}from"./trending-up-BpoKmfKs.js";import{A as le}from"./activity-CDl4pAKX.js";import"./vendor-eVk5PToZ.js";const ce=new class{baseUrl="http://localhost:3001/api";async makeRequest(e,s={}){const t=`${this.baseUrl}${e}`,i={headers:{"Content-Type":"application/json",...s.headers},...s},r=a.getToken();r&&(i.headers={...i.headers,Authorization:`Bearer ${r}`});try{const e=await fetch(t,i);if(!e.ok){const s=await e.json().catch(()=>({success:!1,message:`HTTP ${e.status}: ${e.statusText}`}));throw new Error(s.message||"An error occurred")}return await e.json()}catch(l){throw l}}async getCustomerProperties(e={}){try{const s=new URLSearchParams;Object.entries(e).forEach(([e,t])=>{null!=t&&""!==t&&s.append(e,t.toString())});const t="/customer/properties"+(s.toString()?`?${s.toString()}`:"");return await this.makeRequest(t)}catch(s){return{success:!0,data:{properties:[],pagination:{currentPage:1,totalPages:0,totalProperties:0,hasNextPage:!1,hasPrevPage:!1},stats:{totalProperties:0,activeProperties:0,rentedProperties:0,soldProperties:0,draftProperties:0,pendingProperties:0,totalViews:0,totalInquiries:0,totalFavorites:0,totalRevenue:0,monthlyRevenue:0,averageViews:0,averageInquiries:0,conversionRate:0}}}}}async getCustomerPropertyStats(){try{return await this.makeRequest("/customer/properties/stats")}catch(e){return{success:!0,data:{totalProperties:0,activeProperties:0,rentedProperties:0,soldProperties:0,draftProperties:0,pendingProperties:0,totalViews:0,totalInquiries:0,totalFavorites:0,totalRevenue:0,monthlyRevenue:0,averageViews:0,averageInquiries:0,conversionRate:0}}}}async getProperty(e){try{return await this.makeRequest(`/customer/properties/${e}`)}catch(s){throw s}}async createProperty(e){try{return await this.makeRequest("/customer/properties",{method:"POST",body:JSON.stringify(e)})}catch(s){throw s}}async updateProperty(e,s){try{return await this.makeRequest(`/customer/properties/${e}`,{method:"PUT",body:JSON.stringify(s)})}catch(t){throw t}}async deleteProperty(e){try{await this.makeRequest(`/customer/properties/${e}`,{method:"DELETE"})}catch(s){throw s}}async togglePropertyStatus(e,s){try{return await this.makeRequest(`/customer/properties/${e}/status`,{method:"PATCH",body:JSON.stringify({status:s})})}catch(t){throw t}}async togglePropertyFeatured(e,s){try{return await this.makeRequest(`/customer/properties/${e}/featured`,{method:"PATCH",body:JSON.stringify({featured:s})})}catch(t){const e=t.response?.data||t;throw(e.upgradeRequired||e.limitReached)&&function(){throw new Error("Function not implemented.")}((e.limitReached,e.message)),t}}async getPropertyAnalytics(e,s="month"){try{return await this.makeRequest(`/customer/properties/${e}/analytics?period=${s}`)}catch(t){return{success:!0,data:{views:[],inquiries:[],favorites:[],conversionRate:0,avgResponseTime:"N/A",topReferrers:[],engagement:{totalClicks:0,phoneClicks:0,emailClicks:0,messageClicks:0}}}}}formatPrice(e,s){return"rent"===s?`â‚¹${e.toLocaleString("en-IN")}/month`:"lease"===s?`â‚¹${e.toLocaleString("en-IN")}/year`:e>=1e7?`â‚¹${(e/1e7).toFixed(1)} Cr`:e>=1e5?`â‚¹${(e/1e5).toFixed(1)} Lac`:`â‚¹${e.toLocaleString("en-IN")}`}formatArea(e){return e.builtUp?`${e.builtUp} ${e.unit}`:e.plot?`${e.plot} ${e.unit}`:e.carpet?`${e.carpet} ${e.unit}`:"Area not specified"}getStatusColor(e){switch(e){case"active":return"bg-green-500";case"rented":return"bg-blue-500";case"sold":return"bg-purple-500";case"pending":return"bg-yellow-500";case"draft":default:return"bg-gray-500";case"inactive":return"bg-red-500"}}getStatusText(e){switch(e){case"active":return"Active";case"rented":return"Rented";case"sold":return"Sold";case"pending":return"Under Review";case"draft":return"Draft";case"inactive":return"Inactive";default:return e}}formatTimeAgo(e){const s=new Date(e),t=(new Date).getTime()-s.getTime(),a=Math.floor(t/6e4),i=Math.floor(a/60),r=Math.floor(i/24);return a<1?"Just now":a<60?`${a} min ago`:i<24?`${i} hour${i>1?"s":""} ago`:r<7?`${r} day${r>1?"s":""} ago`:s.toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})}getPrimaryImage(e){const s=e.images.find(e=>e.isPrimary);return s?.url||e.images[0]?.url||"/placeholder-property.jpg"}getDaysOnMarket(e){const s=new Date(e),t=(new Date).getTime()-s.getTime();return Math.floor(t/864e5)}calculateMonthlyRevenue(e){return e.filter(e=>"rented"===e.status&&"rent"===e.listingType).reduce((e,s)=>e+s.price,0)}calculateTotalRevenue(e){const s=e.filter(e=>"sold"===e.status);e.filter(e=>"rented"===e.status);return s.reduce((e,s)=>e+s.price,0)+12*this.calculateMonthlyRevenue(e)}};const ne=()=>{const a=s(),{isConnected:ne,lastEvent:oe}=i(),de=X(),[me,pe]=t.useState(!1),[he,ue]=t.useState(!0),[xe,fe]=t.useState(!1),[ge,je]=t.useState(!1),[ve,ye]=t.useState(null),[Ne,we]=t.useState(!1),be=t.useRef(null),[Se,Ce]=t.useState({name:"",email:"",phone:"",location:"",address:"",pincode:"",bio:"",joinDate:"",avatar:"",verified:!1}),[Pe,$e]=t.useState({states:[],districts:[],cities:[],selectedState:"",selectedDistrict:"",selectedCity:"",loadingStates:!1,loadingDistricts:!1,loadingCities:!1}),[ke,De]=t.useState(!1),[Ee,Fe]=t.useState(""),[Re,Te]=t.useState(!1),[qe,Ie]=t.useState(!1),[Ae,Ve]=t.useState(!1),[Le,Ue]=t.useState(10),[Oe,Me]=t.useState({}),[ze,Je]=t.useState({email:"",phone:""}),[_e,Be]=t.useState({inquiriesSent:0,savedSearches:0,propertiesViewed:0,totalFavorites:0,ownedProperties:0}),[Ye,He]=t.useState([]);t.useEffect(()=>{(async()=>{try{await r.initialize();const e=r.getStates();$e(s=>({...s,states:e}))}catch(e){}})()},[]);const Ge=t.useCallback(e=>{$e(s=>({...s,selectedState:e,selectedDistrict:"",selectedCity:"",districts:r.getDistricts(e),cities:[]})),Ce(s=>({...s,location:`${e}`}))},[]),Ke=t.useCallback(e=>{$e(s=>{const t=s.selectedState;return{...s,selectedDistrict:e,selectedCity:"",cities:r.getCities(t,e)}}),Ce(s=>({...s,location:`${e}, ${Pe.selectedState}`}))},[Pe.selectedState]),Qe=t.useCallback(e=>{$e(s=>({...s,selectedCity:e})),Ce(s=>({...s,location:`${e}, ${Pe.selectedDistrict}, ${Pe.selectedState}`}))},[Pe.selectedState,Pe.selectedDistrict]),We=t.useCallback(e=>{if(!e)return"Not specified";const s=[];return e.city&&s.push(e.city),e.district&&e.district!==e.city&&s.push(e.district),e.state&&s.push(e.state),s.length>0?s.join(", "):"Not specified"},[]),Xe=t.useCallback(async()=>{try{ue(!0);const[e,s,t]=await Promise.all([l.getCurrentUser(),Z.getCustomerDashboardData().catch(()=>null),ce.getCustomerPropertyStats().catch(()=>null)]),a=e.data.user;ye(a);const i=a.profile.address,c=i?`${i.city||""}, ${i.state||""}`.replace(/^,\s*|,\s*$/g,""):"";if(Ce({name:l.getFullName(a),email:a.email,phone:a.profile.phone||"",location:c,address:i?.street||"",pincode:i?.zipCode||"",bio:a.profile.bio||"",joinDate:l.formatCreationDate(a.createdAt),avatar:a.profile.avatar||"",verified:a.profile.emailVerified||!1}),Je({email:a.email,phone:a.profile.phone||""}),i?.state||i?.city){const e=i.state||"",s=i.city||"";if($e(t=>({...t,selectedState:e,selectedCity:s,districts:e?r.getDistricts(e):[],cities:e?r.getCities(e,""):[]})),s&&e){const t=r.getDistricts(e);for(const a of t){const t=r.getCities(e,a);if(t.includes(s)){$e(e=>({...e,selectedDistrict:a,cities:t}));break}}}}if(s?.success){const e=s.data.stats;Be(s=>({...s,inquiriesSent:e.activeInquiries||0,propertiesViewed:e.propertiesViewed||0,totalFavorites:e.savedFavorites||0})),He(s.data.recentActivities.map(e=>({id:e._id,type:e.type,message:e.message,timestamp:e.time,icon:e.icon})))}if(t?.success){const e=t.data;Be(s=>({...s,ownedProperties:e.totalProperties||0,savedSearches:e.pendingApproval||0}))}}catch(e){const s=!navigator.onLine||e instanceof Error&&e.message.includes("Failed to fetch");c({title:s?"Connection Issue":"Error",description:s?"You're offline. Please check your internet connection and try again.":"Failed to load profile data. Please try again.",variant:s?"default":"destructive"})}finally{ue(!1)}},[]),Ze=t.useCallback(async()=>{je(!0),await Xe(),je(!1)},[]);t.useEffect(()=>{Xe()},[]);const es=t.useCallback(()=>{Xe()},[]),ss=t.useCallback(()=>{Be(e=>({...e,inquiriesSent:e.inquiriesSent+1}))},[]),ts=t.useCallback(()=>{Be(e=>({...e,propertiesViewed:e.propertiesViewed+1}))},[]),as=t.useCallback(e=>{"add"===e.action?Be(e=>({...e,totalFavorites:e.totalFavorites+1})):"remove"===e.action&&Be(e=>({...e,totalFavorites:Math.max(0,e.totalFavorites-1)}))},[]);n("profile_updated",es),n("property_inquiry",ss),n("property_viewed",ts),n("property_favorited",as);const is=async(e,s)=>{try{Ie(!0);const t=await fetch("http://localhost:3001/api/auth/request-profile-update-otp",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({newEmail:e,newPhone:s,currentEmail:ze.email,currentPhone:ze.phone})}),a=await t.json();if(!t.ok||!a.success)throw new Error(a.message||"Failed to send verification code");De(!0),Te(!0),Ue(a.expiryMinutes||10),c({title:"Verification Code Sent",description:a.message})}catch(t){c({title:"Error",description:t.message||"Failed to send verification code. Please try again.",variant:"destructive"})}finally{Ie(!1)}},rs=()=>{De(!1),Fe(""),Te(!1),Me({}),ve&&Ce(e=>({...e,email:ze.email,phone:ze.phone}))};return he?e.jsx("div",{className:"space-y-6 pt-24",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-lg",children:"Loading profile..."})})}):e.jsxs("div",{className:"space-y-6 pt-16",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(o,{variant:"outline",size:"sm",onClick:Ze,disabled:ge,children:[e.jsx(d,{className:"w-4 h-4 mr-2 "+(ge?"animate-spin":"")}),ge?"Refreshing...":"Refresh"]})}),e.jsxs("div",{className:"flex "+(de?"flex-col gap-4":"items-center justify-between"),children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"font-bold flex items-center gap-2 "+(de?"text-2xl":"text-3xl"),children:[e.jsx(m,{className:"w-8 h-8 text-primary"}),"My Profile"]}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:["View your profile information and activity. Visit ",e.jsx("span",{className:"font-medium",children:"Settings"})," to manage preferences."]})]}),e.jsxs("div",{className:"flex gap-2 "+(de?"flex-col w-full":""),children:[!me&&!he&&e.jsxs(o,{onClick:()=>pe(!0),className:de?"w-full":"",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Edit Profile"]}),e.jsxs(o,{variant:"outline",onClick:()=>a("/customer/settings"),className:de?"w-full":"",children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"Settings"]})]})]}),e.jsxs(h,{defaultValue:"profile",className:"space-y-6",children:[e.jsxs(u,{className:"grid w-full grid-cols-2",children:[e.jsx(x,{value:"profile",children:"Profile"}),e.jsx(x,{value:"activity",children:"Activity"})]}),e.jsxs(f,{value:"profile",className:"space-y-6",children:[e.jsx(g,{children:e.jsx(j,{className:"pt-6",children:e.jsxs("div",{className:`flex ${de?"flex-col":"flex-col md:flex-row"} items-start md:items-center gap-6`,children:[e.jsxs("div",{className:"relative self-center md:self-start",children:[e.jsxs(v,{className:""+(de?"w-20 h-20":"w-24 h-24"),children:[e.jsx(y,{src:Se.avatar}),e.jsx(N,{className:""+(de?"text-xl":"text-2xl"),children:Se.name.split(" ").map(e=>e[0]).join("")})]}),e.jsx("input",{ref:be,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:async e=>{const s=e.target.files?.[0];if(!s)return;const t=ee.validateImageFile(s);if(t.valid)try{we(!0);const e=await ee.compressImage(s),t=await ee.uploadAvatar(e);Ce(e=>({...e,avatar:t})),ve&&await l.updateCurrentUser({profile:{...ve.profile,avatar:t}}),c({title:"Success",description:"Profile picture updated successfully!"}),await Xe()}catch(a){c({title:"Upload Failed",description:"Failed to upload profile picture. Please try again.",variant:"destructive"})}finally{we(!1),be.current&&(be.current.value="")}else c({title:"Invalid File",description:t.error,variant:"destructive"})},className:"hidden"}),e.jsx(o,{size:"icon",variant:"secondary",className:"absolute -bottom-2 -right-2 rounded-full",onClick:()=>be.current?.click(),disabled:Ne,children:Ne?e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(te,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex-1 space-y-2 text-center md:text-left",children:[e.jsxs("div",{className:"flex "+(de?"flex-col gap-2":"items-center gap-2"),children:[e.jsx("h2",{className:(de?"text-xl":"text-2xl")+" font-bold",children:Se.name}),Se.verified&&e.jsxs(w,{variant:"default",className:"bg-green-100 text-green-800",children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),"Verified"]})]}),e.jsxs("div",{className:`flex ${de?"flex-col gap-2":"items-center gap-4"} text-muted-foreground`,children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-4 h-4"}),Se.email]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"w-4 h-4"}),Se.phone]})]}),e.jsxs("div",{className:`flex ${de?"flex-col gap-2":"items-center gap-4"} text-muted-foreground`,children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(C,{className:"w-4 h-4"}),Se.location]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"w-4 h-4"}),"Joined ",Se.joinDate]})]})]}),e.jsxs("div",{className:"grid gap-4 text-center "+(de?"grid-cols-2 w-full":"grid-cols-2"),children:[e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:_e.ownedProperties}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Properties"})]}),e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:_e.totalFavorites}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Favorites"})]})]})]})})}),e.jsxs("div",{className:"grid gap-6 "+(de?"grid-cols-1":"grid-cols-1 lg:grid-cols-2"),children:[e.jsxs(g,{children:[e.jsx(P,{children:e.jsx($,{children:"Personal Information"})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 "+(de?"grid-cols-1":"grid-cols-1 md:grid-cols-2"),children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Full Name"}),me?e.jsx(D,{value:Se.name,onChange:e=>Ce(s=>({...s,name:e.target.value}))}):e.jsx("p",{className:"text-sm",children:Se.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Email"}),me?e.jsx(D,{type:"email",value:Se.email,onChange:e=>Ce(s=>({...s,email:e.target.value}))}):e.jsx("p",{className:"text-sm",children:Se.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Phone"}),me?e.jsx(D,{type:"tel",value:Se.phone,onChange:e=>{const s=e.target.value.replace(/\D/g,"");s.length<=10&&Ce(e=>({...e,phone:s}))},placeholder:"10 digit mobile number",maxLength:10}):e.jsx("p",{className:"text-sm",children:Se.phone})]}),me?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2 col-span-2",children:[e.jsx(k,{htmlFor:"pincode",children:"PIN Code"}),e.jsx(W,{value:Se.pincode||"",state:Pe.selectedState,district:Pe.selectedDistrict,city:Pe.selectedCity,onChange:(e,s)=>{if(Ce(s=>({...s,pincode:e})),s){const t=r.getDistricts(s.state),a=r.getCities(s.state,s.district);$e(e=>({...e,selectedState:s.state||"",selectedDistrict:s.district||"",selectedCity:s.city||"",districts:t,cities:a})),Ce(t=>({...t,location:`${s.city}, ${s.district}, ${s.state}`,pincode:e})),c({title:"Location Auto-filled âœ“",description:`${s.city}, ${s.district}, ${s.state}`})}},placeholder:"Enter PIN code to auto-fill location...",className:"w-full"}),e.jsxs("div",{className:"space-y-1 mt-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"ðŸ’¡ Type your PIN code to auto-fill state, district, and city"}),Se.pincode&&Pe.selectedCity&&e.jsxs("p",{className:"text-xs text-green-600 flex items-center gap-1",children:[e.jsx(E,{className:"w-3 h-3"}),"Location: ",Pe.selectedCity,", ",Pe.selectedDistrict,", ",Pe.selectedState]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"State"}),e.jsxs(F,{value:Pe.selectedState,onValueChange:Ge,children:[e.jsx(R,{children:e.jsx(T,{placeholder:"Select state"})}),e.jsx(q,{children:Pe.states.map(s=>e.jsx(I,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"District"}),e.jsxs(F,{value:Pe.selectedDistrict,onValueChange:Ke,disabled:!Pe.selectedState,children:[e.jsx(R,{children:e.jsx(T,{placeholder:Pe.selectedState?Pe.loadingDistricts?"Loading districts...":"Select district":"Select state first"})}),e.jsx(q,{children:Pe.districts.map(s=>e.jsx(I,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"City"}),e.jsxs(F,{value:Pe.selectedCity,onValueChange:Qe,disabled:!Pe.selectedDistrict,children:[e.jsx(R,{children:e.jsx(T,{placeholder:Pe.selectedState?Pe.selectedDistrict?Pe.loadingCities?"Loading cities...":"Select city":"Select district first":"Select state first"})}),e.jsx(q,{children:Pe.cities.map(s=>e.jsx(I,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Street Address"}),e.jsx(D,{value:Se.address,onChange:e=>Ce(s=>({...s,address:e.target.value})),placeholder:"House/Flat number, Street name, Area"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Location"}),e.jsx("p",{className:"text-sm",children:ve?.profile?.address?We(ve.profile.address):"Not specified"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Address"}),e.jsx("p",{className:"text-sm",children:Se.address||"Not specified"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"PIN Code"}),e.jsx("p",{className:"text-sm",children:ve?.profile?.address?.zipCode||Se.pincode||"Not provided"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Bio"}),me?e.jsx(A,{rows:3,value:Se.bio,onChange:e=>Ce(s=>({...s,bio:e.target.value}))}):e.jsx("p",{className:"text-sm",children:Se.bio})]}),me&&e.jsxs("div",{className:"flex gap-2 pt-4 "+(de?"flex-col":""),children:[e.jsx(o,{onClick:async()=>{if(ve)try{fe(!0);const e=Se.email!==ze.email,s=Se.phone!==ze.phone,t={notifications:{email:!0,sms:!1,push:!0},privacy:{showEmail:!1,showPhone:!1}},a=ve.profile?.preferences,i=a?{notifications:{email:a.notifications?.email??t.notifications.email,sms:a.notifications?.sms??t.notifications.sms,push:a.notifications?.push??t.notifications.push},privacy:{showEmail:a.privacy?.showEmail??t.privacy.showEmail,showPhone:a.privacy?.showPhone??t.privacy.showPhone}}:t,r={profile:{firstName:Se.name.split(" ")[0]||"",lastName:Se.name.split(" ").slice(1).join(" ")||"",phone:Se.phone,bio:Se.bio,address:{street:Se.address,city:Pe.selectedCity||Se.location.split(",")[0]?.trim()||"",district:Pe.selectedDistrict||"",state:Pe.selectedState||Se.location.split(",")[1]?.trim()||"",zipCode:Se.pincode||""},preferences:i}};if(e||s)return Me({newEmail:e?Se.email:void 0,newPhone:s?Se.phone:void 0,otherUpdates:r}),fe(!1),void(await is(e?Se.email:void 0,s?Se.phone:void 0));await l.updateCurrentUser(r),await Xe(),pe(!1),c({title:"Profile Updated",description:"Your profile has been updated successfully."})}catch(e){c({title:"Error",description:e.response?.data?.message||"Failed to update profile. Please try again.",variant:"destructive"})}finally{fe(!1)}},disabled:xe,className:de?"w-full":"",children:xe?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Save Changes"]})}),e.jsxs(o,{variant:"outline",onClick:()=>{pe(!1)},className:de?"w-full":"",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})]}),e.jsxs(g,{children:[e.jsx(P,{children:e.jsx($,{children:"Account Statistics"})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm",children:"Owned Properties"})]}),e.jsx("span",{className:"font-semibold",children:_e.ownedProperties})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"Inquiries Sent"})]}),e.jsx("span",{className:"font-semibold",children:_e.inquiriesSent})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{className:"text-sm",children:"Properties Viewed"})]}),e.jsx("span",{className:"font-semibold",children:_e.propertiesViewed.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-sm",children:"Total Favorites"})]}),e.jsx("span",{className:"font-semibold",children:_e.totalFavorites})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-sm",children:"Saved Searches"})]}),e.jsx("span",{className:"font-semibold",children:_e.savedSearches})]})]})})]})]}),e.jsx(g,{className:"border-primary/20 bg-primary/5",children:e.jsx(j,{className:"pt-6",children:e.jsxs("div",{className:"flex "+(de?"flex-col gap-4":"items-center justify-between"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p,{className:"w-8 h-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Manage Your Preferences"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure notifications, privacy, security, and account settings"})]})]}),e.jsx(o,{onClick:()=>a("/customer/settings"),className:de?"w-full":"",children:"Go to Settings"})]})})})]}),e.jsx(f,{value:"activity",className:"space-y-6",children:e.jsxs(g,{children:[e.jsx(P,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5"}),"Recent Activity"]})}),e.jsx(j,{children:!he&&Ye.length>0?e.jsx("div",{className:"space-y-4",children:Ye.map(s=>e.jsxs("div",{className:"flex items-start gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mt-2 ${(e=>{switch(e){case"property_posted":return"bg-green-500";case"inquiry":return"bg-blue-500";case"favorite":return"bg-red-500";case"search":return"bg-purple-500";default:return"bg-gray-500"}})(s.type)}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Z.formatTimeAgo(s.timestamp)})]})]},s.id))}):he?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading activity..."})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(le,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"No recent activity"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start browsing properties to see your activity here"})]})})]})})]}),e.jsx(z,{open:ke,onOpenChange:e=>!Ae&&!e&&rs(),children:e.jsxs(J,{className:"sm:max-w-md",children:[e.jsxs(_,{children:[e.jsx(B,{children:"Verify Your Changes"}),e.jsx(Y,{children:Oe.newEmail?`Enter the 6-digit code sent to your new email: ${Oe.newEmail}`:`Enter the 6-digit code sent to your current email: ${ze.email}`})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Verification Code"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(G,{maxLength:6,value:Ee,onChange:e=>Fe(e),disabled:Ae,children:e.jsxs(K,{children:[e.jsx(Q,{index:0}),e.jsx(Q,{index:1}),e.jsx(Q,{index:2}),e.jsx(Q,{index:3}),e.jsx(Q,{index:4}),e.jsx(Q,{index:5})]})})}),e.jsxs("p",{className:"text-xs text-center text-muted-foreground mt-2",children:["Code expires in ",Le," minutes"]})]}),Oe.newEmail&&e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-900 dark:text-blue-100",children:[e.jsx("strong",{children:"Email Change:"})," ",ze.email," â†’ ",Oe.newEmail]})}),Oe.newPhone&&e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-900 dark:text-blue-100",children:[e.jsx("strong",{children:"Phone Change:"})," ",ze.phone," â†’ ",Oe.newPhone]})})]}),e.jsxs(H,{className:"flex-col sm:flex-row gap-2",children:[e.jsx(o,{variant:"outline",onClick:rs,disabled:Ae,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(o,{onClick:async()=>{if(Ee&&6===Ee.length)try{Ve(!0);const e=await fetch("http://localhost:3001/api/auth/verify-profile-update-otp",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({otp:Ee,newEmail:Oe.newEmail,newPhone:Oe.newPhone})}),s=await e.json();if(!e.ok||!s.success)throw new Error(s.message||"Invalid verification code");if(Oe.otherUpdates){const{profile:e,...s}=Oe.otherUpdates;if(e){const{phone:t,...a}=e,i={...s,profile:a};Object.keys(a).length>1&&await l.updateCurrentUser(i)}}await Xe(),De(!1),Fe(""),Te(!1),Me({}),pe(!1),c({title:"Profile Updated",description:"Your profile has been updated and verified successfully."})}catch(e){c({title:"Verification Failed",description:e.message||"Invalid verification code. Please try again.",variant:"destructive"})}finally{Ve(!1)}else c({title:"Invalid OTP",description:"Please enter the complete 6-digit code",variant:"destructive"})},disabled:Ae||6!==Ee.length,className:"w-full sm:w-auto",children:Ae?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Verifying..."]}):"Verify & Update"})]})]})})]})};export{ne as default};

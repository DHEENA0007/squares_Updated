import{j as e}from"./ui-DHQhougw.js";import{d as t,r}from"./router-Bi51YGN-.js";import{y as s,K as a,U as n,a as o,b as i,c,e as l,d}from"./index-CV77Hym3.js";import{D as m}from"./dollar-sign-DYhSNXxj.js";import{T as u}from"./trending-up-BiEUbM3m.js";import{A as h}from"./activity-DXf5bWrv.js";import"./vendor-eVk5PToZ.js";const p=new class{baseUrl="https://api.buildhomemartsquares.com/api";async makeRequest(e,t={}){const r=`${this.baseUrl}${e}`,a={headers:{"Content-Type":"application/json",...t.headers},...t},n=s.getToken();n&&(a.headers={...a.headers,Authorization:`Bearer ${n}`});try{const e=await fetch(r,a);if(!e.ok){let t;try{t=await e.json()}catch(o){t={success:!1,message:`HTTP ${e.status}: ${e.statusText}`}}throw new Error(t&&t.message||"An error occurred")}const t=await e.json();if(null==t)throw new Error("Received null or undefined response from server");return t}catch(i){throw i}}async getDashboardData(){try{const e=await this.makeRequest("/dashboard");if(!e||"object"!=typeof e)throw new Error("Invalid response format");return e}catch(e){return{success:!0,data:{stats:{totalUsers:0,totalProperties:0,totalRevenue:0,activeListings:0,newUsersThisMonth:0,newPropertiesThisMonth:0,revenueThisMonth:0,engagementRate:0},recentActivities:[]}}}}formatRevenue(e){return e>=1e7?`₹${(e/1e7).toFixed(1)} Cr`:e>=1e5?`₹${(e/1e5).toFixed(1)} Lac`:`₹${e.toLocaleString("en-IN")}`}formatPercentageChange(e,t){if(0===t)return"+0%";const r=(e-t)/t*100;return`${r>=0?"+":""}${r.toFixed(1)}%`}formatActivityDescription(e){switch(e.type){case"user_registered":return`New user registered: ${e.metadata?.email||"Unknown"}`;case"property_listed":return`New property listed: ${e.metadata?.title||"Unknown"}`;case"property_sold":return`Property sold: ${e.metadata?.title||"Unknown"}`;case"property_rented":return`Property rented: ${e.metadata?.title||"Unknown"}`;case"inquiry_received":return`New inquiry received for: ${e.metadata?.propertyTitle||"Unknown"}`;case"subscription_purchased":return`Subscription purchased: ${e.metadata?.planName||"Unknown"} - ₹${e.metadata?.amount||0}`;default:return e.description}}formatTimestamp(e){const t=new Date,r=new Date(e),s=t.getTime()-r.getTime(),a=Math.floor(s/36e5),n=Math.floor(a/24);return a<1?"Just now":a<24?`${a} hour${a>1?"s":""} ago`:n<7?`${n} day${n>1?"s":""} ago`:r.toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})}},g=()=>{const s=t(),[g,x]=r.useState(null),[f,y]=r.useState([]),[v,j]=r.useState(!0);if(r.useEffect(()=>{(async()=>{try{const e=await p.getDashboardData();e.success&&(x(e.data.stats),y(e.data.recentActivities))}catch(e){}finally{j(!1)}})()},[]),v)return e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(a,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading dashboard..."})]});if(!g)return e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-lg text-muted-foreground",children:"Failed to load dashboard data."})});const b=[{title:"Total Revenue",value:p.formatRevenue(g.totalRevenue),change:`${g.revenueThisMonth>0?"+":""}${p.formatRevenue(g.revenueThisMonth)} this month`,icon:m,color:"text-emerald-500 dark:text-emerald-400",bgColor:"bg-emerald-500/10",onClick:()=>s("/admin/revenue-details")},{title:"Total Users",value:g.totalUsers.toLocaleString(),change:`+${g.newUsersThisMonth} this month`,icon:n,color:"text-blue-500 dark:text-blue-400",bgColor:"bg-blue-500/10",onClick:()=>s("/admin/users-details")},{title:"Total Properties",value:g.totalProperties.toLocaleString(),change:`+${g.newPropertiesThisMonth} this month`,icon:u,color:"text-accent",bgColor:"bg-accent/10",onClick:()=>s("/admin/properties-details")},{title:"Engagement Rate",value:`${g.engagementRate}%`,change:"Favorites per property",icon:h,color:"text-primary",bgColor:"bg-primary/10",onClick:()=>s("/admin/engagement-details")}];return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Welcome back! Here's an overview of your metrics."})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:b.map(t=>{const r=t.icon;return e.jsxs(o,{className:"hover:shadow-lg transition-all "+(t.onClick?"cursor-pointer hover:scale-105":""),onClick:t.onClick,children:[e.jsxs(i,{className:"flex flex-row items-center justify-between pb-2 space-y-0",children:[e.jsx(c,{className:"text-sm font-medium",children:t.title}),e.jsx("div",{className:`p-2 rounded-lg ${t.bgColor}`,children:e.jsx(r,{className:`h-4 w-4 ${t.color}`})})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.value}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t.change})]})]},t.title)})}),e.jsxs(o,{children:[e.jsxs(i,{children:[e.jsx(c,{children:"Recent Activity"}),e.jsx(d,{children:"Latest platform activities"})]}),e.jsx(l,{children:e.jsx("div",{className:"space-y-4",children:0===f.length?e.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No recent activities"}):f.map(t=>e.jsxs("div",{className:"flex items-center gap-4 pb-4 border-b last:border-0 last:pb-0",children:[e.jsx("div",{className:"w-2 h-2 rounded-full "+("user_registered"===t.type?"bg-blue-500":"property_listed"===t.type?"bg-green-500":"property_sold"===t.type?"bg-emerald-500":"property_rented"===t.type?"bg-purple-500":"subscription_purchased"===t.type?"bg-yellow-500":"bg-primary")}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:p.formatActivityDescription(t)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:p.formatTimestamp(t.timestamp)})]})]},t._id))})})]})]})};export{g as default};

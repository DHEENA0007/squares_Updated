const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendorService-C4BcjEQb.js","assets/index-uSA-3vk3.js","assets/ui-BNZSgpjP.js","assets/router-D8v2YSKU.js","assets/vendor-BxThA0WO.js","assets/reviewsService-DOgBHxA8.js"])))=>i.map(i=>d[i]);
import{a2 as e,f as s,a9 as a,a as t,b as i,c as r,B as l,e as n,aN as c,C as d,bS as o,bM as m,S as x,Q as h,bR as p}from"./index-uSA-3vk3.js";import{j as u}from"./ui-BNZSgpjP.js";import{r as j,d as g}from"./router-D8v2YSKU.js";import{a as b}from"./addonService-16941o2C.js";import{paymentService as v}from"./paymentService-GZKWK9_g.js";import{C as N}from"./calendar-D6wj0hX2.js";import"./vendor-BxThA0WO.js";const y=()=>{const[y,f]=j.useState(null),[w,S]=j.useState([]),[_,A]=j.useState([]),[k,P]=j.useState(!0),[C,D]=j.useState(!1),{toast:T}=e(),L=g();j.useEffect(()=>{M(),z()},[]);const M=async()=>{try{const e=await fetch("https://app.buildhomemartsquares.com/api/vendors/subscription-status",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok){const s=await e.json();s.success&&s.data.hasActiveSubscription&&f(s.data.subscription)}}catch(e){}finally{P(!1)}},z=async()=>{try{const e=await b.getAddons();S(e.filter(e=>e.isActive))}catch(e){S([{_id:"1",name:"Professional Photography",description:"High-quality property photography service",price:2999,category:"photography",billingType:"per_property",isActive:!0},{_id:"2",name:"Virtual Tours",description:"360° virtual property tours",price:4999,category:"technology",billingType:"per_property",isActive:!0},{_id:"3",name:"Social Media Marketing",description:"Promote your listings on social platforms",price:1999,category:"marketing",billingType:"monthly",isActive:!0}])}},E=e=>new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"}),$=e=>{var s;(s=e._id,y?.addons?.some(e=>e._id===s))?T({title:"Addon Already Active",description:`${e.name} is already included in your subscription`,variant:"default"}):A(s=>s.find(s=>s._id===e._id)?s.filter(s=>s._id!==e._id):[...s,e])},B=()=>_.reduce((e,s)=>e+s.price,0);return k?u.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),u.jsx("p",{className:"text-gray-600",children:"Loading subscription details..."})]})}):u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("div",{className:"sm:flex sm:items-center",children:u.jsxs("div",{className:"sm:flex-auto",children:[u.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Subscription Management"}),u.jsx("p",{className:"mt-2 text-sm text-gray-700 dark:text-gray-300",children:"Manage your subscription and addon services"})]})}),!y&&u.jsxs(s,{onClick:()=>L("/vendor/subscription-plans"),children:[u.jsx(a,{className:"w-4 h-4 mr-2"}),"Get Started"]})]}),y?u.jsxs(t,{children:[u.jsx(i,{children:u.jsxs(r,{className:"flex items-center space-x-3",children:[(e=>{switch(e?.toLowerCase()){case"basic":return u.jsx(m,{className:"w-8 h-8 text-blue-500"});case"premium":return u.jsx(h,{className:"w-8 h-8 text-yellow-500"});case"enterprise":return u.jsx(x,{className:"w-8 h-8 text-purple-500"});default:return u.jsx(o,{className:"w-8 h-8 text-green-500"})}})(y.planName),u.jsxs("div",{children:[u.jsxs("h2",{className:"text-2xl font-bold",children:[y.planName," Plan"]}),u.jsx(l,{variant:"active"===y.status?"default":"secondary",children:y.status.toUpperCase()})]})]})}),u.jsxs(n,{className:"space-y-6",children:[u.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx(N,{className:"w-5 h-5 text-blue-600"}),u.jsxs("div",{children:[u.jsx("p",{className:"text-sm text-gray-600",children:"Start Date"}),u.jsx("p",{className:"font-medium",children:E(y.startDate)})]})]}),u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx(N,{className:"w-5 h-5 text-red-600"}),u.jsxs("div",{children:[u.jsx("p",{className:"text-sm text-gray-600",children:"End Date"}),u.jsx("p",{className:"font-medium",children:E(y.endDate)})]})]}),u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx(c,{className:"w-5 h-5 text-green-600"}),u.jsxs("div",{children:[u.jsx("p",{className:"text-sm text-gray-600",children:"Days Remaining"}),u.jsxs("p",{className:"font-medium text-green-600",children:[(e=>{const s=new Date(e),a=new Date,t=s.getTime()-a.getTime(),i=Math.ceil(t/864e5);return Math.max(0,i)})(y.endDate)," days"]})]})]})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Plan Features"}),u.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:y.features.map((e,s)=>{const a="string"==typeof e?e:"object"==typeof e&&null!==e&&"name"in e?e.name:String(e);return u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(d,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),u.jsx("span",{className:"text-sm",children:String(a)})]},s)})})]}),y.addons&&y.addons.length>0&&u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Purchased Add-ons"}),u.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:y.addons.map((e,s)=>u.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200",children:[u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx("div",{className:"p-1.5 rounded bg-blue-100",children:u.jsx(d,{className:"w-4 h-4 text-blue-600"})}),u.jsxs("div",{children:[u.jsx("p",{className:"font-medium text-sm",children:e.name}),u.jsx("p",{className:"text-xs text-gray-600 capitalize",children:e.category})]})]}),u.jsxs("div",{className:"text-right",children:[u.jsxs("p",{className:"font-semibold text-blue-600",children:["₹",e.price.toLocaleString()]}),u.jsx("p",{className:"text-xs text-gray-500 capitalize",children:e.billingPeriod||e.billingType?.replace("_"," ")||"N/A"})]})]},s))})]}),y.amount&&u.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-sm text-gray-600 dark:text-black",children:"Total Amount"}),u.jsxs("p",{className:"font-semibold text-lg dark:text-black",children:["₹",y.amount.toLocaleString()]})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-sm text-gray-600 dark:text-black",children:"Billing"}),u.jsx("p",{className:"font-medium dark:text-black",children:y.billingCycle})]})]})}),u.jsxs("div",{className:"flex space-x-4",children:[u.jsx(s,{variant:"outline",onClick:()=>L("/vendor/subscription-plans"),children:"Upgrade Plan"}),u.jsx(s,{variant:"outline",onClick:()=>L("/vendor/billing"),children:"View Billing"})]})]})]}):u.jsx(t,{children:u.jsxs(n,{className:"text-center py-12",children:[u.jsx(o,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),u.jsx("h2",{className:"text-2xl font-bold mb-2",children:"No Active Subscription"}),u.jsx("p",{className:"text-gray-600 mb-6",children:"Choose a subscription plan to get started with premium features"}),u.jsx(s,{onClick:()=>L("/vendor/subscription-plans"),children:"Choose Plan"})]})}),u.jsxs(t,{children:[u.jsx(i,{children:u.jsxs(r,{className:"flex items-center justify-between",children:[u.jsx("span",{children:"Available Addon Services"}),_.length>0&&u.jsxs(l,{variant:"outline",children:[_.length," selected"]})]})}),u.jsxs(n,{children:[u.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:(()=>{y?.addons?.map(e=>e._id);return w.filter(e=>!y?.addons?.some(s=>s._id===e._id))})().map(e=>{const s=_.some(s=>s._id===e._id);return u.jsxs(t,{className:"cursor-pointer transition-all duration-200 hover:shadow-md "+(s?"ring-2 ring-blue-500 bg-blue-50":""),onClick:()=>$(e),children:[u.jsxs(i,{className:"pb-3",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx(r,{className:"text-lg",children:e.name}),s?u.jsx(d,{className:"w-6 h-6 text-blue-600"}):u.jsx(m,{className:"w-6 h-6 text-gray-400"})]}),u.jsxs("div",{className:"text-xl font-bold text-blue-600",children:["₹",e.price.toLocaleString(),u.jsxs("span",{className:"text-sm text-gray-500 font-normal capitalize",children:["/",e.billingPeriod||e.billingType?.replace("_"," ")||"month"]})]})]}),u.jsxs(n,{children:[u.jsx("p",{className:"text-gray-600 text-sm mb-3",children:e.description}),u.jsx(l,{variant:"outline",className:"capitalize",children:e.category})]})]},e._id)})}),y&&w.length>0&&w.every(e=>y.addons?.some(s=>s._id===e._id))&&u.jsxs("div",{className:"text-center py-8",children:[u.jsx(d,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),u.jsx("h3",{className:"text-lg font-semibold mb-2",children:"All Addons Purchased!"}),u.jsx("p",{className:"text-gray-600",children:"You have already purchased all available addon services."})]}),_.length>0&&u.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsxs("p",{className:"font-semibold",children:[_.length," addon(s) selected"]}),u.jsxs("p",{className:"text-sm text-gray-600",children:["Total: ₹",B().toLocaleString()]})]}),u.jsx(s,{onClick:async()=>{if(0!==_.length)if(y){D(!0);try{const s={addons:_.map(e=>e._id),totalAmount:B()},a=await v.processAddonPayment(s);if(!a.success)throw new Error(a.message||"Payment failed");T({title:"Addons Purchased Successfully!",description:`Successfully purchased ${_.length} addon service(s)`}),A([]),M();try{const{vendorService:e}=await p(async()=>{const{vendorService:e}=await import("./vendorService-C4BcjEQb.js");return{vendorService:e}},__vite__mapDeps([0,1,2,3,4,5]));await e.refreshSubscriptionData()}catch(e){}}catch(s){T({title:"Purchase Failed",description:s instanceof Error?s.message:"Failed to purchase addons",variant:"destructive"})}finally{D(!1)}}else T({title:"No active subscription",description:"Please subscribe to a plan first before purchasing addons",variant:"destructive"});else T({title:"No addons selected",description:"Please select at least one addon to purchase",variant:"destructive"})},disabled:C,size:"lg",children:C?"Processing...":`Purchase Addons - ₹${B().toLocaleString()}`})]})})]})]})]})};export{y as default};

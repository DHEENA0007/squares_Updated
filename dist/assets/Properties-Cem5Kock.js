import{j as e}from"./ui-DOY6021Z.js";import{d as je,r as d}from"./router-2SVJvIbS.js";import{A as pe,z,t as x,h as ge,B as m,al as fe,am as ve,an as be,G as Ne,f as D,D as ye,a as f,b as v,c as b,e as N,d as Pe,ao as q,V as we,W as Se,Y as Ce,af as De,ag as F,Z as j,E as I,ai as Fe}from"./index-DJqidggL.js";import{u as Ae}from"./usePagination-DI7D6ysW.js";import{P as Te,a as ke,b as O,c as Re,d as Ee,e as Oe}from"./pagination-D07uMfTX.js";import{D as Le}from"./DataTable-CFB9t7XJ.js";import{S as V}from"./SearchFilter-BLyxj2fq.js";import{A as $e,b as Me,c as _e,d as qe,e as Ie,f as Ve,g as Be,h as ze}from"./alert-dialog-nMYiUnKa.js";import{D as H,a as U,b as J,c as G,d as W,e as He}from"./dialog-DsaUnv7s.js";import{L as Ue}from"./label-B9O-vWmY.js";import{T as Je}from"./textarea-DO9hd5Hf.js";import{S as y}from"./separator-b0f6TR0i.js";import{g as Ge}from"./propertyUtils-DZZpAHgC.js";import{I as We}from"./indian-rupee-CzxTBUcA.js";import{L as Ye}from"./loader-circle-C0zUPQir.js";import{E as Ze}from"./ellipsis-BAZwf6Eg.js";import{S as Ke}from"./square-pen-DCzYARLy.js";import{T as B}from"./trash-2-BwLQT3fy.js";import"./vendor-Dazix4UH.js";import"./table-BBEeW2UX.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=pe("StarOff",[["path",{d:"M8.34 8.34 2 9.27l5 4.87L5.82 21 12 17.77 18.18 21l-.59-3.43",key:"16m0ql"}],["path",{d:"M18.42 12.76 22 9.27l-6.91-1L12 2l-1.44 2.91",key:"1vt8nq"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);class Xe{async makeRequest(r,a={}){const l=z.getToken(),c={headers:{"Content-Type":"application/json",...l&&{Authorization:`Bearer ${l}`},...a.headers},...a},i=await fetch(`https://squares-v2.onrender.com/api/admin${r}`,c);if(!i.ok){const o=await i.json().catch(()=>({}));throw new Error(o.message||`HTTP error! status: ${i.status}`)}return i.json()}async getProperties(r={}){try{const a=new URLSearchParams;Object.entries(r).forEach(([i,o])=>{o!=null&&o!==""&&a.append(i,String(o))});const l=`/properties${a.toString()?`?${a.toString()}`:""}`;return await this.makeRequest(l)}catch(a){const l=a instanceof Error?a.message:"Failed to fetch properties";throw x({title:"Error",description:l,variant:"destructive"}),a}}async approveProperty(r){try{await this.makeRequest(`/properties/${r}/approve`,{method:"POST"}),x({title:"Success",description:"Property approved successfully!"})}catch(a){const l=a instanceof Error?a.message:"Failed to approve property";throw x({title:"Error",description:l,variant:"destructive"}),a}}async rejectProperty(r,a){try{await this.makeRequest(`/properties/${r}/reject`,{method:"POST",body:JSON.stringify({reason:a})}),x({title:"Success",description:"Property rejected successfully!"})}catch(l){const c=l instanceof Error?l.message:"Failed to reject property";throw x({title:"Error",description:c,variant:"destructive"}),l}}async deleteProperty(r){try{await this.makeRequest(`/properties/${r}`,{method:"DELETE"}),x({title:"Success",description:"Property deleted successfully!"})}catch(a){const l=a instanceof Error?a.message:"Failed to delete property";throw x({title:"Error",description:l,variant:"destructive"}),a}}async togglePropertyFeatured(r,a){try{await this.makeRequest(`/properties/${r}/featured`,{method:"PATCH",body:JSON.stringify({featured:a})}),x({title:"Success",description:`Property ${a?"marked as featured":"removed from featured"}!`})}catch(l){const c=l instanceof Error?l.message:"Failed to update property";throw x({title:"Error",description:c,variant:"destructive"}),l}}getStatusOptions(){return[{label:"Active",value:"active"},{label:"Available",value:"available"},{label:"Pending",value:"pending"},{label:"Sold",value:"sold"},{label:"Rented",value:"rented"},{label:"Rejected",value:"rejected"}]}getStatusColor(r){switch(r.toLowerCase()){case"active":case"available":return"bg-green-500";case"pending":return"bg-yellow-500";case"sold":return"bg-blue-500";case"rented":return"bg-purple-500";case"rejected":return"bg-red-500";default:return"bg-gray-500"}}getStatusText(r){return{active:"Active",available:"Available",pending:"Pending Review",sold:"Sold",rented:"Rented",rejected:"Rejected"}[r.toLowerCase()]||r.charAt(0).toUpperCase()+r.slice(1)}getPropertyTypeOptions(){return[{label:"Apartment",value:"apartment"},{label:"House",value:"house"},{label:"Villa",value:"villa"},{label:"Plot",value:"plot"},{label:"Commercial",value:"commercial"},{label:"Office",value:"office"}]}}const P=new Xe,es=({property:t,open:r,onOpenChange:a})=>{if(!t)return null;const l=(i,o)=>{const w=new Intl.NumberFormat("en-IN",{maximumFractionDigits:0}).format(i);return o==="rent"?`₹${w}/month`:`₹${w}`},c=i=>i?.builtUp?`${i.builtUp} ${i.unit||"sqft"}`:i?.carpet?`${i.carpet} ${i.unit||"sqft"}`:i?.plot?`${i.plot} ${i.unit||"sqft"}`:"N/A";return e.jsx(H,{open:r,onOpenChange:a,children:e.jsxs(U,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(J,{children:[e.jsx(G,{className:"text-2xl",children:t.title}),e.jsx(W,{children:e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(ge,{className:"w-4 h-4"}),t.address.street,", ",t.address.city,", ",t.address.state," - ",t.address.pincode]})})]}),e.jsxs("div",{className:"space-y-6 mt-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(m,{variant:t.status==="active"?"default":t.status==="pending"?"outline":"destructive",children:["Status: ",t.status]}),e.jsx(m,{variant:"secondary",className:"capitalize",children:t.type?t.type.replace("_"," "):"property"}),e.jsxs(m,{variant:t.listingType==="sale"?"default":"outline",children:["For ",t.listingType==="sale"?"Sale":"Rent"]}),t.featured&&e.jsx(m,{variant:"default",children:"Featured"}),t.verified&&e.jsx(m,{variant:"default",children:"Verified"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Price"}),e.jsx("p",{className:"font-semibold",children:l(t.price,t.listingType)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Area"}),e.jsx("p",{className:"font-semibold",children:c(t.area)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bedrooms"}),e.jsx("p",{className:"font-semibold",children:t.bedrooms||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bathrooms"}),e.jsx("p",{className:"font-semibold",children:t.bathrooms||"N/A"})]})]})]}),e.jsx(y,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description})]}),t.amenities&&t.amenities.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(y,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Amenities"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.amenities.map((i,o)=>e.jsx(m,{variant:"outline",className:"capitalize",children:i.replace("_"," ")},o))})]})]}),e.jsx(y,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Owner Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Name"}),e.jsx("p",{className:"font-medium",children:Ge(t.owner)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Email"}),e.jsx("p",{className:"font-medium",children:t.owner?.email})]}),t.owner?.profile?.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"font-medium",children:t.owner.profile.phone})]})]})]}),t.images&&t.images.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(y,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Images"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:t.images.map((i,o)=>e.jsxs("div",{className:"relative aspect-video rounded-lg overflow-hidden border",children:[e.jsx("img",{src:i.url,alt:i.caption||`Property ${o+1}`,className:"w-full h-full object-cover"}),i.isPrimary&&e.jsx(m,{className:"absolute top-2 left-2",variant:"default",children:"Primary"})]},o))})]})]}),t.status==="rejected"&&t.rejectionReason&&e.jsxs(e.Fragment,{children:[e.jsx(y,{}),e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-red-700 mb-2",children:"Rejection Reason"}),e.jsx("p",{className:"text-sm text-red-600",children:t.rejectionReason})]})]})]})]})})},Ns=()=>{const t=je(),{toast:r}=Ne(),[a,l]=d.useState(""),[c,i]=d.useState("all"),[o,w]=d.useState("all"),[u,p]=d.useState([]),[Y,L]=d.useState(!0),[Z,A]=d.useState(!1),[K,S]=d.useState(!1),[Q,$]=d.useState(!1),[h,g]=d.useState(null),[C,M]=d.useState(""),[_,X]=d.useState(null);d.useEffect(()=>{const s=z.getCurrentUser();X(s),ee()},[]);const ee=async()=>{try{L(!0);const s=await P.getProperties({limit:1e3});s.success&&p(s.data.properties)}catch(s){console.error("Failed to fetch properties:",s),r({title:"Error",description:"Failed to load properties",variant:"destructive"})}finally{L(!1)}},T=d.useMemo(()=>u.filter(s=>{const n=s.title.toLowerCase().includes(a.toLowerCase())||s.address.city.toLowerCase().includes(a.toLowerCase())||s.address.state.toLowerCase().includes(a.toLowerCase()),E=c==="all"||s.type===c,xe=o==="all"||s.status===o;return n&&E&&xe}),[u,a,c,o]),{paginatedItems:se,currentPage:k,totalPages:R,goToPage:te,nextPage:ae,previousPage:re}=Ae(T,10),ie=async()=>{if(h)try{await P.deleteProperty(h._id),p(u.filter(s=>s._id!==h._id)),A(!1),g(null),r({title:"Success",description:"Property deleted successfully"})}catch(s){console.error("Failed to delete property:",s),r({title:"Error",description:"Failed to delete property",variant:"destructive"})}},le=async s=>{try{await P.togglePropertyFeatured(s._id,!s.featured),p(u.map(n=>n._id===s._id?{...n,featured:!n.featured}:n)),r({title:"Success",description:`Property ${s.featured?"removed from":"marked as"} featured`})}catch(n){console.error("Failed to toggle featured status:",n),r({title:"Error",description:"Failed to update featured status",variant:"destructive"})}},ne=async s=>{try{await P.approveProperty(s._id),p(u.map(n=>n._id===s._id?{...n,status:"available",verified:!0}:n)),r({title:"Success",description:"Property approved and listed successfully!"})}catch(n){console.error("Failed to approve property:",n),r({title:"Error",description:"Failed to approve property",variant:"destructive"})}},oe=async()=>{if(!(!h||!C.trim()))try{await P.rejectProperty(h._id,C),p(u.map(s=>s._id===h._id?{...s,status:"rejected"}:s)),S(!1),g(null),M(""),r({title:"Property Rejected",description:"Property has been rejected and vendor has been notified."})}catch(s){console.error("Failed to reject property:",s),r({title:"Error",description:"Failed to reject property",variant:"destructive"})}},ce=s=>{g(s),A(!0)},de=s=>{g(s),S(!0)},me=s=>{g(s),$(!0)},ue=s=>s.owner?_&&s.owner._id===_.id?!0:!s.vendor&&(s.status==="active"||s.status==="available"):!1,he=[{key:"title",label:"Property Title",render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.address.city,", ",s.address.state]})]})},{key:"type",label:"Type",render:s=>e.jsx(m,{variant:"secondary",className:"capitalize",children:s.type?s.type.replace("_"," "):"property"})},{key:"listingType",label:"Listing",render:s=>e.jsx(m,{variant:s.listingType==="sale"?"default":"outline",children:s.listingType==="sale"?"For Sale":"For Rent"})},{key:"price",label:"Price",render:s=>e.jsx("span",{className:"font-semibold",children:q.formatPrice(s.price,s.listingType)})},{key:"area",label:"Area",render:s=>e.jsx("span",{children:q.formatArea(s.area)})},{key:"status",label:"Status",render:s=>{const n={active:"default",available:"default",pending:"outline",rejected:"destructive",sold:"secondary",rented:"secondary"};return e.jsx(m,{variant:n[s.status]||"secondary",children:s.status})}},{key:"featured",label:"Featured",render:s=>e.jsx(m,{variant:s.featured?"default":"secondary",children:s.featured?"Featured":"Regular"})},{key:"actions",label:"Actions",render:s=>{const n=ue(s),E=s.status==="pending";return e.jsxs(we,{children:[e.jsx(Se,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"sm",children:e.jsx(Ze,{className:"w-4 h-4"})})}),e.jsxs(Ce,{align:"end",children:[e.jsx(De,{children:"Actions"}),e.jsx(F,{}),n&&e.jsxs(j,{onClick:()=>t(`/admin/properties/edit/${s._id}`),children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Edit Property"]}),!n&&e.jsxs(j,{onClick:()=>me(s),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"View Details"]}),!n&&E&&e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsxs(j,{onClick:()=>ne(s),className:"text-green-600",children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Approve & Publish"]}),e.jsxs(j,{onClick:()=>de(s),className:"text-red-600",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Reject"]})]}),s.status==="active"&&e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsx(j,{onClick:()=>le(s),children:s.featured?e.jsxs(e.Fragment,{children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Remove Featured"]}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Mark Featured"]})})]}),e.jsx(F,{}),e.jsxs(j,{onClick:()=>ce(s),className:"text-red-600",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})}}];return Y?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(Ye,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading properties..."})]}):e.jsxs("div",{className:"space-y-6 relative top-[60px]",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Property Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage property listings and details"})]}),e.jsxs(D,{onClick:()=>t("/admin/properties/add"),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Add Property"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(f,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(b,{className:"text-sm font-medium text-muted-foreground",children:"Total Properties"})}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold",children:u.length})})]}),e.jsxs(f,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(b,{className:"text-sm font-medium text-muted-foreground",children:"Pending Approval"})}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:u.filter(s=>s.status==="pending").length})})]}),e.jsxs(f,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(b,{className:"text-sm font-medium text-muted-foreground",children:"Active Properties"})}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:u.filter(s=>s.status==="active").length})})]}),e.jsxs(f,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(b,{className:"text-sm font-medium text-muted-foreground",children:"Featured"})}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:u.filter(s=>s.featured).length})})]})]}),e.jsxs(f,{children:[e.jsxs(v,{children:[e.jsx(b,{children:"All Properties"}),e.jsxs(Pe,{children:[T.length," propert",T.length!==1?"ies":"y"," found"]})]}),e.jsxs(N,{children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(V,{searchTerm:a,onSearchChange:l,filterValue:c,onFilterChange:i,filterOptions:[{label:"Apartment",value:"apartment"},{label:"House",value:"house"},{label:"Villa",value:"villa"},{label:"Plot",value:"plot"},{label:"Commercial",value:"commercial"},{label:"Office",value:"office"}],filterPlaceholder:"Filter by type"})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsx(V,{searchTerm:"",onSearchChange:()=>{},filterValue:o,onFilterChange:w,filterOptions:[{label:"Pending",value:"pending"},{label:"Active",value:"active"},{label:"Rejected",value:"rejected"},{label:"Sold",value:"sold"},{label:"Rented",value:"rented"}],filterPlaceholder:"Filter by status",hideSearch:!0})})]})}),e.jsx(Le,{columns:he,data:se.map(s=>({...s,id:s._id})),hideDefaultActions:!0}),R>1&&e.jsx("div",{className:"mt-6",children:e.jsx(Te,{children:e.jsxs(ke,{children:[e.jsx(O,{children:e.jsx(Re,{onClick:re,className:k===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:R},(s,n)=>n+1).map(s=>e.jsx(O,{children:e.jsx(Ee,{onClick:()=>te(s),isActive:k===s,className:"cursor-pointer",children:s})},s)),e.jsx(O,{children:e.jsx(Oe,{onClick:ae,className:k===R?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]}),e.jsx($e,{open:Z,onOpenChange:A,children:e.jsxs(Me,{children:[e.jsxs(_e,{children:[e.jsx(qe,{children:"Delete Property"}),e.jsxs(Ie,{children:['Are you sure you want to delete "',h?.title,'"? This action cannot be undone.']})]}),e.jsxs(Ve,{children:[e.jsx(Be,{children:"Cancel"}),e.jsx(ze,{onClick:ie,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})}),e.jsx(H,{open:K,onOpenChange:S,children:e.jsxs(U,{children:[e.jsxs(J,{children:[e.jsx(G,{children:"Reject Property"}),e.jsxs(W,{children:['Please provide a reason for rejecting "',h?.title,'". The vendor will be notified.']})]}),e.jsxs("div",{className:"py-4",children:[e.jsx(Ue,{htmlFor:"rejection-reason",children:"Rejection Reason"}),e.jsx(Je,{id:"rejection-reason",placeholder:"Enter the reason for rejection...",value:C,onChange:s=>M(s.target.value),className:"mt-2",rows:4})]}),e.jsxs(He,{children:[e.jsx(D,{variant:"outline",onClick:()=>S(!1),children:"Cancel"}),e.jsx(D,{variant:"destructive",onClick:oe,disabled:!C.trim(),children:"Reject Property"})]})]})}),e.jsx(es,{property:h,open:Q,onOpenChange:$})]})};export{Ns as default};

import{j as e}from"./ui-BNZSgpjP.js";import{r as s,d as a}from"./router-D8v2YSKU.js";import{G as t,aj as r,q as i,r as l,s as n,v as o,w as c,f as d,a3 as p,u as m,aO as x,a as u,bP as h,a1 as y,e as f,B as g,k as j,aM as v,aN as b,bT as N,am as w,y as _}from"./index-AgUnwITA.js";import{a as T}from"./propertyUtils-41DuwCMc.js";import{P as C,a as F}from"./PropertyContactDialog-CAP7AeDn.js";import{E as S}from"./EnterprisePropertyContactDialog-BsD_ssE-.js";import{vendorService as P}from"./vendorService-D3bgDE6C.js";import{f as A}from"./favoriteService-CuulXHZb.js";import{S as k}from"./square-DY9WROQ5.js";import{T as $}from"./thumbs-up-Bij4JGVQ.js";const V=({onFilterChange:a,initialFilters:m})=>{const[x,u]=s.useState({}),[h,y]=s.useState([]),[f,g]=s.useState([]),[j,v]=s.useState([]),[b,N]=s.useState(!0);s.useEffect(()=>{(async()=>{try{N(!0);const[e,s,a]=await Promise.all([p.getAllPropertyTypes(!1),p.getAllFilterConfigurations(!1),p.getFilterDependencies()]);y(e),g(s),v(a)}catch(e){}finally{N(!1)}})()},[]),s.useEffect(()=>{m&&u(m)},[m]);const w=(e,s)=>{let t={...x,[e]:"all"===s||"any"===s||"any-budget"===s?void 0:s};if("budget"===e){if("any-budget"===s)t.minPrice=void 0,t.maxPrice=void 0;else{const e=f.find(e=>(e.id||e._id)===s);e&&(t.minPrice=e.minValue,t.maxPrice=e.maxValue)}delete t.budget}const r=(e,s)=>{const a=j.find(s=>s.targetFilterType===e);if(!a)return!0;let t;return t="property_type"===a.sourceFilterType?s.propertyType:s[a.sourceFilterType],!(!t||"all"===t||"any"===t||"any-budget"===t)&&a.sourceFilterValues.includes(t)},i=_();for(const a of i)a===e||"property_type"===a&&"propertyType"===e||void 0===t[a]||r(a,t)||(t[a]=void 0,"budget"===a&&(t.minPrice=void 0,t.maxPrice=void 0));u(t),a(t)},_=()=>{const e=new Set(f.map(e=>e.filterType));return Array.from(e).sort()},T=e=>f.filter(s=>s.filterType===e).sort((e,s)=>e.displayOrder-s.displayOrder),C=e=>{const s=j.find(s=>s.targetFilterType===e);if(!s)return!0;let a;return a="property_type"===s.sourceFilterType?x.propertyType:x[s.sourceFilterType],!(!a||"all"===a||"any"===a||"any-budget"===a)&&s.sourceFilterValues.includes(a)};if(b)return e.jsx("div",{className:"bg-card border border-border rounded-xl p-4 shadow-[var(--shadow-soft)]",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 py-2",children:[e.jsx(t,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{className:"text-muted-foreground",children:"Loading filters..."})]})});const F=_();return e.jsx("div",{className:"bg-card border border-border rounded-xl p-4 shadow-[var(--shadow-soft)]",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium",children:[e.jsx(r,{className:"h-5 w-5"}),e.jsx("span",{children:"Filters:"})]}),T("listing_type").length>0&&C("listing_type")&&e.jsxs(i,{value:x.listingType||"all",onValueChange:e=>w("listingType",e),children:[e.jsx(l,{className:"w-[150px]",children:e.jsx(n,{placeholder:"Listing Type"})}),e.jsxs(o,{children:[e.jsx(c,{value:"all",children:"All Types"}),T("listing_type").map(s=>e.jsx(c,{value:s.value,children:s.displayLabel||s.name},s.id||s._id))]})]}),h.length>0&&C("property_type")&&e.jsxs(i,{value:x.propertyType&&(h.find(e=>e.value.toLowerCase()===x.propertyType?.toLowerCase())?.id||h.find(e=>e.value.toLowerCase()===x.propertyType?.toLowerCase())?._id)||"all",onValueChange:e=>{if("all"===e)w("propertyType","all");else{const s=h.find(s=>(s.id||s._id)===e);s&&w("propertyType",s.value)}},children:[e.jsx(l,{className:"w-[180px]",children:e.jsx(n,{placeholder:"Property Type"})}),e.jsxs(o,{children:[e.jsx(c,{value:"all",children:"All Properties"}),h.map(s=>e.jsx(c,{value:s.id||s._id,children:s.name},s.id||s._id))]})]}),F.filter(e=>"listing_type"!==e&&"property_type"!==e).filter(e=>C(e)).map(s=>{const a=T(s);if(0===a.length)return null;const t=s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),r=x[s]||("budget"===s?"any-budget":"any");return e.jsxs(i,{value:r,onValueChange:e=>w(s,e),children:[e.jsx(l,{className:"w-[150px]",children:e.jsx(n,{placeholder:t})}),e.jsxs(o,{children:[e.jsxs(c,{value:"budget"===s?"any-budget":"any",children:["Any ",t]}),a.map(a=>e.jsx(c,{value:"budget"===s?a.id||a._id:a.value,children:a.displayLabel||a.name},a.id||a._id))]})]},s)}),e.jsx(d,{variant:"secondary",className:"ml-auto",onClick:()=>{u({}),a({})},children:"Reset Filters"})]})})},L=({property:t})=>{const r=a(),{isAuthenticated:i,user:l,isVendor:n,isCustomer:o}=m(),[c,V]=s.useState(!1),[L,E]=s.useState(!1),[O,D]=s.useState(!1),[I,M]=s.useState(!1),[U,z]=s.useState(null),[B,W]=s.useState(!0),[q,R]=s.useState(!1),[G,H]=s.useState(!1),[K,Q]=s.useState([]),J=x.getPrimaryImage(t),X=x.formatPrice(t.price,t.listingType),Y=x.formatArea(t.area),Z=t.address.district?`${t.address.city}, ${t.address.district}, ${t.address.state}`:`${t.address.city}, ${t.address.state}`;s.useEffect(()=>{(async()=>{try{const e=await p.getAllFilterConfigurations();Q(e)}catch(e){}})()},[]),s.useEffect(()=>{(async()=>{if(t.vendor?._id||t.owner?._id)try{W(!0);const e=t.vendor?._id||t.owner?._id,s=await P.checkVendorWhatsAppSupport(e);M(s.whatsappEnabled),z(s.whatsappNumber)}catch(e){M(!1),z(null)}finally{W(!1)}else W(!1)})()},[t.vendor?._id,t.owner?._id]),s.useEffect(()=>{(async()=>{if(i&&o)try{const e=await A.isFavorite(t._id);R(e)}catch(e){}})()},[i,o,t._id]);const ee=e=>{const s=K.find(s=>s.value===e&&("listing_type"===s.filterType||"listingType"===s.filterType));return s?s.displayLabel||s.name:e.charAt(0).toUpperCase()+e.slice(1)};return e.jsxs(u,{className:"group overflow-hidden hover:shadow-[var(--shadow-large)] transition-all duration-300 flex flex-col h-full",children:[e.jsxs("div",{className:"relative h-44 md:h-48 overflow-hidden",children:[e.jsx("img",{src:J,alt:t.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",onError:e=>{e.target.src=h}}),i&&o&&e.jsx(d,{size:"icon",variant:"ghost",className:"absolute top-3 right-3 bg-background/80 backdrop-blur hover:bg-background "+(q?"text-red-500":""),onClick:async e=>{if(e.stopPropagation(),i){if(!G)try{H(!0),q?(await A.removeFromFavorites(t._id),R(!1)):(await A.addToFavorites(t._id),R(!0))}catch(s){}finally{H(!1)}}else r("/login",{state:{from:`/property/${t._id}`,action:"favorite"}})},disabled:G,children:e.jsx(y,{className:"h-5 w-5 "+(q?"fill-current":"")})})]}),e.jsxs(f,{className:"p-3 flex-1",children:[e.jsxs("div",{className:"flex flex-col gap-2 mb-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(g,{className:("available"===t.status?"bg-green-500":"sold"===t.status?"bg-red-500":"rented"===t.status?"bg-blue-500":"bg-yellow-500")+" text-white border-0",children:t.status.charAt(0).toUpperCase()+t.status.slice(1)}),e.jsx(g,{className:"bg-blue-50 text-blue-700 border-blue-100 capitalize",children:ee(t.listingType).toLowerCase().startsWith("for ")?ee(t.listingType):`For ${ee(t.listingType)}`}),t.featured&&e.jsx(g,{className:"bg-accent text-accent-foreground border-0",children:"Featured"}),t.verified&&e.jsx(g,{className:"bg-green-600 text-white border-0",children:"Verified"})]}),e.jsx("h3",{className:"font-semibold text-base md:text-lg line-clamp-2",children:t.title})]}),e.jsxs("div",{className:"flex items-center text-muted-foreground mb-2",children:[e.jsx(j,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-sm line-clamp-1",children:Z})]}),e.jsx("div",{className:"text-sm text-muted-foreground mb-2 capitalize",children:t.type?t.type.replace("_"," "):"property"}),e.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:T(t)}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[t.bedrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(v,{className:"h-4 w-4"}),e.jsxs("span",{children:[t.bedrooms," BHK"]})]}),t.bathrooms>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsxs("span",{children:[t.bathrooms," Bath"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx("span",{children:Y})]})]}),e.jsx("div",{className:"text-xl md:text-2xl font-bold text-primary",children:X}),t.amenities.length>0&&e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[t.amenities.slice(0,3).map((s,a)=>e.jsx(g,{variant:"outline",className:"text-xs",children:s},a)),t.amenities.length>3&&e.jsxs(g,{variant:"outline",className:"text-xs",children:["+",t.amenities.length-3," more"]})]})]}),e.jsxs(N,{className:"p-2 pt-0 flex gap-1 text-xs",children:[!B&&!I&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{variant:"outline",className:"flex-1 h-8 px-1",onClick:()=>{i?I?D(!0):V(!0):r("/login",{state:{from:`/property/${t._id}`,action:"message"}})},title:"Message",children:[e.jsx(w,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"truncate",children:"Message"})]}),e.jsxs(d,{variant:"outline",className:"flex-1 h-8 px-1",onClick:()=>{i?I?D(!0):E(!0):r("/login",{state:{from:`/property/${t._id}`,action:"contact"}})},title:"Contact",children:[e.jsx(_,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"truncate",children:"Contact"})]}),i&&o&&e.jsxs(d,{variant:"outline",className:"flex-1 h-8 px-1",onClick:async e=>{if(e.stopPropagation(),i)try{await x.registerInterest(t._id)}catch(s){}else r("/login",{state:{from:`/property/${t._id}`,action:"interest"}})},title:"Interest",children:[e.jsx($,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"truncate",children:"Interest"})]})]}),!B&&I&&e.jsxs(d,{variant:"outline",className:"flex-1 bg-green-50 hover:bg-green-100 text-green-700 border-green-200 py-2",onClick:()=>D(!0),children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"WhatsApp Contact"]}),e.jsx(d,{className:"flex-1 py-2",onClick:()=>{i&&n&&(t.owner?._id===l?.id||t.vendor?._id===l?.id)?r(`/vendor/properties/details/${t._id}`):r(`/property/${t._id}`)},children:"View Details"})]}),e.jsx(C,{open:c,onOpenChange:V,property:t,onMessageSent:()=>{}}),e.jsx(F,{open:L,onOpenChange:E,property:t}),e.jsx(S,{open:O,onOpenChange:D,property:t,whatsappNumber:U})]})};export{V as P,L as a};

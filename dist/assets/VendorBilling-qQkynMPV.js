import{j as e}from"./ui-BNZSgpjP.js";import{d as t,r as s}from"./router-D8v2YSKU.js";import{t as a,G as i,a4 as n,a5 as r,a6 as l,a7 as c,a8 as o,B as d,f as m,q as u,r as x,s as h,v as p,w as g,a as v,e as f,af as y,ag as j,ah as N,ai as w,b as S,c as b,aN as D,a9 as P,E as F,i as I,V as R,_ as C,h as $,C as A}from"./index-BUFRx16p.js";import{u as E}from"./use-mobile-C5fBmhy-.js";import{E as z,a as T}from"./jspdf.plugin.autotable-DzSqn70E.js";import{E as U}from"./exportUtils-Croh7SIy.js";import{D as M}from"./download-CvWdhTp5.js";import{F as B}from"./file-spreadsheet-CiJqJxoF.js";import{T as k}from"./trending-up-k4oC1sk9.js";import{I as V}from"./indian-rupee-8EFFxUql.js";import{C as _}from"./circle-alert-CuIIJHW1.js";import"./vendor-BxThA0WO.js";import"./xlsx-BjkOj9O8.js";const L="https://app.buildhomemartsquares.com/api";const O=new class{async makeRequest(e,t={}){const s=`${L}${e}`,a={headers:{"Content-Type":"application/json",...t.headers},...t},i=localStorage.getItem("token");i&&(a.headers={...a.headers,Authorization:`Bearer ${i}`});try{const e=await fetch(s,a);if(!e.ok){const t=await e.json().catch(()=>({success:!1,message:`HTTP ${e.status}: ${e.statusText}`}));throw new Error(t.message||"An error occurred")}return await e.json()}catch(n){throw n}}async getSubscriptionPlans(){try{const e=await this.makeRequest("/billing/plans");return e.success?e.data:[]}catch(e){return[]}}async getCurrentSubscription(){try{const e=await this.makeRequest("/vendors/subscription/current");return e.success?e.data:null}catch(e){return null}}async upgradeSubscription(e,t){try{const s=await this.makeRequest("/vendors/subscription/upgrade",{method:"POST",body:JSON.stringify({planId:e,billingCycle:t})});return s.success&&a({title:"Success",description:s.message||"Subscription upgrade initiated!"}),{success:s.success,paymentUrl:s.data?.paymentUrl,message:s.message}}catch(s){const e=s instanceof Error?s.message:"Failed to upgrade subscription";return a({title:"Error",description:e,variant:"destructive"}),{success:!1,message:e}}}async getUpgradeOptions(){try{const e=await this.getCurrentSubscription();if(!e)return[];const t=await this.getSubscriptionPlans(),s=e.amount||0,a=e.billingCycle||"monthly";return t.filter(e=>("yearly"===a?e.price.yearly:e.price.monthly)>s)}catch(e){return[]}}async cancelSubscription(e){try{const t=await this.makeRequest("/vendors/subscription/cancel",{method:"POST",body:JSON.stringify({reason:e})});if(t.success)return a({title:"Success",description:t.message||"Subscription cancelled successfully!"}),!0;throw new Error(t.message||"Failed to cancel subscription")}catch(t){const e=t instanceof Error?t.message:"Failed to cancel subscription";return a({title:"Error",description:e,variant:"destructive"}),!1}}async reactivateSubscription(){try{const e=await this.makeRequest("/vendors/subscription/reactivate",{method:"POST"});if(e.success)return a({title:"Success",description:e.message||"Subscription reactivated successfully!"}),!0;throw new Error(e.message||"Failed to reactivate subscription")}catch(e){const t=e instanceof Error?e.message:"Failed to reactivate subscription";return a({title:"Error",description:t,variant:"destructive"}),!1}}async getPayments(e={}){try{const t=new URLSearchParams;Object.entries(e).forEach(([e,s])=>{null!=s&&""!==s&&t.append(e,s.toString())});const s="/vendors/payments"+(t.toString()?`?${t.toString()}`:""),a=await this.makeRequest(s);return a.success&&a.data?a.data:{payments:[],totalCount:0,totalPages:0,currentPage:1}}catch(t){return{payments:[],totalCount:0,totalPages:0,currentPage:1}}}async getInvoices(e={}){try{const t=new URLSearchParams;Object.entries(e).forEach(([e,s])=>{null!=s&&""!==s&&t.append(e,s.toString())});const s="/vendors/invoices"+(t.toString()?`?${t.toString()}`:""),a=await this.makeRequest(s);return a.success&&a.data?a.data:{invoices:[],totalCount:0,totalPages:0,currentPage:1}}catch(t){return{invoices:[],totalCount:0,totalPages:0,currentPage:1}}}async downloadInvoice(e){try{const t=await this.getInvoiceDetails(e);if(t)return this.generateInvoicePDF(t);const s=await fetch(`${L}/vendors/invoices/${e}/download`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!s.ok){const e=await s.text();let t="Failed to download invoice";try{t=JSON.parse(e).message||t}catch{t=e||t}throw new Error(t)}const i=s.headers.get("content-type");if(!i||!i.includes("application/pdf"))throw new Error("Invalid invoice format received from server");const n=await s.blob();if(0===n.size)throw new Error("Invoice file is empty");return a({title:"Success",description:"Invoice downloaded successfully!"}),n}catch(t){const e=t instanceof Error?t.message:"Failed to download invoice";return a({title:"Error",description:e,variant:"destructive"}),null}}generateInvoicePDF(e){const t=new z({orientation:"portrait",unit:"mm",format:"a4"});try{const s=20,a=t.internal.pageSize.getWidth(),i=t.internal.pageSize.getHeight();let n=25;t.setFontSize(18),t.setFont("courier","bold");const r="=====================================";t.text(r,a/2,n,{align:"center"}),n+=10,t.setFontSize(14),t.text("         INVOICE",a/2,n,{align:"center"}),n+=10,t.setFontSize(18),t.text(r,a/2,n,{align:"center"}),n+=20,t.setFontSize(10),t.setFont("courier","normal"),t.text(`Invoice #: ${e.invoiceNumber}`,s,n),n+=7,t.text(`Issue Date: ${this.formatDate(e.issueDate)}`,s,n),n+=7,t.text(`Due Date: ${this.formatDate(e.dueDate)}`,s,n),n+=7,t.text(`Status: ${e.status.toUpperCase()}`,s,n),n+=15,t.setFontSize(11),t.setFont("courier","bold"),t.text("Bill To:",s,n),n+=8,t.setFontSize(9),t.setFont("courier","normal"),t.text(e.vendorDetails.name,s,n),n+=6,t.text(e.vendorDetails.email,s,n),n+=6,t.text(e.vendorDetails.phone,s,n),n+=6,e.vendorDetails.address&&(t.text(e.vendorDetails.address,s,n),n+=6),e.vendorDetails.gst&&(t.text(`GST: ${e.vendorDetails.gst}`,s,n),n+=6),n+=8,t.setFontSize(11),t.setFont("courier","bold"),t.text("Items:",s,n),n+=7,t.setFontSize(9),t.setFont("courier","normal");const l="-------------------------------------";return t.text(l,s,n),n+=7,e.items.forEach(e=>{t.text(`Description: ${e.description}`,s,n),n+=5,t.text(`Quantity: ${e.quantity}`,s,n),n+=5,t.text(`Unit Price: ₹${this.formatCurrency(e.unitPrice)}`,s,n),n+=5,t.text(`Total: ₹${this.formatCurrency(e.total)}`,s,n),n+=8}),t.text(l,s,n),n+=8,t.setFontSize(10),t.setFont("courier","normal"),t.setFontSize(12),t.setFont("courier","bold"),t.text("=====================================",a/2,n,{align:"center"}),n+=7,t.text(`TOTAL: ₹${this.formatCurrency(e.amount)}`,a/2,n,{align:"center"}),n+=7,t.text("=====================================",a/2,n,{align:"center"}),n+=15,e.paidDate&&(t.setFontSize(10),t.setFont("courier","normal"),t.text("Payment Method: "+("paid"===e.status?"Razorpay":"Pending"),s,n),n+=6,t.text(`Paid Date: ${this.formatDate(e.paidDate)}`,s,n),n+=15),t.setFontSize(9),t.setFont("courier","normal"),t.text("Thank you for your business!",a/2,i-20,{align:"center"}),t.setFontSize(11),t.setFont("courier","bold"),t.text("BuildHomeMartSquares",a/2,i-12,{align:"center"}),t.setFontSize(8),t.setFont("courier","normal"),t.text("www.buildhomemartsquares.com",a/2,i-6,{align:"center"}),t.output("blob")}catch(s){throw new Error("Failed to generate invoice PDF")}}async getBillingStats(){try{const e=await this.makeRequest("/vendors/billing/stats");return e.success&&e.data?e.data:{totalRevenue:0,monthlyRevenue:0,activeSubscriptions:0,totalInvoices:0,paidInvoices:0,overdueInvoices:0,nextBillingAmount:0,nextBillingDate:(new Date).toISOString(),subscriptionStatus:"inactive",usageStats:{properties:{used:0,limit:0},leads:{used:0,limit:0},messages:{used:0,limit:0}}}}catch(e){return{totalRevenue:0,monthlyRevenue:0,activeSubscriptions:0,totalInvoices:0,paidInvoices:0,overdueInvoices:0,nextBillingAmount:0,nextBillingDate:(new Date).toISOString(),subscriptionStatus:"inactive",usageStats:{properties:{used:0,limit:0},leads:{used:0,limit:0},messages:{used:0,limit:0}}}}}async getRevenueStats(){try{const e=await this.makeRequest("/subscriptions/revenue-stats");return e.success&&e.data?e.data:{totalPaidRevenue:0,monthlyPaidRevenue:0,activePaidRevenue:0,cancelledPaidRevenue:0,expiredPaidRevenue:0,addonPaidRevenue:0,grandTotalRevenue:0}}catch(e){return{totalPaidRevenue:0,monthlyPaidRevenue:0,activePaidRevenue:0,cancelledPaidRevenue:0,expiredPaidRevenue:0,addonPaidRevenue:0,grandTotalRevenue:0}}}formatCurrency(e){return e.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}formatDate(e){return new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})}getStatusColor(e){return{active:"text-green-600 bg-green-100",cancelled:"text-red-600 bg-red-100",expired:"text-orange-600 bg-orange-100",pending:"text-yellow-600 bg-yellow-100",trial:"text-blue-600 bg-blue-100",completed:"text-green-600 bg-green-100",failed:"text-red-600 bg-red-100",refunded:"text-purple-600 bg-purple-100",paid:"text-green-600 bg-green-100",overdue:"text-red-600 bg-red-100",sent:"text-blue-600 bg-blue-100",draft:"text-gray-600 bg-gray-100"}[e]||"text-gray-600 bg-gray-100"}getUsagePercentage(e,t){return 0===t?0:Math.min(e/t*100,100)}downloadBlob(e,t){const s=window.URL.createObjectURL(e),a=document.createElement("a");a.href=s,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(s)}async getPaymentDetails(e){try{const t=await this.makeRequest(`/vendors/payments/${e}`);return t.success?t.data:null}catch(t){return a({title:"Error",description:"Failed to load payment details",variant:"destructive"}),null}}async getInvoiceDetails(e){try{const t=await this.makeRequest(`/vendors/invoices/${e}`);return t.success?t.data:null}catch(t){return a({title:"Error",description:"Failed to load invoice details",variant:"destructive"}),null}}async downloadReceipt(e){try{const t=await this.getPaymentDetails(e);if(t)return this.generateReceiptPDF(t);const s=await fetch(`${L}/vendors/payments/${e}/receipt`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!s.ok){const e=await s.text();let t="Failed to download receipt";try{t=JSON.parse(e).message||t}catch{t=e||t}throw new Error(t)}const i=s.headers.get("content-type");if(!i||!i.includes("application/pdf"))throw new Error("Invalid receipt format received from server");const n=await s.blob();if(0===n.size)throw new Error("Receipt file is empty");return a({title:"Success",description:"Receipt downloaded successfully!"}),n}catch(t){const e=t instanceof Error?t.message:"Failed to download receipt";return a({title:"Error",description:e,variant:"destructive"}),null}}generateReceiptPDF(e){const t=new z({orientation:"portrait",unit:"mm",format:"a4"});try{const s=20,a=t.internal.pageSize.getWidth(),i=t.internal.pageSize.getHeight();let n=25;t.setFontSize(18),t.setFont("courier","bold");const r="=====================================";t.text(r,a/2,n,{align:"center"}),n+=10,t.setFontSize(14),t.text("       PAYMENT RECEIPT",a/2,n,{align:"center"}),n+=10,t.setFontSize(18),t.text(r,a/2,n,{align:"center"}),n+=20,t.setFontSize(10),t.setFont("courier","normal"),t.text(`Receipt #: ${e._id.slice(-8).toUpperCase()}`,s,n),n+=7,t.text(`Date: ${this.formatDate(e.paidAt||e.createdAt)}`,s,n),n+=7,t.text(`Status: ${e.status.toUpperCase()}`,s,n),n+=15,t.setFontSize(11),t.setFont("courier","bold"),t.text("Payment Details:",s,n),n+=8,t.setFontSize(9),t.setFont("courier","normal");const l="-------------------------------------";return t.text(l,s,n),n+=7,t.text(`Description: ${e.description||"Payment"}`,s,n),n+=5,t.text(`Amount: ₹${this.formatCurrency(e.amount)}`,s,n),n+=8,t.text(l,s,n),n+=8,t.setFontSize(11),t.setFont("courier","bold"),t.text("Transaction Details:",s,n),n+=8,t.setFontSize(9),t.setFont("courier","normal"),t.text(l,s,n),n+=7,t.text(`Payment Method: ${e.paymentMethod.replace("_"," ").toUpperCase()}`,s,n),n+=5,e.transactionId&&(t.text(`Transaction ID: ${e.transactionId}`,s,n),n+=5),e.gatewayOrderId&&(t.text(`Gateway Order ID: ${e.gatewayOrderId}`,s,n),n+=5),t.text(`Payment Gateway: ${e.paymentGateway.toUpperCase()}`,s,n),n+=5,e.subscriptionId&&(t.text(`Subscription ID: ${e.subscriptionId.slice(-8).toUpperCase()}`,s,n),n+=5),t.text(l,s,n),n+=15,t.setFontSize(9),t.setFont("courier","normal"),t.text("Thank you for your business!",a/2,i-20,{align:"center"}),t.setFontSize(11),t.setFont("courier","bold"),t.text("BuildHomeMartSquares",a/2,i-12,{align:"center"}),t.setFontSize(8),t.setFont("courier","normal"),t.text("www.buildhomemartsquares.com",a/2,i-6,{align:"center"}),t.output("blob")}catch(s){throw new Error("Failed to generate receipt PDF")}}async exportBillingData(e,t={}){try{if("excel"===e)return this.generateBillingReportExcel(t);const s=new URLSearchParams;s.append("format",e),Object.entries(t).forEach(([e,t])=>{null!=t&&""!==t&&s.append(e,t.toString())});const i=await fetch(`${L}/vendors/billing/export?${s.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!i.ok)throw new Error("Failed to export billing data");const n=await i.blob();return a({title:"Success",description:"Billing data exported successfully!"}),n}catch(s){const e=s instanceof Error?s.message:"Failed to export billing data";return a({title:"Error",description:e,variant:"destructive"}),null}}async generateBillingReportPDF(e={}){const t=new z({orientation:"portrait",unit:"mm",format:"a4"});try{const s=20,a=20,i=t.internal.pageSize.getWidth(),n=t.internal.pageSize.getHeight(),r=i-s-a;let l=25;t.setFontSize(18),t.setFont("helvetica","bold"),t.text("BILLING REPORT",i/2,l,{align:"center"}),t.setFontSize(11),t.setFont("helvetica","normal"),l+=15;const c=e.dateFrom&&e.dateTo?`${this.formatDate(e.dateFrom)} - ${this.formatDate(e.dateTo)}`:"All Time";t.text(`Report Period: ${c}`,s,l),l+=8,t.text(`Generated: ${this.formatDate((new Date).toISOString())}`,s,l),l+=20;const o=await this.getBillingStats();t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Summary",s,l),l+=10;const d=[["Metric","Value"],["Total Revenue",`₹${this.formatCurrency(o.totalRevenue)}`],["Monthly Revenue",`₹${this.formatCurrency(o.monthlyRevenue)}`],["Active Subscriptions",o.activeSubscriptions.toString()],["Total Invoices",o.totalInvoices.toString()],["Paid Invoices",o.paidInvoices.toString()],["Overdue Invoices",o.overdueInvoices.toString()]];T(t,{body:d,startY:l,theme:"grid",styles:{fontSize:9,cellPadding:3},headStyles:{fillColor:[41,128,185],fontSize:10},columnStyles:{0:{cellWidth:.6*r},1:{cellWidth:.4*r,halign:"right"}},margin:{left:s,right:a}}),l=t.lastAutoTable.finalY+15;const m=await this.getPayments(e);if(m.payments.length>0){l>n-80&&(t.addPage(),l=25),t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Recent Payments",s,l),l+=10;const e=[["Date","Description","Amount","Status","Method"]];m.payments.slice(0,10).forEach(t=>{e.push([this.formatDate(t.paidAt||t.createdAt),t.description,`₹${this.formatCurrency(t.amount)}`,t.status.toUpperCase(),t.paymentMethod.replace("_"," ").toUpperCase()])}),T(t,{body:e,startY:l,theme:"grid",styles:{fontSize:7,cellPadding:2},headStyles:{fillColor:[52,152,219],fontSize:8},columnStyles:{0:{cellWidth:.2*r},1:{cellWidth:.35*r},2:{cellWidth:.2*r,halign:"right"},3:{cellWidth:.15*r,halign:"center"},4:{cellWidth:.1*r}},margin:{left:s,right:a}})}const u=await this.getInvoices(e);if(u.invoices.length>0){l=t.lastAutoTable.finalY+15,l>n-80&&(t.addPage(),l=25),t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Recent Invoices",s,l),l+=10;const e=[["Invoice #","Date","Amount","Status"]];u.invoices.slice(0,10).forEach(t=>{e.push([t.invoiceNumber,this.formatDate(t.issueDate),`₹${this.formatCurrency(t.amount)}`,t.status.toUpperCase()])}),T(t,{body:e,startY:l,theme:"grid",styles:{fontSize:8,cellPadding:2},headStyles:{fillColor:[155,89,182],fontSize:9},columnStyles:{0:{cellWidth:.3*r},1:{cellWidth:.25*r},2:{cellWidth:.25*r,halign:"right"},3:{cellWidth:.2*r,halign:"center"}},margin:{left:s,right:a}})}return t.setFontSize(8),t.setFont("helvetica","italic"),t.text("Generated by Squares Billing System",i/2,n-10,{align:"center"}),t.output("blob")}catch(s){const e=new z({orientation:"portrait",unit:"mm",format:"a4"}),t=e.internal.pageSize.getWidth();return e.internal.pageSize.getHeight(),e.setFontSize(16),e.setFont("helvetica","bold"),e.text("BILLING REPORT",t/2,40,{align:"center"}),e.setFontSize(12),e.setFont("helvetica","normal"),e.text("Error generating detailed report.",20,60),e.text("Please try again later.",20,70),e.output("blob")}}async generateBillingReportExcel(e={}){try{const[t,s,a]=await Promise.all([this.getPayments({...e,limit:1e3}),this.getInvoices({...e,limit:1e3}),this.getBillingStats()]),i=t.payments.map((e,t)=>({"#":t+1,"Payment ID":e._id?.slice(-8)||"N/A","Transaction ID":e.transactionId||"N/A",Date:U.formatDate(e.createdAt),Description:e.description||"Subscription Payment",Amount:e.amount,Currency:e.currency,Status:e.status.toUpperCase(),"Payment Method":e.paymentMethod.replace("_"," ").toUpperCase(),Gateway:e.paymentGateway||"N/A","Paid At":e.paidAt?U.formatDate(e.paidAt):"N/A","Failure Reason":e.failureReason||"N/A"})),n=s.invoices.map((e,t)=>({"#":t+1,"Invoice Number":e.invoiceNumber,"Issue Date":U.formatDate(e.issueDate),"Due Date":U.formatDate(e.dueDate),"Paid Date":e.paidDate?U.formatDate(e.paidDate):"N/A",Amount:e.amount,Currency:e.currency,Status:e.status.toUpperCase(),"Vendor Name":e.vendorDetails.name||"N/A","Vendor Email":e.vendorDetails.email||"N/A","Vendor GST":e.vendorDetails.gst||"N/A"})),r=[{Metric:"Total Revenue",Value:a.totalRevenue,Formatted:U.formatCurrency(a.totalRevenue)},{Metric:"Monthly Revenue",Value:a.monthlyRevenue,Formatted:U.formatCurrency(a.monthlyRevenue)},{Metric:"Active Subscriptions",Value:a.activeSubscriptions,Formatted:a.activeSubscriptions.toString()},{Metric:"Total Invoices",Value:a.totalInvoices,Formatted:a.totalInvoices.toString()},{Metric:"Paid Invoices",Value:a.paidInvoices,Formatted:a.paidInvoices.toString()},{Metric:"Overdue Invoices",Value:a.overdueInvoices,Formatted:a.overdueInvoices.toString()},{Metric:"Next Billing Amount",Value:a.nextBillingAmount,Formatted:U.formatCurrency(a.nextBillingAmount)},{Metric:"Next Billing Date",Value:a.nextBillingDate,Formatted:U.formatDate(a.nextBillingDate)},{Metric:"Subscription Status",Value:a.subscriptionStatus,Formatted:a.subscriptionStatus.toUpperCase()}],l=[];a.usageStats&&l.push({Resource:"Properties",Used:a.usageStats.properties.used,Limit:a.usageStats.properties.limit,"Usage %":Math.round(a.usageStats.properties.used/a.usageStats.properties.limit*100)},{Resource:"Leads",Used:a.usageStats.leads.used,Limit:a.usageStats.leads.limit,"Usage %":Math.round(a.usageStats.leads.used/a.usageStats.leads.limit*100)},{Resource:"Messages",Used:a.usageStats.messages.used,Limit:a.usageStats.messages.limit,"Usage %":Math.round(a.usageStats.messages.used/a.usageStats.messages.limit*100)});const c=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),o={filename:"billing-report",title:"Vendor Billing Report",metadata:{"Report Generated":c,Period:e.dateFrom&&e.dateTo?`${U.formatDate(e.dateFrom)} - ${U.formatDate(e.dateTo)}`:"All Time","Generated By":"BuildHomeMartSquares Vendor Portal","Total Payments":i.length.toString(),"Total Invoices":n.length.toString(),"Report Type":"Comprehensive Billing Summary"}},d=[{name:"Summary",data:r,columns:[{wch:25},{wch:15},{wch:20}]},{name:"Payments",data:i,columns:[{wch:5},{wch:15},{wch:15},{wch:12},{wch:25},{wch:12},{wch:10},{wch:12},{wch:15},{wch:10},{wch:12},{wch:20}]},{name:"Invoices",data:n,columns:[{wch:5},{wch:15},{wch:12},{wch:12},{wch:12},{wch:12},{wch:10},{wch:12},{wch:20},{wch:20},{wch:15}]}];l.length>0&&d.push({name:"Usage Statistics",data:l,columns:[{wch:20},{wch:10},{wch:10},{wch:15}]});const m=U.generateWorkbook(o,d),u=U.writeWorkbookToBuffer(m);return new Blob([u],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})}catch(t){throw new Error("Failed to generate Excel billing report")}}},q=()=>{const z=t(),T=E(),[L,q]=s.useState(!0),[G,W]=s.useState(null),[H,Y]=s.useState([]),[J,Q]=s.useState([]),[K,X]=s.useState(null),[Z,ee]=s.useState("last_30_days"),[te,se]=s.useState("overview"),[ae,ie]=s.useState(null),[ne,re]=s.useState(null),[le,ce]=s.useState(!1),[oe,de]=s.useState(!1),[me,ue]=s.useState(!1);s.useEffect(()=>{he()},[Z]);const xe=e=>{const t={last_7_days:7,last_30_days:30,last_90_days:90,last_year:365}[e]||30;return new Date((new Date).getTime()-24*t*60*60*1e3).toISOString().split("T")[0]},he=async()=>{try{q(!0);const[e,t,s,a]=await Promise.all([O.getCurrentSubscription(),O.getPayments({page:1,limit:20,dateFrom:xe(Z)}),O.getInvoices({page:1,limit:10}),O.getBillingStats()]);W(e),Y(t.payments||[]),Q(s.invoices||[]),X(a)}catch(e){a({title:"Error",description:"Failed to load billing information. Please try again.",variant:"destructive"})}finally{q(!1)}},pe=t=>{switch(t){case"completed":case"active":case"paid":return e.jsx(A,{className:"w-4 h-4 text-green-600"});case"pending":case"sent":return e.jsx($,{className:"w-4 h-4 text-yellow-600"});case"failed":return e.jsx(_,{className:"w-4 h-4 text-red-600"});case"cancelled":case"expired":case"overdue":return e.jsx(C,{className:"w-4 h-4 text-red-600"});default:return e.jsx(_,{className:"w-4 h-4 text-gray-600"})}},ge=e=>{switch(e){case"completed":case"active":case"paid":return"bg-green-100 text-green-800";case"pending":case"sent":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},ve=(e,t="INR")=>`₹${e.toLocaleString("en-IN")}`,fe=e=>new Date(e).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),ye=async e=>{try{const t=await O.downloadReceipt(e._id);t?(O.downloadBlob(t,`receipt-${e._id.slice(-8)}.pdf`),a({title:"Success",description:"Payment receipt downloaded successfully."})):a({title:"Error",description:"Failed to generate receipt. No data received.",variant:"destructive"})}catch(t){a({title:"Error",description:"Failed to download receipt. Please try again.",variant:"destructive"})}},je=async e=>{try{const t=await O.downloadInvoice(e._id);t?(O.downloadBlob(t,`invoice-${e.invoiceNumber}.pdf`),a({title:"Success",description:`Invoice ${e.invoiceNumber} downloaded successfully.`})):a({title:"Error",description:`Failed to generate invoice ${e.invoiceNumber}. No data received.`,variant:"destructive"})}catch(t){a({title:"Error",description:`Failed to download invoice ${e.invoiceNumber}. Please try again.`,variant:"destructive"})}};return L?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{children:"Loading billing information..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(n,{open:le,onOpenChange:ce,children:e.jsxs(r,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(l,{children:[e.jsx(c,{children:"Payment Details"}),e.jsx(o,{children:"Complete information about this payment transaction"})]}),me?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(i,{className:"h-6 w-6 animate-spin"})}):ae?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Payment ID"}),e.jsx("p",{className:"font-medium",children:ae._id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Transaction ID"}),e.jsx("p",{className:"font-medium",children:ae.transactionId||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Amount"}),e.jsx("p",{className:"font-medium text-lg",children:ve(ae.amount,ae.currency)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(d,{className:ge(ae.status),children:ae.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Payment Method"}),e.jsx("p",{className:"font-medium capitalize",children:ae.paymentMethod.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Payment Gateway"}),e.jsx("p",{className:"font-medium capitalize",children:ae.paymentGateway})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Created At"}),e.jsx("p",{className:"font-medium",children:fe(ae.createdAt)})]}),ae.paidAt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Paid At"}),e.jsx("p",{className:"font-medium",children:fe(ae.paidAt)})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Description"}),e.jsx("p",{className:"font-medium",children:ae.description})]}),ae.failureReason&&e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Failure Reason"}),e.jsx("p",{className:"text-sm text-red-800",children:ae.failureReason})]}),e.jsx("div",{className:"flex gap-2 pt-4",children:e.jsxs(m,{onClick:()=>ye(ae),className:"w-full",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Download Receipt"]})})]}):e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"No payment details available"})]})}),e.jsx(n,{open:oe,onOpenChange:de,children:e.jsxs(r,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(l,{children:[e.jsx(c,{children:"Invoice Details"}),e.jsx(o,{children:"Complete information about this invoice"})]}),me?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(i,{className:"h-6 w-6 animate-spin"})}):ne?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Invoice Number"}),e.jsx("p",{className:"font-medium text-lg",children:ne.invoiceNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(d,{className:ge(ne.status),children:ne.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Issue Date"}),e.jsx("p",{className:"font-medium",children:fe(ne.issueDate)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Due Date"}),e.jsx("p",{className:"font-medium",children:fe(ne.dueDate)})]}),ne.paidDate&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Paid Date"}),e.jsx("p",{className:"font-medium",children:fe(ne.paidDate)})]})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Vendor Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Name:"})," ",ne.vendorDetails.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Email:"})," ",ne.vendorDetails.email]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Phone:"})," ",ne.vendorDetails.phone]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Address:"})," ",ne.vendorDetails.address]}),ne.vendorDetails.gst&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"GST:"})," ",ne.vendorDetails.gst]})]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Description"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Qty"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Unit Price"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Total"})]})}),e.jsx("tbody",{children:ne.items.map((t,s)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-3 text-sm",children:t.description}),e.jsx("td",{className:"p-3 text-sm text-right",children:t.quantity}),e.jsx("td",{className:"p-3 text-sm text-right",children:ve(t.unitPrice,ne.currency)}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:ve(t.total,ne.currency)})]},s))}),e.jsx("tfoot",{className:"border-t-2",children:e.jsxs("tr",{className:"border-t bg-muted",children:[e.jsx("td",{colSpan:3,className:"p-3 text-base text-right font-bold",children:"Total"}),e.jsx("td",{className:"p-3 text-base text-right font-bold",children:ve(ne.amount,ne.currency)})]})})]})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(m,{onClick:()=>je(ne),className:"w-full",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Download PDF"]})})]}):e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"No invoice details available"})]})}),e.jsxs("div",{className:"flex "+(T?"flex-col space-y-4":"justify-between items-center"),children:[e.jsxs("div",{children:[e.jsx("h1",{className:(T?"text-2xl":"text-3xl")+" font-bold tracking-tight",children:"Billing & Payments"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your subscription and payment history"})]}),e.jsxs("div",{className:"flex "+(T?"flex-col space-y-2":"gap-2"),children:[e.jsxs(u,{value:Z,onValueChange:ee,children:[e.jsx(x,{className:""+(T?"w-full":"w-40"),children:e.jsx(h,{placeholder:"Select period"})}),e.jsxs(p,{children:[e.jsx(g,{value:"last_7_days",children:"Last 7 days"}),e.jsx(g,{value:"last_30_days",children:"Last 30 days"}),e.jsx(g,{value:"last_90_days",children:"Last 90 days"}),e.jsx(g,{value:"last_year",children:"Last year"})]})]}),e.jsxs(m,{variant:"outline",onClick:async()=>{try{const[e,t,s]=await Promise.all([O.getPayments({dateFrom:xe(Z),limit:100}),O.getInvoices({limit:100}),O.getBillingStats()]),i=e.payments.map((e,t)=>({"#":t+1,"Payment ID":e._id?.slice(-8)||"N/A","Transaction ID":e.transactionId||"N/A",Date:U.formatDate(e.createdAt),Description:e.description||"Subscription Payment",Amount:`₹${e.amount}`,Currency:e.currency,Status:e.status.toUpperCase(),"Payment Method":e.paymentMethod.replace("_"," ").toUpperCase(),Gateway:e.paymentGateway||"N/A","Paid At":e.paidAt?U.formatDate(e.paidAt):"N/A","Failure Reason":e.failureReason||"N/A"})),n=t.invoices.map((e,t)=>({"#":t+1,"Invoice Number":e.invoiceNumber,"Issue Date":U.formatDate(e.issueDate),"Due Date":U.formatDate(e.dueDate),"Paid Date":e.paidDate?U.formatDate(e.paidDate):"N/A",Amount:`₹${e.amount}`,Currency:e.currency,Status:e.status.toUpperCase(),"Vendor Name":e.vendorDetails.name||"N/A","Vendor Email":e.vendorDetails.email||"N/A","Vendor GST":e.vendorDetails.gst||"N/A"})),r=[{Metric:"Total Revenue",Value:`₹${s.totalRevenue}`},{Metric:"Monthly Revenue",Value:`₹${s.monthlyRevenue}`},{Metric:"Active Subscriptions",Value:s.activeSubscriptions},{Metric:"Total Invoices",Value:s.totalInvoices},{Metric:"Paid Invoices",Value:s.paidInvoices},{Metric:"Overdue Invoices",Value:s.overdueInvoices},{Metric:"Next Billing Amount",Value:`₹${s.nextBillingAmount}`},{Metric:"Next Billing Date",Value:U.formatDate(s.nextBillingDate)},{Metric:"Subscription Status",Value:s.subscriptionStatus.toUpperCase()}],l=[];s.usageStats&&l.push({Resource:"Properties",Used:s.usageStats.properties.used,Limit:-1===s.usageStats.properties.limit||null===s.usageStats.properties.limit?"∞":s.usageStats.properties.limit,"Usage %":-1===s.usageStats.properties.limit||null===s.usageStats.properties.limit?"Unlimited":`${Math.round(s.usageStats.properties.used/s.usageStats.properties.limit*100)}%`},{Resource:"Leads",Used:s.usageStats.leads.used,Limit:-1===s.usageStats.leads.limit||null===s.usageStats.leads.limit?"∞":s.usageStats.leads.limit,"Usage %":-1===s.usageStats.leads.limit||null===s.usageStats.leads.limit?"Unlimited":`${Math.round(s.usageStats.leads.used/s.usageStats.leads.limit*100)}%`},{Resource:"Messages",Used:s.usageStats.messages.used,Limit:-1===s.usageStats.messages.limit||null===s.usageStats.messages.limit?"∞":s.usageStats.messages.limit,"Usage %":-1===s.usageStats.messages.limit||null===s.usageStats.messages.limit?"Unlimited":`${Math.round(s.usageStats.messages.used/s.usageStats.messages.limit*100)}%`});const c=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),o=Z.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),d={filename:`vendor-billing-report-${Z}`,title:"Vendor Billing Report",metadata:{"Report Generated":c,Period:o,"Generated By":"BuildHomeMartSquares Vendor Portal","Total Payments":i.length.toString(),"Total Invoices":n.length.toString(),"Report Type":"Comprehensive Billing Summary"}},m=[{name:"Summary",data:r,columns:[{wch:25},{wch:20}]},{name:"Payments",data:i,columns:[{wch:5},{wch:15},{wch:15},{wch:12},{wch:25},{wch:12},{wch:10},{wch:12},{wch:15},{wch:10},{wch:12},{wch:20}]},{name:"Invoices",data:n,columns:[{wch:5},{wch:15},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:10},{wch:12},{wch:20},{wch:20},{wch:15}]}];l.length>0&&m.push({name:"Usage Statistics",data:l,columns:[{wch:20},{wch:10},{wch:10},{wch:15}]}),U.generateExcelReport(d,m),a({title:"Export Successful",description:"Billing report exported to Excel successfully!"})}catch(e){a({title:"Export Failed",description:"Failed to export billing report to Excel. Please try again.",variant:"destructive"})}},className:""+(T?"w-full h-11":"h-9"),children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Export Excel"]})]})]}),K&&e.jsxs("div",{className:"grid gap-4 "+(T?"grid-cols-2":"grid-cols-1 md:grid-cols-4"),children:[e.jsx(v,{children:e.jsxs(f,{className:(T?"p-3":"p-4")+" text-center",children:[e.jsx("div",{className:(T?"text-lg":"text-2xl")+" font-bold text-blue-600",children:ve(K.totalRevenue)}),e.jsx("div",{className:(T?"text-xs":"text-sm")+" text-muted-foreground",children:"Total Revenue"})]})}),e.jsx(v,{children:e.jsxs(f,{className:(T?"p-3":"p-4")+" text-center",children:[e.jsx("div",{className:(T?"text-lg":"text-2xl")+" font-bold text-green-600",children:ve(K.nextBillingAmount)}),e.jsx("div",{className:(T?"text-xs":"text-sm")+" text-muted-foreground",children:"Next Payment"})]})}),e.jsx(v,{children:e.jsxs(f,{className:(T?"p-3":"p-4")+" text-center",children:[e.jsx("div",{className:(T?"text-lg":"text-2xl")+" font-bold text-purple-600",children:K.totalInvoices}),e.jsx("div",{className:(T?"text-xs":"text-sm")+" text-muted-foreground",children:"Total Invoices"})]})}),e.jsx(v,{children:e.jsxs(f,{className:(T?"p-3":"p-4")+" text-center",children:[e.jsx("div",{className:(T?"text-lg":"text-2xl")+" font-bold text-orange-600",children:G?ve(G.amount):"₹0"}),e.jsx("div",{className:(T?"text-xs":"text-sm")+" text-muted-foreground",children:"Monthly Cost"})]})})]}),e.jsxs(y,{value:te,onValueChange:se,className:"space-y-6",children:[e.jsxs(j,{children:[e.jsx(N,{value:"overview",children:"Overview"}),e.jsx(N,{value:"payments",children:"Payment History"}),e.jsx(N,{value:"invoices",children:"Invoices"}),e.jsx(N,{value:"usage",children:"Usage Stats"})]}),e.jsxs(w,{value:"overview",className:"space-y-6",children:[e.jsxs(v,{children:[e.jsx(S,{children:e.jsxs(b,{className:"flex items-center",children:[e.jsx(D,{className:"w-5 h-5 mr-2"}),"Current Subscription"]})}),e.jsx(f,{children:G?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:G.plan?.name||"N/A"}),e.jsxs("p",{className:"text-muted-foreground",children:["monthly"===G.billingCycle?"Monthly":"Yearly"," Plan"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[pe(G.status),e.jsx(d,{className:ge(G.status),children:G.status.charAt(0).toUpperCase()+G.status.slice(1)})]})]}),e.jsxs("div",{className:"grid gap-4 "+(T?"grid-cols-1":"grid-cols-1 md:grid-cols-3"),children:[e.jsxs("div",{children:[e.jsx("p",{className:(T?"text-xs":"text-sm")+" text-muted-foreground",children:"Monthly Cost"}),e.jsx("p",{className:(T?"text-base":"text-lg")+" font-semibold",children:ve(G.amount,G.currency)})]}),e.jsxs("div",{children:[e.jsx("p",{className:(T?"text-xs":"text-sm")+" text-muted-foreground",children:"Next Billing Date"}),e.jsx("p",{className:(T?"text-base":"text-lg")+" font-semibold",children:fe(G.nextBillingDate)})]}),e.jsxs("div",{children:[e.jsx("p",{className:(T?"text-xs":"text-sm")+" text-muted-foreground",children:"Auto Renewal"}),e.jsx("p",{className:(T?"text-base":"text-lg")+" font-semibold",children:G.autoRenew?"Enabled":"Disabled"})]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("div",{className:"flex "+(T?"flex-col space-y-2":"gap-2"),children:[e.jsx(m,{variant:"outline",onClick:()=>z("/vendor/subscription-plans"),className:""+(T?"w-full h-11":""),children:"Change Plan"}),e.jsx(m,{variant:"outline",onClick:()=>z("/vendor/subscription-manager"),className:""+(T?"w-full h-11":""),children:"Manage Subscription"})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(D,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Active Subscription"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Choose a plan to get started with our services"}),e.jsxs(m,{onClick:()=>z("/vendor/subscription-plans"),children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Choose Plan"]})]})})]}),e.jsxs(v,{children:[e.jsx(S,{children:e.jsxs(b,{className:"flex items-center",children:[e.jsx(k,{className:"w-5 h-5 mr-2"}),"Recent Transactions"]})}),e.jsx(f,{children:H&&H.length>0?e.jsx("div",{className:"space-y-4",children:H.slice(0,5).map((t,s)=>e.jsxs("div",{className:`flex ${T?"flex-col space-y-3":"items-center justify-between"} p-4 border rounded-lg`,children:[e.jsxs("div",{className:"flex "+(T?"flex-col space-y-2":"items-center space-x-4"),children:[e.jsx("div",{className:"p-2 bg-muted rounded-full",children:e.jsx(V,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:""+(T?"text-sm":"font-medium"),children:t?.description||"Subscription Payment"}),e.jsxs("p",{className:(T?"text-xs":"text-sm")+" text-muted-foreground",children:[t?.paymentMethod||"Credit Card"," • ",t?.createdAt?fe(t.createdAt):"N/A"]})]})]}),e.jsxs("div",{className:""+(T?"text-left":"text-right"),children:[e.jsxs("div",{className:"flex "+(T?"justify-between items-center":"items-center space-x-2"),children:[pe(t?.status||"pending"),e.jsx("span",{className:""+(T?"text-sm":"font-semibold"),children:ve(t?.amount||0,t?.currency||"INR")})]}),e.jsx(d,{className:`text-xs ${ge(t?.status||"pending")}`,children:t?.status||"pending"})]})]},t?._id||`payment-${s}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(V,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No transactions found"})]})})]})]}),e.jsx(w,{value:"payments",className:"space-y-4",children:e.jsxs(v,{children:[e.jsx(S,{children:e.jsx(b,{children:"Payment History"})}),e.jsx(f,{children:H&&H.length>0?e.jsx("div",{className:"space-y-4",children:H.map((t,s)=>e.jsxs("div",{className:`flex ${T?"flex-col space-y-3":"items-center justify-between"} p-4 border rounded-lg hover:shadow-sm transition-shadow`,children:[e.jsxs("div",{className:"flex "+(T?"flex-col space-y-2":"items-center space-x-4"),children:[e.jsx("div",{className:"p-2 bg-muted rounded-full",children:e.jsx(V,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:""+(T?"text-sm":"font-medium"),children:t?.description||"Subscription Payment"}),e.jsxs("p",{className:(T?"text-xs":"text-sm")+" text-muted-foreground",children:["Payment ID: ",t?._id?.slice(-8)||"N/A"]}),e.jsx("p",{className:(T?"text-xs":"text-sm")+" text-muted-foreground",children:t?.createdAt?fe(t.createdAt):"N/A"}),("failed"===t.status||"refunded"===t.status)&&t.failureReason&&e.jsx("p",{className:"text-xs text-red-600 mt-1 max-w-md",children:t.failureReason.includes("timeout")||t.failureReason.includes("exceeded")?"⏱️ Payment expired - exceeded 15-minute time limit":`❌ ${t.failureReason}`})]})]}),e.jsxs("div",{className:""+(T?"text-left":"text-right"),children:[e.jsxs("div",{className:`flex ${T?"justify-between items-center":"items-center space-x-2"} mb-1`,children:[pe(t.status),e.jsx("span",{className:""+(T?"text-sm":"font-semibold"),children:ve(t.amount,t.currency)})]}),e.jsx(d,{className:`text-xs ${ge(t.status)}`,children:t.status}),e.jsxs("div",{className:`flex ${T?"flex-col space-y-2":"space-x-2"} mt-2`,children:[e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>(async e=>{ue(!0),ce(!0);try{const t=await O.getPaymentDetails(e);t&&ie(t)}catch(t){ce(!1)}finally{ue(!1)}})(t._id),className:""+(T?"w-full h-9":""),children:[e.jsx(F,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>ye(t),className:""+(T?"w-full h-9":""),children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"Receipt"]})]})]})]},t?._id||`payment-full-${s}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(V,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Payment History"}),e.jsx("p",{className:"text-muted-foreground",children:"Your payment history will appear here"})]})})]})}),e.jsx(w,{value:"invoices",className:"space-y-4",children:e.jsxs(v,{children:[e.jsx(S,{children:e.jsxs(b,{className:"flex "+(T?"flex-col space-y-2":"items-center justify-between"),children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(I,{className:"w-5 h-5 mr-2"}),"Invoices"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:async()=>{try{for(const e of J)await je(e),await new Promise(e=>setTimeout(e,500));a({title:"Success",description:`Downloaded ${J.length} invoices`})}catch(e){}},className:""+(T?"w-full h-9":""),children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Download All"]})]})}),e.jsx(f,{children:J&&J.length>0?e.jsx("div",{className:"space-y-4",children:J.map((t,s)=>e.jsxs("div",{className:`flex ${T?"flex-col space-y-3":"items-center justify-between"} p-4 border rounded-lg hover:shadow-sm transition-shadow`,children:[e.jsxs("div",{className:"flex "+(T?"flex-col space-y-2":"items-center space-x-4"),children:[e.jsx("div",{className:"p-2 bg-muted rounded-full",children:e.jsx(I,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsxs("p",{className:""+(T?"text-sm":"font-medium"),children:["Invoice #",t?.invoiceNumber||"N/A"]}),e.jsxs("p",{className:(T?"text-xs":"text-sm")+" text-muted-foreground",children:["Issued: ",t?.issueDate?fe(t.issueDate):"N/A"]}),e.jsxs("p",{className:(T?"text-xs":"text-sm")+" text-muted-foreground",children:["Due: ",fe(t.dueDate)]})]})]}),e.jsxs("div",{className:""+(T?"text-left":"text-right"),children:[e.jsxs("div",{className:`flex ${T?"justify-between items-center":"items-center space-x-2"} mb-1`,children:[pe(t.status),e.jsx("span",{className:""+(T?"text-sm":"font-semibold"),children:ve(t.amount,t.currency)})]}),e.jsx(d,{className:`text-xs ${ge(t.status)}`,children:t.status}),e.jsxs("div",{className:`flex ${T?"flex-col space-y-2":"space-x-2"} mt-2`,children:[e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>(async e=>{ue(!0),de(!0);try{const t=await O.getInvoiceDetails(e);t&&re(t)}catch(t){de(!1)}finally{ue(!1)}})(t._id),className:""+(T?"w-full h-9":""),children:[e.jsx(F,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>je(t),className:""+(T?"w-full h-9":""),children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"Download"]})]})]})]},t?._id||`invoice-${s}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(I,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Invoices"}),e.jsx("p",{className:"text-muted-foreground",children:"Your invoices will appear here"})]})})]})}),e.jsx(w,{value:"usage",className:"space-y-4",children:e.jsxs(v,{children:[e.jsx(S,{children:e.jsxs(b,{className:"flex items-center",children:[e.jsx(R,{className:"w-5 h-5 mr-2"}),"Usage Statistics"]})}),e.jsx(f,{children:K?.usageStats?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 "+(T?"grid-cols-1":"grid-cols-1 md:grid-cols-3"),children:[e.jsxs("div",{className:(T?"p-3":"p-4")+" border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:(T?"text-xs":"text-sm")+" font-medium",children:"Properties"}),e.jsxs("p",{className:(T?"text-xs":"text-sm")+" text-muted-foreground",children:[K?.usageStats?.properties?.used||0," / ",-1===K?.usageStats?.properties?.limit||null===K?.usageStats?.properties?.limit?"∞":K?.usageStats?.properties?.limit||0]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${-1===K?.usageStats?.properties?.limit||null===K?.usageStats?.properties?.limit?100:Math.min((K?.usageStats?.properties?.used||0)/(K?.usageStats?.properties?.limit||1)*100,100)}%`}})})]}),e.jsxs("div",{className:(T?"p-3":"p-4")+" border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:(T?"text-xs":"text-sm")+" font-medium",children:"Leads"}),e.jsxs("p",{className:(T?"text-xs":"text-sm")+" text-muted-foreground",children:[K?.usageStats?.leads?.used||0," / ",-1===K?.usageStats?.leads?.limit||null===K?.usageStats?.leads?.limit?"∞":K?.usageStats?.leads?.limit||0]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${-1===K?.usageStats?.leads?.limit||null===K?.usageStats?.leads?.limit?100:Math.min((K?.usageStats?.leads?.used||0)/(K?.usageStats?.leads?.limit||1)*100,100)}%`}})})]}),e.jsxs("div",{className:(T?"p-3":"p-4")+" border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:(T?"text-xs":"text-sm")+" font-medium",children:"Messages"}),e.jsxs("p",{className:(T?"text-xs":"text-sm")+" text-muted-foreground",children:[K?.usageStats?.messages?.used||0," / ",-1===K?.usageStats?.messages?.limit||null===K?.usageStats?.messages?.limit?"∞":K?.usageStats?.messages?.limit||0]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${-1===K?.usageStats?.messages?.limit||null===K?.usageStats?.messages?.limit?100:Math.min((K?.usageStats?.messages?.used||0)/(K?.usageStats?.messages?.limit||1)*100,100)}%`}})})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("p",{className:(T?"text-xs":"text-sm")+" text-muted-foreground mb-4",children:["Usage resets on your billing cycle date: ",K.nextBillingDate]}),e.jsx(m,{variant:"outline",onClick:()=>z("/vendor/subscription-manager"),className:""+(T?"w-full h-11":""),children:"Upgrade Plan"})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(R,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Usage Data"}),e.jsx("p",{className:"text-muted-foreground",children:"Usage statistics will appear here"})]})})]})})]})]})};export{q as default};

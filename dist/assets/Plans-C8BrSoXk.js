import{j as e}from"./ui-s1SEoZIF.js";import{d as s,r as a}from"./router-D8v2YSKU.js";import{u as i,a5 as r,J as n,f as t,ac as l,a as c,b as o,c as d,d as m,e as p,a2 as x,I as h,a0 as u,B as j}from"./index-l5vY_naC.js";import{u as f}from"./usePagination-1Z845fFX.js";import{P as g,a as v,b as N,c as b,d as P,e as y}from"./pagination-C5WMbI05.js";import{p as C}from"./planService-RaBFlDtU.js";import{D as w}from"./DataTable-3KtdMbos.js";import{P as A}from"./PriceRangeFilter-zcH3Wx62.js";import"./vendor-BxThA0WO.js";import"./ellipsis-ClvvvtMR.js";import"./table-S99XbycI.js";import"./square-pen-Czw89hhB.js";import"./slider-CrJBzY96.js";const S=()=>{const S=s(),{user:k}=i(),{toast:M}=r(),D=k?.rolePermissions||[],E="admin"===k?.role||"superadmin"===k?.role,I=e=>D.includes(e),L=E||I(u.PLANS_READ),F=E||I(u.PLANS_CREATE),_=E||I(u.PLANS_EDIT),[R,T]=a.useState(""),[B,$]=a.useState(""),[q,J]=a.useState(""),[V,Y]=a.useState(""),[Z,z]=a.useState(1e5),[G,H]=a.useState([]),[K,O]=a.useState(!0);a.useEffect(()=>{L||(M({title:"Access Denied",description:"You don't have permission to view plans.",variant:"destructive"}),S("/rolebased"))},[L,S,M]),a.useEffect(()=>{(async()=>{try{const e=await C.getPlans({limit:1e3});if(e.success){H(e.data.plans);const s=Math.max(...e.data.plans.map(e=>e.price),0);z(s||1e5)}}catch(e){}finally{O(!1)}})()},[]);const Q=a.useMemo(()=>G.filter(e=>{const s=e.name.toLowerCase().includes(R.toLowerCase()),a=""===B||void 0!==e.billingCycleMonths&&e.billingCycleMonths===parseInt(B),i=""===q||e.price>=parseFloat(q),r=""===V||e.price<=parseFloat(V);return s&&a&&i&&r}),[G,R,B,q,V]),{paginatedItems:U,currentPage:W,totalPages:X,goToPage:ee,nextPage:se,previousPage:ae}=f(Q,10),ie=[{key:"name",label:"Plan Name",render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.description.substring(0,50),"..."]})]})},{key:"price",label:"Price",render:s=>e.jsx("span",{className:"font-semibold",children:C.formatPrice(s)})},{key:"features",label:"Features",render:s=>{const a=Array.isArray(s.features)?s.features.map(e=>"string"==typeof e?e:e.name):[];return e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,2).map((s,a)=>e.jsx(j,{variant:"secondary",className:"text-xs",children:s},a)),a.length>2&&e.jsxs(j,{variant:"secondary",className:"text-xs",children:["+",a.length-2]})]})}},{key:"subscriberCount",label:"Subscribers",render:s=>e.jsx("span",{className:"font-medium",children:s.subscriberCount||0})},{key:"isActive",label:"Status",render:s=>e.jsx(j,{variant:C.getPlanBadgeVariant(s),children:s.isActive?"Active":"Inactive"})}];return K?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(n,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading plans..."})]}):e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"dashboard-header-responsive",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"dashboard-title-responsive",children:"Plan Management"}),e.jsx("p",{className:"text-muted-foreground mt-1 md:mt-2 text-sm md:text-base",children:"Manage subscription plans and pricing"})]}),F&&e.jsxs(t,{onClick:()=>S("/admin/plans/create"),className:"w-full sm:w-auto",children:[e.jsx(l,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Create Plan"}),e.jsx("span",{className:"sm:hidden",children:"Create"})]})]}),e.jsxs(c,{children:[e.jsxs(o,{children:[e.jsx(d,{className:"text-lg md:text-xl",children:"All Plans"}),e.jsxs(m,{className:"text-sm md:text-base",children:[Q.length," plan",1!==Q.length?"s":""," found"]})]}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(x,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(h,{placeholder:"Search plans...",value:R,onChange:e=>T(e.target.value),className:"pl-10"})]}),e.jsx("div",{className:"flex-1",children:e.jsx(h,{placeholder:"Filter by months (e.g., 1, 12)",value:B,onChange:e=>$(e.target.value)})})]})}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-2 lg:w-80",children:e.jsx(A,{minPrice:q,maxPrice:V,onMinPriceChange:J,onMaxPriceChange:Y,maxPossiblePrice:Z,currency:"INR"})})]}),e.jsx("div",{className:"table-responsive-wrapper",children:e.jsx(w,{columns:ie,data:U.map(e=>({...e,id:e._id})),editPath:_?e=>`/admin/plans/edit/${e._id}`:void 0,hideDefaultActions:!_})}),X>1&&e.jsx("div",{className:"mt-4 md:mt-6",children:e.jsx(g,{children:e.jsxs(v,{className:"pagination-responsive",children:[e.jsx(N,{children:e.jsx(b,{onClick:ae,className:"pagination-button-responsive "+(1===W?"pointer-events-none opacity-50":"cursor-pointer")})}),Array.from({length:X},(e,s)=>s+1).map(s=>e.jsx(N,{children:e.jsx(P,{onClick:()=>ee(s),isActive:W===s,className:"pagination-button-responsive cursor-pointer",children:s})},s)),e.jsx(N,{children:e.jsx(y,{onClick:se,className:"pagination-button-responsive "+(W===X?"pointer-events-none opacity-50":"cursor-pointer")})})]})})})]})})]})]})};export{S as default};

import{j as e}from"./ui-DHQhougw.js";import{r as s}from"./router-Bi51YGN-.js";import{R as r,V as a,W as t,Y as n,Z as o,L as l,I as i,f as d,E as c,a1 as m,Q as w,t as h}from"./index-D7KzNfIb.js";import{A as u,a as x}from"./alert-CmRZT_SV.js";import{I as p,a as j,b as g}from"./input-otp-QOAD9Y-G.js";import{K as f}from"./key-BCWL2kLY.js";import{T as P}from"./triangle-alert-B6835OBl.js";import{E as N}from"./eye-off-BhAYBzhN.js";import{S as y}from"./shield-DZma8h3a.js";const b=({open:b,onOpenChange:v,onSuccess:C})=>{const[S,O]=s.useState({currentPassword:"",newPassword:"",confirmPassword:"",otp:""}),[F,T]=s.useState("currentPassword"),[k,V]=s.useState(!1),[E,z]=s.useState([]),[W,A]=s.useState(!1),[R,q]=s.useState(5),[M,Y]=s.useState({current:!1,new:!1,confirm:!1}),Z=e=>{const s=[];return e.length<8&&s.push("At least 8 characters"),/[A-Z]/.test(e)||s.push("One uppercase letter"),/[a-z]/.test(e)||s.push("One lowercase letter"),/\d/.test(e)||s.push("One number"),/[!@#$%^&*(),.?":{}|<>]/.test(e)||s.push("One special character"),s},$=()=>S.currentPassword.length>0,I=()=>S.newPassword.length>=8&&S.newPassword===S.confirmPassword&&0===Z(S.newPassword).length&&S.currentPassword!==S.newPassword,L=async()=>{if("currentPassword"===F){if(!$())return;try{V(!0),z([]);const e=await w.requestPasswordChangeOTP(S.currentPassword);e.success&&(T("otp"),A(!0),q(e.expiryMinutes||5),h({title:"OTP Sent",description:"Verification code sent to your email"}))}catch(e){z([e.message||"Failed to send OTP"])}finally{V(!1)}}else if("otp"===F){if(!S.otp.trim())return void z(["Please enter the OTP"]);T("newPassword"),z([]),h({title:"OTP Verified",description:"Now set your new password"})}else if("newPassword"===F){if(!I())return;try{V(!0),z([]);const e=await w.changePasswordWithOTP(S.otp,S.newPassword);if(!e.success)throw new Error(e.message||"Failed to change password");h({title:"âœ… Password Changed Successfully",description:"Your password has been updated securely."}),O({currentPassword:"",newPassword:"",confirmPassword:"",otp:""}),T("currentPassword"),A(!1),v(!1),C?.(),h({title:"ðŸ“§ Confirmation Sent",description:"Password change confirmation sent to your email."})}catch(e){const s=e.message||"Failed to change password";s.includes("Current password is incorrect")?z(["Your current password is incorrect. Please try again."]):s.includes("same as current")?z(["New password must be different from your current password."]):(s.includes("OTP"),z([s])),h({title:"âŒ Password Change Failed",description:s,variant:"destructive"})}finally{V(!1)}}},Q=(e=>{let s=0;return e.length>=8&&s++,/[A-Z]/.test(e)&&s++,/[a-z]/.test(e)&&s++,/\d/.test(e)&&s++,/[!@#$%^&*(),.?":{}|<>]/.test(e)&&s++,5===s?{score:s,label:"Very Strong",color:"text-green-600"}:s>=4?{score:s,label:"Strong",color:"text-green-500"}:s>=3?{score:s,label:"Medium",color:"text-yellow-500"}:s>=2?{score:s,label:"Weak",color:"text-orange-500"}:{score:s,label:"Very Weak",color:"text-red-500"}})(S.newPassword),H=Z(S.newPassword);return e.jsx(r,{open:b,onOpenChange:v,children:e.jsxs(a,{className:"sm:max-w-md",children:[e.jsxs(t,{children:[e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5"}),"currentPassword"===F?"Change Password":"otp"===F?"Verify Email":"Set New Password"]}),e.jsx(o,{children:"currentPassword"===F?"Enter your current password to proceed.":"otp"===F?"We've sent a verification code to your registered email. Please enter the code below.":"Choose a new secure password for your account."})]}),e.jsxs("div",{className:"space-y-4",children:[E.length>0&&e.jsxs(u,{variant:"destructive",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx(x,{children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:E.map((s,r)=>e.jsx("li",{children:s},r))})})]}),"currentPassword"===F&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"currentPassword",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(i,{id:"currentPassword",type:M.current?"text":"password",value:S.currentPassword,onChange:e=>O(s=>({...s,currentPassword:e.target.value})),placeholder:"Enter your current password",className:"pr-10",disabled:k,autoFocus:!0}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>Y(e=>({...e,current:!e.current})),disabled:k,children:M.current?e.jsx(N,{className:"h-4 w-4"}):e.jsx(c,{className:"h-4 w-4"})})]})]})}),"otp"===F&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"otp",children:"Verification Code"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(p,{value:S.otp,onChange:e=>O(s=>({...s,otp:e})),maxLength:6,className:"gap-2",children:e.jsxs(j,{children:[e.jsx(g,{index:0,className:"w-12 h-12 text-lg"}),e.jsx(g,{index:1,className:"w-12 h-12 text-lg"}),e.jsx(g,{index:2,className:"w-12 h-12 text-lg"}),e.jsx(g,{index:3,className:"w-12 h-12 text-lg"}),e.jsx(g,{index:4,className:"w-12 h-12 text-lg"}),e.jsx(g,{index:5,className:"w-12 h-12 text-lg"})]})})}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Code expires in ",R," minutes"]}),e.jsx(d,{variant:"ghost",size:"sm",onClick:async()=>{try{V(!0),z([]);const e=await w.requestPasswordChangeOTP(S.currentPassword);e.success&&(q(e.expiryMinutes||5),h({title:"OTP Resent",description:"A new OTP has been sent to your email"}))}catch(e){z([e.message||"Failed to resend OTP"])}finally{V(!1)}},disabled:k,children:"Resend Code"})]})]}),e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(y,{className:"w-4 h-4 text-yellow-600 mt-0.5"}),e.jsxs("div",{className:"text-xs text-yellow-700",children:[e.jsx("p",{className:"font-medium",children:"Security Notice:"}),e.jsx("p",{children:"We've sent a verification code to your registered email address for additional security. Please check your email and enter the code above."})]})]})})]}),"newPassword"===F&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"newPassword",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(i,{id:"newPassword",type:M.new?"text":"password",value:S.newPassword,onChange:e=>O(s=>({...s,newPassword:e.target.value})),placeholder:"Enter your new password",className:"pr-10",disabled:k,autoFocus:!0}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>Y(e=>({...e,new:!e.new})),disabled:k,children:M.new?e.jsx(N,{className:"h-4 w-4"}):e.jsx(c,{className:"h-4 w-4"})})]})]}),S.newPassword&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Password Strength:"}),e.jsx("span",{className:`font-medium ${Q.color}`,children:Q.label})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full transition-all duration-300 "+(5===Q.score?"bg-green-600":Q.score>=4?"bg-green-500":Q.score>=3?"bg-yellow-500":Q.score>=2?"bg-orange-500":"bg-red-500"),style:{width:Q.score/5*100+"%"}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"confirmPassword",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(i,{id:"confirmPassword",type:M.confirm?"text":"password",value:S.confirmPassword,onChange:e=>O(s=>({...s,confirmPassword:e.target.value})),placeholder:"Confirm your new password",className:"pr-10",disabled:k}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>Y(e=>({...e,confirm:!e.confirm})),disabled:k,children:M.confirm?e.jsx(N,{className:"h-4 w-4"}):e.jsx(c,{className:"h-4 w-4"})})]})]}),S.newPassword&&H.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"text-sm font-medium text-red-600",children:"Password Requirements:"}),e.jsx("ul",{className:"text-sm text-red-600 space-y-1",children:H.map((s,r)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 bg-red-600 rounded-full"}),s]},r))})]}),S.confirmPassword&&S.newPassword!==S.confirmPassword&&e.jsxs("div",{className:"text-sm text-red-600 flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 bg-red-600 rounded-full"}),"Passwords do not match"]})]})]}),e.jsxs(m,{className:"gap-2",children:[e.jsx(d,{variant:"outline",onClick:()=>{O({currentPassword:"",newPassword:"",confirmPassword:"",otp:""}),z([]),T("currentPassword"),A(!1),v(!1)},disabled:k,children:"Cancel"}),"currentPassword"===F&&e.jsx(d,{onClick:L,disabled:!$()||k,className:"min-w-[120px]",children:k?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Sending OTP..."]}):"Send Verification Code"}),"otp"===F&&e.jsx(d,{onClick:L,disabled:!S.otp||6!==S.otp.length||k,className:"min-w-[120px]",children:k?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Verifying..."]}):"Verify Code"}),"newPassword"===F&&e.jsx(d,{onClick:L,disabled:!I()||k,className:"min-w-[120px]",children:k?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Changing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"Change Password"]})})]})]})})};export{b as P};

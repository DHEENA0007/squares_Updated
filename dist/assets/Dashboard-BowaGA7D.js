import{j as e}from"./ui-CEt46o3G.js";import{C as h,d as u,a as f,b as v,c as b}from"./card-YvDMUmzt.js";import{O as Q,u as U,L as N,o as C,K as g,Q as K,R as j,B as y,a as r,S,P as O,M as Y,z as W}from"./index-CiYV0Sy0.js";import{r as t,L as n}from"./router-2SVJvIbS.js";import{c as l}from"./customerDashboardService-62dTpgP4.js";import{E as G}from"./eye-CDS1ofgA.js";import{R as P}from"./refresh-cw-B8zbtsbT.js";import{T as k}from"./trending-up-BLutZFyR.js";import{C as J}from"./calendar-DWj9NFdt.js";import"./vendor-Dazix4UH.js";const ce=()=>{const{isConnected:q,lastEvent:R}=Q(),{user:M}=U(),[o,A]=t.useState(!0),[w,F]=t.useState(!1),[i,c]=t.useState({propertiesViewed:0,propertiesViewedChange:"Loading...",savedFavorites:0,savedFavoritesChange:"Loading...",activeInquiries:0,activeInquiriesChange:"Loading...",myProperties:0,myPropertiesChange:"Loading..."}),[D,I]=t.useState([]),[L,V]=t.useState([]),[d,m]=t.useState({favoritesCount:0,messagesCount:0,propertiesCount:0,unreadMessages:0}),H=[{title:"Properties Viewed",value:i.propertiesViewed.toString(),change:i.propertiesViewedChange,icon:G,color:"text-blue-500",bgColor:"bg-blue-500/10"},{title:"Saved Favorites",value:i.savedFavorites.toString(),change:i.savedFavoritesChange,icon:N,color:"text-red-500",bgColor:"bg-red-500/10"},{title:"Active Inquiries",value:i.activeInquiries.toString(),change:i.activeInquiriesChange,icon:C,color:"text-green-500",bgColor:"bg-green-500/10"},{title:"My Properties",value:i.myProperties.toString(),change:i.myPropertiesChange,icon:g,color:"text-orange-500",bgColor:"bg-orange-500/10"}],p=t.useCallback(async()=>{try{A(!0);const[s,a,$,z]=await Promise.all([l.getCustomerDashboardData(),l.getRecentActivities(),l.getRecommendedProperties(6),l.getQuickStats()]);if(s.success)s.data.stats&&c(s.data.stats),s.data.recentActivities&&I(s.data.recentActivities),s.data.recommendedProperties&&V(s.data.recommendedProperties),s.data.quickStats&&m(s.data.quickStats);else{I(a),V($),m(z);const E=await l.getCustomerStats();E&&c(E)}}catch(s){console.error("Failed to load dashboard data:",s)}finally{A(!1)}},[]),x=t.useCallback(async()=>{F(!0),await p(),F(!1)},[p]);t.useEffect(()=>{p()},[p]);const T=t.useCallback(()=>{console.log("Stats updated via realtime"),x()},[x]),_=t.useCallback(()=>{console.log("Properties updated via realtime"),x()},[x]);K({refreshStats:T,refreshProperties:_}),j("property_viewed",t.useCallback(s=>{c(a=>({...a,propertiesViewed:a.propertiesViewed+1,propertiesViewedChange:"+1 new view"}))},[])),j("favorite_added",t.useCallback(s=>{c(a=>({...a,savedFavorites:a.savedFavorites+1,savedFavoritesChange:"+1 new favorite"})),m(a=>({...a,favoritesCount:a.favoritesCount+1}))},[])),j("favorite_removed",t.useCallback(s=>{c(a=>({...a,savedFavorites:Math.max(0,a.savedFavorites-1),savedFavoritesChange:"-1 favorite removed"})),m(a=>({...a,favoritesCount:Math.max(0,a.favoritesCount-1)}))},[])),j("property_inquiry",t.useCallback(s=>{c(a=>({...a,activeInquiries:a.activeInquiries+1,activeInquiriesChange:"+1 new inquiry"}))},[])),j("new_message",s=>{m(a=>({...a,messagesCount:a.messagesCount+1,unreadMessages:a.unreadMessages+1}))});const B=s=>({Heart:N,MessageSquare:C,Search:S,Home:g,Edit:k})[s]||k;return e.jsxs("div",{className:"space-y-6 pt-16",children:[e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${q?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-sm text-muted-foreground",children:q?"Real-time updates active":"Offline mode"}),R&&e.jsxs(y,{variant:"secondary",className:"text-xs",children:["Last update: ",l.formatTimeAgo(R.timestamp)]})]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:x,disabled:w,children:[e.jsx(P,{className:`w-4 h-4 mr-2 ${w?"animate-spin":""}`}),w?"Refreshing...":"Refresh"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold",children:["Welcome back",M?.profile?.firstName?`, ${M.profile.firstName}`:"","!"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Here's what's happening with your property journey"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{to:"/customer/search",children:e.jsxs(r,{children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Search Properties"]})}),e.jsx(n,{to:"/customer/post-property",children:e.jsxs(r,{variant:"outline",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Post Property"]})})]})]}),o&&e.jsx(h,{children:e.jsx(u,{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Loading dashboard data..."})]})})}),!o&&e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:H.map(s=>{const a=s.icon;return e.jsxs(h,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(f,{className:"flex flex-row items-center justify-between pb-2 space-y-0",children:[e.jsx(v,{className:"text-sm font-medium",children:s.title}),e.jsx("div",{className:`p-2 rounded-lg ${s.bgColor}`,children:e.jsx(a,{className:`w-4 h-4 ${s.color}`})})]}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s.value}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.change})]})]},s.title)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(h,{className:"lg:col-span-2",children:[e.jsxs(f,{children:[e.jsx(v,{children:"Recent Activity"}),e.jsx(b,{children:"Your latest interactions and searches"})]}),e.jsxs(u,{children:[!o&&D.length>0?e.jsx("div",{className:"space-y-4",children:D.map(s=>{const a=B(s.icon);return e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(a,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.message}),s.property&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.property}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:l.formatTimeAgo(s.time)})]})]},s._id)})}):o?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading activities..."})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(k,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"No recent activity"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start browsing properties to see your activity here"})]}),e.jsx("div",{className:"mt-4",children:e.jsx(r,{variant:"outline",className:"w-full",children:"View All Activity"})})]})]}),e.jsxs(h,{children:[e.jsxs(f,{children:[e.jsx(v,{children:"Quick Actions"}),e.jsx(b,{children:"Frequently used features"})]}),e.jsxs(u,{className:"space-y-3",children:[e.jsx(n,{to:"/customer/favorites",children:e.jsxs(r,{variant:"outline",className:"w-full justify-start",children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"My Favorites (",d.favoritesCount,")"]})}),e.jsx(n,{to:"/customer/messages",children:e.jsxs(r,{variant:"outline",className:"w-full justify-start",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Messages (",d.messagesCount,")",d.unreadMessages>0&&e.jsx(y,{className:"ml-auto bg-red-500 text-white text-xs px-2 py-1",children:d.unreadMessages})]})}),e.jsx(n,{to:"/customer/my-properties",children:e.jsxs(r,{variant:"outline",className:"w-full justify-start",children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),"My Properties (",d.propertiesCount,")"]})}),e.jsx(n,{to:"/customer/services",children:e.jsxs(r,{variant:"outline",className:"w-full justify-start",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Book Services"]})})]})]})]}),!o&&e.jsxs(h,{children:[e.jsx(f,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(v,{children:"Recommended for You"}),e.jsx(b,{children:"Properties matching your preferences"})]}),e.jsx(n,{to:"/customer/search",children:e.jsx(r,{variant:"outline",children:"View All"})})]})}),e.jsx(u,{children:L.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:L.map(s=>e.jsxs("div",{className:"border rounded-lg overflow-hidden hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"aspect-video bg-muted flex items-center justify-center relative",children:[e.jsx(g,{className:"w-12 h-12 text-muted-foreground"}),s.image&&e.jsx("img",{src:s.image,alt:s.title,className:"absolute top-0 left-0 w-full h-full object-fill",onError:a=>{a.currentTarget.style.display="none"}})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-sm line-clamp-1",children:s.title}),e.jsx(r,{size:"sm",variant:"ghost",className:"p-1",children:e.jsx(N,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground mb-2",children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"line-clamp-1",children:s.location})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-bold text-primary",children:s.price}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(W,{className:"w-3 h-3 text-yellow-400 mr-1"}),e.jsx("span",{className:"text-xs",children:s.rating})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(y,{variant:"outline",className:"text-xs",children:s.propertyType}),e.jsxs("span",{children:[s.bedrooms," BHK"]}),e.jsxs("span",{children:[s.area," sq ft"]})]})]})]},s._id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(g,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"No recommendations available"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Start browsing and marking favorites to get personalized recommendations"}),e.jsx(n,{to:"/customer/search",children:e.jsxs(r,{children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Browse Properties"]})})]})})]})]})};export{ce as default};

import{j as e}from"./ui-DHQhougw.js";import{r as s,L as t}from"./router-Bi51YGN-.js";import{t as a,a1 as r,K as n,f as i,ax as c,E as l,ae as o,aq as d,x as m,ak as h,aD as x,a as p,e as u,b as f,c as g,B as j,aa as w,ab as v,ac as y,ad as N,h as b,J as k}from"./index-CV77Hym3.js";import{r as C}from"./reviewsService-BQH4s__s.js";import{R}from"./refresh-cw-DllRcUU9.js";import{D as P}from"./dollar-sign-DYhSNXxj.js";import{T as L}from"./trending-up-BiEUbM3m.js";import{T as S}from"./trending-down-CUf8hxtb.js";import{R as D,L as A,C as E,X as $,Y as V,T as q,a as F}from"./LineChart-BV5bqZ2w.js";import{A as T}from"./activity-DXf5bWrv.js";import{E as I}from"./ellipsis-Db7Kl15T.js";import"./vendor-eVk5PToZ.js";const M=new class{async makeRequest(e,s={}){const t=`https://api.buildhomemartsquares.com/api${e}`,a={headers:{"Content-Type":"application/json",...s.headers},...s},r=localStorage.getItem("token");r&&(a.headers={...a.headers,Authorization:`Bearer ${r}`});try{const e=await fetch(t,a);if(!e.ok){const s=await e.json().catch(()=>({success:!1,message:`HTTP ${e.status}: ${e.statusText}`}));throw new Error(s.message||"An error occurred")}return await e.json()}catch(n){throw n}}async getDashboardData(e={}){try{const s=new URLSearchParams;Object.entries(e).forEach(([e,t])=>{null!=t&&""!==t&&s.append(e,t.toString())});const t="/vendors/dashboard"+(s.toString()?`?${s.toString()}`:""),a=await this.makeRequest(t);return a.success&&a.data?a.data:this.getEmptyDashboardData()}catch(s){return this.getEmptyDashboardData()}}async getVendorStats(e="7d"){try{const t=await this.makeRequest(`/vendors/stats?dateRange=${e}`);if(t.success&&t.data){try{const e=await C.getReviewStats();t.data.averageRating=e.averageRating}catch(s){}return t.data}throw new Error("Failed to fetch vendor stats")}catch(t){let e=0;try{e=(await C.getReviewStats()).averageRating}catch(s){}return{totalProperties:0,totalPropertiesChange:"+0",propertyViews:0,propertyViewsChange:"+0%",unreadMessages:0,totalMessages:0,messagesChange:"0 unread",totalRevenue:0,revenueChange:"+0%",conversionRate:0,conversionChange:"+0%",averageRating:e,phoneCalls:0,phoneCallsChange:"+0%"}}}async getRecentProperties(e=6){try{const s=await this.makeRequest(`/vendors/properties/recent?limit=${e}`);if(s.success&&s.data)return s.data.properties;throw new Error("Failed to fetch recent properties")}catch(s){return[]}}async getRecentLeads(e=10){try{const s=await this.makeRequest(`/vendors/leads/recent?limit=${e}`);if(s.success&&s.data)return s.data.leads;throw new Error("Failed to fetch recent leads")}catch(s){return[]}}async getPerformanceData(e="7d"){try{const s=await this.makeRequest(`/vendors/performance?dateRange=${e}`);if(s.success&&s.data)return s.data.performance;throw new Error("Failed to fetch performance data")}catch(s){return[]}}async getVendorAnalytics(e="30d"){try{const s=await this.makeRequest(`/vendors/analytics?dateRange=${e}`);if(s.success&&s.data)return s.data;throw new Error("Failed to fetch vendor analytics")}catch(s){return{monthlyPerformance:[],leadsBySource:[],propertyPerformance:[],topPerformingAreas:[]}}}async getNotifications(){try{const e=await this.makeRequest("/vendors/notifications");return e.success&&e.data?e.data.notifications:[]}catch(e){return[]}}async markNotificationAsRead(e){try{return(await this.makeRequest(`/vendors/notifications/${e}/read`,{method:"PATCH"})).success}catch(s){return!1}}async updateLeadStatus(e,s){try{return!!(await this.makeRequest(`/vendors/leads/${e}/status`,{method:"PATCH",body:JSON.stringify({status:s})})).success&&(a({title:"Success",description:"Lead status updated successfully!"}),!0)}catch(t){const e=t instanceof Error?t.message:"Failed to update lead status";return a({title:"Error",description:e,variant:"destructive"}),!1}}getImageUrl(e){return e?"string"==typeof e?e:e.url||"https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=400&h=300&fit=crop&auto=format":"https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=400&h=300&fit=crop&auto=format"}formatPrice(e,s="₹"){return e>=1e7?`${s}${(e/1e7).toFixed(1)} Cr`:e>=1e5?`${s}${(e/1e5).toFixed(1)} L`:`${s}${e.toLocaleString("en-IN")}`}formatPercentageChange(e){const s=e.startsWith("+");return{value:e,isPositive:s}}getStatusColor(e){return{active:"bg-green-500",pending:"bg-yellow-500",sold:"bg-blue-500",rented:"bg-purple-500",inactive:"bg-gray-500",new:"bg-blue-500",contacted:"bg-yellow-500",qualified:"bg-orange-500",converted:"bg-green-500",lost:"bg-red-500"}[e]||"bg-gray-500"}getInterestColor(e){return{high:"text-green-600 bg-green-100 dark:text-green-400 dark:bg-green-900",medium:"text-yellow-600 bg-yellow-100 dark:text-yellow-400 dark:bg-yellow-900",low:"text-red-600 bg-red-100 dark:text-red-400 dark:bg-red-900"}[e]||"text-gray-600 bg-gray-100"}async getEmptyDashboardData(){let e=0;try{e=(await C.getReviewStats()).averageRating}catch(s){}return{stats:{totalProperties:0,totalPropertiesChange:"+0",propertyViews:0,propertyViewsChange:"+0%",unreadMessages:0,totalMessages:0,messagesChange:"0 unread",totalRevenue:0,revenueChange:"+0%",conversionRate:0,conversionChange:"+0%",averageRating:e,phoneCalls:0,phoneCallsChange:"+0%"},recentProperties:[],recentLeads:[],performanceData:[],analytics:{monthlyPerformance:[],leadsBySource:[],propertyPerformance:[],topPerformingAreas:[]},notifications:[]}}},z=()=>{const[C,z]=s.useState("7d"),[B,U]=s.useState("overview"),[_,O]=((e={})=>{const{autoRefresh:t=!0,refreshInterval:n=3e4,enableRealtime:i=!0}=e,{isConnected:c}=r(),l=s.useRef(null),o=s.useRef({}),[d,m]=s.useState({stats:null,recentProperties:[],recentLeads:[],performanceData:[],notifications:[],isLoading:!0,error:null,lastUpdated:null}),h=s.useCallback(e=>{m(s=>({...s,...e,lastUpdated:new Date}))},[]),x=s.useCallback(async()=>{try{const e=await M.getVendorStats(o.current.dateRange||"7d");h({stats:e})}catch(X){h({error:X instanceof Error?X.message:"Failed to load stats"})}},[h]),p=s.useCallback(async()=>{try{const e=await M.getRecentProperties(6);h({recentProperties:e})}catch(X){}},[h]),u=s.useCallback(async()=>{try{const e=await M.getRecentLeads(10);h({recentLeads:e})}catch(X){}},[h]),f=s.useCallback(async()=>{try{const e=await M.getPerformanceData(o.current.dateRange||"7d");h({performanceData:e})}catch(X){}},[h]),g=s.useCallback(async()=>{try{const e=await M.getNotifications();h({notifications:e})}catch(X){}},[h]),j=s.useCallback(async()=>{h({isLoading:!0,error:null});try{const e=await M.getDashboardData(o.current);h({stats:e.stats,recentProperties:e.recentProperties,recentLeads:e.recentLeads,performanceData:e.performanceData,notifications:e.notifications,isLoading:!1,error:null})}catch(X){h({isLoading:!1,error:X instanceof Error?X.message:"Failed to load dashboard data"})}},[h]),w=s.useCallback(e=>{o.current={...o.current,...e},j()},[j]),v=s.useCallback(async e=>{try{await M.markNotificationAsRead(e)&&h({notifications:d.notifications.map(s=>s.id===e?{...s,isRead:!0}:s)})}catch(X){a({title:"Error",description:"Failed to mark notification as read",variant:"destructive"})}},[d.notifications,h]),y=s.useCallback(async(e,s)=>{try{await M.updateLeadStatus(e,s)&&(h({recentLeads:d.recentLeads.map(t=>t._id===e?{...t,status:s,updatedAt:(new Date).toISOString()}:t)}),x())}catch(X){}},[d.recentLeads,h,x]);return s.useEffect(()=>{},[i,c]),s.useEffect(()=>{if(t&&n>0)return l.current=setInterval(()=>{d.isLoading||j()},n),()=>{l.current&&clearInterval(l.current)}},[t,n,j,d.isLoading]),s.useEffect(()=>{j()},[]),s.useEffect(()=>()=>{l.current&&clearInterval(l.current)},[]),[d,{refreshData:j,refreshStats:x,refreshProperties:p,refreshLeads:u,refreshPerformance:f,refreshNotifications:g,updateFilters:w,markNotificationAsRead:v,updateLeadStatus:y}]})({autoRefresh:!0,refreshInterval:3e4,enableRealtime:!0}),{stats:W,recentProperties:H,recentLeads:K,performanceData:J,notifications:G,isLoading:Q,error:X,lastUpdated:Y}=_,{refreshData:Z,refreshStats:ee,updateFilters:se,markNotificationAsRead:te,updateLeadStatus:ae}=O;s.useEffect(()=>{se({dateRange:C})},[C,se]);const re=()=>{Z(),a({title:"Dashboard Refreshed",description:"All data has been updated with the latest information."})};if(Q&&!W)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(n,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading your dashboard..."})]})});if(X&&!W)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 mb-4",children:X}),e.jsxs(i,{onClick:re,children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Try Again"]})]})});const ne=G.filter(e=>!e.isRead).length,ie=[{title:"Total Properties",value:W?.totalProperties||0,change:W?.totalPropertiesChange||"+0",icon:c,color:"text-blue-600"},{title:"Property Views",value:W?.propertyViews||0,change:W?.propertyViewsChange||"+0%",icon:l,color:"text-purple-600"},{title:"Messages",value:W?.totalMessages||0,change:W?.messagesChange||"0 unread",icon:o,color:"text-orange-600"},{title:"Total Revenue",value:M.formatPrice(W?.totalRevenue||0),change:W?.revenueChange||"+0%",icon:P,color:"text-emerald-600"},{title:"Avg. Rating",value:W?.averageRating?W.averageRating.toFixed(1):"0.0",change:W?.ratingChange||"+0%",icon:d,color:"text-yellow-600"},{title:"Phone Calls",value:W?.phoneCalls||0,change:W?.phoneCallsChange||"+0%",icon:m,color:"text-green-600"}],ce=J.length>0?J:[];return e.jsxs("div",{className:"space-y-4 md:space-y-6 mt-16 px-4 md:px-0",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Vendor Dashboard"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2",children:[e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"Manage your properties and track your performance"}),Y&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["• Last updated: ",Y.toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"outline",onClick:re,disabled:Q,className:"flex-1 sm:flex-none",children:[e.jsx(R,{className:"w-4 h-4 mr-2 "+(Q?"animate-spin":"")}),"Refresh"]}),ne>0&&e.jsxs(i,{variant:"outline",className:"flex-1 sm:flex-none",children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{className:"hidden sm:inline",children:["Notifications (",ne,")"]}),e.jsxs("span",{className:"sm:hidden",children:["(",ne,")"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{to:"/vendor/analytics",className:"flex-1 sm:flex-none",children:e.jsxs(i,{variant:"outline",className:"w-full",children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"View Analytics"}),e.jsx("span",{className:"sm:hidden",children:"Analytics"})]})}),e.jsx(t,{to:"/vendor/properties/add",className:"flex-1 sm:flex-none",children:e.jsxs(i,{className:"w-full",children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),"Add Property"]})})]})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-3 md:gap-6",children:ie.map(s=>{const t=M.formatPercentageChange(s.change);return e.jsx(p,{children:e.jsx(u,{className:"p-3 md:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs md:text-sm font-medium text-muted-foreground truncate",children:s.title}),e.jsx("p",{className:"text-lg md:text-2xl font-bold truncate",children:s.value}),e.jsxs("div",{className:"flex items-center mt-1",children:[t.isPositive?e.jsx(L,{className:"h-3 w-3 md:h-4 md:w-4 text-green-500 mr-1 flex-shrink-0"}):e.jsx(S,{className:"h-3 w-3 md:h-4 md:w-4 text-red-500 mr-1 flex-shrink-0"}),e.jsx("p",{className:"text-xs truncate "+(t.isPositive?"text-green-500":"text-red-500"),children:s.change})]})]}),e.jsx(s.icon,{className:`h-6 w-6 md:h-8 md:w-8 ${s.color} flex-shrink-0 ml-2`})]})})},s.title)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs(p,{children:[e.jsx(f,{className:"pb-3 md:pb-6",children:e.jsxs(g,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-base md:text-lg",children:[e.jsx("span",{children:"Views Performance"}),e.jsx("div",{className:"flex gap-1 sm:gap-2",children:["7d","30d","90d"].map(s=>e.jsx(i,{variant:C===s?"default":"ghost",size:"sm",onClick:()=>z(s),className:"text-xs px-2 py-1 h-7",children:s},s))})]})}),e.jsx(u,{className:"pt-0",children:ce.length>0?e.jsx(D,{width:"100%",height:250,className:"md:h-[300px]",children:e.jsxs(A,{data:ce,margin:{top:5,right:10,left:10,bottom:5},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorViews",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:0})]})}),e.jsx(E,{strokeDasharray:"3 3",stroke:"hsl(var(--border))",opacity:.3,vertical:!1}),e.jsx($,{dataKey:"date",stroke:"hsl(var(--muted-foreground))",fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(V,{stroke:"hsl(var(--muted-foreground))",fontSize:10,tickLine:!1,axisLine:!1,tickFormatter:e=>`${e}`,width:30}),e.jsx(q,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"6px",boxShadow:"0 10px 15px -3px rgb(0 0 0 / 0.1)",color:"hsl(var(--popover-foreground))",fontSize:"12px",padding:"8px"},labelStyle:{color:"hsl(var(--popover-foreground))",fontWeight:600,marginBottom:"4px"},cursor:{stroke:"hsl(var(--border))",strokeWidth:1}}),e.jsx(F,{type:"monotone",dataKey:"views",stroke:"#10b981",strokeWidth:2,dot:!1,activeDot:{r:4,fill:"#10b981",stroke:"#fff",strokeWidth:2},name:"Views",fill:"url(#colorViews)"})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-[200px] md:h-[300px] text-center px-4",children:[e.jsx(T,{className:"w-12 h-12 md:w-16 md:h-16 text-muted-foreground mb-3 md:mb-4"}),e.jsx("h3",{className:"text-base md:text-lg font-semibold text-muted-foreground mb-2",children:"No Performance Data"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground max-w-md",children:"Performance metrics will appear here once your properties start receiving views."})]})})]}),e.jsxs(p,{children:[e.jsx(f,{className:"pb-3 md:pb-6",children:e.jsxs(g,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-base md:text-lg",children:[e.jsx("span",{children:"Recent Activities"}),e.jsx(i,{variant:"ghost",size:"sm",className:"self-start sm:self-auto",children:"View All"})]})}),e.jsx(u,{className:"pt-0",children:e.jsx("div",{className:"space-y-3 md:space-y-4",children:K.length>0?K.map(s=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between p-3 border rounded-lg gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 bg-primary/20 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(o,{className:"w-4 h-4 md:w-5 md:h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.propertyTitle}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.message||"New inquiry"})]})]}),e.jsxs("div",{className:"flex flex-col sm:items-end gap-2 sm:space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"secondary",className:"text-xs",children:s.status||"new"}),e.jsxs(w,{children:[e.jsx(v,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(I,{className:"h-4 w-4"})})}),e.jsxs(y,{align:"end",children:[e.jsx(N,{onClick:()=>ae(s._id,"contacted"),className:"text-sm",children:"Mark as Contacted"}),e.jsx(N,{onClick:()=>ae(s._id,"qualified"),className:"text-sm",children:"Mark as Qualified"}),e.jsx(N,{onClick:()=>ae(s._id,"converted"),className:"text-sm",children:"Mark as Converted"})]})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center",children:[e.jsx(T,{className:"w-3 h-3 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:new Date(s.createdAt).toLocaleDateString()})]})]})]},s._id)):e.jsxs("div",{className:"text-center py-6 md:py-8 text-muted-foreground",children:[e.jsx(T,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto mb-3 md:mb-4 opacity-50"}),e.jsx("p",{className:"text-sm md:text-base",children:"No recent activities"}),e.jsx("p",{className:"text-xs md:text-sm",children:"Property inquiries and messages will appear here"})]})})})]})]}),e.jsxs(p,{children:[e.jsx(f,{className:"pb-3 md:pb-6",children:e.jsxs(g,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-base md:text-lg",children:[e.jsx("span",{children:"Recent Properties"}),e.jsx(i,{variant:"ghost",size:"sm",className:"self-start sm:self-auto",children:"View All"})]})}),e.jsx(u,{className:"pt-0",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4",children:H.length>0?H.map(s=>e.jsxs(p,{className:"overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:M.getImageUrl(s.images?.[0]),alt:s.title,className:"w-full h-24 md:h-32 object-cover",onError:e=>{e.target.src="https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=300&h=200&fit=crop&auto=format"}}),e.jsx(j,{className:`absolute top-1 right-1 md:top-2 md:right-2 text-xs ${M.getStatusColor(s.status)} text-white`,children:s.status}),e.jsx("div",{className:"absolute bottom-1 left-1 md:bottom-2 md:left-2",children:e.jsx(j,{variant:"secondary",className:"text-xs",children:s.listingType})})]}),e.jsxs(u,{className:"p-3 md:p-4",children:[e.jsx("h3",{className:"font-semibold text-sm md:text-base line-clamp-1 mb-1",children:s.title}),e.jsxs("p",{className:"text-xs md:text-sm text-muted-foreground mb-2 flex items-center",children:[e.jsx(b,{className:"w-3 h-3 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.location})]}),e.jsx("p",{className:"text-base md:text-lg font-bold text-primary mb-2 md:mb-3 truncate",children:M.formatPrice(s.price,s.currency)}),e.jsxs("div",{className:"flex justify-between text-xs md:text-sm gap-1",children:[e.jsxs("span",{className:"flex items-center flex-1 min-w-0",children:[e.jsx(l,{className:"w-3 h-3 md:w-4 md:h-4 mr-1 flex-shrink-0"}),e.jsxs("span",{className:"truncate",children:[s.views," views"]})]}),e.jsxs("span",{className:"flex items-center flex-1 min-w-0",children:[e.jsx(k,{className:"w-3 h-3 md:w-4 md:h-4 mr-1 flex-shrink-0"}),e.jsxs("span",{className:"truncate",children:[s.favorites," fav"]})]}),e.jsxs("span",{className:"flex items-center flex-1 min-w-0",children:[e.jsx(d,{className:"w-3 h-3 md:w-4 md:h-4 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.rating||0})]})]})]})]},s._id)):e.jsxs("div",{className:"col-span-full text-center py-6 md:py-8 text-muted-foreground",children:[e.jsx(c,{className:"w-10 h-10 md:w-12 md:h-12 mx-auto mb-3 md:mb-4 opacity-50"}),e.jsx("p",{className:"text-sm md:text-base",children:"No properties found"}),e.jsx("p",{className:"text-xs md:text-sm",children:"Add your first property to get started"}),e.jsxs(i,{className:"mt-3 md:mt-4",size:"sm",children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),"Add Property"]})]})})})]})]})};export{z as default};

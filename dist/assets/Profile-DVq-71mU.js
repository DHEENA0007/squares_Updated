import{j as e}from"./ui-s1SEoZIF.js";import{r as s}from"./router-D8v2YSKU.js";import{u as a,t as i,o as t,s as r,d as l}from"./types-KiqUWZa9.js";import{a5 as n,u as o,J as d,f as c,an as m,h as x,a as j,b as h,c as p,d as f,e as u,ao as g,ap as v,aq as y,B as N,g as b,z as w,M as C,S,ah as P,ai as k,aj as z,ak as A,I as F,P as E,j as _,l as M,T as V,i as I,ar as D}from"./index-l5vY_naC.js";import{F as T,a as U,b as B,c as O,d as R,e as $}from"./form-xja268m1.js";import{C as q}from"./calendar-C5Nppio0.js";import{P as J}from"./PasswordChangeDialog-DFz7HaWD.js";import{P as L}from"./PincodeAutocomplete-CHvoYnRo.js";import{u as W}from"./uploadService-C_cH8Ofp.js";import{C as Q}from"./camera-Ir9xBKZD.js";import{C as X}from"./calendar-Di9eH8o8.js";import{f as G}from"./format-Brr51Ocy.js";import"./vendor-BxThA0WO.js";import"./alert-CHp9jSHV.js";import"./input-otp-EiGeZ_ia.js";import"./key-Bc0j0iCE.js";import"./eye-off-BQpbtTQ-.js";const H=t({first_name:r().min(2,"First name must be at least 2 characters"),last_name:r().optional(),email:r().email("Invalid email address"),phone:r().regex(/^[0-9]{10}$/,"Must be exactly 10 digits").min(10,"Must be exactly 10 digits").max(10,"Must be exactly 10 digits"),birthday:l().optional(),bio:r().optional(),department:r().optional(),designation:r().optional(),street:r().optional(),state:r().optional(),district:r().optional(),city:r().optional(),zipCode:r().optional().refine(e=>!e||/^[0-9]{6}$/.test(e),"Pincode must be exactly 6 digits")}),K=()=>{const{toast:t}=n(),{user:r,checkAuth:l}=o(),[K,Y]=s.useState(!0),[Z,ee]=s.useState(!1),[se,ae]=s.useState(!1),[ie,te]=s.useState(null),[re,le]=s.useState(""),[ne,oe]=s.useState(!1),[de,ce]=s.useState("profile"),[me,xe]=s.useState(!1),je=s.useRef(null),he=a({resolver:i(H),defaultValues:{first_name:"",last_name:"",email:"",phone:"",bio:"",department:"",designation:"",street:"",state:"",district:"",city:"",zipCode:""}}),pe=s.useCallback(async()=>{if(r)try{Y(!0),te(r),le(r?.profile?.avatar||""),he.reset({first_name:r?.profile?.firstName||"",last_name:r?.profile?.lastName||"",email:r?.email||"",phone:r?.profile?.phone||"",birthday:r?.profile?.birthday?new Date(r.profile.birthday):void 0,bio:r?.profile?.bio||"",department:r?.profile?.department||"",designation:r?.profile?.designation||"",street:r?.profile?.address?.street||"",state:r?.profile?.address?.state||"",district:r?.profile?.address?.district||"",city:r?.profile?.address?.city||"",zipCode:r?.profile?.address?.zipCode||r?.profile?.address?.pincode||""})}catch(e){t({variant:"destructive",title:"Error",description:"Failed to load profile"})}finally{Y(!1)}},[r,he,t]);s.useEffect(()=>{pe()},[pe]);const fe=e=>e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ");return K?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(d,{className:"h-8 w-8 animate-spin"})}):e.jsxs("div",{className:"container mx-auto p-6 max-w-6xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"My Profile"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your account settings"})]}),e.jsxs(c,{onClick:async()=>{ae(!0),await pe(),ae(!1),t({title:"Success",description:"Profile refreshed successfully"})},variant:"outline",size:"sm",disabled:se,children:[e.jsx(m,{className:x("h-4 w-4 mr-2",se&&"animate-spin")}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(j,{className:"lg:col-span-1",children:[e.jsxs(h,{children:[e.jsx(p,{children:"Profile Picture"}),e.jsx(f,{children:"Update your avatar"})]}),e.jsxs(u,{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(g,{className:"h-32 w-32",children:[e.jsx(v,{src:re,alt:ie?.profile?.firstName}),e.jsx(y,{className:"text-2xl",children:(ue=ie?.profile?.firstName,ge=ie?.profile?.lastName,((ue?.charAt(0)||"")+(ge?.charAt(0)||"")).toUpperCase()||"?")})]}),e.jsx(c,{size:"sm",variant:"secondary",className:"absolute bottom-0 right-0 rounded-full h-10 w-10 p-0",onClick:()=>je.current?.click(),disabled:me,children:me?e.jsx(d,{className:"h-4 w-4 animate-spin"}):e.jsx(Q,{className:"h-4 w-4"})}),e.jsx("input",{ref:je,type:"file",accept:"image/*",className:"hidden",onChange:async e=>{const s=e.target.files?.[0];if(s)if(s.type.startsWith("image/"))if(s.size>5242880)t({variant:"destructive",title:"Error",description:"Image size must be less than 5MB"});else try{xe(!0);const e=await W.uploadAvatar(s),a=localStorage.getItem("token");if(!(await fetch("https://app.buildhomemartsquares.com/users/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({avatar:e})})).ok)throw new Error("Failed to update avatar");le(e),await l(),t({title:"Success",description:"Avatar updated successfully"})}catch(a){t({variant:"destructive",title:"Error",description:a.message||"Failed to upload avatar"})}finally{xe(!1)}else t({variant:"destructive",title:"Error",description:"Please upload an image file"})}})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:[ie?.profile?.firstName," ",ie?.profile?.lastName]}),e.jsx(N,{variant:"secondary",children:fe(ie?.role)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:ie?.email})]}),e.jsx(b,{}),e.jsxs("div",{className:"w-full space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Role:"}),e.jsx("span",{className:"font-medium",children:fe(ie?.role)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Email:"}),e.jsx("span",{className:"font-medium",children:ie?.emailVerified?"Verified":"Not Verified"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Status:"}),e.jsx(N,{variant:"active"===ie?.status?"default":"destructive",children:ie?.status})]})]})]})]}),e.jsxs(j,{className:"lg:col-span-2",children:[e.jsxs(h,{children:[e.jsx(p,{children:"Account Information"}),e.jsx(f,{children:"Update your personal details"})]}),e.jsx(u,{children:e.jsxs(P,{value:de,onValueChange:ce,children:[e.jsxs(k,{className:"grid w-full grid-cols-2",children:[e.jsx(z,{value:"profile",children:"Profile"}),e.jsx(z,{value:"security",children:"Security"})]}),e.jsx(A,{value:"profile",className:"space-y-4 mt-4",children:e.jsx(T,{...he,children:e.jsxs("form",{onSubmit:he.handleSubmit(async e=>{try{ee(!0);const s={firstName:e.first_name,lastName:e.last_name||void 0,email:e.email,phone:e.phone||void 0,birthday:e.birthday||void 0,bio:e.bio||void 0,department:e.department||void 0,designation:e.designation||void 0,address:{street:e.street||void 0,state:e.state||void 0,district:e.district||void 0,city:e.city||void 0,zipCode:e.zipCode||void 0}},a=localStorage.getItem("token");if(!(await fetch("https://app.buildhomemartsquares.com/users/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(s)})).ok)throw new Error("Failed to update profile");await l(),t({title:"Success",description:"Profile updated successfully"}),await pe()}catch(s){t({variant:"destructive",title:"Error",description:s.response?.data?.message||"Failed to update profile"})}finally{ee(!1)}}),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(U,{control:he.control,name:"first_name",render:({field:s})=>e.jsxs(B,{children:[e.jsx(O,{children:"First Name"}),e.jsx(R,{children:e.jsx(F,{...s})}),e.jsx($,{})]})}),e.jsx(U,{control:he.control,name:"last_name",render:({field:s})=>e.jsxs(B,{children:[e.jsx(O,{children:"Last Name"}),e.jsx(R,{children:e.jsx(F,{...s})}),e.jsx($,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(U,{control:he.control,name:"email",render:({field:s})=>e.jsxs(B,{children:[e.jsx(O,{children:"Email"}),e.jsx(R,{children:e.jsx(F,{...s,type:"email"})}),e.jsx($,{})]})}),e.jsx(U,{control:he.control,name:"phone",render:({field:s})=>e.jsxs(B,{children:[e.jsx(O,{children:"Phone"}),e.jsx(R,{children:e.jsx(F,{...s})}),e.jsx($,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(U,{control:he.control,name:"department",render:({field:s})=>e.jsxs(B,{children:[e.jsx(O,{children:"Department"}),e.jsx(R,{children:e.jsx(F,{...s,placeholder:"e.g., Sales, Marketing"})}),e.jsx($,{})]})}),e.jsx(U,{control:he.control,name:"designation",render:({field:s})=>e.jsxs(B,{children:[e.jsx(O,{children:"Designation"}),e.jsx(R,{children:e.jsx(F,{...s,placeholder:"e.g., Manager, Executive"})}),e.jsx($,{})]})})]}),e.jsx(U,{control:he.control,name:"birthday",render:({field:s})=>e.jsxs(B,{className:"flex flex-col",children:[e.jsx(O,{children:"Birthday"}),e.jsxs(E,{children:[e.jsx(_,{asChild:!0,children:e.jsx(R,{children:e.jsxs(c,{variant:"outline",className:x("w-full pl-3 text-left font-normal",!s.value&&"text-muted-foreground"),children:[s.value?G(s.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(X,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(M,{className:"w-auto p-0",align:"start",children:e.jsx(q,{mode:"single",selected:s.value,onSelect:s.onChange,disabled:e=>e>new Date,initialFocus:!0})})]}),e.jsx($,{})]})}),e.jsx(U,{control:he.control,name:"bio",render:({field:s})=>e.jsxs(B,{children:[e.jsx(O,{children:"Bio"}),e.jsx(R,{children:e.jsx(V,{...s,rows:3,placeholder:"Tell us about yourself"})}),e.jsx($,{})]})}),e.jsx(b,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"Address Information"]}),e.jsx(U,{control:he.control,name:"street",render:({field:s})=>e.jsxs(B,{children:[e.jsx(O,{children:"Street Address"}),e.jsx(R,{children:e.jsx(F,{...s})}),e.jsx($,{})]})}),e.jsx(U,{control:he.control,name:"zipCode",render:({field:s})=>e.jsxs(B,{children:[e.jsx(O,{children:"Pincode"}),e.jsx(R,{children:e.jsx(L,{value:s.value||"",onChange:(e,a)=>{s.onChange(e),a&&(he.setValue("state",a.state),he.setValue("district",a.district),he.setValue("city",a.city))}})}),e.jsx($,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(U,{control:he.control,name:"state",render:({field:s})=>e.jsxs(B,{children:[e.jsx(O,{children:"State"}),e.jsx(R,{children:e.jsx(F,{...s})}),e.jsx($,{})]})}),e.jsx(U,{control:he.control,name:"district",render:({field:s})=>e.jsxs(B,{children:[e.jsx(O,{children:"District"}),e.jsx(R,{children:e.jsx(F,{...s})}),e.jsx($,{})]})}),e.jsx(U,{control:he.control,name:"city",render:({field:s})=>e.jsxs(B,{children:[e.jsx(O,{children:"City"}),e.jsx(R,{children:e.jsx(F,{...s})}),e.jsx($,{})]})})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(c,{type:"submit",disabled:Z,children:Z?e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),"Save Changes"]})})})]})})}),e.jsx(A,{value:"security",className:"space-y-4 mt-4",children:e.jsxs(j,{children:[e.jsxs(h,{children:[e.jsx(p,{children:"Password"}),e.jsx(f,{children:"Change your account password"})]}),e.jsx(u,{children:e.jsx(c,{onClick:()=>oe(!0),children:"Change Password"})})]})})]})})]})]}),e.jsx(J,{open:ne,onOpenChange:oe})]});var ue,ge};export{K as default};

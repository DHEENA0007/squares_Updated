import{j as e}from"./ui-s1SEoZIF.js";import{d as s,r as a}from"./router-D8v2YSKU.js";import{H as t,u as l,J as i,f as r,an as c,a0 as n,ac as d,a as m,b as x,c as o,e as u,S as h,d as j,B as p,U as f,a7 as N,a8 as g,a9 as v,aa as b,ab as w,ag as y,t as S,as as A,at as C,au as R,av as k,aw as E,ax as T,af as D}from"./index-l5vY_naC.js";import{P as L,a as _,b as P,c as I,d as O,e as U}from"./pagination-C5WMbI05.js";import{D as z}from"./DataTable-3KtdMbos.js";import{u as $,S as F}from"./usePermissions-KMQz87nG.js";import{r as M}from"./roleService-B3qSgk0I.js";import{S as V}from"./square-pen-Czw89hhB.js";import{E as H}from"./ellipsis-ClvvvtMR.js";import"./vendor-BxThA0WO.js";import"./table-S99XbycI.js";const J=t("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]),Y=t("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),q=()=>{const t=s(),{isSuperAdmin:q,refreshUser:B}=l(),{hasPermission:G}=$(),[W,Z]=a.useState(""),[K,Q]=a.useState("all"),[X,ee]=a.useState([]),[se,ae]=a.useState(!0),[te,le]=a.useState(!1),[ie,re]=a.useState(1),[ce,ne]=a.useState(1),[de,me]=a.useState(0),[xe,oe]=a.useState(null),[ue,he]=a.useState(null),[je,pe]=a.useState(!1),[fe,Ne]=a.useState(null),[ge,ve]=a.useState(!1),be=a.useRef(),we=a.useCallback(async()=>{try{ae(!0);const e={page:ie,limit:10,search:W||void 0,isActive:"all"===K?void 0:"active"===K},s=await M.getRoles(e),a=s.data.roles.map(e=>({...e,pages:e.pages||[]}));ee(a),ne(s.data.pagination.totalPages),me(s.data.pagination.totalRoles);const t=a.find(e=>"superadmin"===e.name.toLowerCase()),l=a.find(e=>"subadmin"===e.name.toLowerCase());oe(t||null),he(l||null)}catch(e){}finally{ae(!1)}},[ie,W,K]);a.useEffect(()=>{we()},[we]),a.useEffect(()=>()=>{be.current&&clearTimeout(be.current)},[]);const ye=a.useCallback(e=>{be.current&&clearTimeout(be.current),be.current=setTimeout(()=>{Z(e),re(1)},300)},[]),Se=a.useCallback(e=>{Q(e),re(1)},[]),Ae=s=>{const a=s.name.toLowerCase();return"superadmin"===a?e.jsxs(p,{variant:"destructive",className:"text-xs",children:[e.jsx(h,{className:"w-3 h-3 mr-1"}),"Super Admin"]}):"subadmin"===a?e.jsxs(p,{variant:"default",className:"text-xs bg-orange-500 hover:bg-orange-500/80",children:[e.jsx(h,{className:"w-3 h-3 mr-1"}),"Sub Admin"]}):s.isSystemRole?e.jsxs(p,{variant:"outline",className:"text-xs",children:[e.jsx(h,{className:"w-3 h-3 mr-1"}),"System"]}):null},Ce=[{key:"name",label:"Role Name",render:s=>e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[s.name,Ae(s)]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description})]})},{key:"userCount",label:"Users",render:s=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:s.userCount||0})]})},{key:"isActive",label:"Status",render:s=>e.jsx(p,{variant:s.isActive?"default":"secondary",children:s.isActive?"Active":"Inactive"})},{key:"actions",label:"Actions",render:s=>e.jsxs(A,{children:[e.jsx(C,{asChild:!0,children:e.jsxs(r,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(H,{className:"w-4 h-4"})]})}),e.jsxs(R,{align:"end",className:"w-48",children:[e.jsx(k,{children:"Actions"}),e.jsx(E,{}),G(n.ROLES_EDIT)&&e.jsxs(T,{onClick:e=>{e.stopPropagation(),t(`/admin/roles/edit/${s._id}`)},className:"cursor-pointer",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Edit Role"]}),G(n.ROLES_EDIT)&&e.jsxs(T,{onClick:e=>{e.stopPropagation(),(async e=>{try{const s=await M.toggleRoleStatus(e._id);ee(e=>e.map(e=>e._id===s.data.role._id?s.data.role:e)),S({title:"Success",description:`Role ${s.data.role.isActive?"activated":"deactivated"} successfully!`})}catch(s){}})(s)},className:"cursor-pointer",children:[s.isActive?e.jsx(J,{className:"w-4 h-4 mr-2"}):e.jsx(Y,{className:"w-4 h-4 mr-2"}),s.isActive?"Deactivate":"Activate"]}),e.jsx(E,{}),G(n.ROLES_DELETE)&&e.jsxs(T,{onClick:e=>{e.stopPropagation(),(e=>{Ne(e),pe(!0)})(s)},className:"text-destructive focus:text-destructive cursor-pointer",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Delete Role"]})]})]})}];return se?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(i,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading roles..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:justify-between md:items-center md:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"Role Management"}),e.jsx("p",{className:"text-sm md:text-base text-muted-foreground mt-1 md:mt-2",children:"Manage user roles and permissions"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{onClick:async()=>{try{le(!0),await B(),S({title:"Permissions Refreshed",description:"Your permissions have been updated successfully."})}catch(e){S({title:"Refresh Failed",description:"Could not refresh permissions. Please try logging in again.",variant:"destructive"})}finally{le(!1)}},variant:"outline",size:"sm",disabled:te,className:"flex items-center gap-2",children:[e.jsx(c,{className:"h-4 w-4 "+(te?"animate-spin":"")}),te?"Refreshing...":"Refresh Permissions"]}),G(n.ROLES_CREATE)&&e.jsxs(r,{onClick:()=>t("/admin/roles/add"),className:"flex items-center gap-2 w-full md:w-auto",size:"sm",children:[e.jsx(d,{className:"h-4 w-4"}),"Add New Role"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2 md:gap-3",children:[e.jsxs(m,{children:[e.jsx(x,{className:"pb-1 px-2 md:px-6",children:e.jsx(o,{className:"text-xs font-medium text-muted-foreground",children:"Total Roles"})}),e.jsx(u,{className:"pt-1 px-2 md:px-6",children:e.jsx("div",{className:"text-base md:text-lg lg:text-xl font-bold",children:de})})]}),e.jsxs(m,{children:[e.jsx(x,{className:"pb-1 px-2 md:px-6",children:e.jsx(o,{className:"text-xs font-medium text-muted-foreground",children:"Active Roles"})}),e.jsx(u,{className:"pt-1 px-2 md:px-6",children:e.jsx("div",{className:"text-base md:text-lg lg:text-xl font-bold text-green-500",children:X.filter(e=>e.isActive).length})})]}),e.jsxs(m,{children:[e.jsx(x,{className:"pb-1 px-2 md:px-6",children:e.jsx(o,{className:"text-xs font-medium text-muted-foreground",children:"System Roles"})}),e.jsx(u,{className:"pt-1 px-2 md:px-6",children:e.jsx("div",{className:"text-base md:text-lg lg:text-xl font-bold text-blue-500",children:X.filter(e=>e.isSystemRole).length})})]}),e.jsxs(m,{className:"border-destructive/20 bg-destructive/10",children:[e.jsx(x,{className:"pb-1 px-2 md:px-6",children:e.jsxs(o,{className:"text-xs font-medium text-destructive flex items-center gap-1",children:[e.jsx(h,{className:"w-3 h-3"}),"Super Admin"]})}),e.jsx(u,{className:"pt-1 px-2 md:px-6",children:e.jsx("div",{className:"text-base md:text-lg lg:text-xl font-bold text-destructive",children:xe?.userCount||0})})]}),e.jsxs(m,{className:"border-orange-500/20 bg-orange-500/10",children:[e.jsx(x,{className:"pb-1 px-2 md:px-6",children:e.jsxs(o,{className:"text-xs font-medium text-orange-600 flex items-center gap-1",children:[e.jsx(h,{className:"w-3 h-3"}),"Sub Admin"]})}),e.jsx(u,{className:"pt-1 px-2 md:px-6",children:e.jsx("div",{className:"text-base md:text-lg lg:text-xl font-bold text-orange-500",children:ue?.userCount||0})})]})]}),(xe||ue)&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[xe&&e.jsxs(m,{className:"border-destructive/20 bg-gradient-to-br from-destructive/10 to-card",children:[e.jsxs(x,{className:"pb-3",children:[e.jsxs(o,{className:"flex items-center gap-2 text-destructive text-base md:text-lg",children:[e.jsx(h,{className:"w-4 h-4 md:w-5 md:h-5"}),"Super Admin Role"]}),e.jsx(j,{className:"text-sm",children:xe.description})]}),e.jsxs(u,{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsx(p,{variant:xe.isActive?"default":"secondary",className:"w-fit",children:xe.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Users:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-bold",children:xe.userCount||0})]})]}),e.jsx("div",{className:"pt-2",children:e.jsxs(r,{variant:"outline",size:"sm",className:"w-full",onClick:()=>t(`/admin/roles/edit/${xe._id}`),children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"View Details"]})})]})]}),ue&&e.jsxs(m,{className:"border-orange-500/20 bg-gradient-to-br from-orange-500/10 to-card",children:[e.jsxs(x,{className:"pb-3",children:[e.jsxs(o,{className:"flex items-center gap-2 text-orange-600 text-base md:text-lg",children:[e.jsx(h,{className:"w-4 h-4 md:w-5 md:h-5"}),"Sub Admin Role"]}),e.jsx(j,{className:"text-sm",children:ue.description})]}),e.jsxs(u,{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsx(p,{variant:ue.isActive?"default":"secondary",className:"w-fit",children:ue.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Users:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-bold",children:ue.userCount||0})]})]}),e.jsx("div",{className:"pt-2",children:e.jsxs(r,{variant:"outline",size:"sm",className:"w-full",onClick:()=>t(`/admin/roles/edit/${ue._id}`),children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"View Details"]})})]})]})]}),e.jsxs(m,{children:[e.jsxs(x,{className:"pb-4",children:[e.jsx(o,{className:"text-lg md:text-xl",children:"All Roles"}),e.jsxs(j,{className:"text-sm md:text-base",children:[de," role",1!==de?"s":""," found"]})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsx(F,{searchTerm:W,onSearchChange:ye,filterValue:K,onFilterChange:Se,filterOptions:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}],filterPlaceholder:"Filter by status"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(z,{columns:Ce,data:X.map(e=>({...e,id:e._id})),hideDefaultActions:!0})}),ce>1&&e.jsx("div",{className:"mt-4 md:mt-6",children:e.jsx(L,{children:e.jsxs(_,{className:"flex-wrap gap-1",children:[e.jsx(P,{children:e.jsx(I,{onClick:()=>{ie>1&&re(ie-1)},className:"text-xs md:text-sm "+(1===ie?"pointer-events-none opacity-50":"cursor-pointer")})}),Array.from({length:ce},(e,s)=>s+1).map(s=>e.jsx(P,{children:e.jsx(O,{onClick:()=>(e=>{re(e)})(s),isActive:ie===s,className:"cursor-pointer text-xs md:text-sm",children:s})},s)),e.jsx(P,{children:e.jsx(U,{onClick:()=>{ie<ce&&re(ie+1)},className:"text-xs md:text-sm "+(ie===ce?"pointer-events-none opacity-50":"cursor-pointer")})})]})})})]})]}),e.jsx(N,{open:je,onOpenChange:pe,children:e.jsxs(g,{className:"sm:max-w-[425px] mx-4",children:[e.jsxs(v,{children:[e.jsx(b,{className:"text-base md:text-lg",children:"Delete Role"}),e.jsxs(w,{className:"text-sm md:text-base",children:['Are you sure you want to delete the role "',fe?.name,'"? This action cannot be undone.',fe?.userCount&&fe.userCount>0?e.jsxs("div",{className:"mt-4 p-3 bg-destructive/10 border border-destructive/20 rounded-md",children:[e.jsxs("p",{className:"text-destructive font-semibold text-sm flex items-center gap-2",children:[e.jsx(h,{className:"h-4 w-4"}),"CRITICAL WARNING"]}),e.jsxs("p",{className:"text-destructive text-sm mt-1",children:["This role is currently assigned to ",e.jsxs("span",{className:"font-bold",children:[fe.userCount," user(s)"]}),". Deleting this role will ",e.jsx("span",{className:"font-bold underline",children:"PERMANENTLY DELETE ALL THESE USERS"}),"."]})]}):e.jsx("p",{className:"text-muted-foreground mt-2 text-sm",children:"There are currently no users assigned to this role."})]})]}),e.jsxs(y,{className:"flex flex-col-reverse sm:flex-row gap-2 sm:gap-0",children:[e.jsx(r,{variant:"outline",onClick:()=>{pe(!1),Ne(null)},disabled:ge,className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(r,{variant:"destructive",onClick:async()=>{if(fe)try{ve(!0),await M.deleteRole(fe._id),pe(!1);const e=fe._id;Ne(null),ee(s=>s.filter(s=>s._id!==e)),me(e=>e-1),S({title:"Success",description:"Role deleted successfully!"})}catch(e){}finally{ve(!1)}},disabled:ge,className:"w-full sm:w-auto",children:ge?e.jsxs(e.Fragment,{children:[e.jsx(i,{className:"w-4 h-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete Role"})]})]})})]})};export{q as default};

import{j as e}from"./ui-DHQhougw.js";import{e as a,d as r,r as s}from"./router-Bi51YGN-.js";import{a0 as t,ax as i,f as l,A as o,a as d,b as c,c as n,e as p,L as m,I as h,S as u,r as x,s as j,v as g,w as y,T as v,p as f,$ as b,X as N,O as A,aj as C}from"./index-D7KzNfIb.js";import{C as F}from"./checkbox-BfDnM2ZP.js";import{R as P,a as w}from"./radio-group-BfQQJz0B.js";import{C as S}from"./camera-vVtOmo1v.js";import{V as T}from"./video-CkyKbw56.js";import"./vendor-eVk5PToZ.js";const U=async(e,a)=>{const r=new FormData;r.append("file",e),r.append("folder",a);try{const e=await fetch("https://api.akodefy.com/api/upload/single",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:r});if(!e.ok)throw new Error("Failed to upload file");const a=await e.json();if(!a.success)throw new Error(a.message||"Upload failed");return a.data.url}catch(s){throw new Error("Failed to upload file")}},k=()=>{const{id:k}=a(),q=r(),{toast:V}=t(),[B,E]=s.useState(null),[I,L]=s.useState(!0),[R,O]=s.useState(!1),[D,$]=s.useState([]),[M,z]=s.useState([]),[G,W]=s.useState({title:"",description:"",type:"",listingType:"",price:"",bedrooms:"",bathrooms:"",builtUpArea:"",carpetArea:"",plotArea:"",street:"",city:"",state:"",pincode:"",amenities:[],virtualTour:""});s.useEffect(()=>{k&&_(k)},[k]);const _=async e=>{try{L(!0);const a=(await i.getProperty(e)).data.property;E(a),W({title:a.title,description:a.description,type:a.type,listingType:a.listingType,price:a.price.toString(),bedrooms:a.bedrooms.toString(),bathrooms:a.bathrooms.toString(),builtUpArea:a.area.builtUp?.toString()||"",carpetArea:a.area.carpet?.toString()||"",plotArea:a.area.plot?.toString()||"",street:a.address.street,city:a.address.city,state:a.address.state,pincode:a.address.pincode,amenities:a.amenities||[],virtualTour:a.virtualTour||""}),a.videos&&z(a.videos.map((e,a)=>({id:`existing-video-${a}`,name:e.caption||`Video ${a+1}`,url:e.url}))),a.images&&$(a.images.map((e,a)=>({id:`existing-${a}`,name:e.caption||`Image ${a+1}`,url:e.url,isPrimary:e.isPrimary})))}catch(a){V({title:"Error",description:"Failed to load property details",variant:"destructive"}),q("/vendor/properties")}finally{L(!1)}},Y=(e,a)=>{W(r=>({...r,[e]:a}))};return I?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading property..."})]})}):B?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>q("/vendor/properties"),children:e.jsx(o,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Edit Property"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Update your property details"})]})]})}),e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),!B||R)return;const a={title:G.title?.trim(),description:G.description?.trim(),type:G.type,listingType:G.listingType,price:G.price,city:G.city?.trim(),pincode:G.pincode?.trim()},r=Object.entries(a).filter(([e,a])=>!a).map(([e])=>e);if(r.length>0)V({title:"Missing Required Fields",description:`Please fill in: ${r.join(", ")}`,variant:"destructive"});else{O(!0);try{const e=[];for(const s of D)if(s.file){const a=await U(s.file,"property_images");e.push({url:a,caption:s.name,isPrimary:s.isPrimary})}else e.push({url:s.url,caption:s.name,isPrimary:s.isPrimary});const a=[];for(const s of M)if(s.file){const e=await U(s.file,"property_videos");a.push({url:e,caption:s.name})}else a.push({url:s.url,caption:s.name});const r={title:G.title.trim(),description:G.description.trim(),type:G.type,listingType:G.listingType,price:parseFloat(G.price),bedrooms:parseInt(G.bedrooms)||0,bathrooms:parseInt(G.bathrooms)||0,area:{builtUp:G.builtUpArea?parseFloat(G.builtUpArea):void 0,carpet:G.carpetArea?parseFloat(G.carpetArea):void 0,plot:G.plotArea?parseFloat(G.plotArea):void 0,unit:"sqft"},address:{street:G.street.trim()||"",locality:"",city:G.city.trim(),state:G.state.trim(),pincode:G.pincode.trim()},amenities:G.amenities,images:e,videos:a};G.virtualTour?.trim()&&(r.virtualTour=G.virtualTour.trim()),await i.updateProperty(B._id,r),V({title:"Success!",description:"Property updated successfully."}),q(`/vendor/properties/details/${B._id}`)}catch(s){let e="Failed to update property. Please try again.";s instanceof Error&&(e=s.message),V({title:"Error",description:e,variant:"destructive"})}finally{O(!1)}}},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(d,{children:[e.jsx(c,{children:e.jsx(n,{children:"Basic Details"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"title",children:"Property Title *"}),e.jsx(h,{id:"title",value:G.title,onChange:e=>Y("title",e.target.value),placeholder:"Enter property title",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"type",children:"Property Type *"}),e.jsxs(u,{value:G.type,onValueChange:e=>Y("type",e),children:[e.jsx(x,{children:e.jsx(j,{placeholder:"Select property type"})}),e.jsx(g,{children:[{value:"apartment",label:"Apartment"},{value:"villa",label:"Villa"},{value:"house",label:"House"},{value:"commercial",label:"Commercial"},{value:"plot",label:"Plot"},{value:"land",label:"Land"},{value:"office",label:"Office Space"},{value:"pg",label:"PG (Paying Guest)"}].map(a=>e.jsx(y,{value:a.value,children:a.label},a.value))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Listing Type *"}),e.jsxs(P,{value:G.listingType,onValueChange:e=>Y("listingType",e),className:"flex flex-row space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{value:"sale",id:"sale"}),e.jsx(m,{htmlFor:"sale",children:"For Sale"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{value:"rent",id:"rent"}),e.jsx(m,{htmlFor:"rent",children:"For Rent"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{value:"lease",id:"lease"}),e.jsx(m,{htmlFor:"lease",children:"For Lease"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"description",children:"Description"}),e.jsx(v,{id:"description",value:G.description,onChange:e=>Y("description",e.target.value),placeholder:"Describe your property...",rows:4})]})]})]}),e.jsxs(d,{children:[e.jsx(c,{children:e.jsx(n,{children:"Property Details"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"price",children:"Price *"}),e.jsx(h,{id:"price",type:"number",value:G.price,onChange:e=>Y("price",e.target.value),placeholder:"Enter price",required:!0})]}),["apartment","villa","house","pg"].includes(G.type)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"bedrooms",children:"pg"===G.type?"Room Sharing":"Bedrooms"}),e.jsx(h,{id:"bedrooms",type:"number",value:G.bedrooms,onChange:e=>Y("bedrooms",e.target.value),placeholder:"pg"===G.type?"Number of people per room":"Number of bedrooms",min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"bathrooms",children:"pg"===G.type?"Bathroom Type":"Bathrooms"}),e.jsx(h,{id:"bathrooms",type:"number",value:G.bathrooms,onChange:e=>Y("bathrooms",e.target.value),placeholder:"pg"===G.type?"0 for Common, 1 for Attached":"Number of bathrooms",min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"builtUpArea",children:"pg"===G.type?"Room Area (sq ft)":"Built-up Area (sq ft)"}),e.jsx(h,{id:"builtUpArea",type:"number",value:G.builtUpArea,onChange:e=>Y("builtUpArea",e.target.value),placeholder:"pg"===G.type?"Room area":"Built-up area"})]})]}),"pg"!==G.type&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"carpetArea",children:"Carpet Area (sq ft)"}),e.jsx(h,{id:"carpetArea",type:"number",value:G.carpetArea,onChange:e=>Y("carpetArea",e.target.value),placeholder:"Carpet area"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"plotArea",children:"Plot Area (sq ft)"}),e.jsx(h,{id:"plotArea",type:"number",value:G.plotArea,onChange:e=>Y("plotArea",e.target.value),placeholder:"Plot area (for villa/house)"})]})]})]}),["commercial","office"].includes(G.type)&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"builtUpArea",children:"Built-up Area (sq ft) *"}),e.jsx(h,{id:"builtUpArea",type:"number",value:G.builtUpArea,onChange:e=>Y("builtUpArea",e.target.value),placeholder:"Total built-up area"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"carpetArea",children:"Carpet Area (sq ft)"}),e.jsx(h,{id:"carpetArea",type:"number",value:G.carpetArea,onChange:e=>Y("carpetArea",e.target.value),placeholder:"Usable carpet area"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"bathrooms",children:"Washrooms"}),e.jsx(h,{id:"bathrooms",type:"number",value:G.bathrooms,onChange:e=>Y("bathrooms",e.target.value),placeholder:"Number of washrooms",min:"0"})]})]})}),["plot","land"].includes(G.type)&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"plotArea",children:"Plot Area (sq ft) *"}),e.jsx(h,{id:"plotArea",type:"number",value:G.plotArea,onChange:e=>Y("plotArea",e.target.value),placeholder:"Total plot area"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"builtUpArea",children:"Total Area (sq ft) *"}),e.jsx(h,{id:"builtUpArea",type:"number",value:G.builtUpArea,onChange:e=>Y("builtUpArea",e.target.value),placeholder:"Same as plot area"})]})]})})]})]}),e.jsxs(d,{children:[e.jsx(c,{children:e.jsx(n,{children:"Location"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"street",children:"Street Address"}),e.jsx(h,{id:"street",value:G.street,onChange:e=>Y("street",e.target.value),placeholder:"Street address"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"city",children:"City *"}),e.jsx(h,{id:"city",value:G.city,onChange:e=>Y("city",e.target.value),placeholder:"City",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"state",children:"State *"}),e.jsx(h,{id:"state",value:G.state,onChange:e=>Y("state",e.target.value),placeholder:"State",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"pincode",children:"PIN Code *"}),e.jsx(h,{id:"pincode",value:G.pincode,onChange:e=>Y("pincode",e.target.value),placeholder:"PIN Code",maxLength:6,pattern:"[0-9]{6}",required:!0})]})]})]})]}),e.jsxs(d,{children:[e.jsx(c,{children:e.jsx(n,{children:"Amenities"})}),e.jsx(p,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:["Swimming Pool","Gym/Fitness Center","Parking","Security","Garden/Park","Playground","Clubhouse","Power Backup","Elevator","WiFi","CCTV Surveillance","Intercom","Water Supply","Waste Management","Fire Safety","Visitor Parking","Shopping Complex","Restaurant","Spa","Jogging Track"].map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:a,checked:G.amenities.includes(a),onCheckedChange:()=>(e=>{W(a=>({...a,amenities:a.amenities.includes(e)?a.amenities.filter(a=>a!==e):[...a.amenities,e]}))})(a)}),e.jsx(m,{htmlFor:a,className:"text-sm",children:a})]},a))})})]}),e.jsxs(d,{children:[e.jsx(c,{children:e.jsx(n,{children:"Property Images"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-8 text-center",children:[e.jsx(S,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{type:"button",variant:"outline",onClick:()=>document.getElementById("image-upload")?.click(),children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"Add Images"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload high-quality images of your property"})]}),e.jsx("input",{id:"image-upload",type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:e=>{if(e.target.files){const a=Array.from(e.target.files);$(e=>[...e,...a.map(a=>({id:Date.now()+Math.random(),name:a.name,url:URL.createObjectURL(a),file:a,isPrimary:0===e.length}))])}}})]}),D.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:D.map(a=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:a.url,alt:a.name,className:"w-full h-24 object-cover rounded-lg"}),a.isPrimary&&e.jsx("div",{className:"absolute top-1 left-1 bg-primary text-primary-foreground text-xs px-2 py-1 rounded",children:"Primary"}),e.jsxs("div",{className:"absolute top-1 right-1 flex gap-1",children:[!a.isPrimary&&e.jsx(l,{type:"button",size:"icon",variant:"secondary",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{return e=a.id,void $(a=>a.map(a=>({...a,isPrimary:a.id===e})));var e},title:"Set as primary image",children:e.jsx(b,{className:"h-3 w-3"})}),e.jsx(l,{type:"button",size:"icon",variant:"destructive",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{return e=a.id,void $(a=>{const r=a.filter(a=>a.id!==e);return r.length>0&&!r.some(e=>e.isPrimary)&&(r[0].isPrimary=!0),r});var e},children:e.jsx(N,{className:"h-3 w-3"})})]})]},a.id))})]})]}),e.jsxs(d,{children:[e.jsx(c,{children:e.jsx(n,{children:"Property Videos (Optional)"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-8 text-center",children:[e.jsx(T,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{type:"button",variant:"outline",onClick:()=>document.getElementById("video-upload")?.click(),children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"Upload Video"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"MP4, MOV, AVI (max 100MB)"})]}),e.jsx("input",{id:"video-upload",type:"file",multiple:!0,accept:"video/*",className:"hidden",onChange:e=>{if(e.target.files){const a=Array.from(e.target.files);z(e=>[...e,...a.map(e=>({id:Date.now()+Math.random(),name:e.name,url:URL.createObjectURL(e),file:e}))])}}})]}),M.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:M.map(a=>e.jsx("div",{className:"relative border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(T,{className:"w-8 h-8 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:a.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Video file"})]}),e.jsx(l,{type:"button",size:"icon",variant:"destructive",className:"h-6 w-6",onClick:()=>{return e=a.id,void z(a=>a.filter(a=>a.id!==e));var e},children:e.jsx(N,{className:"h-3 w-3"})})]})},a.id))})]})]}),e.jsxs(d,{children:[e.jsx(c,{children:e.jsx(n,{children:"Virtual Tour (Optional)"})}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"virtualTour",children:"Virtual Tour URL"}),e.jsx(h,{id:"virtualTour",placeholder:"e.g., https://your-virtual-tour-link.com or YouTube link",value:G.virtualTour,onChange:e=>Y("virtualTour",e.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Add a virtual tour link, YouTube video, or 360Â° tour to showcase your property"})]})})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>q("/vendor/properties"),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:R,children:R?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]})]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Property Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The property you're trying to edit doesn't exist."}),e.jsxs(l,{onClick:()=>q("/vendor/properties"),children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"Back to Properties"]})]})};export{k as default};

import{t as e,b2 as t}from"./index-Bb9pk9gg.js";import{r}from"./reviewsService-BM2B43lu.js";import{R as a,r as n}from"./router-D8v2YSKU.js";import{i as o,D as i,f as s,E as c,b as l,c as u,d as p,A as d,e as y,g as f,h,j as m,k as v,l as g,u as b,G as w,m as S}from"./generateCategoricalChart-DdZGRwUR.js";const A="https://app.buildhomemartsquares.com/api";const P=new class{async makeRequest(e,t={}){const r=`${A}${e}`,a={headers:{"Content-Type":"application/json",...t.headers},...t},n=localStorage.getItem("token");n&&(a.headers={...a.headers,Authorization:`Bearer ${n}`});try{const e=await fetch(r,a);if(!e.ok){const t=await e.json().catch(()=>({success:!1,message:`HTTP ${e.status}: ${e.statusText}`}));throw new Error(t.message||"An error occurred")}return await e.json()}catch(o){throw o}}async getOverviewStats(e){try{const a=new URLSearchParams;a.append("timeframe",e.timeframe),e.propertyId&&a.append("propertyId",e.propertyId),e.dateFrom&&a.append("dateFrom",e.dateFrom),e.dateTo&&a.append("dateTo",e.dateTo);const n=`/vendors/analytics/overview?${a.toString()}`,o=await this.makeRequest(n);if(o.success&&o.data){try{const e=await r.getReviewStats();o.data.averageRating=e.averageRating}catch(t){}return o.data}let i=0;try{i=(await r.getReviewStats()).averageRating}catch(t){}return{totalViews:0,totalLeads:0,totalCalls:0,totalMessages:0,totalRevenue:0,soldPropertyRevenue:0,leasedPropertyRevenue:0,rentedPropertyRevenue:0,totalProperties:0,averageRating:i,responseTime:"Not calculated",conversionRate:0}}catch(a){let e=0;try{e=(await r.getReviewStats()).averageRating}catch(t){}return{totalViews:0,totalLeads:0,totalCalls:0,totalMessages:0,totalRevenue:0,soldPropertyRevenue:0,leasedPropertyRevenue:0,rentedPropertyRevenue:0,totalProperties:0,averageRating:e,responseTime:"Not calculated",conversionRate:0}}}async getPerformanceMetrics(e){try{const t=new URLSearchParams;t.append("timeframe",e.timeframe),e.propertyId&&t.append("propertyId",e.propertyId),e.dateFrom&&t.append("dateFrom",e.dateFrom),e.dateTo&&t.append("dateTo",e.dateTo);const r=`/vendors/analytics/performance?${t.toString()}`,a=await this.makeRequest(r);return a.success&&a.data?a.data:{viewsData:[],leadsData:[],conversionData:[],revenueData:[],propertyPerformance:[],leadSources:[],demographicsData:[]}}catch(t){return{viewsData:[],leadsData:[],conversionData:[],revenueData:[],propertyPerformance:[],leadSources:[],demographicsData:[]}}}async exportAnalyticsData(t,r="csv"){try{const a=new URLSearchParams;a.append("timeframe",t.timeframe),a.append("format",r),t.propertyId&&a.append("propertyId",t.propertyId),t.dateFrom&&a.append("dateFrom",t.dateFrom),t.dateTo&&a.append("dateTo",t.dateTo);const n=`/vendors/analytics/export?${a.toString()}`,o=await fetch(`${A}${n}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!o.ok)throw new Error("Failed to export analytics data");const i=await o.blob();return e({title:"Success",description:`Analytics data exported as ${r.toUpperCase()}!`}),i}catch(a){const t=a instanceof Error?a.message:"Failed to export analytics data";throw e({title:"Error",description:t,variant:"destructive"}),a}}formatCurrency(e){return null==e||isNaN(e)?"₹0":`₹${e.toLocaleString("en-IN")}`}formatNumber(e){return null==e||isNaN(e)?"0":e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toString()}formatPercentage(e){return null==e||isNaN(e)?"0%":`${e.toFixed(1)}%`}calculateChangePercentage(e,t){return 0===t?e>0?100:0:(e-t)/t*100}getChangeType(e){return e>0?"increase":e<0?"decrease":"neutral"}getChangeColor(e){switch(e){case"increase":return"text-green-600";case"decrease":return"text-red-600";case"neutral":return"text-gray-600"}}generateDateRange(e){const t=new Date,r=[];switch(e){case"7days":for(let e=6;e>=0;e--){const a=new Date(t);a.setDate(a.getDate()-e),r.push({name:a.toLocaleDateString("en-US",{weekday:"short"}),value:0})}break;case"30days":for(let e=29;e>=0;e--){const a=new Date(t);a.setDate(a.getDate()-e),r.push({name:a.getDate().toString(),value:0})}break;case"90days":for(let e=11;e>=0;e--){const a=new Date(t);a.setMonth(a.getMonth()-e),r.push({name:a.toLocaleDateString("en-US",{month:"short"}),value:0})}break;case"1year":for(let e=11;e>=0;e--){const a=new Date(t);a.setMonth(a.getMonth()-e),r.push({name:a.toLocaleDateString("en-US",{month:"short"}),value:0})}}return r}downloadBlob(e,t){const r=window.URL.createObjectURL(e),a=document.createElement("a");a.href=r,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(r)}async getConsolidatedAdminAnalytics(e="30",t,r){let a=`/analytics/en-new/admin?dateRange=${e}`;return t&&(a+=`&startDate=${t.toISOString()}`),r&&(a+=`&endDate=${r.toISOString()}`),this.makeRequest(a)}async getOverview(e="30"){return this.makeRequest(`/analytics/overview?dateRange=${e}`)}async getPropertyViews(e="30",t){const r=new URLSearchParams({dateRange:e});return t&&r.append("propertyId",t),this.makeRequest(`/analytics/property-views?${r.toString()}`)}async getUserConversion(e="30"){return this.makeRequest(`/analytics/user-conversion?dateRange=${e}`)}async getTrafficAnalytics(e="30"){return this.makeRequest(`/analytics/traffic?dateRange=${e}`)}async getEngagementAnalytics(e="30"){return this.makeRequest(`/analytics/engagement?dateRange=${e}`)}async getPropertyViewDetails(e,t="30"){return this.makeRequest(`/analytics/property-views/${e}?dateRange=${t}`)}async getAllPropertyViewers(e="30",t,r,a){let n=`/analytics/all-property-viewers?dateRange=${e}`;return t&&(n+=`&propertyId=${t}`),r&&(n+=`&startDate=${r.toISOString()}`),a&&(n+=`&endDate=${a.toISOString()}`),this.makeRequest(n)}async getAnalyticsJobStatus(){return this.makeRequest("/analytics/job-status")}async triggerAnalyticsRecalculation(){return this.makeRequest("/analytics/recalculate",{method:"POST"})}async getAnalyticsSnapshot(e="30"){return this.makeRequest(`/analytics/snapshot?dateRange=${e}`)}async getComprehensiveTrafficAnalytics(e="30"){return this.makeRequest(`/traffic/analytics?dateRange=${e}`)}async getRealtimeTraffic(){return this.makeRequest("/traffic/realtime")}async getPropertyReport(){return this.makeRequest("/analytics/en-new/admin/property-report")}};var k=["type","layout","connectNulls","ref"],R=["key"];function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;r[a]=e[a]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function D(){return D=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},D.apply(this,arguments)}function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach(function(t){q(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function T(e){return function(e){if(Array.isArray(e))return $(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return $(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function C(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,U(a.key),a)}}function I(e,t,r){return t=F(t),function(e,t){if(t&&("object"===O(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,L()?Reflect.construct(t,r||[],F(e).constructor):t.apply(e,r))}function L(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(L=function(){return!!e})()}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function N(e,t){return(N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function q(e,t,r){return(t=U(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function U(e){var t=function(e,t){if("object"!=O(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t);if("object"!=O(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==O(t)?t:t+""}var M=function(){function e(){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);for(var r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];return q(t=I(this,e,[].concat(a)),"state",{isAnimationFinished:!0,totalLength:0}),q(t,"generateSimpleStrokeDasharray",function(e,t){return"".concat(t,"px ").concat(e-t,"px")}),q(t,"getStrokeDasharray",function(r,a,n){var o=n.reduce(function(e,t){return e+t});if(!o)return t.generateSimpleStrokeDasharray(a,r);for(var i=Math.floor(r/o),s=r%o,c=a-r,l=[],u=0,p=0;u<n.length;p+=n[u],++u)if(p+n[u]>s){l=[].concat(T(n.slice(0,u)),[s-p]);break}var d=l.length%2==0?[0,c]:[c];return[].concat(T(e.repeat(n,i)),T(l),d).map(function(e){return"".concat(e,"px")}).join(", ")}),q(t,"id",b("recharts-line-")),q(t,"pathRef",function(e){t.mainCurve=e}),q(t,"handleAnimationEnd",function(){t.setState({isAnimationFinished:!0}),t.props.onAnimationEnd&&t.props.onAnimationEnd()}),q(t,"handleAnimationStart",function(){t.setState({isAnimationFinished:!1}),t.props.onAnimationStart&&t.props.onAnimationStart()}),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&N(e,t)}(e,n.PureComponent),r=e,S=[{key:"getDerivedStateFromProps",value:function(e,t){return e.animationId!==t.prevAnimationId?{prevAnimationId:e.animationId,curPoints:e.points,prevPoints:t.curPoints}:e.points!==t.curPoints?{curPoints:e.points}:null}},{key:"repeat",value:function(e,t){for(var r=e.length%2!=0?[].concat(T(e),[0]):e,a=[],n=0;n<t;++n)a=[].concat(T(a),T(r));return a}},{key:"renderDotItem",value:function(e,r){var n;if(a.isValidElement(e))n=a.cloneElement(e,r);else if(o(e))n=e(r);else{var s=r.key,c=x(r,R),l=t("recharts-line-dot","boolean"!=typeof e?e.className:"");n=a.createElement(i,D({key:s},c,{className:l}))}return n}}],(w=[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var e=this.getTotalLength();this.setState({totalLength:e})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var e=this.getTotalLength();e!==this.state.totalLength&&this.setState({totalLength:e})}}},{key:"getTotalLength",value:function(){var e=this.mainCurve;try{return e&&e.getTotalLength&&e.getTotalLength()||0}catch(t){return 0}}},{key:"renderErrorBar",value:function(e,t){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var r=this.props,n=r.points,o=r.xAxis,i=r.yAxis,u=r.layout,p=r.children,d=s(p,c);if(!d)return null;var y=function(e,t){return{x:e.x,y:e.y,value:e.value,errorVal:g(e.payload,t)}},f={clipPath:e?"url(#clipPath-".concat(t,")"):null};return a.createElement(l,f,d.map(function(e){return a.cloneElement(e,{key:"bar-".concat(e.props.dataKey),data:n,xAxis:o,yAxis:i,layout:u,dataPointFormatter:y})}))}},{key:"renderDots",value:function(t,r,n){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,i=o.dot,s=o.points,c=o.dataKey,p=u(this.props,!1),d=u(i,!0),y=s.map(function(t,r){var a=E(E(E({key:"dot-".concat(r),r:3},p),d),{},{index:r,cx:t.x,cy:t.y,value:t.value,dataKey:c,payload:t.payload,points:s});return e.renderDotItem(i,a)}),f={clipPath:t?"url(#clipPath-".concat(r?"":"dots-").concat(n,")"):null};return a.createElement(l,D({className:"recharts-line-dots",key:"dots"},f),y)}},{key:"renderCurveStatically",value:function(e,t,r,n){var o=this.props,i=o.type,s=o.layout,c=o.connectNulls;o.ref;var l=x(o,k),d=E(E(E({},u(l,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:t?"url(#clipPath-".concat(r,")"):null,points:e},n),{},{type:i,layout:s,connectNulls:c});return a.createElement(p,D({},d,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(e,t){var r=this,n=this.props,o=n.points,i=n.strokeDasharray,s=n.isAnimationActive,c=n.animationBegin,l=n.animationDuration,u=n.animationEasing,p=n.animationId,f=n.animateNewValues,h=n.width,m=n.height,v=this.state,g=v.prevPoints,b=v.totalLength;return a.createElement(d,{begin:c,duration:l,isActive:s,easing:u,from:{t:0},to:{t:1},key:"line-".concat(p),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(a){var n=a.t;if(g){var s=g.length/o.length,c=o.map(function(e,t){var r=Math.floor(t*s);if(g[r]){var a=g[r],o=y(a.x,e.x),i=y(a.y,e.y);return E(E({},e),{},{x:o(n),y:i(n)})}if(f){var c=y(2*h,e.x),l=y(m/2,e.y);return E(E({},e),{},{x:c(n),y:l(n)})}return E(E({},e),{},{x:e.x,y:e.y})});return r.renderCurveStatically(c,e,t)}var l,u=y(0,b)(n);if(i){var p="".concat(i).split(/[,\s]+/gim).map(function(e){return parseFloat(e)});l=r.getStrokeDasharray(u,b,p)}else l=r.generateSimpleStrokeDasharray(b,u);return r.renderCurveStatically(o,e,t,{strokeDasharray:l})})}},{key:"renderCurve",value:function(e,t){var r=this.props,a=r.points,n=r.isAnimationActive,o=this.state,i=o.prevPoints,s=o.totalLength;return n&&a&&a.length&&(!i&&s>0||!f(i,a))?this.renderCurveWithAnimation(e,t):this.renderCurveStatically(a,e,t)}},{key:"render",value:function(){var e,r=this.props,n=r.hide,o=r.dot,i=r.points,s=r.className,c=r.xAxis,p=r.yAxis,d=r.top,y=r.left,f=r.width,g=r.height,b=r.isAnimationActive,w=r.id;if(n||!i||!i.length)return null;var S=this.state.isAnimationFinished,A=1===i.length,P=t("recharts-line",s),k=c&&c.allowDataOverflow,R=p&&p.allowDataOverflow,O=k||R,x=h(w)?this.id:w,D=null!==(e=u(o,!1))&&void 0!==e?e:{r:3,strokeWidth:2},j=D.r,E=void 0===j?3:j,T=D.strokeWidth,$=void 0===T?2:T,C=(m(o)?o:{}).clipDot,I=void 0===C||C,L=2*E+$;return a.createElement(l,{className:P},k||R?a.createElement("defs",null,a.createElement("clipPath",{id:"clipPath-".concat(x)},a.createElement("rect",{x:k?y:y-f/2,y:R?d:d-g/2,width:k?f:2*f,height:R?g:2*g})),!I&&a.createElement("clipPath",{id:"clipPath-dots-".concat(x)},a.createElement("rect",{x:y-L/2,y:d-L/2,width:f+L,height:g+L}))):null,!A&&this.renderCurve(O,x),this.renderErrorBar(O,x),(A||o)&&this.renderDots(O,I,x),(!b||S)&&v.renderCallByParent(this.props,i))}}])&&C(r.prototype,w),S&&C(r,S),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,w,S}();q(M,"displayName","Line"),q(M,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!w.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1}),q(M,"getComposedData",function(e){var t=e.props,r=e.xAxis,a=e.yAxis,n=e.xAxisTicks,o=e.yAxisTicks,i=e.dataKey,s=e.bandSize,c=e.displayedData,l=e.offset,u=t.layout;return E({points:c.map(function(e,t){var c=g(e,i);return"horizontal"===u?{x:S({axis:r,ticks:n,bandSize:s,entry:e,index:t}),y:h(c)?null:a.scale(c),value:c,payload:e}:{x:h(c)?null:r.scale(c),y:S({axis:a,ticks:o,bandSize:s,entry:e,index:t}),value:c,payload:e}}),layout:u},l)});export{M as L,P as a};

import{j as e}from"./ui-s1SEoZIF.js";import{e as i,d as s,r as a}from"./router-D8v2YSKU.js";import{u as n,_ as t,x as r,f as o,A as l,i as c,aj as d,a as p,b as m,c as h,d as u,e as y,aC as f,V as x}from"./index-YrVmIx3a.js";import{f as v,h as g}from"./apiUtils-B8LmEMCW.js";import"./vendor-BxThA0WO.js";const b=()=>{const{policyType:b}=i(),j=s(),{user:w}=n(),N=w?.rolePermissions||[],{toast:C}=t(),[P,S]=a.useState(""),[I,k]=a.useState(!0),[E,R]=a.useState(!1),[Y,D]=a.useState(""),L="admin"===w?.role||"superadmin"===w?.role,T=e=>N.includes(e),W=L||T(x.POLICIES_READ),A=L||T(x.POLICIES_EDIT_PRIVACY),F=L||T(x.POLICIES_EDIT_REFUND),$=a.useMemo(()=>"privacy-policy"===b?"Privacy Policy":"refund-policy"===b?"Refund & Cancellation Policy":"Policy",[b]),_=a.useMemo(()=>"privacy-policy"===b?A:"refund-policy"===b&&F,[b,A,F]);a.useEffect(()=>W?"privacy-policy"!==b&&"refund-policy"!==b?(C({title:"Invalid Policy Type",description:"The specified policy type is invalid.",variant:"destructive"}),void j("/rolebased")):void O():(C({title:"Access Denied",description:"You don't have permission to view policies.",variant:"destructive"}),void j("/rolebased")),[b]);const O=async()=>{if(W)try{k(!0);const e=await v(`/subadmin/policies/${b}`);if(e.ok){const i=(await g(e)).data.content||U();S(i),D(i)}else{const e=U();S(e),D(e)}}catch(e){const i=U();S(i),D(i),C({title:"Info",description:"Loaded default policy content"})}finally{k(!1)}},U=()=>"privacy-policy"===b?"\n        <h2>1. Information We Collect</h2>\n        <p>We collect information that you provide directly to us, including when you create an account, list a property, contact us, or use our services.</p>\n        \n        <h2>2. How We Use Your Information</h2>\n        <p>We use the information we collect to provide, maintain, and improve our services.</p>\n        \n        <h2>3. Information Sharing</h2>\n        <p>We do not share your personal information with third parties except as described in this policy.</p>\n        \n        <h2>4. Data Security</h2>\n        <p>We implement appropriate technical and organizational measures to protect your personal information.</p>\n        \n        <h2>5. Your Rights</h2>\n        <p>You have the right to access, update, or delete your personal information at any time.</p>\n      ":"\n        <h2>1. Subscription Refund Policy</h2>\n        <p>We offer a 7-day money-back guarantee on all subscription plans.</p>\n        \n        <h2>2. Cancellation Process</h2>\n        <p>You may cancel your subscription at any time through your account settings.</p>\n        \n        <h2>3. Refund Eligibility</h2>\n        <p>Refunds are available under specific conditions outlined in this section.</p>\n        \n        <h2>4. Non-Refundable Items</h2>\n        <p>Certain items and services are not eligible for refunds.</p>\n        \n        <h2>5. Refund Processing Time</h2>\n        <p>Approved refunds will be processed within 5-7 business days.</p>\n      ",z=async()=>{if(_)try{R(!0);const e=await v(`/subadmin/policies/${b}`,{method:"PUT",body:JSON.stringify({content:P})});await g(e),D(P),C({title:"Success",description:`${$} updated successfully. Email notifications sent to all users.`})}catch(e){C({title:"Error",description:e.message||"Failed to save policy. Please try again.",variant:"destructive"})}finally{R(!1)}else C({title:"Access Denied",description:`You don't have permission to edit the ${$.toLowerCase()}.`,variant:"destructive"})},V={toolbar:!!_&&[[{header:[1,2,3,4,5,6,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],[{align:[]}],["link"],["clean"]]},M=P!==Y;return I?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(r,{className:"h-8 w-8 animate-spin mr-2"}),e.jsx("span",{className:"text-lg",children:"Loading policy..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(o,{variant:"outline",size:"icon",onClick:()=>j("/rolebased"),children:e.jsx(l,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-2",children:[e.jsx(c,{className:"w-8 h-8 text-primary"}),$]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:_?`Edit and manage your ${$.toLowerCase()}`:`View ${$.toLowerCase()}`})]})]}),_&&e.jsx(o,{onClick:z,disabled:E||!M,children:E?e.jsxs(e.Fragment,{children:[e.jsx(r,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]}),!_&&e.jsx("div",{className:"bg-amber-50 dark:bg-amber-950 border border-amber-200 dark:border-amber-800 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:"ℹ️ You have read-only access to this policy. Contact an administrator to request edit permissions."})}),e.jsxs(p,{children:[e.jsxs(m,{children:[e.jsx(h,{children:"Policy Content"}),e.jsx(u,{children:_?"Use the rich text editor below to edit the policy content. Changes will be reflected on the public-facing pages.":"View the current policy content below."})]}),e.jsx(y,{children:e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx(f,{theme:"snow",value:P,onChange:S,modules:V,formats:["header","bold","italic","underline","strike","list","bullet","indent","align","link"],className:"min-h-[500px]",readOnly:!_})})})]}),_&&M&&e.jsxs("div",{className:"fixed bottom-6 right-6 bg-card border rounded-lg shadow-lg p-4 flex items-center gap-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"You have unsaved changes"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:O,children:"Discard"}),e.jsx(o,{size:"sm",onClick:z,disabled:E,children:E?e.jsxs(e.Fragment,{children:[e.jsx(r,{className:"w-3 h-3 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"w-3 h-3 mr-2"}),"Save"]})})]})]})]})};export{b as default};

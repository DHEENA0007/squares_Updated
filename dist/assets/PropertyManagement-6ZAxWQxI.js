import{j as e}from"./ui-BNZSgpjP.js";import{r as s,d as t}from"./router-D8v2YSKU.js";import{D as i,a2 as a,a3 as r,a4 as l,a5 as d,a6 as c,a7 as n,a8 as o,f as p,a9 as h,aa as u,ab as x,B as m,ac as y,ad as j,ae as g,L as v,I as f,q as N,r as w,s as C,v as b,w as _,u as T,af as S,ag as A,ah as F,ai as P,Z as k,Y as O,a as E,e as L}from"./index-CM8T-gRV.js";import{T as I,a as M,b as R,c as q,d as D,e as z}from"./table-eRu5kCA2.js";import{P as U}from"./pencil-GtOH3KQn.js";import{C as V}from"./checkbox-CHt0TJj6.js";import{A as $,a as B}from"./alert-Cpy5Aw5p.js";import"./vendor-BxThA0WO.js";const Y=i("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),K=[{value:"text",label:"Text Input"},{value:"number",label:"Number Input"},{value:"select",label:"Single Select"},{value:"multiselect",label:"Multi Select"},{value:"boolean",label:"Yes/No"}],G=({propertyType:t,isOpen:i,onClose:T})=>{const[S,A]=s.useState([]),[F,P]=s.useState(!1),[k,O]=s.useState(!1),[E,L]=s.useState(null),[V,$]=s.useState(""),[B,G]=s.useState({propertyTypeId:t._id,fieldName:"",fieldLabel:"",fieldType:"text",fieldOptions:[],isRequired:!1,displayOrder:0}),{toast:H}=a();s.useEffect(()=>{i&&Z()},[i,t._id]);const Z=async()=>{try{P(!0);const e=await r.getPropertyTypeFields(t._id,!0);A(e)}catch(e){H({title:"Error",description:"Failed to fetch property type fields",variant:"destructive"})}finally{P(!1)}},J=e=>{e?(L(e),G({propertyTypeId:t._id,fieldName:e.fieldName,fieldLabel:e.fieldLabel,fieldType:e.fieldType,fieldOptions:e.fieldOptions||[],isRequired:e.isRequired,displayOrder:e.displayOrder}),$((e.fieldOptions||[]).join(", "))):(L(null),G({propertyTypeId:t._id,fieldName:"",fieldLabel:"",fieldType:"text",fieldOptions:[],isRequired:!1,displayOrder:S.length}),$("")),O(!0)},Q=()=>{O(!1),L(null),$("")},W=async(e,s)=>{const t=S.findIndex(s=>s._id===e);if("up"===s&&0===t||"down"===s&&t===S.length-1)return;const i=[...S],a="up"===s?t-1:t+1;[i[t],i[a]]=[i[a],i[t]];try{await Promise.all(i.map((e,s)=>r.updatePropertyTypeField(e._id,{displayOrder:s}))),Z(),H({title:"Success",description:"Fields reordered successfully"})}catch(l){H({title:"Error",description:"Failed to reorder fields",variant:"destructive"})}};return e.jsxs(e.Fragment,{children:[e.jsx(l,{open:i,onOpenChange:T,children:e.jsxs(d,{className:"max-w-4xl max-h-[85vh] overflow-y-auto",children:[e.jsxs(c,{children:[e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Manage Fields: ",t.name]}),e.jsxs(o,{children:["Configure which fields to collect when vendors add ",t.name," properties. Changes will apply to new properties only. Existing properties will retain their data."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[S.filter(e=>e.isActive).length," active field(s)"]}),e.jsxs(p,{onClick:()=>J(),children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Add Field"]})]}),F?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Loading fields..."}):0===S.length?e.jsx("div",{className:"border rounded-lg p-8 text-center text-muted-foreground",children:"No fields configured yet. Add your first field to start collecting property details."}):e.jsx("div",{className:"border rounded-lg",children:e.jsxs(I,{children:[e.jsx(M,{children:e.jsxs(R,{children:[e.jsx(q,{className:"w-24",children:"Order"}),e.jsx(q,{children:"Label"}),e.jsx(q,{children:"Field Name"}),e.jsx(q,{children:"Type"}),e.jsx(q,{children:"Required"}),e.jsx(q,{children:"Status"}),e.jsx(q,{className:"text-right",children:"Actions"})]})}),e.jsx(D,{children:S.map((s,t)=>e.jsxs(R,{children:[e.jsx(z,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>W(s._id,"up"),disabled:0===t,children:e.jsx(u,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>W(s._id,"down"),disabled:t===S.length-1,children:e.jsx(x,{className:"h-4 w-4"})})]})}),e.jsx(z,{className:"font-medium",children:s.fieldLabel}),e.jsx(z,{children:e.jsx("code",{className:"text-xs bg-muted px-2 py-1 rounded",children:s.fieldName})}),e.jsx(z,{children:e.jsx(m,{variant:"outline",children:s.fieldType})}),e.jsx(z,{children:s.isRequired&&e.jsx(m,{variant:"secondary",children:"Required"})}),e.jsx(z,{children:e.jsx(y,{checked:s.isActive,onCheckedChange:()=>(async(e,s)=>{try{await r.updatePropertyTypeField(e,{isActive:!s}),H({title:"Success",description:`Field ${s?"deactivated":"activated"} successfully`}),Z()}catch(t){H({title:"Error",description:"Failed to update field status",variant:"destructive"})}})(s._id,s.isActive)})}),e.jsx(z,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>J(s),children:e.jsx(U,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this field? Existing properties will retain this data, but new properties will not collect it."))try{await r.deletePropertyTypeField(e),H({title:"Success",description:"Field deleted successfully"}),Z()}catch(s){H({title:"Error",description:"Failed to delete field",variant:"destructive"})}})(s._id),children:e.jsx(j,{className:"h-4 w-4 text-destructive"})})]})})]},s._id))})]})})]}),e.jsx(g,{children:e.jsx(p,{variant:"outline",onClick:T,children:"Close"})})]})}),e.jsx(l,{open:k,onOpenChange:Q,children:e.jsxs(d,{children:[e.jsxs(c,{children:[e.jsx(n,{children:E?"Edit Field":"Add New Field"}),e.jsx(o,{children:"Configure the field details. This will affect how vendors input data for this property type."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"fieldLabel",children:"Field Label *"}),e.jsx(f,{id:"fieldLabel",placeholder:"e.g., Number of Floors",value:B.fieldLabel,onChange:e=>G({...B,fieldLabel:e.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"fieldName",children:"Field Name (Internal) *"}),e.jsx(f,{id:"fieldName",placeholder:"e.g., numberOfFloors",value:B.fieldName,onChange:e=>G({...B,fieldName:e.target.value})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use camelCase, no spaces. This is used internally to store data."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"fieldType",children:"Field Type *"}),e.jsxs(N,{value:B.fieldType,onValueChange:e=>G({...B,fieldType:e}),children:[e.jsx(w,{children:e.jsx(C,{})}),e.jsx(b,{children:K.map(s=>e.jsx(_,{value:s.value,children:s.label},s.value))})]})]}),["select","multiselect"].includes(B.fieldType)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"options",children:"Options (comma separated) *"}),e.jsx(f,{id:"options",placeholder:"e.g., 1, 2, 3, 4, 5+",value:V,onChange:e=>$(e.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Separate options with commas"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{id:"isRequired",checked:B.isRequired,onCheckedChange:e=>G({...B,isRequired:e})}),e.jsx(v,{htmlFor:"isRequired",children:"Required Field"})]})]}),e.jsxs(g,{children:[e.jsx(p,{variant:"outline",onClick:Q,children:"Cancel"}),e.jsxs(p,{onClick:async()=>{if(!B.fieldName.trim()||!B.fieldLabel.trim())return void H({title:"Error",description:"Field name and label are required",variant:"destructive"});const e=["select","multiselect"].includes(B.fieldType)?V.split(",").map(e=>e.trim()).filter(Boolean):[];if(["select","multiselect"].includes(B.fieldType)&&0===e.length)H({title:"Error",description:"Please provide at least one option for select fields",variant:"destructive"});else try{const s={...B,fieldOptions:e};E?(await r.updatePropertyTypeField(E._id,s),H({title:"Success",description:"Field updated successfully"})):(await r.createPropertyTypeField(s),H({title:"Success",description:"Field created successfully"})),Z(),Q()}catch(s){H({title:"Error",description:E?"Failed to update field":"Failed to create field",variant:"destructive"})}},children:[E?"Update":"Create"," Field"]})]})]})})]})},H=()=>{const{user:t}=T(),{toast:i}=a(),N=t?.rolePermissions||[],w="admin"===t?.role||"superadmin"===t?.role,C=e=>N.includes(e),b=w||C(k.PM_T_CREATE),_=w||C(k.PM_T_EDIT),O=w||C(k.PM_T_DELETE),E=w||C(k.PM_T_STATUS),L=w||C(k.PM_T_MANAGE_FIELDS),$=w||C(k.PM_T_ORDER),[B,K]=s.useState([]),[H,Z]=s.useState([]),[J,Q]=s.useState(!0),[W,X]=s.useState(!1),[ee,se]=s.useState(!1),[te,ie]=s.useState(null),[ae,re]=s.useState(""),[le,de]=s.useState(""),[ce,ne]=s.useState(""),[oe,pe]=s.useState(null),[he,ue]=s.useState(!1),[xe,me]=s.useState({name:"",value:"",categories:[],icon:"",displayOrder:0});s.useEffect(()=>{ye()},[]);const ye=async()=>{try{Q(!0);const[e,s]=await Promise.all([r.getAllPropertyTypes(!0),r.getPropertyTypeCategoryDetails()]);K(e);const t=e.flatMap(e=>e.categories||[]),i=Array.from(new Set(t)).sort();Z(i),!ae&&i.length>0&&re(i[0])}catch(e){i({title:"Error",description:"Failed to fetch property types",variant:"destructive"})}finally{Q(!1)}},je=()=>{if(!le.trim())return void i({title:"Error",description:"Please enter a category name",variant:"destructive"});const e=le.toLowerCase().replace(/\s+/g,"_");H.includes(e)?i({title:"Error",description:"This category already exists",variant:"destructive"}):(Z([...H,e].sort()),re(e),de(""),se(!1),i({title:"Success",description:`Category "${le}" created successfully. You can now add property types to it.`}))},ge=e=>B.filter(s=>s.categories&&s.categories.includes(e)),ve=e=>{e?(ie(e),me({name:e.name,value:e.value,categories:e.categories||[],icon:e.icon||"",displayOrder:e.displayOrder})):(ie(null),me({name:"",value:"",categories:ae?[ae]:[],icon:"",displayOrder:ge(ae).length})),X(!0)},fe=()=>{X(!1),ie(null),me({name:"",value:"",categories:[],icon:"",displayOrder:0})},Ne=async(e,s,t)=>{const a=ge(t),l=a.findIndex(s=>s._id===e);if("up"===s&&0===l||"down"===s&&l===a.length-1)return;const d=[...a],c="up"===s?l-1:l+1;[d[l],d[c]]=[d[c],d[l]];try{await Promise.all(d.map((e,s)=>r.updatePropertyType(e._id,{displayOrder:s}))),ye(),i({title:"Success",description:"Property types reordered successfully"})}catch(n){i({title:"Error",description:"Failed to reorder property types",variant:"destructive"})}},we=e=>e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),Ce=s=>{const t=ge(s),a=t.filter(e=>e.name.toLowerCase().includes(ce.toLowerCase())||e.value.toLowerCase().includes(ce.toLowerCase()));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Manage ",we(s)," property types"]}),b&&e.jsxs(p,{onClick:()=>ve(),children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Add Property Type"]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(f,{placeholder:"Search property types...",value:ce,onChange:e=>ne(e.target.value),className:"max-w-sm"})}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(I,{children:[e.jsx(M,{children:e.jsxs(R,{children:[e.jsx(q,{children:"Order"}),e.jsx(q,{children:"Name"}),e.jsx(q,{children:"Value"}),e.jsx(q,{children:"Status"}),e.jsx(q,{className:"text-right",children:"Actions"})]})}),e.jsx(D,{children:0===a.length?e.jsx(R,{children:e.jsx(z,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:ce?"No property types match your search.":"No property types found. Create your first property type to get started."})}):a.map((a,l)=>{const d=t.findIndex(e=>e._id===a._id);return e.jsxs(R,{children:[e.jsx(z,{children:$&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>Ne(a._id,"up",s),disabled:0===d,children:e.jsx(u,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>Ne(a._id,"down",s),disabled:d===t.length-1,children:e.jsx(x,{className:"h-4 w-4"})})]})}),e.jsx(z,{className:"font-medium",children:a.name}),e.jsx(z,{children:e.jsx("code",{className:"text-sm bg-muted px-2 py-1 rounded",children:a.value})}),e.jsx(z,{children:e.jsx(y,{checked:a.isActive,onCheckedChange:()=>(async(e,s)=>{try{await r.updatePropertyType(e,{isActive:!s}),i({title:"Success",description:`Property type ${s?"deactivated":"activated"} successfully`}),ye()}catch(t){i({title:"Error",description:"Failed to update property type status",variant:"destructive"})}})(a._id,a.isActive),disabled:!E})}),e.jsx(z,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[L&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>{pe(a),ue(!0)},title:"Manage Fields",children:e.jsx(Y,{className:"h-4 w-4"})}),_&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>ve(a),children:e.jsx(U,{className:"h-4 w-4"})}),O&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this property type? This action cannot be undone."))try{await r.deletePropertyType(e),i({title:"Success",description:"Property type deleted successfully"}),ye()}catch(s){i({title:"Error",description:"Failed to delete property type",variant:"destructive"})}})(a._id),children:e.jsx(j,{className:"h-4 w-4 text-destructive"})})]})})]},a._id)})})]})})]})};return J?e.jsx("div",{className:"text-center py-8",children:"Loading property types..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Property Types"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage property type categories and their display order dynamically"})]}),b&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(p,{variant:"outline",onClick:()=>se(!0),children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"New Category"]})}),0===H.length?e.jsx("div",{className:"border rounded-lg p-8 text-center text-muted-foreground",children:"No categories found. Create your first category to get started."}):e.jsxs(S,{value:ae,onValueChange:re,children:[e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto pb-2",children:e.jsx(A,{className:"inline-flex",children:H.map(s=>{const{total:t,active:i}=(e=>{const s=ge(e),t=s.filter(e=>e.isActive).length;return{total:s.length,active:t}})(s);return e.jsx(F,{value:s,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:we(s)}),e.jsxs(m,{variant:"secondary",className:"ml-1",children:[i,"/",t]})]})},s)})})}),H.map(s=>e.jsx(P,{value:s,children:Ce(s)},s))]}),e.jsx(l,{open:W,onOpenChange:X,children:e.jsxs(d,{children:[e.jsxs(c,{children:[e.jsx(n,{children:te?"Edit Property Type":"Add Property Type"}),e.jsx(o,{children:te?"Update the property type details below":"Create a new property type for your application"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"name",children:"Name"}),e.jsx(f,{id:"name",value:xe.name,onChange:e=>me({...xe,name:e.target.value}),placeholder:"e.g., Apartment"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"value",children:"Value (Unique ID)"}),e.jsx(f,{id:"value",value:xe.value,onChange:e=>me({...xe,value:e.target.value}),placeholder:"e.g., apartment",disabled:!!te}),te&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Value cannot be changed after creation"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Categories *"}),e.jsx("div",{className:"border rounded-md p-4 space-y-2 max-h-40 overflow-y-auto",children:H.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{id:`category-${s}`,checked:xe.categories.includes(s),onCheckedChange:e=>{me(e?{...xe,categories:[...xe.categories,s]}:{...xe,categories:xe.categories.filter(e=>e!==s)})},disabled:!!te}),e.jsx(v,{htmlFor:`category-${s}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:we(s)})]},s))}),te&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Categories cannot be changed after creation (currently restricted)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"icon",children:"Icon (Optional)"}),e.jsx(f,{id:"icon",value:xe.icon,onChange:e=>me({...xe,icon:e.target.value}),placeholder:"e.g., home"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"displayOrder",children:"Display Order"}),e.jsx(f,{id:"displayOrder",type:"number",value:xe.displayOrder,onChange:e=>me({...xe,displayOrder:parseInt(e.target.value)||0})})]})]}),e.jsxs(g,{children:[e.jsx(p,{variant:"outline",onClick:fe,children:"Cancel"}),e.jsx(p,{onClick:async()=>{try{te?(await r.updatePropertyType(te._id,xe),i({title:"Success",description:"Property type updated successfully"})):(await r.createPropertyType(xe),i({title:"Success",description:"Property type created successfully"})),ye(),fe()}catch(e){i({title:"Error",description:te?"Failed to update property type":"Failed to create property type",variant:"destructive"})}},children:te?"Update":"Create"})]})]})}),e.jsx(l,{open:ee,onOpenChange:se,children:e.jsxs(d,{children:[e.jsxs(c,{children:[e.jsx(n,{children:"Create New Category"}),e.jsx(o,{children:"Create a new property type category. It will automatically be formatted as a unique identifier."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"categoryName",children:"Category Name"}),e.jsx(f,{id:"categoryName",value:le,onChange:e=>de(e.target.value),placeholder:"e.g., Premium Properties",onKeyDown:e=>{"Enter"===e.key&&je()}}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'This will be converted to lowercase with underscores (e.g., "Premium Properties" â†’ "premium_properties")'})]}),le&&e.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Category Value:"}),e.jsx("code",{className:"text-sm bg-background px-2 py-1 rounded inline-block mt-1",children:le.toLowerCase().replace(/\s+/g,"_")})]})]}),e.jsxs(g,{children:[e.jsx(p,{variant:"outline",onClick:()=>{se(!1),de("")},children:"Cancel"}),e.jsx(p,{onClick:je,children:"Create Category"})]})]})}),oe&&e.jsx(G,{propertyType:oe,isOpen:he,onClose:()=>{ue(!1),pe(null)}})]})},Z=()=>{const{user:t}=T(),{toast:i}=a(),S=t?.rolePermissions||[],A="admin"===t?.role||"superadmin"===t?.role,F=e=>S.includes(e),P=A||F(k.PM_A_CREATE),O=A||F(k.PM_A_EDIT),E=A||F(k.PM_A_DELETE),L=A||F(k.PM_A_STATUS),$=A||F(k.PM_A_ORDER),[B,Y]=s.useState([]),[K,G]=s.useState([]),[H,Z]=s.useState([]),[J,Q]=s.useState({}),[W,X]=s.useState(!0),[ee,se]=s.useState(!1),[te,ie]=s.useState(null),[ae,re]=s.useState({name:"",category:"basic",icon:"",displayOrder:0}),[le,de]=s.useState("");s.useEffect(()=>{ce()},[]);const ce=async()=>{try{X(!0);const[e,s]=await Promise.all([r.getAllAmenities(!0),r.getAllPropertyTypes(!0)]);Y(e),G(s);const t=await r.getAllPropertyTypeAmenities(),i={};e.forEach(e=>{i[e._id]=[]}),t.forEach(e=>{const s=e.amenityId?._id||e.amenityId,t=e.propertyTypeId?._id||e.propertyTypeId;s&&t&&(i[s]||(i[s]=[]),i[s].includes(t)||i[s].push(t))}),Q(i)}catch(e){i({title:"Error",description:"Failed to fetch data",variant:"destructive"})}finally{X(!1)}},ne=async e=>{e?(ie(e),re({name:e.name,category:e.category||"basic",icon:e.icon||"",displayOrder:e.displayOrder}),Z(J[e._id]||[])):(ie(null),re({name:"",category:"basic",icon:"",displayOrder:B.length}),Z([])),se(!0)},oe=()=>{se(!1),ie(null),re({name:"",category:"basic",icon:"",displayOrder:0}),Z([])},pe=async(e,s)=>{const t=B.findIndex(s=>s._id===e);if("up"===s&&0===t||"down"===s&&t===B.length-1)return;const a=[...B],l="up"===s?t-1:t+1;[a[t],a[l]]=[a[l],a[t]];try{await Promise.all(a.map((e,s)=>r.updateAmenity(e._id,{displayOrder:s}))),Y(a),i({title:"Success",description:"Amenities reordered successfully"})}catch(d){i({title:"Error",description:"Failed to reorder amenities",variant:"destructive"})}},he=B.filter(e=>e.name.toLowerCase().includes(le.toLowerCase()));return W?e.jsx("div",{className:"text-center py-8",children:"Loading amenities..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Amenities"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage amenities available for property listings"})]}),P&&e.jsxs(p,{onClick:()=>ne(),children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Add Amenity"]})]}),e.jsxs("div",{className:"border rounded-lg",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("div",{className:"flex gap-2",children:e.jsx(f,{placeholder:"Search amenities...",value:le,onChange:e=>de(e.target.value),className:"flex-1"})})}),e.jsxs(I,{children:[e.jsx(M,{children:e.jsxs(R,{children:[e.jsx(q,{children:"Order"}),e.jsx(q,{children:"Name"}),e.jsx(q,{children:"Category"}),e.jsx(q,{children:"Property Types"}),e.jsx(q,{children:"Status"}),e.jsx(q,{className:"text-right",children:"Actions"})]})}),e.jsx(D,{children:0===he.length?e.jsx(R,{children:e.jsx(z,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No amenities found. Create your first amenity to get started."})}):he.map((s,t)=>{const a=(J[s._id]||[]).map(e=>K.find(s=>s._id===e)?.name).filter(Boolean);return e.jsxs(R,{children:[e.jsx(z,{children:$&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>pe(s._id,"up"),disabled:0===t,children:e.jsx(u,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>pe(s._id,"down"),disabled:t===B.length-1,children:e.jsx(x,{className:"h-4 w-4"})})]})}),e.jsx(z,{className:"font-medium",children:s.name}),e.jsx(z,{children:s.category?e.jsx(m,{variant:"outline",children:s.category}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(z,{children:a.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:a.map((s,t)=>e.jsx(m,{variant:"secondary",className:"text-xs",children:s},t))}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"No property types"})}),e.jsx(z,{children:e.jsx(y,{checked:s.isActive,onCheckedChange:()=>(async(e,s)=>{try{await r.updateAmenity(e,{isActive:!s}),i({title:"Success",description:`Amenity ${s?"deactivated":"activated"} successfully`}),ce()}catch(t){i({title:"Error",description:"Failed to update amenity status",variant:"destructive"})}})(s._id,s.isActive),disabled:!L})}),e.jsx(z,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[O&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>ne(s),children:e.jsx(U,{className:"h-4 w-4"})}),E&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this amenity? This action cannot be undone."))try{await r.deleteAmenity(e),i({title:"Success",description:"Amenity deleted successfully"}),ce()}catch(s){i({title:"Error",description:"Failed to delete amenity",variant:"destructive"})}})(s._id),children:e.jsx(j,{className:"h-4 w-4 text-destructive"})})]})})]},s._id)})})]})]}),e.jsx(l,{open:ee,onOpenChange:se,children:e.jsxs(d,{children:[e.jsxs(c,{children:[e.jsx(n,{children:te?"Edit Amenity":"Add Amenity"}),e.jsx(o,{children:te?"Update the amenity details below":"Create a new amenity for property listings"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"name",children:"Name"}),e.jsx(f,{id:"name",value:ae.name,onChange:e=>re({...ae,name:e.target.value}),placeholder:"e.g., Swimming Pool"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"category",children:"Category"}),e.jsxs(N,{value:ae.category,onValueChange:e=>re({...ae,category:e}),children:[e.jsx(w,{children:e.jsx(C,{})}),e.jsxs(b,{children:[e.jsx(_,{value:"basic",children:"Basic"}),e.jsx(_,{value:"luxury",children:"Luxury"}),e.jsx(_,{value:"security",children:"Security"}),e.jsx(_,{value:"recreational",children:"Recreational"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"icon",children:"Icon (Optional)"}),e.jsx(f,{id:"icon",value:ae.icon,onChange:e=>re({...ae,icon:e.target.value}),placeholder:"e.g., waves"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"displayOrder",children:"Display Order"}),e.jsx(f,{id:"displayOrder",type:"number",value:ae.displayOrder,onChange:e=>re({...ae,displayOrder:parseInt(e.target.value)||0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Property Types"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Select which property types can have this amenity"}),e.jsx("div",{className:"border rounded-lg p-3 space-y-2 max-h-48 overflow-y-auto",children:K.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{id:`pt-${s._id}`,checked:H.includes(s._id),onCheckedChange:e=>{Z(e?[...H,s._id]:H.filter(e=>e!==s._id))}}),e.jsxs(v,{htmlFor:`pt-${s._id}`,className:"font-normal cursor-pointer",children:[s.name," ",e.jsx(m,{variant:"outline",className:"ml-2",children:s.category})]})]},s._id))})]})]}),e.jsxs(g,{children:[e.jsx(p,{variant:"outline",onClick:oe,children:"Cancel"}),e.jsx(p,{onClick:async()=>{try{let e;if(te)await r.updateAmenity(te._id,ae),e=te._id;else{const s=await r.createAmenity(ae);e=s._id}const s=te&&J[te._id]||[],t=H.filter(e=>!s.includes(e)),a=s.filter(e=>!H.includes(e)),l=[...t,...a];await Promise.all(l.map(async s=>{let i=(await r.getPropertyTypeAmenities(s)).map(e=>e._id);t.includes(s)?i.includes(e)||i.push(e):i=i.filter(s=>s!==e),await r.updatePropertyTypeAmenities(s,i)})),i({title:"Success",description:te?"Amenity updated successfully":"Amenity created successfully"}),ce(),oe()}catch(e){i({title:"Error",description:te?"Failed to update amenity":"Failed to create amenity",variant:"destructive"})}},children:te?"Update":"Create"})]})]})})]})},J=()=>{const{user:i}=T(),r=t(),{toast:l}=a(),[d,c]=s.useState("property-types"),n=i?.rolePermissions||[],o="admin"===i?.role||"superadmin"===i?.role||(p=k.PM_READ,n.includes(p));var p;return s.useEffect(()=>{o||(l({title:"Access Denied",description:"You don't have permission to view property management.",variant:"destructive"}),r("/rolebased"))},[o,r,l]),o?e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(O,{className:"h-8 w-8"}),"Property Management"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage property types, listing types, and amenities for property listings"})]})}),e.jsx($,{children:e.jsxs(B,{children:[e.jsx("strong",{children:"Note:"})," These settings affect the Add Property page and how properties are categorized. Changes here will be reflected when adding or editing properties."]})}),e.jsx(E,{children:e.jsx(L,{className:"pt-6",children:e.jsxs(S,{value:d,onValueChange:c,className:"w-full",children:[e.jsxs(A,{className:"grid w-full grid-cols-2",children:[e.jsx(F,{value:"property-types",children:"Property Types"}),e.jsx(F,{value:"amenities",children:"Amenities"})]}),e.jsx(P,{value:"property-types",className:"mt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx($,{className:"bg-blue-50 dark:bg-blue-950/50 border-blue-200 dark:border-blue-900",children:e.jsxs(B,{children:[e.jsx("strong",{children:"Property Type Fields:"})," Click the ",e.jsx(O,{className:"h-3 w-3 inline mx-1"})," icon next to each property type to configure which fields vendors must fill when adding that type of property."]})}),e.jsx(H,{})]})}),e.jsx(P,{value:"amenities",className:"mt-6",children:e.jsx(Z,{})})]})})})]}):null};export{J as default};

import{j as e,c as ne,P as J}from"./ui-CEt46o3G.js";import{r as d}from"./router-2SVJvIbS.js";import{C as g,d as f,a as O,b as q}from"./card-YvDMUmzt.js";import{g as le,t as y,f as oe,a as N,B as S,T as ce,h as de,i as F,v as $,S as me,I as xe,A as ue,j as he,k as pe,e as ve,o as T,z as K}from"./index-CiYV0Sy0.js";import{T as ge}from"./textarea-BbecYreM.js";import{S as fe,a as je,b as we,c as ye,d as v}from"./select-BHWxeluH.js";import{L as E}from"./loader-circle-Cj-dvH02.js";import{T as z}from"./trending-up-BLutZFyR.js";import{A as Ne}from"./award-D7BvAXpP.js";import{C as Re}from"./circle-check-big-CdpP5k9T.js";import{T as be,a as Se,F as Te,R as Pe}from"./thumbs-up-umqpJJdn.js";import{E as Ce}from"./eye-CDS1ofgA.js";import{E as Ae}from"./eye-off-Cr48i-r0.js";import"./vendor-Dazix4UH.js";import"./index-BdQq_4o_.js";import"./index-DHzxUTm5.js";import"./chevron-down-DeDu0PPf.js";var k="Progress",_=100,[Fe]=ne(k),[$e,Ee]=Fe(k),G=d.forwardRef((n,s)=>{const{__scopeProgress:r,value:a=null,max:i,getValueLabel:x=Me,...c}=n;(i||i===0)&&!B(i)&&console.error(ke(`${i}`,"Progress"));const u=B(i)?i:_;a!==null&&!U(a,u)&&console.error(_e(`${a}`,"Progress"));const h=U(a,u)?a:null,C=P(h)?x(h,u):void 0;return e.jsx($e,{scope:r,value:h,max:u,children:e.jsx(J.div,{"aria-valuemax":u,"aria-valuemin":0,"aria-valuenow":P(h)?h:void 0,"aria-valuetext":C,role:"progressbar","data-state":X(h,u),"data-value":h??void 0,"data-max":u,...c,ref:s})})});G.displayName=k;var H="ProgressIndicator",Q=d.forwardRef((n,s)=>{const{__scopeProgress:r,...a}=n,i=Ee(H,r);return e.jsx(J.div,{"data-state":X(i.value,i.max),"data-value":i.value??void 0,"data-max":i.max,...a,ref:s})});Q.displayName=H;function Me(n,s){return`${Math.round(n/s*100)}%`}function X(n,s){return n==null?"indeterminate":n===s?"complete":"loading"}function P(n){return typeof n=="number"}function B(n){return P(n)&&!isNaN(n)&&n>0}function U(n,s){return P(n)&&!isNaN(n)&&n<=s&&n>=0}function ke(n,s){return`Invalid prop \`max\` of value \`${n}\` supplied to \`${s}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${_}\`.`}function _e(n,s){return`Invalid prop \`value\` of value \`${n}\` supplied to \`${s}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${_} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var W=G,De=Q;const M=d.forwardRef(({className:n,value:s,...r},a)=>e.jsx(W,{ref:a,className:le("relative h-4 w-full overflow-hidden rounded-full bg-secondary",n),...r,children:e.jsx(De,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));M.displayName=W.displayName;const Ie="https://squares-9d84.onrender.com/api";class Ve{async makeRequest(s,r={}){const a=`${Ie}${s}`,i={headers:{"Content-Type":"application/json",...r.headers},...r},x=localStorage.getItem("token");x&&(i.headers={...i.headers,Authorization:`Bearer ${x}`});try{const c=await fetch(a,i);if(!c.ok){const u=await c.json().catch(()=>({success:!1,message:`HTTP ${c.status}: ${c.statusText}`}));throw new Error(u.message||"An error occurred")}return await c.json()}catch(c){throw console.error("Reviews API request failed:",c),c}}async getReviews(s={}){try{const r=new URLSearchParams;Object.entries(s).forEach(([x,c])=>{c!=null&&c!==""&&r.append(x,c.toString())});const a=`/vendors/reviews${r.toString()?`?${r.toString()}`:""}`,i=await this.makeRequest(a);return i.success&&i.data?i.data:{reviews:[],totalCount:0,totalPages:0,currentPage:1}}catch(r){return console.error("Failed to fetch reviews:",r),{reviews:[],totalCount:0,totalPages:0,currentPage:1}}}async getReviewStats(){try{const s=await this.makeRequest("/vendors/reviews/stats");return s.success&&s.data?s.data:{totalReviews:0,averageRating:0,ratingDistribution:{5:0,4:0,3:0,2:0,1:0},recentReviews:0,responseRate:0,averageResponseTime:0,verifiedReviews:0,publicReviews:0,helpfulVotes:0,pendingReplies:0,commonKeywords:[]}}catch(s){return console.error("Failed to fetch review stats:",s),{totalReviews:0,averageRating:0,ratingDistribution:{5:0,4:0,3:0,2:0,1:0},recentReviews:0,responseRate:0,averageResponseTime:0,verifiedReviews:0,publicReviews:0,helpfulVotes:0,pendingReplies:0,commonKeywords:[]}}}async getReviewAnalytics(){try{const s=await this.makeRequest("/vendors/reviews/analytics");return s.success&&s.data?s.data:{monthlyReviews:[],topKeywords:[],competitorComparison:{vendorRating:0,industryAverage:0,competitorRatings:[]},improvementAreas:[]}}catch(s){return console.error("Failed to fetch review analytics:",s),{monthlyReviews:[],topKeywords:[],competitorComparison:{vendorRating:0,industryAverage:0,competitorRatings:[]},improvementAreas:[]}}}async respondToReview(s){try{const r=await this.makeRequest(`/vendors/reviews/${s.reviewId}/respond`,{method:"POST",body:JSON.stringify({message:s.message})});if(r.success)return y({title:"Success",description:r.message||"Response posted successfully!"}),r.data;throw new Error(r.message||"Failed to post response")}catch(r){const a=r instanceof Error?r.message:"Failed to post response";return y({title:"Error",description:a,variant:"destructive"}),null}}async updateReviewVisibility(s,r){try{const a=await this.makeRequest(`/vendors/reviews/${s}/visibility`,{method:"PATCH",body:JSON.stringify({isPublic:r})});if(a.success)return y({title:"Success",description:a.message||"Review visibility updated!"}),a.data;throw new Error(a.message||"Failed to update review visibility")}catch(a){const i=a instanceof Error?a.message:"Failed to update review visibility";return y({title:"Error",description:i,variant:"destructive"}),null}}async reportReview(s,r){try{const a=await this.makeRequest(`/vendors/reviews/${s}/report`,{method:"POST",body:JSON.stringify({reason:r})});if(a.success)return y({title:"Success",description:a.message||"Review reported successfully!"}),!0;throw new Error(a.message||"Failed to report review")}catch(a){const i=a instanceof Error?a.message:"Failed to report review";return y({title:"Error",description:i,variant:"destructive"}),!1}}async markReviewHelpful(s,r){try{const a=await this.makeRequest(`/vendors/reviews/${s}/helpful`,{method:"POST",body:JSON.stringify({isHelpful:r})});if(a.success)return!0;throw new Error(a.message||"Failed to mark review as helpful")}catch(a){return console.error("Failed to mark review as helpful:",a),!1}}formatRating(s){return s.toFixed(1)}formatDate(s){return new Date(s).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})}getRelativeTime(s){const r=new Date(s),i=Math.floor((new Date().getTime()-r.getTime())/1e3);return i<60?"Just now":i<3600?`${Math.floor(i/60)} minutes ago`:i<86400?`${Math.floor(i/3600)} hours ago`:i<2592e3?`${Math.floor(i/86400)} days ago`:i<31536e3?`${Math.floor(i/2592e3)} months ago`:`${Math.floor(i/31536e3)} years ago`}getRatingColor(s){return s>=4.5?"text-green-600":s>=3.5?"text-yellow-600":s>=2.5?"text-orange-600":"text-red-600"}getRatingStars(s){return"★".repeat(Math.floor(s))+"☆".repeat(5-Math.floor(s))}getReviewTypeLabel(s){return{property:"Property Review",service:"Service Review",general:"General Review"}[s]||s}getReviewTypeColor(s){return{property:"bg-blue-100 text-blue-800",service:"bg-green-100 text-green-800",general:"bg-purple-100 text-purple-800"}[s]||"bg-gray-100 text-gray-800"}getSentimentColor(s){return{positive:"text-green-600",negative:"text-red-600",neutral:"text-gray-600"}[s]||"text-gray-600"}getImpactColor(s){return{high:"bg-red-100 text-red-800",medium:"bg-yellow-100 text-yellow-800",low:"bg-green-100 text-green-800"}[s]||"bg-gray-100 text-gray-800"}calculateResponseRate(s,r){return s===0?0:Math.round(r/s*100)}getRatingPercentage(s,r){return r===0?0:Math.round(s/r*100)}}const p=new Ve,as=()=>{const{toast:n}=oe(),[s,r]=d.useState("all"),[a,i]=d.useState(""),[x,c]=d.useState(""),[u,h]=d.useState(null),[C,D]=d.useState(!0),[j,w]=d.useState(null),[b,A]=d.useState([]),[l,Y]=d.useState(null),[I,Le]=d.useState(1),[Oe,Z]=d.useState(1),ee={page:I,limit:10,reviewType:s!=="all"&&["property","service","general"].includes(s)?s:void 0,rating:["1","2","3","4","5"].includes(s)?parseInt(s):void 0,hasResponse:s==="no-reply"?!1:void 0,search:a||void 0,sortBy:"createdAt",sortOrder:"desc"},se=async()=>{try{D(!0);const[t,o]=await Promise.all([p.getReviews(ee),p.getReviewStats()]);A(t.reviews),Z(t.totalPages),Y(o)}catch(t){console.error("Failed to load reviews:",t),n({title:"Error",description:"Failed to load reviews. Please try again.",variant:"destructive"})}finally{D(!1)}};d.useEffect(()=>{se()},[I,s,a]);const te=async t=>{if(x.trim())try{w(t);const o=await p.respondToReview({reviewId:t,message:x});o&&(A(b.map(m=>m._id===t?o:m)),c(""),h(null))}catch(o){console.error("Failed to reply to review:",o)}finally{w(null)}},re=async(t,o)=>{try{w(t);const m=await p.updateReviewVisibility(t,!o);m&&A(b.map(R=>R._id===t?m:R))}catch(m){console.error("Failed to update review visibility:",m)}finally{w(null)}},ae=async t=>{const o=prompt("Please provide a reason for reporting this review:");if(o)try{w(t),await p.reportReview(t,o)}catch(m){console.error("Failed to report review:",m)}finally{w(null)}};if(C)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{children:"Loading reviews..."})]})});const V=b,L=(t,o="md")=>{const m=o==="sm"?"w-3 h-3":"w-4 h-4";return e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(R=>e.jsx(K,{className:`${m} ${R<=t?"text-yellow-500 fill-current":"text-gray-300"}`},R))})},ie=t=>{x.trim()&&te(t)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Reviews & Ratings"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage customer feedback and maintain your reputation"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(N,{variant:"outline",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Rating Insights"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(g,{children:e.jsxs(f,{className:"p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-600 mb-2",children:l?p.formatRating(l.averageRating):"0.0"}),e.jsx("div",{className:"flex justify-center mb-2",children:L(Math.round(l?.averageRating||0))}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Average Rating"}),e.jsx("div",{className:"flex items-center justify-center mt-2",children:l?.recentReviews?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-4 h-4 text-green-500 mr-1"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Based on ",l.recentReviews," recent reviews"]})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"No recent activity"})})]})}),e.jsx(g,{children:e.jsxs(f,{className:"p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:l?.totalReviews||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Reviews"}),e.jsx("div",{className:"mt-2",children:e.jsxs(S,{className:"bg-blue-100 text-blue-800",children:[e.jsx(Ne,{className:"w-3 h-3 mr-1"}),"Top Rated"]})})]})}),e.jsx(g,{children:e.jsxs(f,{className:"p-6 text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-green-600 mb-2",children:[l?.responseRate||0,"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Response Rate"}),e.jsx("p",{className:"text-xs text-green-600 mt-2",children:"Excellent response rate!"})]})}),e.jsx(g,{children:e.jsxs(f,{className:"p-6",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Rating Distribution"}),e.jsx("div",{className:"space-y-2",children:[5,4,3,2,1].map(t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm w-8",children:[t,"★"]}),e.jsx(M,{value:l?l.ratingDistribution[t]/Math.max(l.totalReviews,1)*100:0,className:"flex-1 h-2"}),e.jsx("span",{className:"text-sm text-muted-foreground w-8",children:l?.ratingDistribution[t]||0})]},t))})]})})]}),e.jsxs(ce,{defaultValue:"all-reviews",className:"space-y-6",children:[e.jsxs(de,{children:[e.jsxs(F,{value:"all-reviews",children:["All Reviews (",b.length,")"]}),e.jsxs(F,{value:"pending-replies",children:["Pending Replies (",l?.pendingReplies||0,")"]}),e.jsx(F,{value:"insights",children:"Insights"})]}),e.jsxs($,{value:"all-reviews",className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(xe,{placeholder:"Search reviews...",value:a,onChange:t=>i(t.target.value),className:"pl-10"})]}),e.jsxs(fe,{value:s,onValueChange:t=>r(t),children:[e.jsx(je,{className:"w-full sm:w-48",children:e.jsx(we,{placeholder:"Filter by rating"})}),e.jsxs(ye,{children:[e.jsx(v,{value:"all",children:"All Reviews"}),e.jsx(v,{value:"5",children:"5 Stars"}),e.jsx(v,{value:"4",children:"4 Stars"}),e.jsx(v,{value:"3",children:"3 Stars"}),e.jsx(v,{value:"2",children:"2 Stars"}),e.jsx(v,{value:"1",children:"1 Star"}),e.jsx(v,{value:"property",children:"Property Reviews"}),e.jsx(v,{value:"service",children:"Service Reviews"}),e.jsx(v,{value:"general",children:"General Reviews"}),e.jsx(v,{value:"no-reply",children:"No Reply"})]})]})]}),e.jsx("div",{className:"space-y-6",children:V.map(t=>e.jsx(g,{className:"hover:shadow-lg transition-shadow",children:e.jsx(f,{className:"p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs(ue,{className:"h-12 w-12",children:[e.jsx(he,{src:t.clientAvatar}),e.jsx(pe,{children:t.clientName.charAt(0)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:t.clientName}),e.jsxs("div",{className:"flex items-center space-x-2",children:[L(t.rating,"sm"),t.isVerified&&e.jsxs(S,{variant:"secondary",className:"text-xs",children:[e.jsx(Re,{className:"w-3 h-3 mr-1"}),"Verified"]}),e.jsx(S,{className:p.getReviewTypeColor(t.reviewType),children:p.getReviewTypeLabel(t.reviewType)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:p.formatDate(t.createdAt)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:p.getRelativeTime(t.createdAt)})]})]}),e.jsx("h5",{className:"font-medium mb-2",children:t.title}),e.jsx("p",{className:"text-sm mb-3",children:t.comment}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:t.tags.map((o,m)=>e.jsx(S,{variant:"outline",className:"text-xs",children:o},m))}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(be,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm",children:t.helpfulCount})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Se,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-sm",children:t.unhelpfulCount})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{size:"sm",variant:"outline",onClick:()=>re(t._id,t.isPublic),disabled:j===t._id,children:t.isPublic?e.jsx(Ce,{className:"w-4 h-4"}):e.jsx(Ae,{className:"w-4 h-4"})}),e.jsx(N,{size:"sm",variant:"outline",onClick:()=>ae(t._id),disabled:j===t._id,children:e.jsx(Te,{className:"w-4 h-4"})})]})]}),!t.vendorResponse&&e.jsxs(N,{size:"sm",variant:"outline",onClick:()=>h(t._id),disabled:j===t._id,children:[j===t._id?e.jsx(E,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Reply"]})]}),u===t._id&&e.jsxs("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:[e.jsx(ge,{placeholder:"Write your reply...",value:x,onChange:o=>c(o.target.value),className:"mb-3"}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(N,{size:"sm",variant:"outline",onClick:()=>h(null),children:"Cancel"}),e.jsxs(N,{size:"sm",onClick:()=>ie(t._id),disabled:!x.trim()||j===t._id,children:[j===t._id?e.jsx(E,{className:"w-4 h-4 mr-2 animate-spin"}):null,"Post Reply"]})]})]}),t.vendorResponse&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(ve,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Your Reply"}),e.jsx("span",{className:"text-xs text-blue-600",children:p.formatDate(t.vendorResponse.respondedAt)})]}),e.jsx("p",{className:"text-sm text-blue-800",children:t.vendorResponse.message})]})]})]})})},t._id))}),V.length===0&&e.jsx(g,{children:e.jsxs(f,{className:"p-12 text-center",children:[e.jsx(T,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No reviews found"}),e.jsx("p",{className:"text-muted-foreground",children:a||s!=="all"?"No reviews match your search criteria":"Customer reviews will appear here"})]})})]}),e.jsx($,{value:"pending-replies",className:"space-y-6",children:e.jsx(g,{children:e.jsxs(f,{className:"p-12 text-center",children:[e.jsx(T,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Pending Replies"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Reviews that need your response will appear here"})]})})}),e.jsx($,{value:"insights",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(g,{children:[e.jsx(O,{children:e.jsx(q,{children:"Most Mentioned Keywords"})}),e.jsx(f,{children:e.jsx("div",{className:"space-y-3",children:l?.commonKeywords&&l.commonKeywords.length>0?l.commonKeywords.map((t,o)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:t}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{value:Math.max(20,100-o*15),className:"w-20 h-2"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Math.max(1,25-o*3)})]})]},t)):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No keyword data available yet. Keywords will appear as you receive more reviews."})})})]}),e.jsxs(g,{children:[e.jsx(O,{children:e.jsx(q,{children:"Review Trends"})}),e.jsx(f,{children:e.jsx("div",{className:"space-y-4",children:l?.totalReviews&&l.totalReviews>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-800",children:"Current Rating"}),e.jsxs("p",{className:"text-sm text-green-600",children:[l.averageRating.toFixed(1)," stars from ",l.totalReviews," reviews"]})]}),e.jsx(K,{className:"w-8 h-8 text-green-600"})]}),l.recentReviews>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-800",children:"Recent Activity"}),e.jsxs("p",{className:"text-sm text-blue-600",children:[l.recentReviews," new reviews this month"]})]}),e.jsx(T,{className:"w-8 h-8 text-blue-600"})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(T,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No reviews yet"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Trends will appear once you start receiving reviews"})]})})})]})]})})]})]})};export{as as default};

import{j as e}from"./ui-DYmpZ3pJ.js";import{r as d}from"./router-2SVJvIbS.js";import{t as g,am as ke,a9 as y,f,B as I,p as L,q as M,r as _,s as A,v,I as ae,a as S,b as ie,c as ne,e as C,J as $e,K as oe,L as Ie,O as le,h as ce,z as Ee}from"./index-BbgqWuYN.js";import{T as Fe}from"./textarea-Cl1lQCIh.js";import{D as De,f as Le,a as Me,b as _e,c as Ae}from"./dialog-DsX3mE8Q.js";import{L as E}from"./label-DRahLfWI.js";import{P as O}from"./pen-line-CsOTZIbM.js";import{L as B}from"./loader-circle-DtIJ61xE.js";import{C as Oe}from"./calendar-BL1izdXI.js";import{F as qe,T as Ve,a as He,R as ze}from"./thumbs-up-DfNR8Nie.js";import{T as Be}from"./trash-2-PyAegrM1.js";import"./vendor-Dazix4UH.js";const Ue="https://squares-v2.onrender.com/api";class Je{async makeRequest(r,a={}){const i=`${Ue}${r}`,o={headers:{"Content-Type":"application/json",...a.headers},...a},p=localStorage.getItem("token");p&&(o.headers={...o.headers,Authorization:`Bearer ${p}`});try{const c=await fetch(i,o);if(!c.ok){const u=await c.json().catch(()=>({success:!1,message:`HTTP ${c.status}: ${c.statusText}`}));throw new Error(u.message||"An error occurred")}return await c.json()}catch(c){throw console.error("Customer Reviews API request failed:",c),c}}async getMyReviews(r={}){try{const a=new URLSearchParams;Object.entries(r).forEach(([p,c])=>{c!=null&&c!==""&&a.append(p,c.toString())});const i=`/customer/reviews/my-reviews${a.toString()?`?${a.toString()}`:""}`,o=await this.makeRequest(i);return o.success&&o.data?o.data:{reviews:[],totalCount:0,totalPages:0,currentPage:1}}catch(a){return console.error("Failed to fetch my reviews:",a),{reviews:[],totalCount:0,totalPages:0,currentPage:1}}}async getReceivedReviews(r={}){try{const a=new URLSearchParams;Object.entries(r).forEach(([p,c])=>{c!=null&&c!==""&&a.append(p,c.toString())});const i=`/customer/reviews/received${a.toString()?`?${a.toString()}`:""}`,o=await this.makeRequest(i);return o.success&&o.data?o.data:{reviews:[],totalCount:0,totalPages:0,currentPage:1}}catch(a){return console.error("Failed to fetch received reviews:",a),{reviews:[],totalCount:0,totalPages:0,currentPage:1}}}async getMyReviewStats(){try{const r=await this.makeRequest("/customer/reviews/my-stats");return r.success&&r.data?r.data:{totalReviews:0,averageRating:0,ratingDistribution:{5:0,4:0,3:0,2:0,1:0},recentReviews:0,responseRate:0,averageResponseTime:0,verifiedReviews:0,publicReviews:0,helpfulVotes:0}}catch(r){return console.error("Failed to fetch my review stats:",r),{totalReviews:0,averageRating:0,ratingDistribution:{5:0,4:0,3:0,2:0,1:0},recentReviews:0,responseRate:0,averageResponseTime:0,verifiedReviews:0,publicReviews:0,helpfulVotes:0}}}async createReview(r){try{const a=await this.makeRequest("/customer/reviews",{method:"POST",body:JSON.stringify(r)});if(a.success)return g({title:"Success",description:a.message||"Review submitted successfully!"}),a.data;throw new Error(a.message||"Failed to submit review")}catch(a){const i=a instanceof Error?a.message:"Failed to submit review";return g({title:"Error",description:i,variant:"destructive"}),null}}async updateReview(r,a){try{const i=await this.makeRequest(`/customer/reviews/${r}`,{method:"PUT",body:JSON.stringify(a)});if(i.success)return g({title:"Success",description:i.message||"Review updated successfully!"}),i.data;throw new Error(i.message||"Failed to update review")}catch(i){const o=i instanceof Error?i.message:"Failed to update review";return g({title:"Error",description:o,variant:"destructive"}),null}}async deleteReview(r){try{const a=await this.makeRequest(`/customer/reviews/${r}`,{method:"DELETE"});if(a.success)return g({title:"Success",description:a.message||"Review deleted successfully!"}),!0;throw new Error(a.message||"Failed to delete review")}catch(a){const i=a instanceof Error?a.message:"Failed to delete review";return g({title:"Error",description:i,variant:"destructive"}),!1}}async markReviewHelpful(r,a){try{const i=await this.makeRequest(`/customer/reviews/${r}/helpful`,{method:"POST",body:JSON.stringify({isHelpful:a})});if(i.success)return!0;throw new Error(i.message||"Failed to mark review as helpful")}catch(i){return console.error("Failed to mark review as helpful:",i),!1}}async replyToReview(r,a){try{const i=await this.makeRequest(`/customer/reviews/${r}/reply`,{method:"POST",body:JSON.stringify({message:a})});if(i.success)return g({title:"Success",description:i.message||"Reply posted successfully!"}),!0;throw new Error(i.message||"Failed to post reply")}catch(i){const o=i instanceof Error?i.message:"Failed to post reply";return g({title:"Error",description:o,variant:"destructive"}),!1}}async reportReview(r,a){try{const i=await this.makeRequest(`/customer/reviews/${r}/report`,{method:"POST",body:JSON.stringify({reason:a})});if(i.success)return g({title:"Success",description:i.message||"Review reported successfully!"}),!0;throw new Error(i.message||"Failed to report review")}catch(i){const o=i instanceof Error?i.message:"Failed to report review";return g({title:"Error",description:o,variant:"destructive"}),!1}}async getReviewableItems(){try{const r=await this.makeRequest("/customer/reviews/reviewable-items");return r.success&&r.data?r.data:{properties:[],services:[],vendors:[]}}catch(r){return console.error("Failed to fetch reviewable items:",r),{properties:[],services:[],vendors:[]}}}formatRating(r){return r.toFixed(1)}formatDate(r){return new Date(r).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})}getRelativeTime(r){const a=new Date(r),o=Math.floor((new Date().getTime()-a.getTime())/1e3);return o<60?"Just now":o<3600?`${Math.floor(o/60)} minutes ago`:o<86400?`${Math.floor(o/3600)} hours ago`:o<2592e3?`${Math.floor(o/86400)} days ago`:o<31536e3?`${Math.floor(o/2592e3)} months ago`:`${Math.floor(o/31536e3)} years ago`}getRatingColor(r){return r>=4.5?"text-green-600":r>=3.5?"text-yellow-600":r>=2.5?"text-orange-600":"text-red-600"}getReviewTypeLabel(r){return{property:"Property Review",service:"Service Review",vendor:"Vendor Review"}[r]||r}getReviewTypeColor(r){return{property:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",service:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",vendor:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200"}[r]||"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}getRatingPercentage(r,a){return a===0?0:Math.round(r/a*100)}}const x=new Je,ns=()=>{const{subscribe:F}=ke(),[r,a]=d.useState("received"),[i,o]=d.useState(""),[p,c]=d.useState("all"),[u,de]=d.useState("newest"),[ue,P]=d.useState(!1),[We,me]=d.useState(null),[he,T]=d.useState([]),[ve,D]=d.useState([]),[j,pe]=d.useState(null),[N,xe]=d.useState({properties:[],services:[],vendors:[]}),[ge,U]=d.useState(!0),[fe,J]=d.useState(!0),[we,W]=d.useState(!0),[G,Y]=d.useState(!1),[q,ye]=d.useState({currentPage:1,totalPages:1,totalCount:0}),[Q,je]=d.useState({currentPage:1,totalPages:1,totalCount:0}),[m,R]=d.useState({rating:0,title:"",comment:"",reviewType:"property",isPublic:!0,tags:[]});d.useEffect(()=>{Re(),r==="received"?(k(),K()):$()},[r]),d.useEffect(()=>{const s=F("review_updated",n=>{r==="received"?T(l=>l.map(h=>h._id===n.reviewId?{...h,...n.updates}:h)):D(l=>l.map(h=>h._id===n.reviewId?{...h,...n.updates}:h))}),t=F("review_created",n=>{r==="received"&&n.review.vendorId==="current_user_id"&&(T(l=>[n.review,...l]),K())});return()=>{s(),t()}},[F,r]);const k=async(s=1)=>{U(!0);try{const t=await x.getReceivedReviews({page:s,limit:10,search:i||void 0,rating:p!=="all"?parseInt(p):void 0,sortBy:u==="newest"||u==="oldest"?"createdAt":u==="highest"||u==="lowest"?"rating":u==="helpful"?"helpfulCount":"createdAt",sortOrder:u==="oldest"||u==="lowest"?"asc":"desc"});T(t.reviews),ye({currentPage:t.currentPage,totalPages:t.totalPages,totalCount:t.totalCount})}catch(t){console.error("Failed to load received reviews:",t),g({title:"Error",description:"Failed to load received reviews",variant:"destructive"})}finally{U(!1)}},$=async(s=1)=>{J(!0);try{const t=await x.getMyReviews({page:s,limit:10,search:i||void 0,rating:p!=="all"?parseInt(p):void 0,sortBy:u==="newest"||u==="oldest"?"createdAt":u==="highest"||u==="lowest"?"rating":u==="helpful"?"helpfulCount":"createdAt",sortOrder:u==="oldest"||u==="lowest"?"asc":"desc"});D(t.reviews),je({currentPage:t.currentPage,totalPages:t.totalPages,totalCount:t.totalCount})}catch(t){console.error("Failed to load given reviews:",t),g({title:"Error",description:"Failed to load given reviews",variant:"destructive"})}finally{J(!1)}},K=async()=>{W(!0);try{const s=await x.getMyReviewStats();pe(s)}catch(s){console.error("Failed to load review stats:",s)}finally{W(!1)}},Re=async()=>{try{const s=await x.getReviewableItems();xe(s)}catch(s){console.error("Failed to load reviewable items:",s)}};d.useEffect(()=>{const s=setTimeout(()=>{r==="received"?k(1):$(1)},500);return()=>clearTimeout(s)},[i,p,u]);const V=r==="received"?he:ve,w=r==="received"?q:Q,X=r==="received"?ge:fe,Z=j?.averageRating||0,Ne=j?[5,4,3,2,1].map(s=>({rating:s,count:j.ratingDistribution[s]||0,percentage:j.totalReviews>0?(j.ratingDistribution[s]||0)/j.totalReviews*100:0})):[],be=async()=>{if(!m.rating||!m.title.trim()||!m.comment.trim()){g({title:"Error",description:"Please fill in all required fields",variant:"destructive"});return}Y(!0);try{await x.createReview(m)&&(P(!1),R({rating:0,title:"",comment:"",reviewType:"property",isPublic:!0,tags:[]}),r==="given"&&$(1))}catch(s){console.error("Failed to submit review:",s)}finally{Y(!1)}},Se=async s=>{if(window.confirm("Are you sure you want to delete this review?"))try{await x.deleteReview(s)&&(r==="received"?T(n=>n.filter(l=>l._id!==s)):D(n=>n.filter(l=>l._id!==s)))}catch(t){console.error("Failed to delete review:",t)}},ee=async(s,t)=>{try{if(await x.markReviewHelpful(s,t)){const l=h=>{if(h._id===s){const re=h.userHelpfulVote;let H=h.helpfulCount,z=h.unhelpfulCount;return re==="helpful"&&H--,re==="unhelpful"&&z--,t?H++:z++,{...h,helpfulCount:H,unhelpfulCount:z,userHelpfulVote:t?"helpful":"unhelpful"}}return h};r==="received"?T(h=>h.map(l)):D(h=>h.map(l))}}catch(n){console.error("Failed to mark review as helpful:",n)}},Ce=async(s,t)=>{try{await x.replyToReview(s,t)&&k(q.currentPage)}catch(n){console.error("Failed to reply to review:",n)}},Pe=async(s,t)=>{try{await x.reportReview(s,t)}catch(n){console.error("Failed to report review:",n)}},se=(s,t="sm")=>{const n={sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"};return e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(l=>e.jsx(y,{className:`${n[t]} ${l<=s?"fill-yellow-400 text-yellow-400":"text-muted-foreground"}`},l))})},Te=s=>s.property?`${s.property.title} - ${s.property.location}`:s.service?`${s.service.name} (${s.service.category})`:s.vendor?s.vendor.businessName||s.vendor.name:"Unknown",te=()=>{const s=[];return N.properties.filter(t=>t.canReview&&!t.hasReviewed).forEach(t=>{const n=t.status==="purchased"?"Purchased":t.status==="rented"?"Rented":"Leased",l=t.purchaseDate?` (${n} on ${new Date(t.purchaseDate).toLocaleDateString()})`:` (${n})`;s.push({id:t._id,type:"property",name:`${t.title} - ${t.location}${l}`,category:"Property",status:t.status,canReview:!0})}),N.services.filter(t=>t.canReview&&!t.hasReviewed&&t.status==="completed").forEach(t=>{const n=t.completionDate?` (Completed on ${new Date(t.completionDate).toLocaleDateString()})`:" (Completed)";s.push({id:t._id,type:"service",name:`${t.name} by ${t.vendorName}${n}`,category:t.category,status:t.status,canReview:!0})}),N.vendors.filter(t=>t.canReview&&!t.hasReviewed).forEach(t=>{const n=t.interactionDate?` (${new Date(t.interactionDate).toLocaleDateString()})`:"";s.push({id:t._id,type:"vendor",name:`${t.businessName||t.name}${n}`,category:"Vendor",status:"active",canReview:!0})}),s},b=()=>{const s=N.properties.filter(l=>l.canReview&&!l.hasReviewed).length,t=N.services.filter(l=>l.canReview&&!l.hasReviewed&&l.status==="completed").length,n=N.vendors.filter(l=>l.canReview&&!l.hasReviewed).length;return s+t+n};return e.jsxs("div",{className:"space-y-6 pt-16",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(y,{className:"w-8 h-8 text-primary"}),"Reviews & Ratings"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your reviews and see what others are saying"})]}),e.jsxs(De,{open:ue,onOpenChange:P,children:[e.jsx(Le,{asChild:!0,children:e.jsxs(f,{disabled:b()===0,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Write Review",b()>0&&e.jsx(I,{variant:"secondary",className:"ml-2",children:b()})]})}),e.jsxs(Me,{className:"max-w-2xl",children:[e.jsxs(_e,{children:[e.jsx(Ae,{children:"Write a Review"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Review properties you've purchased/rented or services you've received"})]}),b()===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(y,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Items to Review"}),e.jsx("p",{className:"text-muted-foreground",children:"You can only review properties you've purchased/rented or services you've completed. Complete a transaction or service booking to leave a review."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Review Type"}),e.jsxs(L,{value:m.reviewType,onValueChange:s=>R(t=>({...t,reviewType:s,propertyId:void 0,serviceId:void 0,vendorId:void 0})),children:[e.jsx(M,{children:e.jsx(_,{placeholder:"Choose what to review"})}),e.jsxs(A,{children:[e.jsx(v,{value:"property",children:"Property"}),e.jsx(v,{value:"service",children:"Service"}),e.jsx(v,{value:"vendor",children:"Vendor"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(E,{children:["Select ",m.reviewType]}),e.jsxs(L,{value:m.reviewType==="property"?m.propertyId:m.reviewType==="service"?m.serviceId:m.vendorId,onValueChange:s=>{const t={};m.reviewType==="property"?t.propertyId=s:m.reviewType==="service"?t.serviceId=s:t.vendorId=s,R(n=>({...n,...t}))},children:[e.jsx(M,{children:e.jsx(_,{placeholder:`Choose a ${m.reviewType} to review`})}),e.jsx(A,{children:te().filter(s=>s.type===m.reviewType).map(s=>e.jsx(v,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Rating"}),e.jsx("div",{className:"flex items-center gap-2",children:[1,2,3,4,5].map(s=>e.jsx("button",{onClick:()=>R(t=>({...t,rating:s})),className:"focus:outline-none",children:e.jsx(y,{className:`w-8 h-8 ${s<=m.rating?"fill-yellow-400 text-yellow-400":"text-muted-foreground hover:text-yellow-400"}`})},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Review Title"}),e.jsx(ae,{placeholder:"Summarize your experience",value:m.title,onChange:s=>R(t=>({...t,title:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Your Review"}),e.jsx(Fe,{placeholder:"Share your detailed experience...",rows:4,value:m.comment,onChange:s=>R(t=>({...t,comment:s.target.value}))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(f,{variant:"outline",onClick:()=>P(!1),children:"Cancel"}),e.jsxs(f,{onClick:be,disabled:G,children:[G&&e.jsx(B,{className:"w-4 h-4 mr-2 animate-spin"}),"Submit Review"]})]})]})]})]})]}),r==="received"&&e.jsxs(S,{children:[e.jsx(ie,{children:e.jsx(ne,{children:"Rating Overview"})}),e.jsx(C,{children:we?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(B,{className:"w-6 h-6 animate-spin"})}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl font-bold mb-2",children:Z.toFixed(1)}),se(Math.round(Z),"lg"),e.jsxs("p",{className:"text-muted-foreground mt-2",children:["Based on ",j?.totalReviews||0," reviews"]})]}),e.jsx("div",{className:"space-y-2",children:Ne.map(({rating:s,count:t,percentage:n})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium w-8",children:s}),e.jsx(y,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),e.jsx("div",{className:"flex-1 bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-400 h-2 rounded-full",style:{width:`${n}%`}})}),e.jsx("span",{className:"text-sm text-muted-foreground w-8",children:t})]},s))})]})})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex bg-muted rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>a("received"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${r==="received"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:["Received Reviews (",q.totalCount,")"]}),e.jsxs("button",{onClick:()=>a("given"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${r==="given"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:["Given Reviews (",Q.totalCount,")"]})]})}),e.jsx(S,{children:e.jsx(C,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx($e,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ae,{placeholder:"Search reviews...",className:"pl-10",value:i,onChange:s=>o(s.target.value)})]}),e.jsxs(L,{value:p,onValueChange:c,children:[e.jsx(M,{className:"w-full md:w-48",children:e.jsx(_,{placeholder:"Filter by rating"})}),e.jsxs(A,{children:[e.jsx(v,{value:"all",children:"All Ratings"}),e.jsx(v,{value:"5",children:"5 Stars"}),e.jsx(v,{value:"4",children:"4 Stars"}),e.jsx(v,{value:"3",children:"3 Stars"}),e.jsx(v,{value:"2",children:"2 Stars"}),e.jsx(v,{value:"1",children:"1 Star"})]})]}),e.jsxs(L,{value:u,onValueChange:de,children:[e.jsx(M,{className:"w-full md:w-48",children:e.jsx(_,{placeholder:"Sort by"})}),e.jsxs(A,{children:[e.jsx(v,{value:"newest",children:"Newest First"}),e.jsx(v,{value:"oldest",children:"Oldest First"}),e.jsx(v,{value:"highest",children:"Highest Rating"}),e.jsx(v,{value:"lowest",children:"Lowest Rating"}),e.jsx(v,{value:"helpful",children:"Most Helpful"})]})]})]})})}),e.jsxs("div",{className:"space-y-4",children:[X?e.jsx(S,{children:e.jsx(C,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(B,{className:"w-6 h-6 animate-spin mr-2"}),"Loading reviews..."]})})}):V.length===0?e.jsx(S,{children:e.jsx(C,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(y,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Reviews Found"}),e.jsx("p",{className:"text-muted-foreground",children:r==="received"?"You haven't received any reviews yet. Start listing properties or offering services to receive customer feedback.":"You haven't written any reviews yet. Purchase a property or book a service to share your experience."}),r==="given"&&b()>0&&e.jsxs(f,{className:"mt-4",onClick:()=>P(!0),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Write Your First Review"]})]})})}):V.map(s=>e.jsx(S,{children:e.jsx(C,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(oe,{children:[e.jsx(Ie,{src:s.clientAvatar}),e.jsx(le,{children:s.clientName.split(" ").map(t=>t[0]).join("")})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold",children:s.clientName}),s.isVerified&&e.jsx(I,{variant:"secondary",className:"text-xs",children:"Verified"}),e.jsx(I,{className:`text-xs ${x.getReviewTypeColor(s.reviewType)}`,children:x.getReviewTypeLabel(s.reviewType)})]}),se(s.rating),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx(Oe,{className:"w-3 h-3"}),x.formatDate(s.createdAt)]})]})]}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>Pe(s._id,"inappropriate"),children:e.jsx(qe,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"bg-muted/50 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:Te(s)})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:s.title}),e.jsx("p",{className:"text-muted-foreground",children:s.comment}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:s.tags.map((t,n)=>e.jsx(I,{variant:"outline",className:"text-xs",children:t},n))})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{className:`flex items-center gap-1 text-sm transition-colors ${s.userHelpfulVote==="helpful"?"text-green-600":"text-muted-foreground hover:text-foreground"}`,onClick:()=>ee(s._id,!0),children:[e.jsx(Ve,{className:"w-4 h-4"}),"Helpful (",s.helpfulCount,")"]}),e.jsxs("button",{className:`flex items-center gap-1 text-sm transition-colors ${s.userHelpfulVote==="unhelpful"?"text-red-600":"text-muted-foreground hover:text-foreground"}`,onClick:()=>ee(s._id,!1),children:[e.jsx(He,{className:"w-4 h-4"}),"Not Helpful (",s.unhelpfulCount,")"]})]}),r==="received"&&e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>{const t=prompt("Enter your reply:");t&&Ce(s._id,t)},children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),"Reply"]}),r==="given"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>me(s._id),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Edit"]}),e.jsxs(f,{variant:"ghost",size:"sm",className:"text-destructive hover:text-destructive",onClick:()=>Se(s._id),children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),s.vendorResponse&&e.jsx("div",{className:"space-y-3 pl-12 border-l-2 border-muted",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-6 h-6",children:e.jsx(le,{className:"text-xs",children:s.vendorResponse.vendorName.split(" ").map(t=>t[0]).join("")})}),e.jsx("span",{className:"font-medium text-sm",children:s.vendorResponse.vendorName}),e.jsx(I,{variant:"secondary",className:"text-xs",children:"Owner"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:x.formatDate(s.vendorResponse.respondedAt)})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-8",children:s.vendorResponse.message})]})})]})})},s._id)),r==="given"&&V.length===0&&!X&&b()>0&&e.jsxs(S,{children:[e.jsxs(ie,{children:[e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5 text-primary"}),"Items You Can Review"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"These are properties you've purchased/rented or services you've completed. Share your experience!"})]}),e.jsx(C,{children:e.jsx("div",{className:"grid gap-4",children:te().map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${s.type==="property"?"bg-blue-100 text-blue-600":s.type==="service"?"bg-green-100 text-green-600":"bg-purple-100 text-purple-600"}`,children:s.type==="property"?e.jsx(ce,{className:"w-5 h-5"}):s.type==="service"?e.jsx(y,{className:"w-5 h-5"}):e.jsx(Ee,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.category})]})]}),e.jsxs(f,{size:"sm",onClick:()=>{R(n=>({...n,reviewType:s.type,[s.type==="property"?"propertyId":s.type==="service"?"serviceId":"vendorId"]:s.id})),P(!0)},children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Write Review"]})]},`${s.type}-${s.id}-${t}`))})})]}),w.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-6",children:[e.jsx(f,{variant:"outline",size:"sm",disabled:w.currentPage===1,onClick:()=>{r==="received"?k(w.currentPage-1):$(w.currentPage-1)},children:"Previous"}),e.jsxs("span",{className:"text-sm text-muted-foreground px-4",children:["Page ",w.currentPage," of ",w.totalPages]}),e.jsx(f,{variant:"outline",size:"sm",disabled:w.currentPage===w.totalPages,onClick:()=>{r==="received"?k(w.currentPage+1):$(w.currentPage+1)},children:"Next"})]})]})]})};export{ns as default};

import{j as e}from"./ui-DYmpZ3pJ.js";import{r as d}from"./router-2SVJvIbS.js";import{t as j,D as Q,f,a as h,e as p,B as N,T as Y,G as W,H as C,$ as P,J as X,I as Z,p as ee,q as se,r as te,s as re,v as u,K as ae,L as ie,O as ne,C as le,E as ce,z as oe,Y as R,b as D,c as _,a9 as q}from"./index-BbgqWuYN.js";import{T as de}from"./textarea-Cl1lQCIh.js";import{P as L}from"./progress-DsTiBTsG.js";import{L as F}from"./loader-circle-DtIJ61xE.js";import{T as O}from"./trending-up-CE6F-QOW.js";import{A as me}from"./award-Gcmm1Ecx.js";import{T as xe,a as ue,F as he,R as pe}from"./thumbs-up-DfNR8Nie.js";import{E as ge}from"./eye-off-B4x_R5-l.js";import"./vendor-Dazix4UH.js";const ve="https://squares-v2.onrender.com/api";class je{async makeRequest(t,r={}){const a=`${ve}${t}`,i={headers:{"Content-Type":"application/json",...r.headers},...r},x=localStorage.getItem("token");x&&(i.headers={...i.headers,Authorization:`Bearer ${x}`});try{const c=await fetch(a,i);if(!c.ok){const b=await c.json().catch(()=>({success:!1,message:`HTTP ${c.status}: ${c.statusText}`}));throw new Error(b.message||"An error occurred")}return await c.json()}catch(c){throw console.error("Reviews API request failed:",c),c}}async getReviews(t={}){try{const r=new URLSearchParams;Object.entries(t).forEach(([x,c])=>{c!=null&&c!==""&&r.append(x,c.toString())});const a=`/vendors/reviews${r.toString()?`?${r.toString()}`:""}`,i=await this.makeRequest(a);return i.success&&i.data?i.data:{reviews:[],totalCount:0,totalPages:0,currentPage:1}}catch(r){return console.error("Failed to fetch reviews:",r),{reviews:[],totalCount:0,totalPages:0,currentPage:1}}}async getReviewStats(){try{const t=await this.makeRequest("/vendors/reviews/stats");return t.success&&t.data?t.data:{totalReviews:0,averageRating:0,ratingDistribution:{5:0,4:0,3:0,2:0,1:0},recentReviews:0,responseRate:0,averageResponseTime:0,verifiedReviews:0,publicReviews:0,helpfulVotes:0,pendingReplies:0,commonKeywords:[]}}catch(t){return console.error("Failed to fetch review stats:",t),{totalReviews:0,averageRating:0,ratingDistribution:{5:0,4:0,3:0,2:0,1:0},recentReviews:0,responseRate:0,averageResponseTime:0,verifiedReviews:0,publicReviews:0,helpfulVotes:0,pendingReplies:0,commonKeywords:[]}}}async getReviewAnalytics(){try{const t=await this.makeRequest("/vendors/reviews/analytics");return t.success&&t.data?t.data:{monthlyReviews:[],topKeywords:[],competitorComparison:{vendorRating:0,industryAverage:0,competitorRatings:[]},improvementAreas:[]}}catch(t){return console.error("Failed to fetch review analytics:",t),{monthlyReviews:[],topKeywords:[],competitorComparison:{vendorRating:0,industryAverage:0,competitorRatings:[]},improvementAreas:[]}}}async respondToReview(t){try{const r=await this.makeRequest(`/vendors/reviews/${t.reviewId}/respond`,{method:"POST",body:JSON.stringify({message:t.message})});if(r.success)return j({title:"Success",description:r.message||"Response posted successfully!"}),r.data;throw new Error(r.message||"Failed to post response")}catch(r){const a=r instanceof Error?r.message:"Failed to post response";return j({title:"Error",description:a,variant:"destructive"}),null}}async updateReviewVisibility(t,r){try{const a=await this.makeRequest(`/vendors/reviews/${t}/visibility`,{method:"PATCH",body:JSON.stringify({isPublic:r})});if(a.success)return j({title:"Success",description:a.message||"Review visibility updated!"}),a.data;throw new Error(a.message||"Failed to update review visibility")}catch(a){const i=a instanceof Error?a.message:"Failed to update review visibility";return j({title:"Error",description:i,variant:"destructive"}),null}}async reportReview(t,r){try{const a=await this.makeRequest(`/vendors/reviews/${t}/report`,{method:"POST",body:JSON.stringify({reason:r})});if(a.success)return j({title:"Success",description:a.message||"Review reported successfully!"}),!0;throw new Error(a.message||"Failed to report review")}catch(a){const i=a instanceof Error?a.message:"Failed to report review";return j({title:"Error",description:i,variant:"destructive"}),!1}}async markReviewHelpful(t,r){try{const a=await this.makeRequest(`/vendors/reviews/${t}/helpful`,{method:"POST",body:JSON.stringify({isHelpful:r})});if(a.success)return!0;throw new Error(a.message||"Failed to mark review as helpful")}catch(a){return console.error("Failed to mark review as helpful:",a),!1}}formatRating(t){return t.toFixed(1)}formatDate(t){return new Date(t).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})}getRelativeTime(t){const r=new Date(t),i=Math.floor((new Date().getTime()-r.getTime())/1e3);return i<60?"Just now":i<3600?`${Math.floor(i/60)} minutes ago`:i<86400?`${Math.floor(i/3600)} hours ago`:i<2592e3?`${Math.floor(i/86400)} days ago`:i<31536e3?`${Math.floor(i/2592e3)} months ago`:`${Math.floor(i/31536e3)} years ago`}getRatingColor(t){return t>=4.5?"text-green-600":t>=3.5?"text-yellow-600":t>=2.5?"text-orange-600":"text-red-600"}getRatingStars(t){return"★".repeat(Math.floor(t))+"☆".repeat(5-Math.floor(t))}getReviewTypeLabel(t){return{property:"Property Review",service:"Service Review",general:"General Review"}[t]||t}getReviewTypeColor(t){return{property:"bg-blue-100 text-blue-800",service:"bg-green-100 text-green-800",general:"bg-purple-100 text-purple-800"}[t]||"bg-gray-100 text-gray-800"}getSentimentColor(t){return{positive:"text-green-600",negative:"text-red-600",neutral:"text-gray-600"}[t]||"text-gray-600"}getImpactColor(t){return{high:"bg-red-100 text-red-800",medium:"bg-yellow-100 text-yellow-800",low:"bg-green-100 text-green-800"}[t]||"bg-gray-100 text-gray-800"}calculateResponseRate(t,r){return t===0?0:Math.round(r/t*100)}getRatingPercentage(t,r){return r===0?0:Math.round(t/r*100)}}const m=new je,Ee=()=>{const{toast:A}=Q(),[t,r]=d.useState("all"),[a,i]=d.useState(""),[x,c]=d.useState(""),[b,S]=d.useState(null),[V,k]=d.useState(!0),[g,v]=d.useState(null),[y,T]=d.useState([]),[n,K]=d.useState(null),[E,fe]=d.useState(1),[we,I]=d.useState(1),z={page:E,limit:10,reviewType:t!=="all"&&["property","service","general"].includes(t)?t:void 0,rating:["1","2","3","4","5"].includes(t)?parseInt(t):void 0,hasResponse:t==="no-reply"?!1:void 0,search:a||void 0,sortBy:"createdAt",sortOrder:"desc"},B=async()=>{try{k(!0);const[s,l]=await Promise.all([m.getReviews(z),m.getReviewStats()]);T(s.reviews),I(s.totalPages),K(l)}catch(s){console.error("Failed to load reviews:",s),A({title:"Error",description:"Failed to load reviews. Please try again.",variant:"destructive"})}finally{k(!1)}};d.useEffect(()=>{B()},[E,t,a]);const J=async s=>{if(x.trim())try{v(s);const l=await m.respondToReview({reviewId:s,message:x});l&&(T(y.map(o=>o._id===s?l:o)),c(""),S(null))}catch(l){console.error("Failed to reply to review:",l)}finally{v(null)}},H=async(s,l)=>{try{v(s);const o=await m.updateReviewVisibility(s,!l);o&&T(y.map(w=>w._id===s?o:w))}catch(o){console.error("Failed to update review visibility:",o)}finally{v(null)}},U=async s=>{const l=prompt("Please provide a reason for reporting this review:");if(l)try{v(s),await m.reportReview(s,l)}catch(o){console.error("Failed to report review:",o)}finally{v(null)}};if(V)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{children:"Loading reviews..."})]})});const M=y,$=(s,l="md")=>{const o=l==="sm"?"w-3 h-3":"w-4 h-4";return e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(w=>e.jsx(q,{className:`${o} ${w<=s?"text-yellow-500 fill-current":"text-gray-300"}`},w))})},G=s=>{x.trim()&&J(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Reviews & Ratings"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage customer feedback and maintain your reputation"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(f,{variant:"outline",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Rating Insights"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(h,{children:e.jsxs(p,{className:"p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-600 mb-2",children:n?m.formatRating(n.averageRating):"0.0"}),e.jsx("div",{className:"flex justify-center mb-2",children:$(Math.round(n?.averageRating||0))}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Average Rating"}),e.jsx("div",{className:"flex items-center justify-center mt-2",children:n?.recentReviews?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-4 h-4 text-green-500 mr-1"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Based on ",n.recentReviews," recent reviews"]})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"No recent activity"})})]})}),e.jsx(h,{children:e.jsxs(p,{className:"p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:n?.totalReviews||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Reviews"}),e.jsx("div",{className:"mt-2",children:e.jsxs(N,{className:"bg-blue-100 text-blue-800",children:[e.jsx(me,{className:"w-3 h-3 mr-1"}),"Top Rated"]})})]})}),e.jsx(h,{children:e.jsxs(p,{className:"p-6 text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-green-600 mb-2",children:[n?.responseRate||0,"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Response Rate"}),e.jsx("p",{className:"text-xs text-green-600 mt-2",children:"Excellent response rate!"})]})}),e.jsx(h,{children:e.jsxs(p,{className:"p-6",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Rating Distribution"}),e.jsx("div",{className:"space-y-2",children:[5,4,3,2,1].map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm w-8",children:[s,"★"]}),e.jsx(L,{value:n?n.ratingDistribution[s]/Math.max(n.totalReviews,1)*100:0,className:"flex-1 h-2"}),e.jsx("span",{className:"text-sm text-muted-foreground w-8",children:n?.ratingDistribution[s]||0})]},s))})]})})]}),e.jsxs(Y,{defaultValue:"all-reviews",className:"space-y-6",children:[e.jsxs(W,{children:[e.jsxs(C,{value:"all-reviews",children:["All Reviews (",y.length,")"]}),e.jsxs(C,{value:"pending-replies",children:["Pending Replies (",n?.pendingReplies||0,")"]}),e.jsx(C,{value:"insights",children:"Insights"})]}),e.jsxs(P,{value:"all-reviews",className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(X,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(Z,{placeholder:"Search reviews...",value:a,onChange:s=>i(s.target.value),className:"pl-10"})]}),e.jsxs(ee,{value:t,onValueChange:s=>r(s),children:[e.jsx(se,{className:"w-full sm:w-48",children:e.jsx(te,{placeholder:"Filter by rating"})}),e.jsxs(re,{children:[e.jsx(u,{value:"all",children:"All Reviews"}),e.jsx(u,{value:"5",children:"5 Stars"}),e.jsx(u,{value:"4",children:"4 Stars"}),e.jsx(u,{value:"3",children:"3 Stars"}),e.jsx(u,{value:"2",children:"2 Stars"}),e.jsx(u,{value:"1",children:"1 Star"}),e.jsx(u,{value:"property",children:"Property Reviews"}),e.jsx(u,{value:"service",children:"Service Reviews"}),e.jsx(u,{value:"general",children:"General Reviews"}),e.jsx(u,{value:"no-reply",children:"No Reply"})]})]})]}),e.jsx("div",{className:"space-y-6",children:M.map(s=>e.jsx(h,{className:"hover:shadow-lg transition-shadow",children:e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs(ae,{className:"h-12 w-12",children:[e.jsx(ie,{src:s.clientAvatar}),e.jsx(ne,{children:s.clientName.charAt(0)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:s.clientName}),e.jsxs("div",{className:"flex items-center space-x-2",children:[$(s.rating,"sm"),s.isVerified&&e.jsxs(N,{variant:"secondary",className:"text-xs",children:[e.jsx(le,{className:"w-3 h-3 mr-1"}),"Verified"]}),e.jsx(N,{className:m.getReviewTypeColor(s.reviewType),children:m.getReviewTypeLabel(s.reviewType)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:m.formatDate(s.createdAt)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:m.getRelativeTime(s.createdAt)})]})]}),e.jsx("h5",{className:"font-medium mb-2",children:s.title}),e.jsx("p",{className:"text-sm mb-3",children:s.comment}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:s.tags.map((l,o)=>e.jsx(N,{variant:"outline",className:"text-xs",children:l},o))}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(xe,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm",children:s.helpfulCount})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ue,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-sm",children:s.unhelpfulCount})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{size:"sm",variant:"outline",onClick:()=>H(s._id,s.isPublic),disabled:g===s._id,children:s.isPublic?e.jsx(ce,{className:"w-4 h-4"}):e.jsx(ge,{className:"w-4 h-4"})}),e.jsx(f,{size:"sm",variant:"outline",onClick:()=>U(s._id),disabled:g===s._id,children:e.jsx(he,{className:"w-4 h-4"})})]})]}),!s.vendorResponse&&e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>S(s._id),disabled:g===s._id,children:[g===s._id?e.jsx(F,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Reply"]})]}),b===s._id&&e.jsxs("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:[e.jsx(de,{placeholder:"Write your reply...",value:x,onChange:l=>c(l.target.value),className:"mb-3"}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(f,{size:"sm",variant:"outline",onClick:()=>S(null),children:"Cancel"}),e.jsxs(f,{size:"sm",onClick:()=>G(s._id),disabled:!x.trim()||g===s._id,children:[g===s._id?e.jsx(F,{className:"w-4 h-4 mr-2 animate-spin"}):null,"Post Reply"]})]})]}),s.vendorResponse&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(oe,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Your Reply"}),e.jsx("span",{className:"text-xs text-blue-600",children:m.formatDate(s.vendorResponse.respondedAt)})]}),e.jsx("p",{className:"text-sm text-blue-800",children:s.vendorResponse.message})]})]})]})})},s._id))}),M.length===0&&e.jsx(h,{children:e.jsxs(p,{className:"p-12 text-center",children:[e.jsx(R,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No reviews found"}),e.jsx("p",{className:"text-muted-foreground",children:a||t!=="all"?"No reviews match your search criteria":"Customer reviews will appear here"})]})})]}),e.jsx(P,{value:"pending-replies",className:"space-y-6",children:e.jsx(h,{children:e.jsxs(p,{className:"p-12 text-center",children:[e.jsx(R,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Pending Replies"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Reviews that need your response will appear here"})]})})}),e.jsx(P,{value:"insights",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(h,{children:[e.jsx(D,{children:e.jsx(_,{children:"Most Mentioned Keywords"})}),e.jsx(p,{children:e.jsx("div",{className:"space-y-3",children:n?.commonKeywords&&n.commonKeywords.length>0?n.commonKeywords.map((s,l)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:s}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{value:Math.max(20,100-l*15),className:"w-20 h-2"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Math.max(1,25-l*3)})]})]},s)):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No keyword data available yet. Keywords will appear as you receive more reviews."})})})]}),e.jsxs(h,{children:[e.jsx(D,{children:e.jsx(_,{children:"Review Trends"})}),e.jsx(p,{children:e.jsx("div",{className:"space-y-4",children:n?.totalReviews&&n.totalReviews>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-800",children:"Current Rating"}),e.jsxs("p",{className:"text-sm text-green-600",children:[n.averageRating.toFixed(1)," stars from ",n.totalReviews," reviews"]})]}),e.jsx(q,{className:"w-8 h-8 text-green-600"})]}),n.recentReviews>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-800",children:"Recent Activity"}),e.jsxs("p",{className:"text-sm text-blue-600",children:[n.recentReviews," new reviews this month"]})]}),e.jsx(R,{className:"w-8 h-8 text-blue-600"})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(R,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No reviews yet"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Trends will appear once you start receiving reviews"})]})})})]})]})})]})]})};export{Ee as default};

import{j as e}from"./ui-BNZSgpjP.js";import{e as a,d as r,r as s}from"./router-D8v2YSKU.js";import{a2 as t,aO as i,f as l,A as o,a as d,b as c,c as n,e as p,L as m,I as u,q as h,r as x,s as g,v as j,w as y,G as v,T as f,j as b,a9 as N,aP as A,ao as C,a3 as P}from"./index-XQ_rcKIR.js";import{C as F}from"./checkbox-CNljS6SN.js";import{R as w,a as S}from"./radio-group-Bz_Ig0tu.js";import{C as T}from"./camera-BZjIGS9C.js";import{V as U}from"./video-BUnoALXN.js";import"./vendor-BxThA0WO.js";const k=async(e,a)=>{const r=new FormData;r.append("file",e),r.append("folder",a);try{const e=await fetch("https://app.buildhomemartsquares.com/api/upload/single",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:r});if(!e.ok)throw new Error("Failed to upload file");const a=await e.json();if(!a.success)throw new Error(a.message||"Upload failed");return a.data.url}catch(s){throw new Error("Failed to upload file")}},q=()=>{const{id:q}=a(),E=r(),{toast:I}=t(),[L,V]=s.useState(null),[B,R]=s.useState(!0),[O,D]=s.useState(!1),[M,$]=s.useState([]),[G,z]=s.useState(!0),[W,_]=s.useState([]),[H,Y]=s.useState([]),[J,K]=s.useState({title:"",description:"",type:"",listingType:"",price:"",bedrooms:"",bathrooms:"",builtUpArea:"",carpetArea:"",plotArea:"",street:"",city:"",state:"",pincode:"",amenities:[],virtualTour:""});s.useEffect(()=>{(async()=>{try{z(!0);const e=(await P.getAllPropertyTypes(!1)).sort((e,a)=>(e.displayOrder||0)-(a.displayOrder||0)).map(e=>({value:e.value,label:e.name}));$(e)}catch(e){I({title:"Error",description:"Failed to load property types. Using default types.",variant:"destructive"}),$([{value:"apartment",label:"Apartment"},{value:"villa",label:"Villa"},{value:"house",label:"House"},{value:"commercial",label:"Commercial"},{value:"plot",label:"Plot"},{value:"land",label:"Land"},{value:"office",label:"Office Space"},{value:"pg",label:"PG (Paying Guest)"}])}finally{z(!1)}})()},[]),s.useEffect(()=>{q&&Q(q)},[q]);const Q=async e=>{try{R(!0);const a=(await i.getProperty(e)).data.property;V(a),K({title:a.title,description:a.description,type:a.type,listingType:a.listingType,price:a.price.toString(),bedrooms:a.bedrooms.toString(),bathrooms:a.bathrooms.toString(),builtUpArea:a.area.builtUp?.toString()||"",carpetArea:a.area.carpet?.toString()||"",plotArea:a.area.plot?.toString()||"",street:a.address.street,city:a.address.city,state:a.address.state,pincode:a.address.pincode,amenities:a.amenities||[],virtualTour:a.virtualTour||""}),a.videos&&Y(a.videos.map((e,a)=>({id:`existing-video-${a}`,name:e.caption||`Video ${a+1}`,url:e.url}))),a.images&&_(a.images.map((e,a)=>({id:`existing-${a}`,name:e.caption||`Image ${a+1}`,url:e.url,isPrimary:e.isPrimary})))}catch(a){I({title:"Error",description:"Failed to load property details",variant:"destructive"}),E("/vendor/properties")}finally{R(!1)}},X=(e,a)=>{K(r=>({...r,[e]:a}))};return B?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading property..."})]})}):L?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>E("/vendor/properties"),children:e.jsx(o,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Edit Property"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Update your property details"})]})]})}),e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),!L||O)return;const a={title:J.title?.trim(),description:J.description?.trim(),type:J.type,listingType:J.listingType,price:J.price,city:J.city?.trim(),pincode:J.pincode?.trim()},r=Object.entries(a).filter(([e,a])=>!a).map(([e])=>e);if(r.length>0)I({title:"Missing Required Fields",description:`Please fill in: ${r.join(", ")}`,variant:"destructive"});else{D(!0);try{const e=[];for(const s of W)if(s.file){const a=await k(s.file,"property_images");e.push({url:a,caption:s.name,isPrimary:s.isPrimary})}else e.push({url:s.url,caption:s.name,isPrimary:s.isPrimary});const a=[];for(const s of H)if(s.file){const e=await k(s.file,"property_videos");a.push({url:e,caption:s.name})}else a.push({url:s.url,caption:s.name});const r={title:J.title.trim(),description:J.description.trim(),type:J.type,listingType:J.listingType,price:parseFloat(J.price),bedrooms:parseInt(J.bedrooms)||0,bathrooms:parseInt(J.bathrooms)||0,area:{builtUp:J.builtUpArea?parseFloat(J.builtUpArea):void 0,carpet:J.carpetArea?parseFloat(J.carpetArea):void 0,plot:J.plotArea?parseFloat(J.plotArea):void 0,unit:"sqft"},address:{street:J.street.trim()||"",locality:"",city:J.city.trim(),state:J.state.trim(),pincode:J.pincode.trim()},amenities:J.amenities,images:e,videos:a};J.virtualTour?.trim()&&(r.virtualTour=J.virtualTour.trim()),await i.updateProperty(L._id,r),I({title:"Success!",description:"Property updated successfully."}),E(`/vendor/properties/details/${L._id}`)}catch(s){let e="Failed to update property. Please try again.";s instanceof Error&&(e=s.message),I({title:"Error",description:e,variant:"destructive"})}finally{D(!1)}}},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(d,{children:[e.jsx(c,{children:e.jsx(n,{children:"Basic Details"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"title",children:"Property Title *"}),e.jsx(u,{id:"title",value:J.title,onChange:e=>X("title",e.target.value),placeholder:"Enter property title",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"type",children:"Property Type *"}),e.jsxs(h,{value:J.type,onValueChange:e=>X("type",e),disabled:G,children:[e.jsx(x,{children:e.jsx(g,{placeholder:G?"Loading property types...":"Select property type"})}),e.jsx(j,{children:G?e.jsx(y,{value:"loading",disabled:!0,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-4 w-4 animate-spin"}),"Loading..."]})}):0===M.length?e.jsx(y,{value:"no-types",disabled:!0,children:"No property types available"}):M.map(a=>e.jsx(y,{value:a.value,children:a.label},a.value))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Listing Type *"}),e.jsxs(w,{value:J.listingType,onValueChange:e=>X("listingType",e),className:"flex flex-row space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{value:"sale",id:"sale"}),e.jsx(m,{htmlFor:"sale",children:"For Sale"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{value:"rent",id:"rent"}),e.jsx(m,{htmlFor:"rent",children:"For Rent"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{value:"lease",id:"lease"}),e.jsx(m,{htmlFor:"lease",children:"For Lease"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"description",children:"Description"}),e.jsx(f,{id:"description",value:J.description,onChange:e=>X("description",e.target.value),placeholder:"Describe your property...",rows:4})]})]})]}),e.jsxs(d,{children:[e.jsx(c,{children:e.jsx(n,{children:"Property Details"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"price",children:"Price *"}),e.jsx(u,{id:"price",type:"number",value:J.price,onChange:e=>X("price",e.target.value),placeholder:"Enter price",required:!0})]}),["apartment","villa","house","pg"].includes(J.type)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"bedrooms",children:"pg"===J.type?"Room Sharing":"Bedrooms"}),e.jsx(u,{id:"bedrooms",type:"number",value:J.bedrooms,onChange:e=>X("bedrooms",e.target.value),placeholder:"pg"===J.type?"Number of people per room":"Number of bedrooms",min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"bathrooms",children:"pg"===J.type?"Bathroom Type":"Bathrooms"}),e.jsx(u,{id:"bathrooms",type:"number",value:J.bathrooms,onChange:e=>X("bathrooms",e.target.value),placeholder:"pg"===J.type?"0 for Common, 1 for Attached":"Number of bathrooms",min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"builtUpArea",children:"pg"===J.type?"Room Area (sq ft)":"Built-up Area (sq ft)"}),e.jsx(u,{id:"builtUpArea",type:"number",value:J.builtUpArea,onChange:e=>X("builtUpArea",e.target.value),placeholder:"pg"===J.type?"Room area":"Built-up area"})]})]}),"pg"!==J.type&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"carpetArea",children:"Carpet Area (sq ft)"}),e.jsx(u,{id:"carpetArea",type:"number",value:J.carpetArea,onChange:e=>X("carpetArea",e.target.value),placeholder:"Carpet area"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"plotArea",children:"Plot Area (sq ft)"}),e.jsx(u,{id:"plotArea",type:"number",value:J.plotArea,onChange:e=>X("plotArea",e.target.value),placeholder:"Plot area (for villa/house)"})]})]})]}),["commercial","office"].includes(J.type)&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"builtUpArea",children:"Built-up Area (sq ft) *"}),e.jsx(u,{id:"builtUpArea",type:"number",value:J.builtUpArea,onChange:e=>X("builtUpArea",e.target.value),placeholder:"Total built-up area"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"carpetArea",children:"Carpet Area (sq ft)"}),e.jsx(u,{id:"carpetArea",type:"number",value:J.carpetArea,onChange:e=>X("carpetArea",e.target.value),placeholder:"Usable carpet area"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"bathrooms",children:"Washrooms"}),e.jsx(u,{id:"bathrooms",type:"number",value:J.bathrooms,onChange:e=>X("bathrooms",e.target.value),placeholder:"Number of washrooms",min:"0"})]})]})}),["plot","land"].includes(J.type)&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"plotArea",children:"Plot Area (sq ft) *"}),e.jsx(u,{id:"plotArea",type:"number",value:J.plotArea,onChange:e=>X("plotArea",e.target.value),placeholder:"Total plot area"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"builtUpArea",children:"Total Area (sq ft) *"}),e.jsx(u,{id:"builtUpArea",type:"number",value:J.builtUpArea,onChange:e=>X("builtUpArea",e.target.value),placeholder:"Same as plot area"})]})]})})]})]}),e.jsxs(d,{children:[e.jsx(c,{children:e.jsx(n,{children:"Location"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"street",children:"Street Address"}),e.jsx(u,{id:"street",value:J.street,onChange:e=>X("street",e.target.value),placeholder:"Street address"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"city",children:"City *"}),e.jsx(u,{id:"city",value:J.city,onChange:e=>X("city",e.target.value),placeholder:"City",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"state",children:"State *"}),e.jsx(u,{id:"state",value:J.state,onChange:e=>X("state",e.target.value),placeholder:"State",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"pincode",children:"PIN Code *"}),e.jsx(u,{id:"pincode",value:J.pincode,onChange:e=>X("pincode",e.target.value),placeholder:"PIN Code",maxLength:6,pattern:"[0-9]{6}",required:!0})]})]})]})]}),e.jsxs(d,{children:[e.jsx(c,{children:e.jsx(n,{children:"Amenities"})}),e.jsx(p,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:["Swimming Pool","Gym/Fitness Center","Parking","Security","Garden/Park","Playground","Clubhouse","Power Backup","Elevator","WiFi","CCTV Surveillance","Intercom","Water Supply","Waste Management","Fire Safety","Visitor Parking","Shopping Complex","Restaurant","Spa","Jogging Track"].map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:a,checked:J.amenities.includes(a),onCheckedChange:()=>(e=>{K(a=>({...a,amenities:a.amenities.includes(e)?a.amenities.filter(a=>a!==e):[...a.amenities,e]}))})(a)}),e.jsx(m,{htmlFor:a,className:"text-sm",children:a})]},a))})})]}),e.jsxs(d,{children:[e.jsx(c,{children:e.jsx(n,{children:"Property Images"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-8 text-center",children:[e.jsx(T,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{type:"button",variant:"outline",onClick:()=>document.getElementById("image-upload")?.click(),children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Add Images"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload high-quality images of your property"})]}),e.jsx("input",{id:"image-upload",type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:async e=>{if(e.target.files){const a=Array.from(e.target.files).map(e=>({id:Date.now()+Math.random(),name:e.name,url:URL.createObjectURL(e),file:e,isPrimary:!1}));_(e=>{const r=[...e,...a];return r.length>0&&!r.some(e=>e.isPrimary)&&(r[0].isPrimary=!0),r})}}})]}),W.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:W.map(a=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:a.url,alt:a.name,className:"w-full h-24 object-cover rounded-lg"}),a.isPrimary&&e.jsx("div",{className:"absolute top-1 left-1 bg-primary text-primary-foreground text-xs px-2 py-1 rounded",children:"Primary"}),e.jsxs("div",{className:"absolute top-1 right-1 flex gap-1",children:[!a.isPrimary&&e.jsx(l,{type:"button",size:"icon",variant:"secondary",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{return e=a.id,void _(a=>a.map(a=>({...a,isPrimary:a.id===e})));var e},title:"Set as primary image",children:e.jsx(N,{className:"h-3 w-3"})}),e.jsx(l,{type:"button",size:"icon",variant:"destructive",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{return e=a.id,void _(a=>{const r=a.filter(a=>a.id!==e);return r.length>0&&!r.some(e=>e.isPrimary)&&(r[0].isPrimary=!0),r});var e},children:e.jsx(A,{className:"h-3 w-3"})})]})]},a.id))})]})]}),e.jsxs(d,{children:[e.jsx(c,{children:e.jsx(n,{children:"Property Videos (Optional)"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-8 text-center",children:[e.jsx(U,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{type:"button",variant:"outline",onClick:()=>document.getElementById("video-upload")?.click(),children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Upload Video"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"MP4, MOV, AVI (max 100MB)"})]}),e.jsx("input",{id:"video-upload",type:"file",multiple:!0,accept:"video/*",className:"hidden",onChange:async e=>{if(e.target.files){const a=Array.from(e.target.files).map(e=>({id:Date.now()+Math.random(),name:e.name,url:URL.createObjectURL(e),file:e}));Y(e=>[...e,...a])}}})]}),H.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:H.map(a=>e.jsx("div",{className:"relative border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(U,{className:"w-8 h-8 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:a.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Video file"})]}),e.jsx(l,{type:"button",size:"icon",variant:"destructive",className:"h-6 w-6",onClick:()=>{return e=a.id,void Y(a=>a.filter(a=>a.id!==e));var e},children:e.jsx(A,{className:"h-3 w-3"})})]})},a.id))})]})]}),e.jsxs(d,{children:[e.jsx(c,{children:e.jsx(n,{children:"Virtual Tour (Optional)"})}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"virtualTour",children:"Virtual Tour URL"}),e.jsx(u,{id:"virtualTour",placeholder:"e.g., https://your-virtual-tour-link.com or YouTube link",value:J.virtualTour,onChange:e=>X("virtualTour",e.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Add a virtual tour link, YouTube video, or 360Â° tour to showcase your property"})]})})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>E("/vendor/properties"),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:O,children:O?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]})]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Property Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The property you're trying to edit doesn't exist."}),e.jsxs(l,{onClick:()=>E("/vendor/properties"),children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"Back to Properties"]})]})};export{q as default};

import{j as e}from"./ui-DHQhougw.js";import{e as r,d as a,r as s}from"./router-Bi51YGN-.js";import{$ as t,aw as i,f as l,A as o,a as c,b as d,c as n,e as p,L as m,I as h,S as u,q as x,r as j,s as g,v as y,T as v,o as f,Z as b,X as N,K as A,ai as C}from"./index-CV77Hym3.js";import{C as F}from"./checkbox-ChG1_hEM.js";import{R as P,a as w}from"./radio-group-B0rV2lcK.js";import{C as S}from"./camera-CBOG7LcH.js";import{V as T}from"./video-D9BB_bB4.js";import"./vendor-eVk5PToZ.js";const U=async(e,r)=>{const a=new FormData;a.append("file",e),a.append("folder",r);try{const e=await fetch("https://api.buildhomemartsquares.com/api/upload/single",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:a});if(!e.ok)throw new Error("Failed to upload file");const r=await e.json();if(!r.success)throw new Error(r.message||"Upload failed");return r.data.url}catch(s){throw new Error("Failed to upload file")}},k=()=>{const{id:k}=r(),q=a(),{toast:V}=t(),[B,E]=s.useState(null),[I,L]=s.useState(!0),[R,D]=s.useState(!1),[O,$]=s.useState([]),[M,z]=s.useState([]),[G,W]=s.useState({title:"",description:"",type:"",listingType:"",price:"",bedrooms:"",bathrooms:"",builtUpArea:"",carpetArea:"",plotArea:"",street:"",city:"",state:"",pincode:"",amenities:[],virtualTour:""});s.useEffect(()=>{k&&_(k)},[k]);const _=async e=>{try{L(!0);const r=(await i.getProperty(e)).data.property;E(r),W({title:r.title,description:r.description,type:r.type,listingType:r.listingType,price:r.price.toString(),bedrooms:r.bedrooms.toString(),bathrooms:r.bathrooms.toString(),builtUpArea:r.area.builtUp?.toString()||"",carpetArea:r.area.carpet?.toString()||"",plotArea:r.area.plot?.toString()||"",street:r.address.street,city:r.address.city,state:r.address.state,pincode:r.address.pincode,amenities:r.amenities||[],virtualTour:r.virtualTour||""}),r.videos&&z(r.videos.map((e,r)=>({id:`existing-video-${r}`,name:e.caption||`Video ${r+1}`,url:e.url}))),r.images&&$(r.images.map((e,r)=>({id:`existing-${r}`,name:e.caption||`Image ${r+1}`,url:e.url,isPrimary:e.isPrimary})))}catch(r){V({title:"Error",description:"Failed to load property details",variant:"destructive"}),q("/vendor/properties")}finally{L(!1)}},Y=(e,r)=>{W(a=>({...a,[e]:r}))};return I?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading property..."})]})}):B?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>q("/vendor/properties"),children:e.jsx(o,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Edit Property"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Update your property details"})]})]})}),e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),!B||R)return;const r={title:G.title?.trim(),description:G.description?.trim(),type:G.type,listingType:G.listingType,price:G.price,city:G.city?.trim(),pincode:G.pincode?.trim()},a=Object.entries(r).filter(([e,r])=>!r).map(([e])=>e);if(a.length>0)V({title:"Missing Required Fields",description:`Please fill in: ${a.join(", ")}`,variant:"destructive"});else{D(!0);try{const e=[];for(const s of O)if(s.file){const r=await U(s.file,"property_images");e.push({url:r,caption:s.name,isPrimary:s.isPrimary})}else e.push({url:s.url,caption:s.name,isPrimary:s.isPrimary});const r=[];for(const s of M)if(s.file){const e=await U(s.file,"property_videos");r.push({url:e,caption:s.name})}else r.push({url:s.url,caption:s.name});const a={title:G.title.trim(),description:G.description.trim(),type:G.type,listingType:G.listingType,price:parseFloat(G.price),bedrooms:parseInt(G.bedrooms)||0,bathrooms:parseInt(G.bathrooms)||0,area:{builtUp:G.builtUpArea?parseFloat(G.builtUpArea):void 0,carpet:G.carpetArea?parseFloat(G.carpetArea):void 0,plot:G.plotArea?parseFloat(G.plotArea):void 0,unit:"sqft"},address:{street:G.street.trim()||"",locality:"",city:G.city.trim(),state:G.state.trim(),pincode:G.pincode.trim()},amenities:G.amenities,images:e,videos:r};G.virtualTour?.trim()&&(a.virtualTour=G.virtualTour.trim()),await i.updateProperty(B._id,a),V({title:"Success!",description:"Property updated successfully."}),q(`/vendor/properties/details/${B._id}`)}catch(s){let e="Failed to update property. Please try again.";s instanceof Error&&(e=s.message),V({title:"Error",description:e,variant:"destructive"})}finally{D(!1)}}},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(n,{children:"Basic Details"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"title",children:"Property Title *"}),e.jsx(h,{id:"title",value:G.title,onChange:e=>Y("title",e.target.value),placeholder:"Enter property title",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"type",children:"Property Type *"}),e.jsxs(u,{value:G.type,onValueChange:e=>Y("type",e),children:[e.jsx(x,{children:e.jsx(j,{placeholder:"Select property type"})}),e.jsx(g,{children:[{value:"apartment",label:"Apartment"},{value:"villa",label:"Villa"},{value:"house",label:"House"},{value:"commercial",label:"Commercial"},{value:"plot",label:"Plot"},{value:"land",label:"Land"},{value:"office",label:"Office Space"},{value:"pg",label:"PG (Paying Guest)"}].map(r=>e.jsx(y,{value:r.value,children:r.label},r.value))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Listing Type *"}),e.jsxs(P,{value:G.listingType,onValueChange:e=>Y("listingType",e),className:"flex flex-row space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{value:"sale",id:"sale"}),e.jsx(m,{htmlFor:"sale",children:"For Sale"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{value:"rent",id:"rent"}),e.jsx(m,{htmlFor:"rent",children:"For Rent"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{value:"lease",id:"lease"}),e.jsx(m,{htmlFor:"lease",children:"For Lease"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"description",children:"Description"}),e.jsx(v,{id:"description",value:G.description,onChange:e=>Y("description",e.target.value),placeholder:"Describe your property...",rows:4})]})]})]}),e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(n,{children:"Property Details"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"price",children:"Price *"}),e.jsx(h,{id:"price",type:"number",value:G.price,onChange:e=>Y("price",e.target.value),placeholder:"Enter price",required:!0})]}),["apartment","villa","house","pg"].includes(G.type)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"bedrooms",children:"pg"===G.type?"Room Sharing":"Bedrooms"}),e.jsx(h,{id:"bedrooms",type:"number",value:G.bedrooms,onChange:e=>Y("bedrooms",e.target.value),placeholder:"pg"===G.type?"Number of people per room":"Number of bedrooms",min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"bathrooms",children:"pg"===G.type?"Bathroom Type":"Bathrooms"}),e.jsx(h,{id:"bathrooms",type:"number",value:G.bathrooms,onChange:e=>Y("bathrooms",e.target.value),placeholder:"pg"===G.type?"0 for Common, 1 for Attached":"Number of bathrooms",min:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"builtUpArea",children:"pg"===G.type?"Room Area (sq ft)":"Built-up Area (sq ft)"}),e.jsx(h,{id:"builtUpArea",type:"number",value:G.builtUpArea,onChange:e=>Y("builtUpArea",e.target.value),placeholder:"pg"===G.type?"Room area":"Built-up area"})]})]}),"pg"!==G.type&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"carpetArea",children:"Carpet Area (sq ft)"}),e.jsx(h,{id:"carpetArea",type:"number",value:G.carpetArea,onChange:e=>Y("carpetArea",e.target.value),placeholder:"Carpet area"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"plotArea",children:"Plot Area (sq ft)"}),e.jsx(h,{id:"plotArea",type:"number",value:G.plotArea,onChange:e=>Y("plotArea",e.target.value),placeholder:"Plot area (for villa/house)"})]})]})]}),["commercial","office"].includes(G.type)&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"builtUpArea",children:"Built-up Area (sq ft) *"}),e.jsx(h,{id:"builtUpArea",type:"number",value:G.builtUpArea,onChange:e=>Y("builtUpArea",e.target.value),placeholder:"Total built-up area"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"carpetArea",children:"Carpet Area (sq ft)"}),e.jsx(h,{id:"carpetArea",type:"number",value:G.carpetArea,onChange:e=>Y("carpetArea",e.target.value),placeholder:"Usable carpet area"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"bathrooms",children:"Washrooms"}),e.jsx(h,{id:"bathrooms",type:"number",value:G.bathrooms,onChange:e=>Y("bathrooms",e.target.value),placeholder:"Number of washrooms",min:"0"})]})]})}),["plot","land"].includes(G.type)&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"plotArea",children:"Plot Area (sq ft) *"}),e.jsx(h,{id:"plotArea",type:"number",value:G.plotArea,onChange:e=>Y("plotArea",e.target.value),placeholder:"Total plot area"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"builtUpArea",children:"Total Area (sq ft) *"}),e.jsx(h,{id:"builtUpArea",type:"number",value:G.builtUpArea,onChange:e=>Y("builtUpArea",e.target.value),placeholder:"Same as plot area"})]})]})})]})]}),e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(n,{children:"Location"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"street",children:"Street Address"}),e.jsx(h,{id:"street",value:G.street,onChange:e=>Y("street",e.target.value),placeholder:"Street address"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"city",children:"City *"}),e.jsx(h,{id:"city",value:G.city,onChange:e=>Y("city",e.target.value),placeholder:"City",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"state",children:"State *"}),e.jsx(h,{id:"state",value:G.state,onChange:e=>Y("state",e.target.value),placeholder:"State",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"pincode",children:"PIN Code *"}),e.jsx(h,{id:"pincode",value:G.pincode,onChange:e=>Y("pincode",e.target.value),placeholder:"PIN Code",maxLength:6,pattern:"[0-9]{6}",required:!0})]})]})]})]}),e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(n,{children:"Amenities"})}),e.jsx(p,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:["Swimming Pool","Gym/Fitness Center","Parking","Security","Garden/Park","Playground","Clubhouse","Power Backup","Elevator","WiFi","CCTV Surveillance","Intercom","Water Supply","Waste Management","Fire Safety","Visitor Parking","Shopping Complex","Restaurant","Spa","Jogging Track"].map(r=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:r,checked:G.amenities.includes(r),onCheckedChange:()=>(e=>{W(r=>({...r,amenities:r.amenities.includes(e)?r.amenities.filter(r=>r!==e):[...r.amenities,e]}))})(r)}),e.jsx(m,{htmlFor:r,className:"text-sm",children:r})]},r))})})]}),e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(n,{children:"Property Images"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-8 text-center",children:[e.jsx(S,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{type:"button",variant:"outline",onClick:()=>document.getElementById("image-upload")?.click(),children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"Add Images"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload high-quality images of your property"})]}),e.jsx("input",{id:"image-upload",type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:async e=>{if(e.target.files){const r=Array.from(e.target.files).map(e=>({id:Date.now()+Math.random(),name:e.name,url:URL.createObjectURL(e),file:e,isPrimary:!1}));$(e=>{const a=[...e,...r];return a.length>0&&!a.some(e=>e.isPrimary)&&(a[0].isPrimary=!0),a})}}})]}),O.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:O.map(r=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:r.url,alt:r.name,className:"w-full h-24 object-cover rounded-lg"}),r.isPrimary&&e.jsx("div",{className:"absolute top-1 left-1 bg-primary text-primary-foreground text-xs px-2 py-1 rounded",children:"Primary"}),e.jsxs("div",{className:"absolute top-1 right-1 flex gap-1",children:[!r.isPrimary&&e.jsx(l,{type:"button",size:"icon",variant:"secondary",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{return e=r.id,void $(r=>r.map(r=>({...r,isPrimary:r.id===e})));var e},title:"Set as primary image",children:e.jsx(b,{className:"h-3 w-3"})}),e.jsx(l,{type:"button",size:"icon",variant:"destructive",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{return e=r.id,void $(r=>{const a=r.filter(r=>r.id!==e);return a.length>0&&!a.some(e=>e.isPrimary)&&(a[0].isPrimary=!0),a});var e},children:e.jsx(N,{className:"h-3 w-3"})})]})]},r.id))})]})]}),e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(n,{children:"Property Videos (Optional)"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-8 text-center",children:[e.jsx(T,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{type:"button",variant:"outline",onClick:()=>document.getElementById("video-upload")?.click(),children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"Upload Video"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"MP4, MOV, AVI (max 100MB)"})]}),e.jsx("input",{id:"video-upload",type:"file",multiple:!0,accept:"video/*",className:"hidden",onChange:async e=>{if(e.target.files){const r=Array.from(e.target.files).map(e=>({id:Date.now()+Math.random(),name:e.name,url:URL.createObjectURL(e),file:e}));z(e=>[...e,...r])}}})]}),M.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:M.map(r=>e.jsx("div",{className:"relative border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(T,{className:"w-8 h-8 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:r.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Video file"})]}),e.jsx(l,{type:"button",size:"icon",variant:"destructive",className:"h-6 w-6",onClick:()=>{return e=r.id,void z(r=>r.filter(r=>r.id!==e));var e},children:e.jsx(N,{className:"h-3 w-3"})})]})},r.id))})]})]}),e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(n,{children:"Virtual Tour (Optional)"})}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"virtualTour",children:"Virtual Tour URL"}),e.jsx(h,{id:"virtualTour",placeholder:"e.g., https://your-virtual-tour-link.com or YouTube link",value:G.virtualTour,onChange:e=>Y("virtualTour",e.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Add a virtual tour link, YouTube video, or 360Â° tour to showcase your property"})]})})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>q("/vendor/properties"),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:R,children:R?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]})]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Property Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The property you're trying to edit doesn't exist."}),e.jsxs(l,{onClick:()=>q("/vendor/properties"),children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"Back to Properties"]})]})};export{k as default};

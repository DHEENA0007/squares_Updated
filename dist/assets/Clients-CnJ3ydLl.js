import{j as e}from"./ui-CEFKCYQo.js";import{r as t}from"./router-Bi51YGN-.js";import{W as s,G as a,f as n,a as i,b as r,c as l,d as c,e as d,B as o,E as u,a2 as m,a3 as p,a4 as x,a5 as h,a6 as j,x as v,ap as g,aq as f,ar as b,ad as N,O as y,U as w,as as A}from"./index-Ds-LUfCl.js";import{F as S,E as R}from"./exportUtils-Dm4yNEwU.js";import{P as D,a as P,b as C,c as T,d as E,e as M}from"./pagination-BpE6F8as.js";import{s as _}from"./subscriptionService-BZp4TWAx.js";import{S as k}from"./SearchFilter-oOqKYIVL.js";import{T as $,a as H,b as I,c as V,d as F,e as L}from"./table-BXEnq082.js";import{C as z}from"./calendar-CC4c2MNn.js";import{L as U,M as O}from"./megaphone-C7MoYkU8.js";import{C as Y}from"./camera-C8A2fCF8.js";import"./vendor-eVk5PToZ.js";import"./ellipsis-CAI-P-n6.js";const B=e=>`Rs. ${(e||0).toLocaleString("en-IN")}`,q=()=>{const[q,G]=t.useState(""),[W,K]=t.useState(""),[Q,X]=t.useState("all"),[Z,J]=t.useState([]),[ee,te]=t.useState(!0),[se,ae]=t.useState(1),[ne,ie]=t.useState(1),[re,le]=t.useState(null),[ce,de]=t.useState(!1),{toast:oe}=s();t.useEffect(()=>{const e=setTimeout(()=>{K(q)},500);return()=>clearTimeout(e)},[q]);const ue=t=>{const s={className:"w-4 h-4"};switch(t?.toLowerCase()){case"photography":return e.jsx(Y,{...s});case"marketing":return e.jsx(O,{...s});case"technology":return e.jsx(U,{...s});case"support":return e.jsx(A,{...s});case"crm":return e.jsx(w,{...s});default:return e.jsx(g,{...s})}},me=t.useCallback(async()=>{try{te(!0);const e={page:se,limit:10,search:W||void 0,status:"all"===Q?void 0:Q},t=await _.getSubscriptions(e),s=t.data.subscriptions.filter(e=>e&&e.user&&(e.user.name||e.user.email));s.forEach((e,t)=>{e.paymentHistory&&e.paymentHistory.length}),J(s),ie(t.data.pagination.totalPages)}catch(e){e instanceof Error&&(e.message.includes("Admin access required")?oe({title:"Access Denied",description:"Admin privileges required to view subscriptions.",variant:"destructive"}):e.message.includes("Authentication required")?oe({title:"Authentication Required",description:"Please log in to continue.",variant:"destructive"}):oe({title:"Error",description:"Failed to load subscriptions. Please try again.",variant:"destructive"}))}finally{te(!1)}},[se,W,Q]);t.useEffect(()=>{me()},[me]);const pe=t.useCallback(e=>{G(e),ae(1)},[]),xe=t.useCallback(e=>{X(e),ae(1)},[]),he=e=>{le(e),de(!0)};return ee?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(a,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading clients..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Subscribed Clients"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage client subscriptions and details"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(n,{variant:"outline",onClick:()=>{if(Z&&0!==Z.length?0!==Z.filter(e=>e&&e._id&&e.user&&e.status).length||(oe({title:"Invalid Data",description:"No valid subscription data found for export. Please contact support if this issue persists.",variant:"destructive"}),0):(oe({title:"No Data",description:"No subscription data available for export. Please check if there are any subscriptions in the system.",variant:"destructive"}),0))try{const e=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),t=(()=>{const e=Z.filter(e=>e&&e._id&&e.user&&e.status);if(0===e.length)throw new Error("No valid subscription data found");const t=e.filter(e=>"active"===e.status),s=e.filter(e=>"expired"===e.status),a=e.filter(e=>"cancelled"===e.status),n=e=>{const t=e.paymentDetails&&(e.paymentDetails.razorpayPaymentId||e.transactionId);let s=[];if(e.paymentHistory&&e.paymentHistory.length>0&&(s=e.paymentHistory.filter(e=>e&&e.amount&&e.amount>0&&("subscription_purchase"===e.type||"renewal"===e.type||"upgrade"===e.type))),0===s.length&&t&&e.lastPaymentDate){if("cancelled"===e.status&&e.updatedAt){const t=new Date(e.lastPaymentDate);if((new Date(e.updatedAt).getTime()-t.getTime())/864e5<=1)return 0}return e.amount||0}if(0===s.length)return 0;const a=s.sort((e,t)=>new Date(e.date||"").getTime()-new Date(t.date||"").getTime());let n=0,i=0;if(a.forEach((e,t)=>{if("subscription_purchase"===e.type)n+=e.amount||0,i=e.amount||0;else if("renewal"===e.type)n+=e.amount||0;else if("upgrade"===e.type){const t=e.amount||0,s=t-i;s>0&&(n+=s),i=t}}),"cancelled"===e.status&&a.length>0){const t=a[a.length-1],s=new Date(e.updatedAt||""),i=new Date(t.date||"");(s.getTime()-i.getTime())/864e5<=1&&(n*=.5)}return Math.max(0,n)},i=t.reduce((e,t)=>e+n(t),0),r=e.reduce((e,t)=>e+n(t),0),l=a.reduce((e,t)=>t.paymentHistory&&t.paymentHistory.length>0?e+n(t):e,0),c=s.reduce((e,t)=>t.paymentHistory&&t.paymentHistory.length>0?e+n(t):e,0),d=e.reduce((e,t)=>{if(!t.addons||!Array.isArray(t.addons)||0===t.addons.length)return e;let s=0;if(t.paymentHistory&&t.paymentHistory.length>0){const a=t.paymentHistory.filter(e=>e&&"addon_purchase"===e.type&&e.amount&&e.amount>0);if(a.length>0)return s=a.reduce((e,t)=>e+(t.amount||0),0),e+s}if((t.paymentDetails&&t.paymentDetails.razorpayPaymentId||t.lastPaymentDate||t.transactionId)&&"active"===t.status){const e="object"==typeof t.plan&&null!==t.plan&&t.plan.price||0,a=(t.amount||0)-e;a>0&&(s=a)}return e+s},0);return{validSubscriptions:e,activeSubscriptions:t,expiredSubscriptions:s,cancelledSubscriptions:a,totalActiveRevenue:i,totalRevenueAll:r,cancelledRevenue:l,expiredRevenue:c,addonRevenue:d,grandTotalRevenue:i+d,calculateRevenue:n}})(),s=[{Metric:"Total Clients","Count / Amount":t.validSubscriptions.length},{Metric:"Active Subscriptions","Count / Amount":t.activeSubscriptions.length},{Metric:"Cancelled Subscriptions","Count / Amount":t.cancelledSubscriptions.length},{Metric:"Expired Subscriptions","Count / Amount":t.expiredSubscriptions.length},{Metric:"Total Subscriptions","Count / Amount":t.validSubscriptions.length},{Metric:"Total Active Revenue (Verified Paid)","Count / Amount":B(t.totalActiveRevenue)},{Metric:"Total Revenue from All Paid Subscriptions","Count / Amount":B(t.totalRevenueAll)},{Metric:"Revenue from Cancelled Subscriptions (Paid)","Count / Amount":B(t.cancelledRevenue)},{Metric:"Revenue from Expired Subscriptions (Paid)","Count / Amount":B(t.expiredRevenue)},{Metric:"Add-on Revenue (Verified Paid)","Count / Amount":B(t.addonRevenue)},{Metric:"Grand Total Revenue (All Verified Payments)","Count / Amount":B(t.grandTotalRevenue)}],a=t.totalActiveRevenue+t.cancelledRevenue+t.expiredRevenue,n=[{Status:"Active (Verified Paid)",Count:t.activeSubscriptions.length,"Total Amount":B(t.totalActiveRevenue),"% of Total Amount":a>0?`${(t.totalActiveRevenue/a*100).toFixed(1)}%`:"0%"},{Status:"Cancelled (Previously Paid)",Count:t.cancelledSubscriptions.length,"Total Amount":B(t.cancelledRevenue),"% of Total Amount":a>0?`${(t.cancelledRevenue/a*100).toFixed(1)}%`:"0%"},{Status:"Expired (Previously Paid)",Count:t.expiredSubscriptions.length,"Total Amount":B(t.expiredRevenue),"% of Total Amount":a>0?`${(t.expiredRevenue/a*100).toFixed(1)}%`:"0%"}],i=(e=>{const{validSubscriptions:t,calculateRevenue:s}=e;return t.map((e,t)=>{const a="object"==typeof e.user&&null!==e.user&&(e.user.name||e.user.email)||`Client ${t+1}`,n="object"==typeof e.user&&null!==e.user&&e.user.email||"N/A",i="object"==typeof e.plan&&null!==e.plan&&e.plan.name||"Unknown Plan",r="object"==typeof e.plan&&null!==e.plan&&e.plan.price||0,l=s(e),c=Array.isArray(e.addons)?e.addons.length:0;let d=0;if(Array.isArray(e.addons)&&e.addons.length>0)if(Array.isArray(e.paymentHistory)){const t=e.paymentHistory.filter(e=>e&&"addon_purchase"===e.type&&e.amount&&e.amount>0).reduce((e,t)=>e+(t?.amount||0),0);if(t>0)d=t;else if("active"===e.status){const t=(e.amount||0)-r;d=t>0?t:0}}else if("active"===e.status){const t=(e.amount||0)-r;d=t>0?t:0}return{"#":t+1,"Client Name":a,Email:n,Plan:i,"Plan Price":B(r),"Paid Amount":B(l),Status:_.formatSubscriptionStatus(e.status||"unknown").label,"Start Date":R.formatDate(e.startDate),"End Date":R.formatDate(e.endDate),"Auto Renew":e.autoRenew?"Yes":"No","Add-ons":c,"Add-on Amount":B(d),"Payment Status":l>0?"Paid":"Unpaid"}})})(t),r=i.map(e=>({"#":e["#"],"Client Name":e["Client Name"],Email:e.Email,Plan:e.Plan,"Plan Price":e["Plan Price"],"Paid Amount":e["Paid Amount"],Status:e.Status,"Start Date":e["Start Date"],"End Date":e["End Date"],"Auto Renew":e["Auto Renew"],"Add-ons":e["Add-ons"],"Add-on Amount":e["Add-on Amount"],"Payment Status":e["Payment Status"]})),l=(e=>{const{validSubscriptions:t}=e,s=[];return t.forEach(e=>{const t="object"==typeof e.user&&null!==e.user&&(e.user.name||e.user.email)||"Unknown Client";Array.isArray(e.addons)&&e.addons.length>0&&e.addons.forEach(a=>{if("object"==typeof a&&null!==a&&a.name){const n=Array.isArray(e.paymentHistory)?e.paymentHistory.filter(e=>e&&"addon_purchase"===e.type&&Array.isArray(e.addons)&&e.addons.includes(a._id)).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())[0]:null;s.push({"#":s.length+1,"Client Name":t,"Add-on Name":a.name,Category:a.category||"N/A",Price:B(a.price),"Billing Type":a.billingType?.replace("_"," ")||"N/A","Last Payment Date":n?R.formatDate(n.date):"N/A"})}})}),s})(t),c=t.activeSubscriptions.length,d=c>0?Math.round(t.totalActiveRevenue/c):0,o={};t.activeSubscriptions.forEach(e=>{const s=e.plan?.name||"Unknown",a=t.calculateRevenue(e);o[s]=(o[s]||0)+a});const u=Object.entries(o).sort(([,e],[,t])=>t-e)[0]?.[0]||"N/A",m={};t.validSubscriptions.forEach(e=>{e.addons?.forEach(e=>{e?.name&&(m[e.name]=(m[e.name]||0)+1)})});const p=Object.entries(m).sort(([,e],[,t])=>t-e)[0]?.[0]||"N/A",x=[{Insight:"Total Active Clients",Value:c},{Insight:"Average Revenue per Active Client (ARPC)",Value:B(d)},{Insight:"Total Paid Revenue (All Time)",Value:B(t.totalRevenueAll)},{Insight:"Active Subscriptions Revenue",Value:B(t.totalActiveRevenue)},{Insight:"Addon Revenue (Active)",Value:B(t.addonRevenue)},{Insight:"Highest-Grossing Plan",Value:u},{Insight:"Most Purchased Add-on",Value:p}],h=(()=>{const e={};return t.validSubscriptions.forEach(s=>{if(s.createdAt||s.startDate){const a=new Date(s.createdAt||s.startDate),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`;e[n]||(e[n]={subscriptionRevenue:0,addonRevenue:0,newSubscriptions:0,cancelledSubscriptions:0,upgrades:0,totalRevenue:0}),e[n].newSubscriptions+=1;const i=t.calculateRevenue(s);i>0&&(e[n].subscriptionRevenue+=i)}if("cancelled"===s.status&&s.updatedAt){const t=new Date(s.updatedAt),a=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`;e[a]||(e[a]={subscriptionRevenue:0,addonRevenue:0,newSubscriptions:0,cancelledSubscriptions:0,upgrades:0,totalRevenue:0}),e[a].cancelledSubscriptions+=1}s.paymentHistory&&s.paymentHistory.length>0&&s.paymentHistory.forEach(t=>{if(t.date&&t.amount&&t.amount>0){const a=new Date(t.date),n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`;if(e[n]||(e[n]={subscriptionRevenue:0,addonRevenue:0,newSubscriptions:0,cancelledSubscriptions:0,upgrades:0,totalRevenue:0}),"addon_purchase"===t.type)e[n].addonRevenue+=t.amount;else if("upgrade"===t.type){e[n].upgrades+=1;const i=s.paymentHistory?.filter(e=>e.date&&new Date(e.date)<a&&("subscription_purchase"===e.type||"upgrade"===e.type)).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),r=i&&i.length>0&&i[0].amount||0,l=t.amount-r;l>0&&(e[n].subscriptionRevenue+=l)}else"subscription_purchase"!==t.type&&"renewal"!==t.type||(e[n].subscriptionRevenue+=t.amount)}})}),Object.keys(e).forEach(t=>{e[t].totalRevenue=e[t].subscriptionRevenue+e[t].addonRevenue}),Object.keys(e).sort().map(t=>({Month:t,"New Subscriptions":e[t].newSubscriptions,"Cancelled Subscriptions":e[t].cancelledSubscriptions,Upgrades:e[t].upgrades,"Subscription Revenue":B(e[t].subscriptionRevenue),"Addon Revenue":B(e[t].addonRevenue),"Total Revenue":B(e[t].totalRevenue)}))})(),j=(()=>{const e=new Date,s=(e.getMonth(),e.getFullYear()),a=t.validSubscriptions.filter(e=>new Date(e.createdAt||e.startDate).getFullYear()===s).reduce((e,s)=>e+t.calculateRevenue(s),0),n=t.validSubscriptions.filter(e=>new Date(e.createdAt||e.startDate).getFullYear()===s-1).reduce((e,s)=>e+t.calculateRevenue(s),0),i=n>0?((a-n)/n*100).toFixed(1):"N/A",r=t.cancelledSubscriptions.length,l=t.validSubscriptions.length,o=l>0?(r/l*100).toFixed(1):"0",m={};t.activeSubscriptions.forEach(e=>{const t=e.plan?.name||"Unknown";m[t]=(m[t]||0)+1});return[{Metric:"Total Revenue (All Time)",Value:B(t.totalRevenueAll)},{Metric:"Active Subscriptions Revenue",Value:B(t.totalActiveRevenue)},{Metric:"Addon Revenue",Value:B(t.addonRevenue)},{Metric:"This Year Revenue",Value:B(a)},{Metric:"Last Year Revenue",Value:B(n)},{Metric:"Year-over-Year Growth",Value:`${i}%`},{Metric:"Churn Rate",Value:`${o}%`},{Metric:"Average Revenue per Client (ARPC)",Value:B(d)},{Metric:"Total Active Clients",Value:c},{Metric:"Total Clients (All Time)",Value:t.validSubscriptions.length},{Metric:"Conversion Rate (Active/Total)",Value:`${l>0?(c/l*100).toFixed(1):0}%`},{Metric:"Most Popular Plan",Value:u},{Metric:"Plan Distribution",Value:Object.entries(m).map(([e,t])=>`${e}: ${t}`).join(", ")}]})(),v={filename:"subscribed_clients_revenue_report",title:"Subscribed Clients Revenue Report",metadata:{"Generated on":e,"Report Period":"All Time","Prepared by":"Admin System"}},g=[{name:"Summary Statistics",data:s,columns:[{wch:30},{wch:20}]},{name:"Status Breakdown",data:n,columns:[{wch:15},{wch:10},{wch:20},{wch:20}]},{name:"Monthly Report",data:h,columns:[{wch:12},{wch:15},{wch:18},{wch:12},{wch:18},{wch:15},{wch:15}]},{name:"Overall Analysis",data:j,columns:[{wch:35},{wch:25}]},{name:"Subscription Details",data:r,columns:[{wch:5},{wch:25},{wch:30},{wch:20},{wch:15},{wch:15},{wch:12},{wch:15},{wch:12},{wch:10},{wch:8},{wch:15},{wch:12}]},{name:"Add-on Details",data:l,columns:[{wch:5},{wch:25},{wch:25},{wch:15},{wch:12},{wch:20},{wch:15}]},{name:"Key Insights",data:x,columns:[{wch:35},{wch:25}]}];R.generateExcelReport(v,g),oe({title:"Export Successful",description:"Comprehensive revenue report with monthly analysis and corrected calculations has been generated successfully"})}catch(e){oe({title:"Export Failed",description:"Failed to export data to Excel. Please try again.",variant:"destructive"})}},children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:"Export Excel"})]})})]}),e.jsxs(i,{children:[e.jsxs(r,{children:[e.jsx(l,{children:"All Clients"}),e.jsxs(c,{children:[Z.length," client",1!==Z.length?"s":""," found"]})]}),e.jsxs(d,{children:[e.jsx(k,{searchTerm:q,onSearchChange:pe,filterValue:Q,onFilterChange:xe,filterOptions:[{label:"Active",value:"active"},{label:"Expired",value:"expired"},{label:"Cancelled",value:"cancelled"}],filterPlaceholder:"Filter by status"}),e.jsx("div",{className:"block sm:hidden space-y-4",children:0===Z.length?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No subscriptions found"}):Z.map(t=>e.jsx(i,{className:"hover:shadow-md transition-shadow",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-base truncate",children:t.user.name}),e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:t.user.email})]}),e.jsx(o,{variant:"active"===t.status?"default":"expired"===t.status?"destructive":"secondary",className:"ml-2 flex-shrink-0",children:_.formatSubscriptionStatus(t.status).label})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Plan:"}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium",children:t.plan?.name||"N/A"}),e.jsx("div",{className:"text-muted-foreground capitalize",children:t.plan?.billingPeriod||"N/A"})]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount:"}),e.jsx("span",{className:"font-semibold",children:_.formatAmount(t)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Start:"}),e.jsx("div",{className:"font-medium",children:new Date(t.startDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"End:"}),e.jsx("div",{className:"font-medium",children:new Date(t.endDate).toLocaleDateString()})]})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>he(t),className:"w-full",children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"View Details"]})})]})})},t._id))}),e.jsx("div",{className:"hidden sm:block rounded-lg border border-border bg-card overflow-x-auto",children:e.jsxs($,{children:[e.jsx(H,{children:e.jsxs(I,{className:"bg-muted/50",children:[e.jsx(V,{className:"font-semibold w-[250px] min-w-[200px]",children:"Client"}),e.jsx(V,{className:"font-semibold w-[200px] min-w-[150px]",children:"Plan"}),e.jsx(V,{className:"font-semibold w-[120px] min-w-[100px]",children:"Amount"}),e.jsx(V,{className:"font-semibold w-[130px] min-w-[110px]",children:"Start Date"}),e.jsx(V,{className:"font-semibold w-[130px] min-w-[110px]",children:"End Date"}),e.jsx(V,{className:"font-semibold w-[120px] min-w-[100px]",children:"Status"}),e.jsx(V,{className:"font-semibold text-center w-[120px] min-w-[100px]",children:"Actions"})]})}),e.jsx(F,{children:0===Z.length?e.jsx(I,{children:e.jsx(L,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No subscriptions found"})}):Z.map(t=>e.jsxs(I,{className:"hover:bg-muted/30 transition-colors",children:[e.jsx(L,{className:"w-[250px] min-w-[200px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",children:t.user.name}),e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:t.user.email})]})}),e.jsx(L,{className:"w-[200px] min-w-[150px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",children:t.plan?.name||"N/A"}),e.jsx("div",{className:"text-sm text-muted-foreground capitalize truncate",children:t.plan?.billingPeriod||"N/A"})]})}),e.jsx(L,{className:"w-[120px] min-w-[100px]",children:e.jsx("span",{className:"font-semibold whitespace-nowrap",children:_.formatAmount(t)})}),e.jsx(L,{className:"w-[130px] min-w-[110px]",children:e.jsx("span",{className:"whitespace-nowrap",children:new Date(t.startDate).toLocaleDateString()})}),e.jsx(L,{className:"w-[130px] min-w-[110px]",children:e.jsx("span",{className:"whitespace-nowrap",children:new Date(t.endDate).toLocaleDateString()})}),e.jsx(L,{className:"w-[120px] min-w-[100px]",children:e.jsx(o,{variant:"active"===t.status?"default":"expired"===t.status?"destructive":"secondary",className:"whitespace-nowrap",children:_.formatSubscriptionStatus(t.status).label})}),e.jsx(L,{className:"text-center w-[120px] min-w-[100px]",children:e.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>he(t),className:"whitespace-nowrap",children:[e.jsx(u,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:"View"})]})})]},t._id))})]})}),ne>1&&e.jsx("div",{className:"mt-6",children:e.jsx(D,{children:e.jsxs(P,{children:[e.jsx(C,{children:e.jsx(T,{onClick:()=>{se>1&&ae(se-1)},className:1===se?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:ne},(e,t)=>t+1).map(t=>e.jsx(C,{children:e.jsx(E,{onClick:()=>(e=>{ae(e)})(t),isActive:se===t,className:"cursor-pointer",children:t})},t)),e.jsx(C,{children:e.jsx(M,{onClick:()=>{se<ne&&ae(se+1)},className:se===ne?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]}),e.jsx(m,{open:ce,onOpenChange:de,children:e.jsxs(p,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(x,{children:[e.jsx(h,{children:"Subscription Details"}),e.jsxs(j,{children:["Complete information about ",re?.user.name,"'s subscription"]})]}),re&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5"}),"Client Information"]})}),e.jsx(d,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Name"}),e.jsx("p",{className:"text-base",children:re.user.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Email"}),e.jsx("p",{className:"text-base",children:re.user.email})]}),re.user.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"text-base",children:re.user.phone})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"User ID"}),e.jsx("p",{className:"text-sm font-mono",children:re.user._id})]})]})})]}),e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-5 h-5"}),"Plan Information"]})}),e.jsx(d,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Plan Name"}),e.jsx("p",{className:"text-base font-semibold",children:re.plan?.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Description"}),e.jsx("p",{className:"text-base",children:re.plan?.description||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Plan Price"}),e.jsx("p",{className:"text-base font-semibold",children:re.plan?.price?_.formatAmount({...re,amount:re.plan.price}):"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Billing Period"}),e.jsx("p",{className:"text-base",children:re.plan?.billingPeriod||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Plan ID"}),e.jsx("p",{className:"text-sm font-mono",children:re.plan?._id||"N/A"})]})]})})]}),re.addons&&re.addons.length>0&&e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5"}),"Purchased Addons (",re.addons.length,")"]})}),e.jsxs(d,{className:"space-y-3",children:[e.jsx("div",{className:"grid gap-4",children:re.addons.map((t,s)=>e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-border rounded-lg bg-muted/30",children:[e.jsx("div",{className:"p-2 rounded-lg bg-background border",children:ue(t.category)}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:"font-semibold text-base text-foreground",children:t.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 overflow-hidden",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:t.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx(o,{variant:"outline",className:"capitalize text-xs",children:t.category}),e.jsx(o,{variant:"secondary",className:"text-xs",children:t.billingType?.replace("_"," ")||"N/A"})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:"font-semibold text-lg text-foreground",children:t.price?`${"INR"===t.currency?"₹":"$"}${t.price}`:"Free"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"monthly"===t.billingType?"/month":"yearly"===t.billingType?"/year":"per_property"===t.billingType?"/property":"one_time"===t.billingType?"one-time":""})]})]})})]},t._id||s))}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50/50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Total Addons"}),e.jsxs("p",{className:"text-sm text-blue-700",children:[re.addons.length," addon",1!==re.addons.length?"s":""," purchased"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-blue-900",children:re.addons.reduce((e,t)=>e+(t.price||0),0)>0?`${"INR"===re.currency?"₹":"$"}${re.addons.reduce((e,t)=>e+(t.price||0),0)}`:"Free"}),e.jsx("p",{className:"text-xs text-blue-700",children:"addons value"})]})]})})]})]}),e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Subscription Details"]})}),e.jsx(d,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx(o,{variant:"active"===re.status?"default":"expired"===re.status?"destructive":"secondary",className:"mt-1",children:_.formatSubscriptionStatus(re.status).label})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Auto Renew"}),e.jsx(o,{variant:re.autoRenew?"default":"secondary",className:"mt-1",children:re.autoRenew?"Enabled":"Disabled"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Start Date"}),e.jsx("p",{className:"text-base",children:new Date(re.startDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"End Date"}),e.jsx("p",{className:"text-base",children:new Date(re.endDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Days Remaining"}),e.jsx("p",{className:"text-base",children:"active"===re.status?`${_.getDaysUntilExpiry(re)} days`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Created At"}),e.jsx("p",{className:"text-base",children:new Date(re.createdAt).toLocaleDateString()})]})]})})]}),e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5"}),"Payment Information"]})}),e.jsx(d,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Amount Paid"}),e.jsx("p",{className:"text-base font-semibold",children:_.formatAmount(re)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Currency"}),e.jsx("p",{className:"text-base",children:re.currency})]}),re.paymentMethod&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Payment Method"}),e.jsx("p",{className:"text-base capitalize",children:re.paymentMethod.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Subscription ID"}),e.jsx("p",{className:"text-sm font-mono",children:re._id})]})]})})]}),re.paymentHistory&&re.paymentHistory.length>0&&e.jsxs(i,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5"}),"Payment History (",re.paymentHistory.length,")"]})}),e.jsxs(d,{className:"space-y-3",children:[e.jsx("div",{className:"space-y-4",children:re.paymentHistory.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()).map((t,s)=>e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-border rounded-lg bg-muted/20",children:[e.jsx("div",{className:"p-2 rounded-lg bg-background border",children:"addon_purchase"===t.type?e.jsx(f,{className:"w-4 h-4 text-orange-600"}):"subscription_purchase"===t.type?e.jsx(g,{className:"w-4 h-4 text-blue-600"}):"renewal"===t.type?e.jsx(N,{className:"w-4 h-4 text-green-600"}):e.jsx(b,{className:"w-4 h-4 text-purple-600"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:"font-semibold text-base text-foreground",children:"addon_purchase"===t.type?`Addon Purchase (${t.addons?.length||0} addon${1!==(t.addons?.length||0)?"s":""})`:"subscription_purchase"===t.type?"Subscription Purchase":"renewal"===t.type?"Subscription Renewal":"Subscription Upgrade"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:new Date(t.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}),"addon_purchase"===t.type&&t.addons&&t.addons.length>0&&e.jsxs("div",{className:"mt-2 p-2 bg-orange-50 border border-orange-200 rounded-md",children:[e.jsx("p",{className:"text-xs font-medium text-orange-800 mb-1",children:"Purchased Addons:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.addons.map((t,s)=>{const a=re.addons?.find(e=>e._id===t||e._id===t.toString());return e.jsx(o,{variant:"outline",className:"text-xs text-orange-700",children:a?.name||`Addon ${s+1}`},s)})})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx(o,{variant:"addon_purchase"===t.type?"default":"secondary",className:"capitalize text-xs",children:t.type.replace("_"," ")}),t.transactionId&&e.jsxs("p",{className:"text-xs text-muted-foreground font-mono",children:["ID: ",t.transactionId]})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("p",{className:"font-semibold text-lg text-foreground",children:["INR"===re.currency?"₹":"$",t.amount]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.paymentMethod?.replace("_"," ")||"razorpay"})]})]})})]},t._id||s))}),e.jsx("div",{className:"mt-4 p-4 bg-green-50/50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900",children:"Total Payments"}),e.jsxs("p",{className:"text-sm text-green-700",children:[re.paymentHistory.length," transaction",1!==re.paymentHistory.length?"s":""]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-green-900",children:["INR"===re.currency?"₹":"$",re.paymentHistory.reduce((e,t)=>e+(t.amount||0),0)]}),e.jsx("p",{className:"text-xs text-green-700",children:"total paid"})]})]})})]})]}),e.jsxs(i,{children:[e.jsx(r,{children:e.jsx(l,{children:"Quick Actions"})}),e.jsx(d,{children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:["active"===re.status&&e.jsxs(n,{variant:"destructive",size:"sm",onClick:()=>{(async e=>{if("active"===e.status)try{await _.cancelSubscription(e._id),oe({title:"Subscription Cancelled",description:`${e.user.name}'s subscription has been cancelled.`}),me()}catch(t){oe({title:"Error",description:"Failed to cancel subscription. Please try again.",variant:"destructive"})}else oe({title:"Cannot Cancel",description:"Only active subscriptions can be cancelled.",variant:"destructive"})})(re),de(!1)},children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Cancel Subscription"]}),("expired"===re.status||"cancelled"===re.status)&&e.jsxs(n,{variant:"default",size:"sm",onClick:()=>{(async e=>{if("active"!==e.status)try{await _.renewSubscription(e._id),oe({title:"Subscription Renewed",description:`${e.user.name}'s subscription has been renewed.`}),me()}catch(t){oe({title:"Error",description:"Failed to renew subscription. Please try again.",variant:"destructive"})}else oe({title:"Cannot Renew",description:"Subscription is already active.",variant:"destructive"})})(re),de(!1)},children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Renew Subscription"]}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>de(!1),children:"Close"})]})})]})]})]})})]})};export{q as default};

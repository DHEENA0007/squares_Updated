import{j as e}from"./ui-DOY6021Z.js";import{g as C,d as R,r as o}from"./router-2SVJvIbS.js";import{G as w,f as d,a as A,b as k,c as F,e as L,I as v}from"./index-DJqidggL.js";import{L as n}from"./label-B9O-vWmY.js";import{T as P}from"./textarea-DO9hd5Hf.js";import{C as E}from"./checkbox-DRMy5EYZ.js";import{S as T}from"./switch-simAip1U.js";import{r as x}from"./roleService-Cd5OgGjv.js";import{L as f}from"./loader-circle-C0zUPQir.js";import{A as j}from"./arrow-left-DvjMreL9.js";import{S as q}from"./save-CDsOycSg.js";import"./vendor-Dazix4UH.js";const Q=()=>{const{id:l}=C(),i=R(),{toast:p}=w(),[s,r]=o.useState(null),[g,h]=o.useState(!0),[c,u]=o.useState(!1),[N,y]=o.useState([]);o.useEffect(()=>{(async()=>{if(l)try{h(!0);const[t,m]=await Promise.all([x.getRole(l),x.getAvailablePermissions()]);r(t.data.role),y(m)}catch(t){console.error("Failed to fetch role:",t),p({title:"Error",description:"Failed to load role data.",variant:"destructive"}),i("/admin/roles")}finally{h(!1)}})()},[l,i,p]);const b=async a=>{if(a.preventDefault(),!(!s||!l))try{u(!0),await x.updateRole(l,{name:s.name,description:s.description,permissions:s.permissions,isActive:s.isActive,level:s.level}),i("/admin/roles")}catch(t){console.error("Failed to update role:",t)}finally{u(!1)}},S=a=>{if(!s)return;const t=s.permissions.includes(a)?s.permissions.filter(m=>m!==a):[...s.permissions,a];r({...s,permissions:t})};return g?e.jsxs("div",{className:"flex justify-center items-center py-12 relative top-[60px]",children:[e.jsx(f,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading role..."})]}):s?e.jsxs("div",{className:"space-y-6 relative top-[60px]",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>i("/admin/roles"),children:e.jsx(j,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Edit Role"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Update role details and permissions"})]})]}),e.jsxs(A,{children:[e.jsx(k,{children:e.jsx(F,{children:"Role Information"})}),e.jsx(L,{children:e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"name",children:"Role Name"}),e.jsx(v,{id:"name",value:s.name,onChange:a=>r({...s,name:a.target.value}),disabled:s.isSystemRole,required:!0}),s.isSystemRole&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"System roles cannot be renamed"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"level",children:"Level (1-10)"}),e.jsx(v,{id:"level",type:"number",min:1,max:10,value:s.level,onChange:a=>r({...s,level:parseInt(a.target.value)}),disabled:s.isSystemRole,required:!0}),s.isSystemRole&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"System role levels cannot be changed"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"description",children:"Description"}),e.jsx(P,{id:"description",value:s.description,onChange:a=>r({...s,description:a.target.value}),rows:3,required:!0})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:"isActive",checked:s.isActive,onCheckedChange:a=>r({...s,isActive:a}),disabled:s.isSystemRole&&s.isActive}),e.jsx(n,{htmlFor:"isActive",children:"Active Role"}),s.isSystemRole&&s.isActive&&e.jsx("p",{className:"text-sm text-muted-foreground ml-2",children:"System roles cannot be deactivated"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(n,{children:"Permissions"}),s.isSystemRole&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"System role permissions cannot be modified"}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-3",children:N.map(a=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 border rounded-lg",children:[e.jsx(E,{id:a,checked:s.permissions.includes(a),onCheckedChange:()=>S(a),disabled:s.isSystemRole}),e.jsx("label",{htmlFor:a,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer flex-1",children:a.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())})]},a))})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs(d,{type:"submit",disabled:c,className:"flex items-center gap-2",children:[c?e.jsx(f,{className:"h-4 w-4 animate-spin"}):e.jsx(q,{className:"h-4 w-4"}),c?"Saving...":"Save Changes"]}),e.jsx(d,{type:"button",variant:"outline",onClick:()=>i("/admin/roles"),disabled:c,children:"Cancel"})]})]})})]})]}):e.jsx("div",{className:"space-y-6 relative top-[60px]",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>i("/admin/roles"),children:e.jsx(j,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Role Not Found"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"The requested role could not be found."})]})]})})};export{Q as default};

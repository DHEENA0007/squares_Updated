import{j as e}from"./ui-DHQhougw.js";import{r as s,R as t,h as a,L as l}from"./router-Bi51YGN-.js";import{$ as r,O as i,Q as d,R as c,V as n,W as o,Y as m,B as x,L as h,C as u,f as p,G as j,I as f,S as g,q as N,r as v,s as y,v as w,T as b,a0 as S,aw as C,Z as P,a as k,e as T,aG as A,E as L,aq as $,h as F,aa as R,ab as V,ac as E,ad as M,U,t as _}from"./index-BXXWUbfo.js";import{A as z,a as O}from"./alert-BttjhXFF.js";import{C as D}from"./circle-alert-WA1ED3fi.js";import{C as B}from"./camera-BbDp-BSr.js";import{E as G}from"./ellipsis-vertical-Dz5KHYXS.js";import{P as Y}from"./pen-line-DRmaPbv1.js";import{T as q}from"./trending-up-BvFcnL4v.js";import{T as I}from"./trash-2-Vx1507RH.js";import{C as Q}from"./calendar-DvgVTGqB.js";import"./vendor-eVk5PToZ.js";const W=({property:a,open:l,onOpenChange:C,onUpdateStatus:P})=>{const{toast:k}=r(),[T,A]=s.useState(""),[L,$]=s.useState(""),[F,R]=s.useState(!1),[V,E]=s.useState(""),[M,U]=s.useState([]),[_,B]=s.useState(!1),[G,Y]=s.useState(""),q="available"===a?.status,I=(()=>{if(!a)return null;const e=a.listingType||"sale";return"sale"===e?{value:"sold",label:"Mark as Sold",color:"bg-blue-500"}:"rent"===e?{value:"rented",label:"Mark as Rented",color:"bg-purple-500"}:"lease"===e?{value:"leased",label:"Mark as Leased",color:"bg-indigo-500"}:null})();s.useEffect(()=>{l&&q&&I&&Q()},[l]);const Q=async()=>{try{B(!0);const e=await i.getUsers({role:"customer",limit:100,status:"available"});e.success&&e.data?.users?U(e.data.users):k({title:"Warning",description:"Failed to load customers properly.",variant:"default"})}catch(e){k({title:"Error",description:"Failed to load customers.",variant:"destructive"})}finally{B(!1)}},W=M.filter(e=>{const s=G.toLowerCase(),t=`${e.profile?.firstName||""} ${e.profile?.lastName||""}`.toLowerCase(),a=e.email?.toLowerCase()||"";return t.includes(s)||a.includes(s)});t.useEffect(()=>{a&&l&&(A(""),$(""),E(""),Y(""))},[a,l]);const H=e=>{switch(e){case"active":return"bg-green-500";case"pending":return"bg-yellow-500";case"sold":return"bg-blue-500";case"rented":return"bg-purple-500";case"leased":return"bg-indigo-500";case"rejected":return"bg-red-500";default:return"bg-gray-500"}},Z=e=>{switch(e){case"active":return"Active";case"pending":return"Pending Approval";case"sold":return"Sold";case"rented":return"Rented";case"leased":return"Leased";case"rejected":return"Rejected";default:return e.charAt(0).toUpperCase()+e.slice(1)}};return e.jsx(d,{open:l,onOpenChange:C,children:e.jsxs(c,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(n,{children:[e.jsx(o,{children:"Update Property Status"}),e.jsx(m,{children:a?.title}),a?.listingType&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Listing Type: ",e.jsx(x,{variant:"outline",className:"ml-1",children:a.listingType})]})]}),"        ",e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Current Status"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(x,{className:`${H(a?.status||"")} text-white`,children:Z(a?.status||"")})})]}),!q&&e.jsxs(z,{children:[e.jsx(D,{className:"h-4 w-4"}),e.jsxs(O,{children:["This property is not yet approved by admin. You can only update the status to ",I?.label.toLowerCase()," after admin approval."]})]}),"sold"===a?.status||"rented"===a?.status||"leased"===a?.status?e.jsxs(z,{children:[e.jsx(u,{className:"h-4 w-4"}),e.jsxs(O,{children:["This property has already been marked as ",Z(a.status).toLowerCase(),"."]})]}):""===T?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Action"}),e.jsx(p,{onClick:()=>{I&&A(I.value)},disabled:!q||!I,className:`w-full ${I?.color||"bg-primary"} hover:opacity-90 text-white`,size:"lg",children:I?.label||"Update Status"}),!q&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Button will be enabled once admin approves your property"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"customer-search",children:"Search Customer"}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(f,{id:"customer-search",placeholder:"Search by name or email...",value:G,onChange:e=>Y(e.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"customer-select",children:"Assign To Customer *"}),_?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading customers..."}):e.jsxs(g,{value:V,onValueChange:E,children:[e.jsx(N,{children:e.jsx(v,{placeholder:"Select customer who bought/rented this property"})}),e.jsx(y,{children:0===W.length?e.jsx("div",{className:"p-2 text-sm text-muted-foreground text-center",children:G?"No customers found":"No customers available"}):W.map(s=>e.jsx(w,{value:s._id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-medium",children:[s.profile?.firstName," ",s.profile?.lastName]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:(e=>{const[s,t]=e.split("@");return`${s.length>3?s.substring(0,2)+"*".repeat(s.length-3)+s.slice(-1):s.substring(0,1)+"*".repeat(s.length-1)}@${t}`})(s.email)})]})},s._id))})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This property will be added to the selected customer's portfolio"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"reason",children:"Additional Notes (Optional)"}),e.jsx(b,{id:"reason",placeholder:"Add any notes about this transaction...",value:L,onChange:e=>$(e.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Status Change Preview"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:`${H(a?.status||"")} text-white`,children:Z(a?.status||"")}),e.jsx("span",{className:"text-muted-foreground",children:"â†’"}),e.jsx(x,{className:`${I?.color||"bg-gray-500"} text-white`,children:Z(T)})]})]})]})]}),e.jsxs(S,{children:[e.jsx(p,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),T&&e.jsx(p,{onClick:async()=>{if(a&&T)if(V){R(!0);try{await P(a._id,T,V,L.trim()||void 0),C(!1)}catch(e){}finally{R(!1)}}else k({title:"Customer Required",description:`Please select a customer to assign this ${T} property to.`,variant:"destructive"})},disabled:F||!V,className:`${I?.color||"bg-primary"} hover:opacity-90 text-white`,children:F?"Updating...":`Confirm ${I?.label}`})]})]})})},H=()=>{const[t]=a(),[r,i]=s.useState(t.get("search")||""),[d,c]=s.useState("all"),[n,o]=s.useState("all"),[m,h]=s.useState(!0),[u,b]=s.useState([]),[S,z]=s.useState(!1),[O,D]=s.useState(null),[H,Z]=s.useState({totalProperties:0,totalViews:0,totalFavorites:0,averageRating:0}),[J,K]=s.useState({currentPage:1,totalPages:1,totalProperties:0,hasNextPage:!1,hasPrevPage:!1});s.useEffect(()=>{X(),ee()},[]),s.useEffect(()=>{const e=t.get("search");e&&i(e)},[t]),s.useEffect(()=>{X()},[r,d,n]);const X=async()=>{try{h(!0);const e={page:1,limit:10,...r&&{search:r},..."all"!==d&&{status:d},..."all"!==n&&{propertyType:n}},s=await C.getVendorProperties(e);b(s.data.properties),K(s.data.pagination)}catch(e){}finally{h(!1)}},ee=async()=>{try{const e=await C.getVendorPropertyStats();Z(e)}catch(e){}},se=async(e,s)=>{try{await C.togglePropertyFeatured(e,!s),X(),ee()}catch(t){}},te=e=>{D(e),z(!0)},ae=e=>{const s=[];return e.address.locationName&&s.push(e.address.locationName),e.address.city&&s.push(e.address.city),e.address.state&&s.push(e.address.state),s.join(", ")||"Location not specified"};return m?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading properties..."})]})}):e.jsxs("div",{className:"space-y-4 md:space-y-6 mt-16 px-4 md:px-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:"My Properties"}),e.jsx("p",{className:"text-sm md:text-base text-muted-foreground",children:"Manage and track your property listings"})]}),e.jsx(l,{to:"/vendor/properties/add",className:"w-full sm:w-auto",children:e.jsxs(p,{className:"w-full",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Add Property"]})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 md:gap-4",children:[e.jsx(k,{children:e.jsx(T,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs md:text-sm font-medium text-muted-foreground",children:"Total Properties"}),e.jsx("p",{className:"text-xl md:text-2xl font-bold",children:H.totalProperties})]}),e.jsx(A,{className:"h-6 w-6 md:h-8 md:w-8 text-blue-600"})]})})}),e.jsx(k,{children:e.jsx(T,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs md:text-sm font-medium text-muted-foreground",children:"Total Views"}),e.jsx("p",{className:"text-xl md:text-2xl font-bold",children:H.totalViews.toLocaleString()})]}),e.jsx(L,{className:"h-6 w-6 md:h-8 md:w-8 text-green-600"})]})})}),e.jsx(k,{className:"col-span-2 md:col-span-1",children:e.jsx(T,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs md:text-sm font-medium text-muted-foreground",children:"Avg. Rating"}),e.jsx("p",{className:"text-xl md:text-2xl font-bold",children:H.averageRating.toFixed(1)})]}),e.jsx($,{className:"h-6 w-6 md:h-8 md:w-8 text-orange-600"})]})})})]}),e.jsx(k,{children:e.jsx(T,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(f,{placeholder:"Search properties...",value:r,onChange:e=>i(e.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(g,{value:d,onValueChange:c,children:[e.jsx(N,{className:"w-full sm:w-40",children:e.jsx(v,{placeholder:"Status"})}),e.jsxs(y,{children:[e.jsx(w,{value:"all",children:"All Status"}),e.jsx(w,{value:"available",children:"Available"}),e.jsx(w,{value:"pending",children:"Pending"}),e.jsx(w,{value:"sold",children:"Sold"}),e.jsx(w,{value:"rented",children:"Rented"})]})]}),e.jsxs(g,{value:n,onValueChange:o,children:[e.jsx(N,{className:"w-full sm:w-40",children:e.jsx(v,{placeholder:"Type"})}),e.jsxs(y,{children:[e.jsx(w,{value:"all",children:"All Types"}),e.jsx(w,{value:"apartment",children:"Apartment"}),e.jsx(w,{value:"house",children:"House"}),e.jsx(w,{value:"villa",children:"Villa"}),e.jsx(w,{value:"plot",children:"Plot"}),e.jsx(w,{value:"land",children:"Land"}),e.jsx(w,{value:"commercial",children:"Commercial"}),e.jsx(w,{value:"office",children:"Office"}),e.jsx(w,{value:"pg",children:"PG (Paying Guest)"})]})]})]})]})})}),e.jsx("div",{className:"space-y-4",children:u.map(s=>{return e.jsx(k,{className:"overflow-hidden",children:e.jsx(T,{className:"p-0",children:e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[e.jsxs("div",{className:"lg:w-64 h-48 lg:h-auto bg-muted relative",children:[s.images&&s.images.length>0?e.jsx("img",{src:C.getPrimaryImage(s),alt:s.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/20 to-transparent flex items-center justify-center",children:e.jsx(B,{className:"w-12 h-12 text-muted-foreground"})}),e.jsxs("div",{className:"absolute top-2 left-2 md:top-3 md:left-3 flex gap-1 md:gap-2",children:[e.jsx(x,{className:`${C.getStatusColor(s.status)} text-white text-xs`,children:C.getStatusText(s.status)}),s.featured&&e.jsx(x,{variant:"secondary",className:"text-xs",children:"Featured"}),s.verified&&e.jsx(x,{className:"bg-green-600 text-white text-xs",children:"Verified"})]}),s.images&&s.images.length>0&&e.jsxs("div",{className:"absolute bottom-2 left-2 md:bottom-3 md:left-3 bg-black/70 text-white px-2 py-1 rounded text-xs md:text-sm",children:[s.images.length," ",1===s.images.length?"photo":"photos"]})]}),e.jsxs("div",{className:"flex-1 p-4 md:p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3 md:mb-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg md:text-xl font-semibold mb-1 truncate",children:s.title}),e.jsxs("p",{className:"text-muted-foreground flex items-center mb-2 text-sm",children:[e.jsx(F,{className:"w-4 h-4 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:ae(s)})]}),e.jsx("p",{className:"text-xl md:text-2xl font-bold text-primary",children:C.formatPrice(s.price,s.listingType)})]}),e.jsxs(R,{children:[e.jsx(V,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"flex-shrink-0",children:e.jsx(G,{className:"w-4 h-4"})})}),e.jsxs(E,{align:"end",children:[e.jsx(M,{asChild:!0,children:e.jsxs(l,{to:`/vendor/properties/details/${s._id}`,children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"View Details"]})}),e.jsx(M,{asChild:!0,children:e.jsxs(l,{to:`/vendor/properties/edit/${s._id}`,children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Edit Property"]})}),e.jsxs(M,{onClick:()=>se(s._id,s.featured),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),s.featured?"Unfeature":"Promote"]}),"available"===s.status&&e.jsxs(M,{onClick:()=>te(s),children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"sale"===s.listingType?"Mark as Sold":"rent"===s.listingType?"Mark as Rented":"Mark as Leased"]}),e.jsxs(M,{className:"text-red-600",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this property?"))try{await C.deleteProperty(e),X(),ee()}catch(s){}})(s._id),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 mb-3 md:mb-4",children:[s.bedrooms>0&&e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Bedrooms"}),e.jsx("p",{className:"font-semibold text-sm md:text-base",children:s.bedrooms})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Bathrooms"}),e.jsx("p",{className:"font-semibold text-sm md:text-base",children:s.bathrooms})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Area"}),e.jsx("p",{className:"font-semibold text-sm md:text-base",children:C.formatArea(s.area)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Type"}),e.jsx("p",{className:"font-semibold text-sm md:text-base capitalize",children:s.type})]})]}),e.jsxs("div",{className:"flex flex-wrap justify-between items-center text-xs md:text-sm text-muted-foreground mb-3 md:mb-4 gap-2",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(L,{className:"w-3 h-3 md:w-4 md:h-4 mr-1"}),s.views," views"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx($,{className:"w-3 h-3 md:w-4 md:h-4 mr-1"}),s.favorites||0," favorites"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx($,{className:"w-3 h-3 md:w-4 md:h-4 mr-1 fill-current text-yellow-500"}),s.averageRating?.toFixed(1)||"0.0"," rating"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(Q,{className:"w-3 h-3 md:w-4 md:h-4 mr-1"}),"Listed ",(t=s.createdAt,new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-2",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{to:`/vendor/properties/details/${s._id}`,className:"flex-1",children:e.jsxs(p,{size:"sm",variant:"outline",className:"w-full text-xs md:text-sm",children:[e.jsx(L,{className:"w-3 h-3 md:w-4 md:h-4 mr-1 md:mr-2"}),"View Details"]})}),e.jsx(l,{to:`/vendor/properties/edit/${s._id}`,className:"flex-1",children:e.jsxs(p,{size:"sm",variant:"outline",className:"w-full text-xs md:text-sm",children:[e.jsx(Y,{className:"w-3 h-3 md:w-4 md:h-4 mr-1 md:mr-2"}),"Edit"]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{size:"sm",onClick:()=>se(s._id,s.featured),className:"flex-1 text-xs md:text-sm",children:[e.jsx(q,{className:"w-3 h-3 md:w-4 md:h-4 mr-1 md:mr-2"}),s.featured?"Unfeature":"Promote"]}),"available"===s.status&&e.jsx(p,{size:"sm",variant:"outline",onClick:()=>te(s),className:"flex-1 text-xs md:text-sm",children:"sale"===s.listingType?"Mark as Sold":"rent"===s.listingType?"Mark as Rented":"Mark as Leased"})]})]})})]})]})})},s._id);var t})}),0===u.length&&!m&&e.jsx(k,{children:e.jsxs(T,{className:"p-8 md:p-12 text-center",children:[e.jsx(A,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No properties found"}),e.jsx("p",{className:"text-muted-foreground mb-4 text-sm md:text-base",children:r||"all"!==d||"all"!==n?"No properties match your search criteria":"You haven't added any properties yet"}),e.jsx(l,{to:"/vendor/properties/add",className:"w-full sm:w-auto",children:e.jsxs(p,{className:"w-full sm:w-auto",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Add Your First Property"]})})]})}),e.jsx(W,{property:O,open:S,onOpenChange:z,onUpdateStatus:async(e,s,t,a)=>{try{!t||"sold"!==s&&"rented"!==s&&"leased"!==s?(await C.togglePropertyStatus(e,s),_({title:"Success",description:`Property status updated to ${s}!`})):(await C.assignPropertyToCustomer(e,t,s,a),_({title:"Success",description:`Property ${s} and assigned to customer successfully!`})),X(),ee()}catch(l){_({title:"Error",description:"Failed to update property status",variant:"destructive"})}}})]})};export{H as default};
